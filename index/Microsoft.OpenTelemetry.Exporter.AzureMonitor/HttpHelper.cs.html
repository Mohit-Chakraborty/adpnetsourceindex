<!DOCTYPE html>
<html><head><title>HttpHelper.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(97);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.OpenTelemetry.Exporter.AzureMonitor/HttpHelper.cs" target="_top">HttpHelper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.OpenTelemetry.Exporter.AzureMonitor" target="_top">src\Microsoft.OpenTelemetry.Exporter.AzureMonitor.csproj</a> (Microsoft.OpenTelemetry.Exporter.AzureMonitor)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">OpenTelemetry</span>.<span class="i n">Exporter</span>.<span class="i n">AzureMonitor</span>
{
    <b>internal static class</b> <a id="c1feb2e487337ada" href="R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">HttpHelper</a>
    {
        <b>private const string</b> <a id="38a0f709ca60b572" href="R/38a0f709ca60b572.html" target="n" data-glyph="10,1" class="i field">SchemePostfix</a> = <span class="s">&quot;://&quot;</span>;
        <b>private const string</b> <a id="908f62500218b5d0" href="R/908f62500218b5d0.html" target="n" data-glyph="10,1" class="i field">Colon</a> = <span class="s">&quot;:&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This method follows OpenTelemetry specification to retrieve http URL.</span>
        <span class="c">///</span><span class="c"> Reference: https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/http.md#http-client.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">tagObjects</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Activity Tags</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">url</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">URL</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">urlAuthority</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Host name or IP address and the port number </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static void</b> <a id="3fb7d2c80de288dc" href="R/3fb7d2c80de288dc.html" target="n" data-glyph="221,1" class="i method">GenerateUrlAndAuthority</a>(<b>this</b> <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a> <span id="r0 rd" class="r0 r">tagObjects</span>, <b>out string</b> <span id="r1 rd" class="r1 r">url</span>, <b>out string</b> <span id="r2 rd" class="r2 r">urlAuthority</span>)
        {
            <span class="r2 r">urlAuthority</span> = <b>null</b>;
            <span class="r1 r">url</span> = <b>null</b>;
 
            <b>var</b> <span id="r3 rd" class="r3 r">httpurl</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#8e1f1cf40dff3221" class="i method">GetTagValue</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#ab1bd4878d6eaa7c" class="i field">AttributeHttpUrl</a>);
 
            <b>if</b> (<span class="r3 r">httpurl</span> != <b>null</b> &amp;&amp; <span class="i">Uri</span>.<span class="i">TryCreate</span>(<span class="r3 r">httpurl</span>.<span class="i">ToString</span>(), <span class="i">UriKind</span>.<span class="i">RelativeOrAbsolute</span>, <b>out</b> <b>var</b> <span id="r4 rd" class="r4 r">uri</span>) &amp;&amp; <span class="r4 r">uri</span>.<span class="i">IsAbsoluteUri</span>)
            {
                <span class="r1 r">url</span> = <span class="r4 r">uri</span>.<span class="i">AbsoluteUri</span>;
                <span class="r2 r">urlAuthority</span> = <span class="r4 r">uri</span>.<span class="i">Authority</span>;
                <b>return</b>;
            }
 
            <b>var</b> <span id="r5 rd" class="r5 r">httpScheme</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#8e1f1cf40dff3221" class="i method">GetTagValue</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#4ef8cb1951ec3f04" class="i field">AttributeHttpScheme</a>)?.<span class="i">ToString</span>();
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r5 r">httpScheme</span>))
            {
                <b>var</b> <span id="r6 rd" class="r6 r">httpHost</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#8e1f1cf40dff3221" class="i method">GetTagValue</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#02867baafd7e4df8" class="i field">AttributeHttpHost</a>)?.<span class="i">ToString</span>();
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r6 r">httpHost</span>))
                {
                    <b>var</b> <span id="r7 rd" class="r7 r">httpPortAndTarget</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#17e682fbbe8f2594" class="i method">GetTagValues</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#d733b263b1a93772" class="i field">AttributeHttpHostPort</a>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#6b6b6a84d4730dd1" class="i field">AttributeHttpTarget</a>);
 
                    <b>if</b> (<span class="r7 r">httpPortAndTarget</span>[0] != <b>null</b> &amp;&amp; <span class="r7 r">httpPortAndTarget</span>[0].<span class="i">ToString</span>() != <span class="s">&quot;80&quot;</span> &amp;&amp; <span class="r7 r">httpPortAndTarget</span>[0].<span class="i">ToString</span>() != <span class="s">&quot;443&quot;</span>)
                    {
                        <b>var</b> <span id="r8 rd" class="r8 r">IsColon</span> = (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r7 r">httpPortAndTarget</span>[0].<span class="i">ToString</span>()) ? <b>null</b> : <a href="#908f62500218b5d0" class="i field">Colon</a>);
                        <span class="r1 r">url</span> = <span class="s">$&quot;</span>{<span class="r5 r">httpScheme</span>}<span class="s">://</span>{<span class="r6 r">httpHost</span>}{<span class="r8 r">IsColon</span>}{<span class="r7 r">httpPortAndTarget</span>[0]}{<span class="r7 r">httpPortAndTarget</span>[1]}<span class="s">&quot;</span>;
                        <span class="r2 r">urlAuthority</span> = <span class="s">$&quot;</span>{<span class="r6 r">httpHost</span>}{<span class="r8 r">IsColon</span>}{<span class="r7 r">httpPortAndTarget</span>[0]}<span class="s">&quot;</span>;
                    }
                    <b>else</b>
                    {
                        <span class="r1 r">url</span> = <span class="s">$&quot;</span>{<span class="r5 r">httpScheme</span>}<span class="s">://</span>{<span class="r6 r">httpHost</span>}{<span class="r7 r">httpPortAndTarget</span>[1]}<span class="s">&quot;</span>;
                        <span class="r2 r">urlAuthority</span> = <span class="s">$&quot;</span>{<span class="r6 r">httpHost</span>}<span class="s">&quot;</span>;
                    }
 
                    <b>return</b>;
                }
 
                <b>var</b> <span id="r9 rd" class="r9 r">netPeerName</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#8e1f1cf40dff3221" class="i method">GetTagValue</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#2a61817fa9f1c316" class="i field">AttributeNetPeerName</a>)?.<span class="i">ToString</span>();
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r9 r">netPeerName</span>))
                {
                    <b>var</b> <span id="r10 rd" class="r10 r">netPeerPortAndTarget</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#17e682fbbe8f2594" class="i method">GetTagValues</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#a032b43bbf34cfeb" class="i field">AttributeNetPeerPort</a>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#6b6b6a84d4730dd1" class="i field">AttributeHttpTarget</a>);
                    <b>var</b> <span id="r11 rd" class="r11 r">IsColon</span> = (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r10 r">netPeerPortAndTarget</span>[0]?.<span class="i">ToString</span>()) ? <b>null</b> : <a href="#908f62500218b5d0" class="i field">Colon</a>);
                    <span class="r1 r">url</span> = <span class="s">$&quot;</span>{<span class="r5 r">httpScheme</span>}{<a href="#38a0f709ca60b572" class="i field">SchemePostfix</a>}{<span class="r9 r">netPeerName</span>}{<span class="r11 r">IsColon</span>}{<span class="r10 r">netPeerPortAndTarget</span>[0]}{<span class="r10 r">netPeerPortAndTarget</span>[1]}<span class="s">&quot;</span>;
                    <span class="r2 r">urlAuthority</span> = <span class="s">$&quot;</span>{<span class="r9 r">netPeerName</span>}{<span class="r11 r">IsColon</span>}{<span class="r10 r">netPeerPortAndTarget</span>[0]}<span class="s">&quot;</span>;
                    <b>return</b>;
                }
 
                <b>var</b> <span id="r12 rd" class="r12 r">netPeerIP</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#8e1f1cf40dff3221" class="i method">GetTagValue</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#a6f8913378fc72c2" class="i field">AttributeNetPeerIp</a>)?.<span class="i">ToString</span>();
 
                <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r12 r">netPeerIP</span>))
                {
                    <b>var</b> <span id="r13 rd" class="r13 r">netPeerPortAndTarget</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#17e682fbbe8f2594" class="i method">GetTagValues</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#a032b43bbf34cfeb" class="i field">AttributeNetPeerPort</a>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#6b6b6a84d4730dd1" class="i field">AttributeHttpTarget</a>);
                    <b>var</b> <span id="r14 rd" class="r14 r">IsColon</span> = (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r13 r">netPeerPortAndTarget</span>[0]?.<span class="i">ToString</span>()) ? <b>null</b> : <a href="#908f62500218b5d0" class="i field">Colon</a>);
                    <span class="r1 r">url</span> = <span class="s">$&quot;</span>{<span class="r5 r">httpScheme</span>}{<a href="#38a0f709ca60b572" class="i field">SchemePostfix</a>}{<span class="r12 r">netPeerIP</span>}{<span class="r14 r">IsColon</span>}{<span class="r13 r">netPeerPortAndTarget</span>[0]}{<span class="r13 r">netPeerPortAndTarget</span>[1]}<span class="s">&quot;</span>;
                    <span class="r2 r">urlAuthority</span> = <span class="s">$&quot;</span>{<span class="r12 r">netPeerIP</span>}{<span class="r14 r">IsColon</span>}{<span class="r13 r">netPeerPortAndTarget</span>[0]}<span class="s">&quot;</span>;
                    <b>return</b>;
                }
            }
 
            <b>var</b> <span id="r15 rd" class="r15 r">host</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#8e1f1cf40dff3221" class="i method">GetTagValue</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#02867baafd7e4df8" class="i field">AttributeHttpHost</a>)?.<span class="i">ToString</span>();
 
            <b>if</b> (!<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r15 r">host</span>))
            {
                <b>var</b> <span id="r16 rd" class="r16 r">httpPortAndTarget</span> = <a href="AzMonList.cs.html#715ec1437b0d7cc3" class="t t">AzMonList</a>.<a href="AzMonList.cs.html#17e682fbbe8f2594" class="i method">GetTagValues</a>(<b>ref</b> <span class="r0 r">tagObjects</span>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#d733b263b1a93772" class="i field">AttributeHttpHostPort</a>, <a href="SemanticConventions.cs.html#0f032b723659f3be" class="t t">SemanticConventions</a>.<a href="SemanticConventions.cs.html#6b6b6a84d4730dd1" class="i field">AttributeHttpTarget</a>);
                <b>var</b> <span id="r17 rd" class="r17 r">IsColon</span> = (<b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r16 r">httpPortAndTarget</span>[0]?.<span class="i">ToString</span>()) ? <b>null</b> : <a href="#908f62500218b5d0" class="i field">Colon</a>);
                <span class="r1 r">url</span> = <span class="s">$&quot;</span>{<span class="r15 r">host</span>}{<span class="r17 r">IsColon</span>}{<span class="r16 r">httpPortAndTarget</span>[0]}{<span class="r16 r">httpPortAndTarget</span>[1]}<span class="s">&quot;</span>;
                <span class="r2 r">urlAuthority</span> = <span class="s">$&quot;</span>{<span class="r15 r">host</span>}{<span class="r17 r">IsColon</span>}{<span class="r16 r">httpPortAndTarget</span>[0]}<span class="s">&quot;</span>;
                <b>return</b>;
            }
 
            <span class="r1 r">url</span> = <b>string</b>.<span class="i">IsNullOrWhiteSpace</span>(<span class="r1 r">url</span>) ? <b>null</b> : <span class="r1 r">url</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
