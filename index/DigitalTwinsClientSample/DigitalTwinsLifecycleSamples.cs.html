<!DOCTYPE html>
<html><head><title>DigitalTwinsLifecycleSamples.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(445);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#DigitalTwinsClientSample/DigitalTwinsLifecycleSamples.cs" target="_top">DigitalTwinsLifecycleSamples.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#DigitalTwinsClientSample" target="_top">samples\DigitalTwinsClientSample\DigitalTwinsClientSample.csproj</a> (DigitalTwinsClientSample)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">Json</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using static</b> <span class="i n">Azure</span>.<span class="i n">DigitalTwins</span>.<span class="i n">Core</span>.<span class="i n">Samples</span>.<a href="SampleLogger.cs.html#a1b73d4d931d8e17" class="t t">SampleLogger</a>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">DigitalTwins</span>.<span class="i n">Core</span>.<span class="i n">Samples</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> This sample creates all the models in \DTDL\Models folder in the ADT service instance</span>
    <span class="c">///</span><span class="c"> and creates the corresponding twins in \DTDL\DigitalTwins folder</span>
    <span class="c">///</span><span class="c"> The Diagram for the Hospital model looks like this:</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c">     +------------+</span>
    <span class="c">///</span><span class="c">     |  Building  +-----isEquippedWith-----+</span>
    <span class="c">///</span><span class="c">     +------------+                        |</span>
    <span class="c">///</span><span class="c">           |                               v</span>
    <span class="c">///</span><span class="c">          has                           +-----+</span>
    <span class="c">///</span><span class="c">           |                            | HVAC|</span>
    <span class="c">///</span><span class="c">           v                            +-----+</span>
    <span class="c">///</span><span class="c">     +------------+                        |</span>
    <span class="c">///</span><span class="c">     |   Floor    +</span><span class="c">&lt;</span><span class="c">-</span><span class="c">-</span><span class="c">controlsTemperature--</span><span class="c">+</span>
    <span class="c">///</span>     <span class="c">+</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">+</span>
    <span class="c">///</span>           <span class="c">|</span>
    <span class="c">///</span>        <span class="c">contains</span>
    <span class="c">///</span>           <span class="c">|</span>
    <span class="c">///</span>           <span class="c">v</span>
    <span class="c">///</span>     <span class="c">+</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">+</span>                 <span class="c">+</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">-</span><span class="c">+</span>
    <span class="c">///</span>     <span class="c">|</span>   <span class="c">Room</span>     <span class="c">|</span><span class="c">-</span><span class="c">with</span> <span class="c">component-</span><span class="c">&gt;</span><span class="c">| WifiAccessPoint |</span>
    <span class="c">///</span><span class="c">     +------------+                 +-----------------+</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="4dbc7ffe3fb8e5bc" href="R/4dbc7ffe3fb8e5bc.html" target="n" data-glyph="2,0" class="t t">DigitalTwinsLifecycleSamples</a>
    {
        <span class="c">// Json folders and file paths</span>
        <b>private static readonly string</b> <a id="9d7f01022de73a33" href="R/9d7f01022de73a33.html" target="n" data-glyph="46,1" class="i field">s_dtdlDirectoryPath</a> = <span class="t t">Path</span>.<span class="i method">Combine</span>(<a href="#dd2d9fc4c9bfbfc5" class="i method">GetWorkingDirectory</a>(), <span class="s">&quot;DTDL&quot;</span>);
 
        <b>private static readonly string</b> <a id="f6b7152adb0a71f3" href="R/f6b7152adb0a71f3.html" target="n" data-glyph="46,1" class="i field">s_modelsPath</a> = <span class="t t">Path</span>.<span class="i method">Combine</span>(<a href="#9d7f01022de73a33" class="i field">s_dtdlDirectoryPath</a>, <span class="s">&quot;Models&quot;</span>);
        <b>private static readonly string</b> <a id="8e19145fe9b517e5" href="R/8e19145fe9b517e5.html" target="n" data-glyph="46,1" class="i field">s_twinsPath</a> = <span class="t t">Path</span>.<span class="i method">Combine</span>(<a href="#9d7f01022de73a33" class="i field">s_dtdlDirectoryPath</a>, <span class="s">&quot;DigitalTwins&quot;</span>);
        <b>private static readonly string</b> <a id="749426857ed5bc5e" href="R/749426857ed5bc5e.html" target="n" data-glyph="46,1" class="i field">s_relationshipsPath</a> = <span class="t t">Path</span>.<span class="i method">Combine</span>(<a href="#9d7f01022de73a33" class="i field">s_dtdlDirectoryPath</a>, <span class="s">&quot;Relationships&quot;</span>);
 
        <b>private readonly string</b> <a id="bef66643d41f47fd" href="R/bef66643d41f47fd.html" target="n" data-glyph="46,1" class="i field">_eventRouteId</a> = <span class="s">$&quot;</span><span class="s">sampleEventRouteId-</span>{<a href="@1@System.Runtime/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@1@System.Runtime/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>()}<span class="s">&quot;</span>;
 
        <b>private readonly string</b> <a id="d246fbb004230417" href="R/d246fbb004230417.html" target="n" data-glyph="46,1" class="i field">eventhubEndpointName</a>;
        <b>private readonly</b> <a href="/Azure.DigitalTwins.Core/A.html#3656e7d21d4ba6df" class="t t">DigitalTwinsClient</a> <a id="93ad873cb19985bb" href="R/93ad873cb19985bb.html" target="n" data-glyph="46,1" class="i field">client</a>;
 
        <b>public</b> <a id="d90b1213c818d1bd" href="R/d90b1213c818d1bd.html" target="n" data-glyph="72,1" class="t constructor">DigitalTwinsLifecycleSamples</a>(<a href="/Azure.DigitalTwins.Core/A.html#3656e7d21d4ba6df" class="t t">DigitalTwinsClient</a> <span id="r0 rd" class="r0 r">dtClient</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">eventhubEndpointName</span>)
        {
            <a href="#4dbc7ffe3fb8e5bc" class="k">this</a>.<a href="#d246fbb004230417" class="i field">eventhubEndpointName</a> = <span class="r1 r">eventhubEndpointName</span>;
            <a href="#93ad873cb19985bb" class="i field">client</a> = <span class="r0 r">dtClient</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates all Models in the Models folder</span>
        <span class="c">///</span><span class="c"> Creates all DigitalTwins in the DigitalTwins folder</span>
        <span class="c">///</span><span class="c"> Connects all DigitalTwins using relationships in the Relationships folder.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0cf78079dace7ea5" href="R/0cf78079dace7ea5.html" target="n" data-glyph="72,1" class="i method">RunSamplesAsync</a>()
        {
            <span class="c">// Ensure existing twins with the same name are deleted first</span>
            <b>await</b> <a href="#46c8ea8b5639e509" class="i method">DeleteTwinsAsync</a>();
 
            <span class="c">// Delete existing models</span>
            <b>await</b> <a href="#45bc1011d6628d8e" class="i method">DeleteAllModelsAsync</a>();
 
            <span class="c">// Create all the models</span>
            <b>await</b> <a href="#abcedc796ba2a5bf" class="i method">AddAllModelsAsync</a>();
 
            <span class="c">// Get all models</span>
            <b>await</b> <a href="#7894dbcffe5b7095" class="i method">GetAllModelsAsync</a>();
 
            <span class="c">// Create twin counterparts for all the models</span>
            <b>await</b> <a href="#7e123b1254ca50a3" class="i method">CreateAllTwinsAsync</a>();
 
            <span class="c">// Get all twins</span>
            <b>await</b> <a href="#b5648f9bc2573f61" class="i method">QueryTwinsAsync</a>();
 
            <span class="c">// Create all the relationships</span>
            <b>await</b> <a href="#a700315105b37156" class="i method">ConnectTwinsTogetherAsync</a>();
 
            <span class="c">// Creating event route</span>
            <b>await</b> <a href="#c8bf9c6fd94bc4f7" class="i method">CreateEventRoute</a>();
 
            <span class="c">// Get all event routes</span>
            <b>await</b> <a href="#928b165ce03c142c" class="i method">GetEventRoutes</a>();
 
            <span class="c">// Deleting event route</span>
            <b>await</b> <a href="#4257520fb160b61a" class="i method">DeleteEventRoute</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Delete models created by FullLifecycleSample for the ADT service instance</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="45bc1011d6628d8e" href="R/45bc1011d6628d8e.html" target="n" data-glyph="76,1" class="i method">DeleteAllModelsAsync</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;DELETING MODELS&quot;</span>);
 
            <b>try</b>
            {
                <span class="c">// This is to ensure models are deleted in an order such that no other models are referencing it</span>
                <b>var</b> <span id="r2 rd" class="r2 r">models</span> = <b>new</b> <span class="t constructor">Queue</span>();
                <span class="r2 r">models</span>.<span class="i method">Enqueue</span>(<a href="SamplesConstants.cs.html#e8af6f2a94e49a91" class="t t">SamplesConstants</a>.<a href="SamplesConstants.cs.html#133df1ddae12febc" class="i field">RoomModelId</a>);
                <span class="r2 r">models</span>.<span class="i method">Enqueue</span>(<a href="SamplesConstants.cs.html#e8af6f2a94e49a91" class="t t">SamplesConstants</a>.<a href="SamplesConstants.cs.html#562d9d4633b8641d" class="i field">WifiModelId</a>);
                <span class="r2 r">models</span>.<span class="i method">Enqueue</span>(<a href="SamplesConstants.cs.html#e8af6f2a94e49a91" class="t t">SamplesConstants</a>.<a href="SamplesConstants.cs.html#8163427aef3debc0" class="i field">BuildingModelId</a>);
                <span class="r2 r">models</span>.<span class="i method">Enqueue</span>(<a href="SamplesConstants.cs.html#e8af6f2a94e49a91" class="t t">SamplesConstants</a>.<a href="SamplesConstants.cs.html#2e375fa81e23e9c6" class="i field">FloorModelId</a>);
                <span class="r2 r">models</span>.<span class="i method">Enqueue</span>(<a href="SamplesConstants.cs.html#e8af6f2a94e49a91" class="t t">SamplesConstants</a>.<a href="SamplesConstants.cs.html#302638b9974e04c3" class="i field">HvacModelId</a>);
 
                <b>foreach</b> (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">modelId</span> <b>in</b> <span class="r2 r">models</span>)
                {
                    <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">DeleteModelAsync</span>(<span class="r3 r">modelId</span>);
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Deleted model &#39;</span>{<span class="r3 r">modelId</span>}<span class="s">&#39;.</span><span class="s">&quot;</span>);
                }
            }
            <b>catch</b> (<span class="i">RequestFailedException</span> <span id="r4 rd" class="r4 r">ex</span>) <b>when</b> (<span class="r4 r">ex</span>.<span class="i">Status</span> == (<b>int</b>)<span class="t t">HttpStatusCode</span>.<span class="i field">NotFound</span>)
            {
                <span class="c">// Model does not exist.</span>
            }
            <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r5 rd" class="r5 r">ex</span>)
            {
                <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Failed to delete models due to:\n</span>{<span class="r5 r">ex</span>}<span class="s">&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Loads all the models found in the Models directory into memory and uses CreateModelsAsync API to create all the models in the ADT service instance</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="abcedc796ba2a5bf" href="R/abcedc796ba2a5bf.html" target="n" data-glyph="76,1" class="i method">AddAllModelsAsync</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;CREATING MODELS&quot;</span>);
 
            <span class="t t">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r6 rd" class="r6 r">modelsToCreate</span> = <a href="FileHelper.cs.html#a33a5c6888a28b8b" class="t t">FileHelper</a>.<a href="FileHelper.cs.html#badf49d93bddab9d" class="i method">LoadAllFilesInPath</a>(<a href="#f6b7152adb0a71f3" class="i field">s_modelsPath</a>).<span class="i property">Values</span>.<span class="i method">ToList</span>();
 
            <b>if</b> (<span class="r6 r">modelsToCreate</span> == <b>null</b> || !<span class="r6 r">modelsToCreate</span>.<span class="i method">Any</span>())
            {
                <b>throw</b> <b>new</b> <a href="@1@System.Runtime/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<span class="s">&quot;Could not load models from disk.&quot;</span>);
            }
 
            <b>try</b>
            {
                <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">CreateModelsAsync</span>(<span class="r6 r">modelsToCreate</span>);
                <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">&quot;Created models.&quot;</span>);
            }
            <b>catch</b> (<span class="i">RequestFailedException</span> <span id="r7 rd" class="r7 r">ex</span>) <b>when</b> (<span class="r7 r">ex</span>.<span class="i">Status</span> == (<b>int</b>)<span class="t t">HttpStatusCode</span>.<span class="i field">Conflict</span>)
            {
                <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">One or more models already exist. Continuing with the sample optimistically.</span><span class="s">&quot;</span>);
            }
            <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r8 rd" class="r8 r">ex</span>)
            {
                <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Failed to create models due to:\n</span>{<span class="r8 r">ex</span>}<span class="s">&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets all the models within the ADT service instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7894dbcffe5b7095" href="R/7894dbcffe5b7095.html" target="n" data-glyph="72,1" class="i method">GetAllModelsAsync</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;LISTING MODELS&quot;</span>);
            <b>try</b>
            {
                <span class="c">// Get all the twin types</span>
 
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DigitalTwinsSampleGetModels
 
                <span class="i">AsyncPageable</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#50f04c2d16117cd8" class="t t">DigitalTwinsModelData</a>&gt; <span id="r9 rd" class="r9 r">allModels</span> = <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">GetModelsAsync</span>();
                <b>await</b> <b>foreach</b> (<a href="/Azure.DigitalTwins.Core/A.html#50f04c2d16117cd8" class="t t">DigitalTwinsModelData</a> <span id="r10 rd" class="r10 r">model</span> <b>in</b> <span class="r9 r">allModels</span>)
                {
                    <span class="t t">Console</span>.<span class="i">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Retrieved model &#39;</span>{<span class="r10 r">model</span>.<a href="/Azure.DigitalTwins.Core/A.html#26c89afcfadce41e" class="i property">Id</a>}<span class="s">&#39;, </span><span class="s">&quot;</span> +
                        <span class="s">$&quot;</span><span class="s">display name &#39;</span>{<span class="r10 r">model</span>.<a href="/Azure.DigitalTwins.Core/A.html#59e8fc28080ddc13" class="i property">LanguageDisplayNames</a>[<span class="s">&quot;en&quot;</span>]}<span class="s">&#39;, </span><span class="s">&quot;</span> +
                        <span class="s">$&quot;</span><span class="s">uploaded on &#39;</span>{<span class="r10 r">model</span>.<a href="/Azure.DigitalTwins.Core/A.html#e2556c1b2bdc4fff" class="i property">UploadedOn</a>}<span class="s">&#39;, </span><span class="s">&quot;</span> +
                        <span class="s">$&quot;</span><span class="s">and decommissioned &#39;</span>{<span class="r10 r">model</span>.<a href="/Azure.DigitalTwins.Core/A.html#9d1624ace972fb32" class="i property">Decommissioned</a>}<span class="s">&#39;</span><span class="s">&quot;</span>);
                }
 
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:DigitalTwinsSampleGetModels
            }
            <b>catch</b> (<span class="i">RequestFailedException</span> <span id="r11 rd" class="r11 r">ex</span>)
            {
                <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Failed to get all the models due to:\n</span>{<span class="r11 r">ex</span>}<span class="s">&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Delete a twin, and any relationships it might have</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="46c8ea8b5639e509" href="R/46c8ea8b5639e509.html" target="n" data-glyph="72,1" class="i method">DeleteTwinsAsync</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;DELETE DIGITAL TWINS&quot;</span>);
            <span class="t t">Dictionary</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r12 rd" class="r12 r">twins</span> = <a href="FileHelper.cs.html#a33a5c6888a28b8b" class="t t">FileHelper</a>.<a href="FileHelper.cs.html#badf49d93bddab9d" class="i method">LoadAllFilesInPath</a>(<a href="#8e19145fe9b517e5" class="i field">s_twinsPath</a>);
 
            <b>foreach</b> (<a href="@1@System.Runtime/A.html#8585965bb176a426" class="t t">KeyValuePair</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r13 rd" class="r13 r">twin</span> <b>in</b> <span class="r12 r">twins</span>)
            {
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r14 rd" class="r14 r">digitalTwinId</span> = <span class="r13 r">twin</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>;
 
                <b>try</b>
                {
                    <span class="c">// Delete all relationships</span>
                    <span class="i">AsyncPageable</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a>&gt; <span id="r15 rd" class="r15 r">relationships</span> = <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">GetRelationshipsAsync</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a>&gt;(<span class="r14 r">digitalTwinId</span>);
                    <b>await</b> <b>foreach</b> (<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a> <span id="r16 rd" class="r16 r">relationship</span> <b>in</b> <span class="r15 r">relationships</span>)
                    {
                        <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">DeleteRelationshipAsync</span>(<span class="r14 r">digitalTwinId</span>, <span class="r16 r">relationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#38c8bf5fb27ad419" class="i property">Id</a>);
                        <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Found and deleted relationship &#39;</span>{<span class="r16 r">relationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#38c8bf5fb27ad419" class="i property">Id</a>}<span class="s">&#39;.</span><span class="s">&quot;</span>);
                    }
 
                    <span class="c">// Delete any incoming relationships</span>
                    <span class="i">AsyncPageable</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#70dbb5e9bc54da09" class="t t">IncomingRelationship</a>&gt; <span id="r17 rd" class="r17 r">incomingRelationships</span> = <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">GetIncomingRelationshipsAsync</span>(<span class="r14 r">digitalTwinId</span>);
 
                    <b>await</b> <b>foreach</b> (<a href="/Azure.DigitalTwins.Core/A.html#70dbb5e9bc54da09" class="t t">IncomingRelationship</a> <span id="r18 rd" class="r18 r">incomingRelationship</span> <b>in</b> <span class="r17 r">incomingRelationships</span>)
                    {
                        <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">DeleteRelationshipAsync</span>(<span class="r18 r">incomingRelationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#7c1f03feb2b78adf" class="i property">SourceId</a>, <span class="r18 r">incomingRelationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#534a73071e69dc58" class="i property">RelationshipId</a>);
                        <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Found and deleted incoming relationship &#39;</span>{<span class="r18 r">incomingRelationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#534a73071e69dc58" class="i property">RelationshipId</a>}<span class="s">&#39;.</span><span class="s">&quot;</span>);
                    }
 
                    <span class="c">// Now the digital twin should be safe to delete</span>
 
                    <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DigitalTwinsSampleDeleteTwin
 
                    <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">DeleteDigitalTwinAsync</span>(<span class="r14 r">digitalTwinId</span>);
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Deleted digital twin &#39;</span>{<span class="r14 r">digitalTwinId</span>}<span class="s">&#39;.</span><span class="s">&quot;</span>);
 
                    <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:DigitalTwinsSampleDeleteTwin
                }
                <b>catch</b> (<span class="i">RequestFailedException</span> <span id="r19 rd" class="r19 r">ex</span>) <b>when</b> (<span class="r19 r">ex</span>.<span class="i">Status</span> == (<b>int</b>)<span class="t t">HttpStatusCode</span>.<span class="i field">NotFound</span>)
                {
                    <span class="c">// Digital twin or relationship does not exist</span>
                }
                <b>catch</b> (<span class="i">RequestFailedException</span> <span id="r20 rd" class="r20 r">ex</span>)
                {
                    <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Failed to delete &#39;</span>{<span class="r14 r">digitalTwinId</span>}<span class="s">&#39; due to </span>{<span class="r20 r">ex</span>.<span class="i">Message</span>}<span class="s">&quot;</span>);
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates all twins specified in the \DTDL\DigitalTwins directory</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7e123b1254ca50a3" href="R/7e123b1254ca50a3.html" target="n" data-glyph="72,1" class="i method">CreateAllTwinsAsync</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;CREATE DIGITAL TWINS&quot;</span>);
            <span class="t t">Dictionary</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r21 rd" class="r21 r">twins</span> = <a href="FileHelper.cs.html#a33a5c6888a28b8b" class="t t">FileHelper</a>.<a href="FileHelper.cs.html#badf49d93bddab9d" class="i method">LoadAllFilesInPath</a>(<a href="#8e19145fe9b517e5" class="i field">s_twinsPath</a>);
 
            <span class="c">// Call APIs to create the twins.</span>
            <b>foreach</b> (<a href="@1@System.Runtime/A.html#8585965bb176a426" class="t t">KeyValuePair</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r22 rd" class="r22 r">twin</span> <b>in</b> <span class="r21 r">twins</span>)
            {
                <b>try</b>
                {
                    <a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a> <span id="r23 rd" class="r23 r">basicDigitalTwin</span> = <span class="t t">JsonSerializer</span>.<span class="i method">Deserialize</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt;(<span class="r22 r">twin</span>.<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>);
                    <span class="i">Response</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt; <span id="r24 rd" class="r24 r">response</span> = <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">CreateOrReplaceDigitalTwinAsync</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt;(<span class="r22 r">twin</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>, <span class="r23 r">basicDigitalTwin</span>);
 
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Created digital twin &#39;</span>{<span class="r22 r">twin</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>}<span class="s">&#39;.</span><span class="s">&quot;</span>);
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">\tBody: </span>{<span class="t t">JsonSerializer</span>.<span class="i">Serialize</span>(<span class="r24 r">response</span>?.<span class="i">Value</span>)}<span class="s">&quot;</span>);
                }
                <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r25 rd" class="r25 r">ex</span>)
                {
                    <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Could not create digital twin &#39;</span>{<span class="r22 r">twin</span>.<a href="@1@System.Runtime/A.html#f9d1c04feb1af032" class="i property">Key</a>}<span class="s">&#39; due to </span>{<span class="r25 r">ex</span>}<span class="s">&quot;</span>);
                }
            }
        }
 
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="b5648f9bc2573f61" href="R/b5648f9bc2573f61.html" target="n" data-glyph="72,1" class="i method">QueryTwinsAsync</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;QUERY DIGITAL TWINS&quot;</span>);
 
            <b>try</b>
            {
                <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">&quot;Making a twin query and iterating over the results.&quot;</span>);
 
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DigitalTwinsSampleQueryTwins
 
                <span class="c">// This code snippet demonstrates the simplest way to iterate over the digital twin results, where paging</span>
                <span class="c">// happens under the covers.</span>
                <span class="i">AsyncPageable</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt; <span id="r26 rd" class="r26 r">asyncPageableResponse</span> = <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">QueryAsync</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt;(<span class="s">&quot;SELECT * FROM digitaltwins&quot;</span>);
 
                <span class="c">// Iterate over the twin instances in the pageable response.</span>
                <span class="c">// The &quot;await&quot; keyword here is required because new pages will be fetched when necessary,</span>
                <span class="c">// which involves a request to the service.</span>
                <b>await</b> <b>foreach</b> (<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a> <span id="r27 rd" class="r27 r">twin</span> <b>in</b> <span class="r26 r">asyncPageableResponse</span>)
                {
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Found digital twin &#39;</span>{<span class="r27 r">twin</span>.<a href="/Azure.DigitalTwins.Core/A.html#199d54fc6f73d7e8" class="i property">Id</a>}<span class="s">&#39;</span><span class="s">&quot;</span>);
                }
 
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:DigitalTwinsSampleQueryTwins
 
                <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">&quot;Making a twin query, with query-charge header extraction.&quot;</span>);
 
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DigitalTwinsSampleQueryTwinsWithQueryCharge
 
                <span class="c">// This code snippet demonstrates how you could extract the query charges incurred when calling</span>
                <span class="c">// the query API. It iterates over the response pages first to access to the query-charge header,</span>
                <span class="c">// and then the digital twin results within each page.</span>
 
                <span class="i">AsyncPageable</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt; <span id="r28 rd" class="r28 r">asyncPageableResponseWithCharge</span> = <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">QueryAsync</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt;(<span class="s">&quot;SELECT * FROM digitaltwins&quot;</span>);
                <b>int</b> <span id="r29 rd" class="r29 r">pageNum</span> = 0;
 
                <span class="c">// The &quot;await&quot; keyword here is required as a call is made when fetching a new page.</span>
                <b>await</b> <b>foreach</b> (<span class="i">Page</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a>&gt; <span id="r30 rd" class="r30 r">page</span> <b>in</b> <span class="r28 r">asyncPageableResponseWithCharge</span>.<span class="i">AsPages</span>())
                {
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Page </span>{++<span class="r29 r">pageNum</span>}<span class="s"> results:</span><span class="s">&quot;</span>);
 
                    <span class="c">// Extract the query-charge header from the page</span>
                    <b>if</b> (<a href="/Azure.DigitalTwins.Core/A.html#ada8c70e340f3bde" class="t t">QueryChargeHelper</a>.<span class="i">TryGetQueryCharge</span>(<span class="r30 r">page</span>, <b>out float</b> <span id="r31 rd" class="r31 r">queryCharge</span>))
                    {
                        <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Query charge was: </span>{<span class="r31 r">queryCharge</span>}<span class="s">&quot;</span>);
                    }
 
                    <span class="c">// Iterate over the twin instances.</span>
                    <span class="c">// The &quot;await&quot; keyword is not required here as the paged response is local.</span>
                    <b>foreach</b> (<a href="/Azure.DigitalTwins.Core/A.html#07d0c906ce4797e6" class="t t">BasicDigitalTwin</a> <span id="r32 rd" class="r32 r">twin</span> <b>in</b> <span class="r30 r">page</span>.<span class="i">Values</span>)
                    {
                        <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Found digital twin &#39;</span>{<span class="r32 r">twin</span>.<a href="/Azure.DigitalTwins.Core/A.html#199d54fc6f73d7e8" class="i property">Id</a>}<span class="s">&#39;</span><span class="s">&quot;</span>);
                    }
                }
 
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:DigitalTwinsSampleQueryTwinsWithQueryCharge
            }
            <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r33 rd" class="r33 r">ex</span>)
            {
                <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Could not query digital twins due to </span>{<span class="r33 r">ex</span>}<span class="s">&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates all the relationships defined in the \DTDL\Relationships directory</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a700315105b37156" href="R/a700315105b37156.html" target="n" data-glyph="72,1" class="i method">ConnectTwinsTogetherAsync</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;CONNECT DIGITAL TWINS&quot;</span>);
 
            <span class="c">// First we load the relationships into memory</span>
            <span class="t t">Dictionary</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r34 rd" class="r34 r">allRelationships</span> = <a href="FileHelper.cs.html#a33a5c6888a28b8b" class="t t">FileHelper</a>.<a href="FileHelper.cs.html#badf49d93bddab9d" class="i method">LoadAllFilesInPath</a>(<a href="#749426857ed5bc5e" class="i field">s_relationshipsPath</a>);
 
            <b>foreach</b> (<a href="@1@System.Runtime/A.html#8585965bb176a426" class="t t">KeyValuePair</a>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r35 rd" class="r35 r">relationshipSet</span> <b>in</b> <span class="r34 r">allRelationships</span>)
            {
                <span class="c">// For each relationship array we deserialize it first</span>
                <span class="c">// We deserialize as BasicRelationship to get the entire custom relationship (custom relationship properties).</span>
                <a href="@1@System.Runtime/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a>&gt; <span id="r36 rd" class="r36 r">relationships</span> = <span class="t t">JsonSerializer</span>.<span class="i method">Deserialize</span>&lt;<a href="@1@System.Runtime/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a>&gt;&gt;(<span class="r35 r">relationshipSet</span>.<a href="@1@System.Runtime/A.html#38c0e86cc4b30170" class="i property">Value</a>);
 
                <span class="c">// From loaded relationships, get the source Id and Id from each one,</span>
                <span class="c">// and create it with full relationship payload</span>
                <b>foreach</b> (<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a> <span id="r37 rd" class="r37 r">relationship</span> <b>in</b> <span class="r36 r">relationships</span>)
                {
                    <b>try</b>
                    {
                        <span class="i">Response</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a>&gt; <span id="r38 rd" class="r38 r">createRelationshipResponse</span> = <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">CreateOrReplaceRelationshipAsync</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#6b8404bd205cf363" class="t t">BasicRelationship</a>&gt;(
                            <span class="r37 r">relationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#0b4d07667504b576" class="i property">SourceId</a>,
                            <span class="r37 r">relationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#38c8bf5fb27ad419" class="i property">Id</a>,
                            <span class="r37 r">relationship</span>);
 
                        <span class="t t">Console</span>.<span class="i">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Linked twin &#39;</span>{<span class="r38 r">createRelationshipResponse</span>.<span class="i">Value</span>.<span class="i">SourceId</span>}<span class="s">&#39; to twin </span><span class="s">&quot;</span> +
                            <span class="s">$&quot;</span><span class="s">&#39;</span>{<span class="r38 r">createRelationshipResponse</span>.<span class="i">Value</span>.<span class="i">TargetId</span>}<span class="s">&#39; as &#39;</span>{<span class="r38 r">createRelationshipResponse</span>.<span class="i">Value</span>.<span class="i">Name</span>}<span class="s">&#39;</span><span class="s">&quot;</span>);
                    }
                    <b>catch</b> (<span class="i">RequestFailedException</span> <span id="r39 rd" class="r39 r">ex</span>) <b>when</b> (<span class="r39 r">ex</span>.<span class="i">Status</span> == (<b>int</b>)<span class="t t">HttpStatusCode</span>.<span class="i field">Conflict</span>)
                    {
                        <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Relationship &#39;</span>{<span class="r37 r">relationship</span>.<a href="/Azure.DigitalTwins.Core/A.html#38c8bf5fb27ad419" class="i property">Id</a>}<span class="s">&#39; already exists: </span>{<span class="r39 r">ex</span>.<span class="i">Message</span>}<span class="s">&quot;</span>);
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets all event routes for digital Twin</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="928b165ce03c142c" href="R/928b165ce03c142c.html" target="n" data-glyph="72,1" class="i method">GetEventRoutes</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;LISTING EVENT ROUTES&quot;</span>);
            <b>try</b>
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DigitalTwinsSampleGetEventRoutes
 
                <span class="i">AsyncPageable</span>&lt;<a href="/Azure.DigitalTwins.Core/A.html#970148199036ee09" class="t t">DigitalTwinsEventRoute</a>&gt; <span id="r40 rd" class="r40 r">response</span> = <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">GetEventRoutesAsync</span>();
                <b>await</b> <b>foreach</b> (<a href="/Azure.DigitalTwins.Core/A.html#970148199036ee09" class="t t">DigitalTwinsEventRoute</a> <span id="r41 rd" class="r41 r">er</span> <b>in</b> <span class="r40 r">response</span>)
                {
                    <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Event route &#39;</span>{<span class="r41 r">er</span>.<a href="/Azure.DigitalTwins.Core/A.html#e855f511a853b254" class="i property">Id</a>}<span class="s">&#39;, endpoint name &#39;</span>{<span class="r41 r">er</span>.<a href="/Azure.DigitalTwins.Core/A.html#b69913d6611bf644" class="i property">EndpointName</a>}<span class="s">&#39;</span><span class="s">&quot;</span>);
                }
 
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:DigitalTwinsSampleGetEventRoutes
            }
            <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r42 rd" class="r42 r">ex</span>)
            {
                <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Could not get event routes due to </span>{<span class="r42 r">ex</span>.<a href="@1@System.Runtime/A.html#5fba0e16215b42a3" class="i property">Message</a>}<span class="s">&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates event route for digital Twin</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c8bf9c6fd94bc4f7" href="R/c8bf9c6fd94bc4f7.html" target="n" data-glyph="72,1" class="i method">CreateEventRoute</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;CREATE EVENT ROUTE&quot;</span>);
            <b>try</b>
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DigitalTwinsSampleCreateEventRoute
 
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r43 rd" class="r43 r">eventFilter</span> = <span class="s">&quot;$eventType = &#39;DigitalTwinTelemetryMessages&#39; or $eventType = &#39;DigitalTwinLifecycleNotification&#39;&quot;</span>;
                <a href="/Azure.DigitalTwins.Core/A.html#970148199036ee09" class="k">var</a> <span id="r44 rd" class="r44 r">eventRoute</span> = <b>new</b> <span class="t">DigitalTwinsEventRoute</span>(<a href="#d246fbb004230417" class="i field">eventhubEndpointName</a>, <span class="r43 r">eventFilter</span>);
 
                <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">CreateOrReplaceEventRouteAsync</span>(<a href="#bef66643d41f47fd" class="i field">_eventRouteId</a>, <span class="r44 r">eventRoute</span>);
                <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Created event route &#39;</span>{<a href="#bef66643d41f47fd" class="i field">_eventRouteId</a>}<span class="s">&#39;.</span><span class="s">&quot;</span>);
 
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:DigitalTwinsSampleCreateEventRoute
            }
            <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r45 rd" class="r45 r">ex</span>)
            {
                <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">CreateEventRoute: Failed to create event route due to: </span>{<span class="r45 r">ex</span>.<a href="@1@System.Runtime/A.html#5fba0e16215b42a3" class="i property">Message</a>}<span class="s">&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deletes event route for digital Twin</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="4257520fb160b61a" href="R/4257520fb160b61a.html" target="n" data-glyph="72,1" class="i method">DeleteEventRoute</a>()
        {
            <a href="SampleLogger.cs.html#3542c4150d62a734" class="i method">PrintHeader</a>(<span class="s">&quot;DELETING EVENT ROUTE&quot;</span>);
            <b>try</b>
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DigitalTwinsSampleDeleteEventRoute
 
                <b>await</b> <a href="#93ad873cb19985bb" class="i field">client</a>.<span class="i">DeleteEventRouteAsync</span>(<a href="#bef66643d41f47fd" class="i field">_eventRouteId</a>);
                <span class="t t">Console</span>.<span class="i method">WriteLine</span>(<span class="s">$&quot;</span><span class="s">Deleted event route &#39;</span>{<a href="#bef66643d41f47fd" class="i field">_eventRouteId</a>}<span class="s">&#39;.</span><span class="s">&quot;</span>);
 
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:DigitalTwinsSampleDeleteEventRoute
            }
            <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r46 rd" class="r46 r">ex</span>)
            {
                <a href="SampleLogger.cs.html#ec71047b447122fa" class="i method">FatalError</a>(<span class="s">$&quot;</span><span class="s">Could not delete event routes due to: </span>{<span class="r46 r">ex</span>.<a href="@1@System.Runtime/A.html#5fba0e16215b42a3" class="i property">Message</a>}<span class="s">&quot;</span>);
            }
        }
 
        <b>private static string</b> <a id="dd2d9fc4c9bfbfc5" href="R/dd2d9fc4c9bfbfc5.html" target="n" data-glyph="76,1" class="i method">GetWorkingDirectory</a>()
        {
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r47 rd" class="r47 r">codeBase</span> = <a href="@1@System.Runtime/A.html#73b5be5e9c2474b2" class="t t">Assembly</a>.<a href="@1@System.Runtime/A.html#bd671af9926207e9" class="i method">GetExecutingAssembly</a>().<a href="@1@System.Runtime/A.html#27921a7f21bb91e0" class="i property">CodeBase</a>;
            <b>var</b> <span id="r48 rd" class="r48 r">uri</span> = <b>new</b> <span class="t constructor">UriBuilder</span>(<span class="r47 r">codeBase</span>);
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r49 rd" class="r49 r">path</span> = <a href="@1@System.Runtime/A.html#991565dd25f47c90" class="t t">Uri</a>.<a href="@1@System.Runtime/A.html#9e681434ccd4ea05" class="i method">UnescapeDataString</a>(<span class="r48 r">uri</span>.<span class="i property">Path</span>);
            <b>return</b> <span class="t t">Path</span>.<span class="i method">GetDirectoryName</span>(<span class="r49 r">path</span>);
        }
    }
}
</pre></td></tr></table></div></body></html>
