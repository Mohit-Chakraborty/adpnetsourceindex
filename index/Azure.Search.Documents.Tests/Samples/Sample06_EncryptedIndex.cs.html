<!DOCTYPE html>
<html><head><title>Sample06_EncryptedIndex.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(178);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Search.Documents.Tests/Samples/Sample06_EncryptedIndex.cs" target="_top">Samples\Sample06_EncryptedIndex.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Search.Documents.Tests" target="_top">Azure.Search.Documents.Tests.csproj</a> (Azure.Search.Documents.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Search</span>.<span class="i n">Documents</span>.<span class="i n">Indexes</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Search</span>.<span class="i n">Documents</span>.<span class="i n">Indexes</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Search</span>.<span class="i n">Documents</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Security</span>.<span class="i n">KeyVault</span>.<span class="i n">Keys</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">SA1402</span> <span class="c">// File may only contain a single type</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">SA1649</span> <span class="c">// File name should match first type name</span>
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Search</span>.<span class="i n">Documents</span>.<span class="i n">Tests</span>.<span class="i n">Samples</span>
{
    <b>public class</b> <a id="dbc1a4b4ef9cbb2f" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">EncryptedIndex</a> : <a href="../Utilities/SearchTestBase.cs.html#26e65f5e616a8732" class="t t">SearchTestBase</a>
    {
        <b>public</b> <a id="4a24ce7398f86db1" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">EncryptedIndex</a>(<b>bool</b> <span id="r0 rd" class="r0 r">async</span>, <a href="/Azure.Search.Documents/A.html#b9c00cf06282d775" class="t t">SearchClientOptions</a>.<a href="/Azure.Search.Documents/A.html#7008cc2f4ab0b566" class="t t">ServiceVersion</a> <span id="r1 rd" class="r1 r">serviceVersion</span>)
            : <a href="../Utilities/SearchTestBase.cs.html#7f958a3cf58bf75d" class="k">base</a>(<span class="r0 r">async</span>, <span class="r1 r">serviceVersion</span>, <b>null</b> <span class="c">/* RecordedTestMode.Record /* to re-record */</span>)
        {
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#d8e3fad5782f7ada" class="t constructor">SyncOnly</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="af284e06226bf49c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateDoubleEncryptedIndex</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">keyVaultUrl</span> = <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="../Utilities/SearchTestEnvironment.cs.html#3b1da6e210f547ce" class="i property">KeyVaultUrl</a>;
            <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r2 r">keyVaultUrl</span>))
            {
                <span class="t t">Assert</span>.<span class="i method">Ignore</span>(<span class="s">&quot;A Key Vault was not deployed&quot;</span>);
            }
 
            <span class="c">// Create the key and persist the name and version.</span>
            <a href="/Azure.Security.KeyVault.Keys/A.html#a7c89d0da669bf6c" class="t t">KeyVaultKey</a> <span id="r3 rd" class="r3 r">key</span> = <b>await</b> <a href="#189c480fa6ed1249" class="i method">CreateEncryptionKey</a>(<span class="r2 r">keyVaultUrl</span>);
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;KEYVAULT_URL&quot;</span>, <span class="r2 r">keyVaultUrl</span>);
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;KEYVAULT_KEY_NAME&quot;</span>, <span class="r3 r">key</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#cc2e71497ac8b8be" class="i property">Name</a>);
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;KEYVAULT_KEY_VERSION&quot;</span>, <span class="r3 r">key</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#c70705a422bb64d3" class="i property">Properties</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#d18d0586e2acd93a" class="i property">Version</a>);
 
            <span class="c">// Persist the service principal.</span>
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;APPLICATION_ID&quot;</span>, <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="/Azure.Core.TestFramework/A.html#50081c441f6f88a4" class="i property">ClientId</a>);
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;APPLICATION_SECRET&quot;</span>, <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="../Utilities/SearchTestEnvironment.cs.html#2cf278d5c35e8fb5" class="i property">RecordedClientSecret</a>);
 
            <span class="c">// Create the blob container and persist connection information.</span>
            <b>await using</b> <a href="../P/b3fb40182671ea0a.html#b3fb40182671ea0a" class="t t">SearchResources</a> <span id="r4 rd" class="r4 r">resources</span> = <b>await</b> <a href="../P/b3fb40182671ea0a.html#b3fb40182671ea0a" class="t t">SearchResources</a>.<a href="../Utilities/SearchResources.cs.html#8d8312667fdc60d2" class="i method">CreateWithBlobStorageAndIndexAsync</a>(<a href="#dbc1a4b4ef9cbb2f" class="k">this</a>, <span class="r5 r">populate</span>: <b>true</b>);
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;STORAGE_CONNECTION_STRING&quot;</span>, <span class="r4 r">resources</span>.<a href="../Utilities/SearchResources.cs.html#799f11dd63580561" class="i property">StorageAccountConnectionString</a>);
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;STORAGE_CONTAINER_NAME&quot;</span>, <span class="r4 r">resources</span>.<a href="../Utilities/SearchResources.cs.html#0b7cada889ca549c" class="i property">BlobContainerName</a>);
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;SEARCH_ENDPOINT&quot;</span>, <span class="r4 r">resources</span>.<a href="../Utilities/SearchResources.cs.html#284d4899a7a27f74" class="i property">Endpoint</a>.<a href="@0@System/A.html#bf3caa11ab73e433" class="i method">ToString</a>());
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<span class="s">&quot;SEARCH_API_KEY&quot;</span>, <span class="r4 r">resources</span>.<a href="../Utilities/SearchResources.cs.html#4c4d44d32b60c7e7" class="i property">PrimaryApiKey</a>);
 
            <span class="c">// Define clean up tasks to be invoked in reverse order added.</span>
            <a href="@0@System/A.html#c5371bef044c6ab6" class="t t">Stack</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt;&gt; <span id="r6 rd" class="r6 r">cleanUpTasks</span> = <b>new</b> <a href="@0@System/A.html#692a18e31afb7ef9" class="t constructor">Stack</a>&lt;<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt;&gt;();
            <b>try</b>
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Search_Tests_Sample06_EncryptedIndex_CreateDoubleEncryptedIndex_Index
                <span class="c">// Create a credential to connect to Key Vault and use a specific key version created previously.</span>
                <a href="/Azure.Search.Documents/A.html#1e903a3fb406df3f" class="t t">SearchResourceEncryptionKey</a> <span id="r7 rd" class="r7 r">encryptionKey</span> = <b>new</b> <a href="/Azure.Search.Documents/A.html#978c317f3def32d7" class="t constructor">SearchResourceEncryptionKey</a>(
                    <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;KEYVAULT_URL&quot;</span>)),
                    <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;KEYVAULT_KEY_NAME&quot;</span>),
                    <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;KEYVAULT_KEY_VERSION&quot;</span>))
                {
                    <a href="/Azure.Search.Documents/A.html#aa052af9cbf4c1b8" class="i property">ApplicationId</a> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;APPLICATION_ID&quot;</span>),
                    <a href="/Azure.Search.Documents/A.html#7551d4b42b7751ef" class="i property">ApplicationSecret</a> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;APPLICATION_SECRET&quot;</span>),
                };
 
                <span class="c">// Create a connection to our storage blob container using the credential.</span>
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">dataSourceConnectionName</span> = <span class="s">&quot;hotels-data-source&quot;</span>;
                <span class="c">/*@@*/</span> <span class="r8 r">dataSourceConnectionName</span> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#b9828ff8817e7824" class="i property">Random</a>.<a href="../Utilities/TestExtensions.cs.html#3a8107aee82d17c9" class="i method">GetName</a>();
                <a href="/Azure.Search.Documents/A.html#82a961af1b1759b4" class="t t">SearchIndexerDataSourceConnection</a> <span id="r9 rd" class="r9 r">dataSourceConnection</span> = <b>new</b> <a href="/Azure.Search.Documents/A.html#e6fe68dceec74584" class="t constructor">SearchIndexerDataSourceConnection</a>(
                    <span class="r8 r">dataSourceConnectionName</span>,
                    <a href="/Azure.Search.Documents/A.html#2043d19543ba09a6" class="t t">SearchIndexerDataSourceType</a>.<a href="/Azure.Search.Documents/A.html#90b1775fc8432bdf" class="i property">AzureBlob</a>,
                    <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;STORAGE_CONNECTION_STRING&quot;</span>),
                    <b>new</b> <a href="/Azure.Search.Documents/A.html#37532d4ffe06c62e" class="t constructor">SearchIndexerDataContainer</a>(
                        <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;STORAGE_CONTAINER_NAME&quot;</span>)
                    )
                )
                {
                    <a href="/Azure.Search.Documents/A.html#71e26df77c50fdc4" class="i property">EncryptionKey</a> = <span class="r7 r">encryptionKey</span>
                };
 
                <span class="c">// Create an indexer to process documents from the blob container into the index.</span>
                <span class="c">// You can optionally configure a skillset to use cognitive services when processing documents.</span>
                <span class="c">// Set the SearchIndexerSkillset.EncryptionKey to the same credential if you use a skillset.</span>
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">indexName</span> = <span class="s">&quot;hotels&quot;</span>;
                <span class="c">/*@@*/</span> <span class="r10 r">indexName</span> = <span class="r4 r">resources</span>.<a href="../Utilities/SearchResources.cs.html#f6a1ff138f46d373" class="i property">IndexName</a>;
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">indexerName</span> = <span class="s">&quot;hotels-indexer&quot;</span>;
                <span class="c">/*@@*/</span> <span class="r11 r">indexerName</span> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#b9828ff8817e7824" class="i property">Random</a>.<a href="../Utilities/TestExtensions.cs.html#3a8107aee82d17c9" class="i method">GetName</a>();
                <a href="/Azure.Search.Documents/A.html#bb20943348ed8457" class="t t">SearchIndexer</a> <span id="r12 rd" class="r12 r">indexer</span> = <b>new</b> <a href="/Azure.Search.Documents/A.html#d9ebb91e63dc2ef0" class="t constructor">SearchIndexer</a>(
                    <span class="r11 r">indexerName</span>,
                    <span class="r8 r">dataSourceConnectionName</span>,
                    <span class="r10 r">indexName</span>)
                {
                    <a href="/Azure.Search.Documents/A.html#87f5e52eb81dc648" class="i property">EncryptionKey</a> = <span class="r7 r">encryptionKey</span>,
 
                    <span class="c">// Map the fields in our documents we want to index.</span>
                    <a href="/Azure.Search.Documents/A.html#af339d7b5e118187" class="i property">FieldMappings</a> =
                    {
                        <b>new</b> <a href="/Azure.Search.Documents/A.html#1d4d6fe20840816f" class="t constructor">FieldMapping</a>(<span class="s">&quot;hotelId&quot;</span>),
                        <b>new</b> <a href="/Azure.Search.Documents/A.html#1d4d6fe20840816f" class="t constructor">FieldMapping</a>(<span class="s">&quot;hotelName&quot;</span>),
                        <b>new</b> <a href="/Azure.Search.Documents/A.html#1d4d6fe20840816f" class="t constructor">FieldMapping</a>(<span class="s">&quot;description&quot;</span>),
                        <b>new</b> <a href="/Azure.Search.Documents/A.html#1d4d6fe20840816f" class="t constructor">FieldMapping</a>(<span class="s">&quot;tags&quot;</span>),
                        <b>new</b> <a href="/Azure.Search.Documents/A.html#1d4d6fe20840816f" class="t constructor">FieldMapping</a>(<span class="s">&quot;address&quot;</span>)
                    },
                    <a href="/Azure.Search.Documents/A.html#aac9315eaf58e485" class="i property">Parameters</a> = <b>new</b> <a href="/Azure.Search.Documents/A.html#87ada08eb6da48d5" class="t constructor">IndexingParameters</a>
                    {
                        <span class="c">// Tell the indexer to parse each blob as a separate JSON document.</span>
                        <a href="/Azure.Search.Documents/A.html#752c4b6d754c8c78" class="i property">IndexingParametersConfiguration</a> = <b>new</b> <a href="/Azure.Search.Documents/A.html#b131c9ede6aa80a5" class="t constructor">IndexingParametersConfiguration</a>
                        {
                            <a href="/Azure.Search.Documents/A.html#7dc43da727499eeb" class="i property">ParsingMode</a> = <a href="/Azure.Search.Documents/A.html#f6eea7380786573b" class="t t">BlobIndexerParsingMode</a>.<a href="/Azure.Search.Documents/A.html#3b039613b0683bff" class="i property">Json</a>
                        }
                    }
                };
 
                <span class="c">// Now connect to our Search service and set up the data source and indexer.</span>
                <span class="c">// Documents already in the storage blob will begin indexing immediately.</span>
                <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r13 rd" class="r13 r">endpoint</span> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;SEARCH_ENDPOINT&quot;</span>));
                <a href="/Azure.Core/A.html#9f81356c54b28bf8" class="t t">AzureKeyCredential</a> <span id="r14 rd" class="r14 r">credential</span> = <b>new</b> <a href="/Azure.Core/A.html#015df0c4993644fe" class="t constructor">AzureKeyCredential</a>(
                    <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;SEARCH_API_KEY&quot;</span>));
 
                <a href="/Azure.Search.Documents/A.html#b83292fff0406ffc" class="t t">SearchIndexerClient</a> <span id="r15 rd" class="r15 r">indexerClient</span> = <b>new</b> <a href="/Azure.Search.Documents/A.html#a060734cf4cd65ff" class="t constructor">SearchIndexerClient</a>(<span class="r13 r">endpoint</span>, <span class="r14 r">credential</span>);
                <span class="c">/*@@*/</span> <span class="r15 r">indexerClient</span> = <span class="r4 r">resources</span>.<a href="../Utilities/SearchResources.cs.html#f15e185dd03115fc" class="i method">GetIndexerClient</a>();
                <span class="r15 r">indexerClient</span>.<a href="/Azure.Search.Documents/A.html#151ee7670d4f3923" class="i method">CreateDataSourceConnection</a>(<span class="r9 r">dataSourceConnection</span>);
                <span class="c">/*@@*/</span> <span class="r6 r">cleanUpTasks</span>.<a href="@0@System/A.html#83b1a3864aaa7198" class="i method">Push</a>(() =&gt; <span class="r15 r">indexerClient</span>.<a href="/Azure.Search.Documents/A.html#6190a1f9093257cb" class="i method">DeleteDataSourceConnectionAsync</a>(<span class="r8 r">dataSourceConnectionName</span>));
                <span class="r15 r">indexerClient</span>.<a href="/Azure.Search.Documents/A.html#85a746e7ec972d6d" class="i method">CreateIndexer</a>(<span class="r12 r">indexer</span>);
                <span class="c">/*@@*/</span> <span class="r6 r">cleanUpTasks</span>.<a href="@0@System/A.html#83b1a3864aaa7198" class="i method">Push</a>(() =&gt; <span class="r15 r">indexerClient</span>.<a href="/Azure.Search.Documents/A.html#4cdee5ebae4d79e7" class="i method">DeleteIndexerAsync</a>(<span class="r11 r">indexerName</span>));
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Search_Tests_Sample06_EncryptedIndex_CreateDoubleEncryptedIndex_Index
 
                <b>await</b> <a href="../Utilities/SearchTestBase.cs.html#46ae9641ba3fd163" class="i method">WaitForIndexingAsync</a>(<span class="r15 r">indexerClient</span>, <span class="r11 r">indexerName</span>);
 
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Search_Tests_Sample06_EncryptedIndex_CreateDoubleEncryptedIndex_Query
                <span class="c">// Create a SearchClient and search for luxury hotels. In production, be sure to use the query key.</span>
                <a href="/Azure.Search.Documents/A.html#4a8a1a9e2cf03b3c" class="t t">SearchClient</a> <span id="r16 rd" class="r16 r">searchClient</span> = <b>new</b> <a href="/Azure.Search.Documents/A.html#c6d93fa3b249494d" class="t constructor">SearchClient</a>(<span class="r13 r">endpoint</span>, <span class="s">&quot;hotels&quot;</span>, <span class="r14 r">credential</span>);
                <span class="c">/*@@*/</span> <span class="r16 r">searchClient</span> = <span class="r4 r">resources</span>.<a href="../Utilities/SearchResources.cs.html#d4f2d9ebb83b1397" class="i method">GetSearchClient</a>();
                <span class="c">/*@@*/</span> <b>bool</b> <span id="r17 rd" class="r17 r">found</span> = <b>false</b>;
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Search.Documents/A.html#9bf36d1f7f5aca11" class="t t">SearchResults</a>&lt;<a href="../Utilities/SearchResources.Data.cs.html#e793040a76751146" class="t t">Hotel</a>&gt;&gt; <span id="r18 rd" class="r18 r">results</span> = <span class="r16 r">searchClient</span>.<a href="/Azure.Search.Documents/A.html#43efa36d1f95683a" class="i method">Search</a>&lt;<a href="../Utilities/SearchResources.Data.cs.html#e793040a76751146" class="t t">Hotel</a>&gt;(<span class="s">&quot;luxury hotels&quot;</span>);
                <b>foreach</b> (<a href="/Azure.Search.Documents/A.html#f5a28d72ded2c104" class="t t">SearchResult</a>&lt;<a href="../Utilities/SearchResources.Data.cs.html#e793040a76751146" class="t t">Hotel</a>&gt; <span id="r19 rd" class="r19 r">result</span> <b>in</b> <span class="r18 r">results</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Search.Documents/A.html#9242d6eb355dbb3f" class="i method">GetResults</a>())
                {
                    <a href="../Utilities/SearchResources.Data.cs.html#e793040a76751146" class="t t">Hotel</a> <span id="r20 rd" class="r20 r">hotel</span> = <span class="r19 r">result</span>.<a href="/Azure.Search.Documents/A.html#77efd1cd279c34f9" class="i property">Document</a>;
                    <span class="c">/*@@*/</span> <span class="r17 r">found</span> = <b>true</b>;
 
                    <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">$&quot;</span>{<span class="r20 r">hotel</span>.<a href="../Utilities/SearchResources.Data.cs.html#d798645db4588f34" class="i property">HotelName</a>}<span class="s"> (</span>{<span class="r20 r">hotel</span>.<a href="../Utilities/SearchResources.Data.cs.html#299bbe8bdd362511" class="i property">HotelId</a>}<span class="s">)</span><span class="s">&quot;</span>);
                    <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">  Description: </span>{<span class="r20 r">hotel</span>.<a href="../Utilities/SearchResources.Data.cs.html#d544b9a63ac3e8ed" class="i property">Description</a>}<span class="s">&quot;</span>);
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Search_Tests_Sample06_EncryptedIndex_CreateDoubleEncryptedIndex_Query
 
                <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r17 r">found</span>, <span class="s">&quot;No luxury hotels were found in index&quot;</span>);
            }
            <b>finally</b>
            {
                <span class="c">// We want to await these individual to create a deterministic order for playing back tests.</span>
                <b>foreach</b> (<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt; <span id="r21 rd" class="r21 r">cleanUpTask</span> <b>in</b> <span class="r6 r">cleanUpTasks</span>)
                {
                    <b>await</b> <span class="r21 r">cleanUpTask</span>();
                }
            }
        }
 
        <b>private async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Azure.Security.KeyVault.Keys/A.html#a7c89d0da669bf6c" class="t t">KeyVaultKey</a>&gt; <a id="189c480fa6ed1249" href="../R/189c480fa6ed1249.html" target="n" data-glyph="76,1" class="i method">CreateEncryptionKey</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r22 rd" class="r22 r">keyVaultUrl</span>) =&gt;
            <b>await</b> <a href="/Azure.Core.TestFramework/A.html#77de7f6db4322998" class="i method">CreateClient</a>&lt;<a href="/Azure.Security.KeyVault.Keys/A.html#ad1f454789f5c02e" class="t t">KeyClient</a>&gt;(
                <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r22 r">keyVaultUrl</span>),
                <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="/Azure.Core.TestFramework/A.html#7a52cec375a4970c" class="i property">Credential</a>,
                <span class="c">// Pin the service version to mitigate ProjectReference-based pipelines from failing playback with newer versions.</span>
                <a href="/Azure.Core.TestFramework/A.html#53f8a36b77464500" class="i method">InstrumentClientOptions</a>&lt;<a href="/Azure.Security.KeyVault.Keys/A.html#76a904978eb605a1" class="t t">KeyClientOptions</a>&gt;(<b>new</b> <a href="/Azure.Security.KeyVault.Keys/A.html#e77906dbb8821425" class="t constructor">KeyClientOptions</a>(<a href="/Azure.Security.KeyVault.Keys/A.html#76a904978eb605a1" class="t t">KeyClientOptions</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#658f9853cdaaa7c8" class="t t">ServiceVersion</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#109a2e0af0638ea0" class="i field">V7_0</a>)))
                .<a href="/Azure.Security.KeyVault.Keys/A.html#da99c84f617dd5de" class="i method">CreateRsaKeyAsync</a>(
                    <b>new</b> <a href="/Azure.Security.KeyVault.Keys/A.html#5662967a66c9c6c0" class="t constructor">CreateRsaKeyOptions</a>(<a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#b9828ff8817e7824" class="i property">Random</a>.<a href="../Utilities/TestExtensions.cs.html#3a8107aee82d17c9" class="i method">GetName</a>())
                    {
                        <a href="/Azure.Security.KeyVault.Keys/A.html#940f85c8c5ccaee9" class="i property">KeySize</a> = 2048,
                        <a href="/Azure.Security.KeyVault.Keys/A.html#6713b536cb167200" class="i property">KeyOperations</a> =
                        {
                            <a href="/Azure.Security.KeyVault.Keys/A.html#bb3f9bfb63445a8f" class="t t">KeyOperation</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#e23559279de4f5b6" class="i property">WrapKey</a>,
                            <a href="/Azure.Security.KeyVault.Keys/A.html#bb3f9bfb63445a8f" class="t t">KeyOperation</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#b1fa0b5c661cacba" class="i property">UnwrapKey</a>,
                        },
                    });
    }
}
</pre></td></tr></table></div></body></html>
