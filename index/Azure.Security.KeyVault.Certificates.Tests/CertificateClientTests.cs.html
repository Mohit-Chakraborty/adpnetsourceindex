<!DOCTYPE html>
<html><head><title>CertificateClientTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(224);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Security.KeyVault.Certificates.Tests/CertificateClientTests.cs" target="_top">CertificateClientTests.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Security.KeyVault.Certificates.Tests" target="_top">Azure.Security.KeyVault.Certificates\tests\Azure.Security.KeyVault.Certificates.Tests.csproj</a> (Azure.Security.KeyVault.Certificates.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i">Identity</span>;
<b>using</b> <span class="i">NUnit</span>.<span class="i">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Security</span>.<span class="i n">KeyVault</span>.<span class="i n">Certificates</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="696f539474876f6b" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">CertificateClientTests</a> : <a href="/Azure.Core.TestFramework/A.html#3fc3fa6031b8ce5e" class="t t">ClientTestBase</a>
    {
        <b>public</b> <a id="a7443c058f79dab2" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">CertificateClientTests</a>(<b>bool</b> <span id="r0 rd" class="r0 r">isAsync</span>) : <a href="/Azure.Core.TestFramework/A.html#c7659bbcafd87c98" class="k">base</a>(<span class="r0 r">isAsync</span>)
        {
            <a href="/Azure.Security.KeyVault.Certificates/A.html#762d0a9714ec1233" class="t t">CertificateClientOptions</a> <span id="r1 rd" class="r1 r">options</span> = <b>new</b> <span class="t">CertificateClientOptions</span>
            {
                <span class="i">Transport</span> = <b>new</b> <a href="/Azure.Core.TestFramework/A.html#641800b0364c2802" class="t constructor">MockTransport</a>(),
            };
 
            <a href="#41aae8092dba5e0c" class="i property">Client</a> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<b>new</b> <span class="t">CertificateClient</span>(<b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="s">&quot;http://localhost&quot;</span>), <b>new</b> <a href="/Azure.Core.TestFramework/A.html#f4b506dc54caf787" class="t constructor">MockCredential</a>(), <span class="r1 r">options</span>));
        }
 
        <b>public</b> <a href="/Azure.Security.KeyVault.Certificates/A.html#a66d1243f42a3d40" class="t t">CertificateClient</a> <a id="41aae8092dba5e0c" href="R/41aae8092dba5e0c.html" target="n" data-glyph="102,1" class="i property">Client</a> { <b>get</b>; }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="5a193228fe49c954" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateIssuerArgumentValidation</a>()
        {
            <a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a> <span id="r2 rd" class="r2 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">CreateIssuerAsync</span>(<b>null</b>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuer&quot;</span>, <span class="r2 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
 
            <a href="/Azure.Security.KeyVault.Certificates/A.html#9ab1bf85698766a3" class="t t">CertificateIssuer</a> <span id="r3 rd" class="r3 r">issuer</span> = <b>new</b> <span class="t">CertificateIssuer</span>();
            <span class="r2 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">CreateIssuerAsync</span>(<span class="r3 r">issuer</span>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuer&quot;</span>, <span class="r2 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
            <span class="i">StringAssert</span>.<span class="i">StartsWith</span>(<span class="s">&quot;issuer.Name cannot be null or an empty string.&quot;</span>, <span class="r2 r">ex</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
 
            <span class="r3 r">issuer</span> = <b>new</b> <span class="t">CertificateIssuer</span>(<span class="s">&quot;test&quot;</span>);
            <span class="r2 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">CreateIssuerAsync</span>(<span class="r3 r">issuer</span>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuer&quot;</span>, <span class="r2 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
            <span class="i">StringAssert</span>.<span class="i">StartsWith</span>(<span class="s">&quot;issuer.Provider cannot be null or an empty string.&quot;</span>, <span class="r2 r">ex</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="71bc341a57fa3e61" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetIssuerArgumentValidation</a>()
        {
            <a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a> <span id="r4 rd" class="r4 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">GetIssuerAsync</span>(<b>null</b>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuerName&quot;</span>, <span class="r4 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
 
            <span class="r4 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">GetIssuerAsync</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuerName&quot;</span>, <span class="r4 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
            <span class="i">StringAssert</span>.<span class="i">StartsWith</span>(<span class="s">&quot;Value cannot be an empty string.&quot;</span>, <span class="r4 r">ex</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="e079675252fe78fe" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">UpdateIssuerArgumentValidation</a>()
        {
            <a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a> <span id="r5 rd" class="r5 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">UpdateIssuerAsync</span>(<b>null</b>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuer&quot;</span>, <span class="r5 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
 
            <a href="/Azure.Security.KeyVault.Certificates/A.html#9ab1bf85698766a3" class="t t">CertificateIssuer</a> <span id="r6 rd" class="r6 r">issuer</span> = <b>new</b> <span class="t">CertificateIssuer</span>();
            <span class="r5 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">UpdateIssuerAsync</span>(<span class="r6 r">issuer</span>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuer&quot;</span>, <span class="r5 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
            <span class="i">StringAssert</span>.<span class="i">StartsWith</span>(<span class="s">&quot;issuer.Name cannot be null or an empty string.&quot;</span>, <span class="r5 r">ex</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="67e41523c91ac016" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DeleteIssuerArgumentValidation</a>()
        {
            <a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a> <span id="r7 rd" class="r7 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">DeleteIssuerAsync</span>(<b>null</b>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuerName&quot;</span>, <span class="r7 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
 
            <span class="r7 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">DeleteIssuerAsync</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;issuerName&quot;</span>, <span class="r7 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="c9e21d9c37435a4c" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetContactsArgumentValidation</a>()
        {
            <a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a> <span id="r8 rd" class="r8 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">SetContactsAsync</span>(<b>null</b>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;contacts&quot;</span>, <span class="r8 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="dc51d5dd70d93cbd" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetCertificatePolicyArgumentValidation</a>()
        {
            <a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a> <span id="r9 rd" class="r9 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">GetCertificatePolicyAsync</span>(<b>null</b>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;certificateName&quot;</span>, <span class="r9 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
 
            <span class="r9 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">GetCertificatePolicyAsync</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;certificateName&quot;</span>, <span class="r9 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
            <span class="i">StringAssert</span>.<span class="i">StartsWith</span>(<span class="s">&quot;Value cannot be an empty string.&quot;</span>, <span class="r9 r">ex</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="8e7d9b0a4b8ea02b" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">UpdateCertificatePolicyArgumentValidation</a>()
        {
            <a href="/Azure.Security.KeyVault.Certificates/A.html#264bed667bf8cf52" class="t t">CertificatePolicy</a> <span id="r10 rd" class="r10 r">policy</span> = <b>new</b> <span class="t">CertificatePolicy</span>(<a href="/Azure.Security.KeyVault.Certificates/A.html#25c9c8cda98b8df8" class="t t">WellKnownIssuerNames</a>.<a href="/Azure.Security.KeyVault.Certificates/A.html#845d41aff9d7f886" class="i field">Self</a>, <span class="s">&quot;CN=Azure SDK&quot;</span>);
 
            <a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a> <span id="r11 rd" class="r11 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">UpdateCertificatePolicyAsync</span>(<b>null</b>, <span class="r10 r">policy</span>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;certificateName&quot;</span>, <span class="r11 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
 
            <span class="r11 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">UpdateCertificatePolicyAsync</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <span class="r10 r">policy</span>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;certificateName&quot;</span>, <span class="r11 r">ex</span>.<a href="@0@mscorlib/A.html#46b34c4c8a7bbb2c" class="i property">ParamName</a>);
            <span class="i">StringAssert</span>.<span class="i">StartsWith</span>(<span class="s">&quot;Value cannot be an empty string.&quot;</span>, <span class="r11 r">ex</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>);
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="777abd43d44da739" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ChallengeBasedAuthenticationRequiresHttps</a>()
        {
            <span class="c">// After passing parameter validation, ChallengeBasedAuthenticationPolicy should throw for &quot;http&quot; requests.</span>
            <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<a href="@0@mscorlib/A.html#beac22dfca574cd4" class="t t">InvalidOperationException</a>&gt;(() =&gt; <a href="#41aae8092dba5e0c" class="i property">Client</a>.<span class="i">GetCertificateAsync</span>(<span class="s">&quot;test&quot;</span>));
        }
 
        [<span class="i">Test</span>]
        <b>public void</b> <a id="0eed098a8d4114e8" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadSecretDenied</a>()
        {
            <a href="/Azure.Security.KeyVault.Certificates/A.html#762d0a9714ec1233" class="t t">CertificateClientOptions</a> <span id="r12 rd" class="r12 r">options</span> = <b>new</b> <span class="t">CertificateClientOptions</span>
            {
                <span class="i">Transport</span> = <b>new</b> <span class="t">MockTransport</span>(<span id="r13 rd" class="r13 r">request</span> =&gt;
                {
                    <b>if</b> (<span class="r13 r">request</span>.<span class="i">Uri</span>.<span class="i">Path</span>.<span class="i">Contains</span>(<span class="s">&quot;/certificates/&quot;</span>))
                    {
                        <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r14 rd" class="r14 r">response</span> = <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2adc622c2950d8" class="t constructor">MockResponse</a>(200);
                        <span class="r14 r">response</span>.<span class="i">AddHeader</span>(<span class="i n">Core</span>.<span class="i">HttpHeader</span>.<span class="i">Common</span>.<span class="i">JsonContentType</span>);
 
                        <span class="r14 r">response</span>.<a href="/Azure.Core.TestFramework/A.html#2af07c9f6a842649" class="i method">SetContent</a>(<span class="s">@&quot;{
  &quot;&quot;id&quot;&quot;: &quot;&quot;https://heathskeyvault.vault.azure.net/certificates/1611349050/548e19c596cf49779ca1706240a788e3&quot;&quot;,
  &quot;&quot;kid&quot;&quot;: &quot;&quot;https://heathskeyvault.vault.azure.net/keys/1611349050/548e19c596cf49779ca1706240a788e3&quot;&quot;,
  &quot;&quot;sid&quot;&quot;: &quot;&quot;https://heathskeyvault.vault.azure.net/secrets/1611349050/548e19c596cf49779ca1706240a788e3&quot;&quot;,
  &quot;&quot;x5t&quot;&quot;: &quot;&quot;SM_LGoask0yHvMVSk3h-0Kf3gqE&quot;&quot;,
  &quot;&quot;cer&quot;&quot;: &quot;&quot;MIIDKjCCAhKgAwIBAgIQYV16SxDIQkKURxXo6sQkUTANBgkqhkiG9w0BAQsFADASMRAwDgYDVQQDEwdkZWZhdWx0MB4XDTIwMTExMDA0MjYxNloXDTIxMTExMDA0MzYxNlowEjEQMA4GA1UEAxMHZGVmYXVsdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALrumIRenUa5LmJsRurAhrRoJP0hyCg8jQz5ujXFoyf/flklfyqxnau5/a2yS4mnfJm9fX1aFF1/OdEg5qxcyHSBR66\u002BdPV27oxIfM6JKVqbHBcaG07OVFHh\u002B2yWBwTjAiPZjOxCxEMw37tdgDctnEBQzaTackhFU21seBWnHCC74mF2N3Iy93itptOguvwIh6CnLcduvIeb6o9lfr72XJg0BjJ/Bmpf92W5VwMWinHUumomCeLjA5lnIiOGGrmVNqaRJWf1ezhg3JtzNJRSV0sbLjHoCmziKAL4pFLEiF6tz\u002B6apvz1voDufit6r0gKwez8YaOnQjUAmXetoZmSOQkCAwEAAaN8MHowDgYDVR0PAQH/BAQDAgSQMAkGA1UdEwQCMAAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMB8GA1UdIwQYMBaAFNwU63f97Oel4UIAJt6/nQ9Ka12HMB0GA1UdDgQWBBTcFOt3/eznpeFCACbev50PSmtdhzANBgkqhkiG9w0BAQsFAAOCAQEAcs\u002B0b3\u002BUI0AmrvwQZVugfnbngNN5jDpuEyP8gms4Txpg93auVXgXlgiNsrKUgIi2U2CQLY6pdUUSilBHifCdxM3lxgB7wIkYc8ihu8eVBI7m4KNo1io0Jxwsw9KKG3612NUXuKDz8oHMUsJ49Iq8IaRaJdVpiydZCA9ltwhajWpgauOTMRsxtZdkG\u002BlakSCehBCgmjGR04NRG0jGNRaTh4ANHNQgFqP4Vp6mkzDxQu8B4PI5YKZfhpusqEDOSb5HeM8nwLYntNH32in1XKx3s5BSMUmbrdmeihAIyYxR3Imal5LwjckXvu6eXlRfe6BynbDW1g3IwNASMIwt3u0dhQ==&quot;&quot;,
  &quot;&quot;attributes&quot;&quot;: {
    &quot;&quot;enabled&quot;&quot;: true,
    &quot;&quot;nbf&quot;&quot;: 1604982376,
    &quot;&quot;exp&quot;&quot;: 1636518976,
    &quot;&quot;created&quot;&quot;: 1604982976,
    &quot;&quot;updated&quot;&quot;: 1604982976,
    &quot;&quot;recoveryLevel&quot;&quot;: &quot;&quot;Recoverable\u002BPurgeable&quot;&quot;,
    &quot;&quot;recoverableDays&quot;&quot;: 90
  },
  &quot;&quot;policy&quot;&quot;: {
    &quot;&quot;id&quot;&quot;: &quot;&quot;https://heathskeyvault.vault.azure.net/certificates/1611349050/policy&quot;&quot;,
    &quot;&quot;key_props&quot;&quot;: {
      &quot;&quot;exportable&quot;&quot;: true,
      &quot;&quot;kty&quot;&quot;: &quot;&quot;RSA&quot;&quot;,
      &quot;&quot;key_size&quot;&quot;: 2048,
      &quot;&quot;reuse_key&quot;&quot;: false
    },
    &quot;&quot;secret_props&quot;&quot;: {
      &quot;&quot;contentType&quot;&quot;: &quot;&quot;application/x-pkcs12&quot;&quot;
    },
    &quot;&quot;x509_props&quot;&quot;: {
      &quot;&quot;subject&quot;&quot;: &quot;&quot;CN=default&quot;&quot;,
      &quot;&quot;ekus&quot;&quot;: [
        &quot;&quot;1.3.6.1.5.5.7.3.1&quot;&quot;,
        &quot;&quot;1.3.6.1.5.5.7.3.2&quot;&quot;
      ],
      &quot;&quot;key_usage&quot;&quot;: [
        &quot;&quot;dataEncipherment&quot;&quot;,
        &quot;&quot;digitalSignature&quot;&quot;
      ],
      &quot;&quot;validity_months&quot;&quot;: 12,
      &quot;&quot;basic_constraints&quot;&quot;: {
        &quot;&quot;ca&quot;&quot;: false
      }
    },
    &quot;&quot;lifetime_actions&quot;&quot;: [
      {
        &quot;&quot;trigger&quot;&quot;: {
          &quot;&quot;lifetime_percentage&quot;&quot;: 80
        },
        &quot;&quot;action&quot;&quot;: {
          &quot;&quot;action_type&quot;&quot;: &quot;&quot;AutoRenew&quot;&quot;
        }
      }
    ],
    &quot;&quot;issuer&quot;&quot;: {
      &quot;&quot;name&quot;&quot;: &quot;&quot;Self&quot;&quot;,
      &quot;&quot;cert_transparency&quot;&quot;: false
    },
    &quot;&quot;attributes&quot;&quot;: {
      &quot;&quot;enabled&quot;&quot;: true,
      &quot;&quot;created&quot;&quot;: 1604982971,
      &quot;&quot;updated&quot;&quot;: 1604982971
    }
  },
  &quot;&quot;pending&quot;&quot;: {
    &quot;&quot;id&quot;&quot;: &quot;&quot;https://heathskeyvault.vault.azure.net/certificates/1611349050/pending&quot;&quot;
  }
}&quot;</span>);
                        <b>return</b> <span class="r14 r">response</span>;
                    }
                    <b>else</b> <b>if</b> (<span class="r13 r">request</span>.<span class="i">Uri</span>.<span class="i">Path</span>.<span class="i">StartsWith</span>(<span class="s">&quot;/secrets/1611349050/548e19c596cf49779ca1706240a788e3&quot;</span>))
                    {
                        <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r15 rd" class="r15 r">response</span> = <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2adc622c2950d8" class="t constructor">MockResponse</a>(403);
                        <span class="r15 r">response</span>.<span class="i">AddHeader</span>(<span class="i n">Core</span>.<span class="i">HttpHeader</span>.<span class="i">Common</span>.<span class="i">JsonContentType</span>);
 
                        <span class="r15 r">response</span>.<a href="/Azure.Core.TestFramework/A.html#2af07c9f6a842649" class="i method">SetContent</a>(<span class="s">@&quot;{
  &quot;&quot;error&quot;&quot;: {
    &quot;&quot;code&quot;&quot;: &quot;&quot;Forbidden&quot;&quot;,
    &quot;&quot;message&quot;&quot;: &quot;&quot;The user, group or application &#39;appid=f9ab11db-b032-44b3-af0a-44713541cc40;oid=0aa95430-9a7f-4c8e-8cf6-579278e68947;iss=https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/&#39; does not have secrets get permission on key vault &#39;heathskeyvault;location=westus2&#39;. For help resolving this issue, please see https://go.microsoft.com/fwlink/?linkid=2125287&quot;&quot;,
    &quot;&quot;innererror&quot;&quot;: {
      &quot;&quot;code&quot;&quot;: &quot;&quot;ForbiddenByPolicy&quot;&quot;
    }
  }
}&quot;</span>);
                        <b>return</b> <span class="r15 r">response</span>;
                    }
                    <b>else</b>
                    {
                        <b>return</b> <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2adc622c2950d8" class="t constructor">MockResponse</a>(404);
                    }
                }),
            };
 
            <a href="/Azure.Security.KeyVault.Certificates/A.html#a66d1243f42a3d40" class="t t">CertificateClient</a> <span id="r16 rd" class="r16 r">client</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<b>new</b> <span class="t">CertificateClient</span>(<b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="s">&quot;https://heathskeyvault.vault.azure.net&quot;</span>), <b>new</b> <a href="/Azure.Core.TestFramework/A.html#f4b506dc54caf787" class="t constructor">MockCredential</a>(), <span class="r12 r">options</span>));
 
            <span class="i">RequestFailedException</span> <span id="r17 rd" class="r17 r">ex</span> = <span class="i">Assert</span>.<span class="i">ThrowsAsync</span>&lt;<span class="i">RequestFailedException</span>&gt;(<b>async</b> () =&gt; <b>await</b> <span class="r16 r">client</span>.<span class="i">DownloadCertificateAsync</span>(<span class="s">&quot;test&quot;</span>));
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(403, <span class="r17 r">ex</span>.<span class="i">Status</span>);
            <span class="i">Assert</span>.<span class="i">AreEqual</span>(<span class="s">&quot;Forbidden&quot;</span>, <span class="r17 r">ex</span>.<span class="i">ErrorCode</span>);
        }
    }
}
</pre></td></tr></table></div></body></html>
