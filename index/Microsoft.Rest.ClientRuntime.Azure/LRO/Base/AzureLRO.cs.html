<!DOCTYPE html>
<html><head><title>AzureLRO.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(556);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Rest.ClientRuntime.Azure/LRO/Base/AzureLRO.cs" target="_top">LRO\Base\AzureLRO.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master//sdk/mgmtcommon/ClientRuntime.Azure/ClientRuntime.Azure/LRO/Base/AzureLRO.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Rest.ClientRuntime.Azure" target="_top">Microsoft.Rest.ClientRuntime.Azure.csproj</a> (Microsoft.Rest.ClientRuntime.Azure)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">ClientRuntime</span>.<span class="i n">Azure</span>.<span class="i n">LRO</span>
{
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">Azure</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">ClientRuntime</span>.<span class="i n">Azure</span>.<span class="i n">Properties</span>;
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Base class for driving Azure LRO operation</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r t">TResourceBody</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r t">TRequestHeaders</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
    <b>internal abstract class</b> <a id="a756573a2701915c" href="../../R/a756573a2701915c.html" target="n" data-glyph="2,0" class="t t">AzureLRO</a>&lt;<span id="r0 rd t" class="r0 r t">TResourceBody</span>, <span id="r1 rd t" class="r1 r t">TRequestHeaders</span>&gt; : <a href="IAzureLRO.cs.html#a21f4634ef34e260" class="t t">IAzureLRO</a>&lt;<span class="r0 r t">TResourceBody</span>, <span class="r1 r t">TRequestHeaders</span>&gt;
        <b>where</b> <span class="r0 r t">TResourceBody</span> : <b>class
        where</b> <span class="r1 r t">TRequestHeaders</span> : <b>class</b>
    {   
        <b>public abstract string</b> <a id="457609483ba376da" href="../../R/457609483ba376da.html" target="n" data-glyph="102,1" class="i property">RESTOperationVerb</a> { <b>get</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> fields
        <b>protected</b> <a href="../../CommonModels/AzureOperationResponse.cs.html#97171b8214ee5041" class="t t">AzureOperationResponse</a>&lt;<span class="r0 r t">TResourceBody</span>, <span class="r1 r t">TRequestHeaders</span>&gt; <a id="7cd869a992e3f69e" href="../../R/7cd869a992e3f69e.html" target="n" data-glyph="45,1" class="i field">InitialResponse</a>;
        <b>protected</b> <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <a id="17cb1dffbf781bce" href="../../R/17cb1dffbf781bce.html" target="n" data-glyph="45,1" class="i field">CancelToken</a>;
        <b>protected</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt; <a id="8242fcf41a81c6c9" href="../../R/8242fcf41a81c6c9.html" target="n" data-glyph="45,1" class="i field">_customHeaders</a>;
        <b>protected</b> <a href="../LROPollState.cs.html#4cb7c9500ee5e49e" class="t t">LROPollState</a>&lt;<span class="r0 r t">TResourceBody</span>, <span class="r1 r t">TRequestHeaders</span>&gt; <a id="afa6fa195fd22723" href="../../R/afa6fa195fd22723.html" target="n" data-glyph="45,1" class="i field">CurrentPollingState</a>;
        <b>protected</b> <a href="../../CommonModels/IAzureClient.cs.html#bcecb29da358898c" class="t t">IAzureClient</a> <a id="757a5ae6b303476d" href="../../R/757a5ae6b303476d.html" target="n" data-glyph="45,1" class="i field">SdkClient</a>;
        <b>protected bool</b> <a id="8d1756876ed7d14a" href="../../R/8d1756876ed7d14a.html" target="n" data-glyph="105,1" class="i property">IsLROTaskCompleted</a> { <b>get</b>; <b>set</b>; }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        
        <span class="k preprocess">#</span><span class="k preprocess">region</span> constructor
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Constructor for creating Azure LRO</span>
        <span class="c">///</span><span class="c"> LRO starts after the first response is returned to Azure ClientRuntime.</span>
        <span class="c">///</span><span class="c"> This will validate the initial response for missing data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">client</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">initialResponse</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">customHeaders</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected</b> <a id="23961e56cff7981f" href="../../R/23961e56cff7981f.html" target="n" data-glyph="75,1" class="t constructor">AzureLRO</a>(<a href="../../CommonModels/IAzureClient.cs.html#bcecb29da358898c" class="t t">IAzureClient</a> <span id="r2 rd" class="r2 r">client</span>,
            <a href="../../CommonModels/AzureOperationResponse.cs.html#97171b8214ee5041" class="t t">AzureOperationResponse</a>&lt;<span class="r0 r t">TResourceBody</span>, <span class="r1 r t">TRequestHeaders</span>&gt; <span id="r3 rd" class="r3 r">initialResponse</span>, <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt; <span id="r4 rd" class="r4 r">customHeaders</span>,
            <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r5 rd" class="r5 r">cancellationToken</span>)
        {
            <a href="#7cd869a992e3f69e" class="i field">InitialResponse</a> = <span class="r3 r">initialResponse</span>;
            <a href="#e204177afabcdf1f" class="i property">CustomHeaders</a> = <span class="r4 r">customHeaders</span>;
            <a href="#17cb1dffbf781bce" class="i field">CancelToken</a> = <span class="r5 r">cancellationToken</span>;
            <a href="#757a5ae6b303476d" class="i field">SdkClient</a> = <span class="r2 r">client</span>;
            <a href="#f33de8b361eb7e09" class="i method">ValidateInitialResponse</a>();
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <a href="#df681818d6f0c037" class="i property">lroPollingCount</a> = 1;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>protected</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt; <a id="e204177afabcdf1f" href="../../R/e204177afabcdf1f.html" target="n" data-glyph="105,1" class="i property">CustomHeaders</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#8242fcf41a81c6c9" class="i field">_customHeaders</a> == <b>null</b>)
                    <a href="#8242fcf41a81c6c9" class="i field">_customHeaders</a> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt;();
 
                <b>return</b> <a href="#8242fcf41a81c6c9" class="i field">_customHeaders</a>;
            }
 
            <b>set</b>
            {
                <a href="#8242fcf41a81c6c9" class="i field">_customHeaders</a> = <b>value</b>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Public functions
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Begin polling</span>
        <span class="c">///</span><span class="c"> This will drive the entire LRO process of polling and checking for error during LRO</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0f6ffd89d8a419d3" href="../../R/0f6ffd89d8a419d3.html" target="n" data-glyph="72,1" class="i method">BeginLROAsync</a>()
        {
            <a href="#8d1756876ed7d14a" class="i property">IsLROTaskCompleted</a> = <b>false</b>;
 
            <a href="#f18aaa582ed8c160" class="i method">InitializeAsyncHeadersToUse</a>();
            <b>await</b> <a href="#1a585e5518a016e7" class="i method">StartPollingAsync</a>().<a href="@0@mscorlib/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            <b>await</b> <a href="#e58500af4be4ca8f" class="i method">PostPollingAsync</a>().<a href="@0@mscorlib/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            <a href="#e6982e9a9c779e05" class="i method">CheckFinalErrors</a>();
 
            <a href="#8d1756876ed7d14a" class="i property">IsLROTaskCompleted</a> = <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return results from LRO operation</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../../CommonModels/AzureOperationResponse.cs.html#97171b8214ee5041" class="t t">AzureOperationResponse</a>&lt;<span class="r0 r t">TResourceBody</span>, <span class="r1 r t">TRequestHeaders</span>&gt;&gt; <a id="ab6e0a199dab4b94" href="../../R/ab6e0a199dab4b94.html" target="n" data-glyph="72,1" class="i method">GetLROResults</a>()
        {
            <b>while</b> (<a href="#8d1756876ed7d14a" class="i property">IsLROTaskCompleted</a> == <b>false</b>)
            {
                <b>await</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#b070ae859dd3f7b7" class="i method">Delay</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#04fda933c6cb463e" class="i property">DelayBetweenPolling</a>, <a href="#17cb1dffbf781bce" class="i field">CancelToken</a>).<a href="@0@mscorlib/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
 
            <b>return</b> <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#9feaefa576c0b5d4" class="i property">AzureOperationResponse</a>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Protected functions
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check for errors at the end of LRO operation</span>
        <span class="c">///</span><span class="c"> Last chance to check any final errors</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="e6982e9a9c779e05" href="../../R/e6982e9a9c779e05.html" target="n" data-glyph="75,1" class="i method">CheckFinalErrors</a>()
        {
            <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#420b38e03ff943e0" class="i property">LastSerializationExceptionMessage</a>))
            {
                <span class="c">// Let empty/null body return back to the client.</span>
                <span class="c">// throw new CloudException(string.Format(Resources.BodyDeserializationError, CurrentPollingState.LastSerializationExceptionMessage));</span>
            }
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Does basic validation on initial response from RP, prior to start LRO process</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="f33de8b361eb7e09" href="../../R/f33de8b361eb7e09.html" target="n" data-glyph="75,1" class="i method">ValidateInitialResponse</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> validate data
            <b>if</b> (<a href="#7cd869a992e3f69e" class="i field">InitialResponse</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="/Microsoft.Rest.ClientRuntime/A.html#ff811ed9b9c086c4" class="t constructor">ValidationException</a>(<a href="/Microsoft.Rest.ClientRuntime/A.html#1481639bfe79a3ab" class="t t">ValidationRules</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8096179347c04beb" class="i field">CannotBeNull</a>, <span class="s">&quot;response&quot;</span>);
            }
 
            <b>if</b> (<a href="#7cd869a992e3f69e" class="i field">InitialResponse</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#1af1a97ad0132567" class="i property">Response</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="/Microsoft.Rest.ClientRuntime/A.html#ff811ed9b9c086c4" class="t constructor">ValidationException</a>(<a href="/Microsoft.Rest.ClientRuntime/A.html#1481639bfe79a3ab" class="t t">ValidationRules</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8096179347c04beb" class="i field">CannotBeNull</a>, <span class="s">&quot;response.Response&quot;</span>);
            }
 
            <b>if</b> (<a href="#7cd869a992e3f69e" class="i field">InitialResponse</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#abf75b52775df9fa" class="i property">Request</a> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="/Microsoft.Rest.ClientRuntime/A.html#ff811ed9b9c086c4" class="t constructor">ValidationException</a>(<a href="/Microsoft.Rest.ClientRuntime/A.html#1481639bfe79a3ab" class="t t">ValidationRules</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8096179347c04beb" class="i field">CannotBeNull</a>, <span class="s">&quot;response.Request&quot;</span>);
            }
 
            <b>if</b> (<a href="#7cd869a992e3f69e" class="i field">InitialResponse</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#abf75b52775df9fa" class="i property">Request</a>.<span class="i property">Method</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="/Microsoft.Rest.ClientRuntime/A.html#ff811ed9b9c086c4" class="t constructor">ValidationException</a>(<a href="/Microsoft.Rest.ClientRuntime/A.html#1481639bfe79a3ab" class="t t">ValidationRules</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8096179347c04beb" class="i field">CannotBeNull</a>, <span class="s">&quot;response.Request.Method&quot;</span>);
            }
 
            <b>if</b>(<a href="#7cd869a992e3f69e" class="i field">InitialResponse</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#abf75b52775df9fa" class="i property">Request</a>.<span class="i property">RequestUri</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="/Microsoft.Rest.ClientRuntime/A.html#ff811ed9b9c086c4" class="t constructor">ValidationException</a>(<a href="/Microsoft.Rest.ClientRuntime/A.html#1481639bfe79a3ab" class="t t">ValidationRules</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8096179347c04beb" class="i field">CannotBeNull</a>, <span class="s">&quot;response.Request.RequestUri&quot;</span>);
            }
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
        
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initialize pollingUrl to use depending upon the headers passed back from RP</span>
        <span class="c">///</span><span class="c"> This function will be called after each response received during LRO</span>
        <span class="c">///</span><span class="c"> Each REST verb will override for specific requirements</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="f18aaa582ed8c160" href="../../R/f18aaa582ed8c160.html" target="n" data-glyph="75,1" class="i method">InitializeAsyncHeadersToUse</a>()
        {
            <b>if</b> (<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a> == <b>null</b>)
            {
                <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a> = <b>new</b> <a href="../LROPollState.cs.html#bac438141e8e234e" class="t constructor">LROPollState</a>&lt;<span class="r0 r t">TResourceBody</span>, <span class="r1 r t">TRequestHeaders</span>&gt;(<a href="#7cd869a992e3f69e" class="i field">InitialResponse</a>, <a href="#757a5ae6b303476d" class="i field">SdkClient</a>);
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
                <a href="#ff822850c5e9edbd" class="i method">InitLroSession</a>();
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#71948fe4bba1a4a0" class="i property">AzureAsyncOperationHeaderLink</a>))
                {
                    <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#da5138d12f33b02d" class="i property">PollingUrlToUse</a> = <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#71948fe4bba1a4a0" class="i property">AzureAsyncOperationHeaderLink</a>;
                }
 
                <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#da5138d12f33b02d" class="i property">PollingUrlToUse</a>) &amp;&amp; !<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#0f63c13aca1bdf1a" class="i property">LocationHeaderLink</a>))
                {
                    <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#da5138d12f33b02d" class="i property">PollingUrlToUse</a> = <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#0f63c13aca1bdf1a" class="i property">LocationHeaderLink</a>;
                }
 
                <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#da5138d12f33b02d" class="i property">PollingUrlToUse</a>))
                {
                    <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#da5138d12f33b02d" class="i property">PollingUrlToUse</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs polling</span>
        <span class="c">///</span><span class="c"> Workflow:</span>
        <span class="c">///</span><span class="c"> Depends on an internal structure CurrentPollingState for driving the LRO operation</span>
        <span class="c">///</span><span class="c"> 1) Depending upon the initial response status (starts/exits polling)</span>
        <span class="c">///</span><span class="c"> 2) Reson for making Poll function part of CurrentPollingState because there can be scenario we might have to enabled to serialize polling state (user can save and drive polling operation)</span>
        <span class="c">///</span><span class="c"> 3) Update polling state after each polling iteration</span>
        <span class="c">///</span><span class="c"> 4) Check for errors on each reponse we receive during LRO</span>
        <span class="c">///</span><span class="c"> 5) Initialize polling URL to use based on the headers received in each polling response</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected virtual async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="1a585e5518a016e7" href="../../R/1a585e5518a016e7.html" target="n" data-glyph="75,1" class="i method">StartPollingAsync</a>()
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <a href="#49341060b9baf9f5" class="i method">InitPollingSession</a>();
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>while</b> (!<a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#8a4af69473e391dd" class="i property">TerminalStatuses</a>.<a href="@0@System.Core/A.html#6a1af7c3d17845e3" class="i method">Any</a>(<span id="r6 rd" class="r6 r">s</span> =&gt; <span class="r6 r">s</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#9547486028ba26bf" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>)))
            {
                <b>await</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#b070ae859dd3f7b7" class="i method">Delay</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#04fda933c6cb463e" class="i property">DelayBetweenPolling</a>, <a href="#17cb1dffbf781bce" class="i field">CancelToken</a>).<a href="@0@mscorlib/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
                <a href="#ddc68e6eb373fbe2" class="i method">UpdatePollingSessionIds</a>();
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <b>await</b> <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#3d753c0f73a54090" class="i method">Poll</a>(<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>, <a href="#17cb1dffbf781bce" class="i field">CancelToken</a>).<a href="@0@mscorlib/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="#4393b9be7e5e70ac" class="i method">UpdatePollingState</a>();
                <a href="#f5012a61e4775bcb" class="i method">CheckForErrors</a>();
                <a href="#f18aaa582ed8c160" class="i method">InitializeAsyncHeadersToUse</a>();
            }
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <a href="#3f1f7006fbc1ef46" class="i method">RemoveLroHeaders</a>(<span class="r7 r">removePerfImapact</span>: <b>true</b>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Updates polling state strcture</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="4393b9be7e5e70ac" href="../../R/4393b9be7e5e70ac.html" target="n" data-glyph="75,1" class="i method">UpdatePollingState</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Check provisionState
            <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#ff00f6d29c73ecb2" class="i property">CurrentStatusCode</a> = <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#3e971a98943a6bbf" class="i property">Response</a>.<span class="i property">StatusCode</span>;
 
            <b>if</b> (<a href="#d1c796a4f1a2e7f6" class="i method">IsAzureAsyncOperationResponseStateValid</a>() == <b>true</b>)
            {
                <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#9547486028ba26bf" class="i property">Status</a> = <a href="#5ad742301c742c1a" class="i method">GetAzureAsyncResponseState</a>();
            }
            <b>else</b> <span class="c">// we assume the polling is happening on locaiton header</span>
            {
                <b>if</b> (<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#ff00f6d29c73ecb2" class="i property">CurrentStatusCode</a> == <a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#1e4f1250e8e5ac5c" class="i field">Accepted</a>)
                {
                    <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#9547486028ba26bf" class="i property">Status</a> = <a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#9c03fa0c8867e091" class="i field">InProgressStatus</a>;
                }
                <b>else</b>
                {
                    <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#9547486028ba26bf" class="i property">Status</a> = <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#78c30598f1f9658c" class="i method">GetProvisioningStateFromBody</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#954dadc5b93ac289" class="i property">RawBody</a>, <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#ff00f6d29c73ecb2" class="i property">CurrentStatusCode</a>, () =&gt; <a href="#7750edb2481eb08d" class="i method">IsCheckingProvisioningStateApplicable</a>());
                }
 
                <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#9547486028ba26bf" class="i property">Status</a>))
                {
                    <b>throw</b> <b>new</b> <a href="../../CloudException.cs.html#e9c1f211ebcda92d" class="t constructor">CloudException</a>(<span class="s">&quot;The response from long running operation does not have a valid status code.&quot;</span>);
                }
 
                <span class="k preprocess">#</span><span class="k preprocess">region</span> old code
                <span class="c">//else if (IsCheckingProvisioningStateApplicable() == true) //Each verb can decide if Provisioning state is applicable and if it needs to be checked</span>
                <span class="c">//{</span>
                <span class="c">//    CurrentPollingState.Status = GetProvisioningStateFromRawBody();                   </span>
                <span class="c">//}</span>
                <span class="c">//else</span>
                <span class="c">//{</span>
                <span class="c">//    throw new CloudException(&quot;The response from long running operation does not have a valid status code.&quot;);</span>
                <span class="c">//}</span>
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            }
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="c1964c82e7d55c0d" href="../../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetPSFromRawBody</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">provisioningState</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
 
            <span class="c">// We check if we got provisionState and we get the status from provisioning state</span>
 
            <span class="c">// In 202 pattern ProvisioningState may not be present in </span>
            <span class="c">// the response. In that case the assumption is the status is Succeeded.</span>
 
            <span class="c">// We call IsCheckingProvisioning here just to make sure this code should be treated as one unit, you always check for provisioning state only if it&#39;s applicable</span>
            <b>if</b> (<a href="#7750edb2481eb08d" class="i method">IsCheckingProvisioningStateApplicable</a>() == <b>true</b>)  <span class="c">// Each verb can decide if Provisioning state is applicable and if it needs to be checked</span>
            {
                <b>if</b> (<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#954dadc5b93ac289" class="i property">RawBody</a> != <b>null</b> &amp;&amp;
                        <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#954dadc5b93ac289" class="i property">RawBody</a>[<span class="s">&quot;properties&quot;</span>] != <b>null</b> &amp;&amp;
                        <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#954dadc5b93ac289" class="i property">RawBody</a>[<span class="s">&quot;properties&quot;</span>][<span class="s">&quot;provisioningState&quot;</span>] != <b>null</b>)
                {
                    <span class="r8 r">provisioningState</span> = ((<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>)<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>?.<a href="../LROPollState.cs.html#954dadc5b93ac289" class="i property">RawBody</a>?[<span class="s">&quot;properties&quot;</span>]?[<span class="s">&quot;provisioningState&quot;</span>])?.<a href="@0@mscorlib/A.html#06a5f7c688e69307" class="i method">Trim</a>();
                }
            }
 
            <b>if</b>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r8 r">provisioningState</span>))
            {
                <span class="r8 r">provisioningState</span> = <a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#c0fe7b6ce417447f" class="i field">SuccessStatus</a>.<a href="@0@mscorlib/A.html#efa5e6c14683e022" class="i method">ToString</a>();
            }
 
            <b>return</b> <span class="r8 r">provisioningState</span>;
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> old code
            <span class="c">//// We check if we got provisionState and we get the status from provisioning state</span>
 
            <span class="c">//// In 202 pattern ProvisioningState may not be present in </span>
            <span class="c">//// the response. In that case the assumption is the status is Succeeded.</span>
            <span class="c">//if (CurrentPollingState.RawBody != null &amp;&amp;</span>
            <span class="c">//    CurrentPollingState.RawBody[&quot;properties&quot;] != null &amp;&amp;</span>
            <span class="c">//    CurrentPollingState.RawBody[&quot;properties&quot;][&quot;provisioningState&quot;] != null &amp;&amp;</span>
            <span class="c">//    CurrentPollingState?.RawBody?[&quot;properties&quot;]?[&quot;provisioningState&quot;]?.HasValues == true)</span>
            <span class="c">//{</span>
            <span class="c">//    provisioningState = ((string)CurrentPollingState?.RawBody?[&quot;properties&quot;]?[&quot;provisioningState&quot;])?.Trim();</span>
            <span class="c">//}</span>
 
            <span class="c">//if (string.IsNullOrEmpty(provisioningState))</span>
            <span class="c">//{</span>
            <span class="c">//    provisioningState = AzureAsyncOperation.SuccessStatus;</span>
            <span class="c">//}</span>
 
            <span class="c">//CurrentPollingState.Status = provisioningState;</span>
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Each verb will override to define if checking provisioning state is applicable</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">true: if it&#39;s applicable, false: if not applicable</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected virtual bool</b> <a id="7750edb2481eb08d" href="../../R/7750edb2481eb08d.html" target="n" data-glyph="75,1" class="i method">IsCheckingProvisioningStateApplicable</a>()
        {
            <b>return</b> <b>true</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Each verb will override depending upon the requirements</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected virtual async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="e58500af4be4ca8f" href="../../R/e58500af4be4ca8f.html" target="n" data-glyph="75,1" class="i method">PostPollingAsync</a>()
        {
            <b>return</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check for error codition during LRO</span>
        <span class="c">///</span><span class="c"> Each verb can participate in deciding if certain response results in error</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="f5012a61e4775bcb" href="../../R/f5012a61e4775bcb.html" target="n" data-glyph="75,1" class="i method">CheckForErrors</a>()
        {
            <span class="c">// Check if operation failed</span>
            <b>if</b> (<a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#8ee44d0279536d28" class="i property">FailedStatuses</a>.<a href="@0@System.Core/A.html#6a1af7c3d17845e3" class="i method">Any</a>(
                        <span id="r9 rd" class="r9 r">s</span> =&gt; <span class="r9 r">s</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#9547486028ba26bf" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>)))
            {
                <b>throw</b> <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#f4f57c54f0d4edaf" class="i property">CloudException</a>;
            }
 
            <span class="c">//If Async-Operation header used, body has to be not null</span>
            <b>if</b> (<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#da5138d12f33b02d" class="i property">PollingUrlToUse</a>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#71948fe4bba1a4a0" class="i property">AzureAsyncOperationHeaderLink</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
            {
                <b>if</b> (<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>?.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a> == <b>null</b> || <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#954dadc5b93ac289" class="i property">RawBody</a> == <b>null</b>)
                {
                    <b>throw</b> <b>new</b> <a href="../../CloudException.cs.html#e9c1f211ebcda92d" class="t constructor">CloudException</a>(<a href="../../Properties/Resources.Designer.cs.html#42a5dc9a2b09593b" class="t t">Resources</a>.<a href="../../Properties/Resources.Designer.cs.html#0ac97b7fdbcf7c0d" class="i property">NoBody</a>);
                }
 
                <span class="c">//if (!string.IsNullOrEmpty(CurrentPollingState.LastSerializationExceptionMessage))</span>
                <span class="c">//{</span>
                <span class="c">//    throw new CloudException(string.Format(Resources.BodyDeserializationError, CurrentPollingState.LastSerializationExceptionMessage));</span>
                <span class="c">//}</span>
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Validate passed URL</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">url</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Url to be validated</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">throwForInvalidUri</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True: throws expception, False: does not throw exception</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected virtual string</b> <a id="459dfffc28e15b14" href="../../R/459dfffc28e15b14.html" target="n" data-glyph="75,1" class="i method">GetValidAbsoluteUri</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">url</span>, <b>bool</b> <span id="r11 rd" class="r11 r">throwForInvalidUri</span> = <b>false</b>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">absoluteUri</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
            <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r13 rd" class="r13 r">givenUri</span> = <b>null</b>;
            <b>if</b> (<a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a>.<a href="@0@System/A.html#49754736d6982eb6" class="i method">TryCreate</a>(<span class="r10 r">url</span>, <a href="@0@System/A.html#ac43655101ad74be" class="t t">UriKind</a>.<a href="@0@System/A.html#d734108197254429" class="i field">Absolute</a>, <b>out</b> <span class="r13 r">givenUri</span>))
            {
                <span class="r12 r">absoluteUri</span> = <span class="r13 r">givenUri</span>.<a href="@0@System/A.html#e335fec0022465e6" class="i property">AbsoluteUri</a>;
            }
 
            <b>if</b>(<span class="r11 r">throwForInvalidUri</span>)
            {
                <b>if</b>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r12 r">absoluteUri</span>))
                {
                    <b>throw</b> <b>new</b> <a href="../../CloudException.cs.html#e9c1f211ebcda92d" class="t constructor">CloudException</a>(<a href="../../Properties/Resources.Designer.cs.html#42a5dc9a2b09593b" class="t t">Resources</a>.<a href="../../Properties/Resources.Designer.cs.html#e5d120b5fb8ff503" class="i property">InValidUri</a>);
                }
            }
 
            <b>return</b> <span class="r12 r">absoluteUri</span>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private functions
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
        <b>const string</b> <a id="05adbb145598970c" href="../../R/05adbb145598970c.html" target="n" data-glyph="10,1" class="i field">Header_LroSessionId</a> = <span class="s">&quot;LroSessionId&quot;</span>;
        <b>const string</b> <a id="674dbe0003e4dd2a" href="../../R/674dbe0003e4dd2a.html" target="n" data-glyph="10,1" class="i field">Header_LroPollingId</a> = <span class="s">&quot;LroPollingId&quot;</span>;
        <b>const string</b> <a id="01d3d34ccc2ae102" href="../../R/01d3d34ccc2ae102.html" target="n" data-glyph="10,1" class="i field">Header_RecordPlaybackPerfImpact</a> = <span class="s">&quot;RecordPlaybackPerfImpact&quot;</span>;
        <b>const string</b> <a id="1d11c1137750644c" href="../../R/1d11c1137750644c.html" target="n" data-glyph="10,1" class="i field">Header_LroOperation</a> = <span class="s">&quot;LroOperation&quot;</span>;
        <b>const int</b> <a id="01ed6626bc15f616" href="../../R/01ed6626bc15f616.html" target="n" data-glyph="10,1" class="i field">perfImpactCount</a> = 3;
 
        <b>private long</b> <a id="c4f1449f3b5ba34f" href="../../R/c4f1449f3b5ba34f.html" target="n" data-glyph="106,1" class="i property">lroSessionId</a> { <b>get</b>; <b>set</b>; }
 
        <b>private long</b> <a id="fd57538ab80635d5" href="../../R/fd57538ab80635d5.html" target="n" data-glyph="106,1" class="i property">lroPollingId</a> { <b>get</b>; <b>set</b>; }
 
        <b>private long</b> <a id="df681818d6f0c037" href="../../R/df681818d6f0c037.html" target="n" data-glyph="106,1" class="i property">lroPollingCount</a> { <b>get</b>; <b>set</b>; }
 
        <b>private string</b> <a id="a2aa5c72a4ada167" href="../../R/a2aa5c72a4ada167.html" target="n" data-glyph="106,1" class="i property">lroSessionPollingId</a> { <b>get</b>; <b>set</b>; }
 
        
        <b>private void</b> <a id="ff822850c5e9edbd" href="../../R/ff822850c5e9edbd.html" target="n" data-glyph="76,1" class="i method">InitLroSession</a>()
        {
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#df681818d6f0c037" class="i property">lroPollingCount</a> = 1;
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#c4f1449f3b5ba34f" class="i property">lroSessionId</a> = <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#1cd5dd408a32124f" class="i property">Now</a>.<a href="@0@mscorlib/A.html#92f52fcc6830b73e" class="i property">Ticks</a>;
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a7861da7aaa500fe" class="i method">Add</a>(<a href="#1d11c1137750644c" class="i field">Header_LroOperation</a>, <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <a href="#a756573a2701915c" class="k">this</a>.<a href="#457609483ba376da" class="i property">RESTOperationVerb</a> });
        }
 
        <b>private void</b> <a id="49341060b9baf9f5" href="../../R/49341060b9baf9f5.html" target="n" data-glyph="76,1" class="i method">InitPollingSession</a>()
        {
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#fd57538ab80635d5" class="i property">lroPollingId</a> = <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#1cd5dd408a32124f" class="i property">Now</a>.<a href="@0@mscorlib/A.html#92f52fcc6830b73e" class="i property">Ticks</a>;
        }
 
        <b>private void</b> <a id="ddc68e6eb373fbe2" href="../../R/ddc68e6eb373fbe2.html" target="n" data-glyph="76,1" class="i method">UpdatePollingSessionIds</a>()
        {
            <a href="#3f1f7006fbc1ef46" class="i method">RemoveLroHeaders</a>();
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#a2aa5c72a4ada167" class="i property">lroSessionPollingId</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#6e5f254563fed78e" class="i method">Format</a>(<span class="s">&quot;{0}.{1}.{2}&quot;</span>, <a href="#a756573a2701915c" class="k">this</a>.<a href="#c4f1449f3b5ba34f" class="i property">lroSessionId</a>.<a href="@0@mscorlib/A.html#76873dfc1b95c712" class="i method">ToString</a>(), <a href="#a756573a2701915c" class="k">this</a>.<a href="#fd57538ab80635d5" class="i property">lroPollingId</a>.<a href="@0@mscorlib/A.html#76873dfc1b95c712" class="i method">ToString</a>(), <a href="#a756573a2701915c" class="k">this</a>.<a href="#df681818d6f0c037" class="i property">lroPollingCount</a>.<a href="@0@mscorlib/A.html#76873dfc1b95c712" class="i method">ToString</a>());
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a7861da7aaa500fe" class="i method">Add</a>(<a href="#05adbb145598970c" class="i field">Header_LroSessionId</a>, <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <a href="#a756573a2701915c" class="k">this</a>.<a href="#c4f1449f3b5ba34f" class="i property">lroSessionId</a>.<a href="@0@mscorlib/A.html#76873dfc1b95c712" class="i method">ToString</a>() });
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a7861da7aaa500fe" class="i method">Add</a>(<a href="#674dbe0003e4dd2a" class="i field">Header_LroPollingId</a>, <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <a href="#a756573a2701915c" class="k">this</a>.<a href="#a2aa5c72a4ada167" class="i property">lroSessionPollingId</a>.<a href="@0@mscorlib/A.html#efa5e6c14683e022" class="i method">ToString</a>() });
            <b>if</b>(<a href="#a756573a2701915c" class="k">this</a>.<a href="#df681818d6f0c037" class="i property">lroPollingCount</a> &gt;= <a href="#01ed6626bc15f616" class="i field">perfImpactCount</a>)
            {
                <b>if</b>(!<a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#2e5bc6d8c0f21e67" class="i method">TryGetValue</a>(<a href="#01d3d34ccc2ae102" class="i field">Header_RecordPlaybackPerfImpact</a>, <b>out</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r14 rd" class="r14 r">playBackImpact</span>))
                {
                    <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a7861da7aaa500fe" class="i method">Add</a>(<a href="#01d3d34ccc2ae102" class="i field">Header_RecordPlaybackPerfImpact</a>, <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <span class="s">&quot;true&quot;</span> });
                }
            }
 
            <a href="#a756573a2701915c" class="k">this</a>.<a href="#df681818d6f0c037" class="i property">lroPollingCount</a> = <a href="#a756573a2701915c" class="k">this</a>.<a href="#df681818d6f0c037" class="i property">lroPollingCount</a> + 1;
        }
 
        <b>protected void</b> <a id="3f1f7006fbc1ef46" href="../../R/3f1f7006fbc1ef46.html" target="n" data-glyph="75,1" class="i method">RemoveLroHeaders</a>(<b>bool</b> <span id="r7 rd" class="r7 r">removePerfImapact</span> = <b>false</b>, <b>bool</b> <span id="r15 rd" class="r15 r">removeOperation</span> = <b>false</b>)
        {
            <b>if</b>(<a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#2e5bc6d8c0f21e67" class="i method">TryGetValue</a>(<a href="#05adbb145598970c" class="i field">Header_LroSessionId</a>, <b>out</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r16 rd" class="r16 r">lroSessionIdList</span>))
            {
                <b>if</b>(<span class="r16 r">lroSessionIdList</span>.<a href="@0@System.Core/A.html#8788153112b7ffd0" class="i method">Any</a>())
                {
                    <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a6db5ffdec557169" class="i method">Remove</a>(<a href="#05adbb145598970c" class="i field">Header_LroSessionId</a>);
                }
            }
 
            <b>if</b> (<a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#2e5bc6d8c0f21e67" class="i method">TryGetValue</a>(<a href="#674dbe0003e4dd2a" class="i field">Header_LroPollingId</a>, <b>out</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r17 rd" class="r17 r">lroPollingIdList</span>))
            {
                <b>if</b> (<span class="r17 r">lroPollingIdList</span>.<a href="@0@System.Core/A.html#8788153112b7ffd0" class="i method">Any</a>())
                {
                    <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a6db5ffdec557169" class="i method">Remove</a>(<a href="#674dbe0003e4dd2a" class="i field">Header_LroPollingId</a>);
                }
            }
 
            <b>if</b> (<span class="r7 r">removePerfImapact</span>)
            {
                <b>if</b> (<a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#2e5bc6d8c0f21e67" class="i method">TryGetValue</a>(<a href="#01d3d34ccc2ae102" class="i field">Header_RecordPlaybackPerfImpact</a>, <b>out</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r18 rd" class="r18 r">recPerfImpactList</span>))
                {
                    <b>if</b> (<span class="r18 r">recPerfImpactList</span>.<a href="@0@System.Core/A.html#8788153112b7ffd0" class="i method">Any</a>())
                    {
                        <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a6db5ffdec557169" class="i method">Remove</a>(<a href="#01d3d34ccc2ae102" class="i field">Header_RecordPlaybackPerfImpact</a>);
                    }
                }
            }
 
            <b>if</b>(<span class="r15 r">removeOperation</span>)
            { 
                <b>if</b> (<a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#2e5bc6d8c0f21e67" class="i method">TryGetValue</a>(<a href="#1d11c1137750644c" class="i field">Header_LroOperation</a>, <b>out</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r19 rd" class="r19 r">restOperation</span>))
                {
                    <b>if</b> (<span class="r19 r">restOperation</span>.<a href="@0@System.Core/A.html#8788153112b7ffd0" class="i method">Any</a>())
                    {
                        <a href="#a756573a2701915c" class="k">this</a>.<a href="#e204177afabcdf1f" class="i property">CustomHeaders</a>.<a href="@0@mscorlib/A.html#a6db5ffdec557169" class="i method">Remove</a>(<a href="#1d11c1137750644c" class="i field">Header_LroOperation</a>);
                    }
                }
            }
        }
 
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get Valid status</span>
        <span class="c">///</span><span class="c"> There are cases where there is an error sent from the service and in that case, the status should be one of the valid FailedStatuses</span>
        <span class="c">///</span><span class="c"> But there are cases where there is a customized error sent by service and they do not fall under Failed/Success statuses, in that case we fall back on response status</span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> e.g. The response status is OK, but the error body has the status as &quot;TestFailed&quot; (which do not fall under valid failed status, so we fall back to OK)</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private string</b> <a id="5ad742301c742c1a" href="../../R/5ad742301c742c1a.html" target="n" data-glyph="76,1" class="i method">GetAzureAsyncResponseState</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r20 rd" class="r20 r">validStatus</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
            <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>?.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>))
            {
                <b>if</b> (<a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#8ee44d0279536d28" class="i property">FailedStatuses</a>.<a href="@0@System.Core/A.html#6a1af7c3d17845e3" class="i method">Any</a>(
                        <span id="r21 rd" class="r21 r">s</span> =&gt; <span class="r21 r">s</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>)))
                {
                    <span class="r20 r">validStatus</span> = <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>;
                }
                <b>else</b> <b>if</b> (<a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#8a4af69473e391dd" class="i property">TerminalStatuses</a>.<a href="@0@System.Core/A.html#6a1af7c3d17845e3" class="i method">Any</a>(<span id="r22 rd" class="r22 r">s</span> =&gt; <span class="r22 r">s</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>)))
                {
                    <span class="r20 r">validStatus</span> = <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>;
                }
                <b>else</b> <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r20 r">validStatus</span>))
                {
                    <span class="r20 r">validStatus</span> = <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#3e971a98943a6bbf" class="i property">Response</a>.<span class="i property">StatusCode</span>.<a href="@0@mscorlib/A.html#1365cfeffd45409d" class="i method">ToString</a>();
                }
            }
 
            <b>return</b> <span class="r20 r">validStatus</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This function determines if you are running your polling under Azure-Async header or if the response status falls under terminal/failed status</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="d1c796a4f1a2e7f6" href="../../R/d1c796a4f1a2e7f6.html" target="n" data-glyph="76,1" class="i method">IsAzureAsyncOperationResponseStateValid</a>()
        {
            <b>if</b> (<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>?.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a> != <b>null</b> &amp;&amp; !<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>?.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>))
            {
                <b>if</b> (<a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#8ee44d0279536d28" class="i property">FailedStatuses</a>.<a href="@0@System.Core/A.html#6a1af7c3d17845e3" class="i method">Any</a>(
                            <span id="r23 rd" class="r23 r">s</span> =&gt; <span class="r23 r">s</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>)))
                {
                    <b>return</b> <b>true</b>;
                }
                <b>else</b> <b>if</b> (<a href="../../CommonModels/AzureAsyncOperation.cs.html#68f72572ceb11b1a" class="t t">AzureAsyncOperation</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#8a4af69473e391dd" class="i property">TerminalStatuses</a>.<a href="@0@System.Core/A.html#6a1af7c3d17845e3" class="i method">Any</a>(<span id="r24 rd" class="r24 r">s</span> =&gt; <span class="r24 r">s</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#0e49386a48d578ff" class="i property">AsyncOperationResponseBody</a>.<a href="../../CommonModels/AzureAsyncOperation.cs.html#6d23217a09399a5b" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>)))
                {
                    <b>return</b> <b>true</b>;
                }
                <b>else</b> <b>if</b>(<a href="#3d4db07243bd1158" class="i method">IsUriEqual</a>(<a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../LROPollState.cs.html#da5138d12f33b02d" class="i property">PollingUrlToUse</a>, <a href="#afa6fa195fd22723" class="i field">CurrentPollingState</a>.<a href="../../PollingState.cs.html#71948fe4bba1a4a0" class="i property">AzureAsyncOperationHeaderLink</a>))
                {   
                    <b>return</b> <b>true</b>;
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Check URI for equality including differences in trailing slash and compare case insensitive </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">leftUrl</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Url</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">rightUrl</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Url to compare against</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="3d4db07243bd1158" href="../../R/3d4db07243bd1158.html" target="n" data-glyph="76,1" class="i method">IsUriEqual</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r25 rd" class="r25 r">leftUrl</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r26 rd" class="r26 r">rightUrl</span>)
        {
            <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r25 r">leftUrl</span>)) <b>return</b> <b>false</b>;
            <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r26 r">rightUrl</span>)) <b>return</b> <b>false</b>;
 
            <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r27 rd" class="r27 r">left</span> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r25 r">leftUrl</span>);
            <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r28 rd" class="r28 r">right</span> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r26 r">rightUrl</span>);
 
            <b>int</b> <span id="r29 rd" class="r29 r">result</span> = <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a>.<a href="@0@System/A.html#2a34dbc11959dc9e" class="i method">Compare</a>(<span class="r27 r">left</span>, <span class="r28 r">right</span>, <a href="@0@System/A.html#991327569fea4e2a" class="t t">UriComponents</a>.<a href="@0@System/A.html#ced087d46497146f" class="i field">Fragment</a>, <a href="@0@System/A.html#2edfd6a63eb427d0" class="t t">UriFormat</a>.<a href="@0@System/A.html#be4319571451825f" class="i field">SafeUnescaped</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>);
            <b>return</b> (<span class="r29 r">result</span> == 0);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
