<!DOCTYPE html>
<html><head><title>ILeaseManager.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(125);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Processor/ILeaseManager.cs" target="_top">ILeaseManager.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Processor" target="_top">..\..\Microsoft.Azure.EventHubs.Processor\src\Microsoft.Azure.EventHubs.Processor.csproj</a> (Microsoft.Azure.EventHubs.Processor)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">Processor</span>
{
    <b>using</b> <span class="i">System</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> If you wish to have EventProcessorHost store leases somewhere other than Azure Storage,</span>
    <span class="c">///</span><span class="c"> you can write your own lease manager using this interface.  </span>
    <span class="c">///</span><span class="c"> </span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">The Azure Storage managers use the same storage for both lease and checkpoints, so both</span>
    <span class="c">///</span><span class="c"> interfaces are implemented by the same class. You are free to do the same thing if you have</span>
    <span class="c">///</span><span class="c"> a unified store for both types of data.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">This interface does not specify initialization methods because we have no way of knowing what</span>
    <span class="c">///</span><span class="c"> information your implementation will require.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public interface</b> <a id="a1b8db04064deada" href="R/a1b8db04064deada.html" target="n" data-glyph="48,0" class="t t">ILeaseManager</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Allows a lease manager implementation to specify to PartitionManager how often it should</span>
        <span class="c">///</span><span class="c"> scan leases and renew them. In order to redistribute leases in a timely fashion after a host</span>
        <span class="c">///</span><span class="c"> ceases operating, we recommend a relatively short interval, such as ten seconds. Obviously it</span>
        <span class="c">///</span><span class="c"> should be less than half of the lease length, to prevent accidental expiration.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The sleep interval between scans</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="i">TimeSpan</span> <a id="aa05427817be16a1" href="R/aa05427817be16a1.html" target="n" data-glyph="102,1" class="i property">LeaseRenewInterval</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Mostly useful for testing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">Duration of a lease before it expires unless renewed.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="i">TimeSpan</span> <a id="60b7c2e59811d86b" href="R/60b7c2e59811d86b.html" target="n" data-glyph="102,1" class="i property">LeaseDuration</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Does the lease store exist?</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<b>bool</b>&gt; <a id="58460cd63091c518" href="R/58460cd63091c518.html" target="n" data-glyph="72,1" class="i method">LeaseStoreExistsAsync</a>();
  
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create the lease store if it does not exist, do nothing if it does exist.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">true if the lease store already exists or was created successfully, false if not</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<b>bool</b>&gt; <a id="cdf5866bf7187f11" href="R/cdf5866bf7187f11.html" target="n" data-glyph="72,1" class="i method">CreateLeaseStoreIfNotExistsAsync</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Not used by EventProcessorHost, but a convenient function to have for testing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">true if the lease store was deleted successfully, false if not</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<b>bool</b>&gt; <a id="ff86b0fa045cc5e0" href="R/ff86b0fa045cc5e0.html" target="n" data-glyph="72,1" class="i method">DeleteLeaseStoreAsync</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return the lease info for the specified partition. Can return null if no lease has been</span>
        <span class="c">///</span><span class="c"> created in the store for the specified partition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">id of partition to get lease for</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">lease info for the partition, or null</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a>&gt; <a id="88ff0a921ef2e56e" href="R/88ff0a921ef2e56e.html" target="n" data-glyph="72,1" class="i method">GetLeaseAsync</a>(<b>string</b> <span id="r0 rd" class="r0 r">partitionId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Return the lease info for all partitions.</span>
        <span class="c">///</span><span class="c"> A typical implementation could just call GetLeaseAsync() on all partitions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">list of lease info.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<span class="i">IEnumerable</span>&lt;<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a>&gt;&gt; <a id="1209c02345978f0e" href="R/1209c02345978f0e.html" target="n" data-glyph="72,1" class="i method">GetAllLeasesAsync</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create in the store the lease info for the given partition, if it does not exist. Do nothing if it does exist</span>
        <span class="c">///</span><span class="c"> in the store already. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">id of partition to create lease info for</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">the existing or newly-created lease info for the partition</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a>&gt; <a id="5649f7c42e2291d0" href="R/5649f7c42e2291d0.html" target="n" data-glyph="72,1" class="i method">CreateLeaseIfNotExistsAsync</a>(<b>string</b> <span id="r1 rd" class="r1 r">partitionId</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Delete the lease info for the given partition from the store. If there is no stored lease for the given partition,</span>
        <span class="c">///</span><span class="c"> that is treated as success.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">lease</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Lease info for the desired partition as previously obtained from GetLeaseAsync()</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span> <a id="dcada486fe2452e5" href="R/dcada486fe2452e5.html" target="n" data-glyph="72,1" class="i method">DeleteLeaseAsync</a>(<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a> <span id="r2 rd" class="r2 r">lease</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Acquire the lease on the desired partition for this EventProcessorHost.</span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">Note that it is legal to acquire a lease that is already owned by another host. Lease-stealing is how</span>
        <span class="c">///</span><span class="c"> partitions are redistributed when additional hosts are started.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">lease</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Lease info for the desired partition as previously obtained from GetLeaseAsync()</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">true if the lease was acquired successfully, false if not</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<b>bool</b>&gt; <a id="36b3a0ff5e8cb34b" href="R/36b3a0ff5e8cb34b.html" target="n" data-glyph="72,1" class="i method">AcquireLeaseAsync</a>(<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a> <span id="r3 rd" class="r3 r">lease</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renew a lease currently held by this host.</span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">If the lease has been stolen, or expired, or released, it is not possible to renew it. You will have to call getLease()</span>
        <span class="c">///</span><span class="c"> and then acquireLease() again.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">lease</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Lease to be renewed</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">true if the lease was renewed successfully, false if not</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<b>bool</b>&gt; <a id="200166bfbb9cd2ae" href="R/200166bfbb9cd2ae.html" target="n" data-glyph="72,1" class="i method">RenewLeaseAsync</a>(<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a> <span id="r4 rd" class="r4 r">lease</span>);      
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Give up a lease currently held by this host.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">If the lease has been stolen, or expired, releasing it is unnecessary, and will fail if attempted.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">lease</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Lease to be given up</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">true if the lease was released successfully, false if not</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<b>bool</b>&gt; <a id="b410d0dada77b996" href="R/b410d0dada77b996.html" target="n" data-glyph="72,1" class="i method">ReleaseLeaseAsync</a>(<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a> <span id="r5 rd" class="r5 r">lease</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Update the store with the information in the provided lease.</span>
        <span class="c">///</span><span class="c"> </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">It is necessary to currently hold a lease in order to update it. If the lease has been stolen, or expired, or</span>
        <span class="c">///</span><span class="c"> released, it cannot be updated. Updating should renew the lease before performing the update to avoid lease</span>
        <span class="c">///</span><span class="c"> expiration during the process.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">lease</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">New lease info to be stored</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">true if the updated was performed successfully, false if not</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="i">Task</span>&lt;<b>bool</b>&gt; <a id="9f6d318f7e43dc6d" href="R/9f6d318f7e43dc6d.html" target="n" data-glyph="72,1" class="i method">UpdateLeaseAsync</a>(<a href="Lease.cs.html#6a215b3b2a51b99b" class="t t">Lease</a> <span id="r6 rd" class="r6 r">lease</span>);
    }
}</pre></td></tr></table></div></body></html>
