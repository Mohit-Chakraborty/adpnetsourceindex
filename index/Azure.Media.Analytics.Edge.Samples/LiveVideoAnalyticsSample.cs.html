<!DOCTYPE html>
<html><head><title>LiveVideoAnalyticsSample.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(179);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Media.Analytics.Edge.Samples/LiveVideoAnalyticsSample.cs" target="_top">LiveVideoAnalyticsSample.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Media.Analytics.Edge.Samples" target="_top">Azure.Media.Analytics.Edge.Samples.csproj</a> (Azure.Media.Analytics.Edge.Samples)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Media</span>.<span class="i n">Analytics</span>.<span class="i n">Edge</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Devices</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
<b>using</b> <span class="i n">Newtonsoft</span>.<span class="i n">Json</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Media</span>.<span class="i n">Analytics</span>.<span class="i n">Edge</span>.<span class="i n">Samples</span>
{
    <b>public class</b> <a id="7aeccbd4f72a71fa" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">LiveVideoAnalyticsSample</a>
    {
        <b>private</b> <span class="t t">ServiceClient</span> <a id="83de271c2ca85fa3" href="R/83de271c2ca85fa3.html" target="n" data-glyph="46,1" class="i field">_serviceClient</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="c537036935bab7d9" href="R/c537036935bab7d9.html" target="n" data-glyph="46,1" class="i field">_deviceId</a> = <span class="s">&quot;deviceId&quot;</span>;
        <b>private</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <a id="cac53aed777b2a10" href="R/cac53aed777b2a10.html" target="n" data-glyph="46,1" class="i field">_moduleId</a> = <span class="s">&quot;moduleId&quot;</span>;
 
        <b>public</b> <a id="316ab939d25d5c2f" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">LiveVideoAnalyticsSample</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_MediaServices_Samples_ConnectionString
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r0 rd" class="r0 r">connectionString</span> = <span class="s">&quot;connectionString&quot;</span>;
            <a href="#7aeccbd4f72a71fa" class="k">this</a>.<a href="#83de271c2ca85fa3" class="i field">_serviceClient</a> = <span class="t t">ServiceClient</span>.<span class="i method">CreateFromConnectionString</span>(<span class="r0 r">connectionString</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_MediaServices_Samples_ConnectionString
 
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="8d803c57517cde65" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SendGraphRequests</a>()
        {
            <b>try</b>
            {
                <span class="c">// create a graph topology and graph instance</span>
                <a href="/Azure.Media.Analytics.Edge/A.html#c3dcb8e7d67f5626" class="k">var</a> <span id="r1 rd" class="r1 r">graphTopology</span> = <a href="#c2f4a3721a60d24d" class="i method">BuildGraphTopology</a>();
                <a href="/Azure.Media.Analytics.Edge/A.html#7db7b03fe34a82d6" class="k">var</a> <span id="r2 rd" class="r2 r">graphInstance</span> = <a href="#2bed1f08dd6774d7" class="i method">BuildGraphInstance</a>(<span class="r1 r">graphTopology</span>.<a href="/Azure.Media.Analytics.Edge/A.html#a903970bc7a3e714" class="i property">Name</a>);
 
                <span class="c">//set graph topology without using helper function</span>
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_MediaServices_Samples_InvokeDirectMethod
                <a href="/Azure.Media.Analytics.Edge/A.html#418cc8340094ee8d" class="k">var</a> <span id="r3 rd" class="r3 r">setGraphRequest</span> = <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#d5a58921cfe22861" class="t constructor">MediaGraphTopologySetRequest</a>(<span class="r1 r">graphTopology</span>);
 
                <b>var</b> <span id="r4 rd" class="r4 r">directMethod</span> = <b>new</b> <span class="t constructor">CloudToDeviceMethod</span>(<span class="r3 r">setGraphRequest</span>.<a href="/Azure.Media.Analytics.Edge/A.html#fa24a158b6d764ba" class="i property">MethodName</a>);
                <span class="r4 r">directMethod</span>.<span class="i method">SetPayloadJson</span>(<span class="r3 r">setGraphRequest</span>.<a href="/Azure.Media.Analytics.Edge/A.html#3069680513b396b2" class="i method">GetPayloadAsJson</a>());
 
                <b>var</b> <span id="r5 rd" class="r5 r">setGraphResponse</span> = <b>await</b> <a href="#83de271c2ca85fa3" class="i field">_serviceClient</a>.<span class="i method">InvokeDeviceMethodAsync</span>(<a href="#c537036935bab7d9" class="i field">_deviceId</a>, <a href="#cac53aed777b2a10" class="i field">_moduleId</a>, <span class="r4 r">directMethod</span>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_MediaServices_Samples_InvokeDirectMethod
 
                <span class="c">// get a graph topology using helper function</span>
                <b>var</b> <span id="r6 rd" class="r6 r">getGraphResponse</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#e48439e794e6f616" class="t constructor">MediaGraphTopologyGetRequest</a>(<span class="r1 r">graphTopology</span>.<a href="/Azure.Media.Analytics.Edge/A.html#a903970bc7a3e714" class="i property">Name</a>));
                <a href="/Azure.Media.Analytics.Edge/A.html#c3dcb8e7d67f5626" class="k">var</a> <span id="r7 rd" class="r7 r">getGraphResult</span> = <a href="/Azure.Media.Analytics.Edge/A.html#c3dcb8e7d67f5626" class="t t">MediaGraphTopology</a>.<a href="/Azure.Media.Analytics.Edge/A.html#0634079f62d75c44" class="i method">Deserialize</a>(<span class="r6 r">getGraphResponse</span>.<span class="i method">GetPayloadAsJson</span>());
 
                <span class="c">// list all graph topologies</span>
                <b>var</b> <span id="r8 rd" class="r8 r">listGraphResponse</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#487311994016e80e" class="t constructor">MediaGraphTopologyListRequest</a>());
                <a href="/Azure.Media.Analytics.Edge/A.html#6788cedfc5c2b95c" class="k">var</a> <span id="r9 rd" class="r9 r">listGraphResult</span> = <a href="/Azure.Media.Analytics.Edge/A.html#6788cedfc5c2b95c" class="t t">MediaGraphTopologyCollection</a>.<a href="/Azure.Media.Analytics.Edge/A.html#14d89aefe38835e6" class="i method">Deserialize</a>(<span class="r8 r">listGraphResponse</span>.<span class="i method">GetPayloadAsJson</span>());
 
                <span class="c">//set graph instance</span>
                <b>var</b> <span id="r10 rd" class="r10 r">setGraphInstanceResult</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#8965409ff6673683" class="t constructor">MediaGraphInstanceSetRequest</a>(<span class="r2 r">graphInstance</span>));
 
                <span class="c">//activate graph instance</span>
                <b>var</b> <span id="r11 rd" class="r11 r">activateGraphResponse</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#f4f9397c602120d2" class="t constructor">MediaGraphInstanceActivateRequest</a>(<span class="r2 r">graphInstance</span>.<a href="/Azure.Media.Analytics.Edge/A.html#263d6318f1d659f9" class="i property">Name</a>));
 
                <span class="c">//get instance</span>
                <b>var</b> <span id="r12 rd" class="r12 r">getGraphInstanceResponse</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#1c1050ed91da1b58" class="t constructor">MediaGraphInstanceGetRequest</a>(<span class="r2 r">graphInstance</span>.<a href="/Azure.Media.Analytics.Edge/A.html#263d6318f1d659f9" class="i property">Name</a>));
                <a href="/Azure.Media.Analytics.Edge/A.html#7db7b03fe34a82d6" class="k">var</a> <span id="r13 rd" class="r13 r">getGraphInstanceResult</span> = <a href="/Azure.Media.Analytics.Edge/A.html#7db7b03fe34a82d6" class="t t">MediaGraphInstance</a>.<a href="/Azure.Media.Analytics.Edge/A.html#46620691bc8b5ca7" class="i method">Deserialize</a>(<span class="r12 r">getGraphInstanceResponse</span>.<span class="i method">GetPayloadAsJson</span>());
 
                <span class="c">// list all graph instance</span>
                <b>var</b> <span id="r14 rd" class="r14 r">listGraphInstanceResponse</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#fc91f70226c3810a" class="t constructor">MediaGraphInstanceListRequest</a>());
                <a href="/Azure.Media.Analytics.Edge/A.html#2023f28c271dca84" class="k">var</a> <span id="r15 rd" class="r15 r">listGraphInstanceResult</span> = <a href="/Azure.Media.Analytics.Edge/A.html#2023f28c271dca84" class="t t">MediaGraphInstanceCollection</a>.<a href="/Azure.Media.Analytics.Edge/A.html#a9667b2b51d4e4b5" class="i method">Deserialize</a>(<span class="r14 r">listGraphInstanceResponse</span>.<span class="i method">GetPayloadAsJson</span>());
 
                <span class="c">//get deactive graph</span>
                <b>var</b> <span id="r16 rd" class="r16 r">deactiveGraphInstance</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#7cdd90e013b5d234" class="t constructor">MediaGraphInstanceDeActivateRequest</a>(<span class="r2 r">graphInstance</span>.<a href="/Azure.Media.Analytics.Edge/A.html#263d6318f1d659f9" class="i property">Name</a>));
 
                <span class="c">//delete graph</span>
                <b>var</b> <span id="r17 rd" class="r17 r">deleteGraphTopology</span> = <b>await</b> <a href="#b9658c9a96aea689" class="i method">InvokeDirectMethodHelper</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#339fc82f774dadce" class="t constructor">MediaGraphTopologyDeleteRequest</a>(<span class="r1 r">graphTopology</span>.<a href="/Azure.Media.Analytics.Edge/A.html#a903970bc7a3e714" class="i property">Name</a>));
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r18 rd" class="r18 r">ex</span>)
            {
                <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="r18 r">ex</span>.<a href="@0@mscorlib/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
            }
        }
 
        <b>private async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<span class="t t">CloudToDeviceMethodResult</span>&gt; <a id="b9658c9a96aea689" href="R/b9658c9a96aea689.html" target="n" data-glyph="76,1" class="i method">InvokeDirectMethodHelper</a>(<a href="/Azure.Media.Analytics.Edge/A.html#ee33cb05aa8ac549" class="t t">MethodRequest</a> <span id="r19 rd" class="r19 r">bc</span>)
        {
            <b>var</b> <span id="r20 rd" class="r20 r">directMethod</span> = <b>new</b> <span class="t constructor">CloudToDeviceMethod</span>(<span class="r19 r">bc</span>.<a href="/Azure.Media.Analytics.Edge/A.html#fa24a158b6d764ba" class="i property">MethodName</a>);
            <span class="r20 r">directMethod</span>.<span class="i method">SetPayloadJson</span>(<span class="r19 r">bc</span>.<a href="/Azure.Media.Analytics.Edge/A.html#a1d5938cae141816" class="i method">GetPayloadAsJson</a>());
 
            <b>return</b> <b>await</b> <a href="#83de271c2ca85fa3" class="i field">_serviceClient</a>.<span class="i method">InvokeDeviceMethodAsync</span>(<a href="#c537036935bab7d9" class="i field">_deviceId</a>, <a href="#cac53aed777b2a10" class="i field">_moduleId</a>, <span class="r20 r">directMethod</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_MediaServices_Samples_BuildInstance
        <b>private</b> <a href="/Azure.Media.Analytics.Edge/A.html#7db7b03fe34a82d6" class="t t">MediaGraphInstance</a> <a id="2bed1f08dd6774d7" href="R/2bed1f08dd6774d7.html" target="n" data-glyph="76,1" class="i method">BuildGraphInstance</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r21 rd" class="r21 r">graphTopologyName</span>)
        {
            <a href="/Azure.Media.Analytics.Edge/A.html#017358ba2d8c4a50" class="k">var</a> <span id="r22 rd" class="r22 r">graphInstanceProperties</span> = <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#181d8535ebb79357" class="t constructor">MediaGraphInstanceProperties</a>
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#80ca773cb3621bb7" class="i property">Description</a> = <span class="s">&quot;Sample graph description&quot;</span>,
                <a href="/Azure.Media.Analytics.Edge/A.html#906e335765ce054f" class="i property">TopologyName</a> = <span class="r21 r">graphTopologyName</span>,
            };
 
            <span class="r22 r">graphInstanceProperties</span>.<a href="/Azure.Media.Analytics.Edge/A.html#5d2e6b03c7b20d1c" class="i property">Parameters</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#3780b37dd7e66e4b" class="t constructor">MediaGraphParameterDefinition</a>(<span class="s">&quot;rtspUrl&quot;</span>, <span class="s">&quot;rtsp://sample.com&quot;</span>));
 
            <b>return</b> <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#16c5cb096e2a7ece" class="t constructor">MediaGraphInstance</a>(<span class="s">&quot;graphInstance&quot;</span>)
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#21ad1f168ad3da8d" class="i property">Properties</a> = <span class="r22 r">graphInstanceProperties</span>
            };
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_MediaServices_Samples_BuildInstance
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_MediaServices_Samples_BuildTopology
        <b>private</b> <a href="/Azure.Media.Analytics.Edge/A.html#c3dcb8e7d67f5626" class="t t">MediaGraphTopology</a> <a id="c2f4a3721a60d24d" href="R/c2f4a3721a60d24d.html" target="n" data-glyph="76,1" class="i method">BuildGraphTopology</a>()
        {
            <a href="/Azure.Media.Analytics.Edge/A.html#390ebcb244a78987" class="k">var</a> <span id="r23 rd" class="r23 r">graphProperties</span> = <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#3ea81da34504be59" class="t constructor">MediaGraphTopologyProperties</a>
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#5ab35afe195ff43d" class="i property">Description</a> = <span class="s">&quot;Continuous video recording to an Azure Media Services Asset&quot;</span>,
            };
            <a href="#2896af3a34222873" class="i method">SetParameters</a>(<span class="r23 r">graphProperties</span>);
            <a href="#85ddbbd1fd590b5b" class="i method">SetSources</a>(<span class="r23 r">graphProperties</span>);
            <a href="#1953cf4f33278db8" class="i method">SetSinks</a>(<span class="r23 r">graphProperties</span>);
            <b>return</b> <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#cd29a05bfa22b256" class="t constructor">MediaGraphTopology</a>(<span class="s">&quot;ContinuousRecording&quot;</span>)
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#dc0007e1c2e11ee9" class="i property">Properties</a> = <span class="r23 r">graphProperties</span>
            };
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_MediaServices_Samples_BuildTopology
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_MediaServices_Samples_SetParameters
        <span class="c">// Add parameters to Topology</span>
        <b>private void</b> <a id="2896af3a34222873" href="R/2896af3a34222873.html" target="n" data-glyph="76,1" class="i method">SetParameters</a>(<a href="/Azure.Media.Analytics.Edge/A.html#390ebcb244a78987" class="t t">MediaGraphTopologyProperties</a> <span id="r24 rd" class="r24 r">graphProperties</span>)
        {
            <span class="r24 r">graphProperties</span>.<a href="/Azure.Media.Analytics.Edge/A.html#9adc12030c19ebf1" class="i property">Parameters</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#0b460ab1a28fdfa5" class="t constructor">MediaGraphParameterDeclaration</a>(<span class="s">&quot;rtspUserName&quot;</span>, <a href="/Azure.Media.Analytics.Edge/A.html#4d2003faf2c95f02" class="t t">MediaGraphParameterType</a>.<a href="/Azure.Media.Analytics.Edge/A.html#8bc044a647220bec" class="i property">String</a>)
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#b56c64dbf1db1218" class="i property">Description</a> = <span class="s">&quot;rtsp source user name.&quot;</span>,
                <a href="/Azure.Media.Analytics.Edge/A.html#35b680706b41ddd0" class="i property">Default</a> = <span class="s">&quot;dummyUserName&quot;</span>
            });
            <span class="r24 r">graphProperties</span>.<a href="/Azure.Media.Analytics.Edge/A.html#9adc12030c19ebf1" class="i property">Parameters</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#0b460ab1a28fdfa5" class="t constructor">MediaGraphParameterDeclaration</a>(<span class="s">&quot;rtspPassword&quot;</span>, <a href="/Azure.Media.Analytics.Edge/A.html#4d2003faf2c95f02" class="t t">MediaGraphParameterType</a>.<a href="/Azure.Media.Analytics.Edge/A.html#82530753d059f47c" class="i property">SecretString</a>)
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#b56c64dbf1db1218" class="i property">Description</a> = <span class="s">&quot;rtsp source password.&quot;</span>,
                <a href="/Azure.Media.Analytics.Edge/A.html#35b680706b41ddd0" class="i property">Default</a> = <span class="s">&quot;dummyPassword&quot;</span>
            });
            <span class="r24 r">graphProperties</span>.<a href="/Azure.Media.Analytics.Edge/A.html#9adc12030c19ebf1" class="i property">Parameters</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#0b460ab1a28fdfa5" class="t constructor">MediaGraphParameterDeclaration</a>(<span class="s">&quot;rtspUrl&quot;</span>, <a href="/Azure.Media.Analytics.Edge/A.html#4d2003faf2c95f02" class="t t">MediaGraphParameterType</a>.<a href="/Azure.Media.Analytics.Edge/A.html#8bc044a647220bec" class="i property">String</a>)
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#b56c64dbf1db1218" class="i property">Description</a> = <span class="s">&quot;rtsp Url&quot;</span>
            });
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_MediaServices_Samples_SetParameters
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_MediaServices_Samples_SetSourcesSinks
        <span class="c">// Add sources to Topology</span>
        <b>private void</b> <a id="85ddbbd1fd590b5b" href="R/85ddbbd1fd590b5b.html" target="n" data-glyph="76,1" class="i method">SetSources</a>(<a href="/Azure.Media.Analytics.Edge/A.html#390ebcb244a78987" class="t t">MediaGraphTopologyProperties</a> <span id="r25 rd" class="r25 r">graphProperties</span>)
        {
            <span class="r25 r">graphProperties</span>.<a href="/Azure.Media.Analytics.Edge/A.html#f07b61fdf63b2a74" class="i property">Sources</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#a2cf823a36db767b" class="t constructor">MediaGraphRtspSource</a>(<span class="s">&quot;rtspSource&quot;</span>, <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#c3155a608692fa16" class="t constructor">MediaGraphUnsecuredEndpoint</a>(<span class="s">&quot;${rtspUrl}&quot;</span>)
                {
                    <a href="/Azure.Media.Analytics.Edge/A.html#315a153d1df7891a" class="i property">Credentials</a> = <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#407344dd0300a660" class="t constructor">MediaGraphUsernamePasswordCredentials</a>(<span class="s">&quot;${rtspUserName}&quot;</span>, <span class="s">&quot;${rtspPassword}&quot;</span>)
                })
            );
        }
 
        <span class="c">// Add sinks to Topology</span>
        <b>private void</b> <a id="1953cf4f33278db8" href="R/1953cf4f33278db8.html" target="n" data-glyph="76,1" class="i method">SetSinks</a>(<a href="/Azure.Media.Analytics.Edge/A.html#390ebcb244a78987" class="t t">MediaGraphTopologyProperties</a> <span id="r26 rd" class="r26 r">graphProperties</span>)
        {
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r27 rd" class="r27 r">graphNodeInput</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Azure.Media.Analytics.Edge/A.html#2d5e21504cb9a3d0" class="t t">MediaGraphNodeInput</a>&gt;
            {
                <b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#2389cb0bbb27c330" class="t constructor">MediaGraphNodeInput</a>(<span class="s">&quot;rtspSource&quot;</span>)
            };
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r28 rd" class="r28 r">cachePath</span> = <span class="s">&quot;/var/lib/azuremediaservices/tmp/&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r29 rd" class="r29 r">cacheMaxSize</span> = <span class="s">&quot;2048&quot;</span>;
            <span class="r26 r">graphProperties</span>.<a href="/Azure.Media.Analytics.Edge/A.html#79835c39e3d26b6e" class="i property">Sinks</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<b>new</b> <a href="/Azure.Media.Analytics.Edge/A.html#077d8438c95259e6" class="t constructor">MediaGraphAssetSink</a>(<span class="s">&quot;assetSink&quot;</span>, <span class="r27 r">graphNodeInput</span>, <span class="s">&quot;sampleAsset-${System.GraphTopologyName}-${System.GraphInstanceName}&quot;</span>, <span class="r28 r">cachePath</span>, <span class="r29 r">cacheMaxSize</span>)
            {
                <a href="/Azure.Media.Analytics.Edge/A.html#ff334845c769116d" class="i property">SegmentLength</a> = <span class="i n">System</span>.<span class="i n">Xml</span>.<a href="@0@System.Xml/A.html#a86aaa213fe90295" class="t t">XmlConvert</a>.<a href="@0@System.Xml/A.html#c9a9be0d549ba0df" class="i method">ToString</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(30)),
            });
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_MediaServices_Samples_SetSourcesSinks
    }
}
</pre></td></tr></table></div></body></html>
