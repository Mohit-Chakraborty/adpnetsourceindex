<!DOCTYPE html>
<html><head><title>SqlVirtualMachineTestContext.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(89);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#SqlVirtualMachine.Tests/Utilities/SqlVirtualMachineTestContext.cs" target="_top">Utilities\SqlVirtualMachineTestContext.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#SqlVirtualMachine.Tests" target="_top">tests\Microsoft.Azure.Management.SqlVirtualMachine.Tests.csproj</a> (SqlVirtualMachine.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">Compute</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">Network</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">ResourceManager</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">Resources</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">Resources</span>.<span class="i">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">SqlVirtualMachine</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">SqlVirtualMachine</span>.<span class="i n">Tests</span>.<span class="i n">Utilities</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">Storage</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">ClientRuntime</span>.<span class="i">Azure</span>.<span class="i">TestFramework</span>;
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
 
<b>namespace</b> <span class="i n">SqlVirtualMachine</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="bf0df8ab08615671" href="../R/bf0df8ab08615671.html" target="n" data-glyph="0,0" class="t t">SqlVirtualMachineTestContext</a> : <span class="i">IDisposable</span>
    {
        <b>public string</b> <a id="0abc6bf84d153df2" href="../R/0abc6bf84d153df2.html" target="n" data-glyph="42,1" class="i field">location</a>;
 
        <b>public</b> <a href="MockClient.cs.html#3a07f20aea586dcd" class="t t">MockClient</a> <a id="6e6e6d518b77ee1c" href="../R/6e6e6d518b77ee1c.html" target="n" data-glyph="42,1" class="i field">client</a>;
       
        <b>public</b> <span class="i">ResourceGroup</span> <a id="cf6c88bf2dca3149" href="../R/cf6c88bf2dca3149.html" target="n" data-glyph="102,1" class="i property">resourceGroup</a> { <b>get</b>; <b>private set</b>; }
 
        <b>private</b> <span class="i">MockContext</span> <a id="356ffb6eba724f61" href="../R/356ffb6eba724f61.html" target="n" data-glyph="46,1" class="i field">_mockContext</a>;
        
        <b>private int</b> <a id="ae832c1e5c7ae32a" href="../R/ae832c1e5c7ae32a.html" target="n" data-glyph="46,1" class="i field">resourceCounter</a> = 0;
 
        <b>private bool</b> <a id="7e32b15d5225c48b" href="../R/7e32b15d5225c48b.html" target="n" data-glyph="46,1" class="i field">disposedValue</a> = <b>false</b>;
 
        <b>public</b> <a id="641f9dee1ab67f51" href="../R/641f9dee1ab67f51.html" target="n" data-glyph="72,1" class="t constructor">SqlVirtualMachineTestContext</a>(<b>object</b> <span id="r0 rd" class="r0 r">suiteObject</span>, [<span class="i">CallerMemberName</span>] <b>string</b> <span id="r1 rd" class="r1 r">testName</span> = <span class="s">&quot;error_determining_test_name&quot;</span>)
        {
            <a href="#0abc6bf84d153df2" class="i field">location</a> = <a href="Contants.cs.html#038f0701be1951e8" class="t t">Constants</a>.<a href="Contants.cs.html#982cb5bbb12ffea7" class="i field">location</a>;
            <a href="#356ffb6eba724f61" class="i field">_mockContext</a> = <span class="i">MockContext</span>.<span class="i">Start</span>(<span class="r0 r">suiteObject</span>.<span class="i">GetType</span>(), <span class="r1 r">testName</span>);
            <a href="#6e6e6d518b77ee1c" class="i field">client</a> = <b>new</b> <a href="MockClient.cs.html#7561f997d6ebbe06" class="t constructor">MockClient</a>(<a href="#356ffb6eba724f61" class="i field">_mockContext</a>);
            <a href="#cf6c88bf2dca3149" class="i property">resourceGroup</a> = <a href="#77bc3ba8030e8b7d" class="i method">CreateResourceGroup</a>(<a href="#0abc6bf84d153df2" class="i field">location</a>);
        }
 
        <b>public</b> <span class="i">ResourceGroup</span> <a id="77bc3ba8030e8b7d" href="../R/77bc3ba8030e8b7d.html" target="n" data-glyph="72,1" class="i method">CreateResourceGroup</a>(<b>string</b> <span id="r2 rd" class="r2 r">location</span>)
        {
            <b>string</b> <span id="r3 rd" class="r3 r">rgName</span> = <a href="Contants.cs.html#038f0701be1951e8" class="t t">Constants</a>.<a href="Contants.cs.html#53dd837395d57f88" class="i field">resourceGroupName</a>;
            <b>var</b> <span id="r4 rd" class="r4 r">resourceGroup</span> = <a href="#6e6e6d518b77ee1c" class="i field">client</a>.<a href="MockClient.cs.html#d49db0ee33f66747" class="i property">resourceClient</a>.<span class="i">ResourceGroups</span>.<span class="i">CreateOrUpdate</span>(<span class="r3 r">rgName</span>, <b>new</b> <span class="i">ResourceGroup</span>()
            {
                <span class="i">Location</span> = <a href="#bf0df8ab08615671" class="k">this</a>.<a href="#0abc6bf84d153df2" class="i field">location</a>,
            });
            <b>return</b> <span class="r4 r">resourceGroup</span>;
        }
 
        <b>private void</b> <a id="dcae3e1e7bfee898" href="../R/dcae3e1e7bfee898.html" target="n" data-glyph="76,1" class="i method">DeleteResourceGroup</a>()
        {
            <a href="#6e6e6d518b77ee1c" class="i field">client</a>.<a href="MockClient.cs.html#d49db0ee33f66747" class="i property">resourceClient</a>.<span class="i">ResourceGroups</span>.<span class="i">Delete</span>(<a href="#cf6c88bf2dca3149" class="i property">resourceGroup</a>.<span class="i">Name</span>);
        }
 
        <b>public</b> <a href="/Microsoft.Azure.Management.SqlVirtualMachine/A.html#22143e4ee6c70b19" class="t t">SqlVirtualMachineManagementClient</a> <a id="a573daab955f7587" href="../R/a573daab955f7587.html" target="n" data-glyph="72,1" class="i method">getSqlClient</a>()
        {
            <b>return</b> <a href="#6e6e6d518b77ee1c" class="i field">client</a>.<a href="MockClient.cs.html#6c7be7ae793e97ec" class="i property">sqlClient</a>;
        }
 
        <b>public string</b> <a id="e2fb01888a603618" href="../R/e2fb01888a603618.html" target="n" data-glyph="72,1" class="i method">generateResourceName</a>()
        {
            <b>return</b> <span class="s">&quot;test-&quot;</span> + (++<a href="#ae832c1e5c7ae32a" class="i field">resourceCounter</a>);
        }
 
        <b>protected virtual void</b> <a id="09d066e31699a673" href="../R/09d066e31699a673.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r5 rd" class="r5 r">disposing</span>)
        {
            <b>if</b> (!<a href="#7e32b15d5225c48b" class="i field">disposedValue</a>)
            {
                <b>if</b> (<span class="r5 r">disposing</span>)
                {
                    <a href="#dcae3e1e7bfee898" class="i method">DeleteResourceGroup</a>();
 
                    <span class="c">// Dispose client</span>
                    <a href="#6e6e6d518b77ee1c" class="i field">client</a>.<a href="MockClient.cs.html#c3fa1771bdb242db" class="i method">Dispose</a>();
 
                    <span class="c">// Dispose context</span>
                    <a href="#356ffb6eba724f61" class="i field">_mockContext</a>.<span class="i">Dispose</span>();
                }
                <a href="#7e32b15d5225c48b" class="i field">disposedValue</a> = <b>true</b>;
            }
        }
 
        <span class="c">// This code added to correctly implement the disposable pattern.</span>
        <b>public void</b> <a id="85b73089fd8ba44d" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#09d066e31699a673" class="i method">Dispose</a>(<b>true</b>);
        }
    }
}</pre></td></tr></table></div></body></html>
