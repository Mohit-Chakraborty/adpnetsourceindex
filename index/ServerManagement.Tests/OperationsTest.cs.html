<!DOCTYPE html>
<html><head><title>OperationsTest.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(565);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#ServerManagement.Tests/OperationsTest.cs" target="_top">OperationsTest.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/servermanagement/Microsoft.Azure.Management.ServerManagement/tests/OperationsTest.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#ServerManagement.Tests" target="_top">Microsoft.Azure.Management.ServerManagement.Tests.csproj</a> (ServerManagement.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for</span>
<span class="c">// license information.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">ServerManagement</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">ServerManagement</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">Azure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">ClientRuntime</span>.<span class="i n">Azure</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Xunit</span>;
<b>using</b> <span class="i n">Xunit</span>.<span class="i n">Abstractions</span>;
 
<b>namespace</b> <span class="i n">ServerManagement</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="1fa8f735f1185dff" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">OperationsTest</a> : <a href="ServerManagementTestBase.cs.html#aa270c4456625330" class="t t">ServerManagementTestBase</a>
    {
        <b>public</b> <a id="47d04534a133a3d7" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">OperationsTest</a>(<span class="t t">ITestOutputHelper</span> <span id="r0 rd" class="r0 r">output</span>) : <a href="ServerManagementTestBase.cs.html#80c002d31168424b" class="k">base</a>(<span class="r0 r">output</span>)
        {
        }
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5a10d82c5bc5b13b" href="R/5a10d82c5bc5b13b.html" target="n" data-glyph="76,1" class="i method">RunPowerShellCommand</a>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="t t">ServerManagementClient</a> <span id="r1 rd" class="r1 r">client</span>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="t t">NodeResource</a> <span id="r2 rd" class="r2 r">node</span>,
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#e84255680b9ec48d" class="t t">SessionResource</a> <span id="r3 rd" class="r3 r">session</span>,
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#4de853940c146d17" class="t t">PowerShellSessionResource</a> <span id="r4 rd" class="r4 r">ps</span>)
        {
            <span class="c">// run a command</span>
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#0653145226c0d03b" class="k">var</a> <span id="r5 rd" class="r5 r">result</span> =
                <b>await</b>
                    <span class="r1 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#d5808e826321d01b" class="i property">PowerShell</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ddffcda77b4f92cb" class="i method">InvokeCommandAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                        <span class="r2 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                        <span class="r3 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                        <span class="r4 r">ps</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#7de0801159289d58" class="i property">SessionId</a>,
                        <span class="s">&quot;dir c:\\&quot;</span>);
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r5 r">result</span>);
 
            <span class="c">// did the command complete successfully?t</span>
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r5 r">result</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#18de61c2994d7bed" class="i property">Completed</a>);
 
            <span class="c">// did we get some results?</span>
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r6 rd" class="r6 r">found</span> = <b>false</b>;
            <b>foreach</b> (<a href="/Microsoft.Azure.Management.ServerManagement/A.html#bd635ffe9ae3a261" class="k">var</a> <span id="r7 rd" class="r7 r">r</span> <b>in</b> <span class="r5 r">result</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#0b6727d5551025b6" class="i property">Results</a>)
            {
                <span class="r6 r">found</span> = <b>true</b>;
                <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; {0}&quot;</span>, <span class="r7 r">r</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
            }
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r6 r">found</span>);
        }
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c7f6cc1e12496359" href="R/c7f6cc1e12496359.html" target="n" data-glyph="76,1" class="i method">RunLongPowerShellCommand</a>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="t t">ServerManagementClient</a> <span id="r8 rd" class="r8 r">client</span>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="t t">NodeResource</a> <span id="r9 rd" class="r9 r">node</span>,
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#e84255680b9ec48d" class="t t">SessionResource</a> <span id="r10 rd" class="r10 r">session</span>,
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#4de853940c146d17" class="t t">PowerShellSessionResource</a> <span id="r11 rd" class="r11 r">ps</span>)
        {
            <span class="c">// run a command</span>
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#0653145226c0d03b" class="k">var</a> <span id="r12 rd" class="r12 r">result</span> = <b>await</b> <span class="r8 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#d5808e826321d01b" class="i property">PowerShell</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ddffcda77b4f92cb" class="i method">InvokeCommandAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                <span class="r9 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                <span class="r10 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                <span class="r11 r">ps</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#7de0801159289d58" class="i property">SessionId</a>,
                <span class="s">&quot;dir c:\\ ; sleep 20 ; dir c:\\windows&quot;</span>);
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r12 r">result</span>);
 
            <span class="c">// this should return false because 20 seconds is too long...</span>
            <span class="c">// did the command complete successfully?</span>
            <span class="t t">Assert</span>.<span class="i method">False</span>(<span class="r12 r">result</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#18de61c2994d7bed" class="i property">Completed</a>);
 
            <span class="c">// did we get some results?</span>
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r13 rd" class="r13 r">found</span> = <b>false</b>;
            <b>foreach</b> (<a href="/Microsoft.Azure.Management.ServerManagement/A.html#bd635ffe9ae3a261" class="k">var</a> <span id="r14 rd" class="r14 r">r</span> <b>in</b> <span class="r12 r">result</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#0b6727d5551025b6" class="i property">Results</a>)
            {
                <span class="r13 r">found</span> = <b>true</b>;
                <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; {0}&quot;</span>, <span class="r14 r">r</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
            }
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r13 r">found</span>);
 
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#4c25d0dccee8d23f" class="t t">PowerShellCommandStatus</a> <span id="r15 rd" class="r15 r">more</span>;
            <span class="r13 r">found</span> = <b>false</b>;
            <span class="c">// go back for some more results.</span>
            <b>do</b>
            {
                <span class="r15 r">more</span> = <b>await</b> <span class="r8 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#d5808e826321d01b" class="i property">PowerShell</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#aa79af2045dfdb93" class="i method">GetCommandStatusAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                    <span class="r9 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                    <span class="r10 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                    <span class="r11 r">ps</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#7de0801159289d58" class="i property">SessionId</a>,
                    <a href="/Microsoft.Azure.Management.ServerManagement/A.html#b7975f23111e72a3" class="t t">PowerShellExpandOption</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#f8210f80ac3da7e9" class="i field">Output</a>);
 
                <b>foreach</b> (<a href="/Microsoft.Azure.Management.ServerManagement/A.html#bd635ffe9ae3a261" class="k">var</a> <span id="r16 rd" class="r16 r">r</span> <b>in</b> <span class="r15 r">more</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ee3c5eac86767e3a" class="i property">Results</a>)
                {
                    <span class="r13 r">found</span> = <b>true</b>;
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; {0}&quot;</span>, <span class="r16 r">r</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
                }
            } <b>while</b> (!(<span class="r15 r">more</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2b517b9a86cd9b9f" class="i property">Completed</a> ?? <b>false</b>));
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r13 r">found</span>);
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r15 r">more</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2b517b9a86cd9b9f" class="i property">Completed</a>);
        }
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="8d2f2b90342b011a" href="R/8d2f2b90342b011a.html" target="n" data-glyph="76,1" class="i method">ListPowerShellSessions</a>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="t t">ServerManagementClient</a> <span id="r17 rd" class="r17 r">client</span>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="t t">NodeResource</a> <span id="r18 rd" class="r18 r">node</span>,
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#e84255680b9ec48d" class="t t">SessionResource</a> <span id="r19 rd" class="r19 r">session</span>)
        {
            <b>bool</b> <span id="r20 rd" class="r20 r">found</span>;
            <span class="c">// list the powershell sessions open</span>
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#59eb5922e6c653cb" class="k">var</a> <span id="r21 rd" class="r21 r">sessions</span> = <b>await</b> <span class="r17 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#d5808e826321d01b" class="i property">PowerShell</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#b904c687a7a5eb71" class="i method">ListSessionAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="r18 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <span class="r19 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r21 r">sessions</span>);
            <span class="r20 r">found</span> = <b>false</b>;
            <b>foreach</b> (<a href="/Microsoft.Azure.Management.ServerManagement/A.html#4de853940c146d17" class="k">var</a> <span id="r22 rd" class="r22 r">s</span> <b>in</b> <span class="r21 r">sessions</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#748de12ad232e70b" class="i property">Value</a>)
            {
                <span class="r20 r">found</span> = <b>true</b>;
                <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; {0}&quot;</span>, <span class="r22 r">s</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
            }
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r20 r">found</span>);
        }
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#8125b18f5d7ee303" class="t t">IPage</a>&lt;<a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="t t">NodeResource</a>&gt;&gt; <a id="967cf907e4655d78" href="R/967cf907e4655d78.html" target="n" data-glyph="76,1" class="i method">ListNodesInSubscription</a>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="t t">ServerManagementClient</a> <span id="r23 rd" class="r23 r">client</span>)
        {
            <span class="c">// look at all the nodes in the subscription</span>
            <a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#8125b18f5d7ee303" class="k">var</a> <span id="r24 rd" class="r24 r">nodes</span> = <b>await</b> <span class="r23 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#fc9f0460be9fe7df" class="i property">Node</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#92cf84f516e5ffbe" class="i method">ListAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r24 r">nodes</span>);
 
            <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r25 rd" class="r25 r">found</span> = <b>false</b>;
            <b>foreach</b> (<a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="k">var</a> <span id="r26 rd" class="r26 r">n</span> <b>in</b> <span class="r24 r">nodes</span>)
            {
                <span class="r25 r">found</span> = <b>true</b>;
                <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;Found node in subscription: {0}&quot;</span>, <span class="r26 r">n</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>));
            }
 
            <span class="c">// make sure we got *some* back.</span>
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r25 r">found</span>, <span class="s">&quot;No nodes in collection&quot;</span>);
            <b>return</b> <span class="r24 r">nodes</span>;
        }
 
        <b>private static async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="t t">NodeResource</a>&gt; <a id="7984a66b8e2a095e" href="R/7984a66b8e2a095e.html" target="n" data-glyph="76,1" class="i method">CreateNode</a>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="t t">ServerManagementClient</a> <span id="r27 rd" class="r27 r">client</span>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="t t">GatewayResource</a> <span id="r28 rd" class="r28 r">gateway</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r29 rd" class="r29 r">userName</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r30 rd" class="r30 r">password</span>)
        {
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="k">var</a> <span id="r31 rd" class="r31 r">node</span> = <b>await</b> <span class="r27 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#fc9f0460be9fe7df" class="i property">Node</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5d1c72115e0ebb78" class="i method">CreateAsync</a>(
                <a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                <a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>,
                <span class="r32 r">connectionName</span>: <a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>,
                <span class="r33 r">gatewayId</span>: <span class="r28 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#07bc30facf5eda09" class="i property">Id</a>,
                <span class="r34 r">location</span>: <a href="ServerManagementTestBase.cs.html#ce15f52e44a2aedc" class="i property">Location</a>,
                <span class="r35 r">userName</span>: <span class="r29 r">userName</span>,
                <span class="r36 r">password</span>: <span class="r30 r">password</span>
                );
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r31 r">node</span>);
            <b>return</b> <span class="r31 r">node</span>;
        }
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="t t">GatewayResource</a>&gt; <a id="ea70cc25ac51362d" href="R/ea70cc25ac51362d.html" target="n" data-glyph="76,1" class="i method">CreateAndConfigureGateway</a>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="t t">ServerManagementClient</a> <span id="r37 rd" class="r37 r">client</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r38 rd" class="r38 r">GatewayName</span>)
        {
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="t t">GatewayResource</a> <span id="r39 rd" class="r39 r">gateway</span>;
            <span class="c">// create a gateway</span>
            <span class="r39 r">gateway</span> = <b>await</b> <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ff9bb0ca0359cd49" class="i method">CreateAsync</a>(
                <a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                <span class="r38 r">GatewayName</span>,
                <span class="r40 r">upgradeMode</span>: <a href="/Microsoft.Azure.Management.ServerManagement/A.html#3f17bc2069724a94" class="t t">UpgradeMode</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2c06cc85e49225a4" class="i field">Automatic</a>,
                <span class="r41 r">location</span>: <a href="ServerManagementTestBase.cs.html#ce15f52e44a2aedc" class="i property">Location</a>
                );
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r39 r">gateway</span>);
 
            <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;Created Gateway: {0}&quot;</span>, <span class="r39 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>));
 
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#e4f313b75af6a5b8" class="k">var</a> <span id="r42 rd" class="r42 r">profile</span> = <b>await</b> <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#0ccb4ab82633f74b" class="i method">GetProfileAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="r38 r">GatewayName</span>);
 
            <b>if</b> (<a href="ServerManagementTestBase.cs.html#31a0a424c711af86" class="i property">TestingInteractively</a>)
            {
                <span class="c">// stop the service</span>
                <a href="ServerManagementTestBase.cs.html#bba6bac9b87e93aa" class="i method">StopGateway</a>();
 
                <span class="c">// install the new profile</span>
                <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;Profile:\r\n{0}&quot;</span>, <span class="r42 r">profile</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
                <b>var</b> <span id="r43 rd" class="r43 r">encrypted</span> = <span class="t t">ProtectedData</span>.<span class="i method">Protect</span>(<a href="@1@System.Runtime/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@1@System.Runtime/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@1@System.Runtime/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="r42 r">profile</span>.<a href="Extensions.cs.html#ccc2cbb4cea0c736" class="i method">ToJsonTight</a>()),
                    <b>null</b>,
                    <span class="t t">DataProtectionScope</span>.<span class="i field">LocalMachine</span>);
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r44 rd" class="r44 r">path</span> = <span class="t t">Environment</span>.<span class="i method">ExpandEnvironmentVariables</span>(<span class="s">@&quot;%PROGRAMDATA%&quot;</span>) + <span class="s">@&quot;\ManagementGateway&quot;</span>;
                <span class="t t">Directory</span>.<span class="i method">CreateDirectory</span>(<span class="r44 r">path</span>);
                <span class="t t">File</span>.<span class="i method">WriteAllBytes</span>(<span class="r44 r">path</span> + <span class="s">@&quot;\GatewayProfile.json&quot;</span>, <span class="r43 r">encrypted</span>);
 
                <span class="c">// start the service.</span>
                <a href="ServerManagementTestBase.cs.html#34ca6bf5f9ff1eb2" class="i method">StartGateway</a>();
 
                <span class="c">// wait for service to initialize itself.</span>
                <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@System.Runtime/A.html#34b191a243434f6a" class="i method">Delay</a>(180 * 1000).<a href="@1@System.Runtime/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
            }
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r39 r">gateway</span>);
 
            <b>return</b> <span class="r39 r">gateway</span>;
        }
 
        <b>private async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="2bceb0b8c26c0121" href="R/2bceb0b8c26c0121.html" target="n" data-glyph="76,1" class="i method">GetTabCompletionResults</a>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="t t">ServerManagementClient</a> <span id="r45 rd" class="r45 r">client</span>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="t t">NodeResource</a> <span id="r46 rd" class="r46 r">node</span>,
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#e84255680b9ec48d" class="t t">SessionResource</a> <span id="r47 rd" class="r47 r">session</span>,
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#4de853940c146d17" class="t t">PowerShellSessionResource</a> <span id="r48 rd" class="r48 r">ps</span>)
        {
            <b>bool</b> <span id="r49 rd" class="r49 r">found</span>;
            <span class="c">// try to get tab command completion</span>
            <a href="/Microsoft.Azure.Management.ServerManagement/A.html#16a44fb46c4b63f7" class="k">var</a> <span id="r50 rd" class="r50 r">results</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#d5808e826321d01b" class="i property">PowerShell</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#19c87086168838ff" class="i method">TabCompletionAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                <span class="r46 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                <span class="r47 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                <span class="r48 r">ps</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#7de0801159289d58" class="i property">SessionId</a>,
                <span class="s">&quot;dir c:\\&quot;</span>);
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r50 r">results</span>);
            <span class="r49 r">found</span> = <b>false</b>;
            <b>foreach</b> (<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r51 rd" class="r51 r">s</span> <b>in</b> <span class="r50 r">results</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#26f634c2f7b3a050" class="i property">Results</a>)
            {
                <span class="r49 r">found</span> = <b>true</b>;
                <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot; {0}&quot;</span>, <span class="r51 r">s</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
            }
            <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r49 r">found</span>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="68a9cbb22a3f45ac" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateGatewayFailTest</a>()
        {
            <span class="c">// ensure known state before starting.</span>
            <b>await</b> <a href="ServerManagementTestBase.cs.html#55ba6778e9474fd9" class="i method">EnsurePrerequisites</a>();
 
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r52 rd" class="r52 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#35800cd66afe1c6f" class="i method">Start</a>(<span class="s">&quot;Tests&quot;</span>))
            {
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="k">var</a> <span id="r53 rd" class="r53 r">client</span> = <a href="ServerManagementTestBase.cs.html#2d9a59eb8f76dbe8" class="i method">GetServerManagementClient</a>(<span class="r52 r">context</span>);
 
                <span class="c">// try an empty string for name</span>
                <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Rest.ClientRuntime/A.html#fd7008dd8c91d3df" class="t t">ValidationException</a>&gt;(() =&gt; <span class="r53 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ff9bb0ca0359cd49" class="i method">CreateAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="s">&quot;&quot;</span>));
 
                <span class="c">// try a non existent resource group</span>
                <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Azure.Management.ServerManagement/A.html#3c1a23925601d4bd" class="t t">ErrorException</a>&gt;(
                    () =&gt; <span class="r53 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ff9bb0ca0359cd49" class="i method">CreateAsync</a>(<span class="s">&quot;mary had a little lamb&quot;</span>, <span class="s">&quot;testgateway&quot;</span>));
 
                <span class="c">// try a bad location</span>
                <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Azure.Management.ServerManagement/A.html#3c1a23925601d4bd" class="t t">ErrorException</a>&gt;(
                    () =&gt; <span class="r53 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ff9bb0ca0359cd49" class="i method">CreateAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="s">&quot;testgateway&quot;</span>, <span class="s">&quot;neverneverland&quot;</span>));
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="182de0e866864666" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GatewayTest</a>()
        {
            <span class="c">// ensure known state before starting.</span>
            <b>await</b> <a href="ServerManagementTestBase.cs.html#55ba6778e9474fd9" class="i method">EnsurePrerequisites</a>();
 
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r54 rd" class="r54 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#35800cd66afe1c6f" class="i method">Start</a>(<span class="s">&quot;Tests&quot;</span>))
            {
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="k">var</a> <span id="r55 rd" class="r55 r">client</span> = <a href="ServerManagementTestBase.cs.html#2d9a59eb8f76dbe8" class="i method">GetServerManagementClient</a>(<span class="r54 r">context</span>);
 
                <b>try</b>
                {
                    <span class="c">// create a gateway</span>
                    <a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="k">var</a> <span id="r56 rd" class="r56 r">gateway</span> = <b>await</b> <span class="r55 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ff9bb0ca0359cd49" class="i method">CreateAsync</a>(
                        <a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                        <a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>,
                        <span class="r40 r">upgradeMode</span>: <a href="/Microsoft.Azure.Management.ServerManagement/A.html#3f17bc2069724a94" class="t t">UpgradeMode</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2c06cc85e49225a4" class="i field">Automatic</a>,
                        <span class="r41 r">location</span>: <a href="ServerManagementTestBase.cs.html#ce15f52e44a2aedc" class="i property">Location</a>
                        );
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r56 r">gateway</span>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="s">&quot;microsoft.servermanagement/gateways&quot;</span>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#943fa1d812526c37" class="i property">Type</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#ce15f52e44a2aedc" class="i property">Location</a>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#72bf1a2871ff669e" class="i property">Location</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#3f17bc2069724a94" class="t t">UpgradeMode</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2c06cc85e49225a4" class="i field">Automatic</a>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5de877b0c0d0b742" class="i property">UpgradeMode</a>);
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="r56 r">gateway</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>());
 
                    <span class="c">// verify that we can get the gateway again.</span>
                    <span class="r56 r">gateway</span> = <b>await</b> <span class="r55 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r56 r">gateway</span>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="s">&quot;microsoft.servermanagement/gateways&quot;</span>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#943fa1d812526c37" class="i property">Type</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#ce15f52e44a2aedc" class="i property">Location</a>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#72bf1a2871ff669e" class="i property">Location</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#3f17bc2069724a94" class="t t">UpgradeMode</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2c06cc85e49225a4" class="i field">Automatic</a>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5de877b0c0d0b742" class="i property">UpgradeMode</a>);
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="r56 r">gateway</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>());
 
                    <span class="c">// update the gateway a bit.</span>
                    <span class="r56 r">gateway</span> = <b>await</b> <span class="r55 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1b4f89e2784d7879" class="i method">UpdateAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                        <a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>,
                        <a href="ServerManagementTestBase.cs.html#ce15f52e44a2aedc" class="i property">Location</a>,
                        <span class="r57 r">upgradeMode</span>: <a href="/Microsoft.Azure.Management.ServerManagement/A.html#3f17bc2069724a94" class="t t">UpgradeMode</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2c06cc85e49225a4" class="i field">Automatic</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="/Microsoft.Azure.Management.ServerManagement/A.html#3f17bc2069724a94" class="t t">UpgradeMode</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2c06cc85e49225a4" class="i field">Automatic</a>, <span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5de877b0c0d0b742" class="i property">UpgradeMode</a>);
 
                    <span class="c">// get the gateway status</span>
                    <span class="r56 r">gateway</span> = <b>await</b> <span class="r55 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#bcd232cda8b43c12" class="t t">GatewayExpandOption</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#efa8730f51c05691" class="i field">Status</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r56 r">gateway</span>);
 
                    <span class="c">// check for some extended properties</span>
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#4055bc13673dd675" class="i property">LatestPublishedMsiVersion</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r56 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1b1c6e43463cf39b" class="i property">ActiveMessageCount</a>);
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="r56 r">gateway</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>());
 
                    <span class="c">// Let&#39;s see how many gatways are in the subscription</span>
                    <a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#8125b18f5d7ee303" class="k">var</a> <span id="r58 rd" class="r58 r">gateways</span> = <b>await</b> <span class="r55 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#3d7f675222b5e05a" class="i method">ListAsync</a>();
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r58 r">gateways</span>);
 
                    <a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r59 rd" class="r59 r">found</span> = <b>false</b>;
                    <b>foreach</b> (<a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="k">var</a> <span id="r60 rd" class="r60 r">g</span> <b>in</b> <span class="r58 r">gateways</span>)
                    {
                        <span class="r59 r">found</span> = <b>true</b>;
                        <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;Found Gateway in subscription: {0}&quot;</span>, <span class="r60 r">g</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>));
                    }
 
                    <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r59 r">found</span>, <span class="s">&quot;No gateways in collection?&quot;</span>);
                }
                <b>finally</b>
                {
                    <span class="c">// remove gateway that we&#39;ve created </span>
                    <a href="ServerManagementTestBase.cs.html#36edeb0261d17d9b" class="i method">RemoveGateway</a>(<span class="r55 r">client</span>, <a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>).<a href="@1@System.Runtime/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                }
 
                <span class="c">// make sure that the gateway is gone.</span>
                <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Azure.Management.ServerManagement/A.html#3c1a23925601d4bd" class="t t">ErrorException</a>&gt;(() =&gt; <span class="r55 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#403787a7942e2142" class="i property">GatewayOne</a>));
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f9e442665ad32b06" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">NodeTest</a>()
        {
            <span class="c">// ensure known state before starting.</span>
            <b>await</b> <a href="ServerManagementTestBase.cs.html#55ba6778e9474fd9" class="i method">EnsurePrerequisites</a>();
 
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r61 rd" class="r61 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#35800cd66afe1c6f" class="i method">Start</a>(<span class="s">&quot;Tests&quot;</span>))
            {
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="k">var</a> <span id="r62 rd" class="r62 r">client</span> = <a href="ServerManagementTestBase.cs.html#2d9a59eb8f76dbe8" class="i method">GetServerManagementClient</a>(<span class="r61 r">context</span>);
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="t t">GatewayResource</a> <span id="r63 rd" class="r63 r">gateway</span> = <b>null</b>;
 
                <b>if</b> (!<a href="ServerManagementTestBase.cs.html#d78b77279e578c0c" class="i property">ForceResetGatewayProfile</a>)
                {
                    <b>try</b>
                    {
                        <span class="r63 r">gateway</span> = <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>);
 
                        <span class="c">// make sure the gateway service is running.</span>
                        <a href="ServerManagementTestBase.cs.html#34ca6bf5f9ff1eb2" class="i method">StartGateway</a>();
                    }
                    <b>catch</b>
                    {
                        <span class="c">// if it&#39;s not there, we&#39;ll create it anyway.</span>
                    }
                }
                <b>try</b>
                {
                    <b>if</b> (<span class="r63 r">gateway</span> == <b>null</b>)
                    {
                        <span class="c">// create gateway</span>
                        <b>await</b> <a href="#ea70cc25ac51362d" class="i method">CreateAndConfigureGateway</a>(<span class="r62 r">client</span>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>);
 
                        <span class="c">// get gateway status</span>
                        <span class="r63 r">gateway</span> = <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#bcd232cda8b43c12" class="t t">GatewayExpandOption</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#efa8730f51c05691" class="i field">Status</a>);
                    }
 
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Creating Node&quot;</span>);
                    <a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="k">var</a> <span id="r64 rd" class="r64 r">node</span> = <b>await</b> <a href="#7984a66b8e2a095e" class="i method">CreateNode</a>(<span class="r62 r">client</span>, <span class="r63 r">gateway</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r64 r">node</span>);
 
                    <span class="c">// get the same node again</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Getting Node&quot;</span>);
                    <span class="r64 r">node</span> = <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#fc9f0460be9fe7df" class="i property">Node</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ff89e3b87865203a" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r64 r">node</span>);
 
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>, <span class="r64 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>, <span class="r64 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#73bfd5efd95d6021" class="i property">ConnectionName</a>);
 
                    <span class="c">// get all the nodes in the subscription</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Listing Nodes&quot;</span>);
                    <a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#8125b18f5d7ee303" class="k">var</a> <span id="r65 rd" class="r65 r">nodes</span> = <b>await</b> <a href="#967cf907e4655d78" class="i method">ListNodesInSubscription</a>(<span class="r62 r">client</span>);
 
                    <span class="c">// make sure this resource group just has the one node </span>
                    <span class="r65 r">nodes</span> = <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#fc9f0460be9fe7df" class="i property">Node</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#e617c33f6539b7d4" class="i method">ListForResourceGroupAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>);
                    <span class="t t">Assert</span>.<span class="i method">Single</span>(<span class="r65 r">nodes</span>);
 
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Creating Session&quot;</span>);
                    <span class="c">// Create a session for this node.</span>
                    <a href="/Microsoft.Azure.Management.ServerManagement/A.html#e84255680b9ec48d" class="k">var</a> <span id="r66 rd" class="r66 r">session</span> = <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1fa36993ff34a04c" class="i property">Session</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13f8c439b75c1651" class="i method">CreateAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                        <span class="r64 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                        <a href="ServerManagementTestBase.cs.html#e6307178dcad137a" class="i property">SessionId</a>,
                        <a href="ServerManagementTestBase.cs.html#6ed9eb70ea2cc23c" class="i property">NodeUserName</a>,
                        <a href="ServerManagementTestBase.cs.html#9e2f3a7ad419c7fa" class="i property">NodePassword</a>);
 
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r66 r">session</span>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="r66 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <a href="ServerManagementTestBase.cs.html#e6307178dcad137a" class="i property">SessionId</a>);
 
                    <span class="c">// Get the same session again</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Getting Session&quot;</span>);
                    <span class="r66 r">session</span> = <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1fa36993ff34a04c" class="i property">Session</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#50c4840dbb44ab28" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="r64 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <span class="r66 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r66 r">session</span>);
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;Session/Get response:{0}&quot;</span>, <span class="r66 r">session</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
 
                    <span class="c">// create a powershell session inside the SMT session</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Creating PowerShell Session&quot;</span>);
                    <a href="/Microsoft.Azure.Management.ServerManagement/A.html#4de853940c146d17" class="k">var</a> <span id="r67 rd" class="r67 r">ps</span> = <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#d5808e826321d01b" class="i property">PowerShell</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#54e5ae82df71317d" class="i method">CreateSessionAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>,
                        <span class="r64 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                        <span class="r66 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>,
                        <a href="../GuidAssembly/R/00000000-0000-0000-0000-000000000000.html" target="n" class="s">&quot;00000000-0000-0000-0000-000000000000&quot;</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r67 r">ps</span>);
 
                    <span class="c">// run a powershell command on that session</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Running PowerShell command&quot;</span>);
                    <b>await</b> <a href="#5a10d82c5bc5b13b" class="i method">RunPowerShellCommand</a>(<span class="r62 r">client</span>, <span class="r64 r">node</span>, <span class="r66 r">session</span>, <span class="r67 r">ps</span>);
 
                    <span class="c">// get some tab completion results</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Try Tab Completion&quot;</span>);
                    <b>await</b> <a href="#2bceb0b8c26c0121" class="i method">GetTabCompletionResults</a>(<span class="r62 r">client</span>, <span class="r64 r">node</span>, <span class="r66 r">session</span>, <span class="r67 r">ps</span>);
 
                    <span class="c">// look at all the open powershell sessions</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;List PowerShell Sessions&quot;</span>);
                    <b>await</b> <a href="#8d2f2b90342b011a" class="i method">ListPowerShellSessions</a>(<span class="r62 r">client</span>, <span class="r64 r">node</span>, <span class="r66 r">session</span>);
 
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Try a long-running command.&quot;</span>);
                    <b>await</b> <a href="#c7f6cc1e12496359" class="i method">RunLongPowerShellCommand</a>(<span class="r62 r">client</span>, <span class="r64 r">node</span>, <span class="r66 r">session</span>, <span class="r67 r">ps</span>);
 
                    <span class="c">// clean up our active SMT session.</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Delete Session&quot;</span>);
                    <b>await</b> <span class="r62 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1fa36993ff34a04c" class="i property">Session</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#011dc1da7dbc1fda" class="i method">DeleteAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="r64 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <span class="r66 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
                }
                <b>finally</b>
                {
                    <span class="c">// remove gateway that we&#39;ve created </span>
                    <b>if</b> (<a href="ServerManagementTestBase.cs.html#d78b77279e578c0c" class="i property">ForceResetGatewayProfile</a>)
                    {
                        <a href="ServerManagementTestBase.cs.html#36edeb0261d17d9b" class="i method">RemoveGateway</a>(<span class="r62 r">client</span>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>).<a href="@1@System.Runtime/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                    }
 
                    <span class="c">// regardless, always clear the nodes out.</span>
                    <a href="ServerManagementTestBase.cs.html#4123bfe7feece3c8" class="i method">RemoveAllNodes</a>(<span class="r62 r">client</span>).<a href="@1@System.Runtime/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                }
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="481dc749662589f6" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateSession</a>()
        {
            <span class="c">// ensure known state before starting.</span>
            <b>await</b> <a href="ServerManagementTestBase.cs.html#55ba6778e9474fd9" class="i method">EnsurePrerequisites</a>();
 
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r68 rd" class="r68 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#35800cd66afe1c6f" class="i method">Start</a>(<span class="s">&quot;Tests&quot;</span>))
            {
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="k">var</a> <span id="r69 rd" class="r69 r">client</span> = <a href="ServerManagementTestBase.cs.html#2d9a59eb8f76dbe8" class="i method">GetServerManagementClient</a>(<span class="r68 r">context</span>);
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="t t">GatewayResource</a> <span id="r70 rd" class="r70 r">gateway</span> = <b>null</b>;
 
                <b>if</b> (!<a href="ServerManagementTestBase.cs.html#d78b77279e578c0c" class="i property">ForceResetGatewayProfile</a>)
                {
                    <b>try</b>
                    {
                        <span class="r70 r">gateway</span> = <b>await</b> <span class="r69 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#bcd232cda8b43c12" class="t t">GatewayExpandOption</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#efa8730f51c05691" class="i field">Status</a>);
 
                        <span class="c">// make sure the gateway service is running.</span>
                        <a href="ServerManagementTestBase.cs.html#34ca6bf5f9ff1eb2" class="i method">StartGateway</a>();
                    }
                    <b>catch</b>
                    {
                        <span class="c">// if it&#39;s not there, we&#39;ll create it anyway.</span>
                    }
                }
 
                <b>try</b>
                {
                    <b>if</b> (<span class="r70 r">gateway</span> == <b>null</b>)
                    {
                        <span class="c">// create gateway</span>
                        <b>await</b> <a href="#ea70cc25ac51362d" class="i method">CreateAndConfigureGateway</a>(<span class="r69 r">client</span>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>);
 
                        <span class="c">// get gateway status</span>
                        <span class="r70 r">gateway</span> = <b>await</b> <span class="r69 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#bcd232cda8b43c12" class="t t">GatewayExpandOption</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#efa8730f51c05691" class="i field">Status</a>);
                    }
 
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Creating Node&quot;</span>);
                    <a href="/Microsoft.Azure.Management.ServerManagement/A.html#edcfdd73c9ff2d67" class="k">var</a> <span id="r71 rd" class="r71 r">node</span> = <b>await</b> <a href="#7984a66b8e2a095e" class="i method">CreateNode</a>(<span class="r69 r">client</span>, <span class="r70 r">gateway</span>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#c9f70a27facb27cf" class="i field">Empty</a>, <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="t t">String</a>.<a href="@1@System.Runtime/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r71 r">node</span>);
 
                    <span class="c">// get the same node again</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Getting Node&quot;</span>);
                    <span class="r71 r">node</span> = <b>await</b> <span class="r69 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#fc9f0460be9fe7df" class="i property">Node</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#ff89e3b87865203a" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r71 r">node</span>);
 
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>, <span class="r71 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="ServerManagementTestBase.cs.html#511a120cd1125537" class="i property">NodeName</a>, <span class="r71 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#73bfd5efd95d6021" class="i property">ConnectionName</a>);
 
                    <span class="c">// Create a session for this node.</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Creating Session&quot;</span>);
 
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r72 rd" class="r72 r">username</span> =  <a href="/Microsoft.Azure.Management.ServerManagement/A.html#1c687d5db77ac48e" class="t t">Utility</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2e01206c1e5a966e" class="i method">EncryptUsingGatewaySettings</a>(<span class="r70 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a61416b99548b526" class="i property">Instances</a>[0], <a href="ServerManagementTestBase.cs.html#6ed9eb70ea2cc23c" class="i property">NodeUserName</a>);
                    <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r73 rd" class="r73 r">password</span> =  <a href="/Microsoft.Azure.Management.ServerManagement/A.html#1c687d5db77ac48e" class="t t">Utility</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#2e01206c1e5a966e" class="i method">EncryptUsingGatewaySettings</a>(<span class="r70 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a61416b99548b526" class="i property">Instances</a>[0], <a href="ServerManagementTestBase.cs.html#9e2f3a7ad419c7fa" class="i property">NodePassword</a>);
 
                    <a href="/Microsoft.Azure.Management.ServerManagement/A.html#e84255680b9ec48d" class="k">var</a> <span id="r74 rd" class="r74 r">session</span> = <b>await</b> <span class="r69 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1fa36993ff34a04c" class="i property">Session</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#13f8c439b75c1651" class="i method">CreateAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="r71 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <a href="ServerManagementTestBase.cs.html#fd3f0b31fa4db496" class="i property">SessionIdTwo</a>, <span class="r72 r">username</span>, <span class="r73 r">password</span>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#577857fac38b5923" class="t t">RetentionPeriod</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#d45f0b6e787ad299" class="i field">Session</a>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#bc737407973c92fe" class="t t">CredentialDataFormat</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#8a37a5f94f41b5b3" class="i field">RsaEncrypted</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r74 r">session</span>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="r74 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <a href="ServerManagementTestBase.cs.html#fd3f0b31fa4db496" class="i property">SessionIdTwo</a>);
 
                    <span class="c">// Get the same session again</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Getting Session&quot;</span>);
                    <span class="r74 r">session</span> = <b>await</b> <span class="r69 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1fa36993ff34a04c" class="i property">Session</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#50c4840dbb44ab28" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="r71 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <span class="r74 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r74 r">session</span>);
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;Session/Get response:{0}&quot;</span>, <span class="r74 r">session</span>.<a href="Extensions.cs.html#be1e2b6b2e54a798" class="i method">ToJson</a>()));
 
                    <span class="c">// clean up our active SMT session.</span>
                    <a href="ServerManagementTestBase.cs.html#efa696ce4d9693fc" class="i method">WriteLine</a>(<span class="s">&quot;Delete Session&quot;</span>);
                    <b>await</b> <span class="r69 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#1fa36993ff34a04c" class="i property">Session</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#011dc1da7dbc1fda" class="i method">DeleteAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <span class="r71 r">node</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>, <span class="r74 r">session</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#310e3a9fa26a1440" class="i property">Name</a>);
 
                }
                <b>finally</b>
                {
                    <span class="c">// remove gateway that we&#39;ve created </span>
                    <b>if</b> (<a href="ServerManagementTestBase.cs.html#d78b77279e578c0c" class="i property">ForceResetGatewayProfile</a>)
                    {
                        <a href="ServerManagementTestBase.cs.html#36edeb0261d17d9b" class="i method">RemoveGateway</a>(<span class="r69 r">client</span>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>).<a href="@1@System.Runtime/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                    }
 
                    <span class="c">// regardless, always clear the nodes out.</span>
                    <a href="ServerManagementTestBase.cs.html#4123bfe7feece3c8" class="i method">RemoveAllNodes</a>(<span class="r69 r">client</span>).<a href="@1@System.Runtime/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> query gateway using &#39;download&#39; option; verify that the installerDownload and minimumVersion are set and valid</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@1@System.Runtime/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5e7c1af3020b7f0c" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GatewayExpandOptions</a>()
        {
            <span class="c">// ensure known state before starting.</span>
            <b>await</b> <a href="ServerManagementTestBase.cs.html#55ba6778e9474fd9" class="i method">EnsurePrerequisites</a>();
 
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r75 rd" class="r75 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#35800cd66afe1c6f" class="i method">Start</a>(<span class="s">&quot;Tests&quot;</span>))
            {
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#13eff9a237fc8458" class="k">var</a> <span id="r76 rd" class="r76 r">client</span> = <a href="ServerManagementTestBase.cs.html#2d9a59eb8f76dbe8" class="i method">GetServerManagementClient</a>(<span class="r75 r">context</span>);
                <a href="/Microsoft.Azure.Management.ServerManagement/A.html#22876475cbab8ab0" class="t t">GatewayResource</a> <span id="r77 rd" class="r77 r">gateway</span> = <b>null</b>;
 
                <b>if</b> (!<a href="ServerManagementTestBase.cs.html#d78b77279e578c0c" class="i property">ForceResetGatewayProfile</a>)
                {
                    <b>try</b>
                    {
                        <span class="r77 r">gateway</span> = <b>await</b> <span class="r76 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#bcd232cda8b43c12" class="t t">GatewayExpandOption</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a22779d66cebd586" class="i field">Download</a>);
 
                        <span class="c">// make sure the gateway service is running.</span>
                        <a href="ServerManagementTestBase.cs.html#34ca6bf5f9ff1eb2" class="i method">StartGateway</a>();
                    }
                    <b>catch</b>
                    {
                        <span class="c">// if it&#39;s not there, we&#39;ll create it anyway.</span>
                    }
                }
 
                <b>try</b>
                {
                    <b>if</b> (<span class="r77 r">gateway</span> == <b>null</b>)
                    {
                        <span class="c">// create gateway</span>
                        <b>await</b> <a href="#ea70cc25ac51362d" class="i method">CreateAndConfigureGateway</a>(<span class="r76 r">client</span>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>);
 
                        <span class="c">// get gateway status</span>
                        <span class="r77 r">gateway</span> = <b>await</b> <span class="r76 r">client</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#5545bab9074dfb1b" class="i property">Gateway</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a1751409ee9f9c1f" class="i method">GetAsync</a>(<a href="ServerManagementTestBase.cs.html#d764bf26a879d15b" class="i field">ResourceGroup</a>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>, <a href="/Microsoft.Azure.Management.ServerManagement/A.html#bcd232cda8b43c12" class="t t">GatewayExpandOption</a>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#a22779d66cebd586" class="i field">Download</a>);
                    }
 
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r77 r">gateway</span>);
                    <span class="t t">Assert</span>.<span class="i method">True</span>(!<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r77 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#8c81cd0dc9945bde" class="i property">InstallerDownload</a>));
                    <span class="t t">Assert</span>.<span class="i method">True</span>(!<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@System.Runtime/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r77 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#f86e72c70eed6e29" class="i property">MinimumVersion</a>));
 
                    <span class="t t">Assert</span>.<span class="i method">True</span>(<a href="@1@System.Runtime/A.html#991565dd25f47c90" class="t t">Uri</a>.<a href="@1@System.Runtime/A.html#24b1613846e7f879" class="i method">IsWellFormedUriString</a>(<span class="r77 r">gateway</span>.<a href="/Microsoft.Azure.Management.ServerManagement/A.html#8c81cd0dc9945bde" class="i property">InstallerDownload</a>, <a href="@1@System.Runtime/A.html#ac43655101ad74be" class="t t">UriKind</a>.<a href="@1@System.Runtime/A.html#d734108197254429" class="i field">Absolute</a>));
                }
                <b>finally</b>
                {
                    <span class="c">// remove gateway that we&#39;ve created </span>
                    <b>if</b> (<a href="ServerManagementTestBase.cs.html#d78b77279e578c0c" class="i property">ForceResetGatewayProfile</a>)
                    {
                        <a href="ServerManagementTestBase.cs.html#36edeb0261d17d9b" class="i method">RemoveGateway</a>(<span class="r76 r">client</span>, <a href="ServerManagementTestBase.cs.html#c95033893446f1f0" class="i property">GatewayTwo</a>).<a href="@1@System.Runtime/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                    }
                }
            }
        }
    }
}</pre></td></tr></table></div></body></html>
