<!DOCTYPE html>
<html><head><title>Sample2.1_AnalyzeSentimentWithOpinionMiningAsync.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(87);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.AI.TextAnalytics.Tests/samples/Sample2.1_AnalyzeSentimentWithOpinionMiningAsync.cs" target="_top">samples\Sample2.1_AnalyzeSentimentWithOpinionMiningAsync.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/textanalytics/Azure.AI.TextAnalytics/tests/samples/Sample2.1_AnalyzeSentimentWithOpinionMiningAsync.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.AI.TextAnalytics.Tests" target="_top">Azure.AI.TextAnalytics.Tests.csproj</a> (Azure.AI.TextAnalytics.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">AI</span>.<span class="i n">TextAnalytics</span>.<span class="i n">Samples</span>
{
    [<a href="/Azure.Core.TestFramework/A.html#9ce10179a72216c9" class="t constructor">LiveOnly</a>]
    <b>public</b> <a href="../P/ce563162c2857d13.html" target="s" class="k">partial</a> <b>class</b> <a id="ce563162c2857d13" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="24986e464f023370">TextAnalyticsSamples</span></a>
    {
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="fdf21fa402182f37" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AnalyzeSentimentWithOpinionMiningAsync</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">endpoint</span> = <a href="/Azure.Core.TestFramework/A.html#26a1e2ab3c3c535e" class="i property">TestEnvironment</a>.<a href="../Infrastructure/TextAnalyticsTestEnvironment.cs.html#32fd23349ec12fa5" class="i property">Endpoint</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">apiKey</span> = <a href="/Azure.Core.TestFramework/A.html#26a1e2ab3c3c535e" class="i property">TestEnvironment</a>.<a href="../Infrastructure/TextAnalyticsTestEnvironment.cs.html#07fc2cdb3e8610f7" class="i property">ApiKey</a>;
 
            <span class="c">// Instantiate a client that will be used to call the service.</span>
            <a href="/Azure.AI.TextAnalytics/A.html#765df30d60d4da95" class="k">var</a> <span id="r2 rd" class="r2 r">client</span> = <b>new</b> <a href="/Azure.AI.TextAnalytics/A.html#89a24b38873082dc" class="t constructor">TextAnalyticsClient</a>(<b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r0 r">endpoint</span>), <b>new</b> <a href="/Azure.Core/A.html#015df0c4993644fe" class="t constructor">AzureKeyCredential</a>(<span class="r1 r">apiKey</span>));
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">reviewA</span> = <span class="s">@&quot;The food and service were unacceptable, but the concierge were nice.
                             After talking to them about the quality of the food and the process
                             to get room service they refunded the money we spent at the restaurant
                             and gave us a voucher for nearby restaurants.&quot;</span>;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">reviewB</span> = <span class="s">@&quot;The rooms were beautiful. The AC was good and quiet, which was key for
                            us as outside it was 100F and our baby was getting uncomfortable because of the heat.
                            The breakfast was good too with good options and good servicing times.
                            The thing we didn&#39;t like was that the toilet in our bathroom was smelly.
                            It could have been that the toilet was not cleaned before we arrived.
                            Either way it was very uncomfortable.
                            Once we notified the staff, they came and cleaned it and left candles.&quot;</span>;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">reviewC</span> = <span class="s">@&quot;Nice rooms! I had a great unobstructed view of the Microsoft campus
                            but bathrooms were old and the toilet was dirty when we arrived. 
                            It was close to bus stops and groceries stores. If you want to be close to
                            campus I will recommend it, otherwise, might be better to stay in a cleaner one.&quot;</span>;
 
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r6 rd" class="r6 r">documents</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;
            {
                <span class="r3 r">reviewA</span>,
                <span class="r4 r">reviewB</span>,
                <span class="r5 r">reviewC</span>
            };
 
            <a href="/Azure.AI.TextAnalytics/A.html#d89527c643e1ea96" class="k">var</a> <span id="r7 rd" class="r7 r">options</span> = <b>new</b> <a href="/Azure.AI.TextAnalytics/A.html#efd2145ce62514c4" class="t constructor">AnalyzeSentimentOptions</a>() { <a href="/Azure.AI.TextAnalytics/A.html#f324b816e87af3da" class="i property">IncludeOpinionMining</a> = <b>true</b> };
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.AI.TextAnalytics/A.html#6772970298fa5db8" class="t t">AnalyzeSentimentResultCollection</a>&gt; <span id="r8 rd" class="r8 r">response</span> = <b>await</b> <span class="r2 r">client</span>.<a href="/Azure.AI.TextAnalytics/A.html#1a9965cf57d5a689" class="i method">AnalyzeSentimentBatchAsync</a>(<span class="r6 r">documents</span>, <span class="r9 r">options</span>: <span class="r7 r">options</span>);
            <a href="/Azure.AI.TextAnalytics/A.html#6772970298fa5db8" class="t t">AnalyzeSentimentResultCollection</a> <span id="r10 rd" class="r10 r">reviews</span> = <span class="r8 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>;
 
            <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <b>int</b>&gt; <span id="r11 rd" class="r11 r">complaints</span> = <a href="#3a7e7fb5bc26d02c" class="i method">GetComplaint</a>(<span class="r10 r">reviews</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r12 rd" class="r12 r">negativeAspect</span> = <span class="r11 r">complaints</span>.<a href="@0@System.Core/A.html#ac261011ebd4a616" class="i method">Aggregate</a>((<span id="r13 rd" class="r13 r">l</span>, <span id="r14 rd" class="r14 r">r</span>) =&gt; <span class="r13 r">l</span>.<a href="@0@mscorlib/A.html#38c0e86cc4b30170" class="i property">Value</a> &gt; <span class="r14 r">r</span>.<a href="@0@mscorlib/A.html#38c0e86cc4b30170" class="i property">Value</a> ? <span class="r13 r">l</span> : <span class="r14 r">r</span>).<a href="@0@mscorlib/A.html#f9d1c04feb1af032" class="i property">Key</a>;
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">Alert! major complaint is *</span>{<span class="r12 r">negativeAspect</span>}<span class="s">*</span><span class="s">&quot;</span>);
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#748bde83a8b838d8" class="i method">WriteLine</a>();
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;---All complaints:&quot;</span>);
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8585965bb176a426" class="t t">KeyValuePair</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <b>int</b>&gt; <span id="r15 rd" class="r15 r">complaint</span> <b>in</b> <span class="r11 r">complaints</span>)
            {
                <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">   </span>{<span class="r15 r">complaint</span>.<a href="@0@mscorlib/A.html#f9d1c04feb1af032" class="i property">Key</a>}<span class="s">, </span>{<span class="r15 r">complaint</span>.<a href="@0@mscorlib/A.html#38c0e86cc4b30170" class="i property">Value</a>}<span class="s">&quot;</span>);
            }
        }
 
        <b>private</b> <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="t t">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <b>int</b>&gt; <a id="3a7e7fb5bc26d02c" href="../R/3a7e7fb5bc26d02c.html" target="n" data-glyph="76,1" class="i method">GetComplaint</a>(<a href="/Azure.AI.TextAnalytics/A.html#6772970298fa5db8" class="t t">AnalyzeSentimentResultCollection</a> <span id="r16 rd" class="r16 r">reviews</span>)
        {
            <a href="@0@mscorlib/A.html#d3599058f8d79be0" class="k">var</a> <span id="r17 rd" class="r17 r">complaints</span> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <b>int</b>&gt;();
            <b>foreach</b> (<a href="/Azure.AI.TextAnalytics/A.html#2b1ce604dee54d42" class="t t">AnalyzeSentimentResult</a> <span id="r18 rd" class="r18 r">review</span> <b>in</b> <span class="r16 r">reviews</span>)
            {
                <b>foreach</b> (<a href="/Azure.AI.TextAnalytics/A.html#b1259efd6f94b4bc" class="t t">SentenceSentiment</a> <span id="r19 rd" class="r19 r">sentence</span> <b>in</b> <span class="r18 r">review</span>.<a href="/Azure.AI.TextAnalytics/A.html#7133f48ec8ac899d" class="i property">DocumentSentiment</a>.<a href="/Azure.AI.TextAnalytics/A.html#1726aa76fcdcf66c" class="i property">Sentences</a>)
                {
                    <b>foreach</b> (<a href="/Azure.AI.TextAnalytics/A.html#f52e406ad2c6653d" class="t t">SentenceOpinion</a> <span id="r20 rd" class="r20 r">opinion</span> <b>in</b> <span class="r19 r">sentence</span>.<a href="/Azure.AI.TextAnalytics/A.html#3e64da4e6e00c47e" class="i property">Opinions</a>)
                    {
                        <b>if</b> (<span class="r20 r">opinion</span>.<a href="/Azure.AI.TextAnalytics/A.html#d6476a6588df8047" class="i property">Target</a>.<a href="/Azure.AI.TextAnalytics/A.html#bfb3dcd2fd9d99aa" class="i property">Sentiment</a> == <a href="/Azure.AI.TextAnalytics/A.html#1f6ad81394da3384" class="t t">TextSentiment</a>.<a href="/Azure.AI.TextAnalytics/A.html#075e3dc4575c0b0e" class="i field">Negative</a>)
                        {
                            <span class="r17 r">complaints</span>.<a href="@0@mscorlib/A.html#2e5bc6d8c0f21e67" class="i method">TryGetValue</a>(<span class="r20 r">opinion</span>.<a href="/Azure.AI.TextAnalytics/A.html#d6476a6588df8047" class="i property">Target</a>.<a href="/Azure.AI.TextAnalytics/A.html#289e60cefb6e6871" class="i property">Text</a>, <b>out</b> <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r21 rd" class="r21 r">value</span>);
                            <span class="r17 r">complaints</span><a href="@0@mscorlib/A.html#49962975508e2d83">[</a><span class="r20 r">opinion</span>.<a href="/Azure.AI.TextAnalytics/A.html#d6476a6588df8047" class="i property">Target</a>.<a href="/Azure.AI.TextAnalytics/A.html#289e60cefb6e6871" class="i property">Text</a>] = <span class="r21 r">value</span> + 1;
                        }
                    }
                }
            }
            <b>return</b> <span class="r17 r">complaints</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
