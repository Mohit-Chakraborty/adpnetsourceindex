<!DOCTYPE html>
<html><head><title>DownloadHttpClientTest.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(47);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Core.Perf/DownloadHttpClientTest.cs" target="_top">DownloadHttpClientTest.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Core.Perf" target="_top">Azure.Core.Perf.csproj</a> (Azure.Core.Perf)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Test</span>.<span class="i n">Perf</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Template</span>.<span class="i n">Perf</span>
{
    <b>public class</b> <a id="03cb7a40e06a5b2f" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">DownloadHttpClientTest</a> : <a href="/Azure.Test.Perf/A.html#6fba2fa062ac4150" class="t t">PerfTest</a>&lt;<a href="DownloadTestOptions.cs.html#da8bee7df01d6da1" class="t t">DownloadTestOptions</a>&gt;
    {
        <b>private static</b> <span class="t t">HttpClient</span> <a id="78a40338c7e7850c" href="R/78a40338c7e7850c.html" target="n" data-glyph="46,1" class="i field">_client</a>;
        <b>private static</b> <a href="InProcTestServer.cs.html#13d21d9bbfb5d116" class="t t">InProcTestServer</a> <a id="1040ad9520b0ddcf" href="R/1040ad9520b0ddcf.html" target="n" data-glyph="46,1" class="i field">_server</a>;
 
        <b>public</b> <a id="8e2b4efdb511538a" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">DownloadHttpClientTest</a>(<a href="DownloadTestOptions.cs.html#da8bee7df01d6da1" class="t t">DownloadTestOptions</a> <span id="r0 rd" class="r0 r">options</span>) : <a href="/Azure.Test.Perf/A.html#9c8f97d1230a6380" class="k">base</a>(<span class="r0 r">options</span>)
        {
            <a href="#1040ad9520b0ddcf" class="i field">_server</a> ??= <a href="InProcTestServer.cs.html#13d21d9bbfb5d116" class="t t">InProcTestServer</a>.<a href="InProcTestServer.cs.html#acfce90f134bca90" class="i method">CreateStaticResponse</a>(<span class="r0 r">options</span>.<a href="/Azure.Test.Perf/A.html#40d7e60cfc4f9601" class="i property">Size</a>);
            <a href="#78a40338c7e7850c" class="i field">_client</a> ??= <b>new</b> <span class="t constructor">HttpClient</span>();
        }
 
        <b>public override void</b> <a id="409252fc8fe32c51" href="R/409252fc8fe32c51.html" target="n" data-glyph="72,1" class="i method">Run</a>(<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r1 rd" class="r1 r">cancellationToken</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">NET5_0</span>
<span class="e">            using var response = _client.Send(new HttpRequestMessage(HttpMethod.Get, _server.Address), Options.Buffer ? HttpCompletionOption.ResponseContentRead : HttpCompletionOption.ResponseHeadersRead, cancellationToken);
            response.Content.CopyTo(Stream.Null, null, cancellationToken);
</span><span class="k preprocess">#</span><span class="k preprocess">else</span>
            <a href="#206f3b7dcbcba781" class="i method">RunAsync</a>(<span class="r1 r">cancellationToken</span>).<a href="@0@mscorlib/A.html#9865ec4fb8abca74" class="i method">GetAwaiter</a>().<a href="@0@mscorlib/A.html#fac5be2731353aa8" class="i method">GetResult</a>();
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        <b>public override async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="206f3b7dcbcba781" href="R/206f3b7dcbcba781.html" target="n" data-glyph="72,1" class="i method">RunAsync</a>(<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r2 rd" class="r2 r">cancellationToken</span>)
        {
            <b>using</b> <b>var</b> <span id="r3 rd" class="r3 r">response</span> = <b>await</b> <a href="#78a40338c7e7850c" class="i field">_client</a>.<span class="i method">GetAsync</span>(<a href="#1040ad9520b0ddcf" class="i field">_server</a>.<a href="InProcTestServer.cs.html#c280ff1a6e05c2fa" class="i property">Address</a>, <a href="/Azure.Test.Perf/A.html#6753d1eb81ca846e" class="i property">Options</a>.<a href="DownloadTestOptions.cs.html#9f6ce0de3322be9d" class="i property">Buffer</a> ? <span class="t t">HttpCompletionOption</span>.<span class="i field">ResponseContentRead</span> : <span class="t t">HttpCompletionOption</span>.<span class="i field">ResponseHeadersRead</span>, <span class="r2 r">cancellationToken</span>);
            <b>await</b> <span class="r3 r">response</span>.<span class="i property">Content</span>.<span class="i method">CopyToAsync</span>(<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a>.<a href="@0@mscorlib/A.html#7e25c72455973e1f" class="i field">Null</a>);
        }
 
        <b>public override void</b> <a id="ab40b8cf87917a31" href="R/ab40b8cf87917a31.html" target="n" data-glyph="72,1" class="i method">Dispose</a>(<b>bool</b> <span id="r4 rd" class="r4 r">disposing</span>)
        {
            <a href="/Azure.Test.Perf/A.html#6fba2fa062ac4150" class="k">base</a>.<a href="/Azure.Test.Perf/A.html#de03ba7d62078084" class="i method">Dispose</a>(<span class="r4 r">disposing</span>);
            <a href="#1040ad9520b0ddcf" class="i field">_server</a>.<a href="InProcTestServer.cs.html#97d6063118776194" class="i method">Dispose</a>();
        }
    }
}
</pre></td></tr></table></div></body></html>
