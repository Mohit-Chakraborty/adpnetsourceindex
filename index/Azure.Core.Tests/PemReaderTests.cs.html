<!DOCTYPE html>
<html><head><title>PemReaderTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(265);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Core.Tests/PemReaderTests.cs" target="_top">PemReaderTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/core/Azure.Core/tests/PemReaderTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Core.Tests" target="_top">Azure.Core.Tests.csproj</a> (Azure.Core.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>.<span class="i n">X509Certificates</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Tests</span>
{
    <b>public</b> <a href="P/468aba5e7f832c53.html" target="s" class="k">partial</a> <b>class</b> <a id="468aba5e7f832c53" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="4d76f6e8f261a5e1">PemReaderTests</span></a>
    {
        [<span class="t constructor">TestCaseSource</span>(<b>nameof</b>(<a href="#1854c94e8c256858" class="i property">LineEndings</a>))]
        <b>public void</b> <a id="488376f8752fe6a1" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadsCertificate</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">lineEnding</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">pem</span> =
<span class="s">$&quot;</span><span class="s">-----BEGIN CERTIFICATE-----</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">MIIDCDCCAfCgAwIBAgIUB9Mxn1KLNBaTKu6pYdn3W1EBvWkwDQYJKoZIhvcNAQEL</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">BQAwFDESMBAGA1UEAwwJQXp1cmUgU0RLMB4XDTIxMDIwNDE5MzUzNVoXDTIxMTAy</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">NzE5MzUzNVowFDESMBAGA1UEAwwJQXp1cmUgU0RLMIIBIjANBgkqhkiG9w0BAQEF</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">AAOCAQ8AMIIBCgKCAQEA20VE95MMlyn7yu76XmEPBV5Gj7Sn0BzavGTYc497HXRp</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">y4Ec8edX5C6u7QpO+eQOVlFAbeyIg1/IMGdod8Quarx11mqCyBhXVlStrjqoNTIo</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">00OA9EFrWjka2ZYrLxlnS6k/w2k18nQE+FP63DIX1OkXU3TxHfVhZWwHgObq5jWz</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">x4EjG37hnYSJknAB/71N9f2g63cUM28HcGDfMzNrEhbk+TpFfGg3rZiosHybDyDH</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">x88jTxRxFYBiaWQpNOzZA+M9XUeUK3rdxOfj5JL8ExWGuPMj9QNKGcKkccrLoMtM</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">5hFP9R8f9nBeeYrmAUsZwU7HWUfaTzWH4goWfZRFQQIDAQABo1IwUDAJBgNVHRME</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">AjAAMAsGA1UdDwQEAwIF4DATBgNVHSUEDDAKBggrBgEFBQcDATAhBgNVHREEGjAY</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">gRZhenVyZXNka0BtaWNyb3NvZnQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQAbUn/U</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">IrlqGYv417Zwx00VEKOsis3Hafof6KjxQKzHwhNZ2EhLSNIRPrzK3ITbR2f0ZoCO</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">J5RnL11/KiLA1C9i38aAiekMxxYYikVWkpQHc3BB85v+lhSm5cuSvrdVeTcCXDTA</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">rJUjjPW4aQuo0GyzL4v1M1U2pByKsVCYAikuLmQKS2zXLoyW3ana1aQYyh2/3cXm</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">lkApwUZg00+9hRWxv0DTh/mRS2zu5i/9W+cZbIcRah0JHgOzAjvsyY9RHjqZ9r7c</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">Md7RrFHxnAKJj5TZJJJOf5h3OaaF3A5W8gf9Bc68aGQLFT5Y2afIawkYNSULypc3</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">pn29yMivL7r48dlo</span>{<span class="r0 r">lineEnding</span>}<span class="s">&quot;</span> +
<span class="s">$&quot;</span><span class="s">-----END CERTIFICATE-----</span><span class="s">&quot;</span>;
 
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#57172100ffd1f606" class="i method">TryRead</a>(<span class="r1 r">pem</span>.<span class="i method">AsSpan</span>(), <b>out</b> <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#c1aeb97eb54ed486" class="t t">PemField</a> <span id="r2 rd" class="r2 r">field</span>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CERTIFICATE&quot;</span>, <span class="r2 r">field</span>.<a href="Shared/PemReader.cs.html#96116bea9deb53c1" class="i property">Label</a>.<span class="i method">ToString</span>());
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="PemReaderTests.Keys.cs.html#90c34bfb515ad701" class="i field">s_rsaCertificateBytes</a>, <span class="r2 r">field</span>.<a href="Shared/PemReader.cs.html#60865d55dc81b668" class="i method">FromBase64Data</a>());
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="6575d857e4f70340" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadNoLabel</a>()
        {
            <b>const string</b> <span id="r3 rd" class="r3 r">pem</span> = <span class="s">@&quot;
MIIDCDCCAfCgAwIBAgIUB9Mxn1KLNBaTKu6pYdn3W1EBvWkwDQYJKoZIhvcNAQEL
BQAwFDESMBAGA1UEAwwJQXp1cmUgU0RLMB4XDTIxMDIwNDE5MzUzNVoXDTIxMTAy
NzE5MzUzNVowFDESMBAGA1UEAwwJQXp1cmUgU0RLMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEA20VE95MMlyn7yu76XmEPBV5Gj7Sn0BzavGTYc497HXRp
y4Ec8edX5C6u7QpO+eQOVlFAbeyIg1/IMGdod8Quarx11mqCyBhXVlStrjqoNTIo
00OA9EFrWjka2ZYrLxlnS6k/w2k18nQE+FP63DIX1OkXU3TxHfVhZWwHgObq5jWz
x4EjG37hnYSJknAB/71N9f2g63cUM28HcGDfMzNrEhbk+TpFfGg3rZiosHybDyDH
x88jTxRxFYBiaWQpNOzZA+M9XUeUK3rdxOfj5JL8ExWGuPMj9QNKGcKkccrLoMtM
5hFP9R8f9nBeeYrmAUsZwU7HWUfaTzWH4goWfZRFQQIDAQABo1IwUDAJBgNVHRME
AjAAMAsGA1UdDwQEAwIF4DATBgNVHSUEDDAKBggrBgEFBQcDATAhBgNVHREEGjAY
gRZhenVyZXNka0BtaWNyb3NvZnQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQAbUn/U
IrlqGYv417Zwx00VEKOsis3Hafof6KjxQKzHwhNZ2EhLSNIRPrzK3ITbR2f0ZoCO
J5RnL11/KiLA1C9i38aAiekMxxYYikVWkpQHc3BB85v+lhSm5cuSvrdVeTcCXDTA
rJUjjPW4aQuo0GyzL4v1M1U2pByKsVCYAikuLmQKS2zXLoyW3ana1aQYyh2/3cXm
lkApwUZg00+9hRWxv0DTh/mRS2zu5i/9W+cZbIcRah0JHgOzAjvsyY9RHjqZ9r7c
Md7RrFHxnAKJj5TZJJJOf5h3OaaF3A5W8gf9Bc68aGQLFT5Y2afIawkYNSULypc3
pn29yMivL7r48dlo&quot;</span>;
 
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#57172100ffd1f606" class="i method">TryRead</a>(<span class="r3 r">pem</span>.<span class="i method">AsSpan</span>(), <b>out _</b>));
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="6567fb8923e98e46" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadInvalidLabel</a>()
        {
            <b>const string</b> <span id="r4 rd" class="r4 r">pem</span> = <span class="s">@&quot;
-----BEGIN CERTIFICATE
MIIDCDCCAfCgAwIBAgIUB9Mxn1KLNBaTKu6pYdn3W1EBvWkwDQYJKoZIhvcNAQEL
BQAwFDESMBAGA1UEAwwJQXp1cmUgU0RLMB4XDTIxMDIwNDE5MzUzNVoXDTIxMTAy
NzE5MzUzNVowFDESMBAGA1UEAwwJQXp1cmUgU0RLMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEA20VE95MMlyn7yu76XmEPBV5Gj7Sn0BzavGTYc497HXRp
y4Ec8edX5C6u7QpO+eQOVlFAbeyIg1/IMGdod8Quarx11mqCyBhXVlStrjqoNTIo
00OA9EFrWjka2ZYrLxlnS6k/w2k18nQE+FP63DIX1OkXU3TxHfVhZWwHgObq5jWz
x4EjG37hnYSJknAB/71N9f2g63cUM28HcGDfMzNrEhbk+TpFfGg3rZiosHybDyDH
x88jTxRxFYBiaWQpNOzZA+M9XUeUK3rdxOfj5JL8ExWGuPMj9QNKGcKkccrLoMtM
5hFP9R8f9nBeeYrmAUsZwU7HWUfaTzWH4goWfZRFQQIDAQABo1IwUDAJBgNVHRME
AjAAMAsGA1UdDwQEAwIF4DATBgNVHSUEDDAKBggrBgEFBQcDATAhBgNVHREEGjAY
gRZhenVyZXNka0BtaWNyb3NvZnQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQAbUn/U
IrlqGYv417Zwx00VEKOsis3Hafof6KjxQKzHwhNZ2EhLSNIRPrzK3ITbR2f0ZoCO
J5RnL11/KiLA1C9i38aAiekMxxYYikVWkpQHc3BB85v+lhSm5cuSvrdVeTcCXDTA
rJUjjPW4aQuo0GyzL4v1M1U2pByKsVCYAikuLmQKS2zXLoyW3ana1aQYyh2/3cXm
lkApwUZg00+9hRWxv0DTh/mRS2zu5i/9W+cZbIcRah0JHgOzAjvsyY9RHjqZ9r7c
Md7RrFHxnAKJj5TZJJJOf5h3OaaF3A5W8gf9Bc68aGQLFT5Y2afIawkYNSULypc3
pn29yMivL7r48dlo&quot;</span>;
 
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#57172100ffd1f606" class="i method">TryRead</a>(<span class="r4 r">pem</span>.<span class="i method">AsSpan</span>(), <b>out _</b>));
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="03f19988333784c6" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadNoEndLabel</a>()
        {
            <b>const string</b> <span id="r5 rd" class="r5 r">pem</span> = <span class="s">@&quot;
MIIDCDCCAfCgAwIBAgIUB9Mxn1KLNBaTKu6pYdn3W1EBvWkwDQYJKoZIhvcNAQEL
BQAwFDESMBAGA1UEAwwJQXp1cmUgU0RLMB4XDTIxMDIwNDE5MzUzNVoXDTIxMTAy
NzE5MzUzNVowFDESMBAGA1UEAwwJQXp1cmUgU0RLMIIBIjANBgkqhkiG9w0BAQEF
AAOCAQ8AMIIBCgKCAQEA20VE95MMlyn7yu76XmEPBV5Gj7Sn0BzavGTYc497HXRp
y4Ec8edX5C6u7QpO+eQOVlFAbeyIg1/IMGdod8Quarx11mqCyBhXVlStrjqoNTIo
00OA9EFrWjka2ZYrLxlnS6k/w2k18nQE+FP63DIX1OkXU3TxHfVhZWwHgObq5jWz
x4EjG37hnYSJknAB/71N9f2g63cUM28HcGDfMzNrEhbk+TpFfGg3rZiosHybDyDH
x88jTxRxFYBiaWQpNOzZA+M9XUeUK3rdxOfj5JL8ExWGuPMj9QNKGcKkccrLoMtM
5hFP9R8f9nBeeYrmAUsZwU7HWUfaTzWH4goWfZRFQQIDAQABo1IwUDAJBgNVHRME
AjAAMAsGA1UdDwQEAwIF4DATBgNVHSUEDDAKBggrBgEFBQcDATAhBgNVHREEGjAY
gRZhenVyZXNka0BtaWNyb3NvZnQuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQAbUn/U
IrlqGYv417Zwx00VEKOsis3Hafof6KjxQKzHwhNZ2EhLSNIRPrzK3ITbR2f0ZoCO
J5RnL11/KiLA1C9i38aAiekMxxYYikVWkpQHc3BB85v+lhSm5cuSvrdVeTcCXDTA
rJUjjPW4aQuo0GyzL4v1M1U2pByKsVCYAikuLmQKS2zXLoyW3ana1aQYyh2/3cXm
lkApwUZg00+9hRWxv0DTh/mRS2zu5i/9W+cZbIcRah0JHgOzAjvsyY9RHjqZ9r7c
Md7RrFHxnAKJj5TZJJJOf5h3OaaF3A5W8gf9Bc68aGQLFT5Y2afIawkYNSULypc3
pn29yMivL7r48dlo&quot;</span>;
 
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#57172100ffd1f606" class="i method">TryRead</a>(<span class="r5 r">pem</span>.<span class="i method">AsSpan</span>(), <b>out _</b>));
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="e9f5bd4679cd4128" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadWithExtraneousData</a>()
        {
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#57172100ffd1f606" class="i method">TryRead</a>(<a href="PemReaderTests.Keys.cs.html#1e690b2c4d7585a0" class="i field">RsaPemPrivateKey</a>.<span class="i method">AsSpan</span>(), <b>out</b> <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#c1aeb97eb54ed486" class="t t">PemField</a> <span id="r6 rd" class="r6 r">field</span>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;PRIVATE KEY&quot;</span>, <span class="r6 r">field</span>.<a href="Shared/PemReader.cs.html#96116bea9deb53c1" class="i property">Label</a>.<span class="i method">ToString</span>());
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="PemReaderTests.Keys.cs.html#11d526f51c6acfbd" class="i field">s_rsaPrivateKeyBytes</a>, <span class="r6 r">field</span>.<a href="Shared/PemReader.cs.html#60865d55dc81b668" class="i method">FromBase64Data</a>());
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="e68e674b51fb91ce" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadCertificateWithPrivateKey</a>()
        {
            <span class="t t">ReadOnlySpan</span>&lt;<b>char</b>&gt; <span id="r7 rd" class="r7 r">data</span> = <a href="PemReaderTests.Keys.cs.html#bb7b7c7503214b6a" class="i field">RsaPem</a>.<span class="i method">AsSpan</span>();
 
            <span class="c">// Expect to find the private key first.</span>
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#57172100ffd1f606" class="i method">TryRead</a>(<span class="r7 r">data</span>, <b>out</b> <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#c1aeb97eb54ed486" class="t t">PemField</a> <span id="r8 rd" class="r8 r">field</span>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;PRIVATE KEY&quot;</span>, <span class="r8 r">field</span>.<a href="Shared/PemReader.cs.html#96116bea9deb53c1" class="i property">Label</a>.<span class="i method">ToString</span>());
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="PemReaderTests.Keys.cs.html#11d526f51c6acfbd" class="i field">s_rsaPrivateKeyBytes</a>, <span class="r8 r">field</span>.<a href="Shared/PemReader.cs.html#60865d55dc81b668" class="i method">FromBase64Data</a>());
 
            <span class="c">// Expect to find the certificate second.</span>
            <span class="r7 r">data</span> = <span class="r7 r">data</span>.<span class="i method">Slice</span>(<span class="r8 r">field</span>.<a href="Shared/PemReader.cs.html#96fe4e1729785931" class="i property">Start</a> + <span class="r8 r">field</span>.<a href="Shared/PemReader.cs.html#20464f07a82fd293" class="i property">Length</a>);
 
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#57172100ffd1f606" class="i method">TryRead</a>(<span class="r7 r">data</span>, <b>out</b> <span class="r8 r">field</span>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CERTIFICATE&quot;</span>, <span class="r8 r">field</span>.<a href="Shared/PemReader.cs.html#96116bea9deb53c1" class="i property">Label</a>.<span class="i method">ToString</span>());
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="PemReaderTests.Keys.cs.html#90c34bfb515ad701" class="i field">s_rsaCertificateBytes</a>, <span class="r8 r">field</span>.<a href="Shared/PemReader.cs.html#60865d55dc81b668" class="i method">FromBase64Data</a>());
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="211c77657ae28846" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificate</a>()
        {
            <b>using</b> <a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r9 rd" class="r9 r">certificate</span> = <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#bb7b7c7503214b6a" class="i field">RsaPem</a>.<span class="i method">AsSpan</span>(), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CN=Azure SDK&quot;</span>, <span class="r9 r">certificate</span>.<a href="@0@mscorlib/A.html#ab0ff5e07f224a7a" class="i property">Subject</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r9 r">certificate</span>.<a href="@0@System/A.html#f7670d048c7a5a70" class="i property">HasPrivateKey</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(2048, <span class="r9 r">certificate</span>.<a href="@0@System/A.html#bdf1ba35b4aee386" class="i property">PrivateKey</a>.<a href="@0@mscorlib/A.html#27170d83fa59297b" class="i property">KeySize</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="7291f4add9183cae" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificateAutomatically</a>()
        {
            <b>using</b> <a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r11 rd" class="r11 r">certificate</span> = <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#bb7b7c7503214b6a" class="i field">RsaPem</a>.<span class="i method">AsSpan</span>());
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CN=Azure SDK&quot;</span>, <span class="r11 r">certificate</span>.<a href="@0@mscorlib/A.html#ab0ff5e07f224a7a" class="i property">Subject</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r11 r">certificate</span>.<a href="@0@System/A.html#f7670d048c7a5a70" class="i property">HasPrivateKey</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(2048, <span class="r11 r">certificate</span>.<a href="@0@System/A.html#bdf1ba35b4aee386" class="i property">PrivateKey</a>.<a href="@0@mscorlib/A.html#27170d83fa59297b" class="i property">KeySize</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="1346237cd956c0d4" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificateWithPublicKey</a>()
        {
            <b>using</b> <a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r12 rd" class="r12 r">certificate</span> = <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#1e690b2c4d7585a0" class="i field">RsaPemPrivateKey</a>.<span class="i method">AsSpan</span>(), <a href="PemReaderTests.Keys.cs.html#90c34bfb515ad701" class="i field">s_rsaCertificateBytes</a>, <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CN=Azure SDK&quot;</span>, <span class="r12 r">certificate</span>.<a href="@0@mscorlib/A.html#ab0ff5e07f224a7a" class="i property">Subject</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r12 r">certificate</span>.<a href="@0@System/A.html#f7670d048c7a5a70" class="i property">HasPrivateKey</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(2048, <span class="r12 r">certificate</span>.<a href="@0@System/A.html#bdf1ba35b4aee386" class="i property">PrivateKey</a>.<a href="@0@mscorlib/A.html#27170d83fa59297b" class="i property">KeySize</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="a8bfa6311763f464" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificateWithoutPublicKey</a>()
        {
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r13 rd" class="r13 r">ex</span> = <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="@0@System/A.html#2b389f14fb01ad1b" class="t t">InvalidDataException</a>&gt;(() =&gt; <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#1e690b2c4d7585a0" class="i field">RsaPemPrivateKey</a>.<span class="i method">AsSpan</span>(), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;The certificate is missing the public key&quot;</span>, <span class="r13 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="79d7583100e23afa" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificateWithoutPrivateKey</a>()
        {
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r14 rd" class="r14 r">ex</span> = <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="@0@System/A.html#2b389f14fb01ad1b" class="t t">InvalidDataException</a>&gt;(() =&gt; <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#70918d197b6f8196" class="i field">RsaPemCertificate</a>.<span class="i method">AsSpan</span>(), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;The certificate is missing the private key&quot;</span>, <span class="r14 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="731892a1d6055af8" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificateWithOnlyPublicKeyAllowed</a>()
        {
            <b>using</b> <a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r15 rd" class="r15 r">certificate</span> = <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#70918d197b6f8196" class="i field">RsaPemCertificate</a>.<span class="i method">AsSpan</span>(), <a href="PemReaderTests.Keys.cs.html#90c34bfb515ad701" class="i field">s_rsaCertificateBytes</a>, <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>, <span class="r16 r">allowCertificateOnly</span>: <b>true</b>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CN=Azure SDK&quot;</span>, <span class="r15 r">certificate</span>.<a href="@0@mscorlib/A.html#ab0ff5e07f224a7a" class="i property">Subject</a>);
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<span class="r15 r">certificate</span>.<a href="@0@System/A.html#f7670d048c7a5a70" class="i property">HasPrivateKey</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="71a25bc1d5c6b1bf" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificateWithNoKeys</a>()
        {
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r17 rd" class="r17 r">ex</span> = <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="@0@System/A.html#2b389f14fb01ad1b" class="t t">InvalidDataException</a>&gt;(() =&gt; <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<span class="t t">Span</span>&lt;<b>char</b>&gt;.<span class="i property">Empty</span>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;The certificate is missing the public key&quot;</span>, <span class="r17 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="b9349982c550265d" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadedCertificateNotDisposed</a>()
        {
            <b>using</b> <a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r18 rd" class="r18 r">certificate</span> = <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#bb7b7c7503214b6a" class="i field">RsaPem</a>.<span class="i method">AsSpan</span>(), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>);
 
            <b>using</b> <a href="@0@mscorlib/A.html#9e72392556b1419c" class="t t">RSA</a> <span id="r19 rd" class="r19 r">publicKey</span> = <span class="r18 r">certificate</span>.<a href="@0@System.Core/A.html#a186c5049cb62ad4" class="i method">GetRSAPublicKey</a>();
            <b>using</b> <a href="@0@mscorlib/A.html#9e72392556b1419c" class="t t">RSA</a> <span id="r20 rd" class="r20 r">privateKey</span> = <span class="r18 r">certificate</span>.<a href="@0@System.Core/A.html#9732ff74912c20c7" class="i method">GetRSAPrivateKey</a>();
 
            <b>byte</b>[] <span id="r21 rd" class="r21 r">plaintext</span> = <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="s">&quot;test&quot;</span>);
            <b>byte</b>[] <span id="r22 rd" class="r22 r">ciphertext</span> = <span class="r19 r">publicKey</span>.<a href="@0@mscorlib/A.html#e62d91116bb74d35" class="i method">Encrypt</a>(<span class="r21 r">plaintext</span>, <a href="@0@mscorlib/A.html#238e5397d07dfb07" class="t t">RSAEncryptionPadding</a>.<a href="@0@mscorlib/A.html#229bca980f98d181" class="i property">Pkcs1</a>);
 
            <b>byte</b>[] <span id="r23 rd" class="r23 r">decrypted</span> = <span class="r20 r">privateKey</span>.<a href="@0@mscorlib/A.html#94c2e9ece01ff712" class="i method">Decrypt</a>(<span class="r22 r">ciphertext</span>, <a href="@0@mscorlib/A.html#238e5397d07dfb07" class="t t">RSAEncryptionPadding</a>.<a href="@0@mscorlib/A.html#229bca980f98d181" class="i property">Pkcs1</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r21 r">plaintext</span>, <span class="r23 r">decrypted</span>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="319abecbc3d349de" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificateReversed</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r24 rd" class="r24 r">pem</span> = <a href="PemReaderTests.Keys.cs.html#70918d197b6f8196" class="i field">RsaPemCertificate</a> + <span class="s">&quot;\n&quot;</span> + <a href="PemReaderTests.Keys.cs.html#1e690b2c4d7585a0" class="i field">RsaPemPrivateKey</a>;
 
            <b>using</b> <a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r25 rd" class="r25 r">certificate</span> = <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<span class="r24 r">pem</span>.<span class="i method">AsSpan</span>(), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CN=Azure SDK&quot;</span>, <span class="r25 r">certificate</span>.<a href="@0@mscorlib/A.html#ab0ff5e07f224a7a" class="i property">Subject</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r25 r">certificate</span>.<a href="@0@System/A.html#f7670d048c7a5a70" class="i property">HasPrivateKey</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(2048, <span class="r25 r">certificate</span>.<a href="@0@System/A.html#bdf1ba35b4aee386" class="i property">PrivateKey</a>.<a href="@0@mscorlib/A.html#27170d83fa59297b" class="i property">KeySize</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="5ebee606371a22e6" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadCertificatePemOverridesCer</a>()
        {
            <b>using</b> <a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r26 rd" class="r26 r">certificate</span> = <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#bb7b7c7503214b6a" class="i field">RsaPem</a>.<span class="i method">AsSpan</span>(), <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="s">&quot;This is not a certificate&quot;</span>), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;CN=Azure SDK&quot;</span>, <span class="r26 r">certificate</span>.<a href="@0@mscorlib/A.html#ab0ff5e07f224a7a" class="i property">Subject</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r26 r">certificate</span>.<a href="@0@System/A.html#f7670d048c7a5a70" class="i property">HasPrivateKey</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(2048, <span class="r26 r">certificate</span>.<a href="@0@System/A.html#bdf1ba35b4aee386" class="i property">PrivateKey</a>.<a href="@0@mscorlib/A.html#27170d83fa59297b" class="i property">KeySize</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="b3674b148577872e" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadECDsaCertificate</a>()
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">NET461</span>
            <span class="c">// Compatible with previous release. Goes through the LightweightPkcs8Decoder.DecodeRSAPkcs8().</span>
            <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="@0@System/A.html#2b389f14fb01ad1b" class="t t">InvalidDataException</a>&gt;(() =&gt; <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#b598bba072624240" class="i field">ECDsaCertificate</a>.<span class="i method">AsSpan</span>(), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#3d06c4f1f8f8d979" class="i field">RSA</a>));
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">            // Compatible with the previous release. Goes through RSA.ImportPKcs8PrivateKey().
            Assert.That(() =&gt; PemReader.LoadCertificate(ECDsaCertificate.AsSpan(), keyType: PemReader.KeyType.RSA), Throws.InstanceOf&lt;CryptographicException&gt;());
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="9bc4ff541cbf3ebf" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">LoadECDsaCertificateAutomatically</a>()
        {
            <span class="c">// Support for ECDsa certificates are not supported by default. See Azure.Security.KeyVault.Certificates for support.</span>
            <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="@0@mscorlib/A.html#99ee329017558ada" class="t t">NotSupportedException</a>&gt;(() =&gt; <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#3e3ebba4ae042f13" class="i method">LoadCertificate</a>(<a href="PemReaderTests.Keys.cs.html#b598bba072624240" class="i field">ECDsaCertificate</a>.<span class="i method">AsSpan</span>(), <span class="r10 r">keyType</span>: <a href="Shared/PemReader.cs.html#7cfeb2a4805407b3" class="t t">PemReader</a>.<a href="Shared/PemReader.cs.html#1127f8a274ecf440" class="t t">KeyType</a>.<a href="Shared/PemReader.cs.html#42e67575e35e8d6c" class="i field">Auto</a>));
        }
 
        <b>private static</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="1854c94e8c256858" href="R/1854c94e8c256858.html" target="n" data-glyph="106,1" class="i property">LineEndings</a> =&gt; <b>new</b>[]
        {
            <span class="s">&quot;\n&quot;</span>,   <span class="c">// Linux</span>
            <span class="s">&quot;\r\n&quot;</span>, <span class="c">// Windows</span>
            <span class="s">&quot;\r&quot;</span>,   <span class="c">// Mac</span>
        };
    }
}
</pre></td></tr></table></div></body></html>
