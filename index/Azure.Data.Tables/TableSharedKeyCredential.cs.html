<!DOCTYPE html>
<html><head><title>TableSharedKeyCredential.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(79);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Data.Tables/TableSharedKeyCredential.cs" target="_top">TableSharedKeyCredential.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Data.Tables" target="_top">src\Azure.Data.Tables.csproj</a> (Azure.Data.Tables)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Security</span>.<span class="i">Cryptography</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Data</span>.<span class="i n">Tables</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#e51b3a6af1fad67e" class="t t">TableSharedKeyCredential</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a credential backed by</span>
    <span class="c">///</span><span class="c"> a Storage Account&#39;s name and one of its access keys.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="e51b3a6af1fad67e" href="R/e51b3a6af1fad67e.html" target="n" data-glyph="0,0" class="t t">TableSharedKeyCredential</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the name of the Storage Account.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="cb6d5cd84a5162b1" href="R/cb6d5cd84a5162b1.html" target="n" data-glyph="102,1" class="i property">AccountName</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The value of a Storage Account access key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private byte</b>[] <a id="666ab8beb8ff10bd" href="R/666ab8beb8ff10bd.html" target="n" data-glyph="46,1" class="i field">_accountKeyValue</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the value of a Storage Account access key.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private byte</b>[] <a id="b2d98183083ef2d0" href="R/b2d98183083ef2d0.html" target="n" data-glyph="106,1" class="i property">AccountKeyValue</a>
        {
            <b>get</b> =&gt; <span class="i">Volatile</span>.<span class="i">Read</span>(<b>ref</b> <a href="#666ab8beb8ff10bd" class="i field">_accountKeyValue</a>);
            <b>set</b> =&gt; <span class="i">Volatile</span>.<span class="i">Write</span>(<b>ref</b> <a href="#666ab8beb8ff10bd" class="i field">_accountKeyValue</a>, <b>value</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#e51b3a6af1fad67e" class="t t">TableSharedKeyCredential</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">accountName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the Storage Account.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">accountKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A Storage Account access key.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="66c96af48f827d71" href="R/66c96af48f827d71.html" target="n" data-glyph="72,1" class="t constructor">TableSharedKeyCredential</a>(
            <b>string</b> <span id="r0 rd" class="r0 r">accountName</span>,
            <b>string</b> <span id="r1 rd" class="r1 r">accountKey</span>)
        {
            <a href="#cb6d5cd84a5162b1" class="i property">AccountName</a> = <span class="r0 r">accountName</span>;
            <a href="#2dde511a36e37057" class="i method">SetAccountKey</a>(<span class="r1 r">accountKey</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Update the Storage Account&#39;s access key.  This intended to be used</span>
        <span class="c">///</span><span class="c"> when you&#39;ve regenerated your Storage Account&#39;s access keys and want</span>
        <span class="c">///</span><span class="c"> to update long lived clients.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">accountKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A Storage Account access key.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="2dde511a36e37057" href="R/2dde511a36e37057.html" target="n" data-glyph="72,1" class="i method">SetAccountKey</a>(<b>string</b> <span id="r2 rd" class="r2 r">accountKey</span>) =&gt;
            <a href="#b2d98183083ef2d0" class="i property">AccountKeyValue</a> = <span class="i">Convert</span>.<span class="i">FromBase64String</span>(<span class="r2 r">accountKey</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates a base-64 hash signature string for an HTTP request or</span>
        <span class="c">///</span><span class="c"> for a SAS.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The message to sign.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The signed message.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="395e3db0f4cc8457" href="R/395e3db0f4cc8457.html" target="n" data-glyph="74,1" class="i method">ComputeHMACSHA256</a>(<b>string</b> <span id="r3 rd" class="r3 r">message</span>) =&gt;
            <span class="i">Convert</span>.<span class="i">ToBase64String</span>(<b>new</b> <span class="i">HMACSHA256</span>(<a href="#b2d98183083ef2d0" class="i property">AccountKeyValue</a>).<span class="i">ComputeHash</span>(<span class="i">Encoding</span>.<span class="i">UTF8</span>.<span class="i">GetBytes</span>(<span class="r3 r">message</span>)));
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generates a base-64 hash signature string for an HTTP request or</span>
        <span class="c">///</span><span class="c"> for a SAS.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The credential.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The message to sign.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The signed message.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static string</b> <a id="a1dc40f748afec7c" href="R/a1dc40f748afec7c.html" target="n" data-glyph="74,1" class="i method">ComputeSasSignature</a>(<a href="#e51b3a6af1fad67e" class="t t">TableSharedKeyCredential</a> <span id="r4 rd" class="r4 r">credential</span>, <b>string</b> <span id="r5 rd" class="r5 r">message</span>) =&gt;
            <span class="r4 r">credential</span>.<a href="#395e3db0f4cc8457" class="i method">ComputeHMACSHA256</a>(<span class="r5 r">message</span>);
    }
}
</pre></td></tr></table></div></body></html>
