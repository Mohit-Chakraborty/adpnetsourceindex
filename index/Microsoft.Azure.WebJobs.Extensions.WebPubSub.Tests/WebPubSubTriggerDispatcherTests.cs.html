<!DOCTYPE html>
<html><head><title>WebPubSubTriggerDispatcherTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(128);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.WebPubSub.Tests/WebPubSubTriggerDispatcherTests.cs" target="_top">WebPubSubTriggerDispatcherTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/webpubsub/Microsoft.Azure.WebJobs.Extensions.WebPubSub/tests/WebPubSubTriggerDispatcherTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.WebPubSub.Tests" target="_top">Microsoft.Azure.WebJobs.Extensions.WebPubSub.Tests.csproj</a> (Microsoft.Azure.WebJobs.Extensions.WebPubSub.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) .NET Foundation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>.<span class="i n">Executors</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Logging</span>.<span class="i n">Abstractions</span>;
<b>using</b> <span class="i n">Moq</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">WebPubSub</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="cc0977c580832bb4" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="a9c1b936ddfb139d">WebPubSubTriggerDispatcherTests</span></a>
    {
        <b>private static</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="b71f00c993a12d98" href="R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">ConnectionId</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="23ff5a6841619c1a" href="R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">AccessKey</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="52805637b49b1c0e" href="R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">Signature</a>) <a id="b4bd3dce87867cbb" href="R/b4bd3dce87867cbb.html" target="n" data-glyph="46,1" class="i field">TestKey</a> = (<a href="../GuidAssembly/R/0f9c97a2-f0bf-4706-afe8-7a14e0797b11.html" target="n" class="s">&quot;0f9c97a2f0bf4706afe87a14e0797b11&quot;</a>, <a href="../GuidAssembly/R/7aab2395-77fd-4f24-bc91-9802fb629f5f.html" target="n" class="s">&quot;7aab239577fd4f24bc919802fb629f5f&quot;</a>, <span class="s">&quot;sha256=7767effcb3946f3e1de039df4b986ef02c110b1469d02c0a06f41b3b727ab561&quot;</span>);
        <b>private const string</b> <a id="170d322ec9049d87" href="R/170d322ec9049d87.html" target="n" data-glyph="10,1" class="i field">TestHub</a> = <span class="s">&quot;testhub&quot;</span>;
        <b>private const</b> <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#5258f46527706ca6" class="t t">WebPubSubEventType</a> <a id="6760fd04c41161a0" href="R/6760fd04c41161a0.html" target="n" data-glyph="10,1" class="i field">TestType</a> = <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#5258f46527706ca6" class="t t">WebPubSubEventType</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#61dcfb404dcf5486" class="i field">System</a>;
        <b>private const string</b> <a id="ecf2121d0bab6dae" href="R/ecf2121d0bab6dae.html" target="n" data-glyph="10,1" class="i field">TestEvent</a> = <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#c44cdd1b0ffc341c" class="t t">Constants</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#8215efa5d583061f" class="t t">Events</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#41bacc495ba2a370" class="i field">ConnectedEvent</a>;
 
        <b>private static readonly</b> <a href="@0@System.Core/A.html#2d265edc718b158b" class="t t">HashSet</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="652844f0583eb49f" href="R/652844f0583eb49f.html" target="n" data-glyph="46,1" class="i field">EmptySetting</a> = <b>new</b>();
        <b>private static readonly</b> <a href="@0@System.Core/A.html#2d265edc718b158b" class="t t">HashSet</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="ff05881114761591" href="R/ff05881114761591.html" target="n" data-glyph="46,1" class="i field">ValidAccessKeys</a> = <b>new</b>(<b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#23ff5a6841619c1a" class="i field">AccessKey</a> });
        <b>private static readonly string</b>[] <a id="58f3f2197fa3ad0c" href="R/58f3f2197fa3ad0c.html" target="n" data-glyph="46,1" class="i field">ValidSignature</a> = <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#52805637b49b1c0e" class="i field">Signature</a> };
 
        [<span class="t constructor">TestCase</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="4eff4b9946bfacab" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_ValidRequest</a>()
        {
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r0 rd" class="r0 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r1 rd" class="r1 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <a href="#58f3f2197fa3ad0c" class="i field">ValidSignature</a>);
            <b>var</b> <span id="r2 rd" class="r2 r">response</span> = <b>await</b> <span class="r0 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r1 r">request</span>, <a href="#652844f0583eb49f" class="i field">EmptySetting</a>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#cbf374bfc92513b9" class="i field">OK</a>, <span class="r2 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="9f500b3b04a17b93" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_AllowNullUserId</a>()
        {
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r3 rd" class="r3 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r4 rd" class="r4 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <a href="#58f3f2197fa3ad0c" class="i field">ValidSignature</a>, <span class="r5 r">userId</span>: <b>null</b>);
            <b>var</b> <span id="r6 rd" class="r6 r">response</span> = <b>await</b> <span class="r3 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r4 r">request</span>, <a href="#652844f0583eb49f" class="i field">EmptySetting</a>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#cbf374bfc92513b9" class="i field">OK</a>, <span class="r6 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="be1b36157855b6b9" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_RouteNotFound</a>()
        {
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r7 rd" class="r7 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r8 rd" class="r8 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<span class="s">&quot;hub1&quot;</span>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <a href="#58f3f2197fa3ad0c" class="i field">ValidSignature</a>);
            <b>var</b> <span id="r9 rd" class="r9 r">response</span> = <b>await</b> <span class="r7 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r8 r">request</span>, <a href="#652844f0583eb49f" class="i field">EmptySetting</a>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#35e0ca1b70dbcf0d" class="i field">NotFound</a>, <span class="r9 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0dcdddb01e6a9256" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_SignatureInvalid</a>()
        {
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r10 rd" class="r10 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r11 rd" class="r11 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <span class="s">&quot;abc&quot;</span> });
            <b>var</b> <span id="r12 rd" class="r12 r">response</span> = <b>await</b> <span class="r10 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r11 r">request</span>, <a href="#652844f0583eb49f" class="i field">EmptySetting</a>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#ba154261719bd41b" class="i field">Unauthorized</a>, <span class="r12 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c7a5379a29614311" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_ConnectionIdNullBadRequest</a>()
        {
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r13 rd" class="r13 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r14 rd" class="r14 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <b>null</b>, <a href="#58f3f2197fa3ad0c" class="i field">ValidSignature</a>, <span class="r15 r">httpMethod</span>: <span class="s">&quot;Delete&quot;</span>);
            <b>var</b> <span id="r16 rd" class="r16 r">response</span> = <b>await</b> <span class="r13 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r14 r">request</span>, <a href="#652844f0583eb49f" class="i field">EmptySetting</a>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#813537f308d3a0ef" class="i field">BadRequest</a>, <span class="r16 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="417c334ba2c1a2b1" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_DeleteMethodBadRequest</a>()
        {
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r17 rd" class="r17 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r18 rd" class="r18 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <a href="#58f3f2197fa3ad0c" class="i field">ValidSignature</a>, <span class="r15 r">httpMethod</span>: <span class="s">&quot;Delete&quot;</span>);
            <b>var</b> <span id="r19 rd" class="r19 r">response</span> = <b>await</b> <span class="r17 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r18 r">request</span>, <a href="#652844f0583eb49f" class="i field">EmptySetting</a>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#813537f308d3a0ef" class="i field">BadRequest</a>, <span class="r19 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>(<span class="s">&quot;OPTIONS&quot;</span>, <span class="s">&quot;abc.com&quot;</span>)]
        [<span class="t constructor">TestCase</span>(<span class="s">&quot;GET&quot;</span>, <span class="s">&quot;abc.com&quot;</span>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f61037d43320222f" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_AbuseProtectionValidOK</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r20 rd" class="r20 r">method</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r21 rd" class="r21 r">host</span>)
        {
            <a href="@0@System.Core/A.html#2d265edc718b158b" class="k">var</a> <span id="r22 rd" class="r22 r">allowedHost</span> = <b>new</b> <a href="@0@System.Core/A.html#e068afbcd77375f8" class="t constructor">HashSet</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;(<b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <span class="r21 r">host</span> });
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r23 rd" class="r23 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r24 rd" class="r24 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#52805637b49b1c0e" class="i field">Signature</a> }, <span class="r15 r">httpMethod</span>: <span class="r20 r">method</span>, <span class="r25 r">host</span>: <span class="r21 r">host</span>);
            <b>var</b> <span id="r26 rd" class="r26 r">response</span> = <b>await</b> <span class="r23 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r24 r">request</span>, <span class="r22 r">allowedHost</span>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#cbf374bfc92513b9" class="i field">OK</a>, <span class="r26 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>(<span class="s">&quot;OPTIONS&quot;</span>, <span class="s">&quot;abc.com&quot;</span>)]
        [<span class="t constructor">TestCase</span>(<span class="s">&quot;GET&quot;</span>, <span class="s">&quot;abc.com&quot;</span>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="31e1e85d9cf8a172" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_AbuseProtectionInvalidBadRequest</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r27 rd" class="r27 r">method</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r28 rd" class="r28 r">allowedHost</span>)
        {
            <a href="@0@System.Core/A.html#2d265edc718b158b" class="k">var</a> <span id="r29 rd" class="r29 r">allowedHosts</span> = <b>new</b> <a href="@0@System.Core/A.html#e068afbcd77375f8" class="t constructor">HashSet</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;(<b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <span class="r28 r">allowedHost</span> });
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r30 rd" class="r30 r">testhost</span> = <span class="s">&quot;def.com&quot;</span>;
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r31 rd" class="r31 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>();
            <b>var</b> <span id="r32 rd" class="r32 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#52805637b49b1c0e" class="i field">Signature</a> }, <span class="r15 r">httpMethod</span>: <span class="r27 r">method</span>, <span class="r25 r">host</span>: <span class="r30 r">testhost</span>);
            <b>var</b> <span id="r33 rd" class="r33 r">response</span> = <b>await</b> <span class="r31 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r32 r">request</span>, <span class="r29 r">allowedHosts</span>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#813537f308d3a0ef" class="i field">BadRequest</a>, <span class="r33 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        [<span class="t constructor">TestCase</span>(<span class="s">&quot;application/xml&quot;</span>, <a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#813537f308d3a0ef" class="i field">BadRequest</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="1cc9e9ead8a98c60" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestProcessRequest_MessageMediaTypes</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r34 rd" class="r34 r">mediaType</span>, <a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a> <span id="r35 rd" class="r35 r">expectedCode</span>)
        {
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r36 rd" class="r36 r">dispatcher</span> = <a href="#6d3f73c24433458f" class="i method">SetupDispatcher</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#5258f46527706ca6" class="t t">WebPubSubEventType</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#7f7c809dba1dea77" class="i field">User</a>, <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#c44cdd1b0ffc341c" class="t t">Constants</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#8215efa5d583061f" class="t t">Events</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#bfa66a1512dae442" class="i field">MessageEvent</a>);
            <b>var</b> <span id="r37 rd" class="r37 r">request</span> = <a href="Common/TestHelpers.cs.html#3f4c67340eac0abf" class="t t">TestHelpers</a>.<a href="Common/TestHelpers.cs.html#80dea05df746155e" class="i method">CreateHttpRequestMessage</a>(<a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#5258f46527706ca6" class="t t">WebPubSubEventType</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#7f7c809dba1dea77" class="i field">User</a>, <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#c44cdd1b0ffc341c" class="t t">Constants</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#8215efa5d583061f" class="t t">Events</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#bfa66a1512dae442" class="i field">MessageEvent</a>, <a href="#b4bd3dce87867cbb" class="i field">TestKey</a>.<a href="/System.ValueTuple/A.html#b71f00c993a12d98" class="i field">ConnectionId</a>, <a href="#58f3f2197fa3ad0c" class="i field">ValidSignature</a>, <span class="r38 r">contentType</span>: <span class="r34 r">mediaType</span>, <span class="r39 r">payload</span>: <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="s">&quot;Hello&quot;</span>));
            <b>var</b> <span id="r40 rd" class="r40 r">response</span> = <b>await</b> <span class="r36 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#92c6e3ff78c66728" class="i method">ExecuteAsync</a>(<span class="r37 r">request</span>, <a href="#652844f0583eb49f" class="i field">EmptySetting</a>, <a href="#ff05881114761591" class="i field">ValidAccessKeys</a>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r35 r">expectedCode</span>, <span class="r40 r">response</span>.<span class="i property">StatusCode</span>);
        }
 
        <b>private static</b> <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="t t">WebPubSubTriggerDispatcher</a> <a id="6d3f73c24433458f" href="R/6d3f73c24433458f.html" target="n" data-glyph="76,1" class="i method">SetupDispatcher</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r41 rd" class="r41 r">hub</span> = <a href="#170d322ec9049d87" class="i field">TestHub</a>, <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#5258f46527706ca6" class="t t">WebPubSubEventType</a> <span id="r42 rd" class="r42 r">type</span> = <a href="#6760fd04c41161a0" class="i field">TestType</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r43 rd" class="r43 r">eventName</span> = <a href="#ecf2121d0bab6dae" class="i field">TestEvent</a>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r44 rd" class="r44 r">funcName</span> = <span class="s">$&quot;</span>{<span class="r41 r">hub</span>}<span class="s">.</span>{<span class="r42 r">type</span>}<span class="s">.</span>{<span class="r43 r">eventName</span>}<span class="s">&quot;</span>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>();
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#2b0b759bb4b434d2" class="k">var</a> <span id="r45 rd" class="r45 r">dispatcher</span> = <b>new</b> <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#5c3c3bea8da4ecd5" class="t constructor">WebPubSubTriggerDispatcher</a>(<span class="t t">NullLogger</span>.<span class="i property">Instance</span>);
            <b>var</b> <span id="r46 rd" class="r46 r">executor</span> = <b>new</b> <span class="t constructor">Mock</span>&lt;<span class="t t">ITriggeredFunctionExecutor</span>&gt;();
            <span class="r46 r">executor</span>.<span class="i method">Setup</span>(<span id="r47 rd" class="r47 r">f</span> =&gt; <span class="r47 r">f</span>.<span class="i method">TryExecuteAsync</span>(<span class="t t">It</span>.<span class="i method">IsAny</span>&lt;<span class="t t">TriggeredFunctionData</span>&gt;(), <span class="t t">It</span>.<span class="i method">IsAny</span>&lt;<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>&gt;()))
                .<span class="i method">Returns</span>(<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#11a386e7d7cae64a" class="i method">FromResult</a>(<b>new</b> <span class="t constructor">FunctionResult</span>(<b>true</b>)));
            <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#b30ace676d1913bc" class="k">var</a> <span id="r48 rd" class="r48 r">listener</span> = <b>new</b> <a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#d8b1f746cc2ec5d1" class="t constructor">WebPubSubListener</a>(<span class="r46 r">executor</span>.<span class="i property">Object</span>, <span class="r44 r">funcName</span>, <span class="r45 r">dispatcher</span>);
 
            <span class="r45 r">dispatcher</span>.<a href="/Microsoft.Azure.WebJobs.Extensions.WebPubSub/A.html#d530d6e2837f2551" class="i method">AddListener</a>(<span class="r44 r">funcName</span>, <span class="r48 r">listener</span>);
 
            <b>return</b> <span class="r45 r">dispatcher</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
