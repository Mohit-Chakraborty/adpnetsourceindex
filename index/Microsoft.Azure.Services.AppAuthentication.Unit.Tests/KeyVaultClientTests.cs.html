<!DOCTYPE html>
<html><head><title>KeyVaultClientTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(129);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Services.AppAuthentication.Unit.Tests/KeyVaultClientTests.cs" target="_top">KeyVaultClientTests.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Services.AppAuthentication.Unit.Tests" target="_top">Microsoft.Azure.Services.AppAuthentication.Unit.Tests.csproj</a> (Microsoft.Azure.Services.AppAuthentication.Unit.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">TestCommon</span>;
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Xunit</span>;
 
<b>using</b> <span class="t">TestType</span> = <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">Unit</span>.<span class="i n">Tests</span>.<a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a>.<a href="Mocks/MockKeyVault.cs.html#378d625a82521cac" class="t t">KeyVaultClientTestType</a>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">Unit</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="100ff6e726f1f77b" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="39765a192584c8eb">KeyVaultClientTests</span></a>
    {
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="bb26c96592277507" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">KeyVaultUnavailable</a>()
        {
            <a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a> <span id="r0 rd" class="r0 r">mockKeyVault</span> = <b>new</b> <a href="Mocks/MockKeyVault.cs.html#423a6ac0a0a60d97" class="t constructor">MockKeyVault</a>(<a href="Mocks/MockKeyVault.cs.html#378d625a82521cac" class="t t">TestType</a>.<a href="Mocks/MockKeyVault.cs.html#da89bbdd4a5a38d9" class="i field">KeyVaultUnavailable</a>);
            <span class="t t">HttpClient</span> <span id="r1 rd" class="r1 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>(<span class="r0 r">mockKeyVault</span>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r2 rd" class="r2 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#94d994ce7faa4344" class="t constructor">KeyVaultClient</a>(<span class="r1 r">httpClient</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r3 rd" class="r3 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r2 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#23f881be858a2582" class="i field">EndpointNotAvailableError</a>, <span class="r3 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="025b1722f493197b" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SecretIdentifierInvalidUriTest</a>()
        {
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r4 rd" class="r4 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#d52f5b12d0568f2f" class="t constructor">KeyVaultClient</a>();
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">secretIdentifier</span> = <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;https://&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r6 rd" class="r6 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r4 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<span class="r5 r">secretIdentifier</span>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#f60807f2fe877a40" class="i field">SecretIdentifierInvalidUriError</a>, <span class="r6 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7c86817cd9406739" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SecretIdentifierInvalidSchemeTest</a>()
        {
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r7 rd" class="r7 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#d52f5b12d0568f2f" class="t constructor">KeyVaultClient</a>();
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">secretIdentifier</span> = <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;https://&quot;</span>, <span class="s">&quot;http://&quot;</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r9 rd" class="r9 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r7 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<span class="r8 r">secretIdentifier</span>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9c263439e4cf4d6a" class="i field">SecretIdentifierInvalidSchemeError</a>, <span class="r9 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a276d280882f34e9" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SecretIdentifierInvalidTypeTest</a>()
        {
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r10 rd" class="r10 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#d52f5b12d0568f2f" class="t constructor">KeyVaultClient</a>();
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">secretIdentifier</span> = <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">&quot;/secrets/&quot;</span>, <span class="s">&quot;/keys/&quot;</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r12 rd" class="r12 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r10 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<span class="r11 r">secretIdentifier</span>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#0a55860965a68402" class="i field">SecretIdentifierInvalidTypeError</a>, <span class="r12 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="385ef6b8c958ebf2" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">HttpBearerChallengeMissingTest</a>()
        {
            <a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a> <span id="r13 rd" class="r13 r">mockKeyVault</span> = <b>new</b> <a href="Mocks/MockKeyVault.cs.html#423a6ac0a0a60d97" class="t constructor">MockKeyVault</a>(<a href="Mocks/MockKeyVault.cs.html#378d625a82521cac" class="t t">TestType</a>.<a href="Mocks/MockKeyVault.cs.html#80777a3672eb2d97" class="i field">HttpBearerChallengMissing</a>);
            <span class="t t">HttpClient</span> <span id="r14 rd" class="r14 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>(<span class="r13 r">mockKeyVault</span>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r15 rd" class="r15 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#94d994ce7faa4344" class="t constructor">KeyVaultClient</a>(<span class="r14 r">httpClient</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r16 rd" class="r16 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r15 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#62a37150f7b46770" class="i field">KeyVaultAccessTokenRetrievalError</a>, <span class="r16 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#7085ea00ac3326a9" class="i field">BearerChallengeMissingOrInvalidError</a>, <span class="r16 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ebb29c32c3a25f49" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">HttpBearerChallengeInvalidTest</a>()
        {
            <a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a> <span id="r17 rd" class="r17 r">mockKeyVault</span> = <b>new</b> <a href="Mocks/MockKeyVault.cs.html#423a6ac0a0a60d97" class="t constructor">MockKeyVault</a>(<a href="Mocks/MockKeyVault.cs.html#378d625a82521cac" class="t t">TestType</a>.<a href="Mocks/MockKeyVault.cs.html#b159d3c65d831040" class="i field">HttpBearerChallengeInvalid</a>);
            <span class="t t">HttpClient</span> <span id="r18 rd" class="r18 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>(<span class="r17 r">mockKeyVault</span>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r19 rd" class="r19 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#94d994ce7faa4344" class="t constructor">KeyVaultClient</a>(<span class="r18 r">httpClient</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r20 rd" class="r20 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r19 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#62a37150f7b46770" class="i field">KeyVaultAccessTokenRetrievalError</a>, <span class="r20 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#7085ea00ac3326a9" class="i field">BearerChallengeMissingOrInvalidError</a>, <span class="r20 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0adb35af7b788953" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">KeyVaultTokenProviderErrorTest</a>()
        {
            <a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a> <span id="r21 rd" class="r21 r">mockProcessManager</span> = <b>new</b> <a href="Mocks/MockProcessManager.cs.html#4d877b9a3fd31c4d" class="t constructor">MockProcessManager</a>(<a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a>.<a href="Mocks/MockProcessManager.cs.html#63eab5ffad89bf6a" class="t t">MockProcessManagerRequestType</a>.<a href="Mocks/MockProcessManager.cs.html#af859be55bafc364" class="i field">Failure</a>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#39a62be243139361" class="t t">AzureCliAccessTokenProvider</a> <span id="r22 rd" class="r22 r">azureCliAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#0815045b687aff66" class="t constructor">AzureCliAccessTokenProvider</a>(<span class="r21 r">mockProcessManager</span>);
 
            <a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a> <span id="r23 rd" class="r23 r">mockKeyVault</span> = <b>new</b> <a href="Mocks/MockKeyVault.cs.html#423a6ac0a0a60d97" class="t constructor">MockKeyVault</a>(<a href="Mocks/MockKeyVault.cs.html#378d625a82521cac" class="t t">TestType</a>.<a href="Mocks/MockKeyVault.cs.html#9f87e483c3ccd41c" class="i field">CertificateSecretIdentifierSuccess</a>);
            <span class="t t">HttpClient</span> <span id="r24 rd" class="r24 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>(<span class="r23 r">mockKeyVault</span>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r25 rd" class="r25 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#94d994ce7faa4344" class="t constructor">KeyVaultClient</a>(<span class="r24 r">httpClient</span>, <span class="r22 r">azureCliAccessTokenProvider</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r26 rd" class="r26 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r25 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#74c51a6320d16d98" class="i field">GenericErrorMessage</a>, <span class="r26 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#62a37150f7b46770" class="i field">KeyVaultAccessTokenRetrievalError</a>, <span class="r26 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#f9eb7ae8ea2316ff" class="i field">TokenProviderErrorsFormat</a>, 1), <span class="r26 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4b1c868e5d0c1f01" class="i field">DeveloperToolError</a>, <span class="r26 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="132f11c7e15fbf4d" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">InvalidKeyVaultSecretType</a>()
        {
            <a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a> <span id="r27 rd" class="r27 r">mockProcessManager</span> = <b>new</b> <a href="Mocks/MockProcessManager.cs.html#4d877b9a3fd31c4d" class="t constructor">MockProcessManager</a>(<a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a>.<a href="Mocks/MockProcessManager.cs.html#63eab5ffad89bf6a" class="t t">MockProcessManagerRequestType</a>.<a href="Mocks/MockProcessManager.cs.html#4f98645886f70b18" class="i field">Success</a>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#39a62be243139361" class="t t">AzureCliAccessTokenProvider</a> <span id="r28 rd" class="r28 r">azureCliAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#0815045b687aff66" class="t constructor">AzureCliAccessTokenProvider</a>(<span class="r27 r">mockProcessManager</span>);
 
            <span class="c">// use a secret identifier, but return secret bundle for password/secret and not certificate</span>
            <a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a> <span id="r29 rd" class="r29 r">mockKeyVault</span> = <b>new</b> <a href="Mocks/MockKeyVault.cs.html#423a6ac0a0a60d97" class="t constructor">MockKeyVault</a>(<a href="Mocks/MockKeyVault.cs.html#378d625a82521cac" class="t t">TestType</a>.<a href="Mocks/MockKeyVault.cs.html#103af38e692d1af1" class="i field">PasswordSecretIdentifierSuccess</a>);
            <span class="t t">HttpClient</span> <span id="r30 rd" class="r30 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>(<span class="r29 r">mockKeyVault</span>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r31 rd" class="r31 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#94d994ce7faa4344" class="t constructor">KeyVaultClient</a>(<span class="r30 r">httpClient</span>, <span class="r28 r">azureCliAccessTokenProvider</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r32 rd" class="r32 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r31 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#104448784bc3258d" class="i field">SecretBundleInvalidContentTypeError</a>, <span class="r32 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f92b7ec21c5eefde" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SecretNotFoundTest</a>()
        {
            <a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a> <span id="r33 rd" class="r33 r">mockProcessManager</span> = <b>new</b> <a href="Mocks/MockProcessManager.cs.html#4d877b9a3fd31c4d" class="t constructor">MockProcessManager</a>(<a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a>.<a href="Mocks/MockProcessManager.cs.html#63eab5ffad89bf6a" class="t t">MockProcessManagerRequestType</a>.<a href="Mocks/MockProcessManager.cs.html#4f98645886f70b18" class="i field">Success</a>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#39a62be243139361" class="t t">AzureCliAccessTokenProvider</a> <span id="r34 rd" class="r34 r">azureCliAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#0815045b687aff66" class="t constructor">AzureCliAccessTokenProvider</a>(<span class="r33 r">mockProcessManager</span>);
 
            <a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a> <span id="r35 rd" class="r35 r">mockKeyVault</span> = <b>new</b> <a href="Mocks/MockKeyVault.cs.html#423a6ac0a0a60d97" class="t constructor">MockKeyVault</a>(<a href="Mocks/MockKeyVault.cs.html#378d625a82521cac" class="t t">TestType</a>.<a href="Mocks/MockKeyVault.cs.html#1254f70f12206843" class="i field">SecretNotFound</a>);
            <span class="t t">HttpClient</span> <span id="r36 rd" class="r36 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>(<span class="r35 r">mockKeyVault</span>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a> <span id="r37 rd" class="r37 r">keyVaultClient</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#94d994ce7faa4344" class="t constructor">KeyVaultClient</a>(<span class="r36 r">httpClient</span>, <span class="r34 r">azureCliAccessTokenProvider</span>);
 
            <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="k">var</a> <span id="r38 rd" class="r38 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAnyAsync</span>&lt;<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r37 r">keyVaultClient</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5f36e4f1a22b0dec" class="i method">GetCertificateAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#84d64ea48f33472a" class="i field">TestKeyVaultCertificateSecretIdentifier</a>)));
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5e7f9dc8b5300af2" class="t t">KeyVaultClient</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#7bba1c003bfd5e95" class="i field">KeyVaultResponseError</a>, <span class="r38 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="Mocks/MockKeyVault.cs.html#0791da7520cfe62e" class="t t">MockKeyVault</a>.<a href="Mocks/MockKeyVault.cs.html#423b73967b68ad68" class="i field">SecretNotFoundErrorMessage</a>, <span class="r38 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
    }
}
</pre></td></tr></table></div></body></html>
