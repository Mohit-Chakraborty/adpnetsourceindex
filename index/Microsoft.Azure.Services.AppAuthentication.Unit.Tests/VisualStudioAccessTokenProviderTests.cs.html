<!DOCTYPE html>
<html><head><title>VisualStudioAccessTokenProviderTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(116);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Services.AppAuthentication.Unit.Tests/VisualStudioAccessTokenProviderTests.cs" target="_top">VisualStudioAccessTokenProviderTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/mgmtcommon/AppAuthentication/Azure.Services.AppAuthentication.Unit.Tests/VisualStudioAccessTokenProviderTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Services.AppAuthentication.Unit.Tests" target="_top">Microsoft.Azure.Services.AppAuthentication.Unit.Tests.csproj</a> (Microsoft.Azure.Services.AppAuthentication.Unit.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">TestCommon</span>;
<b>using</b> <span class="i n">Xunit</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">Unit</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="adc98334ee5ff470" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">VisualStudioAccessTokenProviderTests</a>
    {
        <b>private readonly</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#b1bc989ab357078f" class="t t">VisualStudioTokenProviderFile</a> <a id="045b4e5b3124b33c" href="R/045b4e5b3124b33c.html" target="n" data-glyph="46,1" class="i field">_visualStudioTokenProviderFile</a>;
 
        <b>public</b> <a id="dac667aa64be5349" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">VisualStudioAccessTokenProviderTests</a>()
        {
            <span class="c">// Parse the Visual Studio token provider file.</span>
            <a href="#045b4e5b3124b33c" class="i field">_visualStudioTokenProviderFile</a> = <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#b1bc989ab357078f" class="t t">VisualStudioTokenProviderFile</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#537ad366e555acfb" class="i method">Load</a>(<a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#89851b6b454456ed" class="i field">TestFilesPath</a>, <span class="s">&quot;VisualStudioSingleTokenProvider.json&quot;</span>));
 
            <span class="c">// This is set to a file that exists, since there is code that checks for file&#39;s existence. In reality, this would be an executable, but since</span>
            <span class="c">// process manager is mocked, this will will not be run.</span>
            <a href="#045b4e5b3124b33c" class="i field">_visualStudioTokenProviderFile</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#533d68ab120a5ebe" class="i field">TokenProviders</a>[0].<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#8e3cccc07a59723d" class="i field">Path</a> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#1274738792cce835" class="i method">GetFullPath</a>(<a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#2d7263f86a526264" class="i method">Combine</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#89851b6b454456ed" class="i field">TestFilesPath</a>, <span class="s">&quot;VisualStudioSingleTokenProvider.json&quot;</span>));
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="d3ca782cd55be689" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetTokenTest</a>()
        {
            <span class="c">// Mock the progress manager. This emulates running an actual process to get token from Visual Studio key chain.</span>
            <a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="k">var</a> <span id="r0 rd" class="r0 r">mockProcessManager</span> = <b>new</b> <a href="Mocks/MockProcessManager.cs.html#4d877b9a3fd31c4d" class="t constructor">MockProcessManager</a>(<a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a>.<a href="Mocks/MockProcessManager.cs.html#63eab5ffad89bf6a" class="t t">MockProcessManagerRequestType</a>.<a href="Mocks/MockProcessManager.cs.html#8165bf5150dce973" class="i field">VisualStudioSuccess</a>);
 
            <span class="c">// VisualStudioAccessTokenProvider has in internal only constructor to allow for unit testing. </span>
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="k">var</a> <span id="r1 rd" class="r1 r">visualStudioAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5a2bb68d9d598234" class="t constructor">VisualStudioAccessTokenProvider</a>(<span class="r0 r">mockProcessManager</span>, <a href="#045b4e5b3124b33c" class="i field">_visualStudioTokenProviderFile</a>);
 
            <span class="c">// Get token and validate it</span>
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#f4c4ab1f6d870222" class="k">var</a> <span id="r2 rd" class="r2 r">authResult</span> = <b>await</b> <span class="r1 r">visualStudioAccessTokenProvider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#93bdcb598f527621" class="i method">GetAuthResultAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4c2c0370afa0a59e" class="i field">KeyVaultResourceId</a>, <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#a4a1e2aa50f7f9c1" class="i field">TenantId</a>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#6b22e9ee44dd0d4d" class="t t">Validator</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#d429827173fe6bdc" class="i method">ValidateToken</a>(<span class="r2 r">authResult</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#bac23240ee26a0c7" class="i property">AccessToken</a>, <span class="r1 r">visualStudioAccessTokenProvider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#675f5f5e0e11c4d7" class="i field">PrincipalUsed</a>, <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#09b5e3eb5fba719b" class="i field">UserType</a>, <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#a4a1e2aa50f7f9c1" class="i field">TenantId</a>, <span class="r3 r">expiresOn</span>: <span class="r2 r">authResult</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#0bd6af7f6ac59d37" class="i property">ExpiresOn</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Test that if Visual Studio token provider file is missing, the right type of exception is thrown, and that the error response is as expected. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="d89d1e114dd48ecf" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TokenProviderFileNotFoundTest</a>()
        {
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="k">var</a> <span id="r4 rd" class="r4 r">visualStudioAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5a2bb68d9d598234" class="t constructor">VisualStudioAccessTokenProvider</a>(<b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#581219f889d3d301" class="t constructor">ProcessManager</a>());
 
            <span class="c">// This will ensure that the localappdata folder doesnt exist on the machine. Since VS token provider file path is added to this, the file will not exist either.</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">path</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#ba34dd21d0c53ff4" class="i method">SetEnvironmentVariable</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#6e91b715a83fa0b1" class="i field">LocalAppDataEnv</a>, <span class="r5 r">path</span>);
 
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="k">var</a> <span id="r6 rd" class="r6 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r4 r">visualStudioAccessTokenProvider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#93bdcb598f527621" class="i method">GetAuthResultAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4c2c0370afa0a59e" class="i field">KeyVaultResourceId</a>, <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#a4a1e2aa50f7f9c1" class="i field">TenantId</a>)));
 
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<span class="r5 r">path</span>, <span class="r6 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#74c51a6320d16d98" class="i field">GenericErrorMessage</a>, <span class="r6 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4c2c0370afa0a59e" class="i field">KeyVaultResourceId</a>, <span class="r6 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="t t">VisualStudioAccessTokenProvider</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e1cbfcdadbff564b" class="i field">TokenProviderFileNotFound</a>, <span class="r6 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Test that if all Visual Studio token providers are missing that are given in the Visual Studio token provider file, the right type of exception is thrown, and that the error response is as expected. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="84b4a36ba17bc6ab" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TokenProvidersNotFoundTest</a>()
        {
            <span class="c">// set all token providers in the token provider object to non-existent paths</span>
            <a href="#045b4e5b3124b33c" class="i field">_visualStudioTokenProviderFile</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#533d68ab120a5ebe" class="i field">TokenProviders</a>.<a href="@0@mscorlib/A.html#0e5a9cf0a310b9e5" class="i method">ForEach</a>(<span id="r7 rd" class="r7 r">tp</span> =&gt; <span class="r7 r">tp</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#8e3cccc07a59723d" class="i field">Path</a> = <span class="s">$&quot;</span><span class="s">C:\\</span>{<a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>()}<span class="s">\\Microsoft.Asal.TokenService.exe.json</span><span class="s">&quot;</span>);
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="k">var</a> <span id="r8 rd" class="r8 r">visualStudioAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5a2bb68d9d598234" class="t constructor">VisualStudioAccessTokenProvider</a>(<b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#581219f889d3d301" class="t constructor">ProcessManager</a>(), <a href="#045b4e5b3124b33c" class="i field">_visualStudioTokenProviderFile</a>);
 
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="k">var</a> <span id="r9 rd" class="r9 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r8 r">visualStudioAccessTokenProvider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#93bdcb598f527621" class="i method">GetAuthResultAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4c2c0370afa0a59e" class="i field">KeyVaultResourceId</a>, <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#a4a1e2aa50f7f9c1" class="i field">TenantId</a>)));
 
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#74c51a6320d16d98" class="i field">GenericErrorMessage</a>, <span class="r9 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4c2c0370afa0a59e" class="i field">KeyVaultResourceId</a>, <span class="r9 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="t t">VisualStudioAccessTokenProvider</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#40d7e8f98a2b4dad" class="i field">TokenProvidersNotFound</a>, <span class="r9 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Test that if Visual Studio failed to get token, the right type of exception is thrown, and that the error response is as expected. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="02ee890ac2755e0e" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">FailedToGetToken</a>()
        {
            <a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="k">var</a> <span id="r10 rd" class="r10 r">mockProcessManager</span> = <b>new</b> <a href="Mocks/MockProcessManager.cs.html#4d877b9a3fd31c4d" class="t constructor">MockProcessManager</a>(<a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a>.<a href="Mocks/MockProcessManager.cs.html#63eab5ffad89bf6a" class="t t">MockProcessManagerRequestType</a>.<a href="Mocks/MockProcessManager.cs.html#af859be55bafc364" class="i field">Failure</a>);
 
            <span class="c">// VisualStudioAccessTokenProvider has in internal only constructor to allow for unit testing. </span>
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="k">var</a> <span id="r11 rd" class="r11 r">visualStudioAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5a2bb68d9d598234" class="t constructor">VisualStudioAccessTokenProvider</a>(<span class="r10 r">mockProcessManager</span>, <a href="#045b4e5b3124b33c" class="i field">_visualStudioTokenProviderFile</a>);
            
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="k">var</a> <span id="r12 rd" class="r12 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r11 r">visualStudioAccessTokenProvider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#93bdcb598f527621" class="i method">GetAuthResultAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4c2c0370afa0a59e" class="i field">KeyVaultResourceId</a>, <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#a4a1e2aa50f7f9c1" class="i field">TenantId</a>)));
 
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#74c51a6320d16d98" class="i field">GenericErrorMessage</a>, <span class="r12 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4b1c868e5d0c1f01" class="i field">DeveloperToolError</a>, <span class="r12 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4c2c0370afa0a59e" class="i field">KeyVaultResourceId</a>, <span class="r12 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="t t">VisualStudioAccessTokenProvider</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#98b084a689e36e70" class="i field">TokenProviderGenericError</a>, <span class="r12 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This is a security test. The resource id should only have allowed characters. </span>
        <span class="c">///</span><span class="c"> Check that the right type of exception is thrown, and the error message is as expected. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="25ba0f67373fdb40" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ResourceInvalidCharsTest</a>()
        {
            <a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="k">var</a> <span id="r13 rd" class="r13 r">mockProcessManager</span> = <b>new</b> <a href="Mocks/MockProcessManager.cs.html#4d877b9a3fd31c4d" class="t constructor">MockProcessManager</a>(<a href="Mocks/MockProcessManager.cs.html#b9248edd920a9c3d" class="t t">MockProcessManager</a>.<a href="Mocks/MockProcessManager.cs.html#63eab5ffad89bf6a" class="t t">MockProcessManagerRequestType</a>.<a href="Mocks/MockProcessManager.cs.html#4f98645886f70b18" class="i field">Success</a>);
 
            <span class="c">// VisualStudioAccessTokenProvider has in internal only constructor to allow for unit testing. </span>
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#e0c173e6f2d1c26e" class="k">var</a> <span id="r14 rd" class="r14 r">visualStudioAccessTokenProvider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#5a2bb68d9d598234" class="t constructor">VisualStudioAccessTokenProvider</a>(<span class="r13 r">mockProcessManager</span>, <a href="#045b4e5b3124b33c" class="i field">_visualStudioTokenProviderFile</a>);
 
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="k">var</a> <span id="r15 rd" class="r15 r">exception</span> = <b>await</b> <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#9d8ad69856076643" class="t t">AzureServiceTokenProviderException</a>&gt;(() =&gt; <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(() =&gt; <span class="r14 r">visualStudioAccessTokenProvider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#93bdcb598f527621" class="i method">GetAuthResultAsync</a>(<span class="s">&quot;https://test^&quot;</span>, <a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#a4a1e2aa50f7f9c1" class="i field">TenantId</a>)));
 
            <span class="t t">Assert</span>.<span class="i method">Contains</span>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#961dd26414fc590c" class="i field">NotInExpectedFormatError</a>, <span class="r15 r">exception</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
        }
    }
}
</pre></td></tr></table></div></body></html>
