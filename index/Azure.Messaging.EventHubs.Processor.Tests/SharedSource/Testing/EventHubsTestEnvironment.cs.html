<!DOCTYPE html>
<html><head><title>EventHubsTestEnvironment.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(233);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.EventHubs.Processor.Tests/SharedSource/Testing/EventHubsTestEnvironment.cs" target="_top">SharedSource\Testing\EventHubsTestEnvironment.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master//sdk/eventhub/Azure.Messaging.EventHubs.Shared/src/Testing/EventHubsTestEnvironment.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.EventHubs.Processor.Tests" target="_top">Azure.Messaging.EventHubs.Processor.Tests.csproj</a> (Azure.Messaging.EventHubs.Processor.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Tests</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   Represents the ambient environment in which the test suite is</span>
    <span class="c">///</span><span class="c">   being run, offering access to information such as environment</span>
    <span class="c">///</span><span class="c">   variables.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span>
    <b>public sealed class</b> <a id="2eb9434a1448d776" href="../../R/2eb9434a1448d776.html" target="n" data-glyph="0,0" class="t t">EventHubsTestEnvironment</a> : <a href="/Azure.Core.TestFramework/A.html#e657e3c675f27c43" class="t t">TestEnvironment</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The name of the shared access key to be used for accessing an Event Hubs namespace.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public const string</b> <a id="ae81a2d5351a6c3e" href="../../R/ae81a2d5351a6c3e.html" target="n" data-glyph="6,1" class="i field">EventHubsDefaultSharedAccessKey</a> = <span class="s">&quot;RootManageSharedAccessKey&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The name of the environment variable used to specify The maximum duration, in minutes, that a test is permitted to run normally.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const string</b> <a id="bf26841f5f4b3ecc" href="../../R/bf26841f5f4b3ecc.html" target="n" data-glyph="10,1" class="i field">EventHubsPerTestExecutionLimitEnvironmentVariable</a> = <span class="s">&quot;EVENTHUB_PER_TEST_LIMIT_MINUTES&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The name of the environment variable used to specify the Event Hubs namespace to use for the test run.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const string</b> <a id="4327686148419b6b" href="../../R/4327686148419b6b.html" target="n" data-glyph="10,1" class="i field">EventHubsNamespaceConnectionStringEnvironmentVariable</a> = <span class="s">&quot;EVENTHUB_NAMESPACE_CONNECTION_STRING&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The name of the environment variable used to specify an override for the Event Hub instance to use for all tests.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const string</b> <a id="1f70905c1c42c8d7" href="../../R/1f70905c1c42c8d7.html" target="n" data-glyph="10,1" class="i field">EventHubNameOverrideEnvironmentVariable</a> = <span class="s">&quot;EVENTHUB_OVERRIDE_EVENT_HUB_NAME&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The default value for the maximum duration, in minutes, that a single test is permitted to run before it is considered at-risk for being hung.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const int</b> <a id="5adefa03b0deee6a" href="../../R/5adefa03b0deee6a.html" target="n" data-glyph="10,1" class="i field">DefaultPerTestExecutionLimitMinutes</a> = 5;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The singleton instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2eb9434a1448d776" class="t t">EventHubsTestEnvironment</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">, lazily created.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#8b99c1f377873554" class="t t">Lazy</a>&lt;<a href="#2eb9434a1448d776" class="t t">EventHubsTestEnvironment</a>&gt; <a id="794bea395ccc3829" href="../../R/794bea395ccc3829.html" target="n" data-glyph="46,1" class="i field">Singleton</a> = <b>new</b> <a href="@0@mscorlib/A.html#00bfaf5130ba4f04" class="t constructor">Lazy</a>&lt;<a href="#2eb9434a1448d776" class="t t">EventHubsTestEnvironment</a>&gt;(() =&gt; <b>new</b> <a href="#2071e5b3cf6dd3ec" class="t constructor">EventHubsTestEnvironment</a>(), <a href="@0@mscorlib/A.html#9d99e1ca53509514" class="t t">LazyThreadSafetyMode</a>.<a href="@0@mscorlib/A.html#a0f06cbca5bbe6e6" class="i field">ExecutionAndPublication</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The active Event Hubs namespace for this test run, lazily created.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="@0@mscorlib/A.html#8b99c1f377873554" class="t t">Lazy</a>&lt;<a href="#d84eef467676dcf8" class="t t">NamespaceProperties</a>&gt; <a id="655911b50dee0736" href="../../R/655911b50dee0736.html" target="n" data-glyph="46,1" class="i field">ActiveEventHubsNamespace</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c"> The environment variable value, or default, for the maximum duration, in minutes, that a single test is permitted to run before it is considered at-risk for being hung, lazily evaluated.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="@0@mscorlib/A.html#8b99c1f377873554" class="t t">Lazy</a>&lt;<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>&gt; <a id="3150cc56a7b7ebe5" href="../../R/3150cc56a7b7ebe5.html" target="n" data-glyph="46,1" class="i field">ActivePerTestExecutionLimit</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The connection string for the active Event Hubs namespace for this test run, lazily created.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="@0@mscorlib/A.html#8b99c1f377873554" class="t t">Lazy</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#64f2aa76721ecc75" class="t t">EventHubsConnectionStringProperties</a>&gt; <a id="536f55f3a80d1a82" href="../../R/536f55f3a80d1a82.html" target="n" data-glyph="46,1" class="i field">ParsedConnectionString</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The shared instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2eb9434a1448d776" class="t t">EventHubsTestEnvironment</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to be used during test runs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public static</b> <a href="#2eb9434a1448d776" class="t t">EventHubsTestEnvironment</a> <a id="71524bf9ff4cebd2" href="../../R/71524bf9ff4cebd2.html" target="n" data-glyph="102,1" class="i property">Instance</a> =&gt; <a href="#794bea395ccc3829" class="i field">Singleton</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates whether or not an ephemeral namespace was created for the current test execution.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if an Event Hubs namespace should be removed after the current test run; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public bool</b> <a id="91055472e9717db0" href="../../R/91055472e9717db0.html" target="n" data-glyph="102,1" class="i property">ShouldRemoveNamespaceAfterTestRunCompletion</a> =&gt; (<a href="#655911b50dee0736" class="i field">ActiveEventHubsNamespace</a>.<a href="@0@mscorlib/A.html#700e19f7e161ae1f" class="i property">IsValueCreated</a> &amp;&amp; <a href="#655911b50dee0736" class="i field">ActiveEventHubsNamespace</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>.<a href="#51bfe61680a3335b" class="i field">ShouldRemoveAtCompletion</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The environment variable value, or default, for the maximum duration, in minutes,</span>
        <span class="c">///</span><span class="c">   that a single test is permitted to run before it is considered at-risk for being hung.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public</b> <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="3c969b2336005b0a" href="../../R/3c969b2336005b0a.html" target="n" data-glyph="102,1" class="i property">TestExecutionTimeLimit</a> =&gt; <a href="#3150cc56a7b7ebe5" class="i field">ActivePerTestExecutionLimit</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The connection string for the Event Hubs namespace instance to be used for</span>
        <span class="c">///</span><span class="c">   Live tests.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The connection string will be determined by creating an ephemeral Event Hubs namespace for the test execution.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="2b1a580bf71837be" href="../../R/2b1a580bf71837be.html" target="n" data-glyph="102,1" class="i property">EventHubsConnectionString</a> =&gt; <a href="#655911b50dee0736" class="i field">ActiveEventHubsNamespace</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>.<a href="#5627f2f739992179" class="i field">ConnectionString</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The name of the Event Hubs namespace to be used for Live tests.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The name will be determined by creating an ephemeral Event Hubs namespace for the test execution.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="aa4f8bbd3b1d83f0" href="../../R/aa4f8bbd3b1d83f0.html" target="n" data-glyph="102,1" class="i property">EventHubsNamespace</a> =&gt; <a href="#655911b50dee0736" class="i field">ActiveEventHubsNamespace</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>.<a href="#46cca494fce7b3f8" class="i field">Name</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The fully qualified namespace for the Event Hubs namespace represented by this scope.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The fully qualified namespace, as contained within the associated connection string.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="87ec54fcb2db1491" href="../../R/87ec54fcb2db1491.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedNamespace</a> =&gt; <a href="#536f55f3a80d1a82" class="i field">ParsedConnectionString</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>.<a href="/Azure.Messaging.EventHubs/A.html#15495bc30c6945da" class="i property">FullyQualifiedNamespace</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The name of the Event Hub to use during Live tests.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The name of the event hub is read from the &quot;EVENTHUB_OVERRIDE_EVENT_HUB_NAME&quot; environment variable.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="6f5be5ddc43d7f9c" href="../../R/6f5be5ddc43d7f9c.html" target="n" data-glyph="102,1" class="i property">EventHubNameOverride</a> =&gt; <a href="/Azure.Core.TestFramework/A.html#5e67cd82ce2a842d" class="i method">GetOptionalVariable</a>(<a href="#1f70905c1c42c8d7" class="i field">EventHubNameOverrideEnvironmentVariable</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The shared access key name for the Event Hubs namespace represented by this scope.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The shared access key name, as contained within the associated connection string.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="6c9f85508ca2364d" href="../../R/6c9f85508ca2364d.html" target="n" data-glyph="102,1" class="i property">SharedAccessKeyName</a> =&gt; <a href="#536f55f3a80d1a82" class="i field">ParsedConnectionString</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>.<a href="/Azure.Messaging.EventHubs/A.html#f0bb784da77dbb58" class="i property">SharedAccessKeyName</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The shared access key for the Event Hubs namespace represented by this scope.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span><span class="c">The shared access key, as contained within the associated connection string.</span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="88793b693367efce" href="../../R/88793b693367efce.html" target="n" data-glyph="102,1" class="i property">SharedAccessKey</a> =&gt; <a href="#536f55f3a80d1a82" class="i field">ParsedConnectionString</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>.<a href="/Azure.Messaging.EventHubs/A.html#55335bfbd79a0fe6" class="i property">SharedAccessKey</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The Azure Authority host to be used for authentication with the active cloud environment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public</b> <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="65b11d2c5cc613ef" href="../../R/65b11d2c5cc613ef.html" target="n" data-glyph="102,1" class="i property">AuthorityHostUrl</a> =&gt; <a href="/Azure.Core.TestFramework/A.html#e657e3c675f27c43" class="k">base</a>.<a href="/Azure.Core.TestFramework/A.html#a97d05f1a459eabb" class="i property">AuthorityHostUrl</a> ?? <span class="s">&quot;https://login.microsoftonline.com/&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The Azure Service Management endpoint to be used for management plane authentication with the active cloud environment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public</b> <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="5c34413ec633e8da" href="../../R/5c34413ec633e8da.html" target="n" data-glyph="102,1" class="i property">ServiceManagementUrl</a> =&gt; <a href="/Azure.Core.TestFramework/A.html#e657e3c675f27c43" class="k">base</a>.<a href="/Azure.Core.TestFramework/A.html#3f1ba1cdbaa012cf" class="i property">ServiceManagementUrl</a> ?? <span class="s">&quot;https://management.core.windows.net/&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The location of the resource manager for the active cloud environment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public</b> <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="d39b1b36a5efe804" href="../../R/d39b1b36a5efe804.html" target="n" data-glyph="102,1" class="i property">ResourceManagerUrl</a> =&gt; <a href="/Azure.Core.TestFramework/A.html#e657e3c675f27c43" class="k">base</a>.<a href="/Azure.Core.TestFramework/A.html#5fba2fa1d9bcf067" class="i property">ResourceManagerUrl</a> ?? <span class="s">&quot;https://management.azure.com/&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2eb9434a1448d776" class="t t">EventHubsTestEnvironment</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public</b> <a id="2071e5b3cf6dd3ec" href="../../R/2071e5b3cf6dd3ec.html" target="n" data-glyph="72,1" class="t constructor">EventHubsTestEnvironment</a>()
        {
            <a href="#536f55f3a80d1a82" class="i field">ParsedConnectionString</a> = <b>new</b> <a href="@0@mscorlib/A.html#00bfaf5130ba4f04" class="t constructor">Lazy</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#64f2aa76721ecc75" class="t t">EventHubsConnectionStringProperties</a>&gt;(() =&gt; <a href="/Azure.Messaging.EventHubs/A.html#64f2aa76721ecc75" class="t t">EventHubsConnectionStringProperties</a>.<a href="/Azure.Messaging.EventHubs/A.html#1ffd9748a1d0ca94" class="i method">Parse</a>(<a href="#2b1a580bf71837be" class="i property">EventHubsConnectionString</a>), <a href="@0@mscorlib/A.html#9d99e1ca53509514" class="t t">LazyThreadSafetyMode</a>.<a href="@0@mscorlib/A.html#a0f06cbca5bbe6e6" class="i field">ExecutionAndPublication</a>);
            <a href="#655911b50dee0736" class="i field">ActiveEventHubsNamespace</a> = <b>new</b> <a href="@0@mscorlib/A.html#00bfaf5130ba4f04" class="t constructor">Lazy</a>&lt;<a href="#d84eef467676dcf8" class="t t">NamespaceProperties</a>&gt;(<a href="#30e091f0794205bb" class="i method">EnsureEventHubsNamespace</a>, <a href="@0@mscorlib/A.html#9d99e1ca53509514" class="t t">LazyThreadSafetyMode</a>.<a href="@0@mscorlib/A.html#a0f06cbca5bbe6e6" class="i field">ExecutionAndPublication</a>);
 
            <a href="#3150cc56a7b7ebe5" class="i field">ActivePerTestExecutionLimit</a> = <b>new</b> <a href="@0@mscorlib/A.html#00bfaf5130ba4f04" class="t constructor">Lazy</a>&lt;<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>&gt;(() =&gt;
            {
                <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r0 rd" class="r0 r">interval</span> = <a href="#5adefa03b0deee6a" class="i field">DefaultPerTestExecutionLimitMinutes</a>;
 
                <b>if</b> (<b>int</b>.<a href="@0@mscorlib/A.html#325507e509229dbc" class="i method">TryParse</a>(<a href="/Azure.Core.TestFramework/A.html#5e67cd82ce2a842d" class="i method">GetOptionalVariable</a>(<a href="#bf26841f5f4b3ecc" class="i field">EventHubsPerTestExecutionLimitEnvironmentVariable</a>), <b>out</b> <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r1 rd" class="r1 r">environmentVariable</span>))
                {
                    <span class="r0 r">interval</span> = <span class="r1 r">environmentVariable</span>;
                }
 
                <b>return</b> <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(<span class="r0 r">interval</span>);
            }, <a href="@0@mscorlib/A.html#9d99e1ca53509514" class="t t">LazyThreadSafetyMode</a>.<a href="@0@mscorlib/A.html#60c3a016d06ef0ec" class="i field">PublicationOnly</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Builds a connection string for a specific Event Hub instance under the Event Hubs namespace used for</span>
        <span class="c">///</span><span class="c">   Live tests.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the Event Hub to base the connection string on.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">return</span><span class="c">&gt;</span><span class="c">The Event Hub-level connection string.</span><span class="c">&lt;/</span><span class="c">return</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="b3ca7a1804140b8f" href="../../R/b3ca7a1804140b8f.html" target="n" data-glyph="72,1" class="i method">BuildConnectionStringForEventHub</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">eventHubName</span>) =&gt; <span class="s">$&quot;</span>{ <a href="#2b1a580bf71837be" class="i property">EventHubsConnectionString</a> }<span class="s">;EntityPath=</span>{ <span class="r2 r">eventHubName</span> }<span class="s">&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Ensures that an Event Hubs namespace is available for the test run, using one if provided by the</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4327686148419b6b" class="i field">EventHubsNamespaceConnectionStringEnvironmentVariable</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> or creating a new Azure resource specific</span>
        <span class="c">///</span><span class="c">   to the current run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The active Event Hubs namespace for this test run.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="#d84eef467676dcf8" class="t t">NamespaceProperties</a> <a id="30e091f0794205bb" href="../../R/30e091f0794205bb.html" target="n" data-glyph="76,1" class="i method">EnsureEventHubsNamespace</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r3 rd" class="r3 r">environmentConnectionString</span> = <a href="/Azure.Core.TestFramework/A.html#5e67cd82ce2a842d" class="i method">GetOptionalVariable</a>(<a href="#4327686148419b6b" class="i field">EventHubsNamespaceConnectionStringEnvironmentVariable</a>);
 
            <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r3 r">environmentConnectionString</span>))
            {
                <a href="/Azure.Messaging.EventHubs/A.html#64f2aa76721ecc75" class="k">var</a> <span id="r4 rd" class="r4 r">parsed</span> = <a href="/Azure.Messaging.EventHubs/A.html#64f2aa76721ecc75" class="t t">EventHubsConnectionStringProperties</a>.<a href="/Azure.Messaging.EventHubs/A.html#1ffd9748a1d0ca94" class="i method">Parse</a>(<span class="r3 r">environmentConnectionString</span>);
 
                <b>return</b> <b>new</b> <a href="#ac1f81317ce152c1" class="t constructor">NamespaceProperties</a>
                (
                    <span class="r4 r">parsed</span>.<a href="/Azure.Messaging.EventHubs/A.html#15495bc30c6945da" class="i property">FullyQualifiedNamespace</a>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, <span class="r4 r">parsed</span>.<a href="/Azure.Messaging.EventHubs/A.html#15495bc30c6945da" class="i property">FullyQualifiedNamespace</a>.<a href="@0@mscorlib/A.html#eb06d6d166f6a3d9" class="i method">IndexOf</a>(<span class="s">&#39;.&#39;</span>)),
                    <span class="r3 r">environmentConnectionString</span>.<a href="@0@mscorlib/A.html#69fc1d0aa6df8a90" class="i method">Replace</a>(<span class="s">$&quot;</span><span class="s">;EntityPath=</span>{ <span class="r4 r">parsed</span>.<a href="/Azure.Messaging.EventHubs/A.html#a257c559bfc92583" class="i property">EventHubName</a> }<span class="s">&quot;</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>),
                    <span class="r5 r">shouldRemoveAtCompletion</span>: <b>false</b>
                );
            }
 
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>
                .<a href="@0@mscorlib/A.html#2b0eb7df73dbd716" class="i method">Run</a>(<b>async</b> () =&gt; <b>await</b> <a href="EventHubScope.cs.html#0b884a8cc15fa573" class="t t">EventHubScope</a>.<a href="EventHubScope.cs.html#52a321a202bd86ea" class="i method">CreateNamespaceAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>))
                .<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>)
                .<a href="@0@mscorlib/A.html#e356d5440a3c14ad" class="i method">GetAwaiter</a>()
                .<a href="@0@mscorlib/A.html#6979b218613f292b" class="i method">GetResult</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The key attributes for identifying and accessing a dynamically created Event Hubs namespace,</span>
        <span class="c">///</span><span class="c">   intended to serve as an ephemeral container for the Event Hub instances used during a test run.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public struct</b> <a id="d84eef467676dcf8" href="../../R/d84eef467676dcf8.html" target="n" data-glyph="108,1" class="t t"><span id="8c81a7d4b78bf9a4">NamespaceProperties</span></a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The name of the Event Hubs namespace that was dynamically created.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public readonly string</b> <a id="46cca494fce7b3f8" href="../../R/46cca494fce7b3f8.html" target="n" data-glyph="42,2" class="i field">Name</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The connection string to use for accessing the dynamically created namespace.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public readonly string</b> <a id="5627f2f739992179" href="../../R/5627f2f739992179.html" target="n" data-glyph="42,2" class="i field">ConnectionString</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">A flag indicating if the namespace was created or referenced from environment variables.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public readonly bool</b> <a id="51bfe61680a3335b" href="../../R/51bfe61680a3335b.html" target="n" data-glyph="42,2" class="i field">ShouldRemoveAtCompletion</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#d84eef467676dcf8" class="t t">NamespaceProperties</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> struct.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">name</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the namespace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The connection string to use for accessing the namespace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">shouldRemoveAtCompletion</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A flag indicating if the namespace should be removed when the test run has completed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>internal</b> <a id="ac1f81317ce152c1" href="../../R/ac1f81317ce152c1.html" target="n" data-glyph="74,2" class="t constructor">NamespaceProperties</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">name</span>,
                                         <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">connectionString</span>,
                                         <b>bool</b> <span id="r5 rd" class="r5 r">shouldRemoveAtCompletion</span>)
            {
                <a href="#46cca494fce7b3f8" class="i field">Name</a> = <span class="r6 r">name</span>;
                <a href="#5627f2f739992179" class="i field">ConnectionString</a> = <span class="r7 r">connectionString</span>;
                <a href="#51bfe61680a3335b" class="i field">ShouldRemoveAtCompletion</a> = <span class="r5 r">shouldRemoveAtCompletion</span>;
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
