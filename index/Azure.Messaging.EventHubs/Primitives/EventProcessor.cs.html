<!DOCTYPE html>
<html><head><title>EventProcessor.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(1701);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.EventHubs/Primitives/EventProcessor.cs" target="_top">Primitives\EventProcessor.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/eventhub/Azure.Messaging.EventHubs/src/Primitives/EventProcessor.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.EventHubs" target="_top">Azure.Messaging.EventHubs.csproj</a> (Azure.Messaging.EventHubs)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">ExceptionServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Consumer</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Processor</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Primitives</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   Provides a base for creating a custom processor for consuming events across all partitions of a given Event Hub</span>
    <span class="c">///</span><span class="c">   within the scope of a specific consumer group.  The processor is capable of collaborating with other instances for</span>
    <span class="c">///</span><span class="c">   the same Event Hub and consumer group pairing to share work by using a common storage platform to communicate.  Fault</span>
    <span class="c">///</span><span class="c">   tolerance is also built-in, allowing the processor to be resilient in the face of errors.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r t">TPartition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The context of the partition for which an operation is being performed.</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r1 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is safe to cache and use for the lifetime of an application, and that is best practice when the application</span>
    <span class="c">///</span><span class="c">   processes events regularly or semi-regularly.  The processor holds responsibility for efficient resource management, working to keep resource usage low during</span>
    <span class="c">///</span><span class="c">   periods of inactivity and manage health during periods of higher use.  Calling either the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#ab75e98efdc7e7e6" class="i method">StopProcessingAsync</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#7663cd23ef8edab4" class="i method">StopProcessing</a><span class="c">&quot;</span> <span class="c">/&gt;</span>
    <span class="c">///</span><span class="c">   method when processing is complete or as the application is shutting down will ensure that network resources and other unmanaged objects are properly cleaned up.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
    <span class="c">///</span>
    [<a href="@1@netstandard/A.html#5e00de6576fb9ce7" class="t constructor">SuppressMessage</a>(<span class="s">&quot;Microsoft.Design&quot;</span>, <span class="s">&quot;CA1001:TypesThatOwnDisposableFieldsShouldBeDisposable&quot;</span>)]
    <b>public abstract class</b> <a id="4ce59cd6fc256750" href="../R/4ce59cd6fc256750.html" target="n" data-glyph="0,0" class="t t">EventProcessor</a>&lt;<span id="r0 rd t" class="r0 r t">TPartition</span>&gt; <b>where</b> <span class="r0 r t">TPartition</span> : <a href="EventProcessorPartition.cs.html#f166f8955ab127cc" class="t t">EventProcessorPartition</a>, <b>new</b>()
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The maximum number of failed consumers to allow when processing a partition; failed consumers are those which have been unable to receive and process events.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const int</b> <a id="21a53c68cf6345aa" href="../R/21a53c68cf6345aa.html" target="n" data-glyph="10,1" class="i field">MaximumFailedConsumerCount</a> = 1;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The primitive for synchronizing access when starting and stopping the processor.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <a href="@1@netstandard/A.html#d57f52e0341a581f" class="t t">SemaphoreSlim</a> <a id="a8a1cae419611635" href="../R/a8a1cae419611635.html" target="n" data-glyph="46,1" class="i field">ProcessorRunningGuard</a> = <b>new</b> <a href="@1@netstandard/A.html#ed5ff10a1fcba4d4" class="t constructor">SemaphoreSlim</a>(1, 1);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Indicates whether or not this event processor is currently running.  Used only for mocking purposes.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b>? <a id="6293434ca2c207fc" href="../R/6293434ca2c207fc.html" target="n" data-glyph="46,1" class="i field">_isRunningOverride</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Indicates the current state of the processor; used for mocking and manual status updates.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>? <a id="24f1e7b7a6fa321a" href="../R/24f1e7b7a6fa321a.html" target="n" data-glyph="46,1" class="i field">_statusOverride</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The task responsible for managing the operations of the processor when it is running.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="1c921af1b8eaece6" href="../R/1c921af1b8eaece6.html" target="n" data-glyph="46,1" class="i field">_runningProcessorTask</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the current running task.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a> <a id="e27d550be02dbec0" href="../R/e27d550be02dbec0.html" target="n" data-glyph="46,1" class="i field">_runningProcessorCancellationSource</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The fully qualified Event Hubs namespace that the processor is associated with.  This is likely</span>
        <span class="c">///</span><span class="c">   to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="1f79ba5702fc2b68" href="../R/1f79ba5702fc2b68.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedNamespace</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The name of the Event Hub that the processor is connected to, specific to the</span>
        <span class="c">///</span><span class="c">   Event Hubs namespace that contains it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="d735e7f1d60deaa6" href="../R/d735e7f1d60deaa6.html" target="n" data-glyph="102,1" class="i property">EventHubName</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The name of the consumer group this event processor is associated with.  Events will be</span>
        <span class="c">///</span><span class="c">   read only in the context of this group.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="6d7640e769276c4c" href="../R/6d7640e769276c4c.html" target="n" data-glyph="102,1" class="i property">ConsumerGroup</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   A unique name used to identify this event processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public string</b> <a id="f7fa4022e2eeea36" href="../R/f7fa4022e2eeea36.html" target="n" data-glyph="102,1" class="i property">Identifier</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates whether or not this event processor is currently running.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public bool</b> <a id="296f5f1b1d942f3b" href="../R/296f5f1b1d942f3b.html" target="n" data-glyph="102,1" class="i property">IsRunning</a>
        {
            <b>get</b>
            {
                <a href="@1@netstandard/A.html#ffebe438fd9cbf0e" class="k">var</a> <span id="r2 rd" class="r2 r">running</span> = <a href="#6293434ca2c207fc" class="i field">_isRunningOverride</a>;
 
                <b>if</b> (<span class="r2 r">running</span>.<a href="@1@netstandard/A.html#7bbe60e33e857298" class="i property">HasValue</a>)
                {
                    <b>return</b> <span class="r2 r">running</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>;
                }
 
                <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="k">var</a> <span id="r3 rd" class="r3 r">status</span> = <a href="#01bdc12ee5677ee1" class="i property">Status</a>;
                <b>return</b> ((<span class="r3 r">status</span> == <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#e6e3f95d450294e3" class="i field">Running</a>) || (<span class="r3 r">status</span> == <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#d68b2187c3ae9b7e" class="i field">Stopping</a>));
            }
 
            <b>protected set</b> =&gt; <a href="#6293434ca2c207fc" class="i field">_isRunningOverride</a> = <b>value</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates the current state of the processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a> <a id="01bdc12ee5677ee1" href="../R/01bdc12ee5677ee1.html" target="n" data-glyph="104,1" class="i property">Status</a>
        {
            <b>get</b>
            {
                <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>? <span id="r4 rd" class="r4 r">statusOverride</span>;
 
                <span class="c">// If there is no active processor task, ensure that it is not</span>
                <span class="c">// in the process of starting by attempting to acquire the semaphore.</span>
                <span class="c">//</span>
                <span class="c">// If the semaphore could not be acquired, then there is an active start/stop</span>
                <span class="c">// operation in progress indicating that the processor is not yet running or</span>
                <span class="c">// will not be running.</span>
 
                <b>if</b> (<a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a> == <b>null</b>)
                {
                    <b>try</b>
                    {
                        <b>if</b> (!<a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#e0692d53a161b1d3" class="i method">Wait</a>(100))
                        {
                            <b>return</b> (<a href="#24f1e7b7a6fa321a" class="i field">_statusOverride</a> ?? <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#da31e1223b4fbd34" class="i field">NotRunning</a>);
                        }
 
                        <span class="r4 r">statusOverride</span> = <a href="#24f1e7b7a6fa321a" class="i field">_statusOverride</a>;
                    }
                    <b>finally</b>
                    {
                        <a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#f7527810bcfc0842" class="i method">Release</a>();
                    }
                }
                <b>else</b>
                {
                    <span class="r4 r">statusOverride</span> = <a href="#24f1e7b7a6fa321a" class="i field">_statusOverride</a>;
                }
 
                <b>if</b> (<span class="r4 r">statusOverride</span>.<a href="@1@netstandard/A.html#7bbe60e33e857298" class="i property">HasValue</a>)
                {
                    <b>return</b> <span class="r4 r">statusOverride</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>;
                }
 
                <b>if</b> ((<a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a>?.<a href="@1@netstandard/A.html#e9c0495c4af4d4df" class="i property">IsFaulted</a>) ?? (<b>false</b>))
                {
                    <b>return</b> <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#ece6af52ec4c3525" class="i field">Faulted</a>;
                }
 
                <b>if</b> ((!<a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a>?.<a href="@1@netstandard/A.html#8d8a16ab86bf7a8a" class="i property">IsCompleted</a>) ?? (<b>false</b>))
                {
                    <b>return</b> <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#e6e3f95d450294e3" class="i field">Running</a>;
                }
 
                <b>return</b> <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#da31e1223b4fbd34" class="i field">NotRunning</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The instance of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Diagnostics/EventHubsEventSource.cs.html#88bca2b6f3cfd5f2" class="t t">EventHubsEventSource</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> which can be mocked for testing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a href="../Diagnostics/EventHubsEventSource.cs.html#88bca2b6f3cfd5f2" class="t t">EventHubsEventSource</a> <a id="6c040e9b0fc9161e" href="../R/6c040e9b0fc9161e.html" target="n" data-glyph="104,1" class="i property">Logger</a> { <b>get</b>; <b>set</b>; } = <a href="../Diagnostics/EventHubsEventSource.cs.html#88bca2b6f3cfd5f2" class="t t">EventHubsEventSource</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#c960e5896e4dd589" class="i property">Log</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The active policy which governs retry attempts for the processor.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a href="../EventHubsRetryPolicy.cs.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <a id="18887ae4162737a9" href="../R/18887ae4162737a9.html" target="n" data-glyph="105,1" class="i property">RetryPolicy</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The set of currently active partition processing tasks issued by this event processor and their associated</span>
        <span class="c">///</span><span class="c">   token sources that can be used to cancel the operation.  Partition identifiers are used as keys.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="@1@netstandard/A.html#2e5ef5704344a309" class="t t">ConcurrentDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="#83c5a9fd72574778" class="t t">PartitionProcessor</a>&gt; <a id="516d24961b15bce2" href="../R/516d24961b15bce2.html" target="n" data-glyph="106,1" class="i property">ActivePartitionProcessors</a> { <b>get</b>; } = <b>new</b> <a href="@1@netstandard/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="#83c5a9fd72574778" class="t t">PartitionProcessor</a>&gt;();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   A factory used to create new </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../EventHubConnection.cs.html#0646809725209998" class="t t">EventHubConnection</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instances.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="@1@netstandard/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="../EventHubConnection.cs.html#0646809725209998" class="t t">EventHubConnection</a>&gt; <a id="7c51e680697976f1" href="../R/7c51e680697976f1.html" target="n" data-glyph="106,1" class="i property">ConnectionFactory</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Responsible for ownership claim for load balancing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#a5baeac704f7e234" class="t t">PartitionLoadBalancer</a> <a id="5fada474e1aa15c5" href="../R/5fada474e1aa15c5.html" target="n" data-glyph="106,1" class="i property">LoadBalancer</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The set of options to use with the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r5 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">  instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <a id="90893bc9a20c9bfd" href="../R/90893bc9a20c9bfd.html" target="n" data-glyph="106,1" class="i property">Options</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The desired number of events to include in a batch to be processed.  This size is the maximum count in a batch.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private int</b> <a id="98ec68740641bf58" href="../R/98ec68740641bf58.html" target="n" data-glyph="106,1" class="i property">EventBatchMaximumCount</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r6 r t">TPartition</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">eventBatchMaximumCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The desired number of events to include in a batch to be processed.  This size is the maximum count in a batch; the actual count may be smaller, depending on whether events are available in the Event Hub.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the processor is associated with.  Events are read in the context of this group.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Event Hubs namespace to connect to.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific Event Hub to associate the processor with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Azure managed identity credential to use for authorization.  Access controls may be specified by the Event Hubs namespace or the requested Event Hub, depending on Azure configuration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to use for the processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">loadBalancer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The load balancer to use for coordinating processing with other event processor instances.  If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, the standard load balancer will be created.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a id="85d24057732ca253" href="../R/85d24057732ca253.html" target="n" data-glyph="74,1" class="t constructor">EventProcessor</a>(<b>int</b> <span id="r7 rd" class="r7 r">eventBatchMaximumCount</span>,
                                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">consumerGroup</span>,
                                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">fullyQualifiedNamespace</span>,
                                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">eventHubName</span>,
                                <a href="/Azure.Core/A.html#d93a9ffee404e938" class="t t">TokenCredential</a> <span id="r11 rd" class="r11 r">credential</span>,
                                <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <span id="r12 rd" class="r12 r">options</span> = <b>default</b>,
                                <a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#a5baeac704f7e234" class="t t">PartitionLoadBalancer</a> <span id="r13 rd" class="r13 r">loadBalancer</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#84af1169dda2bec9" class="i method">AssertInRange</a>(<span class="r7 r">eventBatchMaximumCount</span>, 1, <b>int</b>.<a href="@1@netstandard/A.html#c45153c0501d7122" class="i field">MaxValue</a>, <b>nameof</b>(<span class="r7 r">eventBatchMaximumCount</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r8 r">consumerGroup</span>, <b>nameof</b>(<span class="r8 r">consumerGroup</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Core/Argument.cs.html#4b3e3f504d747537" class="i method">AssertWellFormedEventHubsNamespace</a>(<span class="r9 r">fullyQualifiedNamespace</span>, <b>nameof</b>(<span class="r9 r">fullyQualifiedNamespace</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r10 r">eventHubName</span>, <b>nameof</b>(<span class="r10 r">eventHubName</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r11 r">credential</span>, <b>nameof</b>(<span class="r11 r">credential</span>));
 
            <span class="r12 r">options</span> = <span class="r12 r">options</span>?.<a href="EventProcessorOptions.cs.html#9454d8d5db63663d" class="i method">Clone</a>() ?? <b>new</b> <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t constructor">EventProcessorOptions</a>();
 
            <a href="#7c51e680697976f1" class="i property">ConnectionFactory</a> = () =&gt; <b>new</b> <a href="../EventHubConnection.cs.html#e3e858f9ffa9a28d" class="t constructor">EventHubConnection</a>(<span class="r9 r">fullyQualifiedNamespace</span>, <span class="r10 r">eventHubName</span>, <span class="r11 r">credential</span>, <span class="r12 r">options</span>.<a href="EventProcessorOptions.cs.html#9602fa6a24a93182" class="i property">ConnectionOptions</a>);
            <a href="#1f79ba5702fc2b68" class="i property">FullyQualifiedNamespace</a> = <span class="r9 r">fullyQualifiedNamespace</span>;
            <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a> = <span class="r10 r">eventHubName</span>;
            <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a> = <span class="r8 r">consumerGroup</span>;
            <a href="#f7fa4022e2eeea36" class="i property">Identifier</a> = <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r12 r">options</span>.<a href="EventProcessorOptions.cs.html#8aa652e7bcb51806" class="i property">Identifier</a>) ? <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@1@netstandard/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@1@netstandard/A.html#a6547a472def7796" class="i method">ToString</a>() : <span class="r12 r">options</span>.<a href="EventProcessorOptions.cs.html#8aa652e7bcb51806" class="i property">Identifier</a>;
            <a href="#18887ae4162737a9" class="i property">RetryPolicy</a> = <span class="r12 r">options</span>.<a href="EventProcessorOptions.cs.html#efbff97f25bc98e9" class="i property">RetryOptions</a>.<a href="../SharedSource/Core/EventHubsRetryOptionsExtensions.cs.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="#90893bc9a20c9bfd" class="i property">Options</a> = <span class="r12 r">options</span>;
            <a href="#98ec68740641bf58" class="i property">EventBatchMaximumCount</a> = <span class="r7 r">eventBatchMaximumCount</span>;
            <a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a> = <span class="r13 r">loadBalancer</span> ?? <b>new</b> <a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#49b58f683d1c5ed4" class="t constructor">PartitionLoadBalancer</a>(<a href="#88f121b299fd299e" class="i method">CreateStorageManager</a>(<a href="#4ce59cd6fc256750" class="k">this</a>), <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <a href="#1f79ba5702fc2b68" class="i property">FullyQualifiedNamespace</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <span class="r12 r">options</span>.<a href="EventProcessorOptions.cs.html#f9c560e2baa1fef3" class="i property">PartitionOwnershipExpirationInterval</a>, <span class="r12 r">options</span>.<a href="EventProcessorOptions.cs.html#683a6b0c2592ec66" class="i property">LoadBalancingUpdateInterval</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r14 r t">TPartition</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">eventBatchMaximumCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The desired number of events to include in a batch to be processed.  This size is the maximum count in a batch; the actual count may be smaller, depending on whether events are available in the Event Hub.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the processor is associated with.  Events are read in the context of this group.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The connection string to use for connecting to the Event Hubs namespace; it is expected that the Event Hub name and the shared key properties are contained in this connection string.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to use for the processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   If the connection string is copied from the Event Hubs namespace, it will likely not contain the name of the desired Event Hub,</span>
        <span class="c">///</span><span class="c">   which is needed.  In this case, the name can be added manually by adding &quot;;EntityPath=[[ EVENT HUB NAME ]]&quot; to the end of the</span>
        <span class="c">///</span><span class="c">   connection string.  For example, &quot;;EntityPath=telemetry-hub&quot;.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   If you have defined a shared access policy directly on the Event Hub itself, then copying the connection string from that</span>
        <span class="c">///</span><span class="c">   Event Hub will result in a connection string that contains the name.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">href</span><span class="c">=</span><span class="c">&quot;</span><span class="c">https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-get-connection-string</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">How to get an Event Hubs connection string</span><span class="c">&lt;/</span><span class="c">seealso</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a id="66f65c62a0191d35" href="../R/66f65c62a0191d35.html" target="n" data-glyph="75,1" class="t constructor">EventProcessor</a>(<b>int</b> <span id="r15 rd" class="r15 r">eventBatchMaximumCount</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r16 rd" class="r16 r">consumerGroup</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r17 rd" class="r17 r">connectionString</span>,
                                 <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <span id="r18 rd" class="r18 r">options</span> = <b>default</b>) : <a href="#e01ad4b667f2e708" class="k">this</a>(<span class="r15 r">eventBatchMaximumCount</span>, <span class="r16 r">consumerGroup</span>, <span class="r17 r">connectionString</span>, <b>null</b>, <span class="r18 r">options</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r19 r t">TPartition</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">eventBatchMaximumCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The desired number of events to include in a batch to be processed.  This size is the maximum count in a batch; the actual count may be smaller, depending on whether events are available in the Event Hub.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the processor is associated with.  Events are read in the context of this group.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The connection string to use for connecting to the Event Hubs namespace; it is expected that the shared key properties are contained in this connection string, but not the Event Hub name.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific Event Hub to associate the processor with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to use for the processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   If the connection string is copied from the Event Hub itself, it will contain the name of the desired Event Hub,</span>
        <span class="c">///</span><span class="c">   and can be used directly without passing the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">eventHubName</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.  The name of the Event Hub should be</span>
        <span class="c">///</span><span class="c">   passed only once, either as part of the connection string or separately.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">href</span><span class="c">=</span><span class="c">&quot;</span><span class="c">https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-get-connection-string</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">How to get an Event Hubs connection string</span><span class="c">&lt;/</span><span class="c">seealso</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a id="e01ad4b667f2e708" href="../R/e01ad4b667f2e708.html" target="n" data-glyph="75,1" class="t constructor">EventProcessor</a>(<b>int</b> <span id="r20 rd" class="r20 r">eventBatchMaximumCount</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r21 rd" class="r21 r">consumerGroup</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r22 rd" class="r22 r">connectionString</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r23 rd" class="r23 r">eventHubName</span>,
                                 <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <span id="r24 rd" class="r24 r">options</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#84af1169dda2bec9" class="i method">AssertInRange</a>(<span class="r20 r">eventBatchMaximumCount</span>, 1, <b>int</b>.<a href="@1@netstandard/A.html#c45153c0501d7122" class="i field">MaxValue</a>, <b>nameof</b>(<span class="r20 r">eventBatchMaximumCount</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r21 r">consumerGroup</span>, <b>nameof</b>(<span class="r21 r">consumerGroup</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r22 r">connectionString</span>, <b>nameof</b>(<span class="r22 r">connectionString</span>));
 
            <span class="r24 r">options</span> = <span class="r24 r">options</span>?.<a href="EventProcessorOptions.cs.html#9454d8d5db63663d" class="i method">Clone</a>() ?? <b>new</b> <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t constructor">EventProcessorOptions</a>();
 
            <a href="../EventHubsConnectionStringProperties.cs.html#64f2aa76721ecc75" class="k">var</a> <span id="r25 rd" class="r25 r">connectionStringProperties</span> = <a href="../EventHubsConnectionStringProperties.cs.html#64f2aa76721ecc75" class="t t">EventHubsConnectionStringProperties</a>.<a href="../EventHubsConnectionStringProperties.cs.html#1ffd9748a1d0ca94" class="i method">Parse</a>(<span class="r22 r">connectionString</span>);
            <span class="r25 r">connectionStringProperties</span>.<a href="../EventHubsConnectionStringProperties.cs.html#3dc4c9f3292b8007" class="i method">Validate</a>(<span class="r23 r">eventHubName</span>, <b>nameof</b>(<span class="r22 r">connectionString</span>));
 
            <a href="#7c51e680697976f1" class="i property">ConnectionFactory</a> = () =&gt; <b>new</b> <a href="../EventHubConnection.cs.html#298a945ee13156f2" class="t constructor">EventHubConnection</a>(<span class="r22 r">connectionString</span>, <span class="r23 r">eventHubName</span>, <span class="r24 r">options</span>.<a href="EventProcessorOptions.cs.html#9602fa6a24a93182" class="i property">ConnectionOptions</a>);
            <a href="#1f79ba5702fc2b68" class="i property">FullyQualifiedNamespace</a> = <span class="r25 r">connectionStringProperties</span>.<a href="../EventHubsConnectionStringProperties.cs.html#750e4ea2e561204f" class="i property">Endpoint</a>.<a href="@1@netstandard/A.html#c230833968da7179" class="i property">Host</a>;
            <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a> = <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r23 r">eventHubName</span>) ? <span class="r25 r">connectionStringProperties</span>.<a href="../EventHubsConnectionStringProperties.cs.html#a257c559bfc92583" class="i property">EventHubName</a> : <span class="r23 r">eventHubName</span>;
            <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a> = <span class="r21 r">consumerGroup</span>;
            <a href="#f7fa4022e2eeea36" class="i property">Identifier</a> = <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r24 r">options</span>.<a href="EventProcessorOptions.cs.html#8aa652e7bcb51806" class="i property">Identifier</a>) ? <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@1@netstandard/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@1@netstandard/A.html#a6547a472def7796" class="i method">ToString</a>() : <span class="r24 r">options</span>.<a href="EventProcessorOptions.cs.html#8aa652e7bcb51806" class="i property">Identifier</a>;
            <a href="#18887ae4162737a9" class="i property">RetryPolicy</a> = <span class="r24 r">options</span>.<a href="EventProcessorOptions.cs.html#efbff97f25bc98e9" class="i property">RetryOptions</a>.<a href="../SharedSource/Core/EventHubsRetryOptionsExtensions.cs.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="#90893bc9a20c9bfd" class="i property">Options</a> = <span class="r24 r">options</span>;
            <a href="#98ec68740641bf58" class="i property">EventBatchMaximumCount</a> = <span class="r20 r">eventBatchMaximumCount</span>;
            <a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a> = <b>new</b> <a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#49b58f683d1c5ed4" class="t constructor">PartitionLoadBalancer</a>(<a href="#88f121b299fd299e" class="i method">CreateStorageManager</a>(<a href="#4ce59cd6fc256750" class="k">this</a>), <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <a href="#1f79ba5702fc2b68" class="i property">FullyQualifiedNamespace</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <span class="r24 r">options</span>.<a href="EventProcessorOptions.cs.html#f9c560e2baa1fef3" class="i property">PartitionOwnershipExpirationInterval</a>, <span class="r24 r">options</span>.<a href="EventProcessorOptions.cs.html#683a6b0c2592ec66" class="i property">LoadBalancingUpdateInterval</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r26 r t">TPartition</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">eventBatchMaximumCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The desired number of events to include in a batch to be processed.  This size is the maximum count in a batch; the actual count may be smaller, depending on whether events are available in the Event Hub.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the processor is associated with.  Events are read in the context of this group.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Event Hubs namespace to connect to.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific Event Hub to associate the processor with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Event Hubs shared access key credential to use for authorization.  Access controls may be specified by the Event Hubs namespace or the requested Event Hub, depending on Azure configuration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to use for the processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a id="f65ef547a0b3e3da" href="../R/f65ef547a0b3e3da.html" target="n" data-glyph="74,1" class="t constructor">EventProcessor</a>(<b>int</b> <span id="r27 rd" class="r27 r">eventBatchMaximumCount</span>,
                               <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r28 rd" class="r28 r">consumerGroup</span>,
                               <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r29 rd" class="r29 r">fullyQualifiedNamespace</span>,
                               <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r30 rd" class="r30 r">eventHubName</span>,
                               <a href="../Authorization/EventHubsSharedAccessKeyCredential.cs.html#fedd60277cbbbc1c" class="t t">EventHubsSharedAccessKeyCredential</a> <span id="r31 rd" class="r31 r">credential</span>,
                               <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <span id="r32 rd" class="r32 r">options</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#84af1169dda2bec9" class="i method">AssertInRange</a>(<span class="r27 r">eventBatchMaximumCount</span>, 1, <b>int</b>.<a href="@1@netstandard/A.html#c45153c0501d7122" class="i field">MaxValue</a>, <b>nameof</b>(<span class="r27 r">eventBatchMaximumCount</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r28 r">consumerGroup</span>, <b>nameof</b>(<span class="r28 r">consumerGroup</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Core/Argument.cs.html#4b3e3f504d747537" class="i method">AssertWellFormedEventHubsNamespace</a>(<span class="r29 r">fullyQualifiedNamespace</span>, <b>nameof</b>(<span class="r29 r">fullyQualifiedNamespace</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r30 r">eventHubName</span>, <b>nameof</b>(<span class="r30 r">eventHubName</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r31 r">credential</span>, <b>nameof</b>(<span class="r31 r">credential</span>));
 
            <span class="r32 r">options</span> = <span class="r32 r">options</span>?.<a href="EventProcessorOptions.cs.html#9454d8d5db63663d" class="i method">Clone</a>() ?? <b>new</b> <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t constructor">EventProcessorOptions</a>();
 
            <a href="#7c51e680697976f1" class="i property">ConnectionFactory</a> = () =&gt; <b>new</b> <a href="../EventHubConnection.cs.html#99fd244d7decbc90" class="t constructor">EventHubConnection</a>(<span class="r29 r">fullyQualifiedNamespace</span>, <span class="r30 r">eventHubName</span>, <span class="r31 r">credential</span>, <span class="r32 r">options</span>.<a href="EventProcessorOptions.cs.html#9602fa6a24a93182" class="i property">ConnectionOptions</a>);
            <a href="#1f79ba5702fc2b68" class="i property">FullyQualifiedNamespace</a> = <span class="r29 r">fullyQualifiedNamespace</span>;
            <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a> = <span class="r30 r">eventHubName</span>;
            <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a> = <span class="r28 r">consumerGroup</span>;
            <a href="#f7fa4022e2eeea36" class="i property">Identifier</a> = <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r32 r">options</span>.<a href="EventProcessorOptions.cs.html#8aa652e7bcb51806" class="i property">Identifier</a>) ? <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@1@netstandard/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@1@netstandard/A.html#a6547a472def7796" class="i method">ToString</a>() : <span class="r32 r">options</span>.<a href="EventProcessorOptions.cs.html#8aa652e7bcb51806" class="i property">Identifier</a>;
            <a href="#18887ae4162737a9" class="i property">RetryPolicy</a> = <span class="r32 r">options</span>.<a href="EventProcessorOptions.cs.html#efbff97f25bc98e9" class="i property">RetryOptions</a>.<a href="../SharedSource/Core/EventHubsRetryOptionsExtensions.cs.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="#90893bc9a20c9bfd" class="i property">Options</a> = <span class="r32 r">options</span>;
            <a href="#98ec68740641bf58" class="i property">EventBatchMaximumCount</a> = <span class="r27 r">eventBatchMaximumCount</span>;
            <a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a> = <b>new</b> <a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#49b58f683d1c5ed4" class="t constructor">PartitionLoadBalancer</a>(<a href="#88f121b299fd299e" class="i method">CreateStorageManager</a>(<a href="#4ce59cd6fc256750" class="k">this</a>), <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <a href="#1f79ba5702fc2b68" class="i property">FullyQualifiedNamespace</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <span class="r32 r">options</span>.<a href="EventProcessorOptions.cs.html#f9c560e2baa1fef3" class="i property">PartitionOwnershipExpirationInterval</a>, <span class="r32 r">options</span>.<a href="EventProcessorOptions.cs.html#683a6b0c2592ec66" class="i property">LoadBalancingUpdateInterval</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r33 r t">TPartition</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">eventBatchMaximumCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The desired number of events to include in a batch to be processed.  This size is the maximum count in a batch; the actual count may be smaller, depending on whether events are available in the Event Hub.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the processor is associated with.  Events are read in the context of this group.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Event Hubs namespace to connect to.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific Event Hub to associate the processor with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Azure managed identity credential to use for authorization.  Access controls may be specified by the Event Hubs namespace or the requested Event Hub, depending on Azure configuration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to use for the processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a id="54cc4fbd6cebec5c" href="../R/54cc4fbd6cebec5c.html" target="n" data-glyph="75,1" class="t constructor">EventProcessor</a>(<b>int</b> <span id="r34 rd" class="r34 r">eventBatchMaximumCount</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r35 rd" class="r35 r">consumerGroup</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r36 rd" class="r36 r">fullyQualifiedNamespace</span>,
                                 <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r37 rd" class="r37 r">eventHubName</span>,
                                 <a href="/Azure.Core/A.html#d93a9ffee404e938" class="t t">TokenCredential</a> <span id="r38 rd" class="r38 r">credential</span>,
                                 <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <span id="r39 rd" class="r39 r">options</span> = <b>default</b>) : <a href="#85d24057732ca253" class="k">this</a>(<span class="r34 r">eventBatchMaximumCount</span>, <span class="r35 r">consumerGroup</span>, <span class="r36 r">fullyQualifiedNamespace</span>, <span class="r37 r">eventHubName</span>, <span class="r38 r">credential</span>, <span class="r39 r">options</span>, <b>default</b>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r40 r t">TPartition</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a id="79bbeeb6813b5b7e" href="../R/79bbeeb6813b5b7e.html" target="n" data-glyph="75,1" class="t constructor">EventProcessor</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Signals the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r41 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to begin processing events.  Should this method be called while the processor</span>
        <span class="c">///</span><span class="c">   is running, no action is taken.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the start operation.  This won&#39;t affect the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r43 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> once it starts running.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c31a825feec42232" href="../R/c31a825feec42232.html" target="n" data-glyph="72,1" class="i method">StartProcessingAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r42 rd" class="r42 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#138b50a8d677ecff" class="i method">StartProcessingInternalAsync</a>(<b>true</b>, <span class="r42 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Signals the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r44 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to begin processing events.  Should this method be called while the processor</span>
        <span class="c">///</span><span class="c">   is running, no action is taken.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the start operation.  This won&#39;t affect the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r46 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> once it starts running.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual void</b> <a id="9a8c527e8fe2ac80" href="../R/9a8c527e8fe2ac80.html" target="n" data-glyph="72,1" class="i method">StartProcessing</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r45 rd" class="r45 r">cancellationToken</span> = <b>default</b>) =&gt;
            <a href="#138b50a8d677ecff" class="i method">StartProcessingInternalAsync</a>(<b>false</b>, <span class="r45 r">cancellationToken</span>).<a href="../SharedSource/Azure.Core/TaskExtensions.cs.html#9a35b0afd931dc48" class="i method">EnsureCompleted</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Signals the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r47 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to stop processing events.  Should this method be called while the processor</span>
        <span class="c">///</span><span class="c">   is not running, no action is taken.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the stop operation.  If the operation is successfully canceled, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r49 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will keep running.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   When stopping, the processor will update the ownership of partitions that it was responsible for processing and clean up network resources used for communication with</span>
        <span class="c">///</span><span class="c">   the Event Hubs service.  As a result, this method will perform network I/O and may need to wait for partition reads that were active to complete.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">Due to service calls and network latency, an invocation of this method may take slightly longer than the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> or</span>
        <span class="c">///</span><span class="c">   if the wait time was not configured, the duration of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../EventHubsRetryOptions.cs.html#a38af17da5dfdcd4" class="t t">EventHubsRetryOptions</a>.<a href="../EventHubsRetryOptions.cs.html#01f80bad6b3816ae" class="i property">TryTimeout</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> of the configured retry policy.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ab75e98efdc7e7e6" href="../R/ab75e98efdc7e7e6.html" target="n" data-glyph="72,1" class="i method">StopProcessingAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r48 rd" class="r48 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#5cb1dc5ba8cf4a80" class="i method">StopProcessingInternalAsync</a>(<b>true</b>, <span class="r48 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Signals the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r50 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to stop processing events.  Should this method be called while the processor</span>
        <span class="c">///</span><span class="c">   is not running, no action is taken.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the stop operation.  If the operation is successfully canceled, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r52 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will keep running.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   When stopping, the processor will update the ownership of partitions that it was responsible for processing and clean up network resources used for communication with</span>
        <span class="c">///</span><span class="c">   the Event Hubs service.  As a result, this method will perform network I/O and may need to wait for partition reads that were active to complete.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">Due to service calls and network latency, an invocation of this method may take slightly longer than the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> or</span>
        <span class="c">///</span><span class="c">   if the wait time was not configured, the duration of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../EventHubsRetryOptions.cs.html#a38af17da5dfdcd4" class="t t">EventHubsRetryOptions</a>.<a href="../EventHubsRetryOptions.cs.html#01f80bad6b3816ae" class="i property">TryTimeout</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> of the configured retry policy.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual void</b> <a id="7663cd23ef8edab4" href="../R/7663cd23ef8edab4.html" target="n" data-glyph="72,1" class="i method">StopProcessing</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r51 rd" class="r51 r">cancellationToken</span> = <b>default</b>) =&gt;
            <a href="#5cb1dc5ba8cf4a80" class="i method">StopProcessingInternalAsync</a>(<b>false</b>, <span class="r51 r">cancellationToken</span>).<a href="../SharedSource/Azure.Core/TaskExtensions.cs.html#9a35b0afd931dc48" class="i method">EnsureCompleted</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Determines whether the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to compare with this instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override bool</b> <a id="5ae3b2c4c18adb30" href="../R/5ae3b2c4c18adb30.html" target="n" data-glyph="72,1" class="i method">Equals</a>(<b>object</b> <span id="r53 rd" class="r53 r">obj</span>) =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#517682d5f6f4f8b4" class="i method">Equals</a>(<span class="r53 r">obj</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Returns a hash code for this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A hash code for this instance, suitable for use in hashing algorithms and data structures like a hash table.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override int</b> <a id="eef733e91a6bf1fa" href="../R/eef733e91a6bf1fa.html" target="n" data-glyph="72,1" class="i method">GetHashCode</a>() =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#4de9cf234d0d8b16" class="i method">GetHashCode</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Converts the instance to string representation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="t t">String</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that represents this instance.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override string</b> <a id="e5415b722f498e00" href="../R/e5415b722f498e00.html" target="n" data-glyph="72,1" class="i method">ToString</a>() =&gt; <span class="s">$&quot;</span><span class="s">Event Processor&lt;</span>{ <b>typeof</b>(<span class="r0 r t">TPartition</span>).<a href="@1@netstandard/A.html#aa4f112f79364b6e" class="i property">Name</a> }<span class="s">&gt;: </span>{ <a href="#f7fa4022e2eeea36" class="i property">Identifier</a> }<span class="s">&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates an </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Core/TransportConsumer.cs.html#265a21c281157aa2" class="t t">TransportConsumer</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to use for processing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The consumer group to associate with the consumer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r55 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The partition to associated with the consumer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r56 r">eventPosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The position in the event stream where the consumer should begin reading.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">connection</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The connection to use for the consumer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The options to use for configuring the consumer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Core/TransportConsumer.cs.html#265a21c281157aa2" class="t t">TransportConsumer</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> with the requested configuration.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal virtual</b> <a href="../Core/TransportConsumer.cs.html#265a21c281157aa2" class="t t">TransportConsumer</a> <a id="4af01cbf7e755815" href="../R/4af01cbf7e755815.html" target="n" data-glyph="74,1" class="i method">CreateConsumer</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r54 rd" class="r54 r">consumerGroup</span>,
                                                          <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r55 rd" class="r55 r">partitionId</span>,
                                                          <a href="../Consumer/EventPosition.cs.html#97742fa7b7b6b68f" class="t t">EventPosition</a> <span id="r56 rd" class="r56 r">eventPosition</span>,
                                                          <a href="../EventHubConnection.cs.html#0646809725209998" class="t t">EventHubConnection</a> <span id="r57 rd" class="r57 r">connection</span>,
                                                          <a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <span id="r58 rd" class="r58 r">options</span>) =&gt;
            <span class="r57 r">connection</span>.<a href="../EventHubConnection.cs.html#8da5d70f281c7142" class="i method">CreateTransportConsumer</a>(<span class="r54 r">consumerGroup</span>, <span class="r55 r">partitionId</span>, <span class="r56 r">eventPosition</span>, <span class="r58 r">options</span>.<a href="EventProcessorOptions.cs.html#efbff97f25bc98e9" class="i property">RetryOptions</a>.<a href="../SharedSource/Core/EventHubsRetryOptionsExtensions.cs.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>(), <span class="r58 r">options</span>.<a href="EventProcessorOptions.cs.html#de96937c4bdb5883" class="i property">TrackLastEnqueuedEventProperties</a>, <span class="r59 r">prefetchCount</span>: (<b>uint</b>?)<span class="r58 r">options</span>.<a href="EventProcessorOptions.cs.html#d7f12816f1250e29" class="i property">PrefetchCount</a>, <span class="r60 r">prefetchSizeInBytes</span>: <span class="r58 r">options</span>.<a href="EventProcessorOptions.cs.html#9eb79030ca610dc0" class="i property">PrefetchSizeInBytes</a>, <span class="r61 r">ownerLevel</span>: 0);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks needed to process a batch of events.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Event Hub partition whose processing should be started.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">eventBatch</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The batch of events to process.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r64 r">dispatchEmptyBatches</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if empty batches should be dispatched to the handler; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r65 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f389da6292da8c31" href="../R/f389da6292da8c31.html" target="n" data-glyph="74,1" class="i method">ProcessEventBatchAsync</a>(<span class="r0 r t">TPartition</span> <span id="r62 rd" class="r62 r">partition</span>,
                                                           <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../EventData.cs.html#557aa370d1369b89" class="t t">EventData</a>&gt; <span id="r63 rd" class="r63 r">eventBatch</span>,
                                                           <b>bool</b> <span id="r64 rd" class="r64 r">dispatchEmptyBatches</span>,
                                                           <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r65 rd" class="r65 r">cancellationToken</span>)
        {
            <span class="r65 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <span class="c">// If there were no events in the batch and empty batches should not be emitted,</span>
            <span class="c">// take no further action.</span>
 
            <b>if</b> (((<span class="r63 r">eventBatch</span> == <b>null</b>) || (<span class="r63 r">eventBatch</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a> &lt;= 0)) &amp;&amp; (!<span class="r64 r">dispatchEmptyBatches</span>))
            {
                <b>return</b>;
            }
 
            <span class="c">// Create the diagnostics scope used for distributed tracing and instrument the events in the batch.</span>
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="k">var</a> <span id="r66 rd" class="r66 r">diagnosticScope</span> = <a href="../SharedSource/Diagnostics/EventDataInstrumentation.cs.html#29a2ad8b9661f165" class="t t">EventDataInstrumentation</a>.<a href="../SharedSource/Diagnostics/EventDataInstrumentation.cs.html#c97c98c65f7ca1ea" class="i property">ScopeFactory</a>.<a href="../SharedSource/Azure.Core/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#291e06d56b1b9d57" class="t t">DiagnosticProperty</a>.<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#467c17b55322cc67" class="i property">EventProcessorProcessingActivityName</a>);
            <span class="r66 r">diagnosticScope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#de8c555385928780" class="i method">AddAttribute</a>(<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#291e06d56b1b9d57" class="t t">DiagnosticProperty</a>.<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#db1f99aa4b272c1b" class="i field">KindAttribute</a>, <a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#291e06d56b1b9d57" class="t t">DiagnosticProperty</a>.<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#cb02ef9e3e14ff2d" class="i field">ConsumerKind</a>);
            <span class="r66 r">diagnosticScope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#de8c555385928780" class="i method">AddAttribute</a>(<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#291e06d56b1b9d57" class="t t">DiagnosticProperty</a>.<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#4aaa8d131d71f3b6" class="i field">EventHubAttribute</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>);
            <span class="r66 r">diagnosticScope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#de8c555385928780" class="i method">AddAttribute</a>(<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#291e06d56b1b9d57" class="t t">DiagnosticProperty</a>.<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#a647f64c774b9985" class="i field">EndpointAttribute</a>, <a href="#1f79ba5702fc2b68" class="i property">FullyQualifiedNamespace</a>);
 
            <b>if</b> ((<span class="r66 r">diagnosticScope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#75babd7c7d588dd8" class="i property">IsEnabled</a>) &amp;&amp; (<span class="r63 r">eventBatch</span>.<a href="@1@netstandard/A.html#8788153112b7ffd0" class="i method">Any</a>()))
            {
                <b>foreach</b> (<a href="../EventData.cs.html#557aa370d1369b89" class="k">var</a> <span id="r67 rd" class="r67 r">eventData</span> <b>in</b> <span class="r63 r">eventBatch</span>)
                {
                    <b>if</b> (<a href="../SharedSource/Diagnostics/EventDataInstrumentation.cs.html#29a2ad8b9661f165" class="t t">EventDataInstrumentation</a>.<a href="../SharedSource/Diagnostics/EventDataInstrumentation.cs.html#443a64f1538af62f" class="i method">TryExtractDiagnosticId</a>(<span class="r67 r">eventData</span>, <b>out string</b> <span id="r68 rd" class="r68 r">diagnosticId</span>))
                    {
                        <a href="@1@netstandard/A.html#d3599058f8d79be0" class="k">var</a> <span id="r69 rd" class="r69 r">attributes</span> = <b>new</b> <a href="@1@netstandard/A.html#6a2b29a26fb6e208" class="t constructor">Dictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>&gt;(1)
                        {
                            { <a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#291e06d56b1b9d57" class="t t">DiagnosticProperty</a>.<a href="../SharedSource/Diagnostics/DiagnosticProperty.cs.html#bb737b6f8fd14688" class="i field">EnqueuedTimeAttribute</a>, <span class="r67 r">eventData</span>.<a href="../EventData.cs.html#1329a88ca5242716" class="i property">EnqueuedTime</a>.<a href="@1@netstandard/A.html#8f33340c07c4787e" class="i method">ToUnixTimeMilliseconds</a>().<a href="@1@netstandard/A.html#db750e3aaa9e3279" class="i method">ToString</a>(<a href="@1@netstandard/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@netstandard/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>) }
                        };
 
                        <span class="r66 r">diagnosticScope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#d367e83961d030cd" class="i method">AddLink</a>(<span class="r68 r">diagnosticId</span>, <span class="r69 r">attributes</span>);
                    }
                }
            }
 
            <span class="r66 r">diagnosticScope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <span class="c">// Dispatch the batch to the handler for processing.  Exceptions in the handler code are intended to be</span>
            <span class="c">// unhandled by the processor; explicitly signal that the exception was observed in developer-provided</span>
            <span class="c">// code.</span>
 
            <b>try</b>
            {
                <b>await</b> <a href="#2fe3df4a4637e1cc" class="i method">OnProcessingEventBatchAsync</a>(<span class="r63 r">eventBatch</span>, <span class="r62 r">partition</span>, <span class="r65 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r70 rd" class="r70 r">ex</span>)
            {
                <span class="r66 r">diagnosticScope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r70 r">ex</span>);
                <b>throw</b> <b>new</b> <a href="../Core/DeveloperCodeException.cs.html#d299d906494d30e9" class="t constructor">DeveloperCodeException</a>(<span class="r70 r">ex</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates the infrastructure for tracking the processing of a partition and begins processing the</span>
        <span class="c">///</span><span class="c">   partition in the background until cancellation is requested.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r71 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Event Hub partition whose processing should be started.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">startingPosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The position within the event stream that processing should begin.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r73 r">cancellationSource</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#83c5a9fd72574778" class="t t">PartitionProcessor</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> encapsulating the processing task, its cancellation token, and associated state.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   This method makes liberal use of class methods and state in addition to the received parameters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal virtual</b> <a href="#83c5a9fd72574778" class="t t">PartitionProcessor</a> <a id="2f5619de311efad5" href="../R/2f5619de311efad5.html" target="n" data-glyph="74,1" class="i method">CreatePartitionProcessor</a>(<span class="r0 r t">TPartition</span> <span id="r71 rd" class="r71 r">partition</span>,
                                                                     <a href="../Consumer/EventPosition.cs.html#97742fa7b7b6b68f" class="t t">EventPosition</a> <span id="r72 rd" class="r72 r">startingPosition</span>,
                                                                     <a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a> <span id="r73 rd" class="r73 r">cancellationSource</span>)
        {
            <span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#9e22b9c8995bf195" class="i property">Token</a>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="../Core/TransportConsumer.cs.html#265a21c281157aa2" class="k">var</a> <span id="r74 rd" class="r74 r">consumer</span> = <b>default</b>(<a href="../Core/TransportConsumer.cs.html#265a21c281157aa2" class="t t">TransportConsumer</a>);
 
            <span class="c">// If the tracking of the last enqueued event properties was requested, then read the</span>
            <span class="c">// properties from the active consumer, which can change during processing in the event of</span>
            <span class="c">// error scenarios.</span>
 
            <a href="../Consumer/LastEnqueuedEventProperties.cs.html#e54b900e1c5c3c73" class="t t">LastEnqueuedEventProperties</a> <a id="f9baaa12342c79d0" href="../R/f9baaa12342c79d0.html" target="n" data-glyph="76,2" class="i method">readLastEnquedEventInformation</a>()
            {
                <span class="c">// This is not an expected scenario; the guard exists to prevent a race condition that is</span>
                <span class="c">// unlikely, but possible, when partition processing is being stopped or consumer creation</span>
                <span class="c">// outright failed.</span>
 
                <b>if</b> ((<span class="r74 r">consumer</span> == <b>null</b>) || (<span class="r74 r">consumer</span>.<a href="../Core/TransportConsumer.cs.html#1b6d41ebcf86042e" class="i property">IsClosed</a>))
                {
                    <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Core/Argument.cs.html#eda8ff4d51bf8b3e" class="i method">AssertNotClosed</a>(<b>true</b>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#3a7d3fdccd5b0111" class="i property">ClientNeededForThisInformationNotAvailable</a>);
                }
 
                <b>return</b> <b>new</b> <a href="../Consumer/LastEnqueuedEventProperties.cs.html#f8a657afe06228dc" class="t constructor">LastEnqueuedEventProperties</a>(<span class="r74 r">consumer</span>.<a href="../Core/TransportConsumer.cs.html#8974ffb1d687671c" class="i property">LastReceivedEvent</a>);
            }
 
            <span class="c">// Define the routine to handle processing for the partition.</span>
 
            <b>async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="6c367fce319c7e36" href="../R/6c367fce319c7e36.html" target="n" data-glyph="76,2" class="i method">performProcessing</a>()
            {
                <span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#9e22b9c8995bf195" class="i property">Token</a>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
                <a href="../EventHubConnection.cs.html#0646809725209998" class="k">var</a> <span id="r75 rd" class="r75 r">connection</span> = <b>default</b>(<a href="../EventHubConnection.cs.html#0646809725209998" class="t t">EventHubConnection</a>);
                <a href="@1@netstandard/A.html#ffebe438fd9cbf0e" class="k">var</a> <span id="r76 rd" class="r76 r">retryDelay</span> = <b>default</b>(<a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>?);
                <a href="@1@netstandard/A.html#f092fb2b893a0162" class="k">var</a> <span id="r77 rd" class="r77 r">capturedException</span> = <b>default</b>(<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a>);
                <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="k">var</a> <span id="r78 rd" class="r78 r">eventBatch</span> = <b>default</b>(<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../EventData.cs.html#557aa370d1369b89" class="t t">EventData</a>&gt;);
                <a href="../EventData.cs.html#557aa370d1369b89" class="k">var</a> <span id="r79 rd" class="r79 r">lastEvent</span> = <b>default</b>(<a href="../EventData.cs.html#557aa370d1369b89" class="t t">EventData</a>);
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r80 rd" class="r80 r">failedAttemptCount</span> = 0;
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r81 rd" class="r81 r">failedConsumerCount</span> = 0;
 
                <span class="c">// Create the connection to be used for spawning consumers; if the creation</span>
                <span class="c">// fails, then consider the processing task to be failed.  The main processing</span>
                <span class="c">// loop will take responsibility for attempting to restart or relinquishing ownership.</span>
 
                <b>try</b>
                {
                    <span class="r75 r">connection</span> = <a href="#6bf4729787ecddf5" class="i method">CreateConnection</a>();
                }
                <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r82 rd" class="r82 r">ex</span>)
                {
                    <span class="c">// The error handler is invoked as a fire-and-forget task; the processor does not assume responsibility</span>
                    <span class="c">// for observing or surfacing exceptions that may occur in the handler.</span>
 
                    <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r82 r">ex</span>, <span class="r71 r">partition</span>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#eb0374fbddc26e17" class="i property">OperationReadEvents</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
                    <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#1220d9302bb0b572" class="i method">EventProcessorPartitionProcessingError</a>(<span class="r71 r">partition</span>.<a href="EventProcessorPartition.cs.html#78ef0d1266ee7e2e" class="i property">PartitionId</a>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r82 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
 
                    <b>throw</b>;
                }
 
                <b>await using</b> <b>var</b> <span id="r83 rd" class="r83 r">connectionAwaiter</span> = <span class="r75 r">connection</span>.<span class="i method">ConfigureAwait</span>(<b>false</b>);
 
                <span class="c">// Continue processing the partition until cancellation is signaled or until the count of failed consumers is too great.</span>
                <span class="c">// Consumers which been consistently unable to receive and process events will be considered invalid and abandoned for a new consumer.</span>
 
                <b>while</b> ((!<span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#716cb764064ecfeb" class="i property">IsCancellationRequested</a>) &amp;&amp; (<span class="r81 r">failedConsumerCount</span> &lt;= <a href="#21a53c68cf6345aa" class="i field">MaximumFailedConsumerCount</a>))
                {
                    <b>try</b>
                    {
                        <span class="r74 r">consumer</span> = <a href="#4af01cbf7e755815" class="i method">CreateConsumer</a>(<a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r71 r">partition</span>.<a href="EventProcessorPartition.cs.html#78ef0d1266ee7e2e" class="i property">PartitionId</a>, <span class="r72 r">startingPosition</span>, <span class="r75 r">connection</span>, <a href="#90893bc9a20c9bfd" class="i property">Options</a>);
 
                        <span class="c">// Allow the core dispatching loop to apply an additional set of retries over any provided by the consumer</span>
                        <span class="c">// itself, as a processor should be as resilient as possible and retain partition ownership if processing is</span>
                        <span class="c">// able to make forward progress.  If the retries are exhausted or a non-retriable exception occurs, the</span>
                        <span class="c">// consumer will be considered invalid and potentially refreshed.</span>
 
                        <b>while</b> (!<span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#716cb764064ecfeb" class="i property">IsCancellationRequested</a>)
                        {
                            <b>try</b>
                            {
                                <span class="r78 r">eventBatch</span> = <b>await</b> <span class="r74 r">consumer</span>.<a href="../Core/TransportConsumer.cs.html#4f7e13089124884f" class="i method">ReceiveAsync</a>(<a href="#98ec68740641bf58" class="i property">EventBatchMaximumCount</a>, <a href="#90893bc9a20c9bfd" class="i property">Options</a>.<a href="EventProcessorOptions.cs.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a>, <span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#9e22b9c8995bf195" class="i property">Token</a>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                                <b>await</b> <a href="#f389da6292da8c31" class="i method">ProcessEventBatchAsync</a>(<span class="r71 r">partition</span>, <span class="r78 r">eventBatch</span>, <a href="#90893bc9a20c9bfd" class="i property">Options</a>.<a href="EventProcessorOptions.cs.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a>.<a href="@1@netstandard/A.html#7bbe60e33e857298" class="i property">HasValue</a>, <span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#9e22b9c8995bf195" class="i property">Token</a>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
                                <span class="c">// If the batch was successfully processed, capture the last event as the current starting position, in the</span>
                                <span class="c">// event that the consumer becomes invalid and needs to be replaced.</span>
 
                                <span class="r79 r">lastEvent</span> = (<span class="r78 r">eventBatch</span> != <b>null</b> &amp;&amp; <span class="r78 r">eventBatch</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a> &gt; 0) ? <span class="r78 r">eventBatch</span><a href="@1@netstandard/A.html#82c76a7ac911cb07">[</a><span class="r78 r">eventBatch</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a> - 1] : <b>null</b>;
 
                                <b>if</b> ((<span class="r79 r">lastEvent</span> != <b>null</b>) &amp;&amp; (<span class="r79 r">lastEvent</span>.<a href="../EventData.cs.html#64e1427ef56874d4" class="i property">Offset</a> != <b>long</b>.<a href="@1@netstandard/A.html#6159ffbc81b2a9a9" class="i field">MinValue</a>))
                                {
                                    <span class="r72 r">startingPosition</span> = <a href="../Consumer/EventPosition.cs.html#97742fa7b7b6b68f" class="t t">EventPosition</a>.<a href="../Consumer/EventPosition.cs.html#7bd33a697bf152f3" class="i method">FromOffset</a>(<span class="r79 r">lastEvent</span>.<a href="../EventData.cs.html#64e1427ef56874d4" class="i property">Offset</a>, <b>false</b>);
                                }
 
                                <span class="c">// If event batches are successfully processed, then the need for forward progress is</span>
                                <span class="c">// satisfied, and the failure counts should reset.</span>
 
                                <span class="r80 r">failedAttemptCount</span> = 0;
                                <span class="r81 r">failedConsumerCount</span> = 0;
                            }
                            <b>catch</b> (<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>) <b>when</b> (<span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#716cb764064ecfeb" class="i property">IsCancellationRequested</a>)
                            {
                                <span class="c">// Do not log; this is an expected scenario when partition processing is asked to stop.</span>
 
                                <b>throw</b>;
                            }
                            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r84 rd" class="r84 r">ex</span>) <b>when</b> (<span class="r84 r">ex</span>.<a href="../Core/ExceptionExtensions.cs.html#9eb730287c29e908" class="i method">IsNotType</a>&lt;<a href="../Core/DeveloperCodeException.cs.html#9d518ca61841725e" class="t t">DeveloperCodeException</a>&gt;())
                            {
                                <span class="c">// The error handler is invoked as a fire-and-forget task; the processor does not assume responsibility</span>
                                <span class="c">// for observing or surfacing exceptions that may occur in the handler.</span>
 
                                <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r84 r">ex</span>, <span class="r71 r">partition</span>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#eb0374fbddc26e17" class="i property">OperationReadEvents</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
 
                                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#1220d9302bb0b572" class="i method">EventProcessorPartitionProcessingError</a>(<span class="r71 r">partition</span>.<a href="EventProcessorPartition.cs.html#78ef0d1266ee7e2e" class="i property">PartitionId</a>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r84 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                                <span class="r76 r">retryDelay</span> = <a href="#18887ae4162737a9" class="i property">RetryPolicy</a>.<a href="../EventHubsRetryPolicy.cs.html#c5e093355028266b" class="i method">CalculateRetryDelay</a>(<span class="r84 r">ex</span>, ++<span class="r80 r">failedAttemptCount</span>);
 
                                <b>if</b> (!<span class="r76 r">retryDelay</span>.<a href="@1@netstandard/A.html#7bbe60e33e857298" class="i property">HasValue</a>)
                                {
                                    <span class="c">// If the exception should not be retried, then allow it to pass to the outer loop; this is intended</span>
                                    <span class="c">// to prevent being stuck in a corrupt state where the consumer is unable to read events.</span>
 
                                    <b>throw</b>;
                                }
 
                                <b>await</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#b070ae859dd3f7b7" class="i method">Delay</a>(<span class="r76 r">retryDelay</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>, <span class="r73 r">cancellationSource</span>.<a href="@1@netstandard/A.html#9e22b9c8995bf195" class="i property">Token</a>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                            }
                        }
                    }
                    <b>catch</b> (<a href="@1@netstandard/A.html#a0a8b79c277cf327" class="t t">OperationCanceledException</a> <span id="r85 rd" class="r85 r">ex</span>)
                    {
                        <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#cf712bfd26a8e4c2" class="t constructor">TaskCanceledException</a>(<span class="r85 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>, <span class="r85 r">ex</span>);
                    }
                    <b>catch</b> (<a href="../Core/DeveloperCodeException.cs.html#9d518ca61841725e" class="t t">DeveloperCodeException</a> <span id="r86 rd" class="r86 r">ex</span>)
                    {
                        <span class="c">// Record that an exception was observed in developer-provided code, but consider it fatal and take no further</span>
                        <span class="c">// steps to handle or dispatch it.</span>
 
                        <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r87 rd" class="r87 r">message</span> = <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#c07c3772222caaff" class="i method">Format</a>(<a href="@1@netstandard/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@netstandard/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#76e1fe4e1025c462" class="i property">DeveloperCodeExceptionMessageMask</a>, <span class="r86 r">ex</span>.<a href="@1@netstandard/A.html#89c20b39fb04108b" class="i property">InnerException</a>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                        <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#1220d9302bb0b572" class="i method">EventProcessorPartitionProcessingError</a>(<span class="r71 r">partition</span>.<a href="EventProcessorPartition.cs.html#78ef0d1266ee7e2e" class="i property">PartitionId</a>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r87 r">message</span>);
 
                        <a href="@1@netstandard/A.html#1443447025759846" class="t t">ExceptionDispatchInfo</a>.<a href="@1@netstandard/A.html#139923899a417d5a" class="i method">Capture</a>(<span class="r86 r">ex</span>.<a href="@1@netstandard/A.html#89c20b39fb04108b" class="i property">InnerException</a>).<a href="@1@netstandard/A.html#fc3b312e2d0ab87a" class="i method">Throw</a>();
                    }
                    <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r88 rd" class="r88 r">ex</span>) <b>when</b> (<span class="r88 r">ex</span>.<a href="../Core/ExceptionExtensions.cs.html#cf696fe6b8e05557" class="i method">IsFatalException</a>())
                    {
                        <b>throw</b>;
                    }
                    <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r89 rd" class="r89 r">ex</span>)
                    {
                        ++<span class="r81 r">failedConsumerCount</span>;
                        <span class="r77 r">capturedException</span> = <span class="r89 r">ex</span>;
                    }
                    <b>finally</b>
                    {
                        <b>try</b>
                        {
                            <b>if</b> (<span class="r74 r">consumer</span> != <b>null</b>)
                            {
                                <b>await</b> <span class="r74 r">consumer</span>.<a href="../Core/TransportConsumer.cs.html#6cef8b00615c84d4" class="i method">CloseAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                            }
                        }
                        <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r90 rd" class="r90 r">ex</span>)
                        {
                            <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#1220d9302bb0b572" class="i method">EventProcessorPartitionProcessingError</a>(<span class="r71 r">partition</span>.<a href="EventProcessorPartition.cs.html#78ef0d1266ee7e2e" class="i property">PartitionId</a>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r90 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
 
                            <span class="c">// Do not bubble the exception, as the consumer is being refreshed; failure to close this consumer is non-fatal.</span>
                        }
                    }
                }
 
                <span class="c">// If there was an exception captured, then surface it.  Otherwise signal that cancellation took place.</span>
 
                <b>if</b> (<span class="r77 r">capturedException</span> != <b>null</b>)
                {
                    <a href="@1@netstandard/A.html#1443447025759846" class="t t">ExceptionDispatchInfo</a>.<a href="@1@netstandard/A.html#139923899a417d5a" class="i method">Capture</a>(<span class="r77 r">capturedException</span>).<a href="@1@netstandard/A.html#fc3b312e2d0ab87a" class="i method">Throw</a>();
                }
 
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#60da317efa09fc04" class="t constructor">TaskCanceledException</a>();
            }
 
            <span class="c">// Start processing in the background and return the processor</span>
            <span class="c">// metadata.</span>
 
            <b>return</b> <b>new</b> <a href="#78d2659883eaa876" class="t constructor">PartitionProcessor</a>
            (
                <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#101f1757fbbf2575" class="i method">Run</a>(<a href="#6c367fce319c7e36" class="i method">performProcessing</a>),
                <span class="r71 r">partition</span>,
                <a href="#f9baaa12342c79d0" class="i method">readLastEnquedEventInformation</a>,
                <span class="r73 r">cancellationSource</span>
            );
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates an </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../EventHubConnection.cs.html#0646809725209998" class="t t">EventHubConnection</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to use for communicating with the Event Hubs service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The requested </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../EventHubConnection.cs.html#0646809725209998" class="t t">EventHubConnection</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected internal virtual</b> <a href="../EventHubConnection.cs.html#0646809725209998" class="t t">EventHubConnection</a> <a id="6bf4729787ecddf5" href="../R/6bf4729787ecddf5.html" target="n" data-glyph="75,1" class="i method">CreateConnection</a>() =&gt; <a href="#7c51e680697976f1" class="i property">ConnectionFactory</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Produces a list of the available checkpoints for the Event Hub and consumer group associated with the</span>
        <span class="c">///</span><span class="c">   event processor instance, so that processing for a given set of partitions can be properly initialized.</span>
        <span class="c">///</span><span class="c">   It&#39;s recommended that </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#baf5ffc6e8936d2e" class="i method">GetCheckpointAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is implemented as well as </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9f7a800d61e24bd1" class="i method">ListCheckpointsAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to achieve an optimal performance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.  This is most likely to occur when the processor is shutting down.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The set of checkpoints for the processor to take into account when initializing partitions.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Should a partition not have a corresponding checkpoint, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#eccc0976e25b4b6e" class="i property">DefaultStartingPosition</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will</span>
        <span class="c">///</span><span class="c">   be used to initialize the partition for processing.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   In the event that a custom starting point is desired for a single partition, or each partition should start at a unique place,</span>
        <span class="c">///</span><span class="c">   it is recommended that this method express that intent by returning checkpoints for those partitions with the desired custom</span>
        <span class="c">///</span><span class="c">   starting location set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected abstract</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="t t">EventProcessorCheckpoint</a>&gt;&gt; <a id="9f7a800d61e24bd1" href="../R/9f7a800d61e24bd1.html" target="n" data-glyph="75,1" class="i method">ListCheckpointsAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r91 rd" class="r91 r">cancellationToken</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Returns a checkpoint for the Event Hub, consumer group, and identifier of the partition associated with the</span>
        <span class="c">///</span><span class="c">   event processor instance, so that processing for a given partition can be properly initialized.</span>
        <span class="c">///</span><span class="c">   The default implementation calls the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9f7a800d61e24bd1" class="i method">ListCheckpointsAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and filters results by </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="t t">EventProcessorCheckpoint</a>.<a href="EventProcessorCheckpoint.cs.html#145e376eab80843c" class="i property">PartitionId</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c">   It&#39;s recommended that this method is overriden in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r92 r t">TPartition</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> implementations to achieve an optimal performance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The identifier of the partition for which to retrieve the checkpoint.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.  This is most likely to occur when the processor is shutting down.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The checkpoint for the processor to take into account when initializing partition.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Should a partition not have a corresponding checkpoint, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#eccc0976e25b4b6e" class="i property">DefaultStartingPosition</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will</span>
        <span class="c">///</span><span class="c">   be used to initialize the partition for processing.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   In the event that a custom starting point is desired for a single partition, or each partition should start at a unique place,</span>
        <span class="c">///</span><span class="c">   it is recommended that this method express that intent by returning checkpoints for those partitions with the desired custom</span>
        <span class="c">///</span><span class="c">   starting location set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="t t">EventProcessorCheckpoint</a>&gt; <a id="baf5ffc6e8936d2e" href="../R/baf5ffc6e8936d2e.html" target="n" data-glyph="75,1" class="i method">GetCheckpointAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r93 rd" class="r93 r">partitionId</span>,
                                                                                  <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r94 rd" class="r94 r">cancellationToken</span>)
        {
            <b>foreach</b> (<a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="k">var</a> <span id="r95 rd" class="r95 r">checkpoint</span> <b>in</b> <b>await</b> <a href="#9f7a800d61e24bd1" class="i method">ListCheckpointsAsync</a>(<span class="r94 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>))
            {
                <b>if</b> (<span class="r95 r">checkpoint</span>.<a href="EventProcessorCheckpoint.cs.html#145e376eab80843c" class="i property">PartitionId</a> == <span class="r93 r">partitionId</span>)
                {
                    <b>return</b> <span class="r95 r">checkpoint</span>;
                }
            }
 
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Produces a list of the ownership assignments for partitions between each of the cooperating event processor</span>
        <span class="c">///</span><span class="c">   instances for a given Event Hub and consumer group pairing.  This method is used when load balancing to allow</span>
        <span class="c">///</span><span class="c">   the processor to discover other active collaborators and to make decisions about how to best balance work</span>
        <span class="c">///</span><span class="c">   between them.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.  This is most likely to occur when the processor is shutting down.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The set of ownership records to take into account when making load balancing decisions.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected abstract</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="t t">EventProcessorPartitionOwnership</a>&gt;&gt; <a id="5fef5dfceb76fe84" href="../R/5fef5dfceb76fe84.html" target="n" data-glyph="75,1" class="i method">ListOwnershipAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r96 rd" class="r96 r">cancellationToken</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Attempts to claim ownership of the specified partitions for processing.  This method is used by</span>
        <span class="c">///</span><span class="c">   load balancing to allow event processor instances to distribute the responsibility for processing</span>
        <span class="c">///</span><span class="c">   partitions for a given Event Hub and consumer group pairing amongst the active event processors.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">desiredOwnership</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of partition ownership desired by the event processor instance; this is the set of partitions that it will attempt to request responsibility for processing.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r98 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.  This is most likely to occur when the processor is shutting down.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The set of ownership records for the partitions that were successfully claimed; this is expected to be the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">desiredOwnership</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or a subset of those partitions.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected abstract</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="t t">EventProcessorPartitionOwnership</a>&gt;&gt; <a id="d88023bbad1f6455" href="../R/d88023bbad1f6455.html" target="n" data-glyph="75,1" class="i method">ClaimOwnershipAsync</a>(<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="t t">EventProcessorPartitionOwnership</a>&gt; <span id="r97 rd" class="r97 r">desiredOwnership</span>,
                                                                                                   <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r98 rd" class="r98 r">cancellationToken</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks needed to process a batch of events for a given partition as they are read from the Event Hubs service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">events</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The batch of events to be processed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The context of the partition from which the events were read.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.  This is most likely to occur when the processor is shutting down.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">The number of events in the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r99 r">events</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> batch may vary.  The batch will contain a number of events between zero and batch size that was</span>
        <span class="c">///</span><span class="c">   requested when the processor was created, depending on the availability of events in the partition within the requested </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c">   interval.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   If there are enough events available in the Event Hub partition to fill a batch of the requested size, the processor will populate the batch and dispatch it to this method</span>
        <span class="c">///</span><span class="c">   immediately.  If there were not a sufficient number of events available in the partition to populate a full batch, the event processor will continue reading from the partition</span>
        <span class="c">///</span><span class="c">   to reach the requested batch size until the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has elapsed, at which point it will return a batch containing whatever events were</span>
        <span class="c">///</span><span class="c">   available by the end of that period.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   If a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> was not requested, indicated by setting the option to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, the event processor will continue reading from the Event Hub</span>
        <span class="c">///</span><span class="c">   partition until a full batch of the requested size could be populated and will not dispatch any partial batches to this method.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">Should an exception occur within the code for this method, the event processor will allow it to bubble and will not surface to the error handler or attempt to handle</span>
        <span class="c">///</span><span class="c">   it in any way.  Developers are strongly encouraged to take exception scenarios into account and guard against them using try/catch blocks and other means as appropriate.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">para</span><span class="c">&gt;</span><span class="c">It is not recommended that the state of the processor be managed directly from within this method; requesting to start or stop the processor may result in</span>
        <span class="c">///</span><span class="c">   a deadlock scenario, especially if using the synchronous form of the call.</span><span class="c">&lt;/</span><span class="c">para</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected abstract</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="2fe3df4a4637e1cc" href="../R/2fe3df4a4637e1cc.html" target="n" data-glyph="75,1" class="i method">OnProcessingEventBatchAsync</a>(<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="../EventData.cs.html#557aa370d1369b89" class="t t">EventData</a>&gt; <span id="r99 rd" class="r99 r">events</span>,
                                                            <span class="r0 r t">TPartition</span> <span id="r100 rd" class="r100 r">partition</span>,
                                                            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r101 rd" class="r101 r">cancellationToken</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks needed when an unexpected exception occurs within the operation of the</span>
        <span class="c">///</span><span class="c">   event processor infrastructure.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">exception</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The exception that occurred during operation of the event processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The context of the partition associated with the error, if any; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.  This may only be initialized for members of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorPartition.cs.html#f166f8955ab127cc" class="t t">EventProcessorPartition</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">, depending on the point at which the error occurred.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">operationDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A short textual description of the operation during which the exception occurred; intended to be informational only.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.  This is most likely to occur when the processor is shutting down.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   This error handler is invoked when there is an exception observed within the event processor itself; it is not invoked for exceptions in</span>
        <span class="c">///</span><span class="c">   code that has been implemented to process events or other overrides and extension points that are not critical to the processor&#39;s operation.</span>
        <span class="c">///</span><span class="c">   The event processor will make every effort to recover from exceptions and continue processing.  Should an exception that cannot be recovered</span>
        <span class="c">///</span><span class="c">   from be encountered, the processor will attempt to forfeit ownership of all partitions that it was processing so that work may be redistributed.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   The exceptions surfaced to this method may be fatal or non-fatal; because the processor may not be able to accurately predict whether an</span>
        <span class="c">///</span><span class="c">   exception was fatal or whether its state was corrupted, this method has responsibility for making the determination as to whether processing</span>
        <span class="c">///</span><span class="c">   should be terminated or restarted.  The method may do so by calling Stop on the processor instance and then, if desired, calling Start on the processor.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   It is recommended that, for production scenarios, the decision be made by considering observations made by this error handler, the method invoked</span>
        <span class="c">///</span><span class="c">   when initializing processing for a partition, and the method invoked when processing for a partition is stopped.  Many developers will also include</span>
        <span class="c">///</span><span class="c">   data from their monitoring platforms in this decision as well.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   As with event processing, should an exception occur in the code for the error handler, the event processor will allow it to bubble and will not attempt to handle</span>
        <span class="c">///</span><span class="c">   it in any way.  Developers are strongly encouraged to take exception scenarios into account and guard against them using try/catch blocks and other means as appropriate.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected abstract</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7217205759deca42" href="../R/7217205759deca42.html" target="n" data-glyph="75,1" class="i method">OnProcessingErrorAsync</a>(<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r102 rd" class="r102 r">exception</span>,
                                                       <span class="r0 r t">TPartition</span> <span id="r103 rd" class="r103 r">partition</span>,
                                                       <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r104 rd" class="r104 r">operationDescription</span>,
                                                       <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r105 rd" class="r105 r">cancellationToken</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks to initialize a partition, and its associated context, for event processing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The context of the partition being initialized.  Only the well-known members of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorPartition.cs.html#f166f8955ab127cc" class="t t">EventProcessorPartition</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be populated.  If a custom context is being used, the implementor of this method is responsible for initializing custom members.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r107 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the initialization.  This is most likely to occur if the partition is claimed by another event processor instance or the processor is shutting down.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   It is not recommended that the state of the processor be managed directly from within this method; requesting to start or stop the processor may result in</span>
        <span class="c">///</span><span class="c">   a deadlock scenario, especially if using the synchronous form of the call.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected virtual</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="b2edd322d381cb5b" href="../R/b2edd322d381cb5b.html" target="n" data-glyph="75,1" class="i method">OnInitializingPartitionAsync</a>(<span class="r0 r t">TPartition</span> <span id="r106 rd" class="r106 r">partition</span>,
                                                            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r107 rd" class="r107 r">cancellationToken</span>) =&gt; <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks needed when processing for a partition is being stopped.  This commonly occurs when the partition</span>
        <span class="c">///</span><span class="c">   is claimed by another event processor instance or when the current event processor instance is shutting down.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r108 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The context of the partition for which processing is being stopped.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r109 r">reason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason that processing is being stopped for the partition.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.  This is not expected to signal under normal circumstances and will only occur if the processor encounters an unrecoverable error.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   It is not recommended that the state of the processor be managed directly from within this method; requesting to start or stop the processor may result in</span>
        <span class="c">///</span><span class="c">   a deadlock scenario, especially if using the synchronous form of the call.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected virtual</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="8fbddb021078bdd0" href="../R/8fbddb021078bdd0.html" target="n" data-glyph="75,1" class="i method">OnPartitionProcessingStoppedAsync</a>(<span class="r0 r t">TPartition</span> <span id="r108 rd" class="r108 r">partition</span>,
                                                                 <a href="../Processor/ProcessingStoppedReason.cs.html#79a7fa1c0b5a3dbd" class="t t">ProcessingStoppedReason</a> <span id="r109 rd" class="r109 r">reason</span>,
                                                                 <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r110 rd" class="r110 r">cancellationToken</span>) =&gt; <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   A set of information about the last enqueued event of a partition, as observed by the associated EventHubs client</span>
        <span class="c">///</span><span class="c">   associated with this context as events are received from the Event Hubs service.  This is only available if the consumer was</span>
        <span class="c">///</span><span class="c">   created with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Consumer/ReadEventOptions.cs.html#897fd8591f87ab3a" class="t t">ReadEventOptions</a>.<a href="../Consumer/ReadEventOptions.cs.html#43c7feb4920f033f" class="i property">TrackLastEnqueuedEventProperties</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> set.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The identifier of the Event Hub partition to read the properties from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The set of properties for the last event that was enqueued to the partition.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   When information about the partition&#39;s last enqueued event is being tracked, each event received from the Event Hubs</span>
        <span class="c">///</span><span class="c">   service will carry metadata about the partition that it otherwise would not. This results in a small amount of</span>
        <span class="c">///</span><span class="c">   additional network bandwidth consumption that is generally a favorable trade-off when considered</span>
        <span class="c">///</span><span class="c">   against periodically making requests for partition properties using an Event Hub client.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#beac22dfca574cd4" class="t t">InvalidOperationException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Occurs when this method is invoked without </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorOptions.cs.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a>.<a href="EventProcessorOptions.cs.html#de96937c4bdb5883" class="i property">TrackLastEnqueuedEventProperties</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> set or when the processor is not running.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected virtual</b> <a href="../Consumer/LastEnqueuedEventProperties.cs.html#e54b900e1c5c3c73" class="t t">LastEnqueuedEventProperties</a> <a id="eb336b40869d9e65" href="../R/eb336b40869d9e65.html" target="n" data-glyph="75,1" class="i method">ReadLastEnqueuedEventProperties</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r111 rd" class="r111 r">partitionId</span>)
        {
            <b>if</b> (!<a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="r111 r">partitionId</span>, <b>out</b> <a href="#83c5a9fd72574778" class="k">var</a> <span id="r112 rd" class="r112 r">processor</span>))
            {
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Core/Argument.cs.html#eda8ff4d51bf8b3e" class="i method">AssertNotClosed</a>(<b>true</b>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#3a7d3fdccd5b0111" class="i property">ClientNeededForThisInformationNotAvailable</a>);
            }
 
            <b>return</b> <span class="r112 r">processor</span>.<a href="#b128d5a55d2357d8" class="i field">ReadLastEnqueuedEventProperties</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Signals the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r113 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to begin processing events. Should this method be called while the processor is running, no action is taken.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">async</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">When </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, the method will be executed asynchronously; otherwise, it will execute synchronously.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r115 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the start operation.  This won&#39;t affect the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r116 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> once it starts running.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="138b50a8d677ecff" href="../R/138b50a8d677ecff.html" target="n" data-glyph="76,1" class="i method">StartProcessingInternalAsync</a>(<b>bool</b> <span id="r114 rd" class="r114 r">async</span>,
                                                        <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r115 rd" class="r115 r">cancellationToken</span>)
        {
            <span class="r115 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#eaaa8375d0235467" class="i method">EventProcessorStart</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>);
 
            <a href="@1@netstandard/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r117 rd" class="r117 r">releaseGuard</span> = <b>false</b>;
 
            <b>try</b>
            {
                <span class="c">// Acquire the semaphore used to synchronize processor starts and stops, respecting</span>
                <span class="c">// the async flag.  When this is held, the state of the processor is stable.</span>
 
                <b>if</b> (<span class="r114 r">async</span>)
                {
                    <b>await</b> <a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#7a679e542c73988f" class="i method">WaitAsync</a>(<span class="r115 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>else</b>
                {
                    <a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#03b17b43bf2a7131" class="i method">Wait</a>(<span class="r115 r">cancellationToken</span>);
                }
 
                <span class="r117 r">releaseGuard</span> = <b>true</b>;
                <a href="#24f1e7b7a6fa321a" class="i field">_statusOverride</a> = <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#c88df67a200b6a16" class="i field">Starting</a>;
 
                <span class="c">// If the processor is already running, then it was started before the</span>
                <span class="c">// semaphore was acquired; there is no work to be done.</span>
 
                <b>if</b> (<a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a> != <b>null</b>)
                {
                    <b>return</b>;
                }
 
                <span class="c">// There should be no cancellation source, but guard against leaking resources in the</span>
                <span class="c">// event of a processing crash or other exception.</span>
 
                <a href="#e27d550be02dbec0" class="i field">_runningProcessorCancellationSource</a>?.<a href="@1@netstandard/A.html#93c25ccd0946470f" class="i method">Cancel</a>();
                <a href="#e27d550be02dbec0" class="i field">_runningProcessorCancellationSource</a>?.<a href="@1@netstandard/A.html#d6974e1b9b86299d" class="i method">Dispose</a>();
                <a href="#e27d550be02dbec0" class="i field">_runningProcessorCancellationSource</a> = <b>new</b> <a href="@1@netstandard/A.html#0fd973cb6741d972" class="t constructor">CancellationTokenSource</a>();
 
                <span class="c">// Start processing events.</span>
 
                <a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#7751b37b12e54924" class="i method">Clear</a>();
                <a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a> = <a href="#d96f15d119ddd555" class="i method">RunProcessingAsync</a>(<a href="#e27d550be02dbec0" class="i field">_runningProcessorCancellationSource</a>.<a href="@1@netstandard/A.html#9e22b9c8995bf195" class="i property">Token</a>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#a0a8b79c277cf327" class="t t">OperationCanceledException</a> <span id="r118 rd" class="r118 r">ex</span>)
            {
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#a6a3a59b1f87fd67" class="i method">EventProcessorStartError</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r118 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#60da317efa09fc04" class="t constructor">TaskCanceledException</a>();
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r119 rd" class="r119 r">ex</span>)
            {
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#a6a3a59b1f87fd67" class="i method">EventProcessorStartError</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r119 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                <b>throw</b>;
            }
            <b>finally</b>
            {
                <a href="#24f1e7b7a6fa321a" class="i field">_statusOverride</a> = <b>null</b>;
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#ec383068733ece57" class="i method">EventProcessorStartComplete</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>);
 
                <span class="c">// If the cancellation token was signaled during the attempt to acquire the</span>
                <span class="c">// semaphore, it cannot be safely released; ensure that it is held.</span>
 
                <b>if</b> (<span class="r117 r">releaseGuard</span>)
                {
                    <a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#f7527810bcfc0842" class="i method">Release</a>();
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Signals the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r120 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to stop processing events. Should this method be called while the processor is not running, no action is taken.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">async</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">When </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, the method will be executed asynchronously; otherwise, it will execute synchronously.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the stop operation.  If the operation is successfully canceled, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r123 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will keep running.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5cb1dc5ba8cf4a80" href="../R/5cb1dc5ba8cf4a80.html" target="n" data-glyph="76,1" class="i method">StopProcessingInternalAsync</a>(<b>bool</b> <span id="r121 rd" class="r121 r">async</span>,
                                                       <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r122 rd" class="r122 r">cancellationToken</span>)
        {
            <span class="r122 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#bf0b66cc9d53ca1d" class="i method">EventProcessorStop</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>);
 
            <a href="@1@netstandard/A.html#f092fb2b893a0162" class="k">var</a> <span id="r124 rd" class="r124 r">processingException</span> = <b>default</b>(<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a>);
            <a href="@1@netstandard/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r125 rd" class="r125 r">releaseGuard</span> = <b>false</b>;
 
            <b>try</b>
            {
                <span class="c">// Acquire the semaphore used to synchronize processor starts and stops, respecting</span>
                <span class="c">// the async flag.  When this is held, the state of the processor is stable.</span>
 
                <b>if</b> (<span class="r121 r">async</span>)
                {
                    <b>await</b> <a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#7a679e542c73988f" class="i method">WaitAsync</a>(<span class="r122 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>else</b>
                {
                    <a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#03b17b43bf2a7131" class="i method">Wait</a>(<span class="r122 r">cancellationToken</span>);
                }
 
                <span class="r125 r">releaseGuard</span> = <b>true</b>;
                <a href="#24f1e7b7a6fa321a" class="i field">_statusOverride</a> = <a href="EventProcessorStatus.cs.html#cd5a3da62ceb7a13" class="t t">EventProcessorStatus</a>.<a href="EventProcessorStatus.cs.html#d68b2187c3ae9b7e" class="i field">Stopping</a>;
 
                <span class="c">// If the processor is not running, then it was never started or has been stopped</span>
                <span class="c">// before the semaphore was acquired; there is no work to be done.</span>
 
                <b>if</b> (<a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a> == <b>null</b>)
                {
                    <b>return</b>;
                }
 
                <span class="c">// Request cancellation of the running processor task.</span>
 
                <a href="#e27d550be02dbec0" class="i field">_runningProcessorCancellationSource</a>?.<a href="@1@netstandard/A.html#93c25ccd0946470f" class="i method">Cancel</a>();
                <a href="#e27d550be02dbec0" class="i field">_runningProcessorCancellationSource</a>?.<a href="@1@netstandard/A.html#d6974e1b9b86299d" class="i method">Dispose</a>();
                <a href="#e27d550be02dbec0" class="i field">_runningProcessorCancellationSource</a> = <b>null</b>;
 
                <span class="c">// Allow processing to complete.  If there was a processing or load balancing error,</span>
                <span class="c">// awaiting the task is where it will be surfaced.  Be sure to preserve it so</span>
                <span class="c">// that it can be surfaced.</span>
 
                <b>try</b>
                {
                    <b>if</b> (<span class="r121 r">async</span>)
                    {
                        <b>await</b> <a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a>.<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                    }
                    <b>else</b>
                    {
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
                        <a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a>.<a href="@1@netstandard/A.html#9865ec4fb8abca74" class="i method">GetAwaiter</a>().<a href="@1@netstandard/A.html#fac5be2731353aa8" class="i method">GetResult</a>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
                    }
                }
                <b>catch</b> (<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>)
                {
                    <span class="c">// This is expected; no action is needed.</span>
                }
                <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r126 rd" class="r126 r">ex</span>)
                {
                    <span class="c">// Preserve the exception to surface once the tasks needed to fully stop are complete;</span>
                    <span class="c">// logging and invoking of the error handler will have already taken place.</span>
 
                    <span class="r124 r">processingException</span> = <span class="r126 r">ex</span>;
                }
 
                <span class="c">// With the processing task having completed, perform the necessary cleanup of partition processing tasks</span>
                <span class="c">// and surrender ownership.</span>
 
                <b>var</b> <span id="r127 rd" class="r127 r">stopPartitionProcessingTasks</span> = <a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#f162e315ef36115b" class="i property">Keys</a>
                    .<a href="@1@netstandard/A.html#5c652c53e80df013" class="i method">Select</a>(<span id="r128 rd" class="r128 r">partitionId</span> =&gt; <a href="#d1ca1ffab4ec60c0" class="i method">TryStopProcessingPartitionAsync</a>(<span class="r128 r">partitionId</span>, <a href="../Processor/ProcessingStoppedReason.cs.html#79a7fa1c0b5a3dbd" class="t t">ProcessingStoppedReason</a>.<a href="../Processor/ProcessingStoppedReason.cs.html#8607dbffb39f4a68" class="i field">Shutdown</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>))
                    .<a href="@1@netstandard/A.html#783a052330e7d48d" class="i method">ToArray</a>();
 
                <b>if</b> (<span class="r121 r">async</span>)
                {
                    <b>await</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#4a779aa5adbb7299" class="i method">WhenAll</a>(<span class="r127 r">stopPartitionProcessingTasks</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                    <b>await</b> <a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a>.<a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#e7a7b9e36a9629fd" class="i method">RelinquishOwnershipAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>else</b>
                {
                    <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#699a572274d7408a" class="i method">WaitAll</a>(<span class="r127 r">stopPartitionProcessingTasks</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
                    <a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a>.<a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#e7a7b9e36a9629fd" class="i method">RelinquishOwnershipAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>).<a href="@1@netstandard/A.html#9865ec4fb8abca74" class="i method">GetAwaiter</a>().<a href="@1@netstandard/A.html#fac5be2731353aa8" class="i method">GetResult</a>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
                }
 
                <a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#7751b37b12e54924" class="i method">Clear</a>();
 
                <span class="c">// Dispose of the processing task and reset processing state to</span>
                <span class="c">// allow the processor to be restarted when this method completes.</span>
 
                <a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a>.<a href="@1@netstandard/A.html#9da675dba0391f21" class="i method">Dispose</a>();
                <a href="#1c921af1b8eaece6" class="i field">_runningProcessorTask</a> = <b>null</b>;
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#a0a8b79c277cf327" class="t t">OperationCanceledException</a> <span id="r129 rd" class="r129 r">ex</span>)
            {
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#ed44bf2deb11cee8" class="i method">EventProcessorStopError</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r129 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#60da317efa09fc04" class="t constructor">TaskCanceledException</a>();
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r130 rd" class="r130 r">ex</span>)
            {
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#ed44bf2deb11cee8" class="i method">EventProcessorStopError</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r130 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                <b>throw</b>;
            }
            <b>finally</b>
            {
                <a href="#24f1e7b7a6fa321a" class="i field">_statusOverride</a> = <b>null</b>;
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#898a4161533058b8" class="i method">EventProcessorStopComplete</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>);
 
                <span class="c">// If the cancellation token was signaled during the attempt to acquire the</span>
                <span class="c">// semaphore, it cannot be safely released; ensure that it is held.</span>
 
                <b>if</b> (<span class="r125 r">releaseGuard</span>)
                {
                    <a href="#a8a1cae419611635" class="i field">ProcessorRunningGuard</a>.<a href="@1@netstandard/A.html#f7527810bcfc0842" class="i method">Release</a>();
                }
            }
 
            <span class="c">// Surface any exception that was captured when the processing task was</span>
            <span class="c">// initially awaited.</span>
 
            <b>if</b> (<span class="r124 r">processingException</span> != <b>default</b>)
            {
                <a href="@1@netstandard/A.html#1443447025759846" class="t t">ExceptionDispatchInfo</a>.<a href="@1@netstandard/A.html#139923899a417d5a" class="i method">Capture</a>(<span class="r124 r">processingException</span>).<a href="@1@netstandard/A.html#fc3b312e2d0ab87a" class="i method">Throw</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks needed to execute processing for this </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r131 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instance, managing owned partitions and</span>
        <span class="c">///</span><span class="c">   load balancing between associated processors.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r132 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="d96f15d119ddd555" href="../R/d96f15d119ddd555.html" target="n" data-glyph="76,1" class="i method">RunProcessingAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r132 rd" class="r132 r">cancellationToken</span>)
        {
            <span class="r132 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <b>try</b>
            {
                <a href="../EventHubConnection.cs.html#0646809725209998" class="k">var</a> <span id="r133 rd" class="r133 r">connection</span> = <a href="#6bf4729787ecddf5" class="i method">CreateConnection</a>();
                <b>await using</b> <b>var</b> <span id="r134 rd" class="r134 r">connectionAwaiter</span> = <span class="r133 r">connection</span>.<span class="i method">ConfigureAwait</span>(<b>false</b>);
 
                <a href="../SharedSource/Azure.Core/ValueStopwatch.cs.html#def3eda2f58459f9" class="t t">ValueStopwatch</a> <span id="r135 rd" class="r135 r">cycleDuration</span>;
                <b>var</b> <span id="r136 rd" class="r136 r">partitionIds</span> = <b>default</b>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>[]);
 
                <b>while</b> (!<span class="r132 r">cancellationToken</span>.<a href="@1@netstandard/A.html#f32abbe8e2f1f6c1" class="i property">IsCancellationRequested</a>)
                {
                    <span class="r135 r">cycleDuration</span> = <a href="../SharedSource/Azure.Core/ValueStopwatch.cs.html#def3eda2f58459f9" class="t t">ValueStopwatch</a>.<a href="../SharedSource/Azure.Core/ValueStopwatch.cs.html#8145f8480f2ed2ad" class="i method">StartNew</a>();
 
                    <b>try</b>
                    {
                        <span class="r136 r">partitionIds</span> = <b>await</b> <span class="r133 r">connection</span>.<a href="../EventHubConnection.cs.html#44a63294469a3aeb" class="i method">GetPartitionIdsAsync</a>(<a href="#18887ae4162737a9" class="i property">RetryPolicy</a>, <span class="r132 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                    }
                    <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r137 rd" class="r137 r">ex</span>) <b>when</b> (<span class="r137 r">ex</span>.<a href="../Core/ExceptionExtensions.cs.html#9eb730287c29e908" class="i method">IsNotType</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;())
                    {
                        <span class="c">// Logging for exceptions with the service operation are responsibility of the connection.</span>
 
                        <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r137 r">ex</span>, <b>null</b>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#eb54584187180727" class="i property">OperationGetPartitionIds</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
                        <span class="r136 r">partitionIds</span> = <b>default</b>;
                    }
 
                    <a href="@1@netstandard/A.html#865ef7b89f41b632" class="k">var</a> <span id="r138 rd" class="r138 r">remainingTimeUntilNextCycle</span> = <b>await</b> <a href="#c31081befd313f04" class="i method">PerformLoadBalancingAsync</a>(<span class="r135 r">cycleDuration</span>, <span class="r136 r">partitionIds</span>, <span class="r132 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
                    <b>if</b> (<span class="r138 r">remainingTimeUntilNextCycle</span> != <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@1@netstandard/A.html#225346b4cd3a8300" class="i field">Zero</a>)
                    {
                        <b>await</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#b070ae859dd3f7b7" class="i method">Delay</a>(<span class="r138 r">remainingTimeUntilNextCycle</span>, <span class="r132 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                    }
                }
 
                <span class="c">// Cancellation has been requested; throw the corresponding exception to maintain consistent behavior.</span>
 
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#60da317efa09fc04" class="t constructor">TaskCanceledException</a>();
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#a0a8b79c277cf327" class="t t">OperationCanceledException</a> <span id="r139 rd" class="r139 r">ex</span>)
            {
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#cf712bfd26a8e4c2" class="t constructor">TaskCanceledException</a>(<span class="r139 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>, <span class="r139 r">ex</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r140 rd" class="r140 r">ex</span>) <b>when</b> (<span class="r140 r">ex</span>.<a href="../Core/ExceptionExtensions.cs.html#cf696fe6b8e05557" class="i method">IsFatalException</a>())
            {
                <b>throw</b>;
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r141 rd" class="r141 r">ex</span>)
            {
                <span class="c">// The error handler is invoked as a fire-and-forget task; the processor does not assume responsibility</span>
                <span class="c">// for observing or surfacing exceptions that may occur in the handler.</span>
 
                <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r141 r">ex</span>, <b>null</b>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#56c3cecb7e105de3" class="i property">OperationEventProcessingLoop</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#133bc8456a162e9e" class="i method">EventProcessorTaskError</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r141 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
 
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks needed for a single cycle of load balancing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r142 r">cycleDuration</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Responsible for tracking the duration of this cycle.  It is expected that callers manage the stopwatch state; this method will only read from it.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r143 r">partitionIds</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The valid set of partition identifiers for the Event Hub to which the processor is associated.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r144 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The interval that callers should delay before invoking the next load balancing cycle; </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@1@netstandard/A.html#225346b4cd3a8300" class="i field">Zero</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> if callers should invoke the next cycle immediately.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>&gt; <a id="c31081befd313f04" href="../R/c31081befd313f04.html" target="n" data-glyph="76,1" class="i method">PerformLoadBalancingAsync</a>(<a href="../SharedSource/Azure.Core/ValueStopwatch.cs.html#def3eda2f58459f9" class="t t">ValueStopwatch</a> <span id="r142 rd" class="r142 r">cycleDuration</span>,
                                                               <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r143 rd" class="r143 r">partitionIds</span>,
                                                               <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r144 rd" class="r144 r">cancellationToken</span>)
        {
            <span class="r144 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <span class="c">// Perform the tasks needed for the load balancing cycle, including managing partition ownership in response to claimed,</span>
            <span class="c">// lost, or faulted partition processors.</span>
            <span class="c">//</span>
            <span class="c">// Ensure that any errors observed, whether fatal or non-fatal, are surfaced to the exception handler in</span>
            <span class="c">// a fire-and-forget manner.  The processor does not assume responsibility for observing or surfacing exceptions</span>
            <span class="c">// that may occur in the handler, so the associated task is intentionally unobserved.</span>
 
            <a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="k">var</a> <span id="r145 rd" class="r145 r">claimedOwnership</span> = <b>default</b>(<a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="t t">EventProcessorPartitionOwnership</a>);
 
            <b>if</b> ((<span class="r143 r">partitionIds</span> != <b>default</b>) &amp;&amp; (<span class="r143 r">partitionIds</span>.<a href="@1@netstandard/A.html#42e9b7616956cf94" class="i property">Length</a> &gt; 0))
            {
                <b>try</b>
                {
                    <span class="r145 r">claimedOwnership</span> = <b>await</b> <a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a>.<a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#e9f18fd7562b5298" class="i method">RunLoadBalancingAsync</a>(<span class="r143 r">partitionIds</span>, <span class="r144 r">cancellationToken</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>);
                }
                <b>catch</b> (<a href="../EventHubsException.cs.html#fe9b3d9ffc64177d" class="t t">EventHubsException</a> <span id="r146 rd" class="r146 r">ex</span>)
                    <b>when</b> (<a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#1c02a053daf1f93c" class="i property">OperationClaimOwnership</a>.<a href="@1@netstandard/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<span class="r146 r">ex</span>.<a href="../SharedSource/Core/EventHubsExceptionExtensions.cs.html#eaeb5bc8952f2d84" class="i method">GetFailureOperation</a>(), <a href="@1@netstandard/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@1@netstandard/A.html#eabf4db5f5c52b6a" class="i field">InvariantCultureIgnoreCase</a>))
                {
                    <span class="c">// If a specific partition was associated with the failure, it is carried by a well-known data member of the exception.</span>
 
                    <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r147 rd" class="r147 r">partitionId</span> = <span class="r146 r">ex</span>.<a href="../SharedSource/Core/EventHubsExceptionExtensions.cs.html#53d6fae8c1f49f3c" class="i method">GetFailureData</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
 
                    <span class="r0 r t">var</span> <span id="r148 rd" class="r148 r">partition</span> = (<span class="r147 r">partitionId</span> ?? <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#c9f70a27facb27cf" class="i field">Empty</a>) <b>switch</b>
                    {
                        <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r149 rd" class="r149 r">id</span> <b>when</b> (<span class="r149 r">id</span>.<a href="@1@netstandard/A.html#e13f5829ef28aa07" class="i property">Length</a> == 0) =&gt; <b>null</b>,
                        <b>string _</b> <b>when</b> (<a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="r147 r">partitionId</span>, <b>out</b> <a href="#83c5a9fd72574778" class="k">var</a> <span id="r150 rd" class="r150 r">partitionProcessor</span>)) =&gt; <span class="r150 r">partitionProcessor</span>.<a href="#a335db2314077620" class="i field">Partition</a>,
                        <b>_</b> =&gt; <b>new</b> <span class="t">TPartition</span> { <a href="EventProcessorPartition.cs.html#78ef0d1266ee7e2e" class="i property">PartitionId</a> = <span class="r147 r">partitionId</span> }
                    };
 
                    <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r146 r">ex</span>.<a href="@1@netstandard/A.html#89c20b39fb04108b" class="i property">InnerException</a> ?? <span class="r146 r">ex</span>, <span class="r148 r">partition</span>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#1c02a053daf1f93c" class="i property">OperationClaimOwnership</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
                    <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#6d5b4ad4a994f08e" class="i method">EventProcessorClaimOwnershipError</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r147 r">partitionId</span>, ((<span class="r146 r">ex</span>.<a href="@1@netstandard/A.html#89c20b39fb04108b" class="i property">InnerException</a> ?? <span class="r146 r">ex</span>).<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>));
                }
                <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r151 rd" class="r151 r">ex</span>) <b>when</b> (<span class="r151 r">ex</span>.<a href="../Core/ExceptionExtensions.cs.html#9eb730287c29e908" class="i method">IsNotType</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;())
                {
                    <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r151 r">ex</span>, <b>null</b>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#2fdaf1ee2880a3d6" class="i property">OperationLoadBalancing</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
                    <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#59f6c2efe5d2b220" class="i method">EventProcessorLoadBalancingError</a>(<a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r151 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                }
 
                <span class="c">// If a partition was claimed, begin processing it if not already being processed.</span>
 
                <b>if</b> ((<span class="r145 r">claimedOwnership</span> != <b>default</b>) &amp;&amp; (!<a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#93f90f07cf34d76c" class="i method">ContainsKey</a>(<span class="r145 r">claimedOwnership</span>.<a href="EventProcessorPartitionOwnership.cs.html#960beb22d4eb55d5" class="i property">PartitionId</a>)))
                {
                    <b>await</b> <a href="#c09e0e53cea7e1ba" class="i method">TryStartProcessingPartitionAsync</a>(<span class="r145 r">claimedOwnership</span>.<a href="EventProcessorPartitionOwnership.cs.html#960beb22d4eb55d5" class="i property">PartitionId</a>, <span class="r144 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
            }
 
            <span class="c">// Some ownership for some previously claimed partitions may have expired or have been stolen; stop the processing for partitions</span>
            <span class="c">// which are no longer owned.</span>
 
            <span class="r144 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <b>await</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#b6d43f186de3a867" class="i method">WhenAll</a>(<a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#f162e315ef36115b" class="i property">Keys</a>
                .<a href="@1@netstandard/A.html#64071682ee3bf309" class="i method">Except</a>(<a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a>.<a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#3831241686220f3c" class="i property">OwnedPartitionIds</a>)
                .<a href="@1@netstandard/A.html#5c652c53e80df013" class="i method">Select</a>(<span id="r152 rd" class="r152 r">partitionId</span> =&gt; <a href="#d1ca1ffab4ec60c0" class="i method">TryStopProcessingPartitionAsync</a>(<span class="r152 r">partitionId</span>, <a href="../Processor/ProcessingStoppedReason.cs.html#79a7fa1c0b5a3dbd" class="t t">ProcessingStoppedReason</a>.<a href="../Processor/ProcessingStoppedReason.cs.html#6cec0e212203c4dc" class="i field">OwnershipLost</a>, <span class="r144 r">cancellationToken</span>)))
                .<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="c">// The remaining processing tasks should be running.  To ensure that is the case, validate the status of the task</span>
            <span class="c">// and restart processing if it has failed.  It is also possible that task creation failed when the processing was started,</span>
            <span class="c">// in which case there would be no task; create them.</span>
 
            <span class="r144 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <b>await</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#69351c6da968e5d1" class="i method">WhenAll</a>(<a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a>.<a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#3831241686220f3c" class="i property">OwnedPartitionIds</a>
                .<a href="@1@netstandard/A.html#5c652c53e80df013" class="i method">Select</a>(<b>async</b> <span id="r153 rd" class="r153 r">partitionId</span> =&gt;
                {
                    <b>if</b> (!<a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="r153 r">partitionId</span>, <b>out</b> <a href="#83c5a9fd72574778" class="k">var</a> <span id="r154 rd" class="r154 r">partitionProcessor</span>) || <span class="r154 r">partitionProcessor</span>.<a href="#d124934835442c22" class="i field">ProcessingTask</a>.<a href="@1@netstandard/A.html#8d8a16ab86bf7a8a" class="i property">IsCompleted</a>)
                    {
                        <b>await</b> <a href="#d1ca1ffab4ec60c0" class="i method">TryStopProcessingPartitionAsync</a>(<span class="r153 r">partitionId</span>, <a href="../Processor/ProcessingStoppedReason.cs.html#79a7fa1c0b5a3dbd" class="t t">ProcessingStoppedReason</a>.<a href="../Processor/ProcessingStoppedReason.cs.html#6cec0e212203c4dc" class="i field">OwnershipLost</a>, <span class="r144 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                        <b>await</b> <a href="#c09e0e53cea7e1ba" class="i method">TryStartProcessingPartitionAsync</a>(<span class="r153 r">partitionId</span>, <span class="r144 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                    }
                }))
                .<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="c">// If load balancing is greedy and there was a partition claimed, then signal that there should be no delay before</span>
            <span class="c">// invoking the next load balancing cycle.</span>
 
            <b>if</b> ((<a href="#90893bc9a20c9bfd" class="i property">Options</a>.<a href="EventProcessorOptions.cs.html#440f89e64c38d806" class="i property">LoadBalancingStrategy</a> == <a href="../Processor/LoadBalancingStrategy.cs.html#512c15eb5fea860b" class="t t">LoadBalancingStrategy</a>.<a href="../Processor/LoadBalancingStrategy.cs.html#3c400e3022541363" class="i field">Greedy</a>) &amp;&amp; (!<a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a>.<a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#02151f8e45c3570e" class="i property">IsBalanced</a>))
            {
                <b>return</b> <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@1@netstandard/A.html#225346b4cd3a8300" class="i field">Zero</a>;
            }
 
            <span class="c">// Wait the remaining time, if any, to start the next cycle.</span>
 
            <b>return</b> <a href="#5fada474e1aa15c5" class="i property">LoadBalancer</a>.<a href="../SharedSource/Processor/PartitionLoadBalancer.cs.html#c9ab269ed5e71e29" class="i property">LoadBalanceInterval</a>.<a href="../SharedSource/Core/TimeSpanExtensions.cs.html#95d8d29d94e4b0df" class="i method">CalculateRemaining</a>(<span class="r142 r">cycleDuration</span>.<a href="../SharedSource/Azure.Core/ValueStopwatch.cs.html#bfb83d9e02192eef" class="i method">GetElapsedTime</a>());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Attempts to begin processing the requested partition in the background and update tracking state</span>
        <span class="c">///</span><span class="c">   so that processing can be stopped.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r155 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The identifier of the Event Hub partition whose processing should be started.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r156 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if processing was successfully started; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Exceptions encountered in this method will be logged and will result in the error handler being</span>
        <span class="c">///</span><span class="c">   invoked.  They will not be surfaced to callers.  This is intended to be a safe operation consumed</span>
        <span class="c">///</span><span class="c">   as part of the load balancing cycle, which is failure-tolerant.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<b>bool</b>&gt; <a id="c09e0e53cea7e1ba" href="../R/c09e0e53cea7e1ba.html" target="n" data-glyph="76,1" class="i method">TryStartProcessingPartitionAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r155 rd" class="r155 r">partitionId</span>,
                                                                  <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r156 rd" class="r156 r">cancellationToken</span>)
        {
            <span class="r156 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#c89aba7f56bae119" class="i method">EventProcessorPartitionProcessingStart</a>(<span class="r155 r">partitionId</span>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>);
 
            <span class="r0 r t">var</span> <span id="r157 rd" class="r157 r">partition</span> = <b>new</b> <span class="t">TPartition</span> { <a href="EventProcessorPartition.cs.html#78ef0d1266ee7e2e" class="i property">PartitionId</a> = <span class="r155 r">partitionId</span> };
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r158 rd" class="r158 r">operationDescription</span> = <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#1c02a053daf1f93c" class="i property">OperationClaimOwnership</a>;
            <a href="../Consumer/EventPosition.cs.html#97742fa7b7b6b68f" class="k">var</a> <span id="r159 rd" class="r159 r">startingPosition</span> = <a href="#90893bc9a20c9bfd" class="i property">Options</a>.<a href="EventProcessorOptions.cs.html#eccc0976e25b4b6e" class="i property">DefaultStartingPosition</a>;
            <a href="@1@netstandard/A.html#130a9536ac96b392" class="k">var</a> <span id="r160 rd" class="r160 r">cancellationSource</span> = <b>default</b>(<a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a>);
 
            <b>try</b>
            {
                <span class="c">// Initialize the partition context; the handler is responsible for initialing any custom fields of the partition type.</span>
 
                <b>await</b> <a href="#b2edd322d381cb5b" class="i method">OnInitializingPartitionAsync</a>(<span class="r157 r">partition</span>, <span class="r156 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
                <span class="c">// Query the available checkpoints for the partition.</span>
 
                <span class="r156 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
                <span class="r158 r">operationDescription</span> = <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#ec47f0af6d60246b" class="i property">OperationListCheckpoints</a>;
 
                <span class="c">// Determine the starting position for processing the partition.</span>
 
                <a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="k">var</a> <span id="r161 rd" class="r161 r">checkpoint</span> = <b>await</b> <a href="#baf5ffc6e8936d2e" class="i method">GetCheckpointAsync</a>(<span class="r155 r">partitionId</span>, <span class="r156 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <span class="r158 r">operationDescription</span> = <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#1c02a053daf1f93c" class="i property">OperationClaimOwnership</a>;
                <b>if</b> (<span class="r161 r">checkpoint</span> != <b>null</b>)
                {
                    <span class="r159 r">startingPosition</span> = <span class="r161 r">checkpoint</span>.<a href="EventProcessorCheckpoint.cs.html#e53fa1aec8035654" class="i property">StartingPosition</a>;
                }
 
                <span class="c">// Create and register the partition processor.  Ownership of the cancellationSource is transferred</span>
                <span class="c">// to the processor upon creation, including the responsibility for disposal.</span>
 
                <span class="r156 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
                <span class="r160 r">cancellationSource</span> = <a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a>.<a href="@1@netstandard/A.html#fa6a7f1bcc1edf95" class="i method">CreateLinkedTokenSource</a>(<span class="r156 r">cancellationToken</span>);
                <a href="#83c5a9fd72574778" class="k">var</a> <span id="r162 rd" class="r162 r">processor</span> = <a href="#2f5619de311efad5" class="i method">CreatePartitionProcessor</a>(<span class="r157 r">partition</span>, <span class="r159 r">startingPosition</span>, <span class="r160 r">cancellationSource</span>);
 
                <a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#490ee025e9652769" class="i method">AddOrUpdate</a>(<span class="r155 r">partitionId</span>, <span class="r162 r">processor</span>, (<span id="r163 rd" class="r163 r">key</span>, <span id="r164 rd" class="r164 r">value</span>) =&gt; <span class="r162 r">processor</span>);
                <span class="r160 r">cancellationSource</span> = <b>null</b>;
 
                <b>return</b> <b>true</b>;
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r165 rd" class="r165 r">ex</span>)
            {
                <span class="c">// The error handler is invoked as a fire-and-forget task; the processor does not assume responsibility</span>
                <span class="c">// for observing or surfacing exceptions that may occur in the handler.</span>
 
                <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r165 r">ex</span>, <span class="r157 r">partition</span>, <span class="r158 r">operationDescription</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#5dc7f459cce37e41" class="i method">EventProcessorPartitionProcessingStartError</a>(<span class="r155 r">partitionId</span>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r165 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
 
                <span class="r160 r">cancellationSource</span>?.<a href="@1@netstandard/A.html#93c25ccd0946470f" class="i method">Cancel</a>();
                <span class="r160 r">cancellationSource</span>?.<a href="@1@netstandard/A.html#d6974e1b9b86299d" class="i method">Dispose</a>();
                <b>return</b> <b>false</b>;
            }
            <b>finally</b>
            {
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#3632cd7496b414d1" class="i method">EventProcessorPartitionProcessingStartComplete</a>(<span class="r155 r">partitionId</span>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r159 r">startingPosition</span>.<a href="../Consumer/EventPosition.cs.html#71ff657092efb718" class="i method">ToString</a>());
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Attempts to stop processing the requested partition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The identifier of the Event Hub partition whose processing should be stopped.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r167 r">reason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason why the processing is being stopped.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r168 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r166 r">partitionId</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> was owned and was being processed; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Exceptions encountered when stopping processing for an owned partition will be logged and will result in the error handler</span>
        <span class="c">///</span><span class="c">   being invoked.  They will not be surfaced to callers.  This is intended to be a safe operation consumed</span>
        <span class="c">///</span><span class="c">   as part of the load balancing cycle, which is failure-tolerant.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<b>bool</b>&gt; <a id="d1ca1ffab4ec60c0" href="../R/d1ca1ffab4ec60c0.html" target="n" data-glyph="76,1" class="i method">TryStopProcessingPartitionAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r166 rd" class="r166 r">partitionId</span>,
                                                                 <a href="../Processor/ProcessingStoppedReason.cs.html#79a7fa1c0b5a3dbd" class="t t">ProcessingStoppedReason</a> <span id="r167 rd" class="r167 r">reason</span>,
                                                                 <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r168 rd" class="r168 r">cancellationToken</span>)
        {
            <span class="r168 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#ca08138940f6ac87" class="i method">EventProcessorPartitionProcessingStop</a>(<span class="r166 r">partitionId</span>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>);
 
            <span class="r0 r t">var</span> <span id="r169 rd" class="r169 r">partition</span> = <b>default</b>(<span class="r0 r t">TPartition</span>);
 
            <b>try</b>
            {
                <span class="c">// If the partition processor is not being tracked or could not be retrieved from the tracking items,</span>
                <span class="c">// then it cannot be stopped.</span>
 
                <b>if</b> (!<a href="#516d24961b15bce2" class="i property">ActivePartitionProcessors</a>.<a href="@1@netstandard/A.html#19ffd03eb6d3bdff" class="i method">TryRemove</a>(<span class="r166 r">partitionId</span>, <b>out</b> <a href="#83c5a9fd72574778" class="k">var</a> <span id="r170 rd" class="r170 r">partitionProcessor</span>))
                {
                    <b>return</b> <b>false</b>;
                }
 
                <span class="c">// Attempt to stop the processor; any exceptions should be treated as a problem with processing, not</span>
                <span class="c">// associated with the attempt to stop.</span>
 
                <span class="r169 r">partition</span> = <span class="r170 r">partitionProcessor</span>.<a href="#a335db2314077620" class="i field">Partition</a>;
 
                <b>try</b>
                {
                    <span class="r170 r">partitionProcessor</span>.<a href="#a08f93c903148b1d" class="i field">CancellationSource</a>.<a href="@1@netstandard/A.html#93c25ccd0946470f" class="i method">Cancel</a>();
                    <b>await</b> <span class="r170 r">partitionProcessor</span>.<a href="#d124934835442c22" class="i field">ProcessingTask</a>.<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>catch</b> (<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>)
                {
                    <span class="c">// This is expected; no action is needed.</span>
                }
                <b>catch</b>
                {
                    <span class="c">// The processing task is in a failed state; any logging and dispatching</span>
                    <span class="c">// to the error handler happened in the processing task before the exception</span>
                    <span class="c">// was thrown.  All that remains is to override the reason for stopping.</span>
 
                    <span class="r167 r">reason</span> = <a href="../Processor/ProcessingStoppedReason.cs.html#79a7fa1c0b5a3dbd" class="t t">ProcessingStoppedReason</a>.<a href="../Processor/ProcessingStoppedReason.cs.html#6cec0e212203c4dc" class="i field">OwnershipLost</a>;
                }
 
                <span class="r170 r">partitionProcessor</span>.<a href="#698c03e34d731bc3" class="i method">Dispose</a>();
                <span class="r168 r">cancellationToken</span>.<a href="../SharedSource/Core/CancellationTokenExtensions.cs.html#48bae066cbca26c9" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
                <span class="c">// Notify the handler of the now-closed partition, awaiting completion to allow for a more deterministic model</span>
                <span class="c">// for developers where the initialize and stop handlers will fire in a deterministic order and not interleave.</span>
                <span class="c">//</span>
                <span class="c">// Because the processor does not assume responsibility for observing or surfacing exceptions that may occur in the handler,</span>
                <span class="c">// errors are logged but the error handler is not invoked nor does an exception in the handler constitute a failure to stop</span>
                <span class="c">// processing the partition.  This also aims to prevent an infinite loop scenario where StopProcessing is called from the</span>
                <span class="c">// error handler, which calls the partition stopped handler, which has an exception that again calls the error handler.</span>
 
                <b>try</b>
                {
                    <b>await</b> <a href="#8fbddb021078bdd0" class="i method">OnPartitionProcessingStoppedAsync</a>(<span class="r169 r">partition</span>, <span class="r167 r">reason</span>, <span class="r168 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>catch</b> (<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>)
                {
                    <span class="c">// This is expected; no action is needed.</span>
                }
                <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r171 rd" class="r171 r">ex</span>)
                {
                    <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#9db6717cbbff4f29" class="i method">EventProcessorPartitionProcessingStopError</a>(<span class="r166 r">partitionId</span>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r171 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                }
 
                <b>return</b> <b>true</b>;
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r172 rd" class="r172 r">ex</span>) <b>when</b> (<span class="r172 r">ex</span>.<a href="../Core/ExceptionExtensions.cs.html#9eb730287c29e908" class="i method">IsNotType</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;())
            {
                <span class="c">// The error handler is invoked as a fire-and-forget task; the processor does not assume responsibility</span>
                <span class="c">// for observing or surfacing exceptions that may occur in the handler.</span>
 
                <b>_</b> = <a href="#3c125001bf2ae247" class="i method">InvokeOnProcessingErrorAsync</a>(<span class="r172 r">ex</span>, <span class="r169 r">partition</span>, <a href="../Resources.Designer.cs.html#0f60eafa1a3b4f36" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#ec0b267a30c145a2" class="i property">OperationSurrenderOwnership</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#9db6717cbbff4f29" class="i method">EventProcessorPartitionProcessingStopError</a>(<span class="r166 r">partitionId</span>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>, <span class="r172 r">ex</span>.<a href="@1@netstandard/A.html#5fba0e16215b42a3" class="i property">Message</a>);
 
                <b>return</b> <b>false</b>;
            }
            <b>finally</b>
            {
                <a href="#6c040e9b0fc9161e" class="i property">Logger</a>.<a href="../Diagnostics/EventHubsEventSource.cs.html#d25f09b78a7c04cc" class="i method">EventProcessorPartitionProcessingStopComplete</a>(<span class="r166 r">partitionId</span>, <a href="#f7fa4022e2eeea36" class="i property">Identifier</a>, <a href="#d735e7f1d60deaa6" class="i property">EventHubName</a>, <a href="#6d7640e769276c4c" class="i property">ConsumerGroup</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the tasks needed invoke the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#7217205759deca42" class="i method">OnProcessingErrorAsync</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> method in the background,</span>
        <span class="c">///</span><span class="c">   as it is intended to be a fire-and-forget operation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r173 r">exception</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The exception that occurred during operation of the event processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r174 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The context of the partition associated with the error, if any; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r175 r">operationDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A short textual description of the operation during which the exception occurred; intended to be informational only.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r176 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the processing.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="3c125001bf2ae247" href="../R/3c125001bf2ae247.html" target="n" data-glyph="76,1" class="i method">InvokeOnProcessingErrorAsync</a>(<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r173 rd" class="r173 r">exception</span>,
                                                  <span class="r0 r t">TPartition</span> <span id="r174 rd" class="r174 r">partition</span>,
                                                  <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r175 rd" class="r175 r">operationDescription</span>,
                                                  <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r176 rd" class="r176 r">cancellationToken</span>) =&gt; <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#0fb2b4d9262599b9" class="i method">Run</a>(() =&gt; <a href="#7217205759deca42" class="i method">OnProcessingErrorAsync</a>(<span class="r173 r">exception</span>, <span class="r174 r">partition</span>, <span class="r175 r">operationDescription</span>, <span class="r176 r">cancellationToken</span>), <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@1@netstandard/A.html#ec32c41597007382" class="i property">None</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../SharedSource/Processor/StorageManager.cs.html#4c3279872ba9c8f6" class="t t">StorageManager</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to use for interacting with durable storage.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r177 r">instance</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r178 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instance to associate with the storage manager.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../SharedSource/Processor/StorageManager.cs.html#4c3279872ba9c8f6" class="t t">StorageManager</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> with the requested configuration.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal static</b> <a href="../SharedSource/Processor/StorageManager.cs.html#4c3279872ba9c8f6" class="t t">StorageManager</a> <a id="88f121b299fd299e" href="../R/88f121b299fd299e.html" target="n" data-glyph="74,1" class="i method">CreateStorageManager</a>(<a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>&lt;<span class="r0 r t">TPartition</span>&gt; <span id="r177 rd" class="r177 r">instance</span>) =&gt; <b>new</b> <a href="#46b59d60169ecbdb" class="t constructor">DelegatingStorageManager</a>(<span class="r177 r">instance</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   A virtual </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../SharedSource/Processor/StorageManager.cs.html#4c3279872ba9c8f6" class="t t">StorageManager</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instance that delegates calls to the</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r179 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to which it is associated.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private class</b> <a id="3337431728a56140" href="../R/3337431728a56140.html" target="n" data-glyph="4,1" class="t t">DelegatingStorageManager</a> : <a href="../SharedSource/Processor/StorageManager.cs.html#4c3279872ba9c8f6" class="t t">StorageManager</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r180 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that the storage manager is associated with.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>private</b> <a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>&lt;<span class="r0 r t">TPartition</span>&gt; <a id="75392a8bacb712a7" href="../R/75392a8bacb712a7.html" target="n" data-glyph="106,2" class="i property">Processor</a> { <b>get</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#3337431728a56140" class="t t">DelegatingStorageManager</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r181 r">processor</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>{<span class="r182 r t">TPartition</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to associate the storage manager with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public</b> <a id="46b59d60169ecbdb" href="../R/46b59d60169ecbdb.html" target="n" data-glyph="72,2" class="t constructor">DelegatingStorageManager</a>(<a href="#4ce59cd6fc256750" class="t t">EventProcessor</a>&lt;<span class="r0 r t">TPartition</span>&gt; <span id="r181 rd" class="r181 r">processor</span>) =&gt; <a href="#75392a8bacb712a7" class="i property">Processor</a> = <span class="r181 r">processor</span>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Retrieves a complete ownership list from the data store.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r183 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Event Hubs namespace the ownership are associated with. This is ignored in favor of the value from the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#75392a8bacb712a7" class="i property">Processor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r184 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific Event Hub the ownership are associated with.  This is ignored in favor of the value from the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#75392a8bacb712a7" class="i property">Processor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r185 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the ownership are associated with. This is ignored in favor of the value from the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#75392a8bacb712a7" class="i property">Processor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r186 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An enumerable containing all the existing ownership for the associated Event Hub and consumer group.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public override async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="t t">EventProcessorPartitionOwnership</a>&gt;&gt; <a id="e19fa4e3522b2cbb" href="../R/e19fa4e3522b2cbb.html" target="n" data-glyph="72,2" class="i method">ListOwnershipAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r183 rd" class="r183 r">fullyQualifiedNamespace</span>,
                                                                                                         <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r184 rd" class="r184 r">eventHubName</span>,
                                                                                                         <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r185 rd" class="r185 r">consumerGroup</span>,
                                                                                                         <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r186 rd" class="r186 r">cancellationToken</span>) =&gt; <b>await</b> <a href="#75392a8bacb712a7" class="i property">Processor</a>.<a href="#5fef5dfceb76fe84" class="i method">ListOwnershipAsync</a>(<span class="r186 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Attempts to claim ownership of partitions for processing.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r187 r">partitionOwnership</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An enumerable containing all the ownership to claim.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r188 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An enumerable containing the successfully claimed ownership.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public override async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="t t">EventProcessorPartitionOwnership</a>&gt;&gt; <a id="2fac714ec920d4a6" href="../R/2fac714ec920d4a6.html" target="n" data-glyph="72,2" class="i method">ClaimOwnershipAsync</a>(<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorPartitionOwnership.cs.html#9a85e4e6ad44370e" class="t t">EventProcessorPartitionOwnership</a>&gt; <span id="r187 rd" class="r187 r">partitionOwnership</span>,
                                                                                                          <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r188 rd" class="r188 r">cancellationToken</span>) =&gt; <b>await</b> <a href="#75392a8bacb712a7" class="i property">Processor</a>.<a href="#d88023bbad1f6455" class="i method">ClaimOwnershipAsync</a>(<span class="r187 r">partitionOwnership</span>, <span class="r188 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Retrieves a list of all the checkpoints in a data store for a given namespace, Event Hub and consumer group.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r189 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Event Hubs namespace the ownership are associated with. This is ignored in favor of the value from the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#75392a8bacb712a7" class="i property">Processor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r190 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific Event Hub the ownership are associated with. This is ignored in favor of the value from the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#75392a8bacb712a7" class="i property">Processor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r191 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the checkpoints are associated with. This is ignored in favor of the value from the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#75392a8bacb712a7" class="i property">Processor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r192 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An enumerable containing all the existing checkpoints for the associated Event Hub and consumer group.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public override async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="t t">EventProcessorCheckpoint</a>&gt;&gt; <a id="f88628001d70c222" href="../R/f88628001d70c222.html" target="n" data-glyph="72,2" class="i method">ListCheckpointsAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r189 rd" class="r189 r">fullyQualifiedNamespace</span>,
                                                                                                   <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r190 rd" class="r190 r">eventHubName</span>,
                                                                                                   <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r191 rd" class="r191 r">consumerGroup</span>,
                                                                                                   <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r192 rd" class="r192 r">cancellationToken</span>) =&gt; <b>await</b> <a href="#75392a8bacb712a7" class="i property">Processor</a>.<a href="#9f7a800d61e24bd1" class="i method">ListCheckpointsAsync</a>(<span class="r192 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   This method is not implemented for this type.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r193 r">checkpoint</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The checkpoint containing the information to be stored.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r194 r">eventData</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The event to use as the basis for the checkpoint&#39;s starting position.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r195 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#a46efa455da3688d" class="t t">NotImplementedException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The method is not implemented for this type.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public override</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="4fa745b5daccd8d6" href="../R/4fa745b5daccd8d6.html" target="n" data-glyph="72,2" class="i method">UpdateCheckpointAsync</a>(<a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="t t">EventProcessorCheckpoint</a> <span id="r193 rd" class="r193 r">checkpoint</span>,
                                                       <a href="../EventData.cs.html#557aa370d1369b89" class="t t">EventData</a> <span id="r194 rd" class="r194 r">eventData</span>,
                                                       <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r195 rd" class="r195 r">cancellationToken</span>) =&gt; <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#085d4139ffb78d13" class="t constructor">NotImplementedException</a>();
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Retrieves a checkpoint information from the chosen storage service. The default implementation calls </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#f88628001d70c222" class="i method">ListCheckpointsAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and selects a checkpoint by id.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r196 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Event Hubs namespace the ownership are associated with.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r197 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific Event Hub the ownership are associated with, relative to the Event Hubs namespace that contains it.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r198 r">consumerGroup</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the consumer group the ownership are associated with.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r199 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The identifier of the partition to read a checkpoint for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r200 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="t t">EventProcessorCheckpoint</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance if a checkpoint is found for a particular partition otherwise, </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public override async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="EventProcessorCheckpoint.cs.html#a957ac02e2072bb9" class="t t">EventProcessorCheckpoint</a>&gt; <a id="cad7ab48cb4ab430" href="../R/cad7ab48cb4ab430.html" target="n" data-glyph="72,2" class="i method">GetCheckpointAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r196 rd" class="r196 r">fullyQualifiedNamespace</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r197 rd" class="r197 r">eventHubName</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r198 rd" class="r198 r">consumerGroup</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r199 rd" class="r199 r">partitionId</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r200 rd" class="r200 r">cancellationToken</span>)
                =&gt; <b>await</b> <a href="#75392a8bacb712a7" class="i property">Processor</a>.<a href="#baf5ffc6e8936d2e" class="i method">GetCheckpointAsync</a>(<span class="r199 r">partitionId</span>, <span class="r200 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The set of information needed to track and manage the active processing</span>
        <span class="c">///</span><span class="c">   of a partition.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal class</b> <a id="83c5a9fd72574778" href="../R/83c5a9fd72574778.html" target="n" data-glyph="2,1" class="t t">PartitionProcessor</a> : <a href="@1@netstandard/A.html#1f55292c3174123d" class="t t">IDisposable</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The task that is performing the processing.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public readonly</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="d124934835442c22" href="../R/d124934835442c22.html" target="n" data-glyph="42,2" class="i field">ProcessingTask</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The partition that is being processed.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public readonly</b> <span class="r0 r t">TPartition</span> <a id="a335db2314077620" href="../R/a335db2314077620.html" target="n" data-glyph="42,2" class="i field">Partition</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The source token that can be used to cancel the processing for the associated </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#d124934835442c22" class="i field">ProcessingTask</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public readonly</b> <a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a> <a id="a08f93c903148b1d" href="../R/a08f93c903148b1d.html" target="n" data-glyph="42,2" class="i field">CancellationSource</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">A function that can be used to read the information about the last enqueued event of the partition.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public readonly</b> <a href="@1@netstandard/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="../Consumer/LastEnqueuedEventProperties.cs.html#e54b900e1c5c3c73" class="t t">LastEnqueuedEventProperties</a>&gt; <a id="b128d5a55d2357d8" href="../R/b128d5a55d2357d8.html" target="n" data-glyph="42,2" class="i field">ReadLastEnqueuedEventProperties</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#83c5a9fd72574778" class="t t">PartitionProcessor</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r201 r">processingTask</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The task that is performing the processing.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r202 r">partition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The partition that is being processed.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r203 r">readLastEnqueuedEventProperties</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A function that can be used to read the information about the last enqueued event of the partition.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r204 r">cancellationSource</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">he source token that can be used to cancel the processing.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public</b> <a id="78d2659883eaa876" href="../R/78d2659883eaa876.html" target="n" data-glyph="72,2" class="t constructor">PartitionProcessor</a>(<a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <span id="r201 rd" class="r201 r">processingTask</span>,
                                      <span class="r0 r t">TPartition</span> <span id="r202 rd" class="r202 r">partition</span>,
                                      <a href="@1@netstandard/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="../Consumer/LastEnqueuedEventProperties.cs.html#e54b900e1c5c3c73" class="t t">LastEnqueuedEventProperties</a>&gt; <span id="r203 rd" class="r203 r">readLastEnqueuedEventProperties</span>,
                                      <a href="@1@netstandard/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a> <span id="r204 rd" class="r204 r">cancellationSource</span>) =&gt; (<a href="#d124934835442c22" class="i field">ProcessingTask</a>, <a href="#a335db2314077620" class="i field">Partition</a>, <a href="#b128d5a55d2357d8" class="i field">ReadLastEnqueuedEventProperties</a>, <a href="#a08f93c903148b1d" class="i field">CancellationSource</a>) = (<span class="r201 r">processingTask</span>, <span class="r202 r">partition</span>, <span class="r203 r">readLastEnqueuedEventProperties</span>, <span class="r204 r">cancellationSource</span>);
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c">   Performs tasks needed to clean-up the disposable resources used by the processor.  This method does</span>
            <span class="c">///</span><span class="c">   not assume responsibility for signaling the cancellation source or awaiting the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#d124934835442c22" class="i field">ProcessingTask</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span>
            <b>public void</b> <a id="698c03e34d731bc3" href="../R/698c03e34d731bc3.html" target="n" data-glyph="72,2" class="i method">Dispose</a>()
            {
                <a href="#a08f93c903148b1d" class="i field">CancellationSource</a>?.<a href="@1@netstandard/A.html#d6974e1b9b86299d" class="i method">Dispose</a>();
                <a href="#d124934835442c22" class="i field">ProcessingTask</a>?.<a href="@1@netstandard/A.html#9da675dba0391f21" class="i method">Dispose</a>();
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
