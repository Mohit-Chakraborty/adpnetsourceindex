<!DOCTYPE html>
<html><head><title>KeyRotationPolicyTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(103);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Security.KeyVault.Keys.Tests/KeyRotationPolicyTests.cs" target="_top">KeyRotationPolicyTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/keyvault/Azure.Security.KeyVault.Keys/tests/KeyRotationPolicyTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Security.KeyVault.Keys.Tests" target="_top">Azure.Security.KeyVault.Keys.Tests.csproj</a> (Azure.Security.KeyVault.Keys.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Security</span>.<span class="i n">KeyVault</span>.<span class="i n">Tests</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Security</span>.<span class="i n">KeyVault</span>.<span class="i n">Keys</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="234b4da4fe58c69f" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="81cd0b1719b13c2b">KeyRotationPolicyTests</span></a>
    {
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="e4e4640d73023154" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Deserializes</a>()
        {
            <b>const string</b> <span id="r0 rd" class="r0 r">content</span> = <span class="s">@&quot;{
    &quot;&quot;id&quot;&quot;: &quot;&quot;https://test.vault.azure.net/keys/key-name/rotationpolicy&quot;&quot;,
    &quot;&quot;lifetimeActions&quot;&quot;: [
        {
            &quot;&quot;trigger&quot;&quot;: {
                &quot;&quot;timeBeforeExpiry&quot;&quot;: &quot;&quot;P30D&quot;&quot;
            },
            &quot;&quot;action&quot;&quot;: {
                &quot;&quot;type&quot;&quot;: &quot;&quot;Rotate&quot;&quot;
            }
        },
        {
            &quot;&quot;trigger&quot;&quot;: {
                &quot;&quot;timeAfterCreate&quot;&quot;: &quot;&quot;P25D&quot;&quot;
            },
            &quot;&quot;action&quot;&quot;: {
                &quot;&quot;type&quot;&quot;: &quot;&quot;Notify&quot;&quot;
            }
        }
    ],
    &quot;&quot;attributes&quot;&quot;: {
        &quot;&quot;expiryTime&quot;&quot;: &quot;&quot;P45D&quot;&quot;,
        &quot;&quot;created&quot;&quot;: 1633473479,
        &quot;&quot;updated&quot;&quot;: 1633473504
    }
}&quot;</span>;
 
            <a href="/Azure.Security.KeyVault.Keys/A.html#8d06b74ea4b8bc23" class="t t">KeyRotationPolicy</a> <span id="r1 rd" class="r1 r">sut</span> = <b>new</b>();
 
            <b>using</b> (<a href="JsonStream.cs.html#1c8db0982b53c660" class="t t">JsonStream</a> <span id="r2 rd" class="r2 r">json</span> = <b>new</b>(<span class="r0 r">content</span>))
            {
                <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#829ced71831b92aa" class="i method">Deserialize</a>(<span class="r2 r">json</span>.<a href="JsonStream.cs.html#44b15decd7e62070" class="i method">AsStream</a>());
            }
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;https://test.vault.azure.net/keys/key-name/rotationpolicy&quot;</span>, <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f43e9c566fd477b" class="i property">Id</a>.<a href="@0@System/A.html#e335fec0022465e6" class="i property">AbsoluteUri</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(2, <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a>.<a href="@0@mscorlib/A.html#3d6c21c4e9bd5f63" class="i property">Count</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Security.KeyVault.Keys/A.html#a085f037dd1f2573" class="t t">KeyRotationPolicyAction</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#a1ad513bfa9f7160" class="i property">Rotate</a>, <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a>[0].<a href="/Azure.Security.KeyVault.Keys/A.html#f7b4c1159ee411c8" class="i property">Action</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;P30D&quot;</span>, <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a>[0].<a href="/Azure.Security.KeyVault.Keys/A.html#5e206931f7ae4eec" class="i property">TimeBeforeExpiry</a>);
            <span class="t t">Assert</span>.<span class="i method">IsNull</span>(<span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a>[0].<a href="/Azure.Security.KeyVault.Keys/A.html#db6918f32df14a3e" class="i property">TimeAfterCreate</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Security.KeyVault.Keys/A.html#a085f037dd1f2573" class="t t">KeyRotationPolicyAction</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#448498b5b78a5923" class="i property">Notify</a>, <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a>[1].<a href="/Azure.Security.KeyVault.Keys/A.html#f7b4c1159ee411c8" class="i property">Action</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;P25D&quot;</span>, <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a>[1].<a href="/Azure.Security.KeyVault.Keys/A.html#db6918f32df14a3e" class="i property">TimeAfterCreate</a>);
            <span class="t t">Assert</span>.<span class="i method">IsNull</span>(<span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a>[1].<a href="/Azure.Security.KeyVault.Keys/A.html#5e206931f7ae4eec" class="i property">TimeBeforeExpiry</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;P45D&quot;</span>, <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#31693f2a8f34abeb" class="i property">ExpiresIn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#355516336bba15ac" class="i method">Parse</a>(<span class="s">&quot;2021-10-05T22:37:59.0000000+00:00&quot;</span>), <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#0762a304a51e2715" class="i property">CreatedOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#355516336bba15ac" class="i method">Parse</a>(<span class="s">&quot;2021-10-05T22:38:24.0000000+00:00&quot;</span>), <span class="r1 r">sut</span>.<a href="/Azure.Security.KeyVault.Keys/A.html#c49330dbd2ce8139" class="i property">UpdatedOn</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="64e197ccafe6c68e" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SerializesEmptyLifetimeActions</a>()
        {
            <a href="/Azure.Security.KeyVault.Keys/A.html#8d06b74ea4b8bc23" class="t t">KeyRotationPolicy</a> <span id="r3 rd" class="r3 r">sut</span> = <b>new</b>()
            {
                <a href="/Azure.Security.KeyVault.Keys/A.html#31693f2a8f34abeb" class="i property">ExpiresIn</a> = <span class="s">&quot;P45D&quot;</span>,
                <a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a> = { },
            };
 
            <b>using</b> <a href="JsonStream.cs.html#1c8db0982b53c660" class="t t">JsonStream</a> <span id="r4 rd" class="r4 r">json</span> = <b>new</b>();
            <span class="r4 r">json</span>.<a href="JsonStream.cs.html#258d0fa947f202e4" class="i method">WriteObject</a>(<span class="r3 r">sut</span>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">@&quot;{&quot;&quot;lifetimeActions&quot;&quot;:[],&quot;&quot;attributes&quot;&quot;:{&quot;&quot;expiryTime&quot;&quot;:&quot;&quot;P45D&quot;&quot;}}&quot;</span>, <span class="r4 r">json</span>.<a href="JsonStream.cs.html#c8b36c006df67a9a" class="i method">ToString</a>());
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="e76e1899aed63813" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SerializesOnlyWritableProperties</a>()
        {
            <a href="/Azure.Security.KeyVault.Keys/A.html#8d06b74ea4b8bc23" class="t t">KeyRotationPolicy</a> <span id="r5 rd" class="r5 r">sut</span> = <b>new</b>()
            {
                <a href="/Azure.Security.KeyVault.Keys/A.html#2f43e9c566fd477b" class="i property">Id</a> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="s">&quot;https://localhost&quot;</span>),
                <a href="/Azure.Security.KeyVault.Keys/A.html#31693f2a8f34abeb" class="i property">ExpiresIn</a> = <span class="s">&quot;P45D&quot;</span>,
                <a href="/Azure.Security.KeyVault.Keys/A.html#2f0569930cd9c731" class="i property">LifetimeActions</a> =
                {
                    <b>new</b> <a href="/Azure.Security.KeyVault.Keys/A.html#09f4e6e5bd33231b" class="t constructor">KeyRotationLifetimeAction</a>
                    {
                        <a href="/Azure.Security.KeyVault.Keys/A.html#f7b4c1159ee411c8" class="i property">Action</a> = <a href="/Azure.Security.KeyVault.Keys/A.html#a085f037dd1f2573" class="t t">KeyRotationPolicyAction</a>.<a href="/Azure.Security.KeyVault.Keys/A.html#a1ad513bfa9f7160" class="i property">Rotate</a>,
                        <a href="/Azure.Security.KeyVault.Keys/A.html#5e206931f7ae4eec" class="i property">TimeBeforeExpiry</a>= <span class="s">&quot;P30D&quot;</span>,
                    }
                },
                <a href="/Azure.Security.KeyVault.Keys/A.html#0762a304a51e2715" class="i property">CreatedOn</a> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#c6573f48ac6bd630" class="i property">Now</a>,
                <a href="/Azure.Security.KeyVault.Keys/A.html#c49330dbd2ce8139" class="i property">UpdatedOn</a> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#c6573f48ac6bd630" class="i property">Now</a>,
            };
 
            <b>using</b> <a href="JsonStream.cs.html#1c8db0982b53c660" class="t t">JsonStream</a> <span id="r6 rd" class="r6 r">json</span> = <b>new</b>();
            <span class="r6 r">json</span>.<a href="JsonStream.cs.html#258d0fa947f202e4" class="i method">WriteObject</a>(<span class="r5 r">sut</span>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">@&quot;{&quot;&quot;lifetimeActions&quot;&quot;:[{&quot;&quot;trigger&quot;&quot;:{&quot;&quot;timeBeforeExpiry&quot;&quot;:&quot;&quot;P30D&quot;&quot;},&quot;&quot;action&quot;&quot;:{&quot;&quot;type&quot;&quot;:&quot;&quot;Rotate&quot;&quot;}}],&quot;&quot;attributes&quot;&quot;:{&quot;&quot;expiryTime&quot;&quot;:&quot;&quot;P45D&quot;&quot;}}&quot;</span>, <span class="r6 r">json</span>.<a href="JsonStream.cs.html#c8b36c006df67a9a" class="i method">ToString</a>());
        }
    }
}
</pre></td></tr></table></div></body></html>
