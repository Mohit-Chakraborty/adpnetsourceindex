<!DOCTYPE html>
<html><head><title>AzureMonitorTestEnvironment.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(72);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Monitor.OpenTelemetry.Exporter.Integration.Tests/FunctionalTests/AzureMonitorTestEnvironment.cs" target="_top">FunctionalTests\AzureMonitorTestEnvironment.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/monitor/Azure.Monitor.OpenTelemetry.Exporter/tests/Integration.Tests/FunctionalTests/AzureMonitorTestEnvironment.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Monitor.OpenTelemetry.Exporter.Integration.Tests" target="_top">Azure.Monitor.OpenTelemetry.Exporter.Integration.Tests.csproj</a> (Azure.Monitor.OpenTelemetry.Exporter.Integration.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Monitor</span>.<span class="i n">OpenTelemetry</span>.<span class="i n">Exporter</span>.<span class="i n">Integration</span>.<span class="i n">Tests</span>.<span class="i n">FunctionalTests</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
 
    <b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
 
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">Azure</span>.<span class="i n">Authentication</span>;
 
    <b>public class</b> <a id="b91cac1d92879b7d" href="../R/b91cac1d92879b7d.html" target="n" data-glyph="0,0" class="t t">AzureMonitorTestEnvironment</a> : <a href="/Azure.Core.TestFramework/A.html#e657e3c675f27c43" class="t t">TestEnvironment</a>
    {
        <b>public</b> <a id="ec51ef02b5228468" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">AzureMonitorTestEnvironment</a>() : <a href="/Azure.Core.TestFramework/A.html#46f223ae1bea9022" class="k">base</a>() { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Connection String is used to connect to an Application Insights resource.</span>
        <span class="c">///</span><span class="c"> This value comes from the ARM Template.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="57f0daca5dff94be" href="../R/57f0daca5dff94be.html" target="n" data-glyph="102,1" class="i property">ConnectionString</a> =&gt; <a href="/Azure.Core.TestFramework/A.html#0fcf50ca07a3f617" class="i method">GetRecordedVariable</a>(<a href="#5368673cf8018db7" class="t t">EnvironmentVariableNames</a>.<a href="#0d4a88a8f157c291" class="i field">ConnectionString</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Application ID is used to identify an Application Insights resource when querying telemetry from the REST API.</span>
        <span class="c">///</span><span class="c"> This value comes from the ARM Template.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="314ed4267e790bc3" href="../R/314ed4267e790bc3.html" target="n" data-glyph="102,1" class="i property">ApplicationId</a> =&gt; <a href="/Azure.Core.TestFramework/A.html#0fcf50ca07a3f617" class="i method">GetRecordedVariable</a>(<a href="#5368673cf8018db7" class="t t">EnvironmentVariableNames</a>.<a href="#cd92da1af9e77269" class="i field">ApplicationId</a>);
 
        <b>public bool</b> <a id="8fd68ee324d086ab" href="../R/8fd68ee324d086ab.html" target="n" data-glyph="102,1" class="i property">IsTestModeLive</a> =&gt; <a href="#b91cac1d92879b7d" class="k">this</a>.<a href="/Azure.Core.TestFramework/A.html#1454744fa3bc6218" class="i property">Mode</a> != <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Microsoft.Rest.ClientRuntime/A.html#a6e915f66d65cdd3" class="t t">ServiceClientCredentials</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> needed by </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ApplicationInsightsDataClient</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to query Kusto.</span>
        <span class="c">///</span><span class="c"> - IN LIVE OR RECORD TEST MODE</span>
        <span class="c">///</span><span class="c"> Uses the TestEnvironment to log into Application Insights using a Service Principal.</span>
        <span class="c">///</span><span class="c"> These values are created when running the New-TestResources.ps1 script.</span>
        <span class="c">///</span><span class="c"> - IN PLAYBACK TEST MODE</span>
        <span class="c">///</span><span class="c"> Return an instance of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Microsoft.Rest.ClientRuntime/A.html#c4acaa66018e3f32" class="t t">TokenCredentials</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Microsoft.Rest.ClientRuntime/A.html#a6e915f66d65cdd3" class="t t">ServiceClientCredentials</a>&gt; <a id="1430c427c8fac128" href="../R/1430c427c8fac128.html" target="n" data-glyph="72,1" class="i method">GetServiceClientCredentialsAsync</a>()
        {
            <b>if</b> (<a href="#b91cac1d92879b7d" class="k">this</a>.<a href="#8fd68ee324d086ab" class="i property">IsTestModeLive</a>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r0 rd" class="r0 r">authEndpoint</span> = <span class="s">&quot;https://login.microsoftonline.com&quot;</span>;
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r1 rd" class="r1 r">tokenAudience</span> = <span class="s">&quot;https://api.applicationinsights.io/&quot;</span>;
                <a href="/Microsoft.Rest.ClientRuntime.Azure.Authentication/A.html#7188eccbd94bc74e" class="k">var</a> <span id="r2 rd" class="r2 r">adSettings</span> = <b>new</b> <a href="/Microsoft.Rest.ClientRuntime.Azure.Authentication/A.html#716caa03c9b5ff5c" class="t constructor">ActiveDirectoryServiceSettings</a>
                {
                    <a href="/Microsoft.Rest.ClientRuntime.Azure.Authentication/A.html#12633e9a7200038c" class="i property">AuthenticationEndpoint</a> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r0 r">authEndpoint</span>),
                    <a href="/Microsoft.Rest.ClientRuntime.Azure.Authentication/A.html#2eb04738ad480f1c" class="i property">TokenAudience</a> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r1 r">tokenAudience</span>),
                    <a href="/Microsoft.Rest.ClientRuntime.Azure.Authentication/A.html#7a0a1ca2a2fb9068" class="i property">ValidateAuthority</a> = <b>true</b>
                };
 
                <b>return</b> <b>await</b> <a href="/Microsoft.Rest.ClientRuntime.Azure.Authentication/A.html#f9c654acf3495df6" class="t t">ApplicationTokenProvider</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.Authentication/A.html#644a671d6f8207c3" class="i method">LoginSilentAsync</a>(
                    <span class="r3 r">domain</span>: <a href="#b91cac1d92879b7d" class="k">this</a>.<a href="/Azure.Core.TestFramework/A.html#ab050f0e55126952" class="i property">TenantId</a>,
                    <span class="r4 r">clientId</span>: <a href="#b91cac1d92879b7d" class="k">this</a>.<a href="/Azure.Core.TestFramework/A.html#50081c441f6f88a4" class="i property">ClientId</a>,
                    <span class="r5 r">secret</span>: <a href="#b91cac1d92879b7d" class="k">this</a>.<a href="/Azure.Core.TestFramework/A.html#e314809ba7ea5ea8" class="i property">ClientSecret</a>,
                    <span class="r6 r">settings</span>: <span class="r2 r">adSettings</span>);
            }
            <b>else</b>
            {
                <b>return</b> <b>new</b> <a href="/Microsoft.Rest.ClientRuntime/A.html#7760d207e8a5d05e" class="t constructor">TokenCredentials</a>(<span class="s">&quot;testValue&quot;</span>);
            }
        }
 
        <b>internal static class</b> <a id="5368673cf8018db7" href="../R/5368673cf8018db7.html" target="n" data-glyph="2,1" class="t t">EnvironmentVariableNames</a>
        {
            <b>public const string</b> <a id="0d4a88a8f157c291" href="../R/0d4a88a8f157c291.html" target="n" data-glyph="6,2" class="i field">ConnectionString</a> = <span class="s">&quot;CONNECTION_STRING&quot;</span>;
            <b>public const string</b> <a id="cd92da1af9e77269" href="../R/cd92da1af9e77269.html" target="n" data-glyph="6,2" class="i field">ApplicationId</a> = <span class="s">&quot;APPLICATION_ID&quot;</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
