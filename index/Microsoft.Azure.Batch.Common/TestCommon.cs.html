<!DOCTYPE html>
<html><head><title>TestCommon.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(124);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Batch.Common/TestCommon.cs" target="_top">TestCommon.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Batch.Common" target="_top">Microsoft.Azure.Batch.Common.csproj</a> (Microsoft.Azure.Batch.Common)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
﻿<b>namespace</b> <span class="i n">BatchTestCommon</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
 
    <b>public static class</b> <a id="60de66d46149fa95" href="R/60de66d46149fa95.html" target="n" data-glyph="0,0" class="t t">TestCommon</a>
    {
        <b>public class</b> <a id="7ebb4a3a9bf784ac" href="R/7ebb4a3a9bf784ac.html" target="n" data-glyph="0,1" class="t t"><span id="04bce00ef450867f">TestConfiguration</span></a>
        {
            <b>public const string</b> <a id="332d32e82460ec8a" href="R/332d32e82460ec8a.html" target="n" data-glyph="6,2" class="i field">BatchSubscriptionEnivronmentSettingName</a> = <span class="s">&quot;MABOM_BatchAccountSubscriptionId&quot;</span>;
 
            <b>public const string</b> <a id="9a8320ab7ca50376" href="R/9a8320ab7ca50376.html" target="n" data-glyph="6,2" class="i field">BatchManagementUrlEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchManagementEndpoint&quot;</span>;
 
            <b>public const string</b> <a id="db961992250e38b2" href="R/db961992250e38b2.html" target="n" data-glyph="6,2" class="i field">BatchAccountKeyEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchAccountKey&quot;</span>;
 
            <b>public const string</b> <a id="3a7c0cada63cbe7f" href="R/3a7c0cada63cbe7f.html" target="n" data-glyph="6,2" class="i field">BatchAccountNameEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchAccountName&quot;</span>;
 
            <b>public const string</b> <a id="4df515c357193107" href="R/4df515c357193107.html" target="n" data-glyph="6,2" class="i field">BatchAccountUrlEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchAccountEndpoint&quot;</span>;
 
            <b>public const string</b> <a id="cf262c2fbe73b4c9" href="R/cf262c2fbe73b4c9.html" target="n" data-glyph="6,2" class="i field">StorageAccountKeyEnvironmentSettingName</a> = <span class="s">&quot;MABOM_StorageKey&quot;</span>;
 
            <b>public const string</b> <a id="824050fdefbfb9ee" href="R/824050fdefbfb9ee.html" target="n" data-glyph="6,2" class="i field">StorageAccountNameEnvironmentSettingName</a> = <span class="s">&quot;MABOM_StorageAccount&quot;</span>;
 
            <b>public const string</b> <a id="117f9eb4dda1e7bc" href="R/117f9eb4dda1e7bc.html" target="n" data-glyph="6,2" class="i field">StorageAccountBlobEndpointEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BlobEndpoint&quot;</span>;
 
            <b>public const string</b> <a id="116ed1246a322df9" href="R/116ed1246a322df9.html" target="n" data-glyph="6,2" class="i field">BatchAccountResourceGroupEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchAccountResourceGroupName&quot;</span>;
 
            <b>public const string</b> <a id="913eeeb00202323d" href="R/913eeeb00202323d.html" target="n" data-glyph="6,2" class="i field">StorageAccountResourceGroupEnvironmentSettingName</a> = <span class="s">&quot;MABOM_StorageAccountResourceGroupName&quot;</span>;
 
            <span class="c">// Required only for Microsoft pre-production test environments</span>
 
            <span class="c">// The client Id from the Azure Active Directory, this is used for connecting to the management api.</span>
            <b>public const string</b> <a id="c8fe2aa851ff6711" href="R/c8fe2aa851ff6711.html" target="n" data-glyph="6,2" class="i field">AzureAuthenticationClientIdEnvironmentSettingName</a> = <span class="s">&quot;MABOM_AzureAuthenticationClientId&quot;</span>;
 
            <span class="c">// The client key from the Azure Active Directory app. </span>
            <b>public const string</b> <a id="2eb5caa9ea446829" href="R/2eb5caa9ea446829.html" target="n" data-glyph="6,2" class="i field">AzureAuthenticationClientSecretEnvironmentSettingName</a> = <span class="s">&quot;MABOM_AzureAuthenticationClientSecret&quot;</span>;
 
            <b>public const string</b> <a id="1c439be7f95277ad" href="R/1c439be7f95277ad.html" target="n" data-glyph="6,2" class="i field">BatchAuthorityUrlEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchAuthorityUrl&quot;</span>;
 
            <b>public const string</b> <a id="ea65f2ee34d7e2a0" href="R/ea65f2ee34d7e2a0.html" target="n" data-glyph="6,2" class="i field">BatchTRPCertificateThumbprintEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchTRPCertificateThumbprint&quot;</span>;
 
            <span class="c">//Should be a string like so: header1=value1;header2=value2;...</span>
            <span class="c">// Required only for Microsoft pre-production test environments</span>
            <b>public const string</b> <a id="460f5db0a74b3a71" href="R/460f5db0a74b3a71.html" target="n" data-glyph="6,2" class="i field">BatchTRPExtraHeadersEnvironmentSettingName</a> = <span class="s">&quot;MABOM_BatchTRPExtraHeaders&quot;</span>;
 
            <b>public readonly string</b> <a id="4f54351d95b45f78" href="R/4f54351d95b45f78.html" target="n" data-glyph="42,2" class="i field">BatchSubscription</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#332d32e82460ec8a" class="i field">BatchSubscriptionEnivronmentSettingName</a>);
 
            <b>public readonly string</b> <a id="817583275f9c1aba" href="R/817583275f9c1aba.html" target="n" data-glyph="42,2" class="i field">BatchManagementUrl</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#9a8320ab7ca50376" class="i field">BatchManagementUrlEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="115141c33bc08ece" href="R/115141c33bc08ece.html" target="n" data-glyph="42,2" class="i field">BatchAccountKey</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#db961992250e38b2" class="i field">BatchAccountKeyEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="180c3860f60310ff" href="R/180c3860f60310ff.html" target="n" data-glyph="42,2" class="i field">BatchAccountName</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#3a7c0cada63cbe7f" class="i field">BatchAccountNameEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="34ec98f54745720a" href="R/34ec98f54745720a.html" target="n" data-glyph="42,2" class="i field">BatchAccountUrl</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#4df515c357193107" class="i field">BatchAccountUrlEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="6244e0fd3c7b1b6b" href="R/6244e0fd3c7b1b6b.html" target="n" data-glyph="42,2" class="i field">StorageAccountKey</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#cf262c2fbe73b4c9" class="i field">StorageAccountKeyEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="ba2fe2365e70f4e9" href="R/ba2fe2365e70f4e9.html" target="n" data-glyph="42,2" class="i field">StorageAccountName</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#824050fdefbfb9ee" class="i field">StorageAccountNameEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="dd10291d85ba9675" href="R/dd10291d85ba9675.html" target="n" data-glyph="42,2" class="i field">StorageAccountBlobEndpoint</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#117f9eb4dda1e7bc" class="i field">StorageAccountBlobEndpointEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="331db86214369d86" href="R/331db86214369d86.html" target="n" data-glyph="42,2" class="i field">BatchAccountResourceGroup</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#116ed1246a322df9" class="i field">BatchAccountResourceGroupEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="db82cc2a6d730436" href="R/db82cc2a6d730436.html" target="n" data-glyph="42,2" class="i field">StorageAccountResourceGroup</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#913eeeb00202323d" class="i field">StorageAccountResourceGroupEnvironmentSettingName</a>);
 
            <b>public readonly</b> <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="d393bee62761113e" href="R/d393bee62761113e.html" target="n" data-glyph="42,2" class="i field">BatchTRPCertificateThumbprint</a> = () =&gt; <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#ea65f2ee34d7e2a0" class="i field">BatchTRPCertificateThumbprintEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="3d3de10c59cb2fb6" href="R/3d3de10c59cb2fb6.html" target="n" data-glyph="42,2" class="i field">AzureAuthenticationClientId</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#c8fe2aa851ff6711" class="i field">AzureAuthenticationClientIdEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="5d0e99bc53e9a6b2" href="R/5d0e99bc53e9a6b2.html" target="n" data-glyph="42,2" class="i field">AzureAuthenticationClientSecret</a> = <a href="#c957bfaa07f30d8a" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="#2eb5caa9ea446829" class="i field">AzureAuthenticationClientSecretEnvironmentSettingName</a>);
 
            <b>public readonly</b> <a href="@0@mscorlib/A.html#f786bcc5e7b69c7d" class="t t">IReadOnlyDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="9ee98fbcd3b269aa" href="R/9ee98fbcd3b269aa.html" target="n" data-glyph="42,2" class="i field">BatchTRPExtraHeaders</a> = <a href="#d2fc411e218c18a8" class="i method">ParseHeaderEnvironmentVariable</a>(<a href="#460f5db0a74b3a71" class="i field">BatchTRPExtraHeadersEnvironmentSettingName</a>);
 
            <b>public readonly string</b> <a id="fbca33aeea462504" href="R/fbca33aeea462504.html" target="n" data-glyph="42,2" class="i field">BatchAuthorityUrl</a> = <a href="#45f5a56403fcce0a" class="i method">GetEnvironmentVariableOrDefault</a>(<a href="#1c439be7f95277ad" class="i field">BatchAuthorityUrlEnvironmentSettingName</a>, <span class="s">&quot;https://login.microsoftonline.com/microsoft.onmicrosoft.com&quot;</span>);
 
            <b>private static</b> <a href="@0@mscorlib/A.html#f786bcc5e7b69c7d" class="t t">IReadOnlyDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="d2fc411e218c18a8" href="R/d2fc411e218c18a8.html" target="n" data-glyph="76,2" class="i method">ParseHeaderEnvironmentVariable</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">environmentSettingName</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">settingString</span> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="r0 r">environmentSettingName</span>);
                <a href="@0@mscorlib/A.html#f786bcc5e7b69c7d" class="t t">IReadOnlyDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r2 rd" class="r2 r">result</span> = <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
 
                <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r1 r">settingString</span>))
                {
                    <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r3 rd" class="r3 r">pairs</span> = <span class="r1 r">settingString</span>.<a href="@0@mscorlib/A.html#1c4a9dc78ba38999" class="i method">Split</a>(<span class="s">&#39;;&#39;</span>);
                    <span class="r2 r">result</span> = <span class="r3 r">pairs</span>.<a href="@0@System.Core/A.html#c7f3fa13329a79cd" class="i method">ToDictionary</a>(<span id="r4 rd" class="r4 r">pair</span> =&gt; <span class="r4 r">pair</span>.<a href="@0@mscorlib/A.html#1c4a9dc78ba38999" class="i method">Split</a>(<span class="s">&#39;=&#39;</span>)[0], <span id="r5 rd" class="r5 r">pair</span> =&gt; <span class="r5 r">pair</span>.<a href="@0@mscorlib/A.html#1c4a9dc78ba38999" class="i method">Split</a>(<span class="s">&#39;=&#39;</span>)[1]);
                }
 
                <b>return</b> <span class="r2 r">result</span>;
            }
 
            <b>private static string</b> <a id="c957bfaa07f30d8a" href="R/c957bfaa07f30d8a.html" target="n" data-glyph="76,2" class="i method">GetEnvironmentVariableOrThrow</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">environmentSettingName</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">result</span> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="r6 r">environmentSettingName</span>);
                <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r7 r">result</span>))
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#eb98012a74461437" class="t constructor">ArgumentException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;Missing required environment variable {0}&quot;</span>, <span class="r6 r">environmentSettingName</span>));
                }
 
                <b>return</b> <span class="r7 r">result</span>;
            }
 
            <b>private static string</b> <a id="45f5a56403fcce0a" href="R/45f5a56403fcce0a.html" target="n" data-glyph="76,2" class="i method">GetEnvironmentVariableOrDefault</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">environmentSettingName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">defaultValue</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">result</span> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="r8 r">environmentSettingName</span>);
                <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r10 r">result</span>))
                {
                    <b>return</b> <span class="r9 r">defaultValue</span>;
                }
 
                <b>return</b> <span class="r10 r">result</span>;
            }
        }
 
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#8b99c1f377873554" class="t t">Lazy</a>&lt;<a href="#7ebb4a3a9bf784ac" class="t t">TestConfiguration</a>&gt; <a id="91b56dfa7179a446" href="R/91b56dfa7179a446.html" target="n" data-glyph="46,1" class="i field">configurationInstance</a> = <b>new</b> <a href="@0@mscorlib/A.html#c0f7b98bacad370a" class="t constructor">Lazy</a>&lt;<a href="#7ebb4a3a9bf784ac" class="t t">TestConfiguration</a>&gt;(() =&gt; <b>new</b> <a href="#7ebb4a3a9bf784ac" class="t constructor">TestConfiguration</a>());
 
        <b>public static</b> <a href="#7ebb4a3a9bf784ac" class="t t">TestConfiguration</a> <a id="592860b555542c88" href="R/592860b555542c88.html" target="n" data-glyph="102,1" class="i property">Configuration</a>
        {
            <b>get</b> { <b>return</b> <a href="#91b56dfa7179a446" class="i field">configurationInstance</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>; }
        }
    }
}</pre></td></tr></table></div></body></html>
