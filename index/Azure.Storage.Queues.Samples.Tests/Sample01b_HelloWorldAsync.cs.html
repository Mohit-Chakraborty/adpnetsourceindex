<!DOCTYPE html>
<html><head><title>Sample01b_HelloWorldAsync.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(212);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Storage.Queues.Samples.Tests/Sample01b_HelloWorldAsync.cs" target="_top">Sample01b_HelloWorldAsync.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Storage.Queues.Samples.Tests" target="_top">Azure.Storage.Queues.Samples.Tests.csproj</a> (Azure.Storage.Queues.Samples.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Queues</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Queues</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Queues</span>.<span class="i n">Samples</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Basic Azure Queue Storage samples</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="430fb492e06ca9ab" href="R/430fb492e06ca9ab.html" target="n" data-glyph="0,0" class="t t"><span id="2361988c0b25faed">Sample01b_HelloWorldAsync</span></a> : <a href="Shared/SampleTest.cs.html#cd3285177155f6f1" class="t t">SampleTest</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create a queue and add a message.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A connection string to your Azure Storage account.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">queueName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of the queue to create and send a message to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7e5280a4ccd01322" href="R/7e5280a4ccd01322.html" target="n" data-glyph="72,1" class="i method">SendMessageAsync</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">connectionString</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">queueName</span>)
        {
            <span class="c">// We&#39;ll need a connection string to your Azure Storage account.</span>
            <span class="c">// You can obtain your connection string from the Azure Portal</span>
            <span class="c">// (click Access Keys under Settings in the Portal Storage account</span>
            <span class="c">// blade) or using the Azure CLI with:</span>
            <span class="c">//</span>
            <span class="c">//     az storage account show-connection-string --name &lt;account_name&gt; --resource-group &lt;resource_group&gt;</span>
            <span class="c">//</span>
            <span class="c">// You would normally provide the connection string to your</span>
            <span class="c">// application using an environment variable.</span>
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Storage_Queues_Samples_Sample01b_HelloWorld_SendMessageAsync
            <span class="c">// We&#39;ll need a connection string to your Azure Storage account.</span>
            <span class="c">//@@ string connectionString = &quot;&lt;connection_string&gt;&quot;;</span>
 
            <span class="c">// Name of the queue we&#39;ll send messages to</span>
            <span class="c">//@@ string queueName = &quot;sample-queue&quot;;</span>
 
            <span class="c">// Get a reference to a queue and then create it</span>
            <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r2 rd" class="r2 r">queue</span> = <b>new</b> <a href="/Azure.Storage.Queues/A.html#607c1f6ebd194e83" class="t constructor">QueueClient</a>(<span class="r0 r">connectionString</span>, <span class="r1 r">queueName</span>);
            <b>await</b> <span class="r2 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#6b9a6e3c658e8575" class="i method">CreateAsync</a>();
 
            <span class="c">// Send a message to our queue</span>
            <b>await</b> <span class="r2 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;Hello, Azure!&quot;</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Storage_Queues_Samples_Sample01b_HelloWorld_SendMessageAsync
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receive and process messages from a queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A connection string to your Azure Storage account.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">queueName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of an existing queue to operate on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="20f3291b05423382" href="R/20f3291b05423382.html" target="n" data-glyph="72,1" class="i method">ReceiveMessagesAsync</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">connectionString</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">queueName</span>)
        {
            <span class="c">// Get a reference to a queue and then fill it with messages</span>
            <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r5 rd" class="r5 r">queue</span> = <b>new</b> <a href="/Azure.Storage.Queues/A.html#607c1f6ebd194e83" class="t constructor">QueueClient</a>(<span class="r3 r">connectionString</span>, <span class="r4 r">queueName</span>);
            <b>await</b> <span class="r5 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;first&quot;</span>);
            <b>await</b> <span class="r5 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;second&quot;</span>);
            <b>await</b> <span class="r5 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;third&quot;</span>);
 
            <span class="c">// Get the next messages from the queue</span>
            <b>foreach</b> (<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a> <span id="r6 rd" class="r6 r">message</span> <b>in</b> (<b>await</b> <span class="r5 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#efe8df42c9757b27" class="i method">ReceiveMessagesAsync</a>(<span class="r7 r">maxMessages</span>: 10)).<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>)
            {
                <span class="c">// &quot;Process&quot; the message</span>
                <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">Message: </span>{<span class="r6 r">message</span>.<a href="/Azure.Storage.Queues/A.html#ca6ccb0de2843484" class="i property">Body</a>}<span class="s">&quot;</span>);
 
                <span class="c">// Let the service know we&#39;re finished with the message and</span>
                <span class="c">// it can be safely deleted.</span>
                <b>await</b> <span class="r5 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c6b0763cbcb3d73" class="i method">DeleteMessageAsync</a>(<span class="r6 r">message</span>.<a href="/Azure.Storage.Queues/A.html#19218602eec807e8" class="i property">MessageId</a>, <span class="r6 r">message</span>.<a href="/Azure.Storage.Queues/A.html#93c530edee4e3735" class="i property">PopReceipt</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Peek at the messages on a queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A connection string to your Azure Storage account.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">queueName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of an existing queue to operate on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="eafdc2c732dbe5fc" href="R/eafdc2c732dbe5fc.html" target="n" data-glyph="72,1" class="i method">PeekMesssagesAsync</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">connectionString</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">queueName</span>)
        {
            <span class="c">// Get a reference to a queue and then fill it with messages</span>
            <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r10 rd" class="r10 r">queue</span> = <b>new</b> <a href="/Azure.Storage.Queues/A.html#607c1f6ebd194e83" class="t constructor">QueueClient</a>(<span class="r8 r">connectionString</span>, <span class="r9 r">queueName</span>);
            <b>await</b> <span class="r10 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;first&quot;</span>);
            <b>await</b> <span class="r10 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;second&quot;</span>);
            <b>await</b> <span class="r10 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;third&quot;</span>);
 
            <span class="c">// Get the messages from the queue</span>
            <b>foreach</b> (<a href="/Azure.Storage.Queues/A.html#e32155654252c9e5" class="t t">PeekedMessage</a> <span id="r11 rd" class="r11 r">message</span> <b>in</b> (<b>await</b> <span class="r10 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#1025de7ead38d12f" class="i method">PeekMessagesAsync</a>(<span class="r12 r">maxMessages</span>: 10)).<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>)
            {
                <span class="c">// Inspect the message</span>
                <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">Message: </span>{<span class="r11 r">message</span>.<a href="/Azure.Storage.Queues/A.html#0b732ef703c38876" class="i property">Body</a>}<span class="s">&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receive messages and update their visibility timeout for extended</span>
        <span class="c">///</span><span class="c"> processing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A connection string to your Azure Storage account.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">queueName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of an existing queue to operate on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ef85313bf60112a9" href="R/ef85313bf60112a9.html" target="n" data-glyph="72,1" class="i method">ReceiveAndUpdateAsync</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r13 rd" class="r13 r">connectionString</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r14 rd" class="r14 r">queueName</span>)
        {
            <span class="c">// Get a reference to a queue and then fill it with messages</span>
            <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r15 rd" class="r15 r">queue</span> = <b>new</b> <a href="/Azure.Storage.Queues/A.html#607c1f6ebd194e83" class="t constructor">QueueClient</a>(<span class="r13 r">connectionString</span>, <span class="r14 r">queueName</span>);
            <b>await</b> <span class="r15 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;first&quot;</span>);
            <b>await</b> <span class="r15 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;second&quot;</span>);
            <b>await</b> <span class="r15 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c21fc372cc81608" class="i method">SendMessageAsync</a>(<span class="s">&quot;third&quot;</span>);
 
            <span class="c">// Get the messages from the queue with a short visibility timeout</span>
            <span class="c">// of 1 second</span>
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a>&gt; <span id="r16 rd" class="r16 r">messages</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a>&gt;();
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a>[]&gt; <span id="r17 rd" class="r17 r">received</span> = <b>await</b> <span class="r15 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#efe8df42c9757b27" class="i method">ReceiveMessagesAsync</a>(10, <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(1));
            <b>foreach</b> (<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a> <span id="r18 rd" class="r18 r">message</span> <b>in</b> <span class="r17 r">received</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>)
            {
                <span class="c">// Tell the service we need a little more time to process the</span>
                <span class="c">// message by giving them a 5 second visiblity window</span>
                <a href="/Azure.Storage.Queues/A.html#a622bf5746390785" class="t t">UpdateReceipt</a> <span id="r19 rd" class="r19 r">receipt</span> = <b>await</b> <span class="r15 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#efb71827ffb4999d" class="i method">UpdateMessageAsync</a>(
                    <span class="r18 r">message</span>.<a href="/Azure.Storage.Queues/A.html#19218602eec807e8" class="i property">MessageId</a>,
                    <span class="r18 r">message</span>.<a href="/Azure.Storage.Queues/A.html#93c530edee4e3735" class="i property">PopReceipt</a>,
                    <span class="r18 r">message</span>.<a href="/Azure.Storage.Queues/A.html#ca6ccb0de2843484" class="i property">Body</a>,
                    <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(5));
 
                <span class="c">// Keep track of the updated messages</span>
                <span class="r16 r">messages</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r18 r">message</span>.<a href="/Azure.Storage.Queues/A.html#e388df0e9215a081" class="i method">Update</a>(<span class="r19 r">receipt</span>));
            }
 
            <span class="c">// Wait until the original 1 second visiblity window times out and</span>
            <span class="c">// check to make sure the messages aren&#39;t showing up yet</span>
            <b>await</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#87a671fb5b9b4384" class="i method">Delay</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(1.5));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(0, (<b>await</b> <span class="r15 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#efe8df42c9757b27" class="i method">ReceiveMessagesAsync</a>(10)).<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a>);
 
            <span class="c">// Finish processing the messages</span>
            <b>foreach</b> (<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a> <span id="r20 rd" class="r20 r">message</span> <b>in</b> <span class="r16 r">messages</span>)
            {
                <span class="c">// &quot;Process&quot; the message</span>
                <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">Message: </span>{<span class="r20 r">message</span>.<a href="/Azure.Storage.Queues/A.html#ca6ccb0de2843484" class="i property">Body</a>}<span class="s">&quot;</span>);
 
                <span class="c">// Tell the service we need a little more time to process the message</span>
                <b>await</b> <span class="r15 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#8c6b0763cbcb3d73" class="i method">DeleteMessageAsync</a>(<span class="r20 r">message</span>.<a href="/Azure.Storage.Queues/A.html#19218602eec807e8" class="i property">MessageId</a>, <span class="r20 r">message</span>.<a href="/Azure.Storage.Queues/A.html#93c530edee4e3735" class="i property">PopReceipt</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Authenticate via Azure Active Directory.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Azure Storage provides integration with Azure Active Directory</span>
        <span class="c">///</span><span class="c"> (Azure AD) for identity-based authentication of requests to the</span>
        <span class="c">///</span><span class="c"> Queue and Queue services. With Azure AD, you can use role-based</span>
        <span class="c">///</span><span class="c"> access control (RBAC) to grant access to your Azure Storage</span>
        <span class="c">///</span><span class="c"> resources to users, groups, or applications. You can grant</span>
        <span class="c">///</span><span class="c"> permissions that are scoped to the level of an individual</span>
        <span class="c">///</span><span class="c"> container or queue.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> To learn more about Azure AD integration in Azure Storage, see</span>
        <span class="c">///</span><span class="c"> https://docs.microsoft.com/en-us/azure/storage/common/storage-auth-aad</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="b8c2a95b35dd7a77" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">IdentityAuth</a>()
        {
            <span class="c">// Create a QueueClient that will authenticate through Active Directory</span>
            <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r21 rd" class="r21 r">queueUri</span> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="s">&quot;https://MYSTORAGEACCOUNT.blob.core.windows.net/QUEUENAME&quot;</span>);
            <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r22 rd" class="r22 r">queue</span> = <b>new</b> <a href="/Azure.Storage.Queues/A.html#b76274e23a80bb90" class="t constructor">QueueClient</a>(<span class="r21 r">queueUri</span>, <b>new</b> <a href="/Azure.Identity/A.html#ebe3cac3c2be1903" class="t constructor">DefaultAzureCredential</a>());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Trigger a recoverable error.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A connection string to your Azure Storage account.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">queueName</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The name of an existing queue to operate on.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="16003e779757f281" href="R/16003e779757f281.html" target="n" data-glyph="72,1" class="i method">ErrorsAsync</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r23 rd" class="r23 r">connectionString</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r24 rd" class="r24 r">queueName</span>)
        {
            <b>try</b>
            {
                <span class="c">// Try to create a queue that already exists</span>
                <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r25 rd" class="r25 r">queue</span> = <b>new</b> <a href="/Azure.Storage.Queues/A.html#607c1f6ebd194e83" class="t constructor">QueueClient</a>(<span class="r23 r">connectionString</span>, <span class="r24 r">queueName</span>);
                <b>await</b> <span class="r25 r">queue</span>.<a href="/Azure.Storage.Queues/A.html#6b9a6e3c658e8575" class="i method">CreateAsync</a>();
            }
            <b>catch</b> (<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a> <span id="r26 rd" class="r26 r">ex</span>)
                <b>when</b> (<span class="r26 r">ex</span>.<a href="/Azure.Core/A.html#0f8d8760e8ec9460" class="i property">ErrorCode</a> == <a href="/Azure.Storage.Queues/A.html#82b5e4e9bf27f08c" class="t t">QueueErrorCode</a>.<a href="/Azure.Storage.Queues/A.html#0bea898aaebf790c" class="i property">QueueAlreadyExists</a>)
            {
                <span class="c">// Ignore any errors if the queue already exists</span>
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
