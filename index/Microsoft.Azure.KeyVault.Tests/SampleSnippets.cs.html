<!DOCTYPE html>
<html><head><title>SampleSnippets.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(448);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.KeyVault.Tests/SampleSnippets.cs" target="_top">SampleSnippets.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/keyvault/Microsoft.Azure.KeyVault/tests/SampleSnippets.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.KeyVault.Tests" target="_top">Microsoft.Azure.KeyVault.Tests.csproj</a> (Microsoft.Azure.KeyVault.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for</span>
<span class="c">// license information.</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">KeyVault</span>.<span class="i n">Tests</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">Azure</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">KeyVault</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">KeyVault</span>.<span class="i n">Models</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">KeyVault</span>.<span class="i n">WebKey</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>;
 
    <span class="c">// Used to compile sample snippets used in MigrationGuide.md documents for track 1.</span>
    <b>internal class</b> <a id="a3db71cbad6813e7" href="R/../../0000000000.html" target="n" data-glyph="2,0" class="t t"><span id="d4a5f6af3cd983fc">SampleSnippets</span></a>
    {
        <b>private async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ec690f84609ec822" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CertificatesMigrationGuide</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_Create
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#ea6a1ef5cdeceae1" class="t t">AzureServiceTokenProvider</a> <span id="r0 rd" class="r0 r">provider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#54507b306bcfc8b8" class="t constructor">AzureServiceTokenProvider</a>();
            <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a> <span id="r1 rd" class="r1 r">client</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#60b54be5c23641ea" class="t constructor">KeyVaultClient</a>(
                <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a>.<span class="t">AuthenticationCallback</span>(<span class="r0 r">provider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#fc3e2628440da92e" class="i property">KeyVaultTokenCallback</a>));
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_Create
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_CreateWithOptions
            <b>using</b> (<span class="t t">HttpClient</span> <span id="r2 rd" class="r2 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>())
            {
                <span class="c">//@@AzureServiceTokenProvider provider = new AzureServiceTokenProvider();</span>
                <span class="c">/*@@*/</span> <span class="r0 r">provider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#54507b306bcfc8b8" class="t constructor">AzureServiceTokenProvider</a>();
                <span class="c">//@@KeyVaultClient client = new KeyVaultClient(</span>
                <span class="c">/*@@*/</span> <span class="r1 r">client</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#174fa5426a6c06d7" class="t constructor">KeyVaultClient</a>(
                    <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a>.<span class="t">AuthenticationCallback</span>(<span class="r0 r">provider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#fc3e2628440da92e" class="i property">KeyVaultTokenCallback</a>),
                    <span class="r2 r">httpClient</span>);
            }
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_CreateWithOptions
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_CreateCustomPolicy
            <a href="/Microsoft.Azure.KeyVault/A.html#aa452aefc727ff55" class="t t">CertificatePolicy</a> <span id="r3 rd" class="r3 r">policy</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#144276523ef55663" class="t constructor">CertificatePolicy</a>
            {
                <a href="/Microsoft.Azure.KeyVault/A.html#bb6228bf6bba8530" class="i property">IssuerParameters</a> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#300a4e72ff658324" class="t constructor">IssuerParameters</a>(<span class="s">&quot;issuer-name&quot;</span>),
                <a href="/Microsoft.Azure.KeyVault/A.html#3f4c4a8cd9f8a8e9" class="i property">SecretProperties</a> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#ea7d209211095281" class="t constructor">SecretProperties</a>(<span class="s">&quot;application/x-pkcs12&quot;</span>),
                <a href="/Microsoft.Azure.KeyVault/A.html#811a1f39026ea2e4" class="i property">KeyProperties</a> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#02d1d5b2b676cbac" class="t constructor">KeyProperties</a>
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#dfefc582b783a01e" class="i property">KeyType</a> = <span class="s">&quot;RSA&quot;</span>,
                    <a href="/Microsoft.Azure.KeyVault/A.html#3dc7487df43ecc32" class="i property">KeySize</a> = 2048,
                    <a href="/Microsoft.Azure.KeyVault/A.html#149ca5a1e3fe5376" class="i property">ReuseKey</a> = <b>true</b>
                },
                <a href="/Microsoft.Azure.KeyVault/A.html#46bc8f22a51144e7" class="i property">X509CertificateProperties</a> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#dbf19a0f38624b14" class="t constructor">X509CertificateProperties</a>(<span class="s">&quot;CN=customdomain.com&quot;</span>)
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#617922e0f59c7ce7" class="i property">KeyUsage</a> = <b>new</b>[]
                    {
                      <a href="/Microsoft.Azure.KeyVault/A.html#417ff63f6bf17750" class="t t">KeyUsageType</a>.<a href="/Microsoft.Azure.KeyVault/A.html#e120d60704887105" class="i field">CRLSign</a>,
                      <a href="/Microsoft.Azure.KeyVault/A.html#417ff63f6bf17750" class="t t">KeyUsageType</a>.<a href="/Microsoft.Azure.KeyVault/A.html#9589541e2d6f32e2" class="i field">DataEncipherment</a>,
                      <a href="/Microsoft.Azure.KeyVault/A.html#417ff63f6bf17750" class="t t">KeyUsageType</a>.<a href="/Microsoft.Azure.KeyVault/A.html#46c5292e5dda97cb" class="i field">DigitalSignature</a>,
                      <a href="/Microsoft.Azure.KeyVault/A.html#417ff63f6bf17750" class="t t">KeyUsageType</a>.<a href="/Microsoft.Azure.KeyVault/A.html#35815be88c52a3ca" class="i field">KeyEncipherment</a>,
                      <a href="/Microsoft.Azure.KeyVault/A.html#417ff63f6bf17750" class="t t">KeyUsageType</a>.<a href="/Microsoft.Azure.KeyVault/A.html#ba7dede5b7c2d126" class="i field">KeyAgreement</a>,
                      <a href="/Microsoft.Azure.KeyVault/A.html#417ff63f6bf17750" class="t t">KeyUsageType</a>.<a href="/Microsoft.Azure.KeyVault/A.html#afad24812386c699" class="i field">KeyCertSign</a>
                    },
                    <a href="/Microsoft.Azure.KeyVault/A.html#71b29a73aada41cc" class="i property">ValidityInMonths</a> = 12
                },
                <a href="/Microsoft.Azure.KeyVault/A.html#e12cacd323da33d4" class="i property">LifetimeActions</a> = <b>new</b>[]
                {
                    <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#4a9f22b9143a5445" class="t constructor">LifetimeAction</a>(
                        <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#7ba130cadd9e1d68" class="t constructor">Trigger</a>
                        {
                            <a href="/Microsoft.Azure.KeyVault/A.html#40f30182c092ff55" class="i property">DaysBeforeExpiry</a> = 90
                        },
                        <b>new</b> <span class="i n">Models</span>.<a href="/Microsoft.Azure.KeyVault/A.html#9907e91353a418d3" class="t constructor">Action</a>(<a href="/Microsoft.Azure.KeyVault/A.html#d1803e0dec2b92e7" class="t t">ActionType</a>.<a href="/Microsoft.Azure.KeyVault/A.html#ab1c2e05aa938dea" class="i field">AutoRenew</a>))
                }
            };
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_CreateCustomPolicy
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_CreateCertificate
                <a href="/Microsoft.Azure.KeyVault/A.html#17bb4008337c63b2" class="t t">CertificateBundle</a> <span id="r4 rd" class="r4 r">certificate</span> = <b>null</b>;
 
                <span class="c">// Start certificate creation.</span>
                <span class="c">// Depending on the policy and your business process, this could even take days for manual signing.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#6ecb24e00693fa9c" class="t t">CertificateOperation</a> <span id="r5 rd" class="r5 r">createOperation</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#7e338492cef7ebcd" class="i method">CreateCertificateAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;certificate-name&quot;</span>, <span class="r3 r">policy</span>);
                <b>while</b> (<b>true</b>)
                {
                    <b>if</b> (<span class="s">&quot;InProgress&quot;</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#9a0ae0e079b7a82c" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
                    {
                        <b>await</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#87a671fb5b9b4384" class="i method">Delay</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(20));
 
                        <span class="r5 r">createOperation</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#ad3b3be886f03920" class="i method">GetCertificateOperationAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;certificate-name&quot;</span>);
                        <b>continue</b>;
                    }
 
                    <b>if</b> (<span class="s">&quot;Completed&quot;</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#9a0ae0e079b7a82c" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
                    {
                        <span class="r4 r">certificate</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#bb630d01ea17fa89" class="i method">GetCertificateAsync</a>(<span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#ee229cb84d235d0e" class="i property">Id</a>);
                        <b>break</b>;
                    }
 
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9726f19207b91186" class="i method">Format</a>(
                        <a href="@0@mscorlib/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@0@mscorlib/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>,
                        <span class="s">&quot;Polling on pending certificate returned an unexpected result. Error code = {0}, Error message = {1}&quot;</span>,
                        <span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#84676f47a5e0b169" class="i property">Error</a>.<a href="/Microsoft.Azure.KeyVault/A.html#9234d6bb19b92373" class="i property">Code</a>,
                        <span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#84676f47a5e0b169" class="i property">Error</a>.<a href="/Microsoft.Azure.KeyVault/A.html#0de85664c442c992" class="i property">Message</a>));
                }
 
                <span class="c">// If you need to restart the application you can recreate the operation and continue awaiting.</span>
                <b>do</b>
                {
                    <span class="r5 r">createOperation</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#ad3b3be886f03920" class="i method">GetCertificateOperationAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;certificate-name&quot;</span>);
 
                    <b>if</b> (<span class="s">&quot;InProgress&quot;</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#9a0ae0e079b7a82c" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
                    {
                        <b>await</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#87a671fb5b9b4384" class="i method">Delay</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(20));
                        <b>continue</b>;
                    }
 
                    <b>if</b> (<span class="s">&quot;Completed&quot;</span>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#9a0ae0e079b7a82c" class="i property">Status</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
                    {
                        <span class="r4 r">certificate</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#bb630d01ea17fa89" class="i method">GetCertificateAsync</a>(<span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#ee229cb84d235d0e" class="i property">Id</a>);
                        <b>break</b>;
                    }
 
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9726f19207b91186" class="i method">Format</a>(
                        <a href="@0@mscorlib/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@0@mscorlib/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>,
                        <span class="s">&quot;Polling on pending certificate returned an unexpected result. Error code = {0}, Error message = {1}&quot;</span>,
                        <span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#84676f47a5e0b169" class="i property">Error</a>.<a href="/Microsoft.Azure.KeyVault/A.html#9234d6bb19b92373" class="i property">Code</a>,
                        <span class="r5 r">createOperation</span>.<a href="/Microsoft.Azure.KeyVault/A.html#84676f47a5e0b169" class="i property">Error</a>.<a href="/Microsoft.Azure.KeyVault/A.html#0de85664c442c992" class="i property">Message</a>));
                } <b>while</b> (<b>true</b>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Security_KeyVault_Certificates_Snippets_MigrationGuide_CreateCertificate
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_ImportCertificate
                <b>byte</b>[] <span id="r6 rd" class="r6 r">cer</span> = <a href="@0@mscorlib/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@0@mscorlib/A.html#ee8033fcb7e7a677" class="i method">ReadAllBytes</a>(<span class="s">&quot;certificate.pfx&quot;</span>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">cerBase64</span> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#f9e5bd7b69c5f334" class="i method">ToBase64String</a>(<span class="r6 r">cer</span>);
 
                <a href="/Microsoft.Azure.KeyVault/A.html#17bb4008337c63b2" class="t t">CertificateBundle</a> <span id="r8 rd" class="r8 r">certificate</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#7b09294278d30e1a" class="i method">ImportCertificateAsync</a>(
                    <span class="s">&quot;https://myvault.vault.azure.net&quot;</span>,
                    <span class="s">&quot;certificate-name&quot;</span>,
                    <span class="r7 r">cerBase64</span>,
                    <span class="r9 r">certificatePolicy</span>: <span class="r3 r">policy</span>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_ImportCertificate
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_CreateSelfSignedPolicy
            <span class="c">//@@CertificatePolicy policy = new CertificatePolicy</span>
            <span class="c">/*@@*/</span>
            <span class="r3 r">policy</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#144276523ef55663" class="t constructor">CertificatePolicy</a>
            {
                <a href="/Microsoft.Azure.KeyVault/A.html#bb6228bf6bba8530" class="i property">IssuerParameters</a> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#300a4e72ff658324" class="t constructor">IssuerParameters</a>(<span class="s">&quot;Self&quot;</span>),
                <a href="/Microsoft.Azure.KeyVault/A.html#46bc8f22a51144e7" class="i property">X509CertificateProperties</a> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#dbf19a0f38624b14" class="t constructor">X509CertificateProperties</a>(<span class="s">&quot;CN=DefaultPolicy&quot;</span>)
            };
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_CreateSelfSignedPolicy
            <span class="c">// TODO</span>
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_ListCertificates
                <a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#8125b18f5d7ee303" class="t t">IPage</a>&lt;<a href="/Microsoft.Azure.KeyVault/A.html#d706c86ad039b5ab" class="t t">CertificateItem</a>&gt; <span id="r10 rd" class="r10 r">page</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#628683d08d470ebe" class="i method">GetCertificatesAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>);
                <b>foreach</b> (<a href="/Microsoft.Azure.KeyVault/A.html#d706c86ad039b5ab" class="t t">CertificateItem</a> <span id="r11 rd" class="r11 r">item</span> <b>in</b> <span class="r10 r">page</span>)
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#37025804043aa13b" class="t t">CertificateIdentifier</a> <span id="r12 rd" class="r12 r">certificateId</span> = <span class="r11 r">item</span>.<a href="/Microsoft.Azure.KeyVault/A.html#a9233083ccc4723f" class="i property">Identifier</a>;
                    <a href="/Microsoft.Azure.KeyVault/A.html#17bb4008337c63b2" class="t t">CertificateBundle</a> <span id="r13 rd" class="r13 r">certificate</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#92dda13fee99dd3f" class="i method">GetCertificateAsync</a>(<span class="r12 r">certificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r12 r">certificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
                }
 
                <b>while</b> (<span class="r10 r">page</span>.<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#e77457a6e30fcfe3" class="i property">NextPageLink</a> != <b>null</b>)
                {
                    <span class="r10 r">page</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#b9e584dd53ff84ef" class="i method">GetCertificatesNextAsync</a>(<span class="r10 r">page</span>.<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#e77457a6e30fcfe3" class="i property">NextPageLink</a>);
                    <b>foreach</b> (<a href="/Microsoft.Azure.KeyVault/A.html#d706c86ad039b5ab" class="t t">CertificateItem</a> <span id="r14 rd" class="r14 r">item</span> <b>in</b> <span class="r10 r">page</span>)
                    {
                        <a href="/Microsoft.Azure.KeyVault/A.html#37025804043aa13b" class="t t">CertificateIdentifier</a> <span id="r15 rd" class="r15 r">certificateId</span> = <span class="r14 r">item</span>.<a href="/Microsoft.Azure.KeyVault/A.html#a9233083ccc4723f" class="i property">Identifier</a>;
                        <a href="/Microsoft.Azure.KeyVault/A.html#17bb4008337c63b2" class="t t">CertificateBundle</a> <span id="r16 rd" class="r16 r">certificate</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#92dda13fee99dd3f" class="i method">GetCertificateAsync</a>(<span class="r15 r">certificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r15 r">certificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
                    }
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_ListCertificates
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_DeleteCertificate
                <span class="c">// Delete the certificate.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#4e8132c83a7cdbc6" class="t t">DeletedCertificateBundle</a> <span id="r17 rd" class="r17 r">deletedCertificate</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#1dfc62ae7bb6ff4e" class="i method">DeleteCertificateAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;certificate-name&quot;</span>);
 
                <span class="c">// Purge or recover the deleted certificate if soft delete is enabled.</span>
                <b>if</b> (<span class="r17 r">deletedCertificate</span>.<a href="/Microsoft.Azure.KeyVault/A.html#6c781261d8b70b4c" class="i property">RecoveryId</a> != <b>null</b>)
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#5b179431fc4b2cfa" class="t t">DeletedCertificateIdentifier</a> <span id="r18 rd" class="r18 r">deletedCertificateId</span> = <span class="r17 r">deletedCertificate</span>.<a href="/Microsoft.Azure.KeyVault/A.html#d8d3cf0eb914305e" class="i property">RecoveryIdentifier</a>;
 
                    <span class="c">// Deleting a certificate does not happen immediately. Wait a while and check if the deleted certificate exists.</span>
                    <b>while</b> (<b>true</b>)
                    {
                        <b>try</b>
                        {
                            <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#e212eb7e68ae531a" class="i method">GetDeletedCertificateAsync</a>(<span class="r18 r">deletedCertificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r18 r">deletedCertificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
 
                            <span class="c">// Finally deleted.</span>
                            <b>break</b>;
                        }
                        <b>catch</b> (<a href="/Microsoft.Azure.KeyVault/A.html#554e648dd6b0698c" class="t t">KeyVaultErrorException</a> <span id="r19 rd" class="r19 r">ex</span>) <b>when</b> (<span class="r19 r">ex</span>.<a href="/Microsoft.Azure.KeyVault/A.html#24568c7091f25a4b" class="i property">Response</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8160e7ac2a8f7438" class="i property">StatusCode</a> == <a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#35e0ca1b70dbcf0d" class="i field">NotFound</a>)
                        {
                            <span class="c">// Not yet deleted...</span>
                        }
                    }
 
                    <span class="c">// Purge the deleted certificate.</span>
                    <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#09606257523fe2db" class="i method">PurgeDeletedCertificateAsync</a>(<span class="r18 r">deletedCertificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r18 r">deletedCertificateId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
 
                    <span class="c">// You can also recover the deleted certificate using RecoverDeletedCertificateAsync.</span>
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Certificates_Snippets_MigrationGuide_DeleteCertificate
            }
        }
 
        <b>private async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="db23fd89cfdb4411" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">KeysMigrationGuide</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_Create
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#ea6a1ef5cdeceae1" class="t t">AzureServiceTokenProvider</a> <span id="r20 rd" class="r20 r">provider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#54507b306bcfc8b8" class="t constructor">AzureServiceTokenProvider</a>();
            <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a> <span id="r21 rd" class="r21 r">client</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#60b54be5c23641ea" class="t constructor">KeyVaultClient</a>(
                <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a>.<span class="t">AuthenticationCallback</span>(<span class="r20 r">provider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#fc3e2628440da92e" class="i property">KeyVaultTokenCallback</a>));
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_Create
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_CreateWithOptions
            <b>using</b> (<span class="t t">HttpClient</span> <span id="r22 rd" class="r22 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>())
            {
                <span class="c">//@@AzureServiceTokenProvider provider = new AzureServiceTokenProvider();</span>
                <span class="c">/*@@*/</span> <span class="r20 r">provider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#54507b306bcfc8b8" class="t constructor">AzureServiceTokenProvider</a>();
                <span class="c">//@@KeyVaultClient client = new KeyVaultClient(</span>
                <span class="c">/*@@*/</span> <span class="r21 r">client</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#174fa5426a6c06d7" class="t constructor">KeyVaultClient</a>(
                    <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a>.<span class="t">AuthenticationCallback</span>(<span class="r20 r">provider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#fc3e2628440da92e" class="i property">KeyVaultTokenCallback</a>),
                    <span class="r22 r">httpClient</span>);
            }
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_CreateWithOptions
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_CreateKey
                <span class="c">// Create RSA key.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#909ced96a9d00334" class="t t">NewKeyParameters</a> <span id="r23 rd" class="r23 r">createRsaParameters</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#451f06d1652ed30e" class="t constructor">NewKeyParameters</a>
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#22a404e991bd2f1d" class="i property">Kty</a> = <a href="/Microsoft.Azure.KeyVault.WebKey/A.html#c90001f143f0f6b2" class="t t">JsonWebKeyType</a>.<a href="/Microsoft.Azure.KeyVault.WebKey/A.html#cc9d39c080719cc8" class="i field">Rsa</a>,
                    <a href="/Microsoft.Azure.KeyVault/A.html#cc14e90a9e083b74" class="i property">KeySize</a> = 4096
                };
 
                <a href="/Microsoft.Azure.KeyVault/A.html#743f0f51eba1582c" class="t t">KeyBundle</a> <span id="r24 rd" class="r24 r">rsaKey</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#e26f40d537224048" class="i method">CreateKeyAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;rsa-key-name&quot;</span>, <span class="r23 r">createRsaParameters</span>);
 
                <span class="c">// Create Elliptic-Curve key.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#909ced96a9d00334" class="t t">NewKeyParameters</a> <span id="r25 rd" class="r25 r">createEcParameters</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#451f06d1652ed30e" class="t constructor">NewKeyParameters</a>
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#22a404e991bd2f1d" class="i property">Kty</a> = <a href="/Microsoft.Azure.KeyVault.WebKey/A.html#c90001f143f0f6b2" class="t t">JsonWebKeyType</a>.<a href="/Microsoft.Azure.KeyVault.WebKey/A.html#8ec62d93b4c095ea" class="i field">EllipticCurve</a>,
                    <a href="/Microsoft.Azure.KeyVault/A.html#75bafe0a0773b619" class="i property">CurveName</a> = <span class="s">&quot;P-256&quot;</span>
                };
 
                <a href="/Microsoft.Azure.KeyVault/A.html#743f0f51eba1582c" class="t t">KeyBundle</a> <span id="r26 rd" class="r26 r">ecKey</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#e26f40d537224048" class="i method">CreateKeyAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;ec-key-name&quot;</span>, <span class="r25 r">createEcParameters</span>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_CreateKey
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_ListKeys
                <a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#8125b18f5d7ee303" class="t t">IPage</a>&lt;<a href="/Microsoft.Azure.KeyVault/A.html#6472aadfda4bfd1c" class="t t">KeyItem</a>&gt; <span id="r27 rd" class="r27 r">page</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#bbc2547ab56a23bc" class="i method">GetKeysAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>);
                <b>foreach</b> (<a href="/Microsoft.Azure.KeyVault/A.html#6472aadfda4bfd1c" class="t t">KeyItem</a> <span id="r28 rd" class="r28 r">item</span> <b>in</b> <span class="r27 r">page</span>)
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#3ff6311593b8db9a" class="t t">KeyIdentifier</a> <span id="r29 rd" class="r29 r">keyId</span> = <span class="r28 r">item</span>.<a href="/Microsoft.Azure.KeyVault/A.html#30ee90480e14824c" class="i property">Identifier</a>;
                    <a href="/Microsoft.Azure.KeyVault/A.html#743f0f51eba1582c" class="t t">KeyBundle</a> <span id="r30 rd" class="r30 r">key</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#7283b8106e3b0a54" class="i method">GetKeyAsync</a>(<span class="r29 r">keyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r29 r">keyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
                }
 
                <b>while</b> (<span class="r27 r">page</span>.<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#e77457a6e30fcfe3" class="i property">NextPageLink</a> != <b>null</b>)
                {
                    <span class="r27 r">page</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#68908d206345a58c" class="i method">GetKeysNextAsync</a>(<span class="r27 r">page</span>.<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#e77457a6e30fcfe3" class="i property">NextPageLink</a>);
                    <b>foreach</b> (<a href="/Microsoft.Azure.KeyVault/A.html#6472aadfda4bfd1c" class="t t">KeyItem</a> <span id="r31 rd" class="r31 r">item</span> <b>in</b> <span class="r27 r">page</span>)
                    {
                        <a href="/Microsoft.Azure.KeyVault/A.html#3ff6311593b8db9a" class="t t">KeyIdentifier</a> <span id="r32 rd" class="r32 r">keyId</span> = <span class="r31 r">item</span>.<a href="/Microsoft.Azure.KeyVault/A.html#30ee90480e14824c" class="i property">Identifier</a>;
                        <a href="/Microsoft.Azure.KeyVault/A.html#743f0f51eba1582c" class="t t">KeyBundle</a> <span id="r33 rd" class="r33 r">key</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#7283b8106e3b0a54" class="i method">GetKeyAsync</a>(<span class="r32 r">keyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r32 r">keyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
                    }
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_ListKeys
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_DeleteKey
                <span class="c">// Delete the key.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#fd8cfd7e3c1c8b34" class="t t">DeletedKeyBundle</a> <span id="r34 rd" class="r34 r">deletedKey</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#335f4fcea9c611fe" class="i method">DeleteKeyAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;key-name&quot;</span>);
 
                <span class="c">// Purge or recover the deleted key if soft delete is enabled.</span>
                <b>if</b> (<span class="r34 r">deletedKey</span>.<a href="/Microsoft.Azure.KeyVault/A.html#93a66b823973f00d" class="i property">RecoveryId</a> != <b>null</b>)
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#f583257c740954f8" class="t t">DeletedKeyIdentifier</a> <span id="r35 rd" class="r35 r">deletedKeyId</span> = <span class="r34 r">deletedKey</span>.<a href="/Microsoft.Azure.KeyVault/A.html#b9d901d4a4216868" class="i property">RecoveryIdentifier</a>;
 
                    <span class="c">// Deleting a key does not happen immediately. Wait a while and check if the deleted key exists.</span>
                    <b>while</b> (<b>true</b>)
                    {
                        <b>try</b>
                        {
                            <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#94b481d56aebc00f" class="i method">GetDeletedKeyAsync</a>(<span class="r35 r">deletedKeyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r35 r">deletedKeyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
 
                            <span class="c">// Finally deleted.</span>
                            <b>break</b>;
                        }
                        <b>catch</b> (<a href="/Microsoft.Azure.KeyVault/A.html#554e648dd6b0698c" class="t t">KeyVaultErrorException</a> <span id="r36 rd" class="r36 r">ex</span>) <b>when</b> (<span class="r36 r">ex</span>.<a href="/Microsoft.Azure.KeyVault/A.html#24568c7091f25a4b" class="i property">Response</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8160e7ac2a8f7438" class="i property">StatusCode</a> == <a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#35e0ca1b70dbcf0d" class="i field">NotFound</a>)
                        {
                            <span class="c">// Not yet deleted...</span>
                        }
                    }
 
                    <span class="c">// Purge the deleted key.</span>
                    <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#43183fccf012c992" class="i method">PurgeDeletedKeyAsync</a>(<span class="r35 r">deletedKeyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r35 r">deletedKeyId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
 
                    <span class="c">// You can also recover the deleted key using RecoverDeletedKeyAsync.</span>
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_DeleteKey
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_Encrypt
                <span class="c">// Encrypt a message. The plaintext must be small enough for the chosen algorithm.</span>
                <b>byte</b>[] <span id="r37 rd" class="r37 r">plaintext</span> = <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="s">&quot;Small message to encrypt&quot;</span>);
                <a href="/Microsoft.Azure.KeyVault/A.html#e8a56d1906413280" class="t t">KeyOperationResult</a> <span id="r38 rd" class="r38 r">encrypted</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#4d9d92757adbec95" class="i method">EncryptAsync</a>(<span class="s">&quot;rsa-key-name&quot;</span>, <a href="/Microsoft.Azure.KeyVault.WebKey/A.html#da5d653fe0041231" class="t t">JsonWebKeyEncryptionAlgorithm</a>.<a href="/Microsoft.Azure.KeyVault.WebKey/A.html#c17fdc9b3de06f80" class="i field">RSAOAEP256</a>, <span class="r37 r">plaintext</span>);
 
                <span class="c">// Decrypt the message.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#e8a56d1906413280" class="t t">KeyOperationResult</a> <span id="r39 rd" class="r39 r">decrypted</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#c46e36a1a7f5d5bf" class="i method">DecryptAsync</a>(<span class="s">&quot;rsa-key-name&quot;</span>, <a href="/Microsoft.Azure.KeyVault.WebKey/A.html#da5d653fe0041231" class="t t">JsonWebKeyEncryptionAlgorithm</a>.<a href="/Microsoft.Azure.KeyVault.WebKey/A.html#c17fdc9b3de06f80" class="i field">RSAOAEP256</a>, <span class="r38 r">encrypted</span>.<a href="/Microsoft.Azure.KeyVault/A.html#692ad38bc3c57a20" class="i property">Result</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r40 rd" class="r40 r">message</span> = <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#7310c9cccfaecd17" class="i method">GetString</a>(<span class="r39 r">decrypted</span>.<a href="/Microsoft.Azure.KeyVault/A.html#692ad38bc3c57a20" class="i property">Result</a>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_Encrypt
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_Wrap
                <b>using</b> (<a href="@0@mscorlib/A.html#ddb5f33f82818174" class="t t">Aes</a> <span id="r41 rd" class="r41 r">aes</span> = <a href="@0@mscorlib/A.html#ddb5f33f82818174" class="t t">Aes</a>.<a href="@0@mscorlib/A.html#f7c32038963e5062" class="i method">Create</a>())
                {
                    <span class="c">// Use a symmetric key to encrypt large amounts of data, possibly streamed...</span>
 
                    <span class="c">// Now wrap the key and store the encrypted key and plaintext IV to later decrypt the key to decrypt the data.</span>
                    <a href="/Microsoft.Azure.KeyVault/A.html#e8a56d1906413280" class="t t">KeyOperationResult</a> <span id="r42 rd" class="r42 r">wrapped</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#5001dbaa04ec6311" class="i method">WrapKeyAsync</a>(
                        <span class="s">&quot;https://myvault.vault.azure.net&quot;</span>,
                        <span class="s">&quot;rsa-key-name&quot;</span>,
                        <b>null</b>,
                        <a href="/Microsoft.Azure.KeyVault.WebKey/A.html#da5d653fe0041231" class="t t">JsonWebKeyEncryptionAlgorithm</a>.<a href="/Microsoft.Azure.KeyVault.WebKey/A.html#c17fdc9b3de06f80" class="i field">RSAOAEP256</a>,
                        <span class="r41 r">aes</span>.<a href="@0@mscorlib/A.html#d12a38c78f5c3174" class="i property">Key</a>);
 
                    <span class="c">// Read the IV and the encrypted key from the payload, then unwrap the key.</span>
                    <a href="/Microsoft.Azure.KeyVault/A.html#e8a56d1906413280" class="t t">KeyOperationResult</a> <span id="r43 rd" class="r43 r">unwrapped</span> = <b>await</b> <span class="r21 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#fa27ac428806e838" class="i method">UnwrapKeyAsync</a>(
                        <span class="s">&quot;https://myvault.vault.azure.net&quot;</span>,
                        <span class="s">&quot;rsa-key-name&quot;</span>,
                        <b>null</b>,
                        <a href="/Microsoft.Azure.KeyVault.WebKey/A.html#da5d653fe0041231" class="t t">JsonWebKeyEncryptionAlgorithm</a>.<a href="/Microsoft.Azure.KeyVault.WebKey/A.html#c17fdc9b3de06f80" class="i field">RSAOAEP256</a>,
                        <span class="r42 r">wrapped</span>.<a href="/Microsoft.Azure.KeyVault/A.html#692ad38bc3c57a20" class="i property">Result</a>);
 
                    <span class="r41 r">aes</span>.<a href="@0@mscorlib/A.html#d12a38c78f5c3174" class="i property">Key</a> = <span class="r43 r">unwrapped</span>.<a href="/Microsoft.Azure.KeyVault/A.html#692ad38bc3c57a20" class="i property">Result</a>;
 
                    <span class="c">// Decrypt the payload with the symmetric key.</span>
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Keys_Snippets_MigrationGuide_Wrap
            }
        }
 
        <b>private async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="21275cb2c8bdf331" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SecretsMigrationGuide</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_Create
            <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#ea6a1ef5cdeceae1" class="t t">AzureServiceTokenProvider</a> <span id="r44 rd" class="r44 r">provider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#54507b306bcfc8b8" class="t constructor">AzureServiceTokenProvider</a>();
            <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a> <span id="r45 rd" class="r45 r">client</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#60b54be5c23641ea" class="t constructor">KeyVaultClient</a>(
                <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a>.<span class="t">AuthenticationCallback</span>(<span class="r44 r">provider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#fc3e2628440da92e" class="i property">KeyVaultTokenCallback</a>));
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_Create
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_CreateWithOptions
            <b>using</b> (<span class="t t">HttpClient</span> <span id="r46 rd" class="r46 r">httpClient</span> = <b>new</b> <span class="t constructor">HttpClient</span>())
            {
                <span class="c">//@@AzureServiceTokenProvider provider = new AzureServiceTokenProvider();</span>
                <span class="c">/*@@*/</span> <span class="r44 r">provider</span> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#54507b306bcfc8b8" class="t constructor">AzureServiceTokenProvider</a>();
                <span class="c">//@@KeyVaultClient client = new KeyVaultClient(</span>
                <span class="c">/*@@*/</span> <span class="r45 r">client</span> = <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#174fa5426a6c06d7" class="t constructor">KeyVaultClient</a>(
                    <b>new</b> <a href="/Microsoft.Azure.KeyVault/A.html#7dc00214e066e5ca" class="t t">KeyVaultClient</a>.<span class="t">AuthenticationCallback</span>(<span class="r44 r">provider</span>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#fc3e2628440da92e" class="i property">KeyVaultTokenCallback</a>),
                    <span class="r46 r">httpClient</span>);
            }
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_CreateWithOptions
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_SetSecret
                <a href="/Microsoft.Azure.KeyVault/A.html#15b4a290938630b9" class="t t">SecretBundle</a> <span id="r47 rd" class="r47 r">secret</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#ab03bc4063ebca80" class="i method">SetSecretAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;secret-name&quot;</span>, <span class="s">&quot;secret-value&quot;</span>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_SetSecret
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_GetSecret
                <span class="c">// Get the latest secret value.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#15b4a290938630b9" class="t t">SecretBundle</a> <span id="r48 rd" class="r48 r">secret</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#911c9fa5b820c535" class="i method">GetSecretAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;secret-name&quot;</span>, <b>null</b>);
 
                <span class="c">// Get a specific secret value.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#15b4a290938630b9" class="t t">SecretBundle</a> <span id="r49 rd" class="r49 r">secretVersion</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#911c9fa5b820c535" class="i method">GetSecretAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;secret-name&quot;</span>, <a href="../GuidAssembly/R/e43af03a-7cbc-47d4-a4e9-f11540186048.html" target="n" class="s">&quot;e43af03a7cbc47d4a4e9f11540186048&quot;</a>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_GetSecret
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_ListSecrets
                <a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#8125b18f5d7ee303" class="t t">IPage</a>&lt;<a href="/Microsoft.Azure.KeyVault/A.html#41cb9d6b42053675" class="t t">SecretItem</a>&gt; <span id="r50 rd" class="r50 r">page</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#8f4783acd3aca343" class="i method">GetSecretsAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>);
                <b>foreach</b> (<a href="/Microsoft.Azure.KeyVault/A.html#41cb9d6b42053675" class="t t">SecretItem</a> <span id="r51 rd" class="r51 r">item</span> <b>in</b> <span class="r50 r">page</span>)
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#c63c1ae25fffbdcf" class="t t">SecretIdentifier</a> <span id="r52 rd" class="r52 r">secretId</span> = <span class="r51 r">item</span>.<a href="/Microsoft.Azure.KeyVault/A.html#2fb94b4bead35cd5" class="i property">Identifier</a>;
                    <a href="/Microsoft.Azure.KeyVault/A.html#15b4a290938630b9" class="t t">SecretBundle</a> <span id="r53 rd" class="r53 r">secret</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#69e388f97284f19a" class="i method">GetSecretAsync</a>(<span class="r52 r">secretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r52 r">secretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
                }
 
                <b>while</b> (<span class="r50 r">page</span>.<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#e77457a6e30fcfe3" class="i property">NextPageLink</a> != <b>null</b>)
                {
                    <span class="r50 r">page</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#4f183cacbec96b1f" class="i method">GetSecretsNextAsync</a>(<span class="r50 r">page</span>.<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#e77457a6e30fcfe3" class="i property">NextPageLink</a>);
                    <b>foreach</b> (<a href="/Microsoft.Azure.KeyVault/A.html#41cb9d6b42053675" class="t t">SecretItem</a> <span id="r54 rd" class="r54 r">item</span> <b>in</b> <span class="r50 r">page</span>)
                    {
                        <a href="/Microsoft.Azure.KeyVault/A.html#c63c1ae25fffbdcf" class="t t">SecretIdentifier</a> <span id="r55 rd" class="r55 r">secretId</span> = <span class="r54 r">item</span>.<a href="/Microsoft.Azure.KeyVault/A.html#2fb94b4bead35cd5" class="i property">Identifier</a>;
                        <a href="/Microsoft.Azure.KeyVault/A.html#15b4a290938630b9" class="t t">SecretBundle</a> <span id="r56 rd" class="r56 r">secret</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#69e388f97284f19a" class="i method">GetSecretAsync</a>(<span class="r55 r">secretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r55 r">secretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
                    }
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_ListSecrets
            }
 
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_DeleteSecret
                <span class="c">// Delete the secret.</span>
                <a href="/Microsoft.Azure.KeyVault/A.html#8c4628c62639b9f0" class="t t">DeletedSecretBundle</a> <span id="r57 rd" class="r57 r">deletedSecret</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#af6c3fb426a1155a" class="i method">DeleteSecretAsync</a>(<span class="s">&quot;https://myvault.vault.azure.net&quot;</span>, <span class="s">&quot;secret-name&quot;</span>);
 
                <span class="c">// Purge or recover the deleted secret if soft delete is enabled.</span>
                <b>if</b> (<span class="r57 r">deletedSecret</span>.<a href="/Microsoft.Azure.KeyVault/A.html#121efa0b54e958e6" class="i property">RecoveryId</a> != <b>null</b>)
                {
                    <a href="/Microsoft.Azure.KeyVault/A.html#62deb369607f3f5e" class="t t">DeletedSecretIdentifier</a> <span id="r58 rd" class="r58 r">deletedSecretId</span> = <span class="r57 r">deletedSecret</span>.<a href="/Microsoft.Azure.KeyVault/A.html#594cae6ddeeb6732" class="i property">RecoveryIdentifier</a>;
 
                    <span class="c">// Deleting a secret does not happen immediately. Wait a while and check if the deleted secret exists.</span>
                    <b>while</b> (<b>true</b>)
                    {
                        <b>try</b>
                        {
                            <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#7187ca84df97690a" class="i method">GetDeletedSecretAsync</a>(<span class="r58 r">deletedSecretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r58 r">deletedSecretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
 
                            <span class="c">// Finally deleted.</span>
                            <b>break</b>;
                        }
                        <b>catch</b> (<a href="/Microsoft.Azure.KeyVault/A.html#554e648dd6b0698c" class="t t">KeyVaultErrorException</a> <span id="r59 rd" class="r59 r">ex</span>) <b>when</b> (<span class="r59 r">ex</span>.<a href="/Microsoft.Azure.KeyVault/A.html#24568c7091f25a4b" class="i property">Response</a>.<a href="/Microsoft.Rest.ClientRuntime/A.html#8160e7ac2a8f7438" class="i property">StatusCode</a> == <a href="@0@System/A.html#9b95c882b40ef96e" class="t t">HttpStatusCode</a>.<a href="@0@System/A.html#35e0ca1b70dbcf0d" class="i field">NotFound</a>)
                        {
                            <span class="c">// Not yet deleted...</span>
                        }
                    }
 
                    <span class="c">// Purge the deleted secret.</span>
                    <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.KeyVault/A.html#b5ae1223f0a3c8b9" class="i method">PurgeDeletedSecretAsync</a>(<span class="r58 r">deletedSecretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#08ef7ec7f118860b" class="i property">Vault</a>, <span class="r58 r">deletedSecretId</span>.<a href="/Microsoft.Azure.KeyVault/A.html#16cf181322c94363" class="i property">Name</a>);
 
                    <span class="c">// You can also recover the deleted secret using RecoverDeletedSecretAsync.</span>
                }
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Microsoft_Azure_KeyVault_Secrets_Snippets_MigrationGuide_DeleteSecret
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
