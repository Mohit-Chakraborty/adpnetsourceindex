<!DOCTYPE html>
<html><head><title>GraphHelper.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(207);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Services.AppAuthentication.IntegrationTests/Helpers/GraphHelper.cs" target="_top">Helpers\GraphHelper.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/mgmtcommon/AppAuthentication/Azure.Services.AppAuthentication.IntegrationTests/Helpers/GraphHelper.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Services.AppAuthentication.IntegrationTests" target="_top">Microsoft.Azure.Services.AppAuthentication.IntegrationTests.csproj</a> (Microsoft.Azure.Services.AppAuthentication.IntegrationTests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>.<span class="i n">Headers</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>.<span class="i n">X509Certificates</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">IntegrationTests</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">TestCommon</span>;
<b>using</b> <span class="i n">Newtonsoft</span>.<span class="i n">Json</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Services</span>.<span class="i n">AppAuthentication</span>.<span class="i n">IntegrationTests</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Used to create service principalls and Azure AD applications to test if AzureServiceTokenProvider can get tokens using these App credentials. </span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="3b7b53031168e5ba" href="../R/3b7b53031168e5ba.html" target="n" data-glyph="0,0" class="t t">GraphHelper</a>
    {
        <b>private readonly string</b> <a id="8225d85c27026ed9" href="../R/8225d85c27026ed9.html" target="n" data-glyph="46,1" class="i field">_directory</a>;
        <b>private readonly</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#ea6a1ef5cdeceae1" class="t t">AzureServiceTokenProvider</a> <a id="2d9b1845caea96f3" href="../R/2d9b1845caea96f3.html" target="n" data-glyph="46,1" class="i field">_azureServiceTokenProvider</a>;
 
        <b>public</b> <a id="42440f5fa658750e" href="../R/42440f5fa658750e.html" target="n" data-glyph="72,1" class="t constructor">GraphHelper</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">directory</span>)
        {
            <a href="#8225d85c27026ed9" class="i field">_directory</a> = <span class="r0 r">directory</span>;
            <a href="#2d9b1845caea96f3" class="i field">_azureServiceTokenProvider</a> = <b>new</b> <a href="/Microsoft.Azure.Services.AppAuthentication/A.html#78632484199b0ed0" class="t constructor">AzureServiceTokenProvider</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4f99f8d18c3e270c" class="i field">AzureCliConnectionString</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create Azure AD application with Password credential. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">secret</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a>&gt; <a id="e0b63637e5478c68" href="../R/e0b63637e5478c68.html" target="n" data-glyph="72,1" class="i method">CreateApplicationAsync</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">secret</span>)
        {
            <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r2 rd" class="r2 r">guid</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>();
 
            <a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a> <span id="r3 rd" class="r3 r">newApp</span> = <b>new</b> <a href="../Models/Application.cs.html#5422a18bee141126" class="t constructor">Application</a>
            {
                <a href="../Models/Application.cs.html#afba31c400625d9b" class="i property">DisplayName</a> = <span class="s">$&quot;</span><span class="s">Microsoft.Azure.Services.AppAuthentication.Test</span>{<span class="r2 r">guid</span>}<span class="s">&quot;</span>,
                <a href="../Models/Application.cs.html#769bd498c7b81452" class="i property">IdentifierUris</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; { <span class="s">$&quot;</span><span class="s">https://Microsoft.Azure.Services.AppAuthentication/</span>{<span class="r2 r">guid</span>}<span class="s">&quot;</span> },
                <a href="../Models/Application.cs.html#517ae97bcec79c04" class="i property">ReplyUrls</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; { <span class="s">&quot;https://Microsoft.Azure.Services.AppAuthentication/&quot;</span> },
                <a href="../Models/Application.cs.html#54f80c73907e8221" class="i property">OdataType</a> = <span class="s">&quot;Microsoft.DirectoryServices.Application&quot;</span>,
                <a href="../Models/Application.cs.html#dbea6064a8a2279c" class="i property">AppRolesODataType</a> = <span class="s">&quot;Collection(Microsoft.DirectoryServices.AppRole)&quot;</span>,
                <a href="../Models/Application.cs.html#b0bf7fbfd374b7e2" class="i property">IdentifierUrisODataType</a> = <span class="s">&quot;Collection(Edm.String)&quot;</span>,
                <a href="../Models/Application.cs.html#f1cf6d6d70805d8e" class="i property">ReplyUrlsODdataType</a> = <span class="s">&quot;Collection(Edm.String)&quot;</span>,
                <a href="../Models/Application.cs.html#5c9133fbab621788" class="i property">PasswordCredentialsODdataType</a> = <span class="s">&quot;Collection(Microsoft.DirectoryServices.PasswordCredential)&quot;</span>
            };
 
            <a href="../Models/PasswordCredential.cs.html#b87b98d85fb53220" class="t t">PasswordCredential</a> <span id="r4 rd" class="r4 r">keyCredential</span> = <b>new</b> <a href="../Models/PasswordCredential.cs.html#b87b98d85fb53220" class="t constructor">PasswordCredential</a>
            {
                <a href="../Models/PasswordCredential.cs.html#83fc91d7e619999c" class="i property">Value</a> = <span class="r1 r">secret</span>,
                <a href="../Models/PasswordCredential.cs.html#5648672fea093953" class="i property">StartDate</a> = <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#1cd5dd408a32124f" class="i property">Now</a>,
                <a href="../Models/PasswordCredential.cs.html#d18feaab1d237d15" class="i property">EndDate</a> = <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#1cd5dd408a32124f" class="i property">Now</a>.<a href="@0@mscorlib/A.html#f5cb6edd98581ca2" class="i method">AddDays</a>(2)
            };
 
            <span class="r3 r">newApp</span>.<a href="../Models/Application.cs.html#8b2c88102bb67a17" class="i property">PasswordCredentials</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="../Models/PasswordCredential.cs.html#b87b98d85fb53220" class="t t">PasswordCredential</a>&gt; { <span class="r4 r">keyCredential</span> };
 
            <b>return</b> <b>await</b> <a href="#ba0f0b513833047f" class="i method">CreateApplication</a>(<span class="r3 r">newApp</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Create Azure AD application with cert as the key credential. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">cert</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a>&gt; <a id="ee3b61a1d0ec1258" href="../R/ee3b61a1d0ec1258.html" target="n" data-glyph="72,1" class="i method">CreateApplicationAsync</a>(<a href="@0@System/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r5 rd" class="r5 r">cert</span>)
        {
            <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r6 rd" class="r6 r">guid</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>();
 
            <a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a> <span id="r7 rd" class="r7 r">newApp</span> = <b>new</b> <a href="../Models/Application.cs.html#5422a18bee141126" class="t constructor">Application</a>
            {
                <a href="../Models/Application.cs.html#afba31c400625d9b" class="i property">DisplayName</a> = <span class="s">$&quot;</span><span class="s">Microsoft.Azure.Services.AppAuthentication.Test</span>{<span class="r6 r">guid</span>}<span class="s">&quot;</span>,
                <a href="../Models/Application.cs.html#769bd498c7b81452" class="i property">IdentifierUris</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; { <span class="s">$&quot;</span><span class="s">https://localhost/demo/</span>{<span class="r6 r">guid</span>}<span class="s">&quot;</span> },
                <a href="../Models/Application.cs.html#517ae97bcec79c04" class="i property">ReplyUrls</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; { <span class="s">&quot;https://localhost/demo&quot;</span> },
                <a href="../Models/Application.cs.html#54f80c73907e8221" class="i property">OdataType</a> = <span class="s">&quot;Microsoft.DirectoryServices.Application&quot;</span>,
                <a href="../Models/Application.cs.html#dbea6064a8a2279c" class="i property">AppRolesODataType</a> = <span class="s">&quot;Collection(Microsoft.DirectoryServices.AppRole)&quot;</span>,
                <a href="../Models/Application.cs.html#b0bf7fbfd374b7e2" class="i property">IdentifierUrisODataType</a> = <span class="s">&quot;Collection(Edm.String)&quot;</span>,
                <a href="../Models/Application.cs.html#f1cf6d6d70805d8e" class="i property">ReplyUrlsODdataType</a> = <span class="s">&quot;Collection(Edm.String)&quot;</span>,
                <a href="../Models/Application.cs.html#b4251a0a500a2377" class="i property">KeyCredentialsODdataType</a> = <span class="s">&quot;Collection(Microsoft.DirectoryServices.KeyCredential)&quot;</span>
            };
 
            <a href="../Models/KeyCredential.cs.html#0f0b44dccfe0aeb6" class="t t">KeyCredential</a> <span id="r8 rd" class="r8 r">keyCredential</span> = <b>new</b> <a href="../Models/KeyCredential.cs.html#0f0b44dccfe0aeb6" class="t constructor">KeyCredential</a>
            {
                <a href="../Models/KeyCredential.cs.html#0a172008d2ec8ead" class="i property">Type</a> = <span class="s">&quot;AsymmetricX509Cert&quot;</span>,
                <a href="../Models/KeyCredential.cs.html#17e25a5727566441" class="i property">Usage</a> = <span class="s">&quot;Verify&quot;</span>,
                <a href="../Models/KeyCredential.cs.html#4c6557281d5fc5c7" class="i property">Value</a> = <a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#f9e5bd7b69c5f334" class="i method">ToBase64String</a>(<span class="r5 r">cert</span>.<a href="@0@mscorlib/A.html#d494f61d481d3919" class="i method">Export</a>(<a href="@0@mscorlib/A.html#4fe9b4e9dbc10220" class="t t">X509ContentType</a>.<a href="@0@mscorlib/A.html#a95270bada959cee" class="i field">Cert</a>)),
                <a href="../Models/KeyCredential.cs.html#af062b983c121f8a" class="i property">StartDate</a> = <span class="r5 r">cert</span>.<a href="@0@System/A.html#e3dec5ca024c7d14" class="i property">NotBefore</a>,
                <a href="../Models/KeyCredential.cs.html#003e67733aa89cd0" class="i property">EndDate</a> = <span class="r5 r">cert</span>.<a href="@0@System/A.html#0b24cd2e7cd99b75" class="i property">NotAfter</a>
            };
 
            <span class="r7 r">newApp</span>.<a href="../Models/Application.cs.html#86d8fc98bc9a57a8" class="i property">KeyCredentials</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="../Models/KeyCredential.cs.html#0f0b44dccfe0aeb6" class="t t">KeyCredential</a>&gt; { <span class="r8 r">keyCredential</span> };
 
            <b>return</b> <b>await</b> <a href="#ba0f0b513833047f" class="i method">CreateApplication</a>(<span class="r7 r">newApp</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Common method to create Azure AD application and service principal</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">newApp</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a>&gt; <a id="ba0f0b513833047f" href="../R/ba0f0b513833047f.html" target="n" data-glyph="76,1" class="i method">CreateApplication</a>(<a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a> <span id="r9 rd" class="r9 r">newApp</span>)
        {
            <a href="../Models/AppRole.cs.html#d6ee47b4b8d5629b" class="t t">AppRole</a> <span id="r10 rd" class="r10 r">appRole</span> = <b>new</b> <a href="../Models/AppRole.cs.html#d6ee47b4b8d5629b" class="t constructor">AppRole</a>
            {
                <a href="../Models/AppRole.cs.html#78ffdb3cfc51eb0c" class="i property">Id</a> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>(),
                <a href="../Models/AppRole.cs.html#2984a2b2e50a4dc6" class="i property">IsEnabled</a> = <b>true</b>,
                <a href="../Models/AppRole.cs.html#425cf8bb4fc9554d" class="i property">DisplayName</a> = <span class="s">&quot;Something&quot;</span>,
                <a href="../Models/AppRole.cs.html#899f49de9c66b706" class="i property">Description</a> = <span class="s">&quot;Anything&quot;</span>,
                <a href="../Models/AppRole.cs.html#1c08c1c868fb0c56" class="i property">Value</a> = <span class="s">&quot;policy.write&quot;</span>,
                <a href="../Models/AppRole.cs.html#a884d91b8c2ff990" class="i property">AllowedMemberTypes</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; { <span class="s">&quot;User&quot;</span> },
                <a href="../Models/AppRole.cs.html#01fd9d8c041a517c" class="i property">AllowedMemberTypesODataType</a> = <span class="s">&quot;Collection(Edm.String)&quot;</span>
            };
            <span class="r9 r">newApp</span>.<a href="../Models/Application.cs.html#c106565943d69e91" class="i property">AppRoles</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="../Models/AppRole.cs.html#d6ee47b4b8d5629b" class="t t">AppRole</a>&gt; { <span class="r10 r">appRole</span> };
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">content</span> = <span class="t t">JsonConvert</span>.<span class="i method">SerializeObject</span>(<span class="r9 r">newApp</span>, <span class="t t">Formatting</span>.<span class="i field">None</span>,
                <b>new</b> <span class="t constructor">JsonSerializerSettings</span>
                {
                    <span class="i property">NullValueHandling</span> = <span class="t t">NullValueHandling</span>.<span class="i field">Ignore</span>
                });
 
            <a href="../Models/Application.cs.html#5422a18bee141126" class="k">var</a> <span id="r12 rd" class="r12 r">createdApp</span> = <span class="t t">JsonConvert</span>.<span class="i method">DeserializeObject</span>&lt;<a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a>&gt;(<b>await</b> <a href="#7b1ac3a242d4d11b" class="i method">SendHttpRequest</a>(<span class="t t">HttpMethod</span>.<span class="i property">Post</span>,
                <span class="s">$&quot;</span>{<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4a71aea8e3c7400f" class="i field">GraphResourceId</a>}{<a href="#8225d85c27026ed9" class="i field">_directory</a>}<span class="s">/applications?api-version=1.6</span><span class="s">&quot;</span>,
                <b>new</b> <span class="t constructor">StringContent</span>(<span class="r11 r">content</span>, <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>, <span class="s">&quot;application/json&quot;</span>)).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>));
 
            <a href="../Models/ServicePrincipal.cs.html#124a32120214b384" class="t t">ServicePrincipal</a> <span id="r13 rd" class="r13 r">newServicePrincipal</span> = <b>new</b> <a href="../Models/ServicePrincipal.cs.html#124a32120214b384" class="t constructor">ServicePrincipal</a>
            {
                <a href="../Models/ServicePrincipal.cs.html#b5476e6c1384a559" class="i property">DisplayName</a> = <span class="r9 r">newApp</span>.<a href="../Models/Application.cs.html#afba31c400625d9b" class="i property">DisplayName</a>,
                <a href="../Models/ServicePrincipal.cs.html#6fe0b7d4ef398f09" class="i property">AccountEnabled</a> = <b>true</b>,
                <a href="../Models/ServicePrincipal.cs.html#5bfb851368e1b08a" class="i property">AppId</a> = <span class="r12 r">createdApp</span>.<a href="../Models/Application.cs.html#2592c149f5c1e450" class="i property">AppId</a>,
                <a href="../Models/ServicePrincipal.cs.html#5e0da1e17ccb2b98" class="i property">OdataType</a> = <span class="s">&quot;Microsoft.DirectoryServices.ServicePrincipal&quot;</span>
            };
 
            <a href="../Models/ServicePrincipal.cs.html#124a32120214b384" class="k">var</a> <span id="r14 rd" class="r14 r">servicePrincipal</span> = <span class="t t">JsonConvert</span>.<span class="i method">DeserializeObject</span>&lt;<a href="../Models/ServicePrincipal.cs.html#124a32120214b384" class="t t">ServicePrincipal</a>&gt;(<b>await</b> <a href="#7b1ac3a242d4d11b" class="i method">SendHttpRequest</a>(<span class="t t">HttpMethod</span>.<span class="i property">Post</span>,
                <span class="s">$&quot;</span>{<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4a71aea8e3c7400f" class="i field">GraphResourceId</a>}{<a href="#8225d85c27026ed9" class="i field">_directory</a>}<span class="s">/servicePrincipals?api-version=1.6</span><span class="s">&quot;</span>,
                <b>new</b> <span class="t constructor">StringContent</span>(<span class="t t">JsonConvert</span>.<span class="i method">SerializeObject</span>(<span class="r13 r">newServicePrincipal</span>), <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>, <span class="s">&quot;application/json&quot;</span>)).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>));
 
            <span class="r12 r">createdApp</span>.<a href="../Models/Application.cs.html#2df762933ac25a5c" class="i property">ServicePrincipal</a> = <span class="r14 r">servicePrincipal</span>;
 
            <b>return</b> <span class="r12 r">createdApp</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Delete application and service principal, once testing is done. </span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">app</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="58db0aeae030bd6e" href="../R/58db0aeae030bd6e.html" target="n" data-glyph="72,1" class="i method">DeleteApplicationAsync</a>(<a href="../Models/Application.cs.html#5422a18bee141126" class="t t">Application</a> <span id="r15 rd" class="r15 r">app</span>)
        {
            <b>await</b> <a href="#7b1ac3a242d4d11b" class="i method">SendHttpRequest</a>(<span class="t t">HttpMethod</span>.<span class="i property">Delete</span>,
                <span class="s">$&quot;</span>{<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4a71aea8e3c7400f" class="i field">GraphResourceId</a>}{<a href="#8225d85c27026ed9" class="i field">_directory</a>}<span class="s">/directoryObjects/</span>{<span class="r15 r">app</span>.<a href="../Models/Application.cs.html#2df762933ac25a5c" class="i property">ServicePrincipal</a>.<a href="../Models/ServicePrincipal.cs.html#c70812e1bf611be2" class="i property">ObjectId</a>}<span class="s">?api-version=1.6</span><span class="s">&quot;</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <b>await</b> <a href="#7b1ac3a242d4d11b" class="i method">SendHttpRequest</a>(<span class="t t">HttpMethod</span>.<span class="i property">Delete</span>,
                    <span class="s">$&quot;</span>{<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4a71aea8e3c7400f" class="i field">GraphResourceId</a>}{<a href="#8225d85c27026ed9" class="i field">_directory</a>}<span class="s">/applications/</span>{<span class="r15 r">app</span>.<a href="../Models/Application.cs.html#f40daf8c84479f00" class="i property">ObjectId</a>}<span class="s">?api-version=1.6</span><span class="s">&quot;</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Generic method to send http requests to Graph API</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">method</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">requestUrl</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">content</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="7b1ac3a242d4d11b" href="../R/7b1ac3a242d4d11b.html" target="n" data-glyph="76,1" class="i method">SendHttpRequest</a>(<span class="t t">HttpMethod</span> <span id="r16 rd" class="r16 r">method</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r17 rd" class="r17 r">requestUrl</span>,
            <span class="t t">HttpContent</span> <span id="r18 rd" class="r18 r">content</span> = <b>null</b>)
        {
            <span class="t t">HttpClient</span> <span id="r19 rd" class="r19 r">client</span> = <b>new</b> <span class="t constructor">HttpClient</span> { <span class="i property">Timeout</span> = <b>new</b> <a href="@0@mscorlib/A.html#22fd9aa3d49cf498" class="t constructor">TimeSpan</a>(0, 0, 20) };
 
            <span class="t t">HttpRequestMessage</span> <span id="r20 rd" class="r20 r">request</span> = <b>new</b> <span class="t constructor">HttpRequestMessage</span>(<span class="r16 r">method</span>, <span class="r17 r">requestUrl</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r21 rd" class="r21 r">accessToken</span> = <b>await</b> <a href="#2d9b1845caea96f3" class="i field">_azureServiceTokenProvider</a>.<a href="/Microsoft.Azure.Services.AppAuthentication/A.html#7440141aa26f324a" class="i method">GetAccessTokenAsync</a>(<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#552fe1d84947f9ce" class="t t">Constants</a>.<a href="/Microsoft.Azure.Services.AppAuthentication.TestCommon/A.html#4a71aea8e3c7400f" class="i field">GraphResourceId</a>, <a href="#8225d85c27026ed9" class="i field">_directory</a>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            <span class="r20 r">request</span>.<span class="i property">Headers</span>.<span class="i property">Authorization</span> = <b>new</b> <span class="t constructor">AuthenticationHeaderValue</span>(<span class="s">&quot;Bearer&quot;</span>, <span class="r21 r">accessToken</span>);
 
            <b>if</b> (<span class="r18 r">content</span> != <b>null</b>)
            {
                <span class="c">// HttpContent is disposed, so making a copy of it for use</span>
                <a href="@0@mscorlib/A.html#1a4dcb744a23ba6f" class="k">var</a> <span id="r22 rd" class="r22 r">ms</span> = <b>new</b> <a href="@0@mscorlib/A.html#d308091cc690e78d" class="t constructor">MemoryStream</a>();
 
                <b>await</b> <span class="r18 r">content</span>.<span class="i method">CopyToAsync</span>(<span class="r22 r">ms</span>).<a href="@0@mscorlib/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                <span class="r22 r">ms</span>.<a href="@0@mscorlib/A.html#ad08f8ca81a5a763" class="i property">Position</a> = 0;
                <span class="r20 r">request</span>.<span class="i property">Content</span> = <b>new</b> <span class="t constructor">StreamContent</span>(<span class="r22 r">ms</span>);
 
                <span class="c">// Copy the content headers</span>
                <b>if</b> (<span class="r18 r">content</span>.<span class="i property">Headers</span> != <b>null</b>)
                    <b>foreach</b> (<a href="@0@mscorlib/A.html#8585965bb176a426" class="k">var</a> <span id="r23 rd" class="r23 r">h</span> <b>in</b> <span class="r18 r">content</span>.<span class="i property">Headers</span>)
                        <span class="r20 r">request</span>.<span class="i property">Content</span>.<span class="i property">Headers</span>.<span class="i method">Add</span>(<span class="r23 r">h</span>.<a href="@0@mscorlib/A.html#f9d1c04feb1af032" class="i property">Key</a>, <span class="r23 r">h</span>.<a href="@0@mscorlib/A.html#38c0e86cc4b30170" class="i property">Value</a>);
            }
 
            <span class="t t">HttpResponseMessage</span> <span id="r24 rd" class="r24 r">response</span> = <b>await</b> <span class="r19 r">client</span>.<span class="i method">SendAsync</span>(<span class="r20 r">request</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r25 rd" class="r25 r">responseString</span> = <b>await</b> <span class="r24 r">response</span>.<span class="i property">Content</span>.<span class="i method">ReadAsStringAsync</span>();
 
            <b>if</b> (<span class="r24 r">response</span>.<span class="i property">IsSuccessStatusCode</span>)
            {
                <b>return</b> <span class="r25 r">responseString</span>;
            }
 
            <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<span class="s">$&quot;</span>{<span class="r24 r">response</span>.<span class="i property">StatusCode</span>}{<span class="r25 r">responseString</span>}<span class="s"> </span>{<span class="r24 r">response</span>.<span class="i property">ReasonPhrase</span>}<span class="s">&quot;</span>);
        }
 
    }
}</pre></td></tr></table></div></body></html>
