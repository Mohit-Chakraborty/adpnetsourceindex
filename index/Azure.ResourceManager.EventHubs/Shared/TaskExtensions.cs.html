<!DOCTYPE html>
<html><head><title>TaskExtensions.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(314);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.ResourceManager.EventHubs/Shared/TaskExtensions.cs" target="_top">Shared\TaskExtensions.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.ResourceManager.EventHubs" target="_top">Azure.ResourceManager.EventHubs.csproj</a> (Azure.ResourceManager.EventHubs)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">nullable</span> <span class="k preprocess">disable</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>
{
    <b>internal static class</b> <a id="b697c2964116e255" href="../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">TaskExtensions</a>
    {
        <b>public static</b> <a href="#f6326224d423b845" class="t t">WithCancellationTaskAwaitable</a> <a id="24394306d8e3a3e7" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">AwaitWithCancellation</a>(<b>this</b> <span class="i">Task</span> <span id="r0 rd" class="r0 r">task</span>, <span class="i">CancellationToken</span> <span id="r1 rd" class="r1 r">cancellationToken</span>)
            =&gt; <b>new</b> <a href="#371ba80423e00fd4" class="t constructor">WithCancellationTaskAwaitable</a>(<span class="r0 r">task</span>, <span class="r1 r">cancellationToken</span>);
 
        <b>public static</b> <a href="#a710ec326f285d3b" class="t t">WithCancellationTaskAwaitable</a>&lt;<span class="r2 r t">T</span>&gt; <a id="ce17b81fe66b5052" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">AwaitWithCancellation</a>&lt;<span id="r2 rd t" class="r2 r t">T</span>&gt;(<b>this</b> <span class="i">Task</span>&lt;<span class="r2 r t">T</span>&gt; <span id="r3 rd" class="r3 r">task</span>, <span class="i">CancellationToken</span> <span id="r4 rd" class="r4 r">cancellationToken</span>)
            =&gt; <b>new</b> <a href="#c69156c47a6ea82f" class="t constructor">WithCancellationTaskAwaitable</a>&lt;<span class="r2 r t">T</span>&gt;(<span class="r3 r">task</span>, <span class="r4 r">cancellationToken</span>);
 
        <b>public static</b> <a href="#78572dda1da352a9" class="t t">WithCancellationValueTaskAwaitable</a>&lt;<span class="r5 r t">T</span>&gt; <a id="59055a83cfc8a085" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">AwaitWithCancellation</a>&lt;<span id="r5 rd t" class="r5 r t">T</span>&gt;(<b>this</b> <span class="i">ValueTask</span>&lt;<span class="r5 r t">T</span>&gt; <span id="r6 rd" class="r6 r">task</span>, <span class="i">CancellationToken</span> <span id="r7 rd" class="r7 r">cancellationToken</span>)
            =&gt; <b>new</b> <a href="#581cf383889f6854" class="t constructor">WithCancellationValueTaskAwaitable</a>&lt;<span class="r5 r t">T</span>&gt;(<span class="r6 r">task</span>, <span class="r7 r">cancellationToken</span>);
 
        <b>public static</b> <span class="r8 r t">T</span> <a id="a6a37480b74641c2" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EnsureCompleted</a>&lt;<span id="r8 rd t" class="r8 r t">T</span>&gt;(<b>this</b> <span class="i">Task</span>&lt;<span class="r8 r t">T</span>&gt; <span id="r9 rd" class="r9 r">task</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <span class="i">VerifyTaskCompleted</span>(<span class="r9 r">task</span>.<span class="i">IsCompleted</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
            <b>return</b> <span class="r9 r">task</span>.<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
        }
 
        <b>public static void</b> <a id="e81c10d89e35d561" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EnsureCompleted</a>(<b>this</b> <span class="i">Task</span> <span id="r10 rd" class="r10 r">task</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <span class="i">VerifyTaskCompleted</span>(<span class="r10 r">task</span>.<span class="i">IsCompleted</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
            <span class="r10 r">task</span>.<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
        }
 
        <b>public static</b> <span class="r11 r t">T</span> <a id="3b06cea754bf956c" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EnsureCompleted</a>&lt;<span id="r11 rd t" class="r11 r t">T</span>&gt;(<b>this</b> <span class="i">ValueTask</span>&lt;<span class="r11 r t">T</span>&gt; <span id="r12 rd" class="r12 r">task</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <span class="i">VerifyTaskCompleted</span>(<span class="r12 r">task</span>.<span class="i">IsCompleted</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
            <b>return</b> <span class="r12 r">task</span>.<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
        }
 
        <b>public static void</b> <a id="a6247276d92b5e4a" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EnsureCompleted</a>(<b>this</b> <span class="i">ValueTask</span> <span id="r13 rd" class="r13 r">task</span>)
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
            <span class="i">VerifyTaskCompleted</span>(<span class="r13 r">task</span>.<span class="i">IsCompleted</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
            <span class="r13 r">task</span>.<span class="i">GetAwaiter</span>().<span class="i">GetResult</span>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0102</span> <span class="c">// Do not use GetAwaiter().GetResult(). Use the TaskExtensions.EnsureCompleted() extension method instead.</span>
        }
 
        <b>public static</b> <a href="#7100844c47e62c8c" class="t t">Enumerable</a>&lt;<span class="r14 r t">T</span>&gt; <a id="a7818582ffaae7be" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EnsureSyncEnumerable</a>&lt;<span id="r14 rd t" class="r14 r t">T</span>&gt;(<b>this</b> <span class="i">IAsyncEnumerable</span>&lt;<span class="r14 r t">T</span>&gt; <span id="r15 rd" class="r15 r">asyncEnumerable</span>) =&gt; <b>new</b> <a href="#04e17fcff1c6ae65" class="t constructor">Enumerable</a>&lt;<span class="r14 r t">T</span>&gt;(<span class="r15 r">asyncEnumerable</span>);
 
        <b>public static</b> <span class="i">ConfiguredValueTaskAwaitable</span>&lt;<span class="r16 r t">T</span>&gt; <a id="592f6f156d5768ec" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EnsureCompleted</a>&lt;<span id="r16 rd t" class="r16 r t">T</span>&gt;(<b>this</b> <span class="i">ConfiguredValueTaskAwaitable</span>&lt;<span class="r16 r t">T</span>&gt; <span id="r17 rd" class="r17 r">awaitable</span>, <b>bool</b> <span id="r18 rd" class="r18 r">async</span>)
        {
            <b>if</b> (!<span class="r18 r">async</span>)
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
                <span class="i">VerifyTaskCompleted</span>(<span class="r17 r">awaitable</span>.<span class="i">GetAwaiter</span>().<span class="i">IsCompleted</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
            <b>return</b> <span class="r17 r">awaitable</span>;
        }
 
        <b>public static</b> <span class="i">ConfiguredValueTaskAwaitable</span> <a id="02733d6a9b61020d" href="../R/../../0000000000.html" target="n" data-glyph="220,1" class="i method">EnsureCompleted</a>(<b>this</b> <span class="i">ConfiguredValueTaskAwaitable</span> <span id="r19 rd" class="r19 r">awaitable</span>, <b>bool</b> <span id="r20 rd" class="r20 r">async</span>)
        {
            <b>if</b> (!<span class="r20 r">async</span>)
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DEBUG</span>
                <span class="i">VerifyTaskCompleted</span>(<span class="r19 r">awaitable</span>.<span class="i">GetAwaiter</span>().<span class="i">IsCompleted</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
            <b>return</b> <span class="r19 r">awaitable</span>;
        }
 
        [<span class="i">Conditional</span>(<span class="s">&quot;DEBUG&quot;</span>)]
        <b>private static void</b> <a id="99ff37a7df15d033" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">VerifyTaskCompleted</a>(<b>bool</b> <span id="r21 rd" class="r21 r">isCompleted</span>)
        {
            <b>if</b> (!<span class="r21 r">isCompleted</span>)
            {
                <b>if</b> (<span class="i">Debugger</span>.<span class="i">IsAttached</span>)
                {
                    <span class="i">Debugger</span>.<span class="i">Break</span>();
                }
                <span class="c">// Throw an InvalidOperationException instead of using</span>
                <span class="c">// Debug.Assert because that brings down nUnit immediately</span>
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="s">&quot;Task is not completed&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Both </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#7100844c47e62c8c" class="t t">Enumerable</a>{<span class="r22 r t">T</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#f5451d1de33ccfe8" class="t t">Enumerator</a>{<span class="r23 r t">T</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> are defined as public structs so that foreach can use duck typing</span>
        <span class="c">///</span><span class="c"> to call </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#7100844c47e62c8c" class="t t">Enumerable</a>{<span class="r24 r t">T</span>}.<a href="#1f057f0555417d50" class="i method">GetEnumerator</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and avoid heap memory allocation.</span>
        <span class="c">///</span><span class="c"> Please don&#39;t delete this method and don&#39;t make these types private.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <b>public readonly struct</b> <a id="7100844c47e62c8c" href="../R/7100844c47e62c8c.html" target="n" data-glyph="108,1" class="t t"><span id="17674ce0ff5cabc3">Enumerable</span></a>&lt;<span id="r25 rd t" class="r25 r t">T</span>&gt; : <span class="i">IEnumerable</span>&lt;<span class="r25 r t">T</span>&gt;
        {
            <b>private readonly</b> <span class="i">IAsyncEnumerable</span>&lt;<span class="r25 r t">T</span>&gt; <a id="805c789ea2eb225b" href="../R/805c789ea2eb225b.html" target="n" data-glyph="46,2" class="i field">_asyncEnumerable</a>;
 
            <b>public</b> <a id="04e17fcff1c6ae65" href="../R/04e17fcff1c6ae65.html" target="n" data-glyph="72,2" class="t constructor">Enumerable</a>(<span class="i">IAsyncEnumerable</span>&lt;<span class="r25 r t">T</span>&gt; <span id="r26 rd" class="r26 r">asyncEnumerable</span>) =&gt; <a href="#805c789ea2eb225b" class="i field">_asyncEnumerable</a> = <span class="r26 r">asyncEnumerable</span>;
 
            <b>public</b> <a href="#f5451d1de33ccfe8" class="t t">Enumerator</a>&lt;<span class="r25 r t">T</span>&gt; <a id="1f057f0555417d50" href="../R/1f057f0555417d50.html" target="n" data-glyph="72,2" class="i method">GetEnumerator</a>() =&gt; <b>new</b> <span class="t">Enumerator</span>&lt;<span class="r25 r t">T</span>&gt;(<a href="#805c789ea2eb225b" class="i field">_asyncEnumerable</a>.<span class="i">GetAsyncEnumerator</span>());
 
            <span class="i">IEnumerator</span>&lt;<span class="r25 r t">T</span>&gt; <span class="i">IEnumerable</span>&lt;<span class="r25 r t">T</span>&gt;.<a id="83984bc142790d19" href="../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">GetEnumerator</a>() =&gt; <b>new</b> <span class="t">Enumerator</span>&lt;<span class="r25 r t">T</span>&gt;(<a href="#805c789ea2eb225b" class="i field">_asyncEnumerable</a>.<span class="i">GetAsyncEnumerator</span>());
 
            <span class="i">IEnumerator</span> <span class="i">IEnumerable</span>.<a id="325bcc7e23d34f97" href="../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">GetEnumerator</a>() =&gt; <a href="#1f057f0555417d50" class="i method">GetEnumerator</a>();
        }
 
        <b>public readonly struct</b> <a id="f5451d1de33ccfe8" href="../R/f5451d1de33ccfe8.html" target="n" data-glyph="108,1" class="t t"><span id="0a0d7a5869518e36">Enumerator</span></a>&lt;<span id="r27 rd t" class="r27 r t">T</span>&gt; : <span class="i">IEnumerator</span>&lt;<span class="r27 r t">T</span>&gt;
        {
            <b>private readonly</b> <span class="i">IAsyncEnumerator</span>&lt;<span class="r27 r t">T</span>&gt; <a id="ad363244d1a0acca" href="../R/ad363244d1a0acca.html" target="n" data-glyph="46,2" class="i field">_asyncEnumerator</a>;
 
            <b>public</b> <a id="9ef6031ad88c6330" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">Enumerator</a>(<span class="i">IAsyncEnumerator</span>&lt;<span class="r27 r t">T</span>&gt; <span id="r28 rd" class="r28 r">asyncEnumerator</span>) =&gt; <a href="#ad363244d1a0acca" class="i field">_asyncEnumerator</a> = <span class="r28 r">asyncEnumerator</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0107</span> <span class="c">// Do not call public asynchronous method in synchronous scope.</span>
            <b>public bool</b> <a id="8debfdb50d31a087" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">MoveNext</a>() =&gt; <a href="#ad363244d1a0acca" class="i field">_asyncEnumerator</a>.<span class="i">MoveNextAsync</span>().<span class="i">EnsureCompleted</span>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0107</span> <span class="c">// Do not call public asynchronous method in synchronous scope.</span>
 
            <b>public void</b> <a id="55d5ad8fe58dd833" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Reset</a>() =&gt; <b>throw</b> <b>new</b> <span class="i">NotSupportedException</span>(<span class="s">$&quot;</span>{<span class="i">GetType</span>()}<span class="s"> is a synchronous wrapper for </span>{<a href="#ad363244d1a0acca" class="i field">_asyncEnumerator</a>.<span class="i">GetType</span>()}<span class="s"> async enumerator, which can&#39;t be reset, so IEnumerable.Reset() calls aren&#39;t supported.</span><span class="s">&quot;</span>);
 
            <b>public</b> <span class="r27 r t">T</span> <a id="8b9c930be5735e07" href="../R/8b9c930be5735e07.html" target="n" data-glyph="102,2" class="i property">Current</a> =&gt; <a href="#ad363244d1a0acca" class="i field">_asyncEnumerator</a>.<span class="i">Current</span>;
 
            <b>object</b> <span class="i">IEnumerator</span>.<a id="f8d9d8b824b8b0fc" href="../R/../../0000000000.html" target="n" data-glyph="106,2" class="i property">Current</a> =&gt; <a href="#8b9c930be5735e07" class="i property">Current</a>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">AZC0107</span> <span class="c">// Do not call public asynchronous method in synchronous scope.</span>
            <b>public void</b> <a id="184b019e8395d49d" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">Dispose</a>() =&gt; <a href="#ad363244d1a0acca" class="i field">_asyncEnumerator</a>.<span class="i">DisposeAsync</span>().<span class="i">EnsureCompleted</span>();
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">AZC0107</span> <span class="c">// Do not call public asynchronous method in synchronous scope.</span>
        }
 
        <b>public readonly struct</b> <a id="f6326224d423b845" href="../R/f6326224d423b845.html" target="n" data-glyph="108,1" class="t t"><span id="a8e3cc3ffa5480aa">WithCancellationTaskAwaitable</span></a>
        {
            <b>private readonly</b> <span class="i">CancellationToken</span> <a id="35e3bc55fa4ddbe1" href="../R/35e3bc55fa4ddbe1.html" target="n" data-glyph="46,2" class="i field">_cancellationToken</a>;
            <b>private readonly</b> <span class="i">ConfiguredTaskAwaitable</span> <a id="889eefe08b091cdf" href="../R/889eefe08b091cdf.html" target="n" data-glyph="46,2" class="i field">_awaitable</a>;
 
            <b>public</b> <a id="371ba80423e00fd4" href="../R/371ba80423e00fd4.html" target="n" data-glyph="72,2" class="t constructor">WithCancellationTaskAwaitable</a>(<span class="i">Task</span> <span id="r29 rd" class="r29 r">task</span>, <span class="i">CancellationToken</span> <span id="r30 rd" class="r30 r">cancellationToken</span>)
            {
                <a href="#889eefe08b091cdf" class="i field">_awaitable</a> = <span class="r29 r">task</span>.<span class="i">ConfigureAwait</span>(<b>false</b>);
                <a href="#35e3bc55fa4ddbe1" class="i field">_cancellationToken</a> = <span class="r30 r">cancellationToken</span>;
            }
 
            <b>public</b> <a href="#cdb6fd37569d4d73" class="t t">WithCancellationTaskAwaiter</a> <a id="eb6044c6b30f887e" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetAwaiter</a>() =&gt; <b>new</b> <span class="t">WithCancellationTaskAwaiter</span>(<a href="#889eefe08b091cdf" class="i field">_awaitable</a>.<span class="i">GetAwaiter</span>(), <a href="#35e3bc55fa4ddbe1" class="i field">_cancellationToken</a>);
        }
 
        <b>public readonly struct</b> <a id="a710ec326f285d3b" href="../R/a710ec326f285d3b.html" target="n" data-glyph="108,1" class="t t"><span id="e15349fcd7adfadc">WithCancellationTaskAwaitable</span></a>&lt;<span id="r31 rd t" class="r31 r t">T</span>&gt;
        {
            <b>private readonly</b> <span class="i">CancellationToken</span> <a id="541b93f20a961e6d" href="../R/541b93f20a961e6d.html" target="n" data-glyph="46,2" class="i field">_cancellationToken</a>;
            <b>private readonly</b> <span class="i">ConfiguredTaskAwaitable</span>&lt;<span class="r31 r t">T</span>&gt; <a id="62e6e8ce35e3f03b" href="../R/62e6e8ce35e3f03b.html" target="n" data-glyph="46,2" class="i field">_awaitable</a>;
 
            <b>public</b> <a id="c69156c47a6ea82f" href="../R/c69156c47a6ea82f.html" target="n" data-glyph="72,2" class="t constructor">WithCancellationTaskAwaitable</a>(<span class="i">Task</span>&lt;<span class="r31 r t">T</span>&gt; <span id="r32 rd" class="r32 r">task</span>, <span class="i">CancellationToken</span> <span id="r33 rd" class="r33 r">cancellationToken</span>)
            {
                <a href="#62e6e8ce35e3f03b" class="i field">_awaitable</a> = <span class="r32 r">task</span>.<span class="i">ConfigureAwait</span>(<b>false</b>);
                <a href="#541b93f20a961e6d" class="i field">_cancellationToken</a> = <span class="r33 r">cancellationToken</span>;
            }
 
            <b>public</b> <a href="#c4c59c87b75f98ac" class="t t">WithCancellationTaskAwaiter</a>&lt;<span class="r31 r t">T</span>&gt; <a id="82217a3b78754c22" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetAwaiter</a>() =&gt; <b>new</b> <span class="t">WithCancellationTaskAwaiter</span>&lt;<span class="r31 r t">T</span>&gt;(<a href="#62e6e8ce35e3f03b" class="i field">_awaitable</a>.<span class="i">GetAwaiter</span>(), <a href="#541b93f20a961e6d" class="i field">_cancellationToken</a>);
        }
 
        <b>public readonly struct</b> <a id="78572dda1da352a9" href="../R/78572dda1da352a9.html" target="n" data-glyph="108,1" class="t t"><span id="a55191593a0ff3b0">WithCancellationValueTaskAwaitable</span></a>&lt;<span id="r34 rd t" class="r34 r t">T</span>&gt;
        {
            <b>private readonly</b> <span class="i">CancellationToken</span> <a id="425c70972bae371c" href="../R/425c70972bae371c.html" target="n" data-glyph="46,2" class="i field">_cancellationToken</a>;
            <b>private readonly</b> <span class="i">ConfiguredValueTaskAwaitable</span>&lt;<span class="r34 r t">T</span>&gt; <a id="41a86828ff9df81e" href="../R/41a86828ff9df81e.html" target="n" data-glyph="46,2" class="i field">_awaitable</a>;
 
            <b>public</b> <a id="581cf383889f6854" href="../R/581cf383889f6854.html" target="n" data-glyph="72,2" class="t constructor">WithCancellationValueTaskAwaitable</a>(<span class="i">ValueTask</span>&lt;<span class="r34 r t">T</span>&gt; <span id="r35 rd" class="r35 r">task</span>, <span class="i">CancellationToken</span> <span id="r36 rd" class="r36 r">cancellationToken</span>)
            {
                <a href="#41a86828ff9df81e" class="i field">_awaitable</a> = <span class="r35 r">task</span>.<span class="i">ConfigureAwait</span>(<b>false</b>);
                <a href="#425c70972bae371c" class="i field">_cancellationToken</a> = <span class="r36 r">cancellationToken</span>;
            }
 
            <b>public</b> <a href="#3f4fa91fc51b6714" class="t t">WithCancellationValueTaskAwaiter</a>&lt;<span class="r34 r t">T</span>&gt; <a id="6b661a93909a1ad2" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetAwaiter</a>() =&gt; <b>new</b> <span class="t">WithCancellationValueTaskAwaiter</span>&lt;<span class="r34 r t">T</span>&gt;(<a href="#41a86828ff9df81e" class="i field">_awaitable</a>.<span class="i">GetAwaiter</span>(), <a href="#425c70972bae371c" class="i field">_cancellationToken</a>);
        }
 
        <b>public readonly struct</b> <a id="cdb6fd37569d4d73" href="../R/cdb6fd37569d4d73.html" target="n" data-glyph="108,1" class="t t"><span id="624ce1b3b65dbac6">WithCancellationTaskAwaiter</span></a> : <span class="i">ICriticalNotifyCompletion</span>
        {
            <b>private readonly</b> <span class="i">CancellationToken</span> <a id="5311e614813dbf9f" href="../R/5311e614813dbf9f.html" target="n" data-glyph="46,2" class="i field">_cancellationToken</a>;
            <b>private readonly</b> <span class="i">ConfiguredTaskAwaitable</span>.<span class="i">ConfiguredTaskAwaiter</span> <a id="1b7a8b6566fd0968" href="../R/1b7a8b6566fd0968.html" target="n" data-glyph="46,2" class="i field">_taskAwaiter</a>;
 
            <b>public</b> <a id="173b79b54823baae" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">WithCancellationTaskAwaiter</a>(<span class="i">ConfiguredTaskAwaitable</span>.<span class="i">ConfiguredTaskAwaiter</span> <span id="r37 rd" class="r37 r">awaiter</span>, <span class="i">CancellationToken</span> <span id="r38 rd" class="r38 r">cancellationToken</span>)
            {
                <a href="#1b7a8b6566fd0968" class="i field">_taskAwaiter</a> = <span class="r37 r">awaiter</span>;
                <a href="#5311e614813dbf9f" class="i field">_cancellationToken</a> = <span class="r38 r">cancellationToken</span>;
            }
 
            <b>public bool</b> <a id="80cc968c3398a5c1" href="../R/80cc968c3398a5c1.html" target="n" data-glyph="102,2" class="i property">IsCompleted</a> =&gt; <a href="#1b7a8b6566fd0968" class="i field">_taskAwaiter</a>.<span class="i">IsCompleted</span> || <a href="#5311e614813dbf9f" class="i field">_cancellationToken</a>.<span class="i">IsCancellationRequested</span>;
 
            <b>public void</b> <a id="a6de3c1886e16d7d" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">OnCompleted</a>(<span class="i">Action</span> <span id="r39 rd" class="r39 r">continuation</span>) =&gt; <a href="#1b7a8b6566fd0968" class="i field">_taskAwaiter</a>.<span class="i">OnCompleted</span>(<a href="#baadf68b9ed7f237" class="i method">WrapContinuation</a>(<span class="r39 r">continuation</span>));
 
            <b>public void</b> <a id="731194ac7c8bc843" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">UnsafeOnCompleted</a>(<span class="i">Action</span> <span id="r40 rd" class="r40 r">continuation</span>) =&gt; <a href="#1b7a8b6566fd0968" class="i field">_taskAwaiter</a>.<span class="i">UnsafeOnCompleted</span>(<a href="#baadf68b9ed7f237" class="i method">WrapContinuation</a>(<span class="r40 r">continuation</span>));
 
            <b>public void</b> <a id="d1026ba15b4b764a" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetResult</a>()
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#80cc968c3398a5c1" class="i property">IsCompleted</a>);
                <b>if</b> (!<a href="#1b7a8b6566fd0968" class="i field">_taskAwaiter</a>.<span class="i">IsCompleted</span>)
                {
                    <a href="#5311e614813dbf9f" class="i field">_cancellationToken</a>.<span class="i">ThrowIfCancellationRequested</span>();
                }
                <a href="#1b7a8b6566fd0968" class="i field">_taskAwaiter</a>.<span class="i">GetResult</span>();
            }
 
            <b>private</b> <span class="i">Action</span> <a id="baadf68b9ed7f237" href="../R/baadf68b9ed7f237.html" target="n" data-glyph="76,2" class="i method">WrapContinuation</a>(<b>in</b> <span class="i">Action</span> <span id="r41 rd" class="r41 r">originalContinuation</span>)
                =&gt; <a href="#5311e614813dbf9f" class="i field">_cancellationToken</a>.<span class="i">CanBeCanceled</span>
                    ? <b>new</b> <a href="#b4f9fbea19b6f261" class="t constructor">WithCancellationContinuationWrapper</a>(<span class="r41 r">originalContinuation</span>, <a href="#5311e614813dbf9f" class="i field">_cancellationToken</a>).<a href="#4e22611eb7944971" class="i property">Continuation</a>
                    : <span class="r41 r">originalContinuation</span>;
        }
 
        <b>public readonly struct</b> <a id="c4c59c87b75f98ac" href="../R/c4c59c87b75f98ac.html" target="n" data-glyph="108,1" class="t t"><span id="4859dfb505500ace">WithCancellationTaskAwaiter</span></a>&lt;<span id="r42 rd t" class="r42 r t">T</span>&gt; : <span class="i">ICriticalNotifyCompletion</span>
        {
            <b>private readonly</b> <span class="i">CancellationToken</span> <a id="eaf27e77de4c3ad9" href="../R/eaf27e77de4c3ad9.html" target="n" data-glyph="46,2" class="i field">_cancellationToken</a>;
            <b>private readonly</b> <span class="i">ConfiguredTaskAwaitable</span>&lt;<span class="r42 r t">T</span>&gt;.<span class="i">ConfiguredTaskAwaiter</span> <a id="055de58961fe433b" href="../R/055de58961fe433b.html" target="n" data-glyph="46,2" class="i field">_taskAwaiter</a>;
 
            <b>public</b> <a id="7fe9392775cafac5" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">WithCancellationTaskAwaiter</a>(<span class="i">ConfiguredTaskAwaitable</span>&lt;<span class="r42 r t">T</span>&gt;.<span class="i">ConfiguredTaskAwaiter</span> <span id="r43 rd" class="r43 r">awaiter</span>, <span class="i">CancellationToken</span> <span id="r44 rd" class="r44 r">cancellationToken</span>)
            {
                <a href="#055de58961fe433b" class="i field">_taskAwaiter</a> = <span class="r43 r">awaiter</span>;
                <a href="#eaf27e77de4c3ad9" class="i field">_cancellationToken</a> = <span class="r44 r">cancellationToken</span>;
            }
 
            <b>public bool</b> <a id="d525ade078d960cb" href="../R/d525ade078d960cb.html" target="n" data-glyph="102,2" class="i property">IsCompleted</a> =&gt; <a href="#055de58961fe433b" class="i field">_taskAwaiter</a>.<span class="i">IsCompleted</span> || <a href="#eaf27e77de4c3ad9" class="i field">_cancellationToken</a>.<span class="i">IsCancellationRequested</span>;
 
            <b>public void</b> <a id="40ed6a68db5461c8" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">OnCompleted</a>(<span class="i">Action</span> <span id="r45 rd" class="r45 r">continuation</span>) =&gt; <a href="#055de58961fe433b" class="i field">_taskAwaiter</a>.<span class="i">OnCompleted</span>(<a href="#fc3878bd3692b877" class="i method">WrapContinuation</a>(<span class="r45 r">continuation</span>));
 
            <b>public void</b> <a id="a14ce8b11bf6fe23" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">UnsafeOnCompleted</a>(<span class="i">Action</span> <span id="r46 rd" class="r46 r">continuation</span>) =&gt; <a href="#055de58961fe433b" class="i field">_taskAwaiter</a>.<span class="i">UnsafeOnCompleted</span>(<a href="#fc3878bd3692b877" class="i method">WrapContinuation</a>(<span class="r46 r">continuation</span>));
 
            <b>public</b> <span class="r42 r t">T</span> <a id="520207a5012b3f7d" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetResult</a>()
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#d525ade078d960cb" class="i property">IsCompleted</a>);
                <b>if</b> (!<a href="#055de58961fe433b" class="i field">_taskAwaiter</a>.<span class="i">IsCompleted</span>)
                {
                    <a href="#eaf27e77de4c3ad9" class="i field">_cancellationToken</a>.<span class="i">ThrowIfCancellationRequested</span>();
                }
                <b>return</b> <a href="#055de58961fe433b" class="i field">_taskAwaiter</a>.<span class="i">GetResult</span>();
            }
 
            <b>private</b> <span class="i">Action</span> <a id="fc3878bd3692b877" href="../R/fc3878bd3692b877.html" target="n" data-glyph="76,2" class="i method">WrapContinuation</a>(<b>in</b> <span class="i">Action</span> <span id="r47 rd" class="r47 r">originalContinuation</span>)
                =&gt; <a href="#eaf27e77de4c3ad9" class="i field">_cancellationToken</a>.<span class="i">CanBeCanceled</span>
                    ? <b>new</b> <a href="#b4f9fbea19b6f261" class="t constructor">WithCancellationContinuationWrapper</a>(<span class="r47 r">originalContinuation</span>, <a href="#eaf27e77de4c3ad9" class="i field">_cancellationToken</a>).<a href="#4e22611eb7944971" class="i property">Continuation</a>
                    : <span class="r47 r">originalContinuation</span>;
        }
 
        <b>public readonly struct</b> <a id="3f4fa91fc51b6714" href="../R/3f4fa91fc51b6714.html" target="n" data-glyph="108,1" class="t t"><span id="87567bfc0815b55a">WithCancellationValueTaskAwaiter</span></a>&lt;<span id="r48 rd t" class="r48 r t">T</span>&gt; : <span class="i">ICriticalNotifyCompletion</span>
        {
            <b>private readonly</b> <span class="i">CancellationToken</span> <a id="cc52628ae530a38a" href="../R/cc52628ae530a38a.html" target="n" data-glyph="46,2" class="i field">_cancellationToken</a>;
            <b>private readonly</b> <span class="i">ConfiguredValueTaskAwaitable</span>&lt;<span class="r48 r t">T</span>&gt;.<span class="i">ConfiguredValueTaskAwaiter</span> <a id="e9c86630f6ec2818" href="../R/e9c86630f6ec2818.html" target="n" data-glyph="46,2" class="i field">_taskAwaiter</a>;
 
            <b>public</b> <a id="6537cede4acebfc8" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">WithCancellationValueTaskAwaiter</a>(<span class="i">ConfiguredValueTaskAwaitable</span>&lt;<span class="r48 r t">T</span>&gt;.<span class="i">ConfiguredValueTaskAwaiter</span> <span id="r49 rd" class="r49 r">awaiter</span>, <span class="i">CancellationToken</span> <span id="r50 rd" class="r50 r">cancellationToken</span>)
            {
                <a href="#e9c86630f6ec2818" class="i field">_taskAwaiter</a> = <span class="r49 r">awaiter</span>;
                <a href="#cc52628ae530a38a" class="i field">_cancellationToken</a> = <span class="r50 r">cancellationToken</span>;
            }
 
            <b>public bool</b> <a id="adb9277f34b0e4b0" href="../R/adb9277f34b0e4b0.html" target="n" data-glyph="102,2" class="i property">IsCompleted</a> =&gt; <a href="#e9c86630f6ec2818" class="i field">_taskAwaiter</a>.<span class="i">IsCompleted</span> || <a href="#cc52628ae530a38a" class="i field">_cancellationToken</a>.<span class="i">IsCancellationRequested</span>;
 
            <b>public void</b> <a id="db55435bd9ea8fc8" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">OnCompleted</a>(<span class="i">Action</span> <span id="r51 rd" class="r51 r">continuation</span>) =&gt; <a href="#e9c86630f6ec2818" class="i field">_taskAwaiter</a>.<span class="i">OnCompleted</span>(<a href="#d8fe4cb13fcc062f" class="i method">WrapContinuation</a>(<span class="r51 r">continuation</span>));
 
            <b>public void</b> <a id="2e4ed1f47b3515e9" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">UnsafeOnCompleted</a>(<span class="i">Action</span> <span id="r52 rd" class="r52 r">continuation</span>) =&gt; <a href="#e9c86630f6ec2818" class="i field">_taskAwaiter</a>.<span class="i">UnsafeOnCompleted</span>(<a href="#d8fe4cb13fcc062f" class="i method">WrapContinuation</a>(<span class="r52 r">continuation</span>));
 
            <b>public</b> <span class="r48 r t">T</span> <a id="1213b5d14e4ca056" href="../R/../../0000000000.html" target="n" data-glyph="72,2" class="i method">GetResult</a>()
            {
                <span class="i">Debug</span>.<span class="i">Assert</span>(<a href="#adb9277f34b0e4b0" class="i property">IsCompleted</a>);
                <b>if</b> (!<a href="#e9c86630f6ec2818" class="i field">_taskAwaiter</a>.<span class="i">IsCompleted</span>)
                {
                    <a href="#cc52628ae530a38a" class="i field">_cancellationToken</a>.<span class="i">ThrowIfCancellationRequested</span>();
                }
                <b>return</b> <a href="#e9c86630f6ec2818" class="i field">_taskAwaiter</a>.<span class="i">GetResult</span>();
            }
 
            <b>private</b> <span class="i">Action</span> <a id="d8fe4cb13fcc062f" href="../R/d8fe4cb13fcc062f.html" target="n" data-glyph="76,2" class="i method">WrapContinuation</a>(<b>in</b> <span class="i">Action</span> <span id="r53 rd" class="r53 r">originalContinuation</span>)
                =&gt; <a href="#cc52628ae530a38a" class="i field">_cancellationToken</a>.<span class="i">CanBeCanceled</span>
                    ? <b>new</b> <a href="#b4f9fbea19b6f261" class="t constructor">WithCancellationContinuationWrapper</a>(<span class="r53 r">originalContinuation</span>, <a href="#cc52628ae530a38a" class="i field">_cancellationToken</a>).<a href="#4e22611eb7944971" class="i property">Continuation</a>
                    : <span class="r53 r">originalContinuation</span>;
        }
 
        <b>private class</b> <a id="babc593b91b062c0" href="../R/babc593b91b062c0.html" target="n" data-glyph="4,1" class="t t">WithCancellationContinuationWrapper</a>
        {
            <b>private</b> <span class="i">Action</span> <a id="8ac35d05f5fca58e" href="../R/8ac35d05f5fca58e.html" target="n" data-glyph="46,2" class="i field">_originalContinuation</a>;
            <b>private readonly</b> <span class="i">CancellationTokenRegistration</span> <a id="229bacd0be04b624" href="../R/229bacd0be04b624.html" target="n" data-glyph="46,2" class="i field">_registration</a>;
 
            <b>public</b> <a id="b4f9fbea19b6f261" href="../R/b4f9fbea19b6f261.html" target="n" data-glyph="72,2" class="t constructor">WithCancellationContinuationWrapper</a>(<span class="i">Action</span> <span id="r54 rd" class="r54 r">originalContinuation</span>, <span class="i">CancellationToken</span> <span id="r55 rd" class="r55 r">cancellationToken</span>)
            {
                <span class="i">Action</span> <span id="r56 rd" class="r56 r">continuation</span> = <span class="i">ContinuationImplementation</span>;
                <a href="#8ac35d05f5fca58e" class="i field">_originalContinuation</a> = <span class="r54 r">originalContinuation</span>;
                <a href="#229bacd0be04b624" class="i field">_registration</a> = <span class="r55 r">cancellationToken</span>.<span class="i">Register</span>(<span class="r56 r">continuation</span>);
                <a href="#4e22611eb7944971" class="i property">Continuation</a> = <span class="r56 r">continuation</span>;
            }
 
            <b>public</b> <span class="i">Action</span> <a id="4e22611eb7944971" href="../R/4e22611eb7944971.html" target="n" data-glyph="102,2" class="i property">Continuation</a> { <b>get</b>; }
 
            <b>private void</b> <a id="3ffdd17085968c92" href="../R/../../0000000000.html" target="n" data-glyph="76,2" class="i method">ContinuationImplementation</a>()
            {
                <span class="i">Action</span> <span id="r57 rd" class="r57 r">originalContinuation</span> = <span class="i">Interlocked</span>.<span class="i">Exchange</span>(<b>ref</b> <a href="#8ac35d05f5fca58e" class="i field">_originalContinuation</a>, <b>null</b>);
                <b>if</b> (<span class="r57 r">originalContinuation</span> != <b>null</b>)
                {
                    <a href="#229bacd0be04b624" class="i field">_registration</a>.<span class="i">Dispose</span>();
                    <span class="r57 r">originalContinuation</span>();
                }
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
