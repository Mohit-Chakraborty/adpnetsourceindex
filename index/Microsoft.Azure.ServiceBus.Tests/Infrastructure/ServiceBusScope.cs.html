<!DOCTYPE html>
<html><head><title>ServiceBusScope.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(272);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.ServiceBus.Tests/Infrastructure/ServiceBusScope.cs" target="_top">Infrastructure\ServiceBusScope.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.ServiceBus.Tests" target="_top">Microsoft.Azure.ServiceBus.Tests.csproj</a> (Microsoft.Azure.ServiceBus.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">ServiceBus</span>.<span class="i n">UnitTests</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">CompilerServices</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">ServiceBus</span>.<span class="i n">Management</span>;
    <b>using</b> <span class="i">Polly</span>;
 
    <b>internal static class</b> <a id="e1a746ce9b5539bc" href="../R/e1a746ce9b5539bc.html" target="n" data-glyph="2,0" class="t t">ServiceBusScope</a>
    {
        <b>private static int</b> <a id="55192e4642754c27" href="../R/55192e4642754c27.html" target="n" data-glyph="46,1" class="i field">randomSeed</a> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#39a839e5e9ca1f3f" class="i property">TickCount</a>;
 
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#42021806b924c5cd" class="t t">ThreadLocal</a>&lt;<a href="@0@mscorlib/A.html#bb77e610694e64ca" class="t t">Random</a>&gt; <a id="f0ebb2b11b100113" href="../R/f0ebb2b11b100113.html" target="n" data-glyph="46,1" class="i field">Rng</a> = <b>new</b> <a href="@0@mscorlib/A.html#28dd4e60dd02f687" class="t constructor">ThreadLocal</a>&lt;<a href="@0@mscorlib/A.html#bb77e610694e64ca" class="t t">Random</a>&gt;( () =&gt; <b>new</b> <a href="@0@mscorlib/A.html#92e3cf6e56571d5a" class="t constructor">Random</a>(<a href="@0@mscorlib/A.html#8792520ddc6dadcb" class="t t">Interlocked</a>.<a href="@0@mscorlib/A.html#09bb1e21afd76cf2" class="i method">Increment</a>(<b>ref</b> <a href="#55192e4642754c27" class="i field">randomSeed</a>)), <b>false</b>);
        <b>private static readonly</b> <a href="/Microsoft.Azure.ServiceBus/A.html#3441a3068c025342" class="t t">ManagementClient</a> <a id="2a643c12abe6e971" href="../R/2a643c12abe6e971.html" target="n" data-glyph="46,1" class="i field">ManagementClient</a> = <b>new</b> <span class="t">ManagementClient</span>(<a href="TestUtility.cs.html#3d9d7f837b56950e" class="t t">TestUtility</a>.<a href="TestUtility.cs.html#db98d5e9b0210d2d" class="i property">NamespaceConnectionString</a>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates a temporary Service Bus queue to be used within a given scope and then removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">partitioned</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a partitioned queue will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">sessionEnabled</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a session will be enabled on the queue.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">configureQueue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, an action that can override the default properties used for queue creation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">caller</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the calling method; this is intended to be populated by the runtime.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The queue scope that was created.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="#2b388887046cacab" class="t t">QueueScope</a>&gt; <a id="09594334f80d0bdd" href="../R/09594334f80d0bdd.html" target="n" data-glyph="72,1" class="i method">CreateQueueAsync</a>(<b>bool</b> <span id="r0 rd" class="r0 r">partitioned</span>,
                                                              <b>bool</b> <span id="r1 rd" class="r1 r">sessionEnabled</span>,
                                                              <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#47aeb0cc070d004b" class="t t">QueueDescription</a>&gt; <span id="r2 rd" class="r2 r">configureQueue</span> = <b>null</b>,
                                                              [<a href="@0@mscorlib/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">caller</span> = <span class="s">&quot;&quot;</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r4 rd" class="r4 r">name</span> = <span class="s">$&quot;</span>{ <span class="r3 r">caller</span> }<span class="s">-</span>{ <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8) }<span class="s">&quot;</span>;
            <a href="/Microsoft.Azure.ServiceBus/A.html#47aeb0cc070d004b" class="k">var</a> <span id="r5 rd" class="r5 r">queueDescription</span> = <a href="#bd9c1f5b8f215e28" class="i method">BuildQueueDescription</a>(<span class="r4 r">name</span>, <span class="r0 r">partitioned</span>, <span class="r1 r">sessionEnabled</span>);
 
            <span class="r2 r">configureQueue</span>?.<a href="@0@mscorlib/A.html#2d4ce5e8c3a9aa80" class="i method">Invoke</a>(<span class="r5 r">queueDescription</span>);
            <b>await</b> <a href="#e7837186f1f8cfd6" class="i method">CreateRetryPolicy</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#47aeb0cc070d004b" class="t t">QueueDescription</a>&gt;().<span class="i">ExecuteAsync</span>( () =&gt; <a href="#2a643c12abe6e971" class="i field">ManagementClient</a>.<span class="i">CreateQueueAsync</span>(<span class="r5 r">queueDescription</span>));
 
            <b>return</b> <b>new</b> <a href="#1af6b5dbfea3d8f7" class="t constructor">QueueScope</a>(<span class="r4 r">name</span>, <b>async</b> () =&gt;
            {
                <b>try</b>
                {
                    <b>await</b> <a href="#a06494ad256c05ff" class="i method">CreateRetryPolicy</a>().<span class="i">ExecuteAsync</span>( () =&gt; <a href="#2a643c12abe6e971" class="i field">ManagementClient</a>.<span class="i">DeleteQueueAsync</span>(<span class="r4 r">name</span>));
                }
                <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r6 rd" class="r6 r">ex</span>)
                {
                    <a href="TestUtility.cs.html#3d9d7f837b56950e" class="t t">TestUtility</a>.<a href="TestUtility.cs.html#4a99fa089baf84a7" class="i method">Log</a>(<span class="s">$&quot;</span><span class="s">There was an issue removing the queue: [</span>{ <span class="r4 r">name</span> }<span class="s">].  This is considered non-fatal, but you should remove this manually from the Service Bus namespace. Exception: [</span>{ <span class="r6 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a> }<span class="s">]</span><span class="s">&quot;</span>);
                }
            });
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates a temporary Service Bus topic, with subscription to be used within a given scope and then removed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">partitioned</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a partitioned topic will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">sessionEnabled</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a session will be enabled  on the subscription.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">configureTopic</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, an action that can override the default properties used for topic creation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">configureSubscription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, an action that can override the default properties used for topic creation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">caller</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the calling method; this is intended to be populated by the runtime.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The topic scope that was created.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="#efc1bfe19098a8d7" class="t t">TopicScope</a>&gt; <a id="79f36f0819463684" href="../R/79f36f0819463684.html" target="n" data-glyph="72,1" class="i method">CreateTopicAsync</a>(<b>bool</b> <span id="r7 rd" class="r7 r">partitioned</span>,
                                                              <b>bool</b> <span id="r8 rd" class="r8 r">sessionEnabled</span>,
                                                              <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#4135a071521c7d17" class="t t">TopicDescription</a>&gt; <span id="r9 rd" class="r9 r">configureTopic</span> = <b>null</b>,
                                                              <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#c7a8c16dce4b50e9" class="t t">SubscriptionDescription</a>&gt; <span id="r10 rd" class="r10 r">configureSubscription</span> = <b>null</b>,
                                                              [<a href="@0@mscorlib/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">caller</span> = <span class="s">&quot;&quot;</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r12 rd" class="r12 r">topicName</span> = <span class="s">$&quot;</span>{ <span class="r11 r">caller</span> }<span class="s">-</span>{ <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8) }<span class="s">&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r13 rd" class="r13 r">subscripionName</span> = (<span class="r8 r">sessionEnabled</span>) ? <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#bad7dcce129ae135" class="i field">SessionSubscriptionName</a> : <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#095a4a0debf160dc" class="i field">SubscriptionName</a>;
            <a href="/Microsoft.Azure.ServiceBus/A.html#4135a071521c7d17" class="k">var</a> <span id="r14 rd" class="r14 r">topicDescription</span> = <a href="#2ba59edab363b129" class="i method">BuildTopicDescription</a>(<span class="r12 r">topicName</span>, <span class="r7 r">partitioned</span>);
            <a href="/Microsoft.Azure.ServiceBus/A.html#c7a8c16dce4b50e9" class="k">var</a> <span id="r15 rd" class="r15 r">subscriptionDescription</span> = <a href="#4b544a4b03f91946" class="i method">BuildSubscriptionDescription</a>(<span class="r13 r">subscripionName</span>, <span class="r12 r">topicName</span>, <span class="r8 r">sessionEnabled</span>);
 
            <span class="r9 r">configureTopic</span>?.<a href="@0@mscorlib/A.html#2d4ce5e8c3a9aa80" class="i method">Invoke</a>(<span class="r14 r">topicDescription</span>);
            <span class="r10 r">configureSubscription</span>?.<a href="@0@mscorlib/A.html#2d4ce5e8c3a9aa80" class="i method">Invoke</a>(<span class="r15 r">subscriptionDescription</span>);
 
            <b>await</b> <a href="#e7837186f1f8cfd6" class="i method">CreateRetryPolicy</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#4135a071521c7d17" class="t t">TopicDescription</a>&gt;().<span class="i">ExecuteAsync</span>( () =&gt; <a href="#2a643c12abe6e971" class="i field">ManagementClient</a>.<span class="i">CreateTopicAsync</span>(<span class="r14 r">topicDescription</span>));
            <b>await</b> <a href="#e7837186f1f8cfd6" class="i method">CreateRetryPolicy</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#c7a8c16dce4b50e9" class="t t">SubscriptionDescription</a>&gt;().<span class="i">ExecuteAsync</span>( () =&gt; <a href="#2a643c12abe6e971" class="i field">ManagementClient</a>.<span class="i">CreateSubscriptionAsync</span>(<span class="r15 r">subscriptionDescription</span>));
 
            <b>return</b> <b>new</b> <a href="#086f8d765a33d4a4" class="t constructor">TopicScope</a>(<span class="r12 r">topicName</span>, <span class="r13 r">subscripionName</span>, <b>async</b> () =&gt;
            {
                <b>try</b>
                {
                    <b>await</b> <a href="#a06494ad256c05ff" class="i method">CreateRetryPolicy</a>().<span class="i">ExecuteAsync</span>( () =&gt; <a href="#2a643c12abe6e971" class="i field">ManagementClient</a>.<span class="i">DeleteTopicAsync</span>(<span class="r12 r">topicName</span>));
                }
                <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r16 rd" class="r16 r">ex</span>)
                {
                    <a href="TestUtility.cs.html#3d9d7f837b56950e" class="t t">TestUtility</a>.<a href="TestUtility.cs.html#4a99fa089baf84a7" class="i method">Log</a>(<span class="s">$&quot;</span><span class="s">There was an issue removing the topic: [</span>{ <span class="r12 r">topicName</span> }<span class="s">].  This is considered non-fatal, but you should remove this manually from the Service Bus namespace. Exception: [</span>{ <span class="r16 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a> }<span class="s">]</span><span class="s">&quot;</span>);
                }
            });
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs an operation within the scope of a temporary Service Bus queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">partitioned</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a partitioned queue will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">sessionEnabled</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a session will be required on the queue.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">scopedOperationAsync</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The asynchronous operation to be performed; the name of the queue will be passed to the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">configureQueue</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, an action that can override the default properties used for queue creation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">caller</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the calling method; this is intended to be populated by the runtime.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The task representing the operation being performed</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="e456d17a2f88ee91" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">UsingQueueAsync</a>(<b>bool</b> <span id="r17 rd" class="r17 r">partitioned</span>,
                                                 <b>bool</b> <span id="r18 rd" class="r18 r">sessionEnabled</span>,
                                                 <a href="@0@mscorlib/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt; <span id="r19 rd" class="r19 r">scopedOperationAsync</span>,
                                                 <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#47aeb0cc070d004b" class="t t">QueueDescription</a>&gt; <span id="r20 rd" class="r20 r">configureQueue</span> = <b>null</b>,
                                                 [<a href="@0@mscorlib/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r21 rd" class="r21 r">caller</span> = <span class="s">&quot;&quot;</span>)
        {
            <b>if</b> (<span class="r19 r">scopedOperationAsync</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r19 r">scopedOperationAsync</span>));
            }
 
            <a href="#2b388887046cacab" class="k">var</a> <span id="r22 rd" class="r22 r">scope</span> = <b>default</b>(<a href="#2b388887046cacab" class="t t">QueueScope</a>);
 
            <b>try</b>
            {
                 <span class="r22 r">scope</span> = <b>await</b> <a href="#09594334f80d0bdd" class="i method">CreateQueueAsync</a>(<span class="r17 r">partitioned</span>, <span class="r18 r">sessionEnabled</span>, <span class="r20 r">configureQueue</span>, <span class="r21 r">caller</span>);
                 <b>await</b> <span class="r19 r">scopedOperationAsync</span>(<span class="r22 r">scope</span>.<a href="#f73b3df91627c8ec" class="i field">Name</a>);
            }
            <b>finally</b>
            {
                <b>try</b>
                {
                    <b>await</b> <span class="r22 r">scope</span>?.<a href="#5c1caad3a63fa26a" class="i method">CleanupAsync</a>();
                }
                <b>catch</b>
                {
                    <span class="c">// This should not be considered a critical failure that results in a test failure.  Some management</span>
                    <span class="c">// operations may be temperamental.  Throwing here does not help to ensure resource cleanup, rather</span>
                    <span class="c">// only accomplishes flagging the test itself as a failure.</span>
                    <span class="c">//</span>
                    <span class="c">// If a queue fails to be deleted, removing of the associated namespace at the end of the</span>
                    <span class="c">// test run will also remove the orphan.</span>
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs an operation within the scope of a temporary Service Bus topic, with subscription.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">partitioned</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a partitioned topic will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">sessionEnabled</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">, a session will be required on the subscription.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">scopedOperationAsync</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The asynchronous operation to be performed; the name of the topic and subscription will be passed to the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">configureTopic</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, an action that can override the default properties used for topic creation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="i">configureTSubscription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, an action that can override the default properties used for topic creation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">caller</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the calling method; this is intended to be populated by the runtime.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The task representing the operation being performed</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="4e3a6b252091f4eb" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">UsingTopicAsync</a>(<b>bool</b> <span id="r23 rd" class="r23 r">partitioned</span>,
                                                 <b>bool</b> <span id="r24 rd" class="r24 r">sessionEnabled</span>,
                                                 <a href="@0@mscorlib/A.html#8adbe0476ca899db" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt; <span id="r25 rd" class="r25 r">scopedOperationAsync</span>,
                                                 <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#4135a071521c7d17" class="t t">TopicDescription</a>&gt; <span id="r26 rd" class="r26 r">configureTopic</span> = <b>null</b>,
                                                 <a href="@0@mscorlib/A.html#486d58da4553e12d" class="t t">Action</a>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#c7a8c16dce4b50e9" class="t t">SubscriptionDescription</a>&gt; <span id="r28 rd" class="r28 r">configureSubscription</span> = <b>null</b>,
                                                 [<a href="@0@mscorlib/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r27 rd" class="r27 r">caller</span> = <span class="s">&quot;&quot;</span>)
        {
            <b>if</b> (<span class="r25 r">scopedOperationAsync</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r25 r">scopedOperationAsync</span>));
            }
 
            <a href="#efc1bfe19098a8d7" class="k">var</a> <span id="r29 rd" class="r29 r">scope</span> = <b>default</b>(<a href="#efc1bfe19098a8d7" class="t t">TopicScope</a>);
 
            <b>try</b>
            {
                 <span class="r29 r">scope</span> = <b>await</b> <a href="#79f36f0819463684" class="i method">CreateTopicAsync</a>(<span class="r23 r">partitioned</span>, <span class="r24 r">sessionEnabled</span>, <span class="r26 r">configureTopic</span>, <span class="r28 r">configureSubscription</span>, <span class="r27 r">caller</span>);
                 <b>await</b> <span class="r25 r">scopedOperationAsync</span>(<span class="r29 r">scope</span>.<a href="#e7004ec1d1b442b0" class="i field">TopicName</a>, <span class="r29 r">scope</span>.<a href="#f90ccf5bd6cf0fd2" class="i field">SubscriptionName</a>);
            }
            <b>finally</b>
            {
                <b>try</b>
                {
                    <b>await</b> <span class="r29 r">scope</span>?.<a href="#8c88db367bc7b10c" class="i method">CleanupAsync</a>();
                }
                <b>catch</b>
                {
                    <span class="c">// This should not be considered a critical failure that results in a test failure.  Some management</span>
                    <span class="c">// operations may be temperamental.  Throwing here does not help to ensure resource cleanup, rather</span>
                    <span class="c">// only accomplishes flagging the test itself as a failure.</span>
                    <span class="c">//</span>
                    <span class="c">// If a topic fails to be deleted, removing of the associated namespace at the end of the</span>
                    <span class="c">// test run will also remove the orphan.</span>
                }
            }
        }
 
        <b>private static</b> <span class="i">IAsyncPolicy</span>&lt;<span class="r30 r t">T</span>&gt; <a id="e7837186f1f8cfd6" href="../R/e7837186f1f8cfd6.html" target="n" data-glyph="76,1" class="i method">CreateRetryPolicy</a>&lt;<span id="r30 rd t" class="r30 r t">T</span>&gt;(<b>int</b> <span id="r31 rd" class="r31 r">maxRetryAttempts</span> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#c522ebfa5c0f36e9" class="i field">RetryMaxAttempts</a>, <b>double</b> <span id="r32 rd" class="r32 r">exponentialBackoffSeconds</span> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#dbd180efb86c413f" class="i field">RetryExponentialBackoffSeconds</a>, <b>double</b> <span id="r33 rd" class="r33 r">baseJitterSeconds</span> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#b6285750dd2b6e59" class="i field">RetryBaseJitterSeconds</a>) =&gt;
            <span class="i">Policy</span>&lt;<span class="r30 r t">T</span>&gt;
                .<span class="i">Handle</span>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#40f023b47f6126f1" class="t t">ServiceBusCommunicationException</a>&gt;()
                .<span class="i">Or</span>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#f685944f3f0d665e" class="t t">ServiceBusTimeoutException</a>&gt;()
                .<span class="i">WaitAndRetryAsync</span>(<span class="r31 r">maxRetryAttempts</span>, <span id="r34 rd" class="r34 r">attempt</span> =&gt; <span class="i">CalculateRetryDelay</span>(<span class="r34 r">attempt</span>, <span class="r32 r">exponentialBackoffSeconds</span>, <span class="r33 r">baseJitterSeconds</span>));
 
        <b>private static</b> <span class="i">IAsyncPolicy</span> <a id="a06494ad256c05ff" href="../R/a06494ad256c05ff.html" target="n" data-glyph="76,1" class="i method">CreateRetryPolicy</a>(<b>int</b> <span id="r35 rd" class="r35 r">maxRetryAttempts</span> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#c522ebfa5c0f36e9" class="i field">RetryMaxAttempts</a>, <b>double</b> <span id="r36 rd" class="r36 r">exponentialBackoffSeconds</span> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#dbd180efb86c413f" class="i field">RetryExponentialBackoffSeconds</a>, <b>double</b> <span id="r37 rd" class="r37 r">baseJitterSeconds</span> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#b6285750dd2b6e59" class="i field">RetryBaseJitterSeconds</a>) =&gt;
            <span class="i">Policy</span>
                .<span class="i">Handle</span>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#40f023b47f6126f1" class="t t">ServiceBusCommunicationException</a>&gt;()
                .<span class="i">Or</span>&lt;<a href="/Microsoft.Azure.ServiceBus/A.html#f685944f3f0d665e" class="t t">ServiceBusTimeoutException</a>&gt;()
                .<span class="i">WaitAndRetryAsync</span>(<span class="r35 r">maxRetryAttempts</span>, <span id="r38 rd" class="r38 r">attempt</span> =&gt; <span class="i">CalculateRetryDelay</span>(<span class="r38 r">attempt</span>, <span class="r36 r">exponentialBackoffSeconds</span>, <span class="r37 r">baseJitterSeconds</span>));
 
        <b>private static</b> <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="91662a29d4c4e7a5" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CalculateRetryDelay</a>(<b>int</b> <span id="r39 rd" class="r39 r">attempt</span>, <b>double</b> <span id="r40 rd" class="r40 r">exponentialBackoffSeconds</span>, <b>double</b> <span id="r41 rd" class="r41 r">baseJitterSeconds</span>) =&gt;
            <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>((<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#95354113fadc3083" class="i method">Pow</a>(2, <span class="r39 r">attempt</span>) * <span class="r40 r">exponentialBackoffSeconds</span>) + (<a href="#f0ebb2b11b100113" class="i field">Rng</a>.<a href="@0@mscorlib/A.html#bf5157f54273c48c" class="i property">Value</a>.<a href="@0@mscorlib/A.html#c467f2953a8d2207" class="i method">NextDouble</a>() * <span class="r41 r">baseJitterSeconds</span>));
 
        <b>private static</b> <a href="/Microsoft.Azure.ServiceBus/A.html#47aeb0cc070d004b" class="t t">QueueDescription</a> <a id="bd9c1f5b8f215e28" href="../R/bd9c1f5b8f215e28.html" target="n" data-glyph="76,1" class="i method">BuildQueueDescription</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r42 rd" class="r42 r">name</span>, <b>bool</b> <span id="r43 rd" class="r43 r">partitioned</span>, <b>bool</b> <span id="r44 rd" class="r44 r">sessionEnabled</span>) =&gt;
            <b>new</b> <span class="t">QueueDescription</span>(<span class="r42 r">name</span>)
            {
                <a href="/Microsoft.Azure.ServiceBus/A.html#c60c05039cf128ac" class="i property">DefaultMessageTimeToLive</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#fe601ae14f705b38" class="i field">QueueDefaultMessageTimeToLive</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#94dcea449ab62ee4" class="i property">LockDuration</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#178501b7d9590762" class="i field">QueueDefaultLockDuration</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#7a1ee6cfd78d206a" class="i property">DuplicateDetectionHistoryTimeWindow</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#534b61cf8477e723" class="i field">QueueDefaultDuplicateDetectionHistory</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#6404000182ff52ed" class="i property">MaxSizeInMB</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#b5bc154a479e78bc" class="i field">QueueDefaultMaxSizeMegabytes</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#cc879ebde90e7778" class="i property">EnablePartitioning</a> = <span class="r43 r">partitioned</span>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#b6e33db4b7428069" class="i property">RequiresSession</a> = <span class="r44 r">sessionEnabled</span>
            };
 
        <b>private static</b> <a href="/Microsoft.Azure.ServiceBus/A.html#4135a071521c7d17" class="t t">TopicDescription</a> <a id="2ba59edab363b129" href="../R/2ba59edab363b129.html" target="n" data-glyph="76,1" class="i method">BuildTopicDescription</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r45 rd" class="r45 r">name</span>, <b>bool</b> <span id="r46 rd" class="r46 r">partitioned</span>) =&gt;
            <b>new</b> <span class="t">TopicDescription</span>(<span class="r45 r">name</span>)
            {
                <a href="/Microsoft.Azure.ServiceBus/A.html#bdbe6363287fa495" class="i property">DefaultMessageTimeToLive</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#8da64a6d5332b555" class="i field">TopicDefaultMessageTimeToLive</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#5d6a5dffad5f0b47" class="i property">DuplicateDetectionHistoryTimeWindow</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#d39ef7e7afd7f83f" class="i field">TopicDefaultDuplicateDetectionHistory</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#00a7778ddc01a6c2" class="i property">MaxSizeInMB</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#ae1c6a5df1e667d4" class="i field">TopicDefaultMaxSizeMegabytes</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#634e9201764105e8" class="i property">EnablePartitioning</a> = <span class="r46 r">partitioned</span>
            };
 
        <b>private static</b> <a href="/Microsoft.Azure.ServiceBus/A.html#c7a8c16dce4b50e9" class="t t">SubscriptionDescription</a> <a id="4b544a4b03f91946" href="../R/4b544a4b03f91946.html" target="n" data-glyph="76,1" class="i method">BuildSubscriptionDescription</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r47 rd" class="r47 r">subscriptionName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r48 rd" class="r48 r">topicName</span>, <b>bool</b> <span id="r49 rd" class="r49 r">sessionEnabled</span>) =&gt;
            <b>new</b> <span class="t">SubscriptionDescription</span>(<span class="r48 r">topicName</span>, <span class="r47 r">subscriptionName</span>)
            {
                <a href="/Microsoft.Azure.ServiceBus/A.html#9b307abea884cf5d" class="i property">DefaultMessageTimeToLive</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#9a36c3def370e68d" class="i field">SubscriptionDefaultMessageTimeToLive</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#71196910417ec39d" class="i property">LockDuration</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#975a50b7d0f7c594" class="i field">SubscriptionDefaultLockDuration</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#e305582eef66ce34" class="i property">MaxDeliveryCount</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#5d7474e4f8219f91" class="i field">SubscriptionMaximumDeliveryCount</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#f6386da6d62a3aad" class="i property">EnableDeadLetteringOnMessageExpiration</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#9b9ccdf454016d83" class="i field">SubscriptionDefaultDeadLetterOnExpire</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#c6ae8fee19c33ba9" class="i property">EnableDeadLetteringOnFilterEvaluationExceptions</a> = <a href="TestConstants.cs.html#1bfb131f7d5dacfe" class="t t">TestConstants</a>.<a href="TestConstants.cs.html#6143f48379a6a378" class="i field">SubscriptionDefaultDeadLetterOnException</a>,
                <a href="/Microsoft.Azure.ServiceBus/A.html#eb01901d1930879b" class="i property">RequiresSession</a> = <span class="r49 r">sessionEnabled</span>
            };
 
        <b>internal sealed class</b> <a id="2b388887046cacab" href="../R/2b388887046cacab.html" target="n" data-glyph="2,1" class="t t">QueueScope</a>
        {
            <b>public readonly string</b> <a id="f73b3df91627c8ec" href="../R/f73b3df91627c8ec.html" target="n" data-glyph="42,2" class="i field">Name</a>;
            <b>private readonly</b> <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt; <a id="c78f3eb4076de4f9" href="../R/c78f3eb4076de4f9.html" target="n" data-glyph="46,2" class="i field">CleanupAction</a>;
 
            <b>public</b> <a id="1af6b5dbfea3d8f7" href="../R/1af6b5dbfea3d8f7.html" target="n" data-glyph="72,2" class="t constructor">QueueScope</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r50 rd" class="r50 r">name</span>, <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt; <span id="r51 rd" class="r51 r">cleanupAction</span>)
            {
                <a href="#f73b3df91627c8ec" class="i field">Name</a> = <span class="r50 r">name</span>;
                <a href="#c78f3eb4076de4f9" class="i field">CleanupAction</a> = <span class="r51 r">cleanupAction</span>;
            }
 
            <b>public</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5c1caad3a63fa26a" href="../R/5c1caad3a63fa26a.html" target="n" data-glyph="72,2" class="i method">CleanupAsync</a>() =&gt; <a href="#c78f3eb4076de4f9" class="i field">CleanupAction</a>?.<a href="@0@mscorlib/A.html#a7843bf4f3b2d594" class="i method">Invoke</a>() ?? <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>internal sealed class</b> <a id="efc1bfe19098a8d7" href="../R/efc1bfe19098a8d7.html" target="n" data-glyph="2,1" class="t t">TopicScope</a>
        {
            <b>public readonly string</b> <a id="e7004ec1d1b442b0" href="../R/e7004ec1d1b442b0.html" target="n" data-glyph="42,2" class="i field">TopicName</a>;
            <b>public readonly string</b> <a id="f90ccf5bd6cf0fd2" href="../R/f90ccf5bd6cf0fd2.html" target="n" data-glyph="42,2" class="i field">SubscriptionName</a>;
            <b>private readonly</b> <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt; <a id="5d8a184a464c0432" href="../R/5d8a184a464c0432.html" target="n" data-glyph="46,2" class="i field">CleanupAction</a>;
 
            <b>public</b> <a id="086f8d765a33d4a4" href="../R/086f8d765a33d4a4.html" target="n" data-glyph="72,2" class="t constructor">TopicScope</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r52 rd" class="r52 r">topicName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r53 rd" class="r53 r">subscriptionName</span>, <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>&gt; <span id="r54 rd" class="r54 r">cleanupAction</span>)
            {
                <a href="#e7004ec1d1b442b0" class="i field">TopicName</a> = <span class="r52 r">topicName</span>;
                <a href="#f90ccf5bd6cf0fd2" class="i field">SubscriptionName</a> = <span class="r53 r">subscriptionName</span>;
                <a href="#5d8a184a464c0432" class="i field">CleanupAction</a> = <span class="r54 r">cleanupAction</span>;
            }
 
            <b>public</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="8c88db367bc7b10c" href="../R/8c88db367bc7b10c.html" target="n" data-glyph="72,2" class="i method">CleanupAsync</a>() =&gt; <a href="#5d8a184a464c0432" class="i field">CleanupAction</a>?.<a href="@0@mscorlib/A.html#a7843bf4f3b2d594" class="i method">Invoke</a>() ?? <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
    }
}
</pre></td></tr></table></div></body></html>
