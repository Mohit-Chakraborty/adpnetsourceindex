<!DOCTYPE html>
<html><head><title>WorkloadNetworksTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(218);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Avs.Tests/WorkloadNetworksTests.cs" target="_top">WorkloadNetworksTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/avs/Microsoft.Azure.Management.Avs/tests/WorkloadNetworksTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Avs.Tests" target="_top">Microsoft.Azure.Management.Avs.Tests.csproj</a> (Avs.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Avs</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Avs</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">ResourceManager</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">ClientRuntime</span>.<span class="i">Azure</span>.<span class="i">TestFramework</span>;
<b>using</b> <span class="i">Xunit</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
 
<b>namespace</b> <span class="i n">Avs</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="78ba2a535782d2d4" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="2169387e91722ac6">WorkloadNetworksTests</span></a> : <span class="i">TestBase</span>
    {
        [<span class="i">Fact</span>]
        <b>public void</b> <a id="d0f1c15cad360b02" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">WorkloadNetworksDhcp</a>()
        {
            <b>using</b> <b>var</b> <span id="r0 rd" class="r0 r">context</span> = <span class="i">MockContext</span>.<span class="i">Start</span>(<a href="#78ba2a535782d2d4" class="k">this</a>.<a href="@1@System.Runtime/A.html#4d73eb225aef8a61" class="i method">GetType</a>());
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">rgName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">cloudName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
 
            <b>using</b> <b>var</b> <span id="r3 rd" class="r3 r">avsClient</span> = <span class="r0 r">context</span>.<span class="i">GetServiceClient</span>&lt;<a href="/Microsoft.Azure.Management.Avs/A.html#0d68dbc9dbe38791" class="t t">AvsClient</a>&gt;();
 
            <span class="c">// DHCP</span>
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r4 rd" class="r4 r">dhcpId</span> = <span class="s">&quot;dhcpRelay&quot;</span>;
            
            <span class="t t">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r5 rd" class="r5 r">serverAddressess</span> = <b>new</b> <span class="t constructor">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() {<span class="s">&quot;10.1.1.1&quot;</span>, <span class="s">&quot;10.1.1.2&quot;</span>};
            <a href="/Microsoft.Azure.Management.Avs/A.html#34091f59d4f97e8e" class="k">var</a> <span id="r6 rd" class="r6 r">dhcpProperties</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#1560a6ea1c46275e" class="t constructor">WorkloadNetworkDhcpRelay</a>(<span class="r7 r">displayName</span>: <span class="r4 r">dhcpId</span>, <span class="r8 r">serverAddresses</span>: <span class="r5 r">serverAddressess</span>);
            <a href="/Microsoft.Azure.Management.Avs/A.html#c943f2f13e44e7be" class="k">var</a> <span id="r9 rd" class="r9 r">dhcp</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#03a2cfc46a29db5a" class="t constructor">WorkloadNetworkDhcp</a>(<span class="r10 r">properties</span>: <span class="r6 r">dhcpProperties</span>);
 
            <span class="r3 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreateDhcp</span>(<span class="r1 r">rgName</span>, <span class="r2 r">cloudName</span>, <span class="r4 r">dhcpId</span>, <span class="r9 r">dhcp</span>);
 
            <span class="r3 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListDhcp</span>(<span class="r1 r">rgName</span>, <span class="r2 r">cloudName</span>);
 
            <span class="r3 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">GetDhcp</span>(<span class="r1 r">rgName</span>, <span class="r4 r">dhcpId</span>, <span class="r2 r">cloudName</span>);
 
            <span class="r9 r">dhcp</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#4c6e189250064da2" class="i property">Properties</a>.<a href="/Microsoft.Azure.Management.Avs/A.html#b7b949c56678d515" class="i property">DisplayName</a> = <span class="s">&quot;modifiedDhcpRelay&quot;</span>;
            <span class="r3 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">UpdateDhcp</span>(<span class="r1 r">rgName</span>, <span class="r2 r">cloudName</span>, <span class="r4 r">dhcpId</span>, <span class="r9 r">dhcp</span>);
 
            <span class="r3 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeleteDhcp</span>(<span class="r1 r">rgName</span>, <span class="r2 r">cloudName</span>, <span class="r4 r">dhcpId</span>);
        }
 
        [<span class="i">Fact</span>]
        <b>public void</b> <a id="3e0e80bcb3549ad9" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">WorkloadNetworksDns</a>()
        {
            <b>using</b> <b>var</b> <span id="r11 rd" class="r11 r">context</span> = <span class="i">MockContext</span>.<span class="i">Start</span>(<a href="#78ba2a535782d2d4" class="k">this</a>.<a href="@1@System.Runtime/A.html#4d73eb225aef8a61" class="i method">GetType</a>());
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">rgName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r13 rd" class="r13 r">cloudName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
 
            <b>using</b> <b>var</b> <span id="r14 rd" class="r14 r">avsClient</span> = <span class="r11 r">context</span>.<span class="i">GetServiceClient</span>&lt;<a href="/Microsoft.Azure.Management.Avs/A.html#0d68dbc9dbe38791" class="t t">AvsClient</a>&gt;();
            
            <span class="c">// DNS Zones</span>
 
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r15 rd" class="r15 r">defaultDnsZoneId</span> = <span class="s">&quot;defaultDnsZone&quot;</span>;
            <b>var</b> <span id="r16 rd" class="r16 r">defaultDomain</span> = <b>new</b> <span class="t constructor">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() {};
            <b>var</b> <span id="r17 rd" class="r17 r">defaultDnsServerIps</span> = <b>new</b> <span class="t constructor">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <span class="s">&quot;1.1.1.1&quot;</span> };
            <a href="/Microsoft.Azure.Management.Avs/A.html#089ce86e605bb813" class="k">var</a> <span id="r18 rd" class="r18 r">defaultDnsZone</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#f9e01c746225dcfb" class="t constructor">WorkloadNetworkDnsZone</a>(<span class="r19 r">displayName</span>: <span class="r15 r">defaultDnsZoneId</span>, <span class="r20 r">domain</span>: <span class="r16 r">defaultDomain</span>, <span class="r21 r">dnsServerIps</span>: <span class="r17 r">defaultDnsServerIps</span>);
 
            <a href="/Microsoft.Azure.Management.Avs/A.html#089ce86e605bb813" class="k">var</a> <span id="r22 rd" class="r22 r">resDefaultDnsZone</span> = <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreateDnsZone</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>, <span class="r15 r">defaultDnsZoneId</span>, <span class="r18 r">defaultDnsZone</span>);
 
            <span class="c">// Get ARM ID for DNS Service</span>
            <b>var</b> <span id="r23 rd" class="r23 r">defaultDnsZoneIdSplit</span> = <span class="r22 r">resDefaultDnsZone</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#8b6b2a8fab678fbf" class="i property">Id</a>.<a href="@1@System.Runtime/A.html#9c9fb345e3939b63" class="i method">Split</a>(<span class="s">&quot;/&quot;</span>);
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r24 rd" class="r24 r">defaultDnsZoneArmId</span> = <span class="r23 r">defaultDnsZoneIdSplit</span>[<span class="r23 r">defaultDnsZoneIdSplit</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>-1];
            
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r25 rd" class="r25 r">fqdnDnsZoneId</span> = <span class="s">&quot;fqdnDnsZone&quot;</span>;
            <b>var</b> <span id="r26 rd" class="r26 r">fqdnDomain</span> = <b>new</b> <span class="t constructor">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <span class="s">&quot;fqdndnszone.com&quot;</span> };
            <b>var</b> <span id="r27 rd" class="r27 r">fqdnDnsServerIps</span> = <b>new</b> <span class="t constructor">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <span class="s">&quot;1.1.1.1&quot;</span> };
            <a href="/Microsoft.Azure.Management.Avs/A.html#089ce86e605bb813" class="k">var</a> <span id="r28 rd" class="r28 r">fqdnDnsZone</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#f9e01c746225dcfb" class="t constructor">WorkloadNetworkDnsZone</a>(<span class="r19 r">displayName</span>: <span class="r25 r">fqdnDnsZoneId</span>, <span class="r20 r">domain</span>: <span class="r26 r">fqdnDomain</span>, <span class="r21 r">dnsServerIps</span>: <span class="r27 r">fqdnDnsServerIps</span>);
        
            <a href="/Microsoft.Azure.Management.Avs/A.html#089ce86e605bb813" class="k">var</a> <span id="r29 rd" class="r29 r">resFqdnDnsZone</span> = <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreateDnsZone</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>, <span class="r25 r">fqdnDnsZoneId</span>, <span class="r28 r">fqdnDnsZone</span>);
 
            <span class="c">// Get ARM ID for DNS Service</span>
            <b>var</b> <span id="r30 rd" class="r30 r">fqdnDnsZoneIdSplit</span> = <span class="r29 r">resFqdnDnsZone</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#8b6b2a8fab678fbf" class="i property">Id</a>.<a href="@1@System.Runtime/A.html#9c9fb345e3939b63" class="i method">Split</a>(<span class="s">&quot;/&quot;</span>);
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r31 rd" class="r31 r">fqdnDnsZoneArmId</span> = <span class="r30 r">fqdnDnsZoneIdSplit</span>[<span class="r30 r">fqdnDnsZoneIdSplit</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>-1];
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListDnsZones</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>);
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">GetDnsZone</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>, <span class="r15 r">defaultDnsZoneId</span>);
 
            <span class="r18 r">defaultDnsZone</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#dce40dc5b87b747b" class="i property">DisplayName</a> = <span class="s">&quot;modifiedDnsZone&quot;</span>;
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">UpdateDnsZone</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>, <span class="r15 r">defaultDnsZoneId</span>, <span class="r18 r">defaultDnsZone</span>);
 
            <span class="c">// DNS Services</span>
 
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r32 rd" class="r32 r">dnsServiceId</span> = <span class="s">&quot;dns-forwarder&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r33 rd" class="r33 r">dnsServiceIp</span> = <span class="s">&quot;5.5.5.5&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r34 rd" class="r34 r">logLevel</span> = <span class="s">&quot;INFO&quot;</span>;
            <a href="/Microsoft.Azure.Management.Avs/A.html#73fa54c935a034a3" class="k">var</a> <span id="r35 rd" class="r35 r">dnsService</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#6af2a06581424ed2" class="t constructor">WorkloadNetworkDnsService</a>(<span class="r36 r">displayName</span>: <span class="r32 r">dnsServiceId</span>, <span class="r37 r">dnsServiceIp</span>: <span class="r33 r">dnsServiceIp</span>, <span class="r38 r">logLevel</span>: <span class="r34 r">logLevel</span>);
 
            <span class="r35 r">dnsService</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#d9010dbf10e95ba8" class="i property">DefaultDnsZone</a> = <span class="r24 r">defaultDnsZoneArmId</span>;
            <span class="r35 r">dnsService</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#8c20ca70ca433f05" class="i property">FqdnZones</a> = <b>new</b> <span class="t constructor">List</span>&lt;<a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() { <span class="r31 r">fqdnDnsZoneArmId</span> };
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreateDnsService</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>, <span class="r32 r">dnsServiceId</span>,  <span class="r35 r">dnsService</span>);
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListDnsServices</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>);
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">GetDnsService</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>, <span class="r32 r">dnsServiceId</span>);
 
            <span class="r35 r">dnsService</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#a665b8dd74edb633" class="i property">DisplayName</a> = <span class="s">&quot;modifiedDnsService&quot;</span>;
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">UpdateDnsService</span>(<span class="r12 r">rgName</span>, <span class="r13 r">cloudName</span>, <span class="r32 r">dnsServiceId</span>, <span class="r35 r">dnsService</span>);
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeleteDnsService</span>(<span class="r12 r">rgName</span>, <span class="r32 r">dnsServiceId</span>, <span class="r13 r">cloudName</span>);
 
            <span class="c">// Delete DNS Zones</span>
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeleteDnsZone</span>(<span class="r12 r">rgName</span>, <span class="r15 r">defaultDnsZoneId</span>, <span class="r13 r">cloudName</span>);
 
            <span class="r14 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeleteDnsZone</span>(<span class="r12 r">rgName</span>, <span class="r25 r">fqdnDnsZoneId</span>, <span class="r13 r">cloudName</span>);
        }
 
        [<span class="i">Fact</span>]
        <b>public void</b> <a id="39d37246aa140dd2" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">WorkloadNetworksGatewaysSegments</a>()
        {
            <b>using</b> <b>var</b> <span id="r39 rd" class="r39 r">context</span> = <span class="i">MockContext</span>.<span class="i">Start</span>(<a href="#78ba2a535782d2d4" class="k">this</a>.<a href="@1@System.Runtime/A.html#4d73eb225aef8a61" class="i method">GetType</a>());
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r40 rd" class="r40 r">rgName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r41 rd" class="r41 r">cloudName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
 
            <b>using</b> <b>var</b> <span id="r42 rd" class="r42 r">avsClient</span> = <span class="r39 r">context</span>.<span class="i">GetServiceClient</span>&lt;<a href="/Microsoft.Azure.Management.Avs/A.html#0d68dbc9dbe38791" class="t t">AvsClient</a>&gt;();
 
            <span class="c">// Gateways</span>
 
            <b>var</b> <span id="r43 rd" class="r43 r">gatewayResults</span> = <span class="r42 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListGateways</span>(<span class="r40 r">rgName</span>, <span class="r41 r">cloudName</span>);
 
            <span class="c">// Segments</span>
 
            <b>var</b> <span id="r44 rd" class="r44 r">gatewayName</span> = <span class="r43 r">gatewayResults</span>.<span class="i">First</span>().<span class="i">DisplayName</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r45 rd" class="r45 r">segmentId</span> = <span class="s">&quot;segment&quot;</span>;
            <a href="/Microsoft.Azure.Management.Avs/A.html#22bbbe38fd34c669" class="k">var</a> <span id="r46 rd" class="r46 r">segmentSubnet</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#1960bdea3807932b" class="t constructor">WorkloadNetworkSegmentSubnet</a>(<span class="r47 r">gatewayAddress</span>: <span class="s">&quot;10.2.3.1/24&quot;</span>);
            <a href="/Microsoft.Azure.Management.Avs/A.html#bc1894bd65953774" class="k">var</a> <span id="r48 rd" class="r48 r">segment</span> = <b>new</b> <span class="t">WorkloadNetworkSegment</span>(<span class="i">displayName</span>: <span class="r45 r">segmentId</span>, <span class="i">connectedGateway</span>: <span class="r44 r">gatewayName</span>, <span class="i">subnet</span>: <span class="r46 r">segmentSubnet</span>);
 
            <span class="r42 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreateSegments</span>(<span class="r40 r">rgName</span>, <span class="r41 r">cloudName</span>, <span class="r45 r">segmentId</span>, <span class="r48 r">segment</span>);
 
            <span class="r42 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListSegments</span>(<span class="r40 r">rgName</span>, <span class="r41 r">cloudName</span>);
 
            <span class="r42 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">GetSegment</span>(<span class="r40 r">rgName</span>, <span class="r41 r">cloudName</span>, <span class="r45 r">segmentId</span>);
 
            <span class="r48 r">segment</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#ff26c08a223bbb28" class="i property">DisplayName</a> = <span class="s">&quot;modifiedSegment&quot;</span>;
            <span class="r42 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">UpdateSegments</span>(<span class="r40 r">rgName</span>, <span class="r41 r">cloudName</span>, <span class="r45 r">segmentId</span>, <span class="r48 r">segment</span>);
 
            <span class="r42 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeleteSegment</span>(<span class="r40 r">rgName</span>, <span class="r41 r">cloudName</span>, <span class="r45 r">segmentId</span>);
        }
 
        [<span class="i">Fact</span>]
        <b>public void</b> <a id="16459f66a0e0efc1" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">WorkloadNetworksVirtualMachinesVmGroupsPortMirroring</a>()
        {
            <b>using</b> <b>var</b> <span id="r49 rd" class="r49 r">context</span> = <span class="i">MockContext</span>.<span class="i">Start</span>(<a href="#78ba2a535782d2d4" class="k">this</a>.<a href="@1@System.Runtime/A.html#4d73eb225aef8a61" class="i method">GetType</a>());
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r50 rd" class="r50 r">rgName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r51 rd" class="r51 r">cloudName</span> = <span class="s">&quot;wezamlyn-test-117&quot;</span>;
 
            <b>using</b> <b>var</b> <span id="r52 rd" class="r52 r">avsClient</span> = <span class="r49 r">context</span>.<span class="i">GetServiceClient</span>&lt;<a href="/Microsoft.Azure.Management.Avs/A.html#0d68dbc9dbe38791" class="t t">AvsClient</a>&gt;();
 
            <span class="c">// Virtual Machines</span>
 
            <b>var</b> <span id="r53 rd" class="r53 r">virtualMachinesList</span> = <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListVirtualMachines</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>);
 
            <span class="c">// VM Groups</span>
 
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r54 rd" class="r54 r">sourceVmGroupId</span> = <span class="s">&quot;sourceVmGroup&quot;</span>;
            <a href="/Microsoft.Azure.Management.Avs/A.html#37c0ec8d7dcb28ea" class="k">var</a> <span id="r55 rd" class="r55 r">sourceVmGroup</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#f94f2ca364ff87e1" class="t constructor">WorkloadNetworkVMGroup</a>(<span class="r56 r">displayName</span>: <span class="r54 r">sourceVmGroupId</span>);
 
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r57 rd" class="r57 r">destVmGroupId</span> = <span class="s">&quot;destVmGroup&quot;</span>;
            <a href="/Microsoft.Azure.Management.Avs/A.html#37c0ec8d7dcb28ea" class="k">var</a> <span id="r58 rd" class="r58 r">destVmGroup</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#f94f2ca364ff87e1" class="t constructor">WorkloadNetworkVMGroup</a>(<span class="r56 r">displayName</span>: <span class="r57 r">destVmGroupId</span>);
 
            <b>if</b> (<span class="r53 r">virtualMachinesList</span>.<span class="i">Count</span>() &gt;= 2)
            {
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r59 rd" class="r59 r">sourceMembers</span> = {<span class="r53 r">virtualMachinesList</span>.<span class="i">ElementAt</span>(0).<span class="i">DisplayName</span>};
                <span class="r55 r">sourceVmGroup</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#c33ac589d31da589" class="i property">Members</a> = <span class="r59 r">sourceMembers</span>;
 
                <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r60 rd" class="r60 r">destMembers</span> = {<span class="r53 r">virtualMachinesList</span>.<span class="i">ElementAt</span>(1).<span class="i">DisplayName</span>};
                <span class="r58 r">destVmGroup</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#c33ac589d31da589" class="i property">Members</a> = <span class="r60 r">destMembers</span>;
            }
 
            <a href="/Microsoft.Azure.Management.Avs/A.html#37c0ec8d7dcb28ea" class="k">var</a> <span id="r61 rd" class="r61 r">resSourceVmGroup</span> = <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreateVMGroup</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>, <span class="r54 r">sourceVmGroupId</span>, <span class="r55 r">sourceVmGroup</span>);
 
            <span class="c">// Get ARM ID for Port Mirroring</span>
            <b>var</b> <span id="r62 rd" class="r62 r">sourceIdSplit</span> = <span class="r61 r">resSourceVmGroup</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#8b6b2a8fab678fbf" class="i property">Id</a>.<a href="@1@System.Runtime/A.html#9c9fb345e3939b63" class="i method">Split</a>(<span class="s">&quot;/&quot;</span>);
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r63 rd" class="r63 r">sourceArmId</span> = <span class="r62 r">sourceIdSplit</span>[<span class="r62 r">sourceIdSplit</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>-1];
 
            <a href="/Microsoft.Azure.Management.Avs/A.html#37c0ec8d7dcb28ea" class="k">var</a> <span id="r64 rd" class="r64 r">resDestVmGroup</span> = <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreateVMGroup</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>, <span class="r57 r">destVmGroupId</span>, <span class="r58 r">destVmGroup</span>);
 
            <span class="c">// Get ARM ID for Port Mirroring</span>
            <b>var</b> <span id="r65 rd" class="r65 r">destIdSplit</span> = <span class="r64 r">resDestVmGroup</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#8b6b2a8fab678fbf" class="i property">Id</a>.<a href="@1@System.Runtime/A.html#9c9fb345e3939b63" class="i method">Split</a>(<span class="s">&quot;/&quot;</span>);
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r66 rd" class="r66 r">destArmId</span> = <span class="r65 r">destIdSplit</span>[<span class="r65 r">destIdSplit</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>-1];
 
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListVMGroups</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>);
 
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">GetVMGroup</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>, <span class="r54 r">sourceVmGroupId</span>);
 
            <span class="r55 r">sourceVmGroup</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#bb2fe0156b1113be" class="i property">DisplayName</a> = <span class="s">&quot;modifiedVmGroup&quot;</span>;
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">UpdateVMGroup</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>, <span class="r54 r">sourceVmGroupId</span>, <span class="r55 r">sourceVmGroup</span>);
 
            <span class="c">// Port Mirroring</span>
 
            <a href="@1@System.Runtime/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r67 rd" class="r67 r">portMirroringId</span> = <span class="s">&quot;portMirroring&quot;</span>;
            <a href="/Microsoft.Azure.Management.Avs/A.html#6ef34aa481d94067" class="k">var</a> <span id="r68 rd" class="r68 r">portMirroring</span> = <b>new</b> <a href="/Microsoft.Azure.Management.Avs/A.html#2aaf14791a38baff" class="t constructor">WorkloadNetworkPortMirroring</a>(<span class="r69 r">displayName</span>: <span class="r67 r">portMirroringId</span>, <span class="r70 r">direction</span>: <span class="s">&quot;BIDIRECTIONAL&quot;</span>);
            <span class="r68 r">portMirroring</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#4eb625949860f10e" class="i property">Source</a> = <span class="r63 r">sourceArmId</span>;
            <span class="r68 r">portMirroring</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#4ec371a1a35d1dfa" class="i property">Destination</a> = <span class="r66 r">destArmId</span>;
            
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">CreatePortMirroring</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>, <span class="r67 r">portMirroringId</span>, <span class="r68 r">portMirroring</span>);
 
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">ListPortMirroring</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>);
 
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">GetPortMirroring</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>, <span class="r67 r">portMirroringId</span>);
 
            <span class="r68 r">portMirroring</span>.<a href="/Microsoft.Azure.Management.Avs/A.html#cb307aad7926f43e" class="i property">DisplayName</a> = <span class="s">&quot;modifiedPortMirroring&quot;</span>;
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">UpdatePortMirroring</span>(<span class="r50 r">rgName</span>, <span class="r51 r">cloudName</span>,<span class="r67 r">portMirroringId</span>, <span class="r68 r">portMirroring</span>);
 
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeletePortMirroring</span>(<span class="r50 r">rgName</span>, <span class="r67 r">portMirroringId</span>, <span class="r51 r">cloudName</span>);
 
            <span class="c">// Delete VM Groups</span>
 
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeleteVMGroup</span>(<span class="r50 r">rgName</span>, <span class="r54 r">sourceVmGroupId</span>, <span class="r51 r">cloudName</span>);
 
            <span class="r52 r">avsClient</span>.<span class="i">WorkloadNetworks</span>.<span class="i">DeleteVMGroup</span>(<span class="r50 r">rgName</span>, <span class="r57 r">destVmGroupId</span>, <span class="r51 r">cloudName</span>);            
        }
    }
}</pre></td></tr></table></div></body></html>
