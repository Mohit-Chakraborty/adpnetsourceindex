<!DOCTYPE html>
<html><head><title>ServiceBusReceiver.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(1146);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.ServiceBus/Receiver/ServiceBusReceiver.cs" target="_top">Receiver\ServiceBusReceiver.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/servicebus/Azure.Messaging.ServiceBus/src/Receiver/ServiceBusReceiver.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.ServiceBus" target="_top">Azure.Messaging.ServiceBus.csproj</a> (Azure.Messaging.ServiceBus)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">CompilerServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is responsible for receiving</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> and settling messages from Queues and Subscriptions.</span>
    <span class="c">///</span><span class="c"> It is constructed by calling </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#692483b0b2ae13d8" class="i method">CreateReceiver</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="2224f17dabcb26c3" href="../R/2224f17dabcb26c3.html" target="n" data-glyph="0,0" class="t t">ServiceBusReceiver</a> : <span class="t t">IAsyncDisposable</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The fully qualified Service Bus namespace that the receiver is associated with.  This is likely</span>
        <span class="c">///</span><span class="c"> to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public virtual string</b> <a id="a984eb4152b78f79" href="../R/a984eb4152b78f79.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedNamespace</a> =&gt; <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the Service Bus entity that the receiver is connected to, specific to the</span>
        <span class="c">///</span><span class="c"> Service Bus namespace that contains it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public virtual string</b> <a id="933d55dc873c8dc1" href="../R/933d55dc873c8dc1.html" target="n" data-glyph="102,1" class="i property">EntityPath</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> used to specify how messages are received. Defaults to PeekLock mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a> <a id="108a285bc4afe119" href="../R/108a285bc4afe119.html" target="n" data-glyph="102,1" class="i property">ReceiveMode</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicates whether the receiver entity is session enabled.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="e41b70ce2d96cf67" href="../R/e41b70ce2d96cf67.html" target="n" data-glyph="104,1" class="i property">IsSessionReceiver</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of messages that will be eagerly requested from Queues or Subscriptions and queued locally without regard to</span>
        <span class="c">///</span><span class="c"> whether a processing is currently active, intended to help maximize throughput by allowing the receiver to receive</span>
        <span class="c">///</span><span class="c"> from a local cache rather than waiting on a service request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public virtual int</b> <a id="30eab00d86cecbdf" href="../R/30eab00d86cecbdf.html" target="n" data-glyph="102,1" class="i property">PrefetchCount</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the ID to identify this client. This can be used to correlate logs and exceptions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Every new client has a unique ID.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="d4035be49ac784db" href="../R/d4035be49ac784db.html" target="n" data-glyph="104,1" class="i property">Identifier</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates whether or not this </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the receiver is closed; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>public virtual bool</b> <a id="2fb390c9488d131a" href="../R/2fb390c9488d131a.html" target="n" data-glyph="102,1" class="i property">IsClosed</a>
        {
            <b>get</b> =&gt; <a href="#56e7ddb7f663f250" class="i field">_closed</a>;
            <b>private set</b> =&gt; <a href="#56e7ddb7f663f250" class="i field">_closed</a> = <b>value</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Indicates whether or not this instance has been closed.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private volatile bool</b> <a id="56e7ddb7f663f250" href="../R/56e7ddb7f663f250.html" target="n" data-glyph="46,1" class="i field">_closed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The policy to use for determining retry behavior for when an operation fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private readonly</b> <a href="../Primitives/ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <a id="bb7ac00f36147f50" href="../R/bb7ac00f36147f50.html" target="n" data-glyph="46,1" class="i field">_retryPolicy</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The active connection to the Azure Service Bus service, enabling client communications for metadata</span>
        <span class="c">///</span><span class="c"> about the associated Service Bus entity and access to transport-aware receivers.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private readonly</b> <a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a> <a id="aff01fe5ca99ccb1" href="../R/aff01fe5ca99ccb1.html" target="n" data-glyph="46,1" class="i field">_connection</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An abstracted Service Bus transport-specific receiver that is associated with the</span>
        <span class="c">///</span><span class="c"> Service Bus entity gateway; intended to perform delegated operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../Core/TransportReceiver.cs.html#1b072fa1ddd22c6a" class="t t">TransportReceiver</a> <a id="ccb12450e5be9b61" href="../R/ccb12450e5be9b61.html" target="n" data-glyph="104,1" class="i property">InnerReceiver</a> =&gt; <a href="#7f7bba5a9a9bc62d" class="i field">_innerReceiver</a>;
        <b>private readonly</b> <a href="../Core/TransportReceiver.cs.html#1b072fa1ddd22c6a" class="t t">TransportReceiver</a> <a id="7f7bba5a9a9bc62d" href="../R/7f7bba5a9a9bc62d.html" target="n" data-glyph="46,1" class="i field">_innerReceiver</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Responsible for creating entity scopes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#9100164b526814a3" class="t t">EntityScopeFactory</a> <a id="1dd76242085124b3" href="../R/1dd76242085124b3.html" target="n" data-glyph="104,1" class="i property">ScopeFactory</a> =&gt; <a href="#e59d06eca12aeaae" class="i field">_scopeFactory</a>;
        <b>private readonly</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#9100164b526814a3" class="t t">EntityScopeFactory</a> <a id="e59d06eca12aeaae" href="../R/e59d06eca12aeaae.html" target="n" data-glyph="46,1" class="i field">_scopeFactory</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The instance of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> which can be mocked for testing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a> <a id="70e55ac811fb8d3b" href="../R/70e55ac811fb8d3b.html" target="n" data-glyph="104,1" class="i property">Logger</a> { <b>get</b>; <b>set</b>; } = <a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#9494c77d3f8244ec" class="i property">Log</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">connection</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> connection to use for communication with the Service Bus service.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">entityPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">isSessionEntity</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A set of options to apply when configuring the consumer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">sessionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional session Id to scope the receiver to. If not specified,</span>
        <span class="c">///</span><span class="c">     the next available session returned from the service will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">isProcessor</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether or not the receiver is being created for a processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The cancellation token to use when opening the receiver link.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="2f7383a2156a0947" href="../R/2f7383a2156a0947.html" target="n" data-glyph="74,1" class="t constructor">ServiceBusReceiver</a>(
            <a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a> <span id="r0 rd" class="r0 r">connection</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">entityPath</span>,
            <b>bool</b> <span id="r2 rd" class="r2 r">isSessionEntity</span>,
            <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a> <span id="r3 rd" class="r3 r">options</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">sessionId</span> = <b>default</b>,
            <b>bool</b> <span id="r5 rd" class="r5 r">isProcessor</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r6 rd" class="r6 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="@1@netstandard/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r7 rd" class="r7 r">type</span> = <a href="@1@netstandard/A.html#4d73eb225aef8a61" class="i method">GetType</a>();
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#bce0e360eab4841c" class="i method">ClientCreateStart</a>(<span class="r7 r">type</span>, <span class="r0 r">connection</span>?.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <span class="r1 r">entityPath</span>);
 
            <span class="c">// cancellationToken should not be passed for non-session entities</span>
            <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<span class="r2 r">isSessionEntity</span> || <span class="r6 r">cancellationToken</span> == <b>default</b>);
 
            <b>try</b>
            {
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r0 r">connection</span>, <b>nameof</b>(<span class="r0 r">connection</span>));
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>, <b>nameof</b>(<span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>));
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#fa55a5c88c3dc11d" class="i method">AssertNotNullOrWhiteSpace</a>(<span class="r1 r">entityPath</span>, <b>nameof</b>(<span class="r1 r">entityPath</span>));
                <span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
 
                <span class="r3 r">options</span> = <span class="r3 r">options</span>?.<a href="ServiceBusReceiverOptions.cs.html#05c41cad1e69501f" class="i method">Clone</a>() ?? <b>new</b> <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t constructor">ServiceBusReceiverOptions</a>();
                <a href="#d4035be49ac784db" class="i property">Identifier</a> = <a href="../Diagnostics/DiagnosticUtilities.cs.html#e63dadcef3cbbce1" class="t t">DiagnosticUtilities</a>.<a href="../Diagnostics/DiagnosticUtilities.cs.html#582c96465587da53" class="i method">GenerateIdentifier</a>(<span class="r1 r">entityPath</span>);
                <a href="#aff01fe5ca99ccb1" class="i field">_connection</a> = <span class="r0 r">connection</span>;
                <a href="#bb7ac00f36147f50" class="i field">_retryPolicy</a> = <span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>.<a href="../Core/ServiceBusRetryOptionsExtensions.cs.html#d698c84551779460" class="i method">ToRetryPolicy</a>();
                <a href="#108a285bc4afe119" class="i property">ReceiveMode</a> = <span class="r3 r">options</span>.<a href="ServiceBusReceiverOptions.cs.html#67149ea1431eaf19" class="i property">ReceiveMode</a>;
                <a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a> = <span class="r3 r">options</span>.<a href="ServiceBusReceiverOptions.cs.html#02d0c166fba3f0b0" class="i property">PrefetchCount</a>;
 
                <a href="#933d55dc873c8dc1" class="i property">EntityPath</a> = <a href="../EntityNameFormatter.cs.html#a1a69c56795bc65a" class="t t">EntityNameFormatter</a>.<a href="../EntityNameFormatter.cs.html#703f812dbb384f69" class="i method">FormatEntityPath</a>(<span class="r1 r">entityPath</span>, <span class="r3 r">options</span>.<a href="ServiceBusReceiverOptions.cs.html#b9d51848e5be6bd1" class="i property">SubQueue</a>);
 
                <a href="#e41b70ce2d96cf67" class="i property">IsSessionReceiver</a> = <span class="r2 r">isSessionEntity</span>;
                <a href="#7f7bba5a9a9bc62d" class="i field">_innerReceiver</a> = <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#2098bbcc1f3805e9" class="i method">CreateTransportReceiver</a>(
                    <span class="r8 r">entityPath</span>: <a href="#933d55dc873c8dc1" class="i property">EntityPath</a>,
                    <span class="r9 r">retryPolicy</span>: <a href="#bb7ac00f36147f50" class="i field">_retryPolicy</a>,
                    <span class="r10 r">receiveMode</span>: <a href="#108a285bc4afe119" class="i property">ReceiveMode</a>,
                    <span class="r11 r">prefetchCount</span>: (<b>uint</b>)<a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a>,
                    <span class="r12 r">identifier</span>: <a href="#d4035be49ac784db" class="i property">Identifier</a>,
                    <span class="r13 r">sessionId</span>: <span class="r4 r">sessionId</span>,
                    <span class="r14 r">isSessionReceiver</span>: <a href="#e41b70ce2d96cf67" class="i property">IsSessionReceiver</a>,
                    <span class="r15 r">isProcessor</span>: <span class="r5 r">isProcessor</span>,
                    <span class="r16 r">cancellationToken</span>: <span class="r6 r">cancellationToken</span>);
                <a href="#e59d06eca12aeaae" class="i field">_scopeFactory</a> = <b>new</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#5f446a7a93a315a4" class="t constructor">EntityScopeFactory</a>(<a href="#933d55dc873c8dc1" class="i property">EntityPath</a>, <a href="#a984eb4152b78f79" class="i property">FullyQualifiedNamespace</a>);
                <b>if</b> (!<span class="r2 r">isSessionEntity</span>)
                {
                    <span class="c">// don&#39;t log client completion for session receiver here as it is not complete until</span>
                    <span class="c">// the link is opened.</span>
                    <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#d5ab92363723b0fc" class="i method">ClientCreateComplete</a>(<span class="r7 r">type</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>);
                }
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r17 rd" class="r17 r">ex</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#4f15a6cd3577965b" class="i method">ClientCreateException</a>(<span class="r7 r">type</span>, <span class="r0 r">connection</span>?.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <span class="r1 r">entityPath</span>, <span class="r17 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class for mocking.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a id="ab34e52b31f988ca" href="../R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">ServiceBusReceiver</a>() { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class for use with derived types.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">client</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The client instance to use for the receiver.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">queueName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the queue to receive from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to use when configuring the receiver.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected</b> <a id="a0fca3edd84aa15d" href="../R/a0fca3edd84aa15d.html" target="n" data-glyph="75,1" class="t constructor">ServiceBusReceiver</a>(<a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a> <span id="r18 rd" class="r18 r">client</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r19 rd" class="r19 r">queueName</span>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a> <span id="r20 rd" class="r20 r">options</span>) :
            <a href="#2f7383a2156a0947" class="k">this</a>(<span class="r18 r">client</span>?.<a href="../Client/ServiceBusClient.cs.html#97fc736b8320a96c" class="i property">Connection</a>, <span class="r19 r">queueName</span>, <b>false</b>,  <span class="r20 r">options</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class for use with derived types.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r21 r">client</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The client instance to use for the receiver.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r22 r">topicName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The topic to create a receiver for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">subscriptionName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The subscription to create a receiver for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to use when configuring the receiver.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected</b> <a id="1a6be02cc857e430" href="../R/1a6be02cc857e430.html" target="n" data-glyph="75,1" class="t constructor">ServiceBusReceiver</a>(<a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a> <span id="r21 rd" class="r21 r">client</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r22 rd" class="r22 r">topicName</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r23 rd" class="r23 r">subscriptionName</span>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a> <span id="r24 rd" class="r24 r">options</span>) :
            <a href="#2f7383a2156a0947" class="k">this</a>(<span class="r21 r">client</span>?.<a href="../Client/ServiceBusClient.cs.html#97fc736b8320a96c" class="i property">Connection</a>, <a href="../EntityNameFormatter.cs.html#a1a69c56795bc65a" class="t t">EntityNameFormatter</a>.<a href="../EntityNameFormatter.cs.html#2f9c6b31caac76fd" class="i method">FormatSubscriptionPath</a>(<span class="r22 r">topicName</span>, <span class="r23 r">subscriptionName</span>), <b>false</b>,  <span class="r24 r">options</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the task needed to clean up resources used by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> An optional</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the</span>
        <span class="c">///</span><span class="c"> request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="df18551746849ff4" href="../R/df18551746849ff4.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r25 rd" class="r25 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="#2fb390c9488d131a" class="i property">IsClosed</a> = <b>true</b>;
            <a href="@1@netstandard/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r26 rd" class="r26 r">clientType</span> = <a href="@1@netstandard/A.html#4d73eb225aef8a61" class="i method">GetType</a>();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#1855ea9b2d696f3a" class="i method">ClientCloseStart</a>(<span class="r26 r">clientType</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>);
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#1c24eafac12d91cb" class="i method">CloseAsync</a>(<span class="r25 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r27 rd" class="r27 r">ex</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#f72cbabc5482c63e" class="i method">ClientCloseException</a>(<span class="r26 r">clientType</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r27 r">ex</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#14069d9c61f76ddc" class="i method">ClientCloseComplete</a>(<span class="r26 r">clientType</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a list of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> from the entity using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> defaults to PeekLock mode.</span>
        <span class="c">///</span><span class="c"> This method doesn&#39;t guarantee to return exact `maxMessages` messages,</span>
        <span class="c">///</span><span class="c"> even if there are `maxMessages` messages available in the queue or topic.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">maxMessages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum number of messages that will be received.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">maxWaitTime</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> specifying the maximum time to wait for the first message before returning an empty list if no messages are available.</span>
        <span class="c">///</span><span class="c"> If not specified, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusRetryOptions.cs.html#f405da36db2d38b0" class="t t">ServiceBusRetryOptions</a>.<a href="../Primitives/ServiceBusRetryOptions.cs.html#cdf1b0ed863b1af5" class="i property">TryTimeout</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of messages received. Returns an empty list if no message is found.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="7ee373e6d1bdf86c" href="../R/7ee373e6d1bdf86c.html" target="n" data-glyph="72,1" class="i method">ReceiveMessagesAsync</a>(
            <b>int</b> <span id="r28 rd" class="r28 r">maxMessages</span>,
            <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>? <span id="r29 rd" class="r29 r">maxWaitTime</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r30 rd" class="r30 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#f82141e9801b0f9e" class="i method">ReceiveMessagesAsync</a>(<span class="r28 r">maxMessages</span>, <span class="r29 r">maxWaitTime</span>, <b>false</b>, <span class="r30 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <b>internal async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="f82141e9801b0f9e" href="../R/f82141e9801b0f9e.html" target="n" data-glyph="74,1" class="i method">ReceiveMessagesAsync</a>(
            <b>int</b> <span id="r31 rd" class="r31 r">maxMessages</span>,
            <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>? <span id="r32 rd" class="r32 r">maxWaitTime</span>,
            <b>bool</b> <span id="r33 rd" class="r33 r">isProcessor</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r34 rd" class="r34 r">cancellationToken</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#f10450d3147666fe" class="i method">AssertAtLeast</a>(<span class="r31 r">maxMessages</span>, 1, <b>nameof</b>(<span class="r31 r">maxMessages</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
 
            <b>if</b> (<span class="r32 r">maxWaitTime</span>.<a href="@1@netstandard/A.html#7bbe60e33e857298" class="i property">HasValue</a>)
            {
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#df647ed802c8aa46" class="i method">AssertPositive</a>(<span class="r32 r">maxWaitTime</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>, <b>nameof</b>(<span class="r32 r">maxWaitTime</span>));
            }
            <b>if</b> (<a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a> &gt; 0 &amp;&amp; <span class="r31 r">maxMessages</span> &gt; <a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#2d848d54c97cc098" class="i method">MaxMessagesExceedsPrefetch</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a>, <span class="r31 r">maxMessages</span>);
            }
            <span class="r34 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#96bca9ada968b283" class="i method">ReceiveMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r31 r">maxMessages</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r35 rd" class="r35 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#eaae42b6948ca95b" class="i property">ReceiveActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#15794f37dea7f04e" class="i field">ConsumerKind</a>);
 
            <span class="r35 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r36 rd" class="r36 r">messages</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="r36 r">messages</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#e75c553e4e4b0d67" class="i method">ReceiveMessagesAsync</a>(
                    <span class="r31 r">maxMessages</span>,
                    <span class="r32 r">maxWaitTime</span>,
                    <span class="r34 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a> <span id="r37 rd" class="r37 r">ex</span>)
                <b>when</b> (<span class="r33 r">isProcessor</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#47a69ce7812228e6" class="i method">ProcessorStoppingReceiveCanceled</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r37 r">ex</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r35 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r37 r">ex</span>);
                <b>throw</b>;
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r38 rd" class="r38 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#ab7f7cf7e7fd2d5e" class="i method">ReceiveMessageException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r38 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r35 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r38 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#8e4cabb595680bfa" class="i method">ReceiveMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r36 r">messages</span>);
            <span class="r35 r">scope</span>.<a href="../Diagnostics/DiagnosticExtensions.cs.html#064476776858c575" class="i method">SetMessageData</a>(<span class="r36 r">messages</span>);
 
            <b>return</b> <span class="r36 r">messages</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives messages as an asynchronous enumerable from the entity using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> defaults to PeekLock mode. Messages will be received from the entity as</span>
        <span class="c">///</span><span class="c"> the IAsyncEnumerable is iterated. If no messages are available, this method will continue polling</span>
        <span class="c">///</span><span class="c"> until messages are available, i.e. it will never return null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the</span>
        <span class="c">///</span><span class="c"> request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The message received.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="t t">IAsyncEnumerable</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="04fa1000946203c7" href="../R/04fa1000946203c7.html" target="n" data-glyph="72,1" class="i method">ReceiveMessagesAsync</a>(
            [<span class="t constructor">EnumeratorCancellation</span>]
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r39 rd" class="r39 r">cancellationToken</span> = <b>default</b>)
        {
            <b>while</b> (!<span class="r39 r">cancellationToken</span>.<a href="@1@netstandard/A.html#f32abbe8e2f1f6c1" class="i property">IsCancellationRequested</a>)
            {
                <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="k">var</a> <span id="r40 rd" class="r40 r">msg</span> = <b>await</b> <a href="#c59a6150722beca5" class="i method">ReceiveMessageAsync</a>(<span class="r41 r">cancellationToken</span>: <span class="r39 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <b>if</b> (<span class="r40 r">msg</span> == <b>null</b>)
                {
                    <b>continue</b>;
                }
                <b>yield</b> <b>return</b> <span class="r40 r">msg</span>;
            }
 
            <span class="c">// Surface the TCE to ensure deterministic behavior when cancelling.</span>
            <span class="r39 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> from the entity using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> defaults to PeekLock mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">maxWaitTime</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> specifying the maximum time to wait for a message before returning</span>
        <span class="c">///</span><span class="c"> null if no messages are available.</span>
        <span class="c">///</span><span class="c"> If not specified, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusRetryOptions.cs.html#f405da36db2d38b0" class="t t">ServiceBusRetryOptions</a>.<a href="../Primitives/ServiceBusRetryOptions.cs.html#cdf1b0ed863b1af5" class="i property">TryTimeout</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the</span>
        <span class="c">///</span><span class="c"> operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The message received. Returns null if no message is found.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="c59a6150722beca5" href="../R/c59a6150722beca5.html" target="n" data-glyph="72,1" class="i method">ReceiveMessageAsync</a>(
            <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>? <span id="r42 rd" class="r42 r">maxWaitTime</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r41 rd" class="r41 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r43 rd" class="r43 r">result</span> = <b>await</b> <a href="#7ee373e6d1bdf86c" class="i method">ReceiveMessagesAsync</a>(
                <span class="r28 r">maxMessages</span>: 1,
                <span class="r29 r">maxWaitTime</span>: <span class="r42 r">maxWaitTime</span>,
                <span class="r30 r">cancellationToken</span>: <span class="r41 r">cancellationToken</span>)
                .<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <b>foreach</b> (<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r44 rd" class="r44 r">message</span> <b>in</b> <span class="r43 r">result</span>)
            {
                <b>return</b> <span class="r44 r">message</span>;
            }
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Fetches the next active </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> without changing the state of the receiver or the message source.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">fromSequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional sequence number from where to peek the</span>
        <span class="c">///</span><span class="c"> message. This corresponds to the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the</span>
        <span class="c">///</span><span class="c"> operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The first call to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#d6c6e276fd092ca1" class="i method">PeekMessageAsync</a>(<b>long</b>?, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> fetches the first active message for this receiver. Each subsequent call fetches the subsequent message in the entity.</span>
        <span class="c">///</span><span class="c"> Unlike a received message, a peeked message will not have a lock token associated with it, and hence it cannot be Completed/Abandoned/Deferred/Deadlettered/Renewed.</span>
        <span class="c">///</span><span class="c"> Also, unlike </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#c59a6150722beca5" class="i method">ReceiveMessageAsync</a>(<a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>?, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, this method will fetch even Deferred messages (but not Deadlettered message).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that represents the next message to be read. Returns null when nothing to peek.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="d6c6e276fd092ca1" href="../R/d6c6e276fd092ca1.html" target="n" data-glyph="72,1" class="i method">PeekMessageAsync</a>(
            <b>long</b>? <span id="r45 rd" class="r45 r">fromSequenceNumber</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r46 rd" class="r46 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r47 rd" class="r47 r">result</span> = <b>await</b> <a href="#3c4dc9c37e293d23" class="i method">PeekMessagesInternalAsync</a>(
                <span class="r48 r">sequenceNumber</span>: <span class="r45 r">fromSequenceNumber</span>,
                <span class="r49 r">maxMessages</span>: 1,
                <span class="r50 r">cancellationToken</span>: <span class="r46 r">cancellationToken</span>)
                .<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <b>foreach</b> (<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r51 rd" class="r51 r">message</span> <b>in</b> <span class="r47 r">result</span>)
            {
                <b>return</b> <span class="r51 r">message</span>;
            }
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> Fetches a list of active messages without changing the state of the receiver or the message source.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">maxMessages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum number of messages that will be fetched.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">fromSequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional sequence number from where to peek the</span>
        <span class="c">///</span><span class="c"> message. This corresponds to the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel</span>
        <span class="c">///</span><span class="c"> the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Unlike a received message, a peeked message will not have a lock token associated with it, and hence it cannot be</span>
        <span class="c">///</span><span class="c"> Completed/Abandoned/Deferred/Deadlettered/Renewed.</span>
        <span class="c">///</span><span class="c"> Also, unlike </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#c59a6150722beca5" class="i method">ReceiveMessageAsync</a>(<a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>?, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, this method will fetch even Deferred messages (but not Deadlettered messages).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>{<span class="r55 r t">ServiceBusReceivedMessage</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> of messages that were peeked.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="af2b1b87d95a14d3" href="../R/af2b1b87d95a14d3.html" target="n" data-glyph="72,1" class="i method">PeekMessagesAsync</a>(
            <b>int</b> <span id="r52 rd" class="r52 r">maxMessages</span>,
            <b>long</b>? <span id="r53 rd" class="r53 r">fromSequenceNumber</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r54 rd" class="r54 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#3c4dc9c37e293d23" class="i method">PeekMessagesInternalAsync</a>(
                <span class="r48 r">sequenceNumber</span>: <span class="r53 r">fromSequenceNumber</span>,
                <span class="r49 r">maxMessages</span>: <span class="r52 r">maxMessages</span>,
                <span class="r50 r">cancellationToken</span>: <span class="r54 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Fetches a list of active messages without changing the state of the receiver or the message source.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number from where to peek the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">maxMessages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum number of messages that will be fetched.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#b19f71a84062554b" class="t t">IList</a>{<span class="r56 r t">ServiceBusReceivedMessage</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> of messages that were peeked.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="3c4dc9c37e293d23" href="../R/3c4dc9c37e293d23.html" target="n" data-glyph="76,1" class="i method">PeekMessagesInternalAsync</a>(
            <b>long</b>? <span id="r48 rd" class="r48 r">sequenceNumber</span>,
            <b>int</b> <span id="r49 rd" class="r49 r">maxMessages</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r50 rd" class="r50 r">cancellationToken</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#f10450d3147666fe" class="i method">AssertAtLeast</a>(<span class="r49 r">maxMessages</span>, 1, <b>nameof</b>(<span class="r49 r">maxMessages</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <span class="r50 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#5876f7df1971620e" class="i method">PeekMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r48 r">sequenceNumber</span>, <span class="r49 r">maxMessages</span>);
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r57 rd" class="r57 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#29b30ff44f7b643c" class="i property">PeekActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#98ff0ae76fdff1e0" class="i field">ProducerKind</a>);
            <span class="r57 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r58 rd" class="r58 r">messages</span>;
            <b>try</b>
            {
                <span class="r58 r">messages</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#8b9125fd17ff3c99" class="i method">PeekMessagesAsync</a>(
                    <span class="r48 r">sequenceNumber</span>,
                    <span class="r49 r">maxMessages</span>,
                    <span class="r50 r">cancellationToken</span>)
                    .<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r59 rd" class="r59 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#9b90b48c96b1cd6d" class="i method">PeekMessageException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r59 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r57 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r59 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#8bb115597076db5a" class="i method">PeekMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r58 r">messages</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a>);
            <span class="r57 r">scope</span>.<a href="../Diagnostics/DiagnosticExtensions.cs.html#064476776858c575" class="i method">SetMessageData</a>(<span class="r58 r">messages</span>);
            <b>return</b> <span class="r58 r">messages</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Opens an AMQP link for use with receiver operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="beee9d772c566d41" href="../R/beee9d772c566d41.html" target="n" data-glyph="74,1" class="i method">OpenLinkAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r60 rd" class="r60 r">cancellationToken</span>) =&gt;
            <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#5e9e577c1ca9edde" class="i method">OpenLinkAsync</a>(<span class="r60 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Completes a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. This will delete the message from the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The message to complete.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on a message that was received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the message has expired or the message has already been completed. This does not apply for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#24c3e8e66e991e64" class="i field">MessageLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the session has expired or the message has already been completed. This only applies for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#154197a09721ceaf" class="i field">SessionLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="207f693c96ca8ab2" href="../R/207f693c96ca8ab2.html" target="n" data-glyph="72,1" class="i method">CompleteMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r61 rd" class="r61 r">message</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r62 rd" class="r62 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r61 r">message</span>, <b>nameof</b>(<span class="r61 r">message</span>));
            <b>await</b> <a href="#c7fffc01f13bdfdf" class="i method">CompleteMessageAsync</a>(<span class="r61 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a>, <span class="r62 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Completes a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. This will delete the message from the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r63 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> message to complete.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r64 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on a message that was received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c7fffc01f13bdfdf" href="../R/c7fffc01f13bdfdf.html" target="n" data-glyph="74,1" class="i method">CompleteMessageAsync</a>(
            <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r63 rd" class="r63 r">lockToken</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r64 rd" class="r64 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#56d5fd659c8ced55" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r63 r">lockToken</span>);
            <span class="r64 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#c166c5ca3dcb36c2" class="i method">CompleteMessageStart</a>(
                <a href="#d4035be49ac784db" class="i property">Identifier</a>,
                1,
                <span class="r63 r">lockToken</span>);
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r65 rd" class="r65 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#957895debbf51f2a" class="i property">CompleteActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
            <span class="r65 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#ed0ce50af0d03fa5" class="i method">CompleteAsync</a>(
                    <span class="r63 r">lockToken</span>,
                    <span class="r64 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r66 rd" class="r66 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#625b9c0765b86fa2" class="i method">CompleteMessageException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r66 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r65 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r66 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#62fb0746372daa99" class="i method">CompleteMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandons a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.This will make the message available again for immediate processing as the lock on the message held by the receiver will be released.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to abandon.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while abandoning the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandoning a message will increase the delivery count on the message.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">  </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the message has expired or the message has already been completed. This does not apply for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#24c3e8e66e991e64" class="i field">MessageLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the session has expired or the message has already been completed. This only applies for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#154197a09721ceaf" class="i field">SessionLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f2549f24c4d6f13d" href="../R/f2549f24c4d6f13d.html" target="n" data-glyph="72,1" class="i method">AbandonMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r67 rd" class="r67 r">message</span>,
            <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r68 rd" class="r68 r">propertiesToModify</span> = <b>null</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r69 rd" class="r69 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r67 r">message</span>, <b>nameof</b>(<span class="r67 r">message</span>));
            <b>await</b> <a href="#da7e75bfc42642bb" class="i method">AbandonMessageAsync</a>(
                <span class="r67 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a>,
                <span class="r68 r">propertiesToModify</span>,
                <span class="r69 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandons a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. This will make the message available again for processing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to abandon.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r71 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while abandoning the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandoning a message will increase the delivery count on the message.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="da7e75bfc42642bb" href="../R/da7e75bfc42642bb.html" target="n" data-glyph="74,1" class="i method">AbandonMessageAsync</a>(
            <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r70 rd" class="r70 r">lockToken</span>,
            <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r71 rd" class="r71 r">propertiesToModify</span> = <b>null</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r72 rd" class="r72 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#56d5fd659c8ced55" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r70 r">lockToken</span>);
            <span class="r72 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#8803e71d3f1aa3e9" class="i method">AbandonMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r70 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r73 rd" class="r73 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#3cb9c5c4c0af6cf2" class="i property">AbandonActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
 
            <span class="r73 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#c0b749b56e64f30a" class="i method">AbandonAsync</a>(
                    <span class="r70 r">lockToken</span>,
                    <span class="r71 r">propertiesToModify</span>,
                    <span class="r72 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r74 rd" class="r74 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#a5487995fd237266" class="i method">AbandonMessageException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r74 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r73 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r74 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#a100278c0677cb21" class="i method">AbandonMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while moving to subqueue.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue or transfer dead-letter queue,</span>
        <span class="c">///</span><span class="c"> set the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>.<a href="ServiceBusReceiverOptions.cs.html#b9d51848e5be6bd1" class="i property">SubQueue</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> property to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#330a7d372e2c616e" class="i field">DeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#7c38331c3a2322cd" class="i field">TransferDeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> when calling</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#692483b0b2ae13d8" class="i method">CreateReceiver</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#cd9067921d79a6c5" class="i method">CreateReceiver</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the message has expired or the message has already been completed. This does not apply for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#24c3e8e66e991e64" class="i field">MessageLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the session has expired or the message has already been completed. This only applies for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#154197a09721ceaf" class="i field">SessionLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="2d65a06b6ff02cfe" href="../R/2d65a06b6ff02cfe.html" target="n" data-glyph="72,1" class="i method">DeadLetterMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r75 rd" class="r75 r">message</span>,
            <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r76 rd" class="r76 r">propertiesToModify</span> = <b>null</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r77 rd" class="r77 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r75 r">message</span>, <b>nameof</b>(<span class="r75 r">message</span>));
            <b>await</b> <a href="#a7a38555de01992b" class="i method">DeadLetterMessageAsync</a>(
                <span class="r78 r">lockToken</span>: <span class="r75 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a>,
                <span class="r79 r">propertiesToModify</span>: <span class="r76 r">propertiesToModify</span>,
                <span class="r80 r">cancellationToken</span>: <span class="r77 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while moving to subqueue.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue or transfer dead-letter queue,</span>
        <span class="c">///</span><span class="c"> set the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>.<a href="ServiceBusReceiverOptions.cs.html#b9d51848e5be6bd1" class="i property">SubQueue</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> property to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#330a7d372e2c616e" class="i field">DeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#7c38331c3a2322cd" class="i field">TransferDeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> when calling</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#692483b0b2ae13d8" class="i method">CreateReceiver</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#cd9067921d79a6c5" class="i method">CreateReceiver</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a7a38555de01992b" href="../R/a7a38555de01992b.html" target="n" data-glyph="74,1" class="i method">DeadLetterMessageAsync</a>(
            <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r78 rd" class="r78 r">lockToken</span>,
            <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r79 rd" class="r79 r">propertiesToModify</span> = <b>null</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r80 rd" class="r80 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#f5bacd955876d5be" class="i method">DeadLetterInternalAsync</a>(
                <span class="r81 r">lockToken</span>: <span class="r78 r">lockToken</span>,
                <span class="r82 r">propertiesToModify</span>: <span class="r79 r">propertiesToModify</span>,
                <span class="r83 r">cancellationToken</span>: <span class="r80 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r84 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r85 r">deadLetterReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">deadLetterErrorDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The error description for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue or transfer dead-letter queue,</span>
        <span class="c">///</span><span class="c"> set the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>.<a href="ServiceBusReceiverOptions.cs.html#b9d51848e5be6bd1" class="i property">SubQueue</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> property to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#330a7d372e2c616e" class="i field">DeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#7c38331c3a2322cd" class="i field">TransferDeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> when calling</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#692483b0b2ae13d8" class="i method">CreateReceiver</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#cd9067921d79a6c5" class="i method">CreateReceiver</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">  </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the message has expired or the message has already been completed. This does not apply for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#24c3e8e66e991e64" class="i field">MessageLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the session has expired or the message has already been completed. This only applies for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#154197a09721ceaf" class="i field">SessionLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="1118bfe0e545c788" href="../R/1118bfe0e545c788.html" target="n" data-glyph="72,1" class="i method">DeadLetterMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r84 rd" class="r84 r">message</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r85 rd" class="r85 r">deadLetterReason</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r86 rd" class="r86 r">deadLetterErrorDescription</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r87 rd" class="r87 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r84 r">message</span>, <b>nameof</b>(<span class="r84 r">message</span>));
            <b>await</b> <a href="#f01b8440a05777ab" class="i method">DeadLetterMessageAsync</a>(
                <span class="r88 r">lockToken</span>: <span class="r84 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a>,
                <span class="r89 r">deadLetterReason</span>: <span class="r85 r">deadLetterReason</span>,
                <span class="r90 r">deadLetterErrorDescription</span>: <span class="r86 r">deadLetterErrorDescription</span>,
                <span class="r91 r">cancellationToken</span>: <span class="r87 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r88 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r89 r">deadLetterReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r90 r">deadLetterErrorDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The error description for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue, you will need a new </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, with the corresponding path.</span>
        <span class="c">///</span><span class="c"> You can use EntityNameHelper.FormatDeadLetterPath(string) to help with this.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f01b8440a05777ab" href="../R/f01b8440a05777ab.html" target="n" data-glyph="74,1" class="i method">DeadLetterMessageAsync</a>(
            <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r88 rd" class="r88 r">lockToken</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r89 rd" class="r89 r">deadLetterReason</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r90 rd" class="r90 r">deadLetterErrorDescription</span> = <b>null</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r91 rd" class="r91 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#f5bacd955876d5be" class="i method">DeadLetterInternalAsync</a>(
                <span class="r81 r">lockToken</span>: <span class="r88 r">lockToken</span>,
                <span class="r92 r">deadLetterReason</span>: <span class="r89 r">deadLetterReason</span>,
                <span class="r93 r">deadLetterErrorDescription</span>: <span class="r90 r">deadLetterErrorDescription</span>,
                <span class="r83 r">cancellationToken</span>: <span class="r91 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">deadLetterReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">deadLetterErrorDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The error description for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r82 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while deferring the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue, you will need a new </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, with the corresponding path.</span>
        <span class="c">///</span><span class="c"> You can use EntityNameHelper.FormatDeadLetterPath(string) to help with this.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f5bacd955876d5be" href="../R/f5bacd955876d5be.html" target="n" data-glyph="76,1" class="i method">DeadLetterInternalAsync</a>(
            <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r81 rd" class="r81 r">lockToken</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r92 rd" class="r92 r">deadLetterReason</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r93 rd" class="r93 r">deadLetterErrorDescription</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r82 rd" class="r82 r">propertiesToModify</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r83 rd" class="r83 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#56d5fd659c8ced55" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r81 r">lockToken</span>);
            <span class="r83 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#2c7a226c08880160" class="i method">DeadLetterMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r81 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r94 rd" class="r94 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#0271c0346bd22872" class="i property">DeadLetterActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
 
            <span class="r94 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#59c19ba4708f2b49" class="i method">DeadLetterAsync</a>(
                    <span class="r95 r">lockToken</span>: <span class="r81 r">lockToken</span>,
                    <span class="r96 r">deadLetterReason</span>: <span class="r92 r">deadLetterReason</span>,
                    <span class="r97 r">deadLetterErrorDescription</span>: <span class="r93 r">deadLetterErrorDescription</span>,
                    <span class="r98 r">propertiesToModify</span>: <span class="r82 r">propertiesToModify</span>,
                    <span class="r99 r">cancellationToken</span>: <span class="r83 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r100 rd" class="r100 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#0e5f1b24696358a2" class="i method">DeadLetterMessageException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r100 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r94 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r100 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#081d2b952ca70d8d" class="i method">DeadLetterMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c"> Indicates that the receiver wants to defer the processing for the message.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to defer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r102 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while deferring the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In order to receive this message again in the future, you will need to save the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> and receive it using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#ea15f76ea7a8737c" class="i method">ReceiveDeferredMessageAsync</a>(<b>long</b>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> Deferring messages does not impact message&#39;s expiration, meaning that deferred messages can still expire.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">  </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the message has expired or the message has already been completed. This does not apply for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#24c3e8e66e991e64" class="i field">MessageLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the session has expired or the message has already been completed. This only applies for session-enabled</span>
        <span class="c">///</span><span class="c">   entities.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#154197a09721ceaf" class="i field">SessionLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f9bf0d550a2d4496" href="../R/f9bf0d550a2d4496.html" target="n" data-glyph="72,1" class="i method">DeferMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r101 rd" class="r101 r">message</span>,
            <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r102 rd" class="r102 r">propertiesToModify</span> = <b>null</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r103 rd" class="r103 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r101 r">message</span>, <b>nameof</b>(<span class="r101 r">message</span>));
            <b>await</b> <a href="#bf0e3f0aa535cad9" class="i method">DeferMessageAsync</a>(
                <span class="r101 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a>,
                <span class="r102 r">propertiesToModify</span>,
                <span class="r103 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c"> Indicates that the receiver wants to defer the processing for the message.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lockToken of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to defer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while deferring the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive this message again in the future, you will need to save the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> and receive it using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#ea15f76ea7a8737c" class="i method">ReceiveDeferredMessageAsync</a>(<b>long</b>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> Deferring messages does not impact message&#39;s expiration, meaning that deferred messages can still expire.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="bf0e3f0aa535cad9" href="../R/bf0e3f0aa535cad9.html" target="n" data-glyph="74,1" class="i method">DeferMessageAsync</a>(
            <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r104 rd" class="r104 r">lockToken</span>,
            <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r105 rd" class="r105 r">propertiesToModify</span> = <b>null</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r106 rd" class="r106 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#56d5fd659c8ced55" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r104 r">lockToken</span>);
            <span class="r106 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#6a300bc31b3ab499" class="i method">DeferMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r104 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r107 rd" class="r107 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#6fe7e3b2015c018e" class="i property">DeferActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
 
            <span class="r107 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#ebfc58d55423a515" class="i method">DeferAsync</a>(
                    <span class="r104 r">lockToken</span>,
                    <span class="r105 r">propertiesToModify</span>,
                    <span class="r106 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r108 rd" class="r108 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#15d98431927591e4" class="i method">DeferMessageException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r108 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r107 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r108 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#16b9dac7478b7031" class="i method">DeferMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Throws an InvalidOperationException when not in PeekLock mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="5209b6cdcb72436f" href="../R/5209b6cdcb72436f.html" target="n" data-glyph="76,1" class="i method">ThrowIfNotPeekLockMode</a>()
        {
            <b>if</b> (<a href="#108a285bc4afe119" class="i property">ReceiveMode</a> != <a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a>)
            {
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#bda208fb05ecc3ab" class="i property">OperationNotSupported</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Throws an InvalidOperationException when the lock token is empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="56d5fd659c8ced55" href="../R/56d5fd659c8ced55.html" target="n" data-glyph="76,1" class="i method">ThrowIfLockTokenIsEmpty</a>(<a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r109 rd" class="r109 r">lockToken</span>)
        {
            <b>if</b> (<span class="r109 r">lockToken</span> == <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@1@netstandard/A.html#13baca63417ef924" class="i field">Empty</a>)
            {
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#d993a5f20bbfffee" class="i property">PeekLockModeRequired</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a deferred message identified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r110 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number of the message to receive. This corresponds to</span>
        <span class="c">///</span><span class="c"> the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The deferred message identified by the specified sequence number. Returns null if no message is found.</span>
        <span class="c">///</span><span class="c"> Throws if the message has not been deferred.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#f9bf0d550a2d4496" class="i method">DeferMessageAsync</a>(<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>, <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>{<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>}, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#bf0e3f0aa535cad9" class="i method">DeferMessageAsync</a>(<a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a>, <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>{<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>}, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="ea15f76ea7a8737c" href="../R/ea15f76ea7a8737c.html" target="n" data-glyph="72,1" class="i method">ReceiveDeferredMessageAsync</a>(
            <b>long</b> <span id="r110 rd" class="r110 r">sequenceNumber</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r111 rd" class="r111 r">cancellationToken</span> = <b>default</b>) =&gt;
            (<b>await</b> <a href="#2f7306ae70accc9e" class="i method">ReceiveDeferredMessagesAsync</a>(<b>new</b> <b>long</b>[] { <span class="r110 r">sequenceNumber</span> }, <span class="r111 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>))[0];
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#b19f71a84062554b" class="t t">IList</a>{<span class="r112 r t">ServiceBusReceivedMessage</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> of deferred messages identified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">sequenceNumbers</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r113 r">sequenceNumbers</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>{<span class="r115 r t">T</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> containing the sequence numbers to receive.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Messages identified by sequence number are returned. Returns null if no messages are found.</span>
        <span class="c">///</span><span class="c"> Throws if the messages have not been deferred.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#f9bf0d550a2d4496" class="i method">DeferMessageAsync</a>(<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>, <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>{<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>}, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#bf0e3f0aa535cad9" class="i method">DeferMessageAsync</a>(<a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a>, <a href="@1@netstandard/A.html#20343df0c96b629b" class="t t">IDictionary</a>{<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>}, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The specified sequence number does not correspond to a message that has been deferred.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#c75774c4c35467e3" class="i field">MessageNotFound</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="2f7306ae70accc9e" href="../R/2f7306ae70accc9e.html" target="n" data-glyph="72,1" class="i method">ReceiveDeferredMessagesAsync</a>(
            <a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>long</b>&gt; <span id="r113 rd" class="r113 r">sequenceNumbers</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r114 rd" class="r114 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r113 r">sequenceNumbers</span>, <b>nameof</b>(<span class="r113 r">sequenceNumbers</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <span class="r114 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <span class="c">// the sequence numbers MUST be in array form for them to be encoded correctly</span>
            <b>long</b>[] <span id="r116 rd" class="r116 r">sequenceArray</span> = <span class="r113 r">sequenceNumbers</span> <b>switch</b>
            {
                <b>long</b>[] <span id="r117 rd" class="r117 r">alreadyArray</span> =&gt; <span class="r117 r">alreadyArray</span>,
                <b>_</b> =&gt; <span class="r113 r">sequenceNumbers</span>.<a href="@1@netstandard/A.html#783a052330e7d48d" class="i method">ToArray</a>()
            };
 
            <b>if</b> (<span class="r116 r">sequenceArray</span>.<a href="@1@netstandard/A.html#42e9b7616956cf94" class="i property">Length</a> == 0)
            {
                <b>return</b> <a href="@1@netstandard/A.html#156e066ecc4ccedf" class="t t">Array</a>.<a href="@1@netstandard/A.html#bc9fd1be0e4f4e70" class="i method">Empty</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;();
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#dd66a0ad9b694b8d" class="i method">ReceiveDeferredMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r116 r">sequenceArray</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r118 rd" class="r118 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#00dc0bad934c577d" class="i property">ReceiveDeferredActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#15794f37dea7f04e" class="i field">ConsumerKind</a>);
 
            <span class="r118 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r119 rd" class="r119 r">deferredMessages</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r119 r">deferredMessages</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#3946bd85e7733f38" class="i method">ReceiveDeferredMessagesAsync</a>(
                    <span class="r116 r">sequenceArray</span>,
                    <span class="r114 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r120 rd" class="r120 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#f87a521361267bcb" class="i method">ReceiveDeferredMessageException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r120 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r118 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r120 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#57ffdc77637d2359" class="i method">ReceiveDeferredMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r119 r">deferredMessages</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a>);
            <span class="r118 r">scope</span>.<a href="../Diagnostics/DiagnosticExtensions.cs.html#064476776858c575" class="i method">SetMessageData</a>(<span class="r119 r">deferredMessages</span>);
            <b>return</b> <span class="r119 r">deferredMessages</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renews the lock on the message. The lock will be renewed based on the setting specified on the queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When a message is received in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode, the message is locked on the server for this</span>
        <span class="c">///</span><span class="c"> receiver instance for a duration as specified during the Queue/Subscription creation (LockDuration).</span>
        <span class="c">///</span><span class="c"> If processing of the message requires longer than this duration, the lock needs to be renewed.</span>
        <span class="c">///</span><span class="c"> For each renewal, it resets the time the message is locked by the LockDuration set on the Entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r121 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to renew the lock for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r122 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The lock for the message has expired or the message has already been completed.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#24c3e8e66e991e64" class="i field">MessageLockLost</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="9624d01ed86f58b6" href="../R/9624d01ed86f58b6.html" target="n" data-glyph="72,1" class="i method">RenewMessageLockAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r121 rd" class="r121 r">message</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r122 rd" class="r122 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r121 r">message</span>, <b>nameof</b>(<span class="r121 r">message</span>));
            <a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r123 rd" class="r123 r">lockedUntil</span> = <b>await</b> <a href="#845b73cd8d9a4bfc" class="i method">RenewMessageLockAsync</a>(
                <span class="r121 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#31df56323e0b25d0" class="i property">LockTokenGuid</a>,
                <span class="r122 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            <span class="r121 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#b99268648f10b24f" class="i property">LockedUntil</a> = <span class="r123 r">lockedUntil</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renews the lock on the message. The lock will be renewed based on the setting specified on the queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When a message is received in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode, the message is locked on the server for this</span>
        <span class="c">///</span><span class="c"> receiver instance for a duration as specified during the Queue/Subscription creation (LockDuration).</span>
        <span class="c">///</span><span class="c"> If processing of the message requires longer than this duration, the lock needs to be renewed.</span>
        <span class="c">///</span><span class="c"> For each renewal, it resets the time the message is locked by the LockDuration set on the Entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r124 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lockToken of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to renew the lock for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r125 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>&gt; <a id="845b73cd8d9a4bfc" href="../R/845b73cd8d9a4bfc.html" target="n" data-glyph="74,1" class="i method">RenewMessageLockAsync</a>(
            <a href="@1@netstandard/A.html#b622ef5f6b76c10a" class="t t">Guid</a> <span id="r124 rd" class="r124 r">lockToken</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r125 rd" class="r125 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#1cdfd765c09d7df8" class="i method">ThrowIfSessionReceiver</a>();
            <a href="#56d5fd659c8ced55" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r124 r">lockToken</span>);
            <span class="r125 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#5f6815a9a4e421ef" class="i method">RenewMessageLockStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r124 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r126 rd" class="r126 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#cbb4a52de7c9a84f" class="i property">RenewMessageLockActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
            <span class="r126 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r127 rd" class="r127 r">lockedUntil</span>;
            <b>try</b>
            {
                <span class="r127 r">lockedUntil</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#597dbbfc65e387cd" class="i method">RenewMessageLockAsync</a>(
                    <span class="r124 r">lockToken</span>,
                    <span class="r125 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r128 rd" class="r128 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#8070e12b4dbbe32c" class="i method">RenewMessageLockException</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r128 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r126 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r128 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#2d7f35a2ec4c509f" class="i method">RenewMessageLockComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
            <b>return</b> <span class="r127 r">lockedUntil</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Throws an exception if the receiver instance is a session receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="1cdfd765c09d7df8" href="../R/1cdfd765c09d7df8.html" target="n" data-glyph="76,1" class="i method">ThrowIfSessionReceiver</a>()
        {
            <b>if</b> (<a href="#e41b70ce2d96cf67" class="i property">IsSessionReceiver</a>)
            {
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#de6fd04c30e2deac" class="i property">CannotLockMessageOnSessionEntity</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs the task needed to clean up resources used by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> This is equivalent to calling </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#df18551746849ff4" class="i method">CloseAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<a href="@1@netstandard/A.html#5e00de6576fb9ce7" class="t constructor">SuppressMessage</a>(<span class="s">&quot;Usage&quot;</span>, <span class="s">&quot;AZC0002:Ensure all service methods take an optional CancellationToken parameter.&quot;</span>,
            <a href="@1@netstandard/A.html#ce02a652a479502a" class="i property">Justification</a> = <span class="s">&quot;This signature must match the IAsyncDisposable interface.&quot;</span>)]
        <b>public virtual async</b> <span class="t t">ValueTask</span> <a id="9aab2bee052c5c07" href="../R/9aab2bee052c5c07.html" target="n" data-glyph="72,1" class="i method">DisposeAsync</a>()
        {
            <b>await</b> <a href="#df18551746849ff4" class="i method">CloseAsync</a>().<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            <a href="@1@netstandard/A.html#25d9c1e022317a99" class="t t">GC</a>.<a href="@1@netstandard/A.html#2673f5220a565bf2" class="i method">SuppressFinalize</a>(<a href="#2224f17dabcb26c3" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines whether the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r129 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to compare with this instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override bool</b> <a id="67251f997686835e" href="../R/67251f997686835e.html" target="n" data-glyph="72,1" class="i method">Equals</a>(<b>object</b> <span id="r129 rd" class="r129 r">obj</span>) =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#517682d5f6f4f8b4" class="i method">Equals</a>(<span class="r129 r">obj</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a hash code for this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A hash code for this instance, suitable for use in hashing algorithms and data structures like a hash table.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override int</b> <a id="c7ee0178a33be869" href="../R/c7ee0178a33be869.html" target="n" data-glyph="72,1" class="i method">GetHashCode</a>() =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#4de9cf234d0d8b16" class="i method">GetHashCode</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts the instance to string representation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="t t">String</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that represents this instance.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override string</b> <a id="0ebd993a82f5722c" href="../R/0ebd993a82f5722c.html" target="n" data-glyph="72,1" class="i method">ToString</a>() =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
    }
}
</pre></td></tr></table></div></body></html>
