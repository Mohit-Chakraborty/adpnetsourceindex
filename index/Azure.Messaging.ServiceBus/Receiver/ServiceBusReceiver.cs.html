<!DOCTYPE html>
<html><head><title>ServiceBusReceiver.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(1075);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.ServiceBus/Receiver/ServiceBusReceiver.cs" target="_top">Receiver\ServiceBusReceiver.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.ServiceBus" target="_top">src\Azure.Messaging.ServiceBus.csproj</a> (Azure.Messaging.ServiceBus)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Diagnostics</span>.<span class="i">CodeAnalysis</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Runtime</span>.<span class="i">CompilerServices</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Plugins</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is responsible for receiving</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> and settling messages from Queues and Subscriptions.</span>
    <span class="c">///</span><span class="c"> It is constructed by calling </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#692483b0b2ae13d8" class="i method">CreateReceiver</a>(<b>string</b>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="2224f17dabcb26c3" href="../R/2224f17dabcb26c3.html" target="n" data-glyph="0,0" class="t t">ServiceBusReceiver</a> : <span class="i">IAsyncDisposable</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The fully qualified Service Bus namespace that the receiver is associated with.  This is likely</span>
        <span class="c">///</span><span class="c"> to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="a984eb4152b78f79" href="../R/a984eb4152b78f79.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedNamespace</a> =&gt; <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path of the Service Bus entity that the receiver is connected to, specific to the</span>
        <span class="c">///</span><span class="c"> Service Bus namespace that contains it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="933d55dc873c8dc1" href="../R/933d55dc873c8dc1.html" target="n" data-glyph="102,1" class="i property">EntityPath</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> used to specify how messages are received. Defaults to PeekLock mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a> <a id="108a285bc4afe119" href="../R/108a285bc4afe119.html" target="n" data-glyph="102,1" class="i property">ReceiveMode</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Indicates whether the receiver entity is session enabled.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="e41b70ce2d96cf67" href="../R/e41b70ce2d96cf67.html" target="n" data-glyph="104,1" class="i property">IsSessionReceiver</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of messages that will be eagerly requested from Queues or Subscriptions and queued locally without regard to</span>
        <span class="c">///</span><span class="c"> whether a processing is currently active, intended to help maximize throughput by allowing the receiver to receive</span>
        <span class="c">///</span><span class="c"> from a local cache rather than waiting on a service request.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public int</b> <a id="30eab00d86cecbdf" href="../R/30eab00d86cecbdf.html" target="n" data-glyph="102,1" class="i property">PrefetchCount</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the ID to identify this client. This can be used to correlate logs and exceptions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Every new client has a unique ID.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="d4035be49ac784db" href="../R/d4035be49ac784db.html" target="n" data-glyph="104,1" class="i property">Identifier</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates whether or not this </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the receiver is closed; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="2fb390c9488d131a" href="../R/2fb390c9488d131a.html" target="n" data-glyph="102,1" class="i property">IsClosed</a>
        {
            <b>get</b> =&gt; <a href="#56e7ddb7f663f250" class="i field">_closed</a>;
            <b>private set</b> =&gt; <a href="#56e7ddb7f663f250" class="i field">_closed</a> = <b>value</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Indicates whether or not this instance has been closed.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private volatile bool</b> <a id="56e7ddb7f663f250" href="../R/56e7ddb7f663f250.html" target="n" data-glyph="46,1" class="i field">_closed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The policy to use for determining retry behavior for when an operation fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private readonly</b> <a href="../Primitives/ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <a id="bb7ac00f36147f50" href="../R/bb7ac00f36147f50.html" target="n" data-glyph="46,1" class="i field">_retryPolicy</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The active connection to the Azure Service Bus service, enabling client communications for metadata</span>
        <span class="c">///</span><span class="c"> about the associated Service Bus entity and access to transport-aware receivers.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private readonly</b> <a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a> <a id="aff01fe5ca99ccb1" href="../R/aff01fe5ca99ccb1.html" target="n" data-glyph="46,1" class="i field">_connection</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An abstracted Service Bus transport-specific receiver that is associated with the</span>
        <span class="c">///</span><span class="c"> Service Bus entity gateway; intended to perform delegated operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../Core/TransportReceiver.cs.html#1b072fa1ddd22c6a" class="t t">TransportReceiver</a> <a id="ccb12450e5be9b61" href="../R/ccb12450e5be9b61.html" target="n" data-glyph="104,1" class="i property">InnerReceiver</a> =&gt; <a href="#7f7bba5a9a9bc62d" class="i field">_innerReceiver</a>;
        <b>private readonly</b> <a href="../Core/TransportReceiver.cs.html#1b072fa1ddd22c6a" class="t t">TransportReceiver</a> <a id="7f7bba5a9a9bc62d" href="../R/7f7bba5a9a9bc62d.html" target="n" data-glyph="46,1" class="i field">_innerReceiver</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Responsible for creating entity scopes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#9100164b526814a3" class="t t">EntityScopeFactory</a> <a id="1dd76242085124b3" href="../R/1dd76242085124b3.html" target="n" data-glyph="104,1" class="i property">ScopeFactory</a> =&gt; <a href="#e59d06eca12aeaae" class="i field">_scopeFactory</a>;
        <b>private readonly</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#9100164b526814a3" class="t t">EntityScopeFactory</a> <a id="e59d06eca12aeaae" href="../R/e59d06eca12aeaae.html" target="n" data-glyph="46,1" class="i field">_scopeFactory</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The list of plugins to apply to incoming messages.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private readonly</b> <span class="i">IList</span>&lt;<a href="../Plugins/ServiceBusPlugin.cs.html#5ee21a6788ad51aa" class="t t">ServiceBusPlugin</a>&gt; <a id="70bf3cbbe8cf8109" href="../R/70bf3cbbe8cf8109.html" target="n" data-glyph="46,1" class="i field">_plugins</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The instance of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> which can be mocked for testing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a> <a id="70e55ac811fb8d3b" href="../R/70e55ac811fb8d3b.html" target="n" data-glyph="104,1" class="i property">Logger</a> { <b>get</b>; <b>set</b>; } = <a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#9494c77d3f8244ec" class="i property">Log</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">connection</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> connection to use for communication with the Service Bus service.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">entityPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">isSessionEntity</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">plugins</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The plugins to apply to incoming messages.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A set of options to apply when configuring the consumer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">sessionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional session Id to scope the receiver to. If not specified,</span>
        <span class="c">///</span><span class="c"> the next available session returned from the service will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a id="e02923711e2924c9" href="../R/e02923711e2924c9.html" target="n" data-glyph="74,1" class="t constructor">ServiceBusReceiver</a>(
            <a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a> <span id="r0 rd" class="r0 r">connection</span>,
            <b>string</b> <span id="r1 rd" class="r1 r">entityPath</span>,
            <b>bool</b> <span id="r2 rd" class="r2 r">isSessionEntity</span>,
            <span class="i">IList</span>&lt;<a href="../Plugins/ServiceBusPlugin.cs.html#5ee21a6788ad51aa" class="t t">ServiceBusPlugin</a>&gt; <span id="r3 rd" class="r3 r">plugins</span>,
            <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a> <span id="r4 rd" class="r4 r">options</span>,
            <b>string</b> <span id="r5 rd" class="r5 r">sessionId</span> = <b>default</b>)
        {
            <span class="i">Type</span> <span id="r6 rd" class="r6 r">type</span> = <span class="i">GetType</span>();
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">ClientCreateStart</span>(<span class="r6 r">type</span>, <span class="r0 r">connection</span>?.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <span class="r1 r">entityPath</span>);
            <b>try</b>
            {
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r0 r">connection</span>, <b>nameof</b>(<span class="r0 r">connection</span>));
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>, <b>nameof</b>(<span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>));
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#fa55a5c88c3dc11d" class="i method">AssertNotNullOrWhiteSpace</a>(<span class="r1 r">entityPath</span>, <b>nameof</b>(<span class="r1 r">entityPath</span>));
                <span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
 
                <span class="r4 r">options</span> = <span class="r4 r">options</span>?.<a href="ServiceBusReceiverOptions.cs.html#05c41cad1e69501f" class="i method">Clone</a>() ?? <b>new</b> <span class="t">ServiceBusReceiverOptions</span>();
                <a href="#d4035be49ac784db" class="i property">Identifier</a> = <a href="../Diagnostics/DiagnosticUtilities.cs.html#e63dadcef3cbbce1" class="t t">DiagnosticUtilities</a>.<a href="../Diagnostics/DiagnosticUtilities.cs.html#582c96465587da53" class="i method">GenerateIdentifier</a>(<span class="r1 r">entityPath</span>);
                <a href="#aff01fe5ca99ccb1" class="i field">_connection</a> = <span class="r0 r">connection</span>;
                <a href="#bb7ac00f36147f50" class="i field">_retryPolicy</a> = <span class="r0 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>.<a href="../Core/ServiceBusRetryOptionsExtensions.cs.html#d698c84551779460" class="i method">ToRetryPolicy</a>();
                <a href="#108a285bc4afe119" class="i property">ReceiveMode</a> = <span class="r4 r">options</span>.<a href="ServiceBusReceiverOptions.cs.html#67149ea1431eaf19" class="i property">ReceiveMode</a>;
                <a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a> = <span class="r4 r">options</span>.<a href="ServiceBusReceiverOptions.cs.html#02d0c166fba3f0b0" class="i property">PrefetchCount</a>;
 
                <b>switch</b> (<span class="r4 r">options</span>.<a href="ServiceBusReceiverOptions.cs.html#b9d51848e5be6bd1" class="i property">SubQueue</a>)
                {
                    <b>case</b> <a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#840d2090bed37e3c" class="i field">None</a>:
                        <a href="#933d55dc873c8dc1" class="i property">EntityPath</a> = <span class="r1 r">entityPath</span>;
                        <b>break</b>;
                    <b>case</b> <a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#330a7d372e2c616e" class="i field">DeadLetter</a>:
                        <a href="#933d55dc873c8dc1" class="i property">EntityPath</a> = <a href="../EntityNameFormatter.cs.html#a1a69c56795bc65a" class="t t">EntityNameFormatter</a>.<a href="../EntityNameFormatter.cs.html#1e61c967a79f72f9" class="i method">FormatDeadLetterPath</a>(<span class="r1 r">entityPath</span>);
                        <b>break</b>;
                    <b>case</b> <a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#7c38331c3a2322cd" class="i field">TransferDeadLetter</a>:
                        <a href="#933d55dc873c8dc1" class="i property">EntityPath</a> = <a href="../EntityNameFormatter.cs.html#a1a69c56795bc65a" class="t t">EntityNameFormatter</a>.<a href="../EntityNameFormatter.cs.html#43a14fafd715bb85" class="i method">FormatTransferDeadLetterPath</a>(<span class="r1 r">entityPath</span>);
                        <b>break</b>;
                }
 
                <a href="#e41b70ce2d96cf67" class="i property">IsSessionReceiver</a> = <span class="r2 r">isSessionEntity</span>;
                <a href="#7f7bba5a9a9bc62d" class="i field">_innerReceiver</a> = <a href="#aff01fe5ca99ccb1" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#c77bb4d21edfe411" class="i method">CreateTransportReceiver</a>(
                    <span class="r7 r">entityPath</span>: <a href="#933d55dc873c8dc1" class="i property">EntityPath</a>,
                    <span class="r8 r">retryPolicy</span>: <a href="#bb7ac00f36147f50" class="i field">_retryPolicy</a>,
                    <span class="r9 r">receiveMode</span>: <a href="#108a285bc4afe119" class="i property">ReceiveMode</a>,
                    <span class="r10 r">prefetchCount</span>: (<b>uint</b>)<a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a>,
                    <span class="r11 r">identifier</span>: <a href="#d4035be49ac784db" class="i property">Identifier</a>,
                    <span class="r12 r">sessionId</span>: <span class="r5 r">sessionId</span>,
                    <span class="r13 r">isSessionReceiver</span>: <a href="#e41b70ce2d96cf67" class="i property">IsSessionReceiver</a>);
                <a href="#e59d06eca12aeaae" class="i field">_scopeFactory</a> = <b>new</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#5f446a7a93a315a4" class="t constructor">EntityScopeFactory</a>(<a href="#933d55dc873c8dc1" class="i property">EntityPath</a>, <a href="#a984eb4152b78f79" class="i property">FullyQualifiedNamespace</a>);
                <a href="#70bf3cbbe8cf8109" class="i field">_plugins</a> = <span class="r3 r">plugins</span>;
                <b>if</b> (!<span class="r2 r">isSessionEntity</span>)
                {
                    <span class="c">// don&#39;t log client completion for session receiver here as it is not complete until</span>
                    <span class="c">// the link is opened.</span>
                    <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#6896eddc56f74c15" class="i method">ClientCreateComplete</a>(<span class="r6 r">type</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>);
                }
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r14 rd" class="r14 r">ex</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">ClientCreateException</span>(<span class="r6 r">type</span>, <span class="r0 r">connection</span>?.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <span class="r1 r">entityPath</span>, <span class="r14 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class for mocking.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a id="ab34e52b31f988ca" href="../R/ab34e52b31f988ca.html" target="n" data-glyph="75,1" class="t constructor">ServiceBusReceiver</a>() { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the task needed to clean up resources used by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> An optional</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the</span>
        <span class="c">///</span><span class="c"> request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="7a512d9bdcad41ae" href="../R/7a512d9bdcad41ae.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>(
            <span class="i">CancellationToken</span> <span id="r15 rd" class="r15 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="#2fb390c9488d131a" class="i property">IsClosed</a> = <b>true</b>;
            <span class="i">Type</span> <span id="r16 rd" class="r16 r">clientType</span> = <span class="i">GetType</span>();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#8590f36c9c797e97" class="i method">ClientCloseStart</a>(<span class="r16 r">clientType</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>);
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<span class="i">CloseAsync</span>(<span class="i">CancellationToken</span>.<span class="i">None</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r17 rd" class="r17 r">ex</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#4c1e34ec85253b49" class="i method">ClientCloseException</a>(<span class="r16 r">clientType</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r17 r">ex</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#d55c055c998a6157" class="i method">ClientCloseComplete</a>(<span class="r16 r">clientType</span>, <a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a list of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> from the entity using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> defaults to PeekLock mode.</span>
        <span class="c">///</span><span class="c"> This method doesn&#39;t guarantee to return exact `maxMessages` messages,</span>
        <span class="c">///</span><span class="c"> even if there are `maxMessages` messages available in the queue or topic.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">maxMessages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum number of messages that will be received.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">maxWaitTime</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">TimeSpan</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> specifying the maximum time to wait for the first message before returning an empty list if no messages are available.</span>
        <span class="c">///</span><span class="c"> If not specified, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusRetryOptions.cs.html#f405da36db2d38b0" class="t t">ServiceBusRetryOptions</a>.<a href="../Primitives/ServiceBusRetryOptions.cs.html#cdf1b0ed863b1af5" class="i property">TryTimeout</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">List of messages received. Returns an empty list if no message is found.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span>&lt;<span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="298d02da14f066d7" href="../R/298d02da14f066d7.html" target="n" data-glyph="72,1" class="i method">ReceiveMessagesAsync</a>(
           <b>int</b> <span id="r18 rd" class="r18 r">maxMessages</span>,
           <span class="i">TimeSpan</span>? <span id="r19 rd" class="r19 r">maxWaitTime</span> = <b>default</b>,
           <span class="i">CancellationToken</span> <span id="r20 rd" class="r20 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<span class="i">AssertAtLeast</span>(<span class="r18 r">maxMessages</span>, 1, <b>nameof</b>(<span class="r18 r">maxMessages</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <b>if</b> (<span class="r19 r">maxWaitTime</span>.<span class="i">HasValue</span>)
            {
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<span class="i">AssertPositive</span>(<span class="r19 r">maxWaitTime</span>.<span class="i">Value</span>, <b>nameof</b>(<span class="r19 r">maxWaitTime</span>));
            }
            <b>if</b> (<a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a> &gt; 0 &amp;&amp; <span class="r18 r">maxMessages</span> &gt; <a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#2d848d54c97cc098" class="i method">MaxMessagesExceedsPrefetch</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <a href="#30eab00d86cecbdf" class="i property">PrefetchCount</a>, <span class="r18 r">maxMessages</span>);
            }
            <span class="r20 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#96bca9ada968b283" class="i method">ReceiveMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r18 r">maxMessages</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r21 rd" class="r21 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#eaae42b6948ca95b" class="i property">ReceiveActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#15794f37dea7f04e" class="i field">ConsumerKind</a>);
 
            <span class="r21 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r22 rd" class="r22 r">messages</span> = <b>null</b>;
 
            <b>try</b>
            {
                <span class="r22 r">messages</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#1e6488798e2835ab" class="i method">ReceiveMessagesAsync</a>(
                    <span class="r18 r">maxMessages</span>,
                    <span class="r19 r">maxWaitTime</span>,
                    <span class="r20 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
                <b>await</b> <a href="#cf5099bc9d5b23b8" class="i method">ApplyPlugins</a>(<span class="r22 r">messages</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r23 rd" class="r23 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">ReceiveMessageException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r23 r">exception</span>.<span class="i">ToString</span>());
                <span class="r21 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r23 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">ReceiveMessageComplete</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r22 r">messages</span>.<span class="i">Count</span>);
            <span class="r21 r">scope</span>.<span class="i">SetMessageData</span>(<span class="r22 r">messages</span>);
 
            <b>return</b> <span class="r22 r">messages</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives messages as an asynchronous enumerable from the entity using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> defaults to PeekLock mode. Messages will be received from the entity as</span>
        <span class="c">///</span><span class="c"> the IAsyncEnumerable is iterated. If no messages are available, this method will continue polling</span>
        <span class="c">///</span><span class="c"> until messages are available, i.e. it will never return null.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the</span>
        <span class="c">///</span><span class="c"> request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The message received.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">IAsyncEnumerable</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="d00ac5aebd028475" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReceiveMessagesAsync</a>(
            [<span class="i">EnumeratorCancellation</span>]
            <span class="i">CancellationToken</span> <span id="r24 rd" class="r24 r">cancellationToken</span> = <b>default</b>)
        {
            <b>while</b> (!<span class="r24 r">cancellationToken</span>.<span class="i">IsCancellationRequested</span>)
            {
                <b>var</b> <span id="r25 rd" class="r25 r">msg</span> = <b>await</b> <a href="#19d33b51af2ff547" class="i method">ReceiveMessageAsync</a>(<span class="r26 r">cancellationToken</span>: <span class="r24 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
                <b>if</b> (<span class="r25 r">msg</span> == <b>null</b>)
                {
                    <b>continue</b>;
                }
                <b>yield</b> <b>return</b> <span class="r25 r">msg</span>;
            }
 
            <span class="c">// Surface the TCE to ensure deterministic behavior when cancelling.</span>
            <span class="r24 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> from the entity using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> defaults to PeekLock mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">maxWaitTime</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">TimeSpan</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> specifying the maximum time to wait for a message before returning</span>
        <span class="c">///</span><span class="c"> null if no messages are available.</span>
        <span class="c">///</span><span class="c"> If not specified, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusRetryOptions.cs.html#f405da36db2d38b0" class="t t">ServiceBusRetryOptions</a>.<a href="../Primitives/ServiceBusRetryOptions.cs.html#cdf1b0ed863b1af5" class="i property">TryTimeout</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the</span>
        <span class="c">///</span><span class="c"> operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The message received. Returns null if no message is found.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="19d33b51af2ff547" href="../R/19d33b51af2ff547.html" target="n" data-glyph="72,1" class="i method">ReceiveMessageAsync</a>(
            <span class="i">TimeSpan</span>? <span id="r27 rd" class="r27 r">maxWaitTime</span> = <b>default</b>,
            <span class="i">CancellationToken</span> <span id="r26 rd" class="r26 r">cancellationToken</span> = <b>default</b>)
        {
            <span class="i">IEnumerable</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r28 rd" class="r28 r">result</span> = <b>await</b> <a href="#298d02da14f066d7" class="i method">ReceiveMessagesAsync</a>(
                <span class="r18 r">maxMessages</span>: 1,
                <span class="r19 r">maxWaitTime</span>: <span class="r27 r">maxWaitTime</span>,
                <span class="r20 r">cancellationToken</span>: <span class="r26 r">cancellationToken</span>)
                .<span class="i">ConfigureAwait</span>(<b>false</b>);
 
            <b>foreach</b> (<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r29 rd" class="r29 r">message</span> <b>in</b> <span class="r28 r">result</span>)
            {
                <b>return</b> <span class="r29 r">message</span>;
            }
            <b>return</b> <b>null</b>;
        }
 
        <b>private async</b> <span class="i">Task</span> <a id="cf5099bc9d5b23b8" href="../R/cf5099bc9d5b23b8.html" target="n" data-glyph="76,1" class="i method">ApplyPlugins</a>(<span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r30 rd" class="r30 r">messages</span>)
        {
            <b>foreach</b> (<a href="../Plugins/ServiceBusPlugin.cs.html#5ee21a6788ad51aa" class="t t">ServiceBusPlugin</a> <span id="r31 rd" class="r31 r">plugin</span> <b>in</b> <a href="#70bf3cbbe8cf8109" class="i field">_plugins</a>)
            {
                <b>string</b> <span id="r32 rd" class="r32 r">pluginType</span> = <span class="r31 r">plugin</span>.<span class="i">GetType</span>().<span class="i">Name</span>;
                <b>foreach</b> (<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r33 rd" class="r33 r">message</span> <b>in</b> <span class="r30 r">messages</span>)
                {
                    <b>try</b>
                    {
                        <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#1b6b09935438b552" class="i method">PluginCallStarted</a>(<span class="r32 r">pluginType</span>, <span class="r33 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#604c37d7b9ac7f23" class="i property">MessageId</a>);
                        <b>await</b> <span class="r31 r">plugin</span>.<a href="../Plugins/ServiceBusPlugin.cs.html#4c50201b40dfca09" class="i method">AfterMessageReceiveAsync</a>(<span class="r33 r">message</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
                        <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#106ccbe88f594deb" class="i method">PluginCallCompleted</a>(<span class="r32 r">pluginType</span>, <span class="r33 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#604c37d7b9ac7f23" class="i property">MessageId</a>);
                    }
                    <b>catch</b> (<span class="i">Exception</span> <span id="r34 rd" class="r34 r">ex</span>)
                    {
                        <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">PluginCallException</span>(<span class="r32 r">pluginType</span>, <span class="r33 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#604c37d7b9ac7f23" class="i property">MessageId</a>, <span class="r34 r">ex</span>.<span class="i">ToString</span>());
                        <b>throw</b>;
                    }
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Fetches the next active </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> without changing the state of the receiver or the message source.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">fromSequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional sequence number from where to peek the</span>
        <span class="c">///</span><span class="c"> message. This corresponds to the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the</span>
        <span class="c">///</span><span class="c"> operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The first call to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#1ca1d39bec0c2c81" class="i method">PeekMessageAsync</a>(<b>long</b>?, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> fetches the first active message for this receiver. Each subsequent call fetches the subsequent message in the entity.</span>
        <span class="c">///</span><span class="c"> Unlike a received message, a peeked message will not have a lock token associated with it, and hence it cannot be Completed/Abandoned/Deferred/Deadlettered/Renewed.</span>
        <span class="c">///</span><span class="c"> Also, unlike </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#19d33b51af2ff547" class="i method">ReceiveMessageAsync</a>(<span class="i">TimeSpan</span>?, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, this method will fetch even Deferred messages (but not Deadlettered message).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that represents the next message to be read. Returns null when nothing to peek.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="1ca1d39bec0c2c81" href="../R/1ca1d39bec0c2c81.html" target="n" data-glyph="72,1" class="i method">PeekMessageAsync</a>(
            <b>long</b>? <span id="r35 rd" class="r35 r">fromSequenceNumber</span> = <b>default</b>,
            <span class="i">CancellationToken</span> <span id="r36 rd" class="r36 r">cancellationToken</span> = <b>default</b>)
        {
            <span class="i">IEnumerable</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r37 rd" class="r37 r">result</span> = <b>await</b> <a href="#6f7f6e94c80c0097" class="i method">PeekMessagesInternalAsync</a>(
                <span class="r38 r">sequenceNumber</span>: <span class="r35 r">fromSequenceNumber</span>,
                <span class="r39 r">maxMessages</span>: 1,
                <span class="r40 r">cancellationToken</span>: <span class="r36 r">cancellationToken</span>)
                .<span class="i">ConfigureAwait</span>(<b>false</b>);
 
            <b>foreach</b> (<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r41 rd" class="r41 r">message</span> <b>in</b> <span class="r37 r">result</span>)
            {
                <b>return</b> <span class="r41 r">message</span>;
            }
            <b>return</b> <b>null</b>;
        }
 
        <span class="c">///</span><span class="c"> Fetches a list of active messages without changing the state of the receiver or the message source.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">maxMessages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum number of messages that will be fetched.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">fromSequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional sequence number from where to peek the</span>
        <span class="c">///</span><span class="c"> message. This corresponds to the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel</span>
        <span class="c">///</span><span class="c"> the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Unlike a received message, a peeked message will not have a lock token associated with it, and hence it cannot be</span>
        <span class="c">///</span><span class="c"> Completed/Abandoned/Deferred/Deadlettered/Renewed.</span>
        <span class="c">///</span><span class="c"> Also, unlike </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#19d33b51af2ff547" class="i method">ReceiveMessageAsync</a>(<span class="i">TimeSpan</span>?, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, this method will fetch even Deferred messages (but not Deadlettered messages).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">IReadOnlyList</span>{<span class="r45 r t">ServiceBusReceivedMessage</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> of messages that were peeked.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span>&lt;<span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="79066841ce57c19b" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PeekMessagesAsync</a>(
            <b>int</b> <span id="r42 rd" class="r42 r">maxMessages</span>,
            <b>long</b>? <span id="r43 rd" class="r43 r">fromSequenceNumber</span> = <b>default</b>,
            <span class="i">CancellationToken</span> <span id="r44 rd" class="r44 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#6f7f6e94c80c0097" class="i method">PeekMessagesInternalAsync</a>(
                <span class="r38 r">sequenceNumber</span>: <span class="r43 r">fromSequenceNumber</span>,
                <span class="r39 r">maxMessages</span>: <span class="r42 r">maxMessages</span>,
                <span class="r40 r">cancellationToken</span>: <span class="r44 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Fetches a list of active messages without changing the state of the receiver or the message source.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number from where to peek the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">maxMessages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The maximum number of messages that will be fetched.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">IList</span>{<span class="r46 r t">ServiceBusReceivedMessage</span>}<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> of messages that were peeked.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private async</b> <span class="i">Task</span>&lt;<span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="6f7f6e94c80c0097" href="../R/6f7f6e94c80c0097.html" target="n" data-glyph="76,1" class="i method">PeekMessagesInternalAsync</a>(
            <b>long</b>? <span id="r38 rd" class="r38 r">sequenceNumber</span>,
            <b>int</b> <span id="r39 rd" class="r39 r">maxMessages</span>,
            <span class="i">CancellationToken</span> <span id="r40 rd" class="r40 r">cancellationToken</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<span class="i">AssertAtLeast</span>(<span class="r39 r">maxMessages</span>, 1, <b>nameof</b>(<span class="r39 r">maxMessages</span>));
            <span class="r40 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#5876f7df1971620e" class="i method">PeekMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r38 r">sequenceNumber</span>, <span class="r39 r">maxMessages</span>);
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r47 rd" class="r47 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#29b30ff44f7b643c" class="i property">PeekActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#98ff0ae76fdff1e0" class="i field">ProducerKind</a>);
            <span class="r47 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r48 rd" class="r48 r">messages</span> = <b>new</b> <span class="i">List</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;();
            <b>try</b>
            {
                <span class="r48 r">messages</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#7e7afd1a49e61285" class="i method">PeekMessagesAsync</a>(
                    <span class="r38 r">sequenceNumber</span>,
                    <span class="r39 r">maxMessages</span>,
                    <span class="r40 r">cancellationToken</span>)
                    .<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r49 rd" class="r49 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">PeekMessageException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r49 r">exception</span>.<span class="i">ToString</span>());
                <span class="r47 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r49 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">PeekMessageComplete</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r48 r">messages</span>.<span class="i">Count</span>);
            <span class="r47 r">scope</span>.<span class="i">SetMessageData</span>(<span class="r48 r">messages</span>);
            <b>return</b> <span class="r48 r">messages</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Opens an AMQP link for use with receiver operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal async</b> <span class="i">Task</span> <a id="43832c2c04dbefd0" href="../R/43832c2c04dbefd0.html" target="n" data-glyph="74,1" class="i method">OpenLinkAsync</a>(<span class="i">CancellationToken</span> <span id="r50 rd" class="r50 r">cancellationToken</span>) =&gt;
            <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#abaf1db942585e6f" class="i method">OpenLinkAsync</a>(<span class="r50 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Completes a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. This will delete the message from the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The message to complete.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r52 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on a message that was received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="d35c30d441491f0d" href="../R/d35c30d441491f0d.html" target="n" data-glyph="72,1" class="i method">CompleteMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r51 rd" class="r51 r">message</span>,
            <span class="i">CancellationToken</span> <span id="r52 rd" class="r52 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r51 r">message</span>, <b>nameof</b>(<span class="r51 r">message</span>));
            <b>await</b> <a href="#8fc4c2465f4566b6" class="i method">CompleteMessageAsync</a>(<span class="r51 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a>, <span class="r52 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Completes a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. This will delete the message from the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r53 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> message to complete.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on a message that was received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <span class="i">Task</span> <a id="8fc4c2465f4566b6" href="../R/8fc4c2465f4566b6.html" target="n" data-glyph="74,1" class="i method">CompleteMessageAsync</a>(
            <b>string</b> <span id="r53 rd" class="r53 r">lockToken</span>,
            <span class="i">CancellationToken</span> <span id="r54 rd" class="r54 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#95a8cdb040400173" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r53 r">lockToken</span>);
            <span class="r54 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#934efe249394c7dc" class="i method">CompleteMessageStart</a>(
                <a href="#d4035be49ac784db" class="i property">Identifier</a>,
                1,
                <span class="r53 r">lockToken</span>);
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r55 rd" class="r55 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#957895debbf51f2a" class="i property">CompleteActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
            <span class="r55 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#01521c04f568c28f" class="i method">CompleteAsync</a>(
                    <span class="r53 r">lockToken</span>,
                    <span class="r54 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r56 rd" class="r56 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">CompleteMessageException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r56 r">exception</span>.<span class="i">ToString</span>());
                <span class="r55 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r56 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#62fb0746372daa99" class="i method">CompleteMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandons a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.This will make the message available again for immediate processing as the lock on the message held by the receiver will be released.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to abandon.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while abandoning the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandoning a message will increase the delivery count on the message.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="ea2956bc6bef3871" href="../R/ea2956bc6bef3871.html" target="n" data-glyph="72,1" class="i method">AbandonMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r57 rd" class="r57 r">message</span>,
            <span class="i">IDictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <span id="r58 rd" class="r58 r">propertiesToModify</span> = <b>null</b>,
            <span class="i">CancellationToken</span> <span id="r59 rd" class="r59 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r57 r">message</span>, <b>nameof</b>(<span class="r57 r">message</span>));
            <b>await</b> <a href="#4edd7d8b5602ce4a" class="i method">AbandonMessageAsync</a>(
                <span class="r57 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a>,
                <span class="r58 r">propertiesToModify</span>,
                <span class="r59 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandons a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. This will make the message available again for processing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to abandon.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r61 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while abandoning the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Abandoning a message will increase the delivery count on the message.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver</span>
        <span class="c">///</span><span class="c"> when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <span class="i">Task</span> <a id="4edd7d8b5602ce4a" href="../R/4edd7d8b5602ce4a.html" target="n" data-glyph="74,1" class="i method">AbandonMessageAsync</a>(
            <b>string</b> <span id="r60 rd" class="r60 r">lockToken</span>,
            <span class="i">IDictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <span id="r61 rd" class="r61 r">propertiesToModify</span> = <b>null</b>,
            <span class="i">CancellationToken</span> <span id="r62 rd" class="r62 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#95a8cdb040400173" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r60 r">lockToken</span>);
            <span class="r62 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#b44ee4575bc37eb1" class="i method">AbandonMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r60 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r63 rd" class="r63 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#3cb9c5c4c0af6cf2" class="i property">AbandonActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
 
            <span class="r63 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#05d40d5171a1806c" class="i method">AbandonAsync</a>(
                    <span class="r60 r">lockToken</span>,
                    <span class="r61 r">propertiesToModify</span>,
                    <span class="r62 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r64 rd" class="r64 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">AbandonMessageException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r64 r">exception</span>.<span class="i">ToString</span>());
                <span class="r63 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r64 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#a100278c0677cb21" class="i method">AbandonMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r65 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r66 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while moving to subqueue.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue or transfer dead-letter queue,</span>
        <span class="c">///</span><span class="c"> set the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>.<a href="ServiceBusReceiverOptions.cs.html#b9d51848e5be6bd1" class="i property">SubQueue</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> property to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#330a7d372e2c616e" class="i field">DeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#7c38331c3a2322cd" class="i field">TransferDeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> when calling</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#692483b0b2ae13d8" class="i method">CreateReceiver</a>(<b>string</b>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#cd9067921d79a6c5" class="i method">CreateReceiver</a>(<b>string</b>, <b>string</b>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="1f2d256ef94a54f6" href="../R/1f2d256ef94a54f6.html" target="n" data-glyph="72,1" class="i method">DeadLetterMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r65 rd" class="r65 r">message</span>,
            <span class="i">IDictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <span id="r66 rd" class="r66 r">propertiesToModify</span> = <b>null</b>,
            <span class="i">CancellationToken</span> <span id="r67 rd" class="r67 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r65 r">message</span>, <b>nameof</b>(<span class="r65 r">message</span>));
            <b>await</b> <a href="#2c063661a52dfe98" class="i method">DeadLetterMessageAsync</a>(
                <span class="r68 r">lockToken</span>: <span class="r65 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a>,
                <span class="r69 r">propertiesToModify</span>: <span class="r66 r">propertiesToModify</span>,
                <span class="r70 r">cancellationToken</span>: <span class="r67 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r68 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r69 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while moving to subqueue.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r70 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue or transfer dead-letter queue,</span>
        <span class="c">///</span><span class="c"> set the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>.<a href="ServiceBusReceiverOptions.cs.html#b9d51848e5be6bd1" class="i property">SubQueue</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> property to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#330a7d372e2c616e" class="i field">DeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> or </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/SubQueue.cs.html#f017577c9b23c49e" class="t t">SubQueue</a>.<a href="../Primitives/SubQueue.cs.html#7c38331c3a2322cd" class="i field">TransferDeadLetter</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> when calling</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#692483b0b2ae13d8" class="i method">CreateReceiver</a>(<b>string</b>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#cd9067921d79a6c5" class="i method">CreateReceiver</a>(<b>string</b>, <b>string</b>, <a href="ServiceBusReceiverOptions.cs.html#3d168325ea003c8e" class="t t">ServiceBusReceiverOptions</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <span class="i">Task</span> <a id="2c063661a52dfe98" href="../R/2c063661a52dfe98.html" target="n" data-glyph="74,1" class="i method">DeadLetterMessageAsync</a>(
            <b>string</b> <span id="r68 rd" class="r68 r">lockToken</span>,
            <span class="i">IDictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <span id="r69 rd" class="r69 r">propertiesToModify</span> = <b>null</b>,
            <span class="i">CancellationToken</span> <span id="r70 rd" class="r70 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#6d6aece152dd5a88" class="i method">DeadLetterInternalAsync</a>(
                <span class="r71 r">lockToken</span>: <span class="r68 r">lockToken</span>,
                <span class="r72 r">propertiesToModify</span>: <span class="r69 r">propertiesToModify</span>,
                <span class="r73 r">cancellationToken</span>: <span class="r70 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r74 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r75 r">deadLetterReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r76 r">deadLetterErrorDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The error description for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue, you will need a new </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, with the corresponding path.</span>
        <span class="c">///</span><span class="c"> You can use EntityNameHelper.FormatDeadLetterPath(string) to help with this.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="c91e7517d0442fda" href="../R/c91e7517d0442fda.html" target="n" data-glyph="72,1" class="i method">DeadLetterMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r74 rd" class="r74 r">message</span>,
            <b>string</b> <span id="r75 rd" class="r75 r">deadLetterReason</span>,
            <b>string</b> <span id="r76 rd" class="r76 r">deadLetterErrorDescription</span> = <b>default</b>,
            <span class="i">CancellationToken</span> <span id="r77 rd" class="r77 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r74 r">message</span>, <b>nameof</b>(<span class="r74 r">message</span>));
            <b>await</b> <a href="#0479fc0586421bd5" class="i method">DeadLetterMessageAsync</a>(
                <span class="r78 r">lockToken</span>: <span class="r74 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a>,
                <span class="r79 r">deadLetterReason</span>: <span class="r75 r">deadLetterReason</span>,
                <span class="r80 r">deadLetterErrorDescription</span>: <span class="r76 r">deadLetterErrorDescription</span>,
                <span class="r81 r">cancellationToken</span>: <span class="r77 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">deadLetterReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r80 r">deadLetterErrorDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The error description for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r81 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue, you will need a new </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, with the corresponding path.</span>
        <span class="c">///</span><span class="c"> You can use EntityNameHelper.FormatDeadLetterPath(string) to help with this.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <span class="i">Task</span> <a id="0479fc0586421bd5" href="../R/0479fc0586421bd5.html" target="n" data-glyph="74,1" class="i method">DeadLetterMessageAsync</a>(
            <b>string</b> <span id="r78 rd" class="r78 r">lockToken</span>,
            <b>string</b> <span id="r79 rd" class="r79 r">deadLetterReason</span>,
            <b>string</b> <span id="r80 rd" class="r80 r">deadLetterErrorDescription</span> = <b>null</b>,
            <span class="i">CancellationToken</span> <span id="r81 rd" class="r81 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#6d6aece152dd5a88" class="i method">DeadLetterInternalAsync</a>(
                <span class="r71 r">lockToken</span>: <span class="r78 r">lockToken</span>,
                <span class="r82 r">deadLetterReason</span>: <span class="r79 r">deadLetterReason</span>,
                <span class="r83 r">deadLetterErrorDescription</span>: <span class="r80 r">deadLetterErrorDescription</span>,
                <span class="r73 r">cancellationToken</span>: <span class="r81 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Moves a message to the dead-letter subqueue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r71 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lock token </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to dead-letter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r82 r">deadLetterReason</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The reason for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r83 r">deadLetterErrorDescription</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The error description for dead-lettering the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while deferring the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r73 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive a message from the dead-letter queue, you will need a new </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, with the corresponding path.</span>
        <span class="c">///</span><span class="c"> You can use EntityNameHelper.FormatDeadLetterPath(string) to help with this.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>private async</b> <span class="i">Task</span> <a id="6d6aece152dd5a88" href="../R/6d6aece152dd5a88.html" target="n" data-glyph="76,1" class="i method">DeadLetterInternalAsync</a>(
            <b>string</b> <span id="r71 rd" class="r71 r">lockToken</span>,
            <b>string</b> <span id="r82 rd" class="r82 r">deadLetterReason</span> = <b>default</b>,
            <b>string</b> <span id="r83 rd" class="r83 r">deadLetterErrorDescription</span> = <b>default</b>,
            <span class="i">IDictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <span id="r72 rd" class="r72 r">propertiesToModify</span> = <b>default</b>,
            <span class="i">CancellationToken</span> <span id="r73 rd" class="r73 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#95a8cdb040400173" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r71 r">lockToken</span>);
            <span class="r73 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#d9b60fa08b74a979" class="i method">DeadLetterMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r71 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r84 rd" class="r84 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#0271c0346bd22872" class="i property">DeadLetterActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
 
            <span class="r84 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#90b79e6f6bcd1911" class="i method">DeadLetterAsync</a>(
                    <span class="r85 r">lockToken</span>: <span class="r71 r">lockToken</span>,
                    <span class="r86 r">deadLetterReason</span>: <span class="r82 r">deadLetterReason</span>,
                    <span class="r87 r">deadLetterErrorDescription</span>: <span class="r83 r">deadLetterErrorDescription</span>,
                    <span class="r88 r">propertiesToModify</span>: <span class="r72 r">propertiesToModify</span>,
                    <span class="r89 r">cancellationToken</span>: <span class="r73 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r90 rd" class="r90 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">DeadLetterMessageException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r90 r">exception</span>.<span class="i">ToString</span>());
                <span class="r84 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r90 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#081d2b952ca70d8d" class="i method">DeadLetterMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c"> Indicates that the receiver wants to defer the processing for the message.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r91 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to defer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r92 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while deferring the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r93 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive this message again in the future, you will need to save the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> and receive it using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5eceff89bdec0df3" class="i method">ReceiveDeferredMessageAsync</a>(<b>long</b>, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> Deferring messages does not impact message&#39;s expiration, meaning that deferred messages can still expire.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="8402895424867a42" href="../R/8402895424867a42.html" target="n" data-glyph="72,1" class="i method">DeferMessageAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r91 rd" class="r91 r">message</span>,
            <span class="i">IDictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <span id="r92 rd" class="r92 r">propertiesToModify</span> = <b>null</b>,
            <span class="i">CancellationToken</span> <span id="r93 rd" class="r93 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r91 r">message</span>, <b>nameof</b>(<span class="r91 r">message</span>));
            <b>await</b> <a href="#ebc7d37a2488a881" class="i method">DeferMessageAsync</a>(
                <span class="r91 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a>,
                <span class="r92 r">propertiesToModify</span>,
                <span class="r93 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c"> Indicates that the receiver wants to defer the processing for the message.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r94 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lockToken of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to defer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">propertiesToModify</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The properties of the message to modify while deferring the message.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> A lock token can be found in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> only when </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#108a285bc4afe119" class="i property">ReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> In order to receive this message again in the future, you will need to save the</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> and receive it using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5eceff89bdec0df3" class="i method">ReceiveDeferredMessageAsync</a>(<b>long</b>, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> Deferring messages does not impact message&#39;s expiration, meaning that deferred messages can still expire.</span>
        <span class="c">///</span><span class="c"> This operation can only be performed on messages that were received by this receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <span class="i">Task</span> <a id="ebc7d37a2488a881" href="../R/ebc7d37a2488a881.html" target="n" data-glyph="74,1" class="i method">DeferMessageAsync</a>(
            <b>string</b> <span id="r94 rd" class="r94 r">lockToken</span>,
            <span class="i">IDictionary</span>&lt;<b>string</b>, <b>object</b>&gt; <span id="r95 rd" class="r95 r">propertiesToModify</span> = <b>null</b>,
            <span class="i">CancellationToken</span> <span id="r96 rd" class="r96 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#95a8cdb040400173" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r94 r">lockToken</span>);
            <span class="r96 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#2a5c1463e437f4a8" class="i method">DeferMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r94 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r97 rd" class="r97 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#6fe7e3b2015c018e" class="i property">DeferActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
 
            <span class="r97 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#8bf85cfe36f961d1" class="i method">DeferAsync</a>(
                    <span class="r94 r">lockToken</span>,
                    <span class="r95 r">propertiesToModify</span>,
                    <span class="r96 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r98 rd" class="r98 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">DeferMessageException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r98 r">exception</span>.<span class="i">ToString</span>());
                <span class="r97 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r98 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#16b9dac7478b7031" class="i method">DeferMessageComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Throws an InvalidOperationException when not in PeekLock mode.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="5209b6cdcb72436f" href="../R/5209b6cdcb72436f.html" target="n" data-glyph="76,1" class="i method">ThrowIfNotPeekLockMode</a>()
        {
            <b>if</b> (<a href="#108a285bc4afe119" class="i property">ReceiveMode</a> != <a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a>)
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#bda208fb05ecc3ab" class="i property">OperationNotSupported</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Throws an InvalidOperationException when the lock token is empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private static void</b> <a id="95a8cdb040400173" href="../R/95a8cdb040400173.html" target="n" data-glyph="76,1" class="i method">ThrowIfLockTokenIsEmpty</a>(<b>string</b> <span id="r99 rd" class="r99 r">lockToken</span>)
        {
            <b>if</b> (<span class="i">Guid</span>.<span class="i">Parse</span>(<span class="r99 r">lockToken</span>) == <span class="i">Guid</span>.<span class="i">Empty</span>)
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#d993a5f20bbfffee" class="i property">PeekLockModeRequired</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a deferred message identified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r100 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number of the message to receive. This corresponds to</span>
        <span class="c">///</span><span class="c"> the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r101 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The deferred message identified by the specified sequence number. Returns null if no message is found.</span>
        <span class="c">///</span><span class="c"> Throws if the message has not been deferred.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#8402895424867a42" class="i method">DeferMessageAsync</a>(<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>, <span class="i">IDictionary</span>{<b>string</b>, <b>object</b>}, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#ebc7d37a2488a881" class="i method">DeferMessageAsync</a>(<b>string</b>, <span class="i">IDictionary</span>{<b>string</b>, <b>object</b>}, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <a id="5eceff89bdec0df3" href="../R/5eceff89bdec0df3.html" target="n" data-glyph="72,1" class="i method">ReceiveDeferredMessageAsync</a>(
            <b>long</b> <span id="r100 rd" class="r100 r">sequenceNumber</span>,
            <span class="i">CancellationToken</span> <span id="r101 rd" class="r101 r">cancellationToken</span> = <b>default</b>) =&gt;
            (<b>await</b> <span class="i">ReceiveDeferredMessagesAsync</span>(<b>new</b> <b>long</b>[] { <span class="r100 r">sequenceNumber</span> }, <span class="r101 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>))[0];
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Receives a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">IList</span>{<span class="r102 r t">ServiceBusReceivedMessage</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> of deferred messages identified by </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">sequenceNumbers</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r103 r">sequenceNumbers</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">IEnumerable</span>{<span class="r105 r t">T</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> containing the sequence numbers to receive.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Messages identified by sequence number are returned. Returns null if no messages are found.</span>
        <span class="c">///</span><span class="c"> Throws if the messages have not been deferred.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#8402895424867a42" class="i method">DeferMessageAsync</a>(<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>, <span class="i">IDictionary</span>{<b>string</b>, <b>object</b>}, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#ebc7d37a2488a881" class="i method">DeferMessageAsync</a>(<b>string</b>, <span class="i">IDictionary</span>{<b>string</b>, <b>object</b>}, <span class="i">CancellationToken</span>)<span class="c">&quot;</span><span class="c">/&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span>&lt;<span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;&gt; <a id="20265790038c77be" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReceiveDeferredMessagesAsync</a>(
            <span class="i">IEnumerable</span>&lt;<b>long</b>&gt; <span id="r103 rd" class="r103 r">sequenceNumbers</span>,
            <span class="i">CancellationToken</span> <span id="r104 rd" class="r104 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<span class="i">AssertNotNull</span>(<span class="r103 r">sequenceNumbers</span>, <b>nameof</b>(<span class="r103 r">sequenceNumbers</span>));
            <span class="r104 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <span class="c">// the sequence numbers MUST be in array form for them to be encoded correctly</span>
            <b>long</b>[] <span id="r106 rd" class="r106 r">sequenceArray</span> = <span class="r103 r">sequenceNumbers</span> <b>switch</b>
            {
                <b>long</b>[] <span id="r107 rd" class="r107 r">alreadyArray</span> =&gt; <span class="r107 r">alreadyArray</span>,
                <b>_</b> =&gt; <span class="r103 r">sequenceNumbers</span>.<span class="i">ToArray</span>()
            };
 
            <b>if</b> (<span class="r106 r">sequenceArray</span>.<span class="i">Length</span> == 0)
            {
                <b>return</b> <span class="i">Array</span>.<span class="i">Empty</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt;();
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#dd66a0ad9b694b8d" class="i method">ReceiveDeferredMessageStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r106 r">sequenceArray</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r108 rd" class="r108 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#00dc0bad934c577d" class="i property">ReceiveDeferredActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#15794f37dea7f04e" class="i field">ConsumerKind</a>);
 
            <span class="r108 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <span class="i">IReadOnlyList</span>&lt;<a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>&gt; <span id="r109 rd" class="r109 r">deferredMessages</span> = <b>null</b>;
            <b>try</b>
            {
                <span class="r109 r">deferredMessages</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#332192f36aaec405" class="i method">ReceiveDeferredMessagesAsync</a>(
                    <span class="r106 r">sequenceArray</span>,
                    <span class="r104 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r110 rd" class="r110 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">ReceiveDeferredMessageException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r110 r">exception</span>.<span class="i">ToString</span>());
                <span class="r108 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r110 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">ReceiveDeferredMessageComplete</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r109 r">deferredMessages</span>.<span class="i">Count</span>);
            <span class="r108 r">scope</span>.<span class="i">SetMessageData</span>(<span class="r109 r">deferredMessages</span>);
            <b>return</b> <span class="r109 r">deferredMessages</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renews the lock on the message. The lock will be renewed based on the setting specified on the queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When a message is received in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode, the message is locked on the server for this</span>
        <span class="c">///</span><span class="c"> receiver instance for a duration as specified during the Queue/Subscription creation (LockDuration).</span>
        <span class="c">///</span><span class="c"> If processing of the message requires longer than this duration, the lock needs to be renewed.</span>
        <span class="c">///</span><span class="c"> For each renewal, it resets the time the message is locked by the LockDuration set on the Entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r111 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to renew the lock for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r112 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="ca1bf1f67e2a40c2" href="../R/ca1bf1f67e2a40c2.html" target="n" data-glyph="72,1" class="i method">RenewMessageLockAsync</a>(
            <a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a> <span id="r111 rd" class="r111 r">message</span>,
            <span class="i">CancellationToken</span> <span id="r112 rd" class="r112 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r111 r">message</span>, <b>nameof</b>(<span class="r111 r">message</span>));
            <span class="i">DateTimeOffset</span> <span id="r113 rd" class="r113 r">lockedUntil</span> = <b>await</b> <a href="#9c74894dbd5d2517" class="i method">RenewMessageLockAsync</a>(
                <span class="r111 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#6ebd0ecdf353406e" class="i property">LockToken</a>,
                <span class="r112 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            <span class="r111 r">message</span>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#b99268648f10b24f" class="i property">LockedUntil</a> = <span class="r113 r">lockedUntil</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Renews the lock on the message. The lock will be renewed based on the setting specified on the queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> When a message is received in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a>.<a href="ServiceBusReceiveMode.cs.html#4ebcd79e83d6fd3b" class="i field">PeekLock</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> mode, the message is locked on the server for this</span>
        <span class="c">///</span><span class="c"> receiver instance for a duration as specified during the Queue/Subscription creation (LockDuration).</span>
        <span class="c">///</span><span class="c"> If processing of the message requires longer than this duration, the lock needs to be renewed.</span>
        <span class="c">///</span><span class="c"> For each renewal, it resets the time the message is locked by the LockDuration set on the Entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r114 r">lockToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The lockToken of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to renew the lock for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r115 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal virtual async</b> <span class="i">Task</span>&lt;<span class="i">DateTimeOffset</span>&gt; <a id="9c74894dbd5d2517" href="../R/9c74894dbd5d2517.html" target="n" data-glyph="74,1" class="i method">RenewMessageLockAsync</a>(
            <b>string</b> <span id="r114 rd" class="r114 r">lockToken</span>,
            <span class="i">CancellationToken</span> <span id="r115 rd" class="r115 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#2fb390c9488d131a" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a>));
            <a href="#5209b6cdcb72436f" class="i method">ThrowIfNotPeekLockMode</a>();
            <a href="#1cdfd765c09d7df8" class="i method">ThrowIfSessionReceiver</a>();
            <a href="#95a8cdb040400173" class="i method">ThrowIfLockTokenIsEmpty</a>(<span class="r114 r">lockToken</span>);
            <span class="r115 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#02fb1f7bead5539d" class="i method">ThrowIfCancellationRequested</a>&lt;<span class="i">TaskCanceledException</span>&gt;();
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#e97bf245e8b82a41" class="i method">RenewMessageLockStart</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, 1, <span class="r114 r">lockToken</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r116 rd" class="r116 r">scope</span> = <a href="#1dd76242085124b3" class="i property">ScopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#cbb4a52de7c9a84f" class="i property">RenewMessageLockActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
            <span class="r116 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <span class="i">DateTimeOffset</span> <span id="r117 rd" class="r117 r">lockedUntil</span>;
            <b>try</b>
            {
                <span class="r117 r">lockedUntil</span> = <b>await</b> <a href="#ccb12450e5be9b61" class="i property">InnerReceiver</a>.<a href="../Core/TransportReceiver.cs.html#a733f082154da577" class="i method">RenewMessageLockAsync</a>(
                    <span class="r114 r">lockToken</span>,
                    <span class="r115 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
            }
            <b>catch</b> (<span class="i">Exception</span> <span id="r118 rd" class="r118 r">exception</span>)
            {
                <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<span class="i">RenewMessageLockException</span>(<a href="#d4035be49ac784db" class="i property">Identifier</a>, <span class="r118 r">exception</span>.<span class="i">ToString</span>());
                <span class="r116 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#1fc9b81e757b438c" class="i method">Failed</a>(<span class="r118 r">exception</span>);
                <b>throw</b>;
            }
 
            <a href="#70e55ac811fb8d3b" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#2d7f35a2ec4c509f" class="i method">RenewMessageLockComplete</a>(<a href="#d4035be49ac784db" class="i property">Identifier</a>);
            <b>return</b> <span class="r117 r">lockedUntil</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Throws an exception if the receiver instance is a session receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="1cdfd765c09d7df8" href="../R/1cdfd765c09d7df8.html" target="n" data-glyph="76,1" class="i method">ThrowIfSessionReceiver</a>()
        {
            <b>if</b> (<a href="#e41b70ce2d96cf67" class="i property">IsSessionReceiver</a>)
            {
                <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#de6fd04c30e2deac" class="i property">CannotLockMessageOnSessionEntity</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Performs the task needed to clean up resources used by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2224f17dabcb26c3" class="t t">ServiceBusReceiver</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> This is equivalent to calling </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#7a512d9bdcad41ae" class="i method">CloseAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the default </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/LinkCloseMode.cs.html#f8c9ace71ea8e421" class="t t">LinkCloseMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">SuppressMessage</span>(<span class="s">&quot;Usage&quot;</span>, <span class="s">&quot;AZC0002:Ensure all service methods take an optional CancellationToken parameter.&quot;</span>, <span class="i">Justification</span> = <span class="s">&quot;This signature must match the IAsyncDisposable interface.&quot;</span>)]
        <b>public virtual async</b> <span class="i">ValueTask</span> <a id="9aab2bee052c5c07" href="../R/9aab2bee052c5c07.html" target="n" data-glyph="72,1" class="i method">DisposeAsync</a>() =&gt;
            <b>await</b> <a href="#7a512d9bdcad41ae" class="i method">CloseAsync</a>().<span class="i">ConfigureAwait</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Determines whether the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Object</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r119 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Object</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to compare with this instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Object</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">EditorBrowsable</span>(<span class="i">EditorBrowsableState</span>.<span class="i">Never</span>)]
        <b>public override bool</b> <a id="67251f997686835e" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Equals</a>(<b>object</b> <span id="r119 rd" class="r119 r">obj</span>) =&gt; <b>base</b>.<span class="i">Equals</span>(<span class="r119 r">obj</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns a hash code for this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A hash code for this instance, suitable for use in hashing algorithms and data structures like a hash table.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">EditorBrowsable</span>(<span class="i">EditorBrowsableState</span>.<span class="i">Never</span>)]
        <b>public override int</b> <a id="c7ee0178a33be869" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetHashCode</a>() =&gt; <b>base</b>.<span class="i">GetHashCode</span>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts the instance to string representation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">String</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that represents this instance.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="i">EditorBrowsable</span>(<span class="i">EditorBrowsableState</span>.<span class="i">Never</span>)]
        <b>public override string</b> <a id="0ebd993a82f5722c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>() =&gt; <b>base</b>.<span class="i">ToString</span>();
    }
}
</pre></td></tr></table></div></body></html>
