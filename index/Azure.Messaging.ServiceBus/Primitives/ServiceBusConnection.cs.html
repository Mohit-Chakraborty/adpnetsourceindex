<!DOCTYPE html>
<html><head><title>ServiceBusConnection.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(402);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.ServiceBus/Primitives/ServiceBusConnection.cs" target="_top">Primitives\ServiceBusConnection.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.ServiceBus" target="_top">src\Azure.Messaging.ServiceBus.csproj</a> (Azure.Messaging.ServiceBus)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Amqp</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Authorization</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Core</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   A connection to the Azure Service Bus service, enabling client communications with a specific</span>
    <span class="c">///</span><span class="c">   Service Bus entity instance within an Service Bus namespace.  A single connection may be</span>
    <span class="c">///</span><span class="c">   shared among multiple Service Bus entity senders and/or receivers, or may be used as a</span>
    <span class="c">///</span><span class="c">   dedicated connection for a single sender or receiver client.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="5fc67fb7b5056bea" href="../R/5fc67fb7b5056bea.html" target="n" data-glyph="2,0" class="t t">ServiceBusConnection</a> : <span class="i">IAsyncDisposable</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The fully qualified Service Bus namespace that the connection is associated with.</span>
        <span class="c">///</span><span class="c">   This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="729943334b661165" href="../R/729943334b661165.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedNamespace</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates whether or not this </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the connection is closed; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="032653d385638dae" href="../R/032653d385638dae.html" target="n" data-glyph="102,1" class="i property">IsClosed</a> =&gt; <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a>.<a href="../Core/TransportClient.cs.html#1b1a32e01f6b0320" class="i property">IsClosed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The entity path that the connection is bound to.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public string</b> <a id="7f73213b86f87214" href="../R/7f73213b86f87214.html" target="n" data-glyph="102,1" class="i property">EntityPath</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The endpoint for the Service Bus service to which the connection is associated.</span>
        <span class="c">///</span><span class="c">   This is essentially the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#729943334b661165" class="i property">FullyQualifiedNamespace</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> but with</span>
        <span class="c">///</span><span class="c">   the scheme included.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <span class="i">Uri</span> <a id="e974e1c22d28f5d0" href="../R/../../0000000000.html" target="n" data-glyph="104,1" class="i property">ServiceEndpoint</a> =&gt; <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a>.<a href="../Core/TransportClient.cs.html#255be8743ebee24d" class="i property">ServiceEndpoint</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The transport type used for this connection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="ServiceBusTransportType.cs.html#b07ef16e21fea68e" class="t t">ServiceBusTransportType</a> <a id="69f0394cd5b18421" href="../R/69f0394cd5b18421.html" target="n" data-glyph="102,1" class="i property">TransportType</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The retry options associated with this connection.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="ServiceBusRetryOptions.cs.html#f405da36db2d38b0" class="t t">ServiceBusRetryOptions</a> <a id="6fbb28757496f6ee" href="../R/6fbb28757496f6ee.html" target="n" data-glyph="102,1" class="i property">RetryOptions</a> { <b>get</b>; }
 
        <b>private readonly</b> <a href="../Core/TransportClient.cs.html#1e482fe9c3dcc163" class="t t">TransportClient</a> <a id="d8d17669fdfe49cd" href="../R/d8d17669fdfe49cd.html" target="n" data-glyph="46,1" class="i field">_innerClient</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parameterless constructor to allow mocking.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal</b> <a id="973fc14c6714fa3e" href="../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">ServiceBusConnection</a>() { }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The connection string to use for connecting to the Service Bus namespace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A set of options to apply when configuring the connection.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   If the connection string is copied from the Service Bus entity itself, it will contain the name of the desired Service Bus entity,</span>
        <span class="c">///</span><span class="c">   and can be used directly without passing the  name=&quot;entityName&quot; /&gt;.  The name of the Service Bus entity should be</span>
        <span class="c">///</span><span class="c">   passed only once, either as part of the connection string or separately.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a id="d5310b52185247a2" href="../R/d5310b52185247a2.html" target="n" data-glyph="74,1" class="t constructor">ServiceBusConnection</a>(
            <b>string</b> <span id="r0 rd" class="r0 r">connectionString</span>,
            <a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a> <span id="r1 rd" class="r1 r">options</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r0 r">connectionString</span>, <b>nameof</b>(<span class="r0 r">connectionString</span>));
            <a href="#cc2015a1b43a6d44" class="i method">ValidateConnectionOptions</a>(<span class="r1 r">options</span>);
 
            <a href="ServiceBusConnectionStringProperties.cs.html#b011974d70d9c929" class="k">var</a> <span id="r2 rd" class="r2 r">connectionStringProperties</span> = <a href="ServiceBusConnectionStringProperties.cs.html#b011974d70d9c929" class="t t">ServiceBusConnectionStringProperties</a>.<a href="ServiceBusConnectionStringProperties.cs.html#045f3a6b96bd4afd" class="i method">Parse</a>(<span class="r0 r">connectionString</span>);
            <a href="#855403e2d1c4cf76" class="i method">ValidateConnectionStringProperties</a>(<span class="r2 r">connectionStringProperties</span>, <b>nameof</b>(<span class="r0 r">connectionString</span>));
 
            <a href="#729943334b661165" class="i property">FullyQualifiedNamespace</a> = <span class="r2 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#3a46b590394b2830" class="i property">Endpoint</a>.<span class="i">Host</span>;
            <a href="#69f0394cd5b18421" class="i property">TransportType</a> = <span class="r1 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>;
            <a href="#7f73213b86f87214" class="i property">EntityPath</a> = <span class="r2 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#6300a49393b9e1d9" class="i property">EntityPath</a>;
            <a href="#6fbb28757496f6ee" class="i property">RetryOptions</a> = <span class="r1 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#f604bfc6c825072d" class="i property">RetryOptions</a>;
 
            <a href="../Authorization/SharedAccessSignature.cs.html#590cb6f714812552" class="t t">SharedAccessSignature</a> <span id="r3 rd" class="r3 r">sharedAccessSignature</span>;
 
            <b>if</b> (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r2 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#12d390919cf49ab3" class="i property">SharedAccessSignature</a>))
            {
                <span class="r3 r">sharedAccessSignature</span> = <b>new</b> <a href="../Authorization/SharedAccessSignature.cs.html#06899fe85d03ab0f" class="t constructor">SharedAccessSignature</a>(
                     <a href="#cb4206079cf16f03" class="i method">BuildConnectionResource</a>(<span class="r1 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>, <a href="#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <a href="#7f73213b86f87214" class="i property">EntityPath</a>),
                     <span class="r2 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#b51acce87d7adfd2" class="i property">SharedAccessKeyName</a>,
                     <span class="r2 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#a9d7834911da1b51" class="i property">SharedAccessKey</a>);
            }
            <b>else</b>
            {
                <span class="r3 r">sharedAccessSignature</span> = <b>new</b> <a href="../Authorization/SharedAccessSignature.cs.html#996dfe7080688211" class="t constructor">SharedAccessSignature</a>(<span class="r2 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#12d390919cf49ab3" class="i property">SharedAccessSignature</a>);
            }
 
            <a href="../Authorization/SharedAccessSignatureCredential.cs.html#a1f03950e7ae2650" class="k">var</a> <span id="r4 rd" class="r4 r">sharedCredential</span> = <b>new</b> <a href="../Authorization/SharedAccessSignatureCredential.cs.html#e191f39c30070f6e" class="t constructor">SharedAccessSignatureCredential</a>(<span class="r3 r">sharedAccessSignature</span>);
            <a href="../Authorization/ServiceBusTokenCredential.cs.html#e09f4bf6aa653648" class="k">var</a> <span id="r5 rd" class="r5 r">tokenCredential</span> = <b>new</b> <span class="t">ServiceBusTokenCredential</span>(
                <span class="r4 r">sharedCredential</span>,
                <a href="#cb4206079cf16f03" class="i method">BuildConnectionResource</a>(<a href="#69f0394cd5b18421" class="i property">TransportType</a>, <a href="#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <a href="#7f73213b86f87214" class="i property">EntityPath</a>));
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CA2214</span> <span class="c">// Do not call overridable methods in constructors. This internal method is virtual for testing purposes.</span>
            <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a> = <a href="#56acbd6beeee0319" class="i method">CreateTransportClient</a>(<span class="r5 r">tokenCredential</span>, <span class="r1 r">options</span>);
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">CA2214</span> <span class="c">// Do not call overridable methods in constructors</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Service Bus namespace to connect to.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Authorization/ServiceBusSharedAccessKeyCredential.cs.html#94f207d83772bbed" class="t t">ServiceBusSharedAccessKeyCredential</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> credential to use for authorization.  Access controls may be specified by the Service Bus namespace or the requested Service Bus entity, depending on Azure configuration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A set of options to apply when configuring the connection.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="25ef77571d0e74d2" href="../R/25ef77571d0e74d2.html" target="n" data-glyph="74,1" class="t constructor">ServiceBusConnection</a>(
            <b>string</b> <span id="r6 rd" class="r6 r">fullyQualifiedNamespace</span>,
            <a href="../Authorization/ServiceBusSharedAccessKeyCredential.cs.html#94f207d83772bbed" class="t t">ServiceBusSharedAccessKeyCredential</a> <span id="r7 rd" class="r7 r">credential</span>,
            <a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a> <span id="r8 rd" class="r8 r">options</span>)
                : <b>this</b>(
                    <span class="r6 r">fullyQualifiedNamespace</span>,
                    <a href="#96a1816330aac016" class="i method">TranslateSharedKeyCredential</a>(<span class="r7 r">credential</span>, <span class="r6 r">fullyQualifiedNamespace</span>, <b>null</b>, <span class="r8 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>),
                    <span class="r8 r">options</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Service Bus namespace to connect to.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Azure managed identity credential to use for authorization.  Access controls may be specified by the Service Bus namespace or the requested Service Bus entity, depending on Azure configuration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A set of options to apply when configuring the connection.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="4fca707868ef1066" href="../R/4fca707868ef1066.html" target="n" data-glyph="74,1" class="t constructor">ServiceBusConnection</a>(
            <b>string</b> <span id="r9 rd" class="r9 r">fullyQualifiedNamespace</span>,
            <span class="i">TokenCredential</span> <span id="r10 rd" class="r10 r">credential</span>,
            <a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a> <span id="r11 rd" class="r11 r">options</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#afc5f61cce810570" class="i method">AssertWellFormedServiceBusNamespace</a>(<span class="r9 r">fullyQualifiedNamespace</span>, <b>nameof</b>(<span class="r9 r">fullyQualifiedNamespace</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<span class="i">AssertNotNull</span>(<span class="r10 r">credential</span>, <b>nameof</b>(<span class="r10 r">credential</span>));
            <a href="#cc2015a1b43a6d44" class="i method">ValidateConnectionOptions</a>(<span class="r11 r">options</span>);
 
            <a href="../Authorization/ServiceBusTokenCredential.cs.html#e09f4bf6aa653648" class="k">var</a> <span id="r12 rd" class="r12 r">tokenCredential</span> = <b>new</b> <a href="../Authorization/ServiceBusTokenCredential.cs.html#3b0221e7c3b3515b" class="t constructor">ServiceBusTokenCredential</a>(<span class="r10 r">credential</span>, <a href="#cb4206079cf16f03" class="i method">BuildConnectionResource</a>(<span class="r11 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>, <span class="r9 r">fullyQualifiedNamespace</span>, <a href="#7f73213b86f87214" class="i property">EntityPath</a>));
 
            <a href="#729943334b661165" class="i property">FullyQualifiedNamespace</a> = <span class="r9 r">fullyQualifiedNamespace</span>;
            <a href="#69f0394cd5b18421" class="i property">TransportType</a> = <span class="r11 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>;
            <a href="#6fbb28757496f6ee" class="i property">RetryOptions</a> = <span class="r11 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#f604bfc6c825072d" class="i property">RetryOptions</a>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CA2214</span> <span class="c">// Do not call overridable methods in constructors. This internal method is virtual for testing purposes.</span>
            <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a> = <a href="#56acbd6beeee0319" class="i method">CreateTransportClient</a>(<span class="r12 r">tokenCredential</span>, <span class="r11 r">options</span>);
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">CA2214</span> <span class="c">// Do not call overridable methods in constructors</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Closes the connection to the Service Bus namespace and associated Service Bus entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">CancellationToken</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual async</b> <span class="i">Task</span> <a id="c5347719292795ab" href="../R/c5347719292795ab.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>(<span class="i">CancellationToken</span> <span id="r13 rd" class="r13 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a>.<a href="../Core/TransportClient.cs.html#832c4471b86370b5" class="i method">CloseAsync</a>(<span class="r13 r">cancellationToken</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the task needed to clean up resources used by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c">   including ensuring that the connection itself has been closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual async</b> <span class="i">ValueTask</span> <a id="e94a87ab041fe288" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DisposeAsync</a>() =&gt; <b>await</b> <a href="#c5347719292795ab" class="i method">CloseAsync</a>().<span class="i">ConfigureAwait</span>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Determines whether the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Object</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Object</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to compare with this instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">Object</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="i">EditorBrowsable</span>(<span class="i">EditorBrowsableState</span>.<span class="i">Never</span>)]
        <b>public override bool</b> <a id="3623e5f9e55d20a3" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Equals</a>(<b>object</b> <span id="r14 rd" class="r14 r">obj</span>) =&gt; <b>base</b>.<span class="i">Equals</span>(<span class="r14 r">obj</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Returns a hash code for this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A hash code for this instance, suitable for use in hashing algorithms and data structures like a hash table.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="i">EditorBrowsable</span>(<span class="i">EditorBrowsableState</span>.<span class="i">Never</span>)]
        <b>public override int</b> <a id="034755be9d6d8701" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetHashCode</a>() =&gt; <b>base</b>.<span class="i">GetHashCode</span>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Converts the instance to string representation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">System</span>.<span class="i">String</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that represents this instance.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="i">EditorBrowsable</span>(<span class="i">EditorBrowsableState</span>.<span class="i">Never</span>)]
        <b>public override string</b> <a id="83d2c6501355a20a" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ToString</a>() =&gt; <b>base</b>.<span class="i">ToString</span>();
 
        <b>internal virtual</b> <a href="../Core/TransportSender.cs.html#c54f19921ea3dbe2" class="t t">TransportSender</a> <a id="43eed66c6da39eaf" href="../R/43eed66c6da39eaf.html" target="n" data-glyph="74,1" class="i method">CreateTransportSender</a>(
            <b>string</b> <span id="r15 rd" class="r15 r">entityPath</span>,
            <a href="ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <span id="r16 rd" class="r16 r">retryPolicy</span>,
            <b>string</b> <span id="r17 rd" class="r17 r">identifier</span>) =&gt;
            <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a>.<a href="../Core/TransportClient.cs.html#d20ffc03a653ffaa" class="i method">CreateSender</a>(<span class="r15 r">entityPath</span>, <span class="r16 r">retryPolicy</span>, <span class="r17 r">identifier</span>);
 
        <b>internal virtual</b> <a href="../Core/TransportReceiver.cs.html#1b072fa1ddd22c6a" class="t t">TransportReceiver</a> <a id="c77bb4d21edfe411" href="../R/c77bb4d21edfe411.html" target="n" data-glyph="74,1" class="i method">CreateTransportReceiver</a>(
            <b>string</b> <span id="r18 rd" class="r18 r">entityPath</span>,
            <a href="ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <span id="r19 rd" class="r19 r">retryPolicy</span>,
            <a href="../Receiver/ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a> <span id="r20 rd" class="r20 r">receiveMode</span>,
            <b>uint</b> <span id="r21 rd" class="r21 r">prefetchCount</span>,
            <b>string</b> <span id="r22 rd" class="r22 r">identifier</span>,
            <b>string</b> <span id="r23 rd" class="r23 r">sessionId</span> = <b>default</b>,
            <b>bool</b> <span id="r24 rd" class="r24 r">isSessionReceiver</span> = <b>default</b>) =&gt;
                <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a>.<a href="../Core/TransportClient.cs.html#73c0ab251a2e61cd" class="i method">CreateReceiver</a>(
                    <span class="r18 r">entityPath</span>,
                    <span class="r19 r">retryPolicy</span>,
                    <span class="r20 r">receiveMode</span>,
                    <span class="r21 r">prefetchCount</span>,
                    <span class="r22 r">identifier</span>,
                    <span class="r23 r">sessionId</span>,
                    <span class="r24 r">isSessionReceiver</span>);
 
        <b>internal virtual</b> <a href="../Core/TransportRuleManager.cs.html#756a3d383b80bb40" class="t t">TransportRuleManager</a> <a id="b2be2aca3d8e07a6" href="../R/b2be2aca3d8e07a6.html" target="n" data-glyph="74,1" class="i method">CreateTransportRuleManager</a>(
            <b>string</b> <span id="r25 rd" class="r25 r">subscriptionPath</span>,
            <a href="ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <span id="r26 rd" class="r26 r">retryPolicy</span>,
            <b>string</b> <span id="r27 rd" class="r27 r">identifier</span>) =&gt;
            <a href="#d8d17669fdfe49cd" class="i field">_innerClient</a>.<a href="../Core/TransportClient.cs.html#4db45b241f6087ea" class="i method">CreateRuleManager</a>(<span class="r25 r">subscriptionPath</span>, <span class="r26 r">retryPolicy</span>, <span class="r27 r">identifier</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Builds a Service Bus client specific to the protocol and transport specified by the</span>
        <span class="c">///</span><span class="c">   requested connection type of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Azure managed identity credential to use for authorization.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A client generalization specific to the specified protocol/transport to which operations may be delegated.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   As an internal method, only basic sanity checks are performed against arguments.  It is</span>
        <span class="c">///</span><span class="c">   assumed that callers are trusted and have performed deep validation.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   Parameters passed are also assumed to be owned by thee transport client and safe to mutate or dispose;</span>
        <span class="c">///</span><span class="c">   creation of clones or otherwise protecting the parameters is assumed to be the purview of the caller.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal virtual</b> <a href="../Core/TransportClient.cs.html#1e482fe9c3dcc163" class="t t">TransportClient</a> <a id="56acbd6beeee0319" href="../R/56acbd6beeee0319.html" target="n" data-glyph="74,1" class="i method">CreateTransportClient</a>(
            <a href="../Authorization/ServiceBusTokenCredential.cs.html#e09f4bf6aa653648" class="t t">ServiceBusTokenCredential</a> <span id="r28 rd" class="r28 r">credential</span>,
            <a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a> <span id="r29 rd" class="r29 r">options</span>)
        {
            <b>switch</b> (<a href="#69f0394cd5b18421" class="i property">TransportType</a>)
            {
                <b>case</b> <a href="ServiceBusTransportType.cs.html#b07ef16e21fea68e" class="t t">ServiceBusTransportType</a>.<a href="ServiceBusTransportType.cs.html#3ed180f98e8874d3" class="i field">AmqpTcp</a>:
                <b>case</b> <a href="ServiceBusTransportType.cs.html#b07ef16e21fea68e" class="t t">ServiceBusTransportType</a>.<a href="ServiceBusTransportType.cs.html#5284a94cfb633714" class="i field">AmqpWebSockets</a>:
                    <b>return</b> <b>new</b> <a href="../Amqp/AmqpClient.cs.html#245773fd39821bba" class="t constructor">AmqpClient</a>(<a href="#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <span class="r28 r">credential</span>, <span class="r29 r">options</span>);
 
                <b>default</b>:
                    <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#9550ce2a1565e89b" class="i property">InvalidTransportType</a>, <span class="r29 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>.<span class="i">ToString</span>()), <b>nameof</b>(<span class="r29 r">options</span>));
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Builds the audience of the connection for use in the signature.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">transportType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The type of protocol and transport that will be used for communicating with the Service Bus service.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Service Bus namespace.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">entityName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the specific entity to connect the client to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The value to use as the audience of the signature.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal static string</b> <a id="cb4206079cf16f03" href="../R/cb4206079cf16f03.html" target="n" data-glyph="74,1" class="i method">BuildConnectionResource</a>(
            <a href="ServiceBusTransportType.cs.html#b07ef16e21fea68e" class="t t">ServiceBusTransportType</a> <span id="r30 rd" class="r30 r">transportType</span>,
            <b>string</b> <span id="r31 rd" class="r31 r">fullyQualifiedNamespace</span>,
            <b>string</b> <span id="r32 rd" class="r32 r">entityName</span>)
        {
            <b>var</b> <span id="r33 rd" class="r33 r">builder</span> = <b>new</b> <span class="i">UriBuilder</span>(<span class="r31 r">fullyQualifiedNamespace</span>)
            {
                <span class="i">Scheme</span> = <span class="r30 r">transportType</span>.<a href="../Core/TransportTypeExtensions.cs.html#4d70475a72015f55" class="i method">GetUriScheme</a>(),
                <span class="i">Path</span> = <span class="r32 r">entityName</span>,
                <span class="i">Port</span> = -1,
                <span class="i">Fragment</span> = <b>string</b>.<span class="i">Empty</span>,
                <span class="i">Password</span> = <b>string</b>.<span class="i">Empty</span>,
                <span class="i">UserName</span> = <b>string</b>.<span class="i">Empty</span>,
            };
 
            <b>if</b> (<span class="r33 r">builder</span>.<span class="i">Path</span>.<span class="i">EndsWith</span>(<span class="s">&quot;/&quot;</span>, <span class="i">StringComparison</span>.<span class="i">Ordinal</span>))
            {
                <span class="r33 r">builder</span>.<span class="i">Path</span> = <span class="r33 r">builder</span>.<span class="i">Path</span>.<span class="i">TrimEnd</span>(<span class="s">&#39;/&#39;</span>);
            }
 
            <b>return</b> <span class="r33 r">builder</span>.<span class="i">Uri</span>.<span class="i">AbsoluteUri</span>.<span class="i">ToLowerInvariant</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Throw an ObjectDisposedException if the object is Closing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal virtual void</b> <a id="9c53664d76dd11d7" href="../R/9c53664d76dd11d7.html" target="n" data-glyph="74,1" class="i method">ThrowIfClosed</a>() =&gt;
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#032653d385638dae" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a>));
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Translates an </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Authorization/ServiceBusSharedAccessKeyCredential.cs.html#94f207d83772bbed" class="t t">ServiceBusSharedAccessKeyCredential</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> into the equivalent shared access signature credential.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The credential to translate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">fullyQualifiedNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified Service Bus namespace being connected to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">entityPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The path of the entity being connected to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">transportType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The type of transport being used for the connection.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Authorization/SharedAccessSignatureCredential.cs.html#a1f03950e7ae2650" class="t t">SharedAccessSignatureCredential</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> which the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">credential</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> was translated into.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal static</b> <a href="../Authorization/SharedAccessSignatureCredential.cs.html#a1f03950e7ae2650" class="t t">SharedAccessSignatureCredential</a> <a id="96a1816330aac016" href="../R/96a1816330aac016.html" target="n" data-glyph="74,1" class="i method">TranslateSharedKeyCredential</a>(<a href="../Authorization/ServiceBusSharedAccessKeyCredential.cs.html#94f207d83772bbed" class="t t">ServiceBusSharedAccessKeyCredential</a> <span id="r34 rd" class="r34 r">credential</span>,
                                                                                     <b>string</b> <span id="r35 rd" class="r35 r">fullyQualifiedNamespace</span>,
                                                                                     <b>string</b> <span id="r36 rd" class="r36 r">entityPath</span>,
                                                                                     <a href="ServiceBusTransportType.cs.html#b07ef16e21fea68e" class="t t">ServiceBusTransportType</a> <span id="r37 rd" class="r37 r">transportType</span>)
        {
            <b>if</b> ((<span class="r34 r">credential</span> == <b>null</b>) || (<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r35 r">fullyQualifiedNamespace</span>)))
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>return</b> <span class="r34 r">credential</span>.<a href="../Authorization/ServiceBusSharedAccessKeyCredential.cs.html#82229b7220b3286e" class="i method">AsSharedAccessSignatureCredential</a>(<a href="#cb4206079cf16f03" class="i method">BuildConnectionResource</a>(<span class="r37 r">transportType</span>, <span class="r35 r">fullyQualifiedNamespace</span>, <span class="r36 r">entityPath</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the actions needed to validate the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> associated</span>
        <span class="c">///</span><span class="c">   with this client.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">connectionOptions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to validate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   In the case that the options violate an invariant or otherwise represent a combination that</span>
        <span class="c">///</span><span class="c">   is not permissible, an appropriate exception will be thrown.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private static void</b> <a id="cc2015a1b43a6d44" href="../R/cc2015a1b43a6d44.html" target="n" data-glyph="76,1" class="i method">ValidateConnectionOptions</a>(<a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a> <span id="r38 rd" class="r38 r">connectionOptions</span>)
        {
            <span class="c">// If there were no options passed, they cannot be in an invalid state.</span>
 
            <b>if</b> (<span class="r38 r">connectionOptions</span> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <span class="c">// A proxy is only valid when web sockets is used as the transport.</span>
 
            <b>if</b> ((!<span class="r38 r">connectionOptions</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>.<a href="../Core/TransportTypeExtensions.cs.html#74769f5a3f30ed15" class="i method">IsWebSocketTransport</a>()) &amp;&amp; (<span class="r38 r">connectionOptions</span>.<a href="../Client/ServiceBusClientOptions.cs.html#91c69f48952f0b0c" class="i property">WebProxy</a> != <b>null</b>))
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">CurrentCulture</span>, <a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#b751fc937cd84f73" class="i property">ProxyMustUseWebSockets</a>), <b>nameof</b>(<span class="r38 r">connectionOptions</span>));
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the actions needed to validate the set of connection string properties for connecting to the</span>
        <span class="c">///</span><span class="c">   Service Bus service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">connectionStringProperties</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of connection string properties to validate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">connectionStringArgumentName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The name of the argument associated with the connection string; to be used when raising </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> variants.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i">ArgumentException</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">In the case that the properties violate an invariant or otherwise represent a combination that is not permissible, an appropriate exception will be thrown.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private static void</b> <a id="855403e2d1c4cf76" href="../R/855403e2d1c4cf76.html" target="n" data-glyph="76,1" class="i method">ValidateConnectionStringProperties</a>(
            <a href="ServiceBusConnectionStringProperties.cs.html#b011974d70d9c929" class="t t">ServiceBusConnectionStringProperties</a> <span id="r39 rd" class="r39 r">connectionStringProperties</span>,
            <b>string</b> <span id="r40 rd" class="r40 r">connectionStringArgumentName</span>)
        {
            <b>var</b> <span id="r41 rd" class="r41 r">hasSharedKey</span> = ((!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r39 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#b51acce87d7adfd2" class="i property">SharedAccessKeyName</a>)) &amp;&amp; (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r39 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#a9d7834911da1b51" class="i property">SharedAccessKey</a>)));
            <b>var</b> <span id="r42 rd" class="r42 r">hasSharedSignature</span> = (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r39 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#12d390919cf49ab3" class="i property">SharedAccessSignature</a>));
 
            <span class="c">// Ensure that each of the needed components are present for connecting.</span>
 
            <b>if</b> ((<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r39 r">connectionStringProperties</span>.<a href="ServiceBusConnectionStringProperties.cs.html#3a46b590394b2830" class="i property">Endpoint</a>?.<span class="i">Host</span>))
                || ((!<span class="r41 r">hasSharedKey</span>) &amp;&amp; (!<span class="r42 r">hasSharedSignature</span>)))
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#28e846e124baa15d" class="i property">MissingConnectionInformation</a>, <span class="r40 r">connectionStringArgumentName</span>);
            }
 
            <span class="c">// The connection string may contain a precomputed shared access signature OR a shared key name and value,</span>
            <span class="c">// but not both.</span>
 
            <b>if</b> (<span class="r41 r">hasSharedKey</span> &amp;&amp; <span class="r42 r">hasSharedSignature</span>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#807e732929184512" class="i property">OnlyOneSharedAccessAuthorizationMayBeSpecified</a>, <span class="r40 r">connectionStringArgumentName</span>);
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
