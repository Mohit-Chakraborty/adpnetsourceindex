<!DOCTYPE html>
<html><head><title>AmqpClient.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(247);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.ServiceBus/Amqp/AmqpClient.cs" target="_top">Amqp\AmqpClient.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/servicebus/Azure.Messaging.ServiceBus/src/Amqp/AmqpClient.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.ServiceBus" target="_top">Azure.Messaging.ServiceBus.csproj</a> (Azure.Messaging.ServiceBus)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Authentication</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Authorization</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Core</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Amqp</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   A transport client abstraction responsible for brokering operations for AMQP-based connections.</span>
    <span class="c">///</span><span class="c">   It is intended that the public </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> make use of an instance via containment</span>
    <span class="c">///</span><span class="c">   and delegate operations to it.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Core</span>.<a href="../Core/TransportClient.cs.html#1e482fe9c3dcc163" class="t t">TransportClient</a><span class="c">&quot;</span> <span class="c">/&gt;</span>
    <span class="c">///</span>
    <b>internal class</b> <a id="9f0f1c6c2e39b9c2" href="../R/9f0f1c6c2e39b9c2.html" target="n" data-glyph="2,0" class="t t">AmqpClient</a> : <a href="../Core/TransportClient.cs.html#1e482fe9c3dcc163" class="t t">TransportClient</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The buffer to apply when considering refreshing; credentials that expire less than this duration will be refreshed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private static</b> <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="8c899f8cd6d2e26a" href="../R/8c899f8cd6d2e26a.html" target="n" data-glyph="106,1" class="i property">CredentialRefreshBuffer</a> { <b>get</b>; } = <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@1@netstandard/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(5);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Indicates whether or not this instance has been closed.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private bool</b> <a id="24199e07f87bb651" href="../R/24199e07f87bb651.html" target="n" data-glyph="46,1" class="i field">_closed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The currently active token to use for authorization with the Service Bus service.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private</b> <a href="/Azure.Core/A.html#b9cb398886850745" class="t t">AccessToken</a> <a id="eec4a989f8cce9e3" href="../R/eec4a989f8cce9e3.html" target="n" data-glyph="46,1" class="i field">_accessToken</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates whether or not this client has been closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the client is closed; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public override bool</b> <a id="aacc17441431ec45" href="../R/aacc17441431ec45.html" target="n" data-glyph="102,1" class="i property">IsClosed</a> =&gt; <a href="#24199e07f87bb651" class="i field">_closed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The endpoint for the Service Bus service to which the client is associated.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public override</b> <a href="@1@netstandard/A.html#991565dd25f47c90" class="t t">Uri</a> <a id="513326bb12e96584" href="../R/513326bb12e96584.html" target="n" data-glyph="102,1" class="i property">ServiceEndpoint</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Gets the credential to use for authorization with the Service Bus service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="../Authorization/ServiceBusTokenCredential.cs.html#e09f4bf6aa653648" class="t t">ServiceBusTokenCredential</a> <a id="9dbd7b9176970ec7" href="../R/9dbd7b9176970ec7.html" target="n" data-glyph="106,1" class="i property">Credential</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The AMQP connection scope responsible for managing transport constructs for this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private</b> <a href="AmqpConnectionScope.cs.html#58b30bb4c5b0d61d" class="t t">AmqpConnectionScope</a> <a id="ab8cfde6048380f7" href="../R/ab8cfde6048380f7.html" target="n" data-glyph="106,1" class="i property">ConnectionScope</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#9f0f1c6c2e39b9c2" class="t t">AmqpClient</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">host</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The fully qualified host name for the Service Bus namespace.  This is likely to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The Azure managed identity credential to use for authorization.  Access controls may be specified by the Service Bus namespace or the requested Service Bus entity, depending on Azure configuration.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A set of options to apply when configuring the client.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   As an internal type, this class performs only basic sanity checks against its arguments.  It</span>
        <span class="c">///</span><span class="c">   is assumed that callers are trusted and have performed deep validation.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   Any parameters passed are assumed to be owned by this instance and safe to mutate or dispose;</span>
        <span class="c">///</span><span class="c">   creation of clones or otherwise protecting the parameters is assumed to be the purview of the</span>
        <span class="c">///</span><span class="c">   caller.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a id="245773fd39821bba" href="../R/245773fd39821bba.html" target="n" data-glyph="74,1" class="t constructor">AmqpClient</a>(
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">host</span>,
            <a href="../Authorization/ServiceBusTokenCredential.cs.html#e09f4bf6aa653648" class="t t">ServiceBusTokenCredential</a> <span id="r1 rd" class="r1 r">credential</span>,
            <a href="../Client/ServiceBusClientOptions.cs.html#5281daacdf25ac92" class="t t">ServiceBusClientOptions</a> <span id="r2 rd" class="r2 r">options</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#6f15f042abe7f96a" class="i method">AssertNotNullOrEmpty</a>(<span class="r0 r">host</span>, <b>nameof</b>(<span class="r0 r">host</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r1 r">credential</span>, <b>nameof</b>(<span class="r1 r">credential</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r2 r">options</span>, <b>nameof</b>(<span class="r2 r">options</span>));
 
            <a href="#513326bb12e96584" class="i property">ServiceEndpoint</a> = <b>new</b> <a href="@1@netstandard/A.html#df283dbbf1cd6832" class="t constructor">UriBuilder</a>
            {
                <a href="@1@netstandard/A.html#93fdb47baf06de3c" class="i property">Scheme</a> = <span class="r2 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>.<a href="../Core/TransportTypeExtensions.cs.html#4d70475a72015f55" class="i method">GetUriScheme</a>(),
                <a href="@1@netstandard/A.html#d843f5910d2e410d" class="i property">Host</a> = <span class="r0 r">host</span>
            }.<a href="@1@netstandard/A.html#b59ac7e3edbfe76c" class="i property">Uri</a>;
 
            <a href="#9dbd7b9176970ec7" class="i property">Credential</a> = <span class="r1 r">credential</span>;
            <a href="#ab8cfde6048380f7" class="i property">ConnectionScope</a> = <b>new</b> <a href="AmqpConnectionScope.cs.html#d121eab2b4515b56" class="t constructor">AmqpConnectionScope</a>(
                <a href="#513326bb12e96584" class="i property">ServiceEndpoint</a>,
                <span class="r1 r">credential</span>,
                <span class="r2 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#beccbe5f47fe4d95" class="i property">TransportType</a>,
                <span class="r2 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#91c69f48952f0b0c" class="i property">WebProxy</a>,
                <span class="r2 r">options</span>.<a href="../Client/ServiceBusClientOptions.cs.html#e685fbc82b68990c" class="i property">EnableCrossEntityTransactions</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates a producer strongly aligned with the active protocol and transport,</span>
        <span class="c">///</span><span class="c">   responsible for publishing </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to the Service Bus entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">entityPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The entity path to send the message to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">retryPolicy</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The policy which governs retry behavior and try timeouts.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">identifier</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The identifier for the sender.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Core/TransportSender.cs.html#c54f19921ea3dbe2" class="t t">TransportSender</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> configured in the requested manner.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../Core/TransportSender.cs.html#c54f19921ea3dbe2" class="t t">TransportSender</a> <a id="9cf31bf888ad91ac" href="../R/9cf31bf888ad91ac.html" target="n" data-glyph="72,1" class="i method">CreateSender</a>(
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">entityPath</span>,
            <a href="../Primitives/ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <span id="r4 rd" class="r4 r">retryPolicy</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">identifier</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#24199e07f87bb651" class="i field">_closed</a>, <b>nameof</b>(<a href="#9f0f1c6c2e39b9c2" class="t t">AmqpClient</a>));
 
            <b>return</b> <b>new</b> <a href="AmqpSender.cs.html#381c9b3248641e26" class="t constructor">AmqpSender</a>
            (
                <span class="r3 r">entityPath</span>,
                <a href="#ab8cfde6048380f7" class="i property">ConnectionScope</a>,
                <span class="r4 r">retryPolicy</span>,
                <span class="r5 r">identifier</span>
            );
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates a receiver strongly aligned with the active protocol and transport, responsible</span>
        <span class="c">///</span><span class="c">   for reading </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> from a specific Service Bus entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">entityPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The entity path to receive from.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">retryPolicy</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The policy which governs retry behavior and try timeouts.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">receiveMode</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Receiver/ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> used to specify how messages are received. Defaults to PeekLock mode.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">prefetchCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Controls the number of events received and queued locally without regard to whether an operation was requested.  If </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">null</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> a default will be used.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">identifier</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The identifier for the sender.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">sessionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The session ID to receive messages for.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">isSessionReceiver</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether or not this is a sessionful receiver link.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">isProcessor</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether or not the receiver is being created for a processor.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the</span>
        <span class="c">///</span><span class="c">     open link operation. Only applicable for session receivers.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Core/TransportReceiver.cs.html#1b072fa1ddd22c6a" class="t t">TransportReceiver</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> configured in the requested manner.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public override</b> <a href="../Core/TransportReceiver.cs.html#1b072fa1ddd22c6a" class="t t">TransportReceiver</a> <a id="7e4f300b97c3f794" href="../R/7e4f300b97c3f794.html" target="n" data-glyph="72,1" class="i method">CreateReceiver</a>(
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">entityPath</span>,
            <a href="../Primitives/ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <span id="r7 rd" class="r7 r">retryPolicy</span>,
            <a href="../Receiver/ServiceBusReceiveMode.cs.html#baa558d5ec869168" class="t t">ServiceBusReceiveMode</a> <span id="r8 rd" class="r8 r">receiveMode</span>,
            <b>uint</b> <span id="r9 rd" class="r9 r">prefetchCount</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">identifier</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">sessionId</span>,
            <b>bool</b> <span id="r12 rd" class="r12 r">isSessionReceiver</span>,
            <b>bool</b> <span id="r13 rd" class="r13 r">isProcessor</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r14 rd" class="r14 r">cancellationToken</span>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#24199e07f87bb651" class="i field">_closed</a>, <b>nameof</b>(<a href="#9f0f1c6c2e39b9c2" class="t t">AmqpClient</a>));
 
            <b>return</b> <b>new</b> <a href="AmqpReceiver.cs.html#37851ae936e96ce8" class="t constructor">AmqpReceiver</a>
            (
                <span class="r6 r">entityPath</span>,
                <span class="r8 r">receiveMode</span>,
                <span class="r9 r">prefetchCount</span>,
                <a href="#ab8cfde6048380f7" class="i property">ConnectionScope</a>,
                <span class="r7 r">retryPolicy</span>,
                <span class="r10 r">identifier</span>,
                <span class="r11 r">sessionId</span>,
                <span class="r12 r">isSessionReceiver</span>,
                <span class="r13 r">isProcessor</span>,
                <span class="r14 r">cancellationToken</span>
            );
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Closes the connection to the transport client instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public override</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="74cd89df278eefa4" href="../R/74cd89df278eefa4.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r15 rd" class="r15 r">cancellationToken</span>)
        {
            <b>if</b> (<a href="#24199e07f87bb651" class="i field">_closed</a>)
            {
                <b>return</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
            }
 
            <a href="#24199e07f87bb651" class="i field">_closed</a> = <b>true</b>;
 
            <b>try</b>
            {
                <span class="r15 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
                <a href="#ab8cfde6048380f7" class="i property">ConnectionScope</a>?.<a href="AmqpConnectionScope.cs.html#0f202d7c95508350" class="i method">Dispose</a>();
                <b>return</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a>)
            {
                <a href="#24199e07f87bb651" class="i field">_closed</a> = <b>false</b>;
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Acquires an access token for authorization with the Service Bus service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The token to use for service authorization.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="b95048294935c4d8" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">AcquireAccessTokenAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r16 rd" class="r16 r">cancellationToken</span>)
        {
            <span class="r16 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="/Azure.Core/A.html#b9cb398886850745" class="t t">AccessToken</a> <span id="r17 rd" class="r17 r">activeToken</span> = <a href="#eec4a989f8cce9e3" class="i field">_accessToken</a>;
 
            <span class="c">// If there was no current token, or it is within the buffer for expiration, request a new token.</span>
            <span class="c">// There is a benign race condition here, where there may be multiple requests in-flight for a new token.  Since</span>
            <span class="c">// overlapping requests should be within a small window, allow the acquired token to replace the current one without</span>
            <span class="c">// attempting to coordinate or ensure that the most recent is kept.</span>
 
            <b>if</b> ((<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r17 r">activeToken</span>.<a href="/Azure.Core/A.html#348b1623ae6317b7" class="i property">Token</a>)) || (<span class="r17 r">activeToken</span>.<a href="/Azure.Core/A.html#cc84c224cb9fb4a5" class="i property">ExpiresOn</a> &lt;= <a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@1@netstandard/A.html#04abe0cac293ebd0" class="i property">UtcNow</a>.<a href="@1@netstandard/A.html#5cff8f26f5c7c095" class="i method">Add</a>(<a href="#8c899f8cd6d2e26a" class="i property">CredentialRefreshBuffer</a>)))
            {
                <span class="r17 r">activeToken</span> = <b>await</b> <a href="#9dbd7b9176970ec7" class="i property">Credential</a>.<a href="../Authorization/ServiceBusTokenCredential.cs.html#01e14ac09ff5e4d7" class="i method">GetTokenUsingDefaultScopeAsync</a>(<span class="r16 r">cancellationToken</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>);
 
                <b>if</b> ((<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r17 r">activeToken</span>.<a href="/Azure.Core/A.html#348b1623ae6317b7" class="i property">Token</a>)))
                {
                    <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#6749b117ae40d22c" class="t constructor">AuthenticationException</a>(<a href="../Resources.Designer.cs.html#7e6b2ac45384f6a8" class="t t">Resources</a>.<a href="../Resources.Designer.cs.html#12ec2b402ff00757" class="i property">CouldNotAcquireAccessToken</a>);
                }
 
                <a href="#eec4a989f8cce9e3" class="i field">_accessToken</a> = <span class="r17 r">activeToken</span>;
            }
 
            <b>return</b> <span class="r17 r">activeToken</span>.<a href="/Azure.Core/A.html#348b1623ae6317b7" class="i property">Token</a>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Uses the minimum value of the two specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> instances.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">firstOption</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The first option to consider.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">secondOption</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The second option to consider.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private static</b> <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="d553a9c9ddb3c6b5" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">UseMinimum</a>(<a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r18 rd" class="r18 r">firstOption</span>,
                                           <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r19 rd" class="r19 r">secondOption</span>) =&gt; (<span class="r18 r">firstOption</span> &lt; <span class="r19 r">secondOption</span>) ? <span class="r18 r">firstOption</span> : <span class="r19 r">secondOption</span>;
    }
}
</pre></td></tr></table></div></body></html>
