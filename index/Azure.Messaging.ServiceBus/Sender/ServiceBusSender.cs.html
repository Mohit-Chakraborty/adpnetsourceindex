<!DOCTYPE html>
<html><head><title>ServiceBusSender.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(601);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.ServiceBus/Sender/ServiceBusSender.cs" target="_top">Sender\ServiceBusSender.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/servicebus/Azure.Messaging.ServiceBus/src/Sender/ServiceBusSender.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.ServiceBus" target="_top">Azure.Messaging.ServiceBus.csproj</a> (Azure.Messaging.ServiceBus)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">CodeAnalysis</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Plugins</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   A client responsible for sending </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to a specific Service Bus entity</span>
    <span class="c">///</span><span class="c">   (Queue or Topic). It can be used for both session and non-session entities. It is constructed by calling </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Client/ServiceBusClient.cs.html#ad46ff0588c85077" class="t t">ServiceBusClient</a>.<a href="../Client/ServiceBusClient.cs.html#a445ec86cde923d7" class="i method">CreateSender</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span>
    <b>public class</b> <a id="565d94b474d31465" href="../R/565d94b474d31465.html" target="n" data-glyph="0,0" class="t t">ServiceBusSender</a> : <span class="t t">IAsyncDisposable</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">The minimum allowable size, in bytes, for a batch to be sent.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const int</b> <a id="61c33e4438b44e5a" href="../R/61c33e4438b44e5a.html" target="n" data-glyph="8,1" class="i field">MinimumBatchSizeLimit</a> = 24;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The fully qualified Service Bus namespace that the producer is associated with.  This is likely</span>
        <span class="c">///</span><span class="c">   to be similar to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">{yournamespace}.servicebus.windows.net</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual string</b> <a id="86c0cd9ddda3b581" href="../R/86c0cd9ddda3b581.html" target="n" data-glyph="102,1" class="i property">FullyQualifiedNamespace</a> =&gt; <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The path of the entity that the sender is connected to, specific to the</span>
        <span class="c">///</span><span class="c">   Service Bus namespace that contains it.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual string</b> <a id="bbf4fdfcf49d376a" href="../R/bbf4fdfcf49d376a.html" target="n" data-glyph="102,1" class="i property">EntityPath</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Indicates whether or not this </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#565d94b474d31465" class="t t">ServiceBusSender</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> has been closed.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the sender is closed; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        <b>public virtual bool</b> <a id="fc5aeb98d6044cba" href="../R/fc5aeb98d6044cba.html" target="n" data-glyph="102,1" class="i property">IsClosed</a>
        {
            <b>get</b> =&gt; <a href="#7d47f9648651d854" class="i field">_closed</a>;
            <b>private set</b> =&gt; <a href="#7d47f9648651d854" class="i field">_closed</a> = <b>value</b>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span><span class="c">Indicates whether or not this instance has been closed.</span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private volatile bool</b> <a id="7d47f9648651d854" href="../R/7d47f9648651d854.html" target="n" data-glyph="46,1" class="i field">_closed</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The instance of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> which can be mocked for testing.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a> <a id="882d9467ee0c8205" href="../R/882d9467ee0c8205.html" target="n" data-glyph="104,1" class="i property">Logger</a> { <b>get</b>; <b>set</b>; } = <a href="../Diagnostics/ServiceBusEventSource.cs.html#9f107e3f0d141c2b" class="t t">ServiceBusEventSource</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#9494c77d3f8244ec" class="i property">Log</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the ID to identify this client. This can be used to correlate logs and exceptions.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Every new client has a unique ID.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="5b8a6735cb752e7e" href="../R/5b8a6735cb752e7e.html" target="n" data-glyph="104,1" class="i property">Identifier</a> { <b>get</b>; <b>private set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The policy to use for determining retry behavior for when an operation fails.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private readonly</b> <a href="../Primitives/ServiceBusRetryPolicy.cs.html#d0d6be7ac57eb9c9" class="t t">ServiceBusRetryPolicy</a> <a id="70552db4fb0f04ba" href="../R/70552db4fb0f04ba.html" target="n" data-glyph="46,1" class="i field">_retryPolicy</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The active connection to the Azure Service Bus service, enabling client communications for metadata</span>
        <span class="c">///</span><span class="c">   about the associated Service Bus entity and access to transport-aware consumers.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private readonly</b> <a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a> <a id="a02ef8e8df64fd5f" href="../R/a02ef8e8df64fd5f.html" target="n" data-glyph="46,1" class="i field">_connection</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   An abstracted Service Bus entity transport-specific sender that is associated with the</span>
        <span class="c">///</span><span class="c">   Service Bus entity gateway rather than a specific partition; intended to perform delegated operations.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private readonly</b> <a href="../Core/TransportSender.cs.html#c54f19921ea3dbe2" class="t t">TransportSender</a> <a id="6cb8c6a9f63bf1b8" href="../R/6cb8c6a9f63bf1b8.html" target="n" data-glyph="46,1" class="i field">_innerSender</a>;
        <b>private readonly</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#9100164b526814a3" class="t t">EntityScopeFactory</a> <a id="1c12f121f76b7bfe" href="../R/1c12f121f76b7bfe.html" target="n" data-glyph="46,1" class="i field">_scopeFactory</a>;
        <b>internal readonly</b> <a href="@1@netstandard/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="../Plugins/ServiceBusPlugin.cs.html#5ee21a6788ad51aa" class="t t">ServiceBusPlugin</a>&gt; <a id="669a3c42d4d55fa2" href="../R/669a3c42d4d55fa2.html" target="n" data-glyph="44,1" class="i field">_plugins</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#565d94b474d31465" class="t t">ServiceBusSender</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">entityPath</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The entity path to send the message to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusSenderOptions.cs.html#4d0b2fc41f9a2f3c" class="t t">ServiceBusSenderOptions</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to use for configuring</span>
        <span class="c">///</span><span class="c"> this </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#565d94b474d31465" class="t t">ServiceBusSender</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">connection</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The connection for the sender.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">plugins</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Plugins to apply to outgoing messages.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>internal</b> <a id="08249505e4b19623" href="../R/08249505e4b19623.html" target="n" data-glyph="74,1" class="t constructor">ServiceBusSender</a>(
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">entityPath</span>,
            <a href="ServiceBusSenderOptions.cs.html#4d0b2fc41f9a2f3c" class="t t">ServiceBusSenderOptions</a> <span id="r1 rd" class="r1 r">options</span>,
            <a href="../Primitives/ServiceBusConnection.cs.html#5fc67fb7b5056bea" class="t t">ServiceBusConnection</a> <span id="r2 rd" class="r2 r">connection</span>,
            <a href="@1@netstandard/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="../Plugins/ServiceBusPlugin.cs.html#5ee21a6788ad51aa" class="t t">ServiceBusPlugin</a>&gt; <span id="r3 rd" class="r3 r">plugins</span>)
        {
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#bce0e360eab4841c" class="i method">ClientCreateStart</a>(<b>typeof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>), <span class="r2 r">connection</span>?.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <span class="r0 r">entityPath</span>);
            <b>try</b>
            {
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r2 r">connection</span>, <b>nameof</b>(<span class="r2 r">connection</span>));
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r2 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>, <b>nameof</b>(<span class="r2 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>));
                <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#fa55a5c88c3dc11d" class="i method">AssertNotNullOrWhiteSpace</a>(<span class="r0 r">entityPath</span>, <b>nameof</b>(<span class="r0 r">entityPath</span>));
                <span class="r2 r">connection</span>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
 
                <span class="r1 r">options</span> = <span class="r1 r">options</span> ?? <b>new</b> <a href="ServiceBusSenderOptions.cs.html#4d0b2fc41f9a2f3c" class="t constructor">ServiceBusSenderOptions</a>();
                <a href="#bbf4fdfcf49d376a" class="i property">EntityPath</a> = <span class="r0 r">entityPath</span>;
                <a href="#5b8a6735cb752e7e" class="i property">Identifier</a> = <a href="../Diagnostics/DiagnosticUtilities.cs.html#e63dadcef3cbbce1" class="t t">DiagnosticUtilities</a>.<a href="../Diagnostics/DiagnosticUtilities.cs.html#582c96465587da53" class="i method">GenerateIdentifier</a>(<a href="#bbf4fdfcf49d376a" class="i property">EntityPath</a>);
                <a href="#a02ef8e8df64fd5f" class="i field">_connection</a> = <span class="r2 r">connection</span>;
                <a href="#70552db4fb0f04ba" class="i field">_retryPolicy</a> = <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#6fbb28757496f6ee" class="i property">RetryOptions</a>.<a href="../Core/ServiceBusRetryOptionsExtensions.cs.html#d698c84551779460" class="i method">ToRetryPolicy</a>();
                <a href="#6cb8c6a9f63bf1b8" class="i field">_innerSender</a> = <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#43eed66c6da39eaf" class="i method">CreateTransportSender</a>(
                    <span class="r0 r">entityPath</span>,
                    <a href="#70552db4fb0f04ba" class="i field">_retryPolicy</a>,
                    <a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
                <a href="#1c12f121f76b7bfe" class="i field">_scopeFactory</a> = <b>new</b> <a href="../Diagnostics/EntityScopeFactory.cs.html#5f446a7a93a315a4" class="t constructor">EntityScopeFactory</a>(<a href="#bbf4fdfcf49d376a" class="i property">EntityPath</a>, <a href="#86c0cd9ddda3b581" class="i property">FullyQualifiedNamespace</a>);
                <a href="#669a3c42d4d55fa2" class="i field">_plugins</a> = <span class="r3 r">plugins</span>;
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r4 rd" class="r4 r">ex</span>)
            {
                <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#4f15a6cd3577965b" class="i method">ClientCreateException</a>(<b>typeof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>), <span class="r2 r">connection</span>?.<a href="../Primitives/ServiceBusConnection.cs.html#729943334b661165" class="i property">FullyQualifiedNamespace</a>, <span class="r0 r">entityPath</span>, <span class="r4 r">ex</span>);
                <b>throw</b>;
            }
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#d5ab92363723b0fc" class="i method">ClientCreateComplete</a>(<b>typeof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>), <a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#565d94b474d31465" class="t t">ServiceBusSender</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class for mocking.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>protected</b> <a id="5162fed980229f82" href="../R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">ServiceBusSender</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Sends a message to the associated entity of Service Bus.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The message to send.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The message exceeds the maximum size allowed, as determined by the Service Bus service.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#b44f1502e62216ba" class="i field">MessageSizeExceeded</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c">   For more information on service limits, see</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">href</span><span class="c">=</span><span class="c">&quot;</span><span class="c">https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quotas#messaging-quotas</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0be5b6e30acbf9ea" href="../R/0be5b6e30acbf9ea.html" target="n" data-glyph="72,1" class="i method">SendMessageAsync</a>(
            <a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a> <span id="r5 rd" class="r5 r">message</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r6 rd" class="r6 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r5 r">message</span>, <b>nameof</b>(<span class="r5 r">message</span>));
            <b>await</b> <a href="#5daa770986dcd3fa" class="i method">SendMessagesAsync</a>(
                <b>new</b> <a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>[] { <span class="r5 r">message</span> },
                <span class="r6 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Sends a set of messages to the associated Service Bus entity using a batched approach.</span>
        <span class="c">///</span><span class="c">   If the size of the messages exceed the maximum size of a single batch,</span>
        <span class="c">///</span><span class="c">   an exception will be triggered and the send will fail. In order to ensure that the messages</span>
        <span class="c">///</span><span class="c">   being sent will fit in a batch, use </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#0e176e7fb638c8cf" class="i method">SendMessagesAsync</a>(<a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instead.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">messages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of messages to send.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The set of messages exceeds the maximum size allowed in a single batch, as determined by the Service Bus service.</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusException.cs.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="../Primitives/ServiceBusException.cs.html#b39014a14c98853e" class="i property">Reason</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be set to </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusFailureReason.cs.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="../Primitives/ServiceBusFailureReason.cs.html#b44f1502e62216ba" class="i field">MessageSizeExceeded</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> in this case.</span>
        <span class="c">///</span><span class="c">   For more information on service limits, see</span>
        <span class="c">///</span><span class="c">   </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">href</span><span class="c">=</span><span class="c">&quot;</span><span class="c">https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quotas#messaging-quotas</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5daa770986dcd3fa" href="../R/5daa770986dcd3fa.html" target="n" data-glyph="72,1" class="i method">SendMessagesAsync</a>(
            <a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r7 rd" class="r7 r">messages</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r8 rd" class="r8 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r7 r">messages</span>, <b>nameof</b>(<span class="r7 r">messages</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#fc5aeb98d6044cba" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>));
            <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
 
            <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r9 rd" class="r9 r">messageList</span> = <span class="r7 r">messages</span> <b>switch</b>
            {
                <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r10 rd" class="r10 r">alreadyList</span> =&gt; <span class="r10 r">alreadyList</span>,
                <b>_</b> =&gt; <span class="r7 r">messages</span>.<a href="@1@netstandard/A.html#e276d6892241255b" class="i method">ToList</a>()
            };
 
            <b>if</b> (<span class="r9 r">messageList</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a> == 0)
            {
                <b>return</b>;
            }
            <b>await</b> <a href="#043780921bbeec1c" class="i method">ApplyPlugins</a>(<span class="r9 r">messageList</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            <span class="r8 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#168ba5530aedd189" class="i method">SendMessageStart</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r11 r">messageCount</span>: <span class="r9 r">messageList</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a>);
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r12 rd" class="r12 r">scope</span> = <a href="#f60393f5db23ff1b" class="i method">CreateDiagnosticScope</a>(<span class="r7 r">messages</span>, <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#0e51af1e44542be1" class="i property">SendActivityName</a>);
            <span class="r12 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#6cb8c6a9f63bf1b8" class="i field">_innerSender</a>.<a href="../Core/TransportSender.cs.html#ea6e4dd19c006ca0" class="i method">SendAsync</a>(
                    <span class="r9 r">messageList</span>,
                    <span class="r8 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
 
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r13 rd" class="r13 r">exception</span>)
            {
                <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#9fdc46641ca4a084" class="i method">SendMessageException</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r13 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r12 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r13 r">exception</span>);
                <b>throw</b>;
            }
            <span class="r8 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#4121b75cf4f7f8ec" class="i method">SendMessageComplete</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
        }
 
        <b>private async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="043780921bbeec1c" href="../R/043780921bbeec1c.html" target="n" data-glyph="76,1" class="i method">ApplyPlugins</a>(<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r14 rd" class="r14 r">messages</span>)
        {
            <b>foreach</b> (<a href="../Plugins/ServiceBusPlugin.cs.html#5ee21a6788ad51aa" class="t t">ServiceBusPlugin</a> <span id="r15 rd" class="r15 r">plugin</span> <b>in</b> <a href="#669a3c42d4d55fa2" class="i field">_plugins</a>)
            {
                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r16 rd" class="r16 r">pluginType</span> = <span class="r15 r">plugin</span>.<a href="@1@netstandard/A.html#4d73eb225aef8a61" class="i method">GetType</a>().<a href="@1@netstandard/A.html#aa4f112f79364b6e" class="i property">Name</a>;
                <b>foreach</b> (<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a> <span id="r17 rd" class="r17 r">message</span> <b>in</b> <span class="r14 r">messages</span>)
                {
                    <b>try</b>
                    {
                        <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#1b6b09935438b552" class="i method">PluginCallStarted</a>(<span class="r16 r">pluginType</span>, <span class="r17 r">message</span>.<a href="../Primitives/ServiceBusMessage.cs.html#62234b00feff0e3f" class="i property">MessageId</a>);
                        <b>await</b> <span class="r15 r">plugin</span>.<a href="../Plugins/ServiceBusPlugin.cs.html#00e29c92e30af1bd" class="i method">BeforeMessageSendAsync</a>(<span class="r17 r">message</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>);
                        <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#106ccbe88f594deb" class="i method">PluginCallCompleted</a>(<span class="r16 r">pluginType</span>, <span class="r17 r">message</span>.<a href="../Primitives/ServiceBusMessage.cs.html#62234b00feff0e3f" class="i property">MessageId</a>);
                    }
                    <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r18 rd" class="r18 r">ex</span>)
                    {
                        <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#4410b63cd327c4a3" class="i method">PluginCallException</a>(<span class="r16 r">pluginType</span>, <span class="r17 r">message</span>.<a href="../Primitives/ServiceBusMessage.cs.html#62234b00feff0e3f" class="i property">MessageId</a>, <span class="r18 r">ex</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                        <b>throw</b>;
                    }
                }
            }
        }
 
        <b>private</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <a id="f60393f5db23ff1b" href="../R/f60393f5db23ff1b.html" target="n" data-glyph="76,1" class="i method">CreateDiagnosticScope</a>(<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r19 rd" class="r19 r">messages</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r20 rd" class="r20 r">activityName</span>)
        {
            <b>foreach</b> (<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a> <span id="r21 rd" class="r21 r">message</span> <b>in</b> <span class="r19 r">messages</span>)
            {
                <a href="#1c12f121f76b7bfe" class="i field">_scopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#1fee23b415a06c76" class="i method">InstrumentMessage</a>(<span class="r21 r">message</span>);
            }
 
            <span class="c">// create a new scope for the specified operation</span>
            <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r22 rd" class="r22 r">scope</span> = <a href="#1c12f121f76b7bfe" class="i field">_scopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <span class="r20 r">activityName</span>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
 
            <span class="r22 r">scope</span>.<a href="../Diagnostics/DiagnosticExtensions.cs.html#6ef24d72ea32a849" class="i method">SetMessageData</a>(<span class="r19 r">messages</span>);
            <b>return</b> <span class="r22 r">scope</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates a size-constraint batch to which </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> may be added using</span>
        <span class="c">///</span><span class="c">   a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a>.<a href="ServiceBusMessageBatch.cs.html#6680c7a85fc9d380" class="i method">TryAddMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">. If a message would exceed the maximum</span>
        <span class="c">///</span><span class="c">   allowable size of the batch, the batch will not allow adding the message and signal that</span>
        <span class="c">///</span><span class="c">   scenario using it return value.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   Because messages that would violate the size constraint cannot be added, publishing a batch</span>
        <span class="c">///</span><span class="c">   will not trigger an exception when attempting to send the messages to the Queue/Topic.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> with the default batch options.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#7f2b9a4a3259b167" class="i method">CreateMessageBatchAsync</a>(<a href="CreateMessageBatchOptions.cs.html#8481199c5c5cc750" class="t t">CreateMessageBatchOptions</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span> <span class="c">/&gt;</span>
        <span class="c">///</span>
        <b>public virtual</b> <span class="t t">ValueTask</span>&lt;<a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a>&gt; <a id="2a4fb351785793f7" href="../R/2a4fb351785793f7.html" target="n" data-glyph="72,1" class="i method">CreateMessageBatchAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r23 rd" class="r23 r">cancellationToken</span> = <b>default</b>) =&gt; <a href="#7f2b9a4a3259b167" class="i method">CreateMessageBatchAsync</a>(<b>null</b>, <span class="r23 r">cancellationToken</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Creates a size-constraint batch to which </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> may be added using a try-based pattern.  If a message would</span>
        <span class="c">///</span><span class="c">   exceed the maximum allowable size of the batch, the batch will not allow adding the message and signal that scenario using its</span>
        <span class="c">///</span><span class="c">   return value.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c">   Because messages that would violate the size constraint cannot be added, publishing a batch will not trigger an exception when</span>
        <span class="c">///</span><span class="c">   attempting to send the messages to the Queue/Topic.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of options to consider when creating this batch.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> with the requested </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">options</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">seealso</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#7f2b9a4a3259b167" class="i method">CreateMessageBatchAsync</a>(<a href="CreateMessageBatchOptions.cs.html#8481199c5c5cc750" class="t t">CreateMessageBatchOptions</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span> <span class="c">/&gt;</span>
        <span class="c">///</span>
        <b>public virtual async</b> <span class="t t">ValueTask</span>&lt;<a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a>&gt; <a id="7f2b9a4a3259b167" href="../R/7f2b9a4a3259b167.html" target="n" data-glyph="72,1" class="i method">CreateMessageBatchAsync</a>(
            <a href="CreateMessageBatchOptions.cs.html#8481199c5c5cc750" class="t t">CreateMessageBatchOptions</a> <span id="r24 rd" class="r24 r">options</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r25 rd" class="r25 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#fc5aeb98d6044cba" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>));
            <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
 
            <span class="r24 r">options</span> = <span class="r24 r">options</span>?.<a href="CreateMessageBatchOptions.cs.html#d35cadbcc5cfd40b" class="i method">Clone</a>() ?? <b>new</b> <a href="CreateMessageBatchOptions.cs.html#8481199c5c5cc750" class="t constructor">CreateMessageBatchOptions</a>();
            <span class="r25 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#0d60e20ec7d5afbe" class="i method">CreateMessageBatchStart</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
            <a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a> <span id="r26 rd" class="r26 r">batch</span>;
            <b>try</b>
            {
                <a href="../Core/TransportMessageBatch.cs.html#3b59283f63988656" class="t t">TransportMessageBatch</a> <span id="r27 rd" class="r27 r">transportBatch</span> = <b>await</b> <a href="#6cb8c6a9f63bf1b8" class="i field">_innerSender</a>.<a href="../Core/TransportSender.cs.html#d7d51a7b3fc857ae" class="i method">CreateMessageBatchAsync</a>(<span class="r24 r">options</span>, <span class="r25 r">cancellationToken</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>);
                <span class="r26 r">batch</span> = <b>new</b> <a href="ServiceBusMessageBatch.cs.html#28ac8c0f54c70d95" class="t constructor">ServiceBusMessageBatch</a>(<span class="r27 r">transportBatch</span>, <a href="#1c12f121f76b7bfe" class="i field">_scopeFactory</a>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r28 rd" class="r28 r">ex</span>)
            {
                <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#0a4ce943b15baecc" class="i method">CreateMessageBatchException</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r28 r">ex</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <b>throw</b>;
            }
            <span class="r25 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#cfc914a8b7897e1c" class="i method">CreateMessageBatchComplete</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
            <b>return</b> <span class="r26 r">batch</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Sends a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c">   containing a set of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to</span>
        <span class="c">///</span><span class="c">   the associated Service Bus entity.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">messageBatch</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The batch of messages to send. A batch may be created using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#2a4fb351785793f7" class="i method">CreateMessageBatchAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0e176e7fb638c8cf" href="../R/0e176e7fb638c8cf.html" target="n" data-glyph="72,1" class="i method">SendMessagesAsync</a>(
            <a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a> <span id="r29 rd" class="r29 r">messageBatch</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r30 rd" class="r30 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r29 r">messageBatch</span>, <b>nameof</b>(<span class="r29 r">messageBatch</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#fc5aeb98d6044cba" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>));
            <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
 
            <b>if</b> (<span class="r29 r">messageBatch</span>.<a href="ServiceBusMessageBatch.cs.html#a015ed58451e00a1" class="i property">Count</a> == 0)
            {
                <b>return</b>;
            }
 
            <span class="r30 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#168ba5530aedd189" class="i method">SendMessageStart</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r29 r">messageBatch</span>.<a href="ServiceBusMessageBatch.cs.html#a015ed58451e00a1" class="i property">Count</a>);
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r31 rd" class="r31 r">scope</span> = <a href="#f60393f5db23ff1b" class="i method">CreateDiagnosticScope</a>(
                <span class="r29 r">messageBatch</span>.<a href="ServiceBusMessageBatch.cs.html#5670e8d78393f8b9" class="i method">AsEnumerable</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt;(),
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#0e51af1e44542be1" class="i property">SendActivityName</a>);
            <span class="r31 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <span class="r29 r">messageBatch</span>.<a href="ServiceBusMessageBatch.cs.html#83ae400673384596" class="i method">Lock</a>();
                <b>await</b> <a href="#6cb8c6a9f63bf1b8" class="i field">_innerSender</a>.<a href="../Core/TransportSender.cs.html#5492bbd60c386cb3" class="i method">SendBatchAsync</a>(<span class="r29 r">messageBatch</span>, <span class="r30 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r32 rd" class="r32 r">exception</span>)
            {
                <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#9fdc46641ca4a084" class="i method">SendMessageException</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r32 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r31 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r32 r">exception</span>);
                <b>throw</b>;
            }
            <b>finally</b>
            {
                <span class="r29 r">messageBatch</span>.<a href="ServiceBusMessageBatch.cs.html#f9bb92bd49850f53" class="i method">Unlock</a>();
            }
 
            <span class="r30 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#4121b75cf4f7f8ec" class="i method">SendMessageComplete</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Schedules a message to appear on Service Bus at a later time.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r33 r">message</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to schedule.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">scheduledEnqueueTime</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The UTC time at which the message should be available for processing</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Although the message will not be available to be received until the scheduledEnqueueTime, it can still be peeked before that time.</span>
        <span class="c">///</span><span class="c"> Messages can also be scheduled by setting </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>.<a href="../Primitives/ServiceBusMessage.cs.html#d2408da419959fb8" class="i property">ScheduledEnqueueTime</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and</span>
        <span class="c">///</span><span class="c"> using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#0be5b6e30acbf9ea" class="i method">SendMessageAsync</a>(<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5daa770986dcd3fa" class="i method">SendMessagesAsync</a>(<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>{<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>}, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#0e176e7fb638c8cf" class="i method">SendMessagesAsync</a>(<a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The sequence number of the message that was scheduled.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<b>long</b>&gt; <a id="dd1fb1a77c95872e" href="../R/dd1fb1a77c95872e.html" target="n" data-glyph="72,1" class="i method">ScheduleMessageAsync</a>(
            <a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a> <span id="r33 rd" class="r33 r">message</span>,
            <a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r34 rd" class="r34 r">scheduledEnqueueTime</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r35 rd" class="r35 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r33 r">message</span>, <b>nameof</b>(<span class="r33 r">message</span>));
            <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<b>long</b>&gt; <span id="r36 rd" class="r36 r">sequenceNumbers</span> = <b>await</b> <a href="#cfa627b2cc6b86d4" class="i method">ScheduleMessagesAsync</a>(
                <b>new</b> <a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>[] { <span class="r33 r">message</span> },
                <span class="r34 r">scheduledEnqueueTime</span>,
                <span class="r35 r">cancellationToken</span>)
            .<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            <span class="c">// if there isn&#39;t one sequence number in the list, an</span>
            <span class="c">// exception should have been thrown by this point.</span>
            <b>return</b> <span class="r36 r">sequenceNumbers</span>[0];
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Schedules a set of messages to appear on Service Bus at a later time.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">messages</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of messages to schedule.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">scheduledEnqueueTime</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The UTC time at which the message should be available for processing</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span><span class="c">Although the message will not be available to be received until the scheduledEnqueueTime, it can still be peeked before that time.</span>
        <span class="c">///</span><span class="c"> Messages can also be scheduled by setting </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>.<a href="../Primitives/ServiceBusMessage.cs.html#d2408da419959fb8" class="i property">ScheduledEnqueueTime</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and</span>
        <span class="c">///</span><span class="c"> using </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#0be5b6e30acbf9ea" class="i method">SendMessageAsync</a>(<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">,</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#5daa770986dcd3fa" class="i method">SendMessagesAsync</a>(<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>{<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>}, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">, or</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#0e176e7fb638c8cf" class="i method">SendMessagesAsync</a>(<a href="ServiceBusMessageBatch.cs.html#31077058165fc40f" class="t t">ServiceBusMessageBatch</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The sequence number of the message that was scheduled.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<b>long</b>&gt;&gt; <a id="cfa627b2cc6b86d4" href="../R/cfa627b2cc6b86d4.html" target="n" data-glyph="72,1" class="i method">ScheduleMessagesAsync</a>(
            <a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r37 rd" class="r37 r">messages</span>,
            <a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r38 rd" class="r38 r">scheduledEnqueueTime</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r39 rd" class="r39 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r37 r">messages</span>, <b>nameof</b>(<span class="r37 r">messages</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#fc5aeb98d6044cba" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>));
            <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <span class="r39 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r40 rd" class="r40 r">messageList</span> = <span class="r37 r">messages</span> <b>switch</b>
            {
                <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a>&gt; <span id="r41 rd" class="r41 r">alreadyList</span> =&gt; <span class="r41 r">alreadyList</span>,
                <b>_</b> =&gt; <span class="r37 r">messages</span>.<a href="@1@netstandard/A.html#e276d6892241255b" class="i method">ToList</a>()
            };
 
            <b>if</b> (<span class="r40 r">messageList</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a> == 0)
            {
                <b>return</b> <a href="@1@netstandard/A.html#156e066ecc4ccedf" class="t t">Array</a>.<a href="@1@netstandard/A.html#bc9fd1be0e4f4e70" class="i method">Empty</a>&lt;<b>long</b>&gt;();
            }
 
            <b>await</b> <a href="#043780921bbeec1c" class="i method">ApplyPlugins</a>(<span class="r40 r">messageList</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#c009a168050e551c" class="i method">ScheduleMessagesStart</a>(
                <a href="#5b8a6735cb752e7e" class="i property">Identifier</a>,
                <span class="r40 r">messageList</span>.<a href="@1@netstandard/A.html#6f182bb82f68780e" class="i property">Count</a>,
                <span class="r38 r">scheduledEnqueueTime</span>.<a href="@1@netstandard/A.html#5471050c9814717e" class="i method">ToString</a>(<a href="@1@netstandard/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@netstandard/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>));
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r42 rd" class="r42 r">scope</span> = <a href="#f60393f5db23ff1b" class="i method">CreateDiagnosticScope</a>(
                <span class="r37 r">messages</span>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#a94bfe3878fbb6d3" class="i property">ScheduleActivityName</a>);
            <span class="r42 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<b>long</b>&gt; <span id="r43 rd" class="r43 r">sequenceNumbers</span> = <b>null</b>;
            <b>try</b>
            {
                <b>foreach</b> (<a href="../Primitives/ServiceBusMessage.cs.html#55f40903fe7b78d8" class="t t">ServiceBusMessage</a> <span id="r44 rd" class="r44 r">message</span> <b>in</b> <span class="r40 r">messageList</span>)
                {
                    <span class="r44 r">message</span>.<a href="../Primitives/ServiceBusMessage.cs.html#d2408da419959fb8" class="i property">ScheduledEnqueueTime</a> = <span class="r38 r">scheduledEnqueueTime</span>.<a href="@1@netstandard/A.html#ae3e62dcd82c2422" class="i property">UtcDateTime</a>;
                }
                <span class="r43 r">sequenceNumbers</span> = <b>await</b> <a href="#6cb8c6a9f63bf1b8" class="i field">_innerSender</a>.<a href="../Core/TransportSender.cs.html#236d7040dad4968a" class="i method">ScheduleMessagesAsync</a>(<span class="r40 r">messageList</span>, <span class="r39 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r45 rd" class="r45 r">exception</span>)
            {
                <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#9417675265e02791" class="i method">ScheduleMessagesException</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r45 r">exception</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <span class="r42 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r45 r">exception</span>);
                <b>throw</b>;
            }
 
            <span class="r39 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#7689168ac8c08dc1" class="i method">ScheduleMessagesComplete</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
            <b>return</b> <span class="r43 r">sequenceNumbers</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cancels a message that was scheduled.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> of the message to be cancelled.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r47 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5be83497f11e4e3b" href="../R/5be83497f11e4e3b.html" target="n" data-glyph="72,1" class="i method">CancelScheduledMessageAsync</a>(
            <b>long</b> <span id="r46 rd" class="r46 r">sequenceNumber</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r47 rd" class="r47 r">cancellationToken</span> = <b>default</b>) =&gt;
            <b>await</b> <a href="#4c30228eeadb2b41" class="i method">CancelScheduledMessagesAsync</a>(
                <b>new</b> <b>long</b>[] { <span class="r46 r">sequenceNumber</span> },
                <span class="r47 r">cancellationToken</span>)
            .<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Cancels a set of messages that were scheduled.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r48 r">sequenceNumbers</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The set of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Primitives/ServiceBusReceivedMessage.cs.html#347e87fb652ef164" class="t t">ServiceBusReceivedMessage</a>.<a href="../Primitives/ServiceBusReceivedMessage.cs.html#60eeb92ab1c1889a" class="i property">SequenceNumber</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> of the messages to be cancelled.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="4c30228eeadb2b41" href="../R/4c30228eeadb2b41.html" target="n" data-glyph="72,1" class="i method">CancelScheduledMessagesAsync</a>(
            <a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<b>long</b>&gt; <span id="r48 rd" class="r48 r">sequenceNumbers</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r49 rd" class="r49 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../SharedSource/Azure.Core/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r48 r">sequenceNumbers</span>, <b>nameof</b>(<span class="r48 r">sequenceNumbers</span>));
            <a href="../P/0198b1312554d2ed.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="../Core/Argument.cs.html#ad31cdc7051f5f26" class="i method">AssertNotDisposed</a>(<a href="#fc5aeb98d6044cba" class="i property">IsClosed</a>, <b>nameof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>));
            <a href="#a02ef8e8df64fd5f" class="i field">_connection</a>.<a href="../Primitives/ServiceBusConnection.cs.html#9c53664d76dd11d7" class="i method">ThrowIfClosed</a>();
            <span class="r49 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
 
            <span class="c">// the sequence numbers MUST be in array form for them to be encoded correctly</span>
            <b>long</b>[] <span id="r50 rd" class="r50 r">sequenceArray</span> = <span class="r48 r">sequenceNumbers</span> <b>switch</b>
            {
                <b>long</b>[] <span id="r51 rd" class="r51 r">alreadyArray</span> =&gt; <span class="r51 r">alreadyArray</span>,
                <b>_</b> =&gt; <span class="r48 r">sequenceNumbers</span>.<a href="@1@netstandard/A.html#783a052330e7d48d" class="i method">ToArray</a>()
            };
 
            <b>if</b> (<span class="r50 r">sequenceArray</span>.<a href="@1@netstandard/A.html#42e9b7616956cf94" class="i property">Length</a> == 0)
            {
                <b>return</b>;
            }
 
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#3bfcd52f99137f52" class="i method">CancelScheduledMessagesStart</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r50 r">sequenceArray</span>);
 
            <b>using</b> <a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r52 rd" class="r52 r">scope</span> = <a href="#1c12f121f76b7bfe" class="i field">_scopeFactory</a>.<a href="../Diagnostics/EntityScopeFactory.cs.html#a8efaa1ce26bea38" class="i method">CreateScope</a>(
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#c26cf9f5478d0bfa" class="i property">CancelActivityName</a>,
                <a href="../Diagnostics/DiagnosticProperty.cs.html#97b04f181690465e" class="t t">DiagnosticProperty</a>.<a href="../Diagnostics/DiagnosticProperty.cs.html#27a05ff983cef8c0" class="i field">ClientKind</a>);
            <span class="r52 r">scope</span>.<a href="../SharedSource/Azure.Core/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
 
            <b>try</b>
            {
                <b>await</b> <a href="#6cb8c6a9f63bf1b8" class="i field">_innerSender</a>.<a href="../Core/TransportSender.cs.html#7561a2f2152139e9" class="i method">CancelScheduledMessagesAsync</a>(<span class="r50 r">sequenceArray</span>, <span class="r49 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r53 rd" class="r53 r">ex</span>)
            {
                <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#4ce7d9d444f1b1f6" class="i method">CancelScheduledMessagesException</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r53 r">ex</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <b>throw</b>;
            }
 
            <span class="r49 r">cancellationToken</span>.<a href="../Core/CancellationTokenExtensions.cs.html#9458d2ff9fec0a3b" class="i method">ThrowIfCancellationRequested</a>&lt;<a href="@1@netstandard/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>&gt;();
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#ba958f4fb099c188" class="i method">CancelScheduledMessagesComplete</a>(<a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the task needed to clean up resources used by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#565d94b474d31465" class="t t">ServiceBusSender</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r54 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> An optional</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> instance to signal the</span>
        <span class="c">///</span><span class="c"> request to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="214a5089cee494d5" href="../R/214a5089cee494d5.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r54 rd" class="r54 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="#fc5aeb98d6044cba" class="i property">IsClosed</a> = <b>true</b>;
 
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#1855ea9b2d696f3a" class="i method">ClientCloseStart</a>(<b>typeof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>), <a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
 
            <b>try</b>
            {
                <b>await</b> <a href="#6cb8c6a9f63bf1b8" class="i field">_innerSender</a>.<a href="../Core/TransportSender.cs.html#84994a5fe098c717" class="i method">CloseAsync</a>(<span class="r54 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r55 rd" class="r55 r">ex</span>)
            {
                <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#f72cbabc5482c63e" class="i method">ClientCloseException</a>(<b>typeof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>), <a href="#5b8a6735cb752e7e" class="i property">Identifier</a>, <span class="r55 r">ex</span>);
                <b>throw</b>;
            }
 
            <a href="#882d9467ee0c8205" class="i property">Logger</a>.<a href="../Diagnostics/ServiceBusEventSource.cs.html#14069d9c61f76ddc" class="i method">ClientCloseComplete</a>(<b>typeof</b>(<a href="#565d94b474d31465" class="t t">ServiceBusSender</a>), <a href="#5b8a6735cb752e7e" class="i property">Identifier</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Performs the task needed to clean up resources used by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#565d94b474d31465" class="t t">ServiceBusSender</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c">   This is equivalent to calling </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#214a5089cee494d5" class="i method">CloseAsync</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A task to be resolved on when the operation has completed.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<a href="@1@netstandard/A.html#5e00de6576fb9ce7" class="t constructor">SuppressMessage</a>(<span class="s">&quot;Usage&quot;</span>, <span class="s">&quot;AZC0002:Ensure all service methods take an optional CancellationToken parameter.&quot;</span>,
            <a href="@1@netstandard/A.html#ce02a652a479502a" class="i property">Justification</a> = <span class="s">&quot;This signature must match the IAsyncDisposable interface.&quot;</span>)]
        <b>public virtual async</b> <span class="t t">ValueTask</span> <a id="d48d314cc40df06a" href="../R/d48d314cc40df06a.html" target="n" data-glyph="72,1" class="i method">DisposeAsync</a>()
        {
            <b>await</b> <a href="#214a5089cee494d5" class="i method">CloseAsync</a>().<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            <a href="@1@netstandard/A.html#25d9c1e022317a99" class="t t">GC</a>.<a href="@1@netstandard/A.html#2673f5220a565bf2" class="i method">SuppressFinalize</a>(<a href="#565d94b474d31465" class="k">this</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Determines whether the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r56 r">obj</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> to compare with this instance.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> if the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#d9262ceecc1719ab" class="t t">Object</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is equal to this instance; otherwise, </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">false</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override bool</b> <a id="8820c82c6ab30c3d" href="../R/8820c82c6ab30c3d.html" target="n" data-glyph="72,1" class="i method">Equals</a>(<b>object</b> <span id="r56 rd" class="r56 r">obj</span>) =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#517682d5f6f4f8b4" class="i method">Equals</a>(<span class="r56 r">obj</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Returns a hash code for this instance.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A hash code for this instance, suitable for use in hashing algorithms and data structures like a hash table.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override int</b> <a id="500ab72cf9ba8fcd" href="../R/500ab72cf9ba8fcd.html" target="n" data-glyph="72,1" class="i method">GetHashCode</a>() =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#4de9cf234d0d8b16" class="i method">GetHashCode</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Converts the instance to string representation.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="t t">String</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> that represents this instance.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<a href="@1@netstandard/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@netstandard/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@netstandard/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
        <b>public override string</b> <a id="d9dea4a18bfebd30" href="../R/d9dea4a18bfebd30.html" target="n" data-glyph="72,1" class="i method">ToString</a>() =&gt; <a href="@1@netstandard/A.html#d9262ceecc1719ab" class="k">base</a>.<a href="@1@netstandard/A.html#ff31a6bf27c58f89" class="i method">ToString</a>();
    }
}
</pre></td></tr></table></div></body></html>
