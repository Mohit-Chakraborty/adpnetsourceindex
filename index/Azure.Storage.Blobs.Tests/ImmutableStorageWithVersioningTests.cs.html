<!DOCTYPE html>
<html><head><title>ImmutableStorageWithVersioningTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(880);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Storage.Blobs.Tests/ImmutableStorageWithVersioningTests.cs" target="_top">ImmutableStorageWithVersioningTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/storage/Azure.Storage.Blobs/tests/ImmutableStorageWithVersioningTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Storage.Blobs.Tests" target="_top">Azure.Storage.Blobs.Tests.csproj</a> (Azure.Storage.Blobs.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Specialized</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Sas</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Test</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Test</span>.<span class="i n">Shared</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Storage</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Test</span>
{
    <b>public class</b> <a id="479aaa93775c9b40" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">ImmutableStorageWithVersioningTests</a> : <a href="BlobTestBase.cs.html#eff0070a998fc610" class="t t">BlobTestBase</a>
    {
        <b>public</b> <a id="974df3a2e4c37fdb" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ImmutableStorageWithVersioningTests</a>(<b>bool</b> <span id="r0 rd" class="r0 r">async</span>, <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a> <span id="r1 rd" class="r1 r">serviceVersion</span>)
            : <a href="BlobTestBase.cs.html#584bc3bfb854a893" class="k">base</a>(<span class="r0 r">async</span>, <span class="r1 r">serviceVersion</span>, <b>null</b> <span class="c">/* RecordedTestMode.Record /* to re-record */</span>)
        {
        }
 
        <span class="c">// The container is shared by all tests in this class</span>
        <b>private string</b> <a id="8c71bd6446fae426" href="R/8c71bd6446fae426.html" target="n" data-glyph="46,1" class="i field">_containerName</a>;
        <b>private</b> <a href="/Microsoft.Azure.Management.Storage/A.html#be8ed3aa512cffb7" class="t t">StorageManagementClient</a> <a id="654e8755fa4fb77b" href="R/654e8755fa4fb77b.html" target="n" data-glyph="46,1" class="i field">_storageManagementClient</a>;
 
        <b>private</b> <a href="/Azure.Storage.Blobs/A.html#6bb2c165ee95c7d4" class="t t">BlobContainerClient</a> <a id="fc29a5ac1100b942" href="R/fc29a5ac1100b942.html" target="n" data-glyph="46,1" class="i field">_containerClient</a>;
 
        [<span class="t constructor">OneTimeSetUp</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="d95afb9a1a69de83" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GlobalSetUp</a>()
        {
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> != <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>)
            {
                <a href="#8c71bd6446fae426" class="i field">_containerName</a> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
                <a href="Shared/TenantConfiguration.cs.html#62e7bd508929cb2a" class="k">var</a> <span id="r2 rd" class="r2 r">configuration</span> = <a href="Shared/TestConfigurations.cs.html#09c438cc2df2e17f" class="t t">TestConfigurations</a>.<a href="Shared/TestConfigurations.cs.html#99e6fd959b52df5b" class="i property">DefaultTargetOAuthTenant</a>;
 
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">subscriptionId</span> = <span class="r2 r">configuration</span>.<a href="Shared/TenantConfiguration.cs.html#7e9be6f8ee823b54" class="i property">SubscriptionId</a>;
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r4 rd" class="r4 r">scopes</span> = <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <span class="s">&quot;https://management.azure.com/.default&quot;</span> };
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">token</span> = <b>await</b> <a href="Shared/StorageTestBase.cs.html#1563cec55eb35f41" class="i method">GetAuthToken</a>(<span class="r4 r">scopes</span>, <span class="r2 r">configuration</span>);
                <a href="/Microsoft.Rest.ClientRuntime/A.html#c4acaa66018e3f32" class="t t">TokenCredentials</a> <span id="r6 rd" class="r6 r">tokenCredentials</span> = <b>new</b> <a href="/Microsoft.Rest.ClientRuntime/A.html#7760d207e8a5d05e" class="t constructor">TokenCredentials</a>(<span class="r5 r">token</span>);
                <a href="#654e8755fa4fb77b" class="i field">_storageManagementClient</a> = <b>new</b> <a href="/Microsoft.Azure.Management.Storage/A.html#9a4d753ef91f874a" class="t constructor">StorageManagementClient</a>(<span class="r6 r">tokenCredentials</span>) { <a href="/Microsoft.Azure.Management.Storage/A.html#ed528fcfb453a149" class="i property">SubscriptionId</a> = <span class="r3 r">subscriptionId</span> };
 
                <b>await</b> <a href="#654e8755fa4fb77b" class="i field">_storageManagementClient</a>.<a href="/Microsoft.Azure.Management.Storage/A.html#9340a1957f17c194" class="i property">BlobContainers</a>.<a href="/Microsoft.Azure.Management.Storage/A.html#6941ba898766c6f8" class="i method">CreateAsync</a>(
                    <span class="r7 r">resourceGroupName</span>: <span class="r2 r">configuration</span>.<a href="Shared/TenantConfiguration.cs.html#70fed4c934f38874" class="i property">ResourceGroupName</a>,
                    <span class="r8 r">accountName</span>: <span class="r2 r">configuration</span>.<a href="Shared/TenantConfiguration.cs.html#774d8fba75d6b5dd" class="i property">AccountName</a>,
                    <span class="r9 r">containerName</span>: <a href="#8c71bd6446fae426" class="i field">_containerName</a>,
                    <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Storage</span>.<span class="i n">Models</span>.<a href="/Microsoft.Azure.Management.Storage/A.html#28b8441fe23630be" class="t constructor">BlobContainer</a>(
                        <span class="r10 r">publicAccess</span>: <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Storage</span>.<span class="i n">Models</span>.<a href="/Microsoft.Azure.Management.Storage/A.html#24d7804bfe35e903" class="t t">PublicAccess</a>.<a href="/Microsoft.Azure.Management.Storage/A.html#1d8c41fb2b1122c2" class="i field">Container</a>,
                        <span class="r11 r">immutableStorageWithVersioning</span>: <b>new</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Storage</span>.<span class="i n">Models</span>.<a href="/Microsoft.Azure.Management.Storage/A.html#405524413e215fbc" class="t constructor">ImmutableStorageWithVersioning</a>(<b>true</b>)));
                <b>return</b>;
            }
        }
 
        [<span class="t constructor">SetUp</span>]
        <b>public void</b> <a id="b1fb9f1852e0c2ab" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetUp</a>()
        {
            <a href="#8c71bd6446fae426" class="i field">_containerName</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#89ed8eba7a7ce6c2" class="i method">GetVariable</a>(<b>nameof</b>(<a href="#8c71bd6446fae426" class="i field">_containerName</a>), <a href="#8c71bd6446fae426" class="i field">_containerName</a>);
            <a href="#fc29a5ac1100b942" class="i field">_containerClient</a> = <a href="BlobTestBase.cs.html#22fe7ac03c3ba3b8" class="i method">GetServiceClient_OAuthAccount_SharedKey</a>().<a href="/Azure.Storage.Blobs/A.html#e3b6b5726874c210" class="i method">GetBlobContainerClient</a>(<a href="#8c71bd6446fae426" class="i field">_containerName</a>);
        }
 
        [<span class="t constructor">OneTimeTearDown</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7d1fd46137ed54cb" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GlobalTearDown</a>()
        {
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> != <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>)
            {
                <a href="Shared/TenantConfiguration.cs.html#62e7bd508929cb2a" class="k">var</a> <span id="r12 rd" class="r12 r">configuration</span> = <a href="Shared/TestConfigurations.cs.html#09c438cc2df2e17f" class="t t">TestConfigurations</a>.<a href="Shared/TestConfigurations.cs.html#99e6fd959b52df5b" class="i property">DefaultTargetOAuthTenant</a>;
                <a href="/Azure.Storage.Blobs/A.html#6bb2c165ee95c7d4" class="k">var</a> <span id="r13 rd" class="r13 r">containerClient</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#991ca5e21b6fe5b6" class="t constructor">BlobServiceClient</a>(
                    <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="Shared/StorageTestBase.cs.html#5c3b90d11be747f2" class="i property">TestConfigOAuth</a>.<a href="Shared/TenantConfiguration.cs.html#9c094343c57a64fb" class="i property">BlobServiceEndpoint</a>),
                    <b>new</b> <a href="/Azure.Storage.Common/A.html#5886b33715fef501" class="t constructor">StorageSharedKeyCredential</a>(<a href="Shared/StorageTestBase.cs.html#5c3b90d11be747f2" class="i property">TestConfigOAuth</a>.<a href="Shared/TenantConfiguration.cs.html#774d8fba75d6b5dd" class="i property">AccountName</a>,
                    <a href="Shared/StorageTestBase.cs.html#5c3b90d11be747f2" class="i property">TestConfigOAuth</a>.<a href="Shared/TenantConfiguration.cs.html#fc6c2fe34872ce46" class="i property">AccountKey</a>))
                    .<a href="/Azure.Storage.Blobs/A.html#e3b6b5726874c210" class="i method">GetBlobContainerClient</a>(<a href="#8c71bd6446fae426" class="i field">_containerName</a>);
                <b>await</b> <b>foreach</b> (<a href="/Azure.Storage.Blobs/A.html#8029f8268c3df23c" class="t t">BlobItem</a> <span id="r14 rd" class="r14 r">blobItem</span> <b>in</b> <span class="r13 r">containerClient</span>.<a href="/Azure.Storage.Blobs/A.html#d613ebb8de300b97" class="i method">GetBlobsAsync</a>(<a href="/Azure.Storage.Blobs/A.html#b71186e764357179" class="t t">BlobTraits</a>.<a href="/Azure.Storage.Blobs/A.html#e4e59448d6eeb346" class="i field">ImmutabilityPolicy</a> | <a href="/Azure.Storage.Blobs/A.html#b71186e764357179" class="t t">BlobTraits</a>.<a href="/Azure.Storage.Blobs/A.html#1d68fb621755dbc4" class="i field">LegalHold</a>))
                {
                    <a href="/Azure.Storage.Blobs/A.html#f0665d15d63242b1" class="t t">BlobClient</a> <span id="r15 rd" class="r15 r">blobClient</span> = <span class="r13 r">containerClient</span>.<a href="/Azure.Storage.Blobs/A.html#e796fb2e7b99a23b" class="i method">GetBlobClient</a>(<span class="r14 r">blobItem</span>.<a href="/Azure.Storage.Blobs/A.html#1c486ee7e34147b4" class="i property">Name</a>);
 
                    <b>if</b> (<span class="r14 r">blobItem</span>.<a href="/Azure.Storage.Blobs/A.html#6988ec92b10f0e2d" class="i property">Properties</a>.<a href="/Azure.Storage.Blobs/A.html#b7ff7358a054647d" class="i property">HasLegalHold</a>)
                    {
                        <b>await</b> <span class="r15 r">blobClient</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<b>false</b>);
                    }
 
                    <b>if</b> (<span class="r14 r">blobItem</span>.<a href="/Azure.Storage.Blobs/A.html#6988ec92b10f0e2d" class="i property">Properties</a>.<a href="/Azure.Storage.Blobs/A.html#20b7b1e03a9a9ff2" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> != <b>null</b>)
                    {
                        <b>await</b> <span class="r15 r">blobClient</span>.<a href="/Azure.Storage.Blobs/A.html#e55028827b74d337" class="i method">DeleteImmutabilityPolicyAsync</a>();
                    }
 
                    <b>await</b> <span class="r15 r">blobClient</span>.<a href="/Azure.Storage.Blobs/A.html#b08c15dee0aebf43" class="i method">DeleteIfExistsAsync</a>();
                }
 
                <b>await</b> <a href="#654e8755fa4fb77b" class="i field">_storageManagementClient</a>.<a href="/Microsoft.Azure.Management.Storage/A.html#9340a1957f17c194" class="i property">BlobContainers</a>.<a href="/Microsoft.Azure.Management.Storage/A.html#939c421f65029bdd" class="i method">DeleteAsync</a>(
                     <span class="r16 r">resourceGroupName</span>: <span class="r12 r">configuration</span>.<a href="Shared/TenantConfiguration.cs.html#70fed4c934f38874" class="i property">ResourceGroupName</a>,
                     <span class="r17 r">accountName</span>: <span class="r12 r">configuration</span>.<a href="Shared/TenantConfiguration.cs.html#774d8fba75d6b5dd" class="i property">AccountName</a>,
                     <span class="r18 r">containerName</span>: <a href="#8c71bd6446fae426" class="i field">_containerName</a>);
            }
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="89b443225eb772d5" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r19 rd" class="r19 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r20 rd" class="r20 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r21 rd" class="r21 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r20 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <span class="c">// Test SetImmutabilityPolicyAsync API and validate response.</span>
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a>&gt; <span id="r22 rd" class="r22 r">response</span> = <b>await</b> <span class="r19 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(<span class="r20 r">immutabilityPolicy</span>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r21 r">expectedImmutabilityPolicyExpiry</span>, <span class="r22 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r20 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r22 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Validate that we are correctly deserializing Get Properties response.</span>
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r23 rd" class="r23 r">propertiesResponse</span> = <b>await</b> <span class="r19 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r21 r">expectedImmutabilityPolicyExpiry</span>, <span class="r23 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r20 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r23 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Validate we are correctly deserializing Blob Items.</span>
            <span class="c">// Act</span>
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Azure.Storage.Blobs/A.html#8029f8268c3df23c" class="t t">BlobItem</a>&gt; <span id="r24 rd" class="r24 r">blobItems</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Azure.Storage.Blobs/A.html#8029f8268c3df23c" class="t t">BlobItem</a>&gt;();
            <b>await</b> <b>foreach</b> (<a href="/Azure.Storage.Blobs/A.html#8029f8268c3df23c" class="t t">BlobItem</a> <span id="r25 rd" class="r25 r">blobItem</span> <b>in</b> <a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#d613ebb8de300b97" class="i method">GetBlobsAsync</a>(<span class="r26 r">traits</span>: <a href="/Azure.Storage.Blobs/A.html#b71186e764357179" class="t t">BlobTraits</a>.<a href="/Azure.Storage.Blobs/A.html#e4e59448d6eeb346" class="i field">ImmutabilityPolicy</a>, <span class="r27 r">prefix</span>: <span class="r19 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>))
            {
                <span class="r24 r">blobItems</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r25 r">blobItem</span>);
            }
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(1, <span class="r24 r">blobItems</span>.<a href="@0@mscorlib/A.html#78a69d857716bc68" class="i property">Count</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r21 r">expectedImmutabilityPolicyExpiry</span>, <span class="r24 r">blobItems</span>[0].<a href="/Azure.Storage.Blobs/A.html#6988ec92b10f0e2d" class="i property">Properties</a>.<a href="/Azure.Storage.Blobs/A.html#20b7b1e03a9a9ff2" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r20 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r24 r">blobItems</span>[0].<a href="/Azure.Storage.Blobs/A.html#6988ec92b10f0e2d" class="i property">Properties</a>.<a href="/Azure.Storage.Blobs/A.html#20b7b1e03a9a9ff2" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Validate we are correctly deserialzing Get Blob response.</span>
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#3ce0c298c6f02684" class="t t">BlobDownloadInfo</a>&gt; <span id="r28 rd" class="r28 r">downloadResponse</span> = <b>await</b> <span class="r19 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#3d24e9ffd423b49e" class="i method">DownloadAsync</a>();
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r21 r">expectedImmutabilityPolicyExpiry</span>, <span class="r28 r">downloadResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#e967990c9b1e7bf1" class="i property">Details</a>.<a href="/Azure.Storage.Blobs/A.html#64fd019d5d5bab1b" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r20 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r28 r">downloadResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#e967990c9b1e7bf1" class="i property">Details</a>.<a href="/Azure.Storage.Blobs/A.html#64fd019d5d5bab1b" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="aa546f7608fd1ef9" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_IfModifiedSince</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r29 rd" class="r29 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r30 rd" class="r30 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r31 rd" class="r31 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r30 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a> <span id="r32 rd" class="r32 r">conditions</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#5fe01134b7f5b183" class="t constructor">BlobRequestConditions</a>
            {
                <a href="/Azure.Core/A.html#ef1f2b8d0f0fd9ea" class="i property">IfUnmodifiedSince</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(1)
            };
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a>&gt; <span id="r33 rd" class="r33 r">response</span> = <b>await</b> <span class="r29 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                <span class="r34 r">immutabilityPolicy</span>: <span class="r30 r">immutabilityPolicy</span>,
                <span class="r35 r">conditions</span>: <span class="r32 r">conditions</span>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r31 r">expectedImmutabilityPolicyExpiry</span>, <span class="r33 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r30 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r33 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        [<span class="t constructor">TestCase</span>(<b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Core/A.html#c0640f9cb69488b5" class="i property">IfMatch</a>))]
        [<span class="t constructor">TestCase</span>(<b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Core/A.html#4e2106a4ce43d036" class="i property">IfModifiedSince</a>))]
        [<span class="t constructor">TestCase</span>(<b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Core/A.html#9dcd4da0df2d88c2" class="i property">IfNoneMatch</a>))]
        [<span class="t constructor">TestCase</span>(<b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Storage.Blobs/A.html#49487ceff21a9309" class="i property">LeaseId</a>))]
        [<span class="t constructor">TestCase</span>(<b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Storage.Blobs/A.html#3a2f7c22d584c9a1" class="i property">TagConditions</a>))]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="fb5c5b40e9b73c51" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_InvalidRequestConditions</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r36 rd" class="r36 r">invalidCondition</span>)
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r37 rd" class="r37 r">blobBaseClient</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#4c748802a16285ef" class="t constructor">BlobBaseClient</a>(<b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="s">&quot;https://www.doesntmatter.com&quot;</span>), <a href="BlobTestBase.cs.html#8b419660de0d26a1" class="i method">GetOptions</a>());
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r38 rd" class="r38 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a> <span id="r39 rd" class="r39 r">conditions</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#5fe01134b7f5b183" class="t constructor">BlobRequestConditions</a>();
 
            <b>switch</b> (<span class="r36 r">invalidCondition</span>)
            {
                <b>case</b> <b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Core/A.html#c0640f9cb69488b5" class="i property">IfMatch</a>):
                    <span class="r39 r">conditions</span>.<a href="/Azure.Core/A.html#c0640f9cb69488b5" class="i property">IfMatch</a> = <b>new</b> <a href="/Azure.Core/A.html#69017d8593c3f0de" class="t constructor">ETag</a>();
                    <b>break</b>;
                <b>case</b> <b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Core/A.html#4e2106a4ce43d036" class="i property">IfModifiedSince</a>):
                    <span class="r39 r">conditions</span>.<a href="/Azure.Core/A.html#4e2106a4ce43d036" class="i property">IfModifiedSince</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5);
                    <b>break</b>;
                <b>case</b> <b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Core/A.html#9dcd4da0df2d88c2" class="i property">IfNoneMatch</a>):
                    <span class="r39 r">conditions</span>.<a href="/Azure.Core/A.html#9dcd4da0df2d88c2" class="i property">IfNoneMatch</a> = <b>new</b> <a href="/Azure.Core/A.html#69017d8593c3f0de" class="t constructor">ETag</a>();
                    <b>break</b>;
                <b>case</b> <b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Storage.Blobs/A.html#49487ceff21a9309" class="i property">LeaseId</a>):
                    <span class="r39 r">conditions</span>.<a href="/Azure.Storage.Blobs/A.html#49487ceff21a9309" class="i property">LeaseId</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
                    <b>break</b>;
                <b>case</b> <b>nameof</b>(<a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a>.<a href="/Azure.Storage.Blobs/A.html#3a2f7c22d584c9a1" class="i property">TagConditions</a>):
                    <span class="r39 r">conditions</span>.<a href="/Azure.Storage.Blobs/A.html#3a2f7c22d584c9a1" class="i property">TagConditions</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
                    <b>break</b>;
            }
 
            <span class="c">// Act</span>
            <b>await</b> <a href="Shared/TestHelper.cs.html#1425737f2a386c6e" class="t t">TestHelper</a>.<a href="Shared/TestHelper.cs.html#7820952ec9aec2d6" class="i method">AssertExpectedExceptionAsync</a>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(
                <span class="r37 r">blobBaseClient</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                    <span class="r38 r">immutabilityPolicy</span>,
                    <span class="r39 r">conditions</span>),
                <span id="r40 rd" class="r40 r">e</span> =&gt;
                {
                    <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r40 r">e</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>.<a href="@0@mscorlib/A.html#428c5c9954dea844" class="i method">Contains</a>(<span class="s">$&quot;</span><span class="s">SetImmutabilityPolicy does not support the </span>{<span class="r36 r">invalidCondition</span>}<span class="s"> condition(s).</span><span class="s">&quot;</span>));
                    <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r40 r">e</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>.<a href="@0@mscorlib/A.html#428c5c9954dea844" class="i method">Contains</a>(<span class="s">&quot;conditions&quot;</span>));
                });
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Common/A.html#ac762c6c5829d9cc" class="t t">AccountSasPermissions</a>.<a href="/Azure.Storage.Common/A.html#dec433cd96ddae14" class="i field">All</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Common/A.html#ac762c6c5829d9cc" class="t t">AccountSasPermissions</a>.<a href="/Azure.Storage.Common/A.html#56d269aec246322c" class="i field">SetImmutabilityPolicy</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="b64e99c9fb583b96" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_SetLegalHold_AccoutnSas</a>(<a href="/Azure.Storage.Common/A.html#ac762c6c5829d9cc" class="t t">AccountSasPermissions</a> <span id="r41 rd" class="r41 r">sasPermissions</span>)
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r42 rd" class="r42 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>, <a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>());
 
            <a href="/Azure.Storage.Blobs/A.html#5c3c4fe54cdb5868" class="t t">BlobServiceClient</a> <span id="r43 rd" class="r43 r">sharedKeyServiceClient</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(
                <a href="BlobTestBase.cs.html#22fe7ac03c3ba3b8" class="i method">GetServiceClient_OAuthAccount_SharedKey</a>());
            <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r44 rd" class="r44 r">serviceSasUri</span> = <span class="r43 r">sharedKeyServiceClient</span>.<a href="/Azure.Storage.Blobs/A.html#66a0cf9947cb42f0" class="i method">GenerateAccountSasUri</a>(
                <span class="r41 r">sasPermissions</span>,
                <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(1),
                <a href="/Azure.Storage.Common/A.html#1e2952f573dd64b0" class="t t">AccountSasResourceTypes</a>.<a href="/Azure.Storage.Common/A.html#fb06b0ba251e75ec" class="i field">All</a>);
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r45 rd" class="r45 r">sasBlobClient</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<b>new</b> <a href="/Azure.Storage.Blobs/A.html#ace60f0b152f47e1" class="t constructor">BlobServiceClient</a>(<span class="r44 r">serviceSasUri</span>, <a href="BlobTestBase.cs.html#8b419660de0d26a1" class="i method">GetOptions</a>())
                .<a href="/Azure.Storage.Blobs/A.html#e3b6b5726874c210" class="i method">GetBlobContainerClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#a2b6be6038e393b3" class="i property">Name</a>)
                .<a href="/Azure.Storage.Blobs/A.html#54038cd6848b9aae" class="i method">GetBlobBaseClient</a>(<span class="r42 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r46 rd" class="r46 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r47 rd" class="r47 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r46 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a>&gt; <span id="r48 rd" class="r48 r">response</span> = <b>await</b> <span class="r45 r">sasBlobClient</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                <span class="r34 r">immutabilityPolicy</span>: <span class="r46 r">immutabilityPolicy</span>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r47 r">expectedImmutabilityPolicyExpiry</span>, <span class="r48 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r46 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r48 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#790ff2573337e37a" class="t t">BlobLegalHoldResult</a>&gt; <span id="r49 rd" class="r49 r">legalHoldResponse</span> = <b>await</b> <span class="r45 r">sasBlobClient</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<span class="r50 r">hasLegalHold</span>: <b>false</b>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<span class="r49 r">legalHoldResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#235b60315e215b2d" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#4c988bea3bd2c716" class="t t">BlobContainerSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#fa22e892a3c44ecc" class="i field">All</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#4c988bea3bd2c716" class="t t">BlobContainerSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#49d2c77376f6a3df" class="i field">SetImmutabilityPolicy</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ab57674455d09727" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_SetLegalHold_ContainerSas</a>(<a href="/Azure.Storage.Blobs/A.html#4c988bea3bd2c716" class="t t">BlobContainerSasPermissions</a> <span id="r51 rd" class="r51 r">sasPermissions</span>)
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r52 rd" class="r52 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>, <a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>());
 
            <a href="/Azure.Storage.Blobs/A.html#6bb2c165ee95c7d4" class="t t">BlobContainerClient</a> <span id="r53 rd" class="r53 r">sharedKeyContainer</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(
                <a href="BlobTestBase.cs.html#22fe7ac03c3ba3b8" class="i method">GetServiceClient_OAuthAccount_SharedKey</a>().<a href="/Azure.Storage.Blobs/A.html#e3b6b5726874c210" class="i method">GetBlobContainerClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#a2b6be6038e393b3" class="i property">Name</a>));
            <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r54 rd" class="r54 r">containerSasUri</span> = <span class="r53 r">sharedKeyContainer</span>.<a href="/Azure.Storage.Blobs/A.html#55159b261a77f0d9" class="i method">GenerateSasUri</a>(<span class="r51 r">sasPermissions</span>, <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(1));
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r55 rd" class="r55 r">sasBlobClient</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<b>new</b> <a href="/Azure.Storage.Blobs/A.html#7baed891e671b42c" class="t constructor">BlobContainerClient</a>(<span class="r54 r">containerSasUri</span>, <a href="BlobTestBase.cs.html#8b419660de0d26a1" class="i method">GetOptions</a>()).<a href="/Azure.Storage.Blobs/A.html#54038cd6848b9aae" class="i method">GetBlobBaseClient</a>(<span class="r52 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r56 rd" class="r56 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r57 rd" class="r57 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r56 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a>&gt; <span id="r58 rd" class="r58 r">response</span> = <b>await</b> <span class="r55 r">sasBlobClient</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                <span class="r34 r">immutabilityPolicy</span>: <span class="r56 r">immutabilityPolicy</span>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r57 r">expectedImmutabilityPolicyExpiry</span>, <span class="r58 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r56 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r58 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#790ff2573337e37a" class="t t">BlobLegalHoldResult</a>&gt; <span id="r59 rd" class="r59 r">legalHoldResponse</span> = <b>await</b> <span class="r55 r">sasBlobClient</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<span class="r50 r">hasLegalHold</span>: <b>false</b>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<span class="r59 r">legalHoldResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#235b60315e215b2d" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#5722417b7d1ec193" class="t t">BlobSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#796b36cb23a40798" class="i field">All</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#5722417b7d1ec193" class="t t">BlobSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#ccb01052d84c5a91" class="i field">SetImmutabilityPolicy</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0e0e9a8dcaf5f877" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_SetLegalHold_BlobSas</a>(<a href="/Azure.Storage.Blobs/A.html#5722417b7d1ec193" class="t t">BlobSasPermissions</a> <span id="r60 rd" class="r60 r">sasPermissions</span>)
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r61 rd" class="r61 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>, <a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>());
 
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r62 rd" class="r62 r">sharedKeyBlob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(
                <a href="BlobTestBase.cs.html#22fe7ac03c3ba3b8" class="i method">GetServiceClient_OAuthAccount_SharedKey</a>()
                    .<a href="/Azure.Storage.Blobs/A.html#e3b6b5726874c210" class="i method">GetBlobContainerClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#a2b6be6038e393b3" class="i property">Name</a>)
                    .<a href="/Azure.Storage.Blobs/A.html#54038cd6848b9aae" class="i method">GetBlobBaseClient</a>(<span class="r61 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>));
            <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r63 rd" class="r63 r">blobSasUri</span> = <span class="r62 r">sharedKeyBlob</span>.<a href="/Azure.Storage.Blobs/A.html#4e1d96021d602e44" class="i method">GenerateSasUri</a>(<span class="r60 r">sasPermissions</span>, <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(1));
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r64 rd" class="r64 r">sasBlobClient</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<b>new</b> <a href="/Azure.Storage.Blobs/A.html#4c748802a16285ef" class="t constructor">BlobBaseClient</a>(<span class="r63 r">blobSasUri</span>, <a href="BlobTestBase.cs.html#8b419660de0d26a1" class="i method">GetOptions</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r65 rd" class="r65 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r66 rd" class="r66 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r65 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a>&gt; <span id="r67 rd" class="r67 r">response</span> = <b>await</b> <span class="r64 r">sasBlobClient</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                <span class="r34 r">immutabilityPolicy</span>: <span class="r65 r">immutabilityPolicy</span>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r66 r">expectedImmutabilityPolicyExpiry</span>, <span class="r67 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r65 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r67 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#790ff2573337e37a" class="t t">BlobLegalHoldResult</a>&gt; <span id="r68 rd" class="r68 r">legalHoldResponse</span> = <b>await</b> <span class="r64 r">sasBlobClient</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<span class="r50 r">hasLegalHold</span>: <b>false</b>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<span class="r68 r">legalHoldResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#235b60315e215b2d" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#33a9a88ecb0b0734" class="t t">SnapshotSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#a063a929632ab5bb" class="i field">All</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#33a9a88ecb0b0734" class="t t">SnapshotSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#1b2d95a217203dbd" class="i field">SetImmutabilityPolicy</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="abd5160cfc2f2486" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_SetLegalHold_BlobSnapshotSas</a>(<a href="/Azure.Storage.Blobs/A.html#33a9a88ecb0b0734" class="t t">SnapshotSasPermissions</a> <span id="r69 rd" class="r69 r">sasPermissions</span>)
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r70 rd" class="r70 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>, <a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>());
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#f34089dd356582b9" class="t t">BlobSnapshotInfo</a>&gt; <span id="r71 rd" class="r71 r">snapshotResponse</span> = <b>await</b> <span class="r70 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#884dd1969092f87b" class="i method">CreateSnapshotAsync</a>();
 
            <a href="/Azure.Storage.Blobs/A.html#494fcdf61457bd9e" class="t t">BlobSasBuilder</a> <span id="r72 rd" class="r72 r">blobSasBuilder</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#309ae3b402d7e74b" class="t constructor">BlobSasBuilder</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#ce07251198338797" class="i property">BlobContainerName</a> = <a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#a2b6be6038e393b3" class="i property">Name</a>,
                <a href="/Azure.Storage.Blobs/A.html#5faddb946ddd32e7" class="i property">BlobName</a> = <span class="r70 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>,
                <a href="/Azure.Storage.Blobs/A.html#7c95b83bce66d14b" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(1),
                <a href="/Azure.Storage.Blobs/A.html#e2be225cd2de4de2" class="i property">Snapshot</a> = <span class="r71 r">snapshotResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#6de85189f89b695f" class="i property">Snapshot</a>
            };
            <span class="r72 r">blobSasBuilder</span>.<a href="/Azure.Storage.Blobs/A.html#f30886ff529a0eb9" class="i method">SetPermissions</a>(<span class="r69 r">sasPermissions</span>);
            <a href="/Azure.Storage.Common/A.html#6b51bf09188ec1c0" class="t t">StorageSharedKeyCredential</a> <span id="r73 rd" class="r73 r">sharedKeyCredential</span> = <b>new</b> <a href="/Azure.Storage.Common/A.html#5886b33715fef501" class="t constructor">StorageSharedKeyCredential</a>(<a href="Shared/StorageTestBase.cs.html#5c3b90d11be747f2" class="i property">TestConfigOAuth</a>.<a href="Shared/TenantConfiguration.cs.html#774d8fba75d6b5dd" class="i property">AccountName</a>, <a href="Shared/StorageTestBase.cs.html#5c3b90d11be747f2" class="i property">TestConfigOAuth</a>.<a href="Shared/TenantConfiguration.cs.html#fc6c2fe34872ce46" class="i property">AccountKey</a>);
            <a href="/Azure.Storage.Blobs/A.html#9147ea6881bb009b" class="t t">BlobUriBuilder</a> <span id="r74 rd" class="r74 r">uriBuilder</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#94696beb18688001" class="t constructor">BlobUriBuilder</a>(<span class="r70 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#ae31d23a19240d50" class="i property">Uri</a>)
            {
                <a href="/Azure.Storage.Blobs/A.html#ea93c79a4f833907" class="i property">Snapshot</a> = <span class="r71 r">snapshotResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#6de85189f89b695f" class="i property">Snapshot</a>,
                <a href="/Azure.Storage.Blobs/A.html#f246aac4010f2c45" class="i property">Sas</a> = <span class="r72 r">blobSasBuilder</span>.<a href="/Azure.Storage.Blobs/A.html#92d3ef6936d31322" class="i method">ToSasQueryParameters</a>(<span class="r73 r">sharedKeyCredential</span>)
            };
 
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r75 rd" class="r75 r">sasBlobSnapshotClient</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<b>new</b> <a href="/Azure.Storage.Blobs/A.html#4c748802a16285ef" class="t constructor">BlobBaseClient</a>(<span class="r74 r">uriBuilder</span>.<a href="/Azure.Storage.Blobs/A.html#65043f17a7dc36dc" class="i method">ToUri</a>(), <a href="BlobTestBase.cs.html#8b419660de0d26a1" class="i method">GetOptions</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r76 rd" class="r76 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r77 rd" class="r77 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r76 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a>&gt; <span id="r78 rd" class="r78 r">response</span> = <b>await</b> <span class="r75 r">sasBlobSnapshotClient</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                <span class="r34 r">immutabilityPolicy</span>: <span class="r76 r">immutabilityPolicy</span>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r77 r">expectedImmutabilityPolicyExpiry</span>, <span class="r78 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r76 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r78 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#790ff2573337e37a" class="t t">BlobLegalHoldResult</a>&gt; <span id="r79 rd" class="r79 r">legalHoldResponse</span> = <b>await</b> <span class="r75 r">sasBlobSnapshotClient</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<span class="r50 r">hasLegalHold</span>: <b>false</b>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<span class="r79 r">legalHoldResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#235b60315e215b2d" class="i property">HasLegalHold</a>);
 
            <b>await</b> <span class="r75 r">sasBlobSnapshotClient</span>.<a href="/Azure.Storage.Blobs/A.html#e55028827b74d337" class="i method">DeleteImmutabilityPolicyAsync</a>();
 
            <span class="c">// Delete blob snapshot.</span>
            <b>await</b> <span class="r70 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#e456724c864c2308" class="i method">WithSnapshot</a>(<span class="r71 r">snapshotResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#6de85189f89b695f" class="i property">Snapshot</a>).<a href="/Azure.Storage.Blobs/A.html#f2250485288cca52" class="i method">DeleteAsync</a>();
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#e8c1b0a4d58345d0" class="t t">BlobVersionSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#9b413663ed3b518a" class="i field">All</a>)]
        [<span class="t constructor">TestCase</span>(<a href="/Azure.Storage.Blobs/A.html#e8c1b0a4d58345d0" class="t t">BlobVersionSasPermissions</a>.<a href="/Azure.Storage.Blobs/A.html#fab67b1eca17a1d8" class="i field">SetImmutabilityPolicy</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="dd74f7b84b6813f4" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_SetLegalHold_BlobVersionSas</a>(<a href="/Azure.Storage.Blobs/A.html#e8c1b0a4d58345d0" class="t t">BlobVersionSasPermissions</a> <span id="r80 rd" class="r80 r">sasPermissions</span>)
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r81 rd" class="r81 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>, <a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>());
 
            <a href="@0@mscorlib/A.html#20343df0c96b629b" class="t t">IDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <span id="r82 rd" class="r82 r">metadata</span> = <a href="Shared/StorageTestBase.cs.html#9bbe73e9e1c28539" class="i method">BuildMetadata</a>();
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#6cdb754d8a522d97" class="t t">BlobInfo</a>&gt; <span id="r83 rd" class="r83 r">metadataResponse</span> = <b>await</b> <span class="r81 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#58dcaf1e6f66d2b3" class="i method">SetMetadataAsync</a>(<span class="r82 r">metadata</span>);
 
            <a href="/Azure.Storage.Blobs/A.html#494fcdf61457bd9e" class="t t">BlobSasBuilder</a> <span id="r84 rd" class="r84 r">blobSasBuilder</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#309ae3b402d7e74b" class="t constructor">BlobSasBuilder</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#ce07251198338797" class="i property">BlobContainerName</a> = <a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#a2b6be6038e393b3" class="i property">Name</a>,
                <a href="/Azure.Storage.Blobs/A.html#5faddb946ddd32e7" class="i property">BlobName</a> = <span class="r81 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>,
                <a href="/Azure.Storage.Blobs/A.html#7c95b83bce66d14b" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(1),
                <a href="/Azure.Storage.Blobs/A.html#19d6c0acf75c7e5b" class="i property">Version</a> = <span class="r83 r">metadataResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#af9fa0c54a2fe595" class="i property">VersionId</a>
            };
            <span class="r84 r">blobSasBuilder</span>.<a href="/Azure.Storage.Blobs/A.html#d8e5e6650ee21ece" class="i method">SetPermissions</a>(<span class="r80 r">sasPermissions</span>);
            <a href="/Azure.Storage.Common/A.html#6b51bf09188ec1c0" class="t t">StorageSharedKeyCredential</a> <span id="r85 rd" class="r85 r">sharedKeyCredential</span> = <b>new</b> <a href="/Azure.Storage.Common/A.html#5886b33715fef501" class="t constructor">StorageSharedKeyCredential</a>(<a href="Shared/StorageTestBase.cs.html#5c3b90d11be747f2" class="i property">TestConfigOAuth</a>.<a href="Shared/TenantConfiguration.cs.html#774d8fba75d6b5dd" class="i property">AccountName</a>, <a href="Shared/StorageTestBase.cs.html#5c3b90d11be747f2" class="i property">TestConfigOAuth</a>.<a href="Shared/TenantConfiguration.cs.html#fc6c2fe34872ce46" class="i property">AccountKey</a>);
            <a href="/Azure.Storage.Blobs/A.html#9147ea6881bb009b" class="t t">BlobUriBuilder</a> <span id="r86 rd" class="r86 r">uriBuilder</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#94696beb18688001" class="t constructor">BlobUriBuilder</a>(<span class="r81 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#ae31d23a19240d50" class="i property">Uri</a>)
            {
                <a href="/Azure.Storage.Blobs/A.html#966ee7862d048377" class="i property">VersionId</a> = <span class="r83 r">metadataResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#af9fa0c54a2fe595" class="i property">VersionId</a>,
                <a href="/Azure.Storage.Blobs/A.html#f246aac4010f2c45" class="i property">Sas</a> = <span class="r84 r">blobSasBuilder</span>.<a href="/Azure.Storage.Blobs/A.html#92d3ef6936d31322" class="i method">ToSasQueryParameters</a>(<span class="r85 r">sharedKeyCredential</span>)
            };
 
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r87 rd" class="r87 r">sasBlobSnapshotClient</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<b>new</b> <a href="/Azure.Storage.Blobs/A.html#4c748802a16285ef" class="t constructor">BlobBaseClient</a>(<span class="r86 r">uriBuilder</span>.<a href="/Azure.Storage.Blobs/A.html#65043f17a7dc36dc" class="i method">ToUri</a>(), <a href="BlobTestBase.cs.html#8b419660de0d26a1" class="i method">GetOptions</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r88 rd" class="r88 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r89 rd" class="r89 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r88 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a>&gt; <span id="r90 rd" class="r90 r">response</span> = <b>await</b> <span class="r87 r">sasBlobSnapshotClient</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                <span class="r34 r">immutabilityPolicy</span>: <span class="r88 r">immutabilityPolicy</span>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r89 r">expectedImmutabilityPolicyExpiry</span>, <span class="r90 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r88 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r90 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#790ff2573337e37a" class="t t">BlobLegalHoldResult</a>&gt; <span id="r91 rd" class="r91 r">legalHoldResponse</span> = <b>await</b> <span class="r87 r">sasBlobSnapshotClient</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<span class="r50 r">hasLegalHold</span>: <b>false</b>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<span class="r91 r">legalHoldResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#235b60315e215b2d" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5beb5ae6097ded7a" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_IfModifiedSince_Failed</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r92 rd" class="r92 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r93 rd" class="r93 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#b1f3371f1ec3f990" class="i method">AddSeconds</a>(1),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#fb81ecfafb1dadd8" class="i field">Locked</a>
            };
 
            <a href="/Azure.Storage.Blobs/A.html#340adb54d55c6c34" class="t t">BlobRequestConditions</a> <span id="r94 rd" class="r94 r">conditions</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#5fe01134b7f5b183" class="t constructor">BlobRequestConditions</a>
            {
                <a href="/Azure.Core/A.html#ef1f2b8d0f0fd9ea" class="i property">IfUnmodifiedSince</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#3e8c965efd4d9021" class="i method">AddDays</a>(-1)
            };
 
            <span class="c">// Act</span>
            <b>await</b> <a href="Shared/TestHelper.cs.html#1425737f2a386c6e" class="t t">TestHelper</a>.<a href="Shared/TestHelper.cs.html#7820952ec9aec2d6" class="i method">AssertExpectedExceptionAsync</a>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(
                <span class="r92 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(
                    <span class="r34 r">immutabilityPolicy</span>: <span class="r93 r">immutabilityPolicy</span>,
                    <span class="r35 r">conditions</span>: <span class="r94 r">conditions</span>),
                <span id="r95 rd" class="r95 r">e</span> =&gt; <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Storage.Blobs/A.html#e0d947616d6aba70" class="t t">BlobErrorCode</a>.<a href="/Azure.Storage.Blobs/A.html#e12b0b7714ae7485" class="i property">ConditionNotMet</a>.<a href="/Azure.Storage.Blobs/A.html#956fff1c6f30e077" class="i method">ToString</a>(), <span class="r95 r">e</span>.<a href="/Azure.Core/A.html#0f8d8760e8ec9460" class="i property">ErrorCode</a>));
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f2a58d0297d4c75b" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_Error</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r96 rd" class="r96 r">blob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#e796fb2e7b99a23b" class="i method">GetBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r97 rd" class="r97 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#b1f3371f1ec3f990" class="i method">AddSeconds</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#fb81ecfafb1dadd8" class="i field">Locked</a>
            };
 
            <span class="c">// Act</span>
            <b>await</b> <a href="Shared/TestHelper.cs.html#1425737f2a386c6e" class="t t">TestHelper</a>.<a href="Shared/TestHelper.cs.html#7820952ec9aec2d6" class="i method">AssertExpectedExceptionAsync</a>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(
                <span class="r96 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(<span class="r97 r">immutabilityPolicy</span>),
                <span id="r98 rd" class="r98 r">e</span> =&gt; <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Storage.Blobs/A.html#e0d947616d6aba70" class="t t">BlobErrorCode</a>.<a href="/Azure.Storage.Blobs/A.html#d09680c97545ffc1" class="i property">BlobNotFound</a>.<a href="/Azure.Storage.Blobs/A.html#956fff1c6f30e077" class="i method">ToString</a>(), <span class="r98 r">e</span>.<a href="/Azure.Core/A.html#0f8d8760e8ec9460" class="i property">ErrorCode</a>));
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a5ad06dc70cd6ee6" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetImmutibilityPolicyAsync_Mutable</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r99 rd" class="r99 r">blob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#e796fb2e7b99a23b" class="i method">GetBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r100 rd" class="r100 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#b1f3371f1ec3f990" class="i method">AddSeconds</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#f091993d07c31adc" class="i field">Mutable</a>
            };
 
            <span class="c">// Act</span>
            <b>await</b> <a href="Shared/TestHelper.cs.html#1425737f2a386c6e" class="t t">TestHelper</a>.<a href="Shared/TestHelper.cs.html#7820952ec9aec2d6" class="i method">AssertExpectedExceptionAsync</a>&lt;<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a>&gt;(
                <span class="r99 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(<span class="r100 r">immutabilityPolicy</span>),
                <span id="r101 rd" class="r101 r">e</span> =&gt; <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;PolicyMode must be Locked or Unlocked&quot;</span>, <span class="r101 r">e</span>.<a href="@0@mscorlib/A.html#71cfcd61786aa2d8" class="i property">Message</a>));
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="31de8de45eb003c2" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DeleteImmutibilityPolicyAsync</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r102 rd" class="r102 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r103 rd" class="r103 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#b1f3371f1ec3f990" class="i method">AddSeconds</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <b>await</b> <span class="r102 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#74a249edc07d1e98" class="i method">SetImmutabilityPolicyAsync</a>(<span class="r103 r">immutabilityPolicy</span>);
 
            <span class="c">// Act</span>
            <b>await</b> <span class="r102 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#e55028827b74d337" class="i method">DeleteImmutabilityPolicyAsync</a>();
 
            <span class="c">// Assert</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r104 rd" class="r104 r">propertiesResponse</span> = <b>await</b> <span class="r102 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">IsNull</span>(<span class="r104 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">IsNull</span>(<span class="r104 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0c67fed38e8d5acb" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DeleteImmutibilityPolicyAsync_Error</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r105 rd" class="r105 r">blob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#e796fb2e7b99a23b" class="i method">GetBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <span class="c">// Act</span>
            <b>await</b> <a href="Shared/TestHelper.cs.html#1425737f2a386c6e" class="t t">TestHelper</a>.<a href="Shared/TestHelper.cs.html#7820952ec9aec2d6" class="i method">AssertExpectedExceptionAsync</a>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(
                <span class="r105 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#e55028827b74d337" class="i method">DeleteImmutabilityPolicyAsync</a>(),
                <span id="r106 rd" class="r106 r">e</span> =&gt; <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Storage.Blobs/A.html#e0d947616d6aba70" class="t t">BlobErrorCode</a>.<a href="/Azure.Storage.Blobs/A.html#d09680c97545ffc1" class="i property">BlobNotFound</a>.<a href="/Azure.Storage.Blobs/A.html#956fff1c6f30e077" class="i method">ToString</a>(), <span class="r106 r">e</span>.<a href="/Azure.Core/A.html#0f8d8760e8ec9460" class="i property">ErrorCode</a>));
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="e160020b545ea338" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetLegalHoldAsync</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r107 rd" class="r107 r">blob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>);
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#790ff2573337e37a" class="t t">BlobLegalHoldResult</a>&gt; <span id="r108 rd" class="r108 r">response</span> = <b>await</b> <span class="r107 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<b>true</b>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r108 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#235b60315e215b2d" class="i property">HasLegalHold</a>);
 
            <span class="c">// Validate that we are correctly deserializing Get Properties response.</span>
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r109 rd" class="r109 r">propertiesResponse</span> = <b>await</b> <span class="r107 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r109 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d0560185bd430764" class="i property">HasLegalHold</a>);
 
            <span class="c">// Validate we are correctly deserializing Blob Items.</span>
            <span class="c">// Act</span>
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Azure.Storage.Blobs/A.html#8029f8268c3df23c" class="t t">BlobItem</a>&gt; <span id="r110 rd" class="r110 r">blobItems</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Azure.Storage.Blobs/A.html#8029f8268c3df23c" class="t t">BlobItem</a>&gt;();
            <b>await</b> <b>foreach</b> (<a href="/Azure.Storage.Blobs/A.html#8029f8268c3df23c" class="t t">BlobItem</a> <span id="r111 rd" class="r111 r">blobItem</span> <b>in</b> <a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#d613ebb8de300b97" class="i method">GetBlobsAsync</a>(<span class="r26 r">traits</span>: <a href="/Azure.Storage.Blobs/A.html#b71186e764357179" class="t t">BlobTraits</a>.<a href="/Azure.Storage.Blobs/A.html#1d68fb621755dbc4" class="i field">LegalHold</a>, <span class="r27 r">prefix</span>: <span class="r107 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>))
            {
                <span class="r110 r">blobItems</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r111 r">blobItem</span>);
            }
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(1, <span class="r110 r">blobItems</span>.<a href="@0@mscorlib/A.html#78a69d857716bc68" class="i property">Count</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r110 r">blobItems</span>[0].<a href="/Azure.Storage.Blobs/A.html#6988ec92b10f0e2d" class="i property">Properties</a>.<a href="/Azure.Storage.Blobs/A.html#b7ff7358a054647d" class="i property">HasLegalHold</a>);
 
            <span class="c">// Validate we are correctly deserialzing Get Blob response.</span>
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#3ce0c298c6f02684" class="t t">BlobDownloadInfo</a>&gt; <span id="r112 rd" class="r112 r">downloadResponse</span> = <b>await</b> <span class="r107 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#3d24e9ffd423b49e" class="i method">DownloadAsync</a>();
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r112 r">downloadResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#e967990c9b1e7bf1" class="i property">Details</a>.<a href="/Azure.Storage.Blobs/A.html#d2387cafea5174ed" class="i property">HasLegalHold</a>);
 
            <span class="c">// Act</span>
            <span class="r108 r">response</span> = <b>await</b> <span class="r107 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<b>false</b>);
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<span class="r108 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#235b60315e215b2d" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f6caf39cb00b1a92" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SetLegalHoldAsync_Error</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r113 rd" class="r113 r">blob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#e796fb2e7b99a23b" class="i method">GetBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <span class="c">// Act</span>
            <b>await</b> <a href="Shared/TestHelper.cs.html#1425737f2a386c6e" class="t t">TestHelper</a>.<a href="Shared/TestHelper.cs.html#7820952ec9aec2d6" class="i method">AssertExpectedExceptionAsync</a>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(
                <span class="r113 r">blob</span>.<a href="/Azure.Storage.Blobs/A.html#5fdef2b5c9398fae" class="i method">SetLegalHoldAsync</a>(<b>true</b>),
                <span id="r114 rd" class="r114 r">e</span> =&gt; <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Storage.Blobs/A.html#e0d947616d6aba70" class="t t">BlobErrorCode</a>.<a href="/Azure.Storage.Blobs/A.html#d09680c97545ffc1" class="i property">BlobNotFound</a>.<a href="/Azure.Storage.Blobs/A.html#956fff1c6f30e077" class="i method">ToString</a>(), <span class="r114 r">e</span>.<a href="/Azure.Core/A.html#0f8d8760e8ec9460" class="i property">ErrorCode</a>));
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="542f3fc23373d1b5" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ContainerImmutableStorageWithVersioning</a>()
        {
            <span class="c">// Validate we are deserializing Get Container Properties responses correctly.</span>
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#4036fd57d8babf0c" class="t t">BlobContainerProperties</a>&gt; <span id="r115 rd" class="r115 r">propertiesResponse</span> = <b>await</b> <a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#78a1f68312f5203b" class="i method">GetPropertiesAsync</a>();
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r115 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d2f37cb6b6376240" class="i property">HasImmutableStorageWithVersioning</a>);
 
            <span class="c">// Validate we are deserializing BlobContainerItems correctly.</span>
            <span class="c">// Act</span>
            <a href="/Azure.Storage.Blobs/A.html#5c3c4fe54cdb5868" class="t t">BlobServiceClient</a> <span id="r116 rd" class="r116 r">blobServiceClient</span> = <a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#8422e93cc24fcdb5" class="i method">GetParentBlobServiceClient</a>();
            <a href="@0@mscorlib/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="/Azure.Storage.Blobs/A.html#51495ef18796e708" class="t t">BlobContainerItem</a>&gt; <span id="r117 rd" class="r117 r">containers</span> = <b>await</b> <span class="r116 r">blobServiceClient</span>.<a href="/Azure.Storage.Blobs/A.html#410908aac5c5c65b" class="i method">GetBlobContainersAsync</a>().<a href="Shared/TestExtensions.cs.html#09db9c2c6230c153" class="i method">ToListAsync</a>();
            <a href="/Azure.Storage.Blobs/A.html#51495ef18796e708" class="t t">BlobContainerItem</a> <span id="r118 rd" class="r118 r">containerItem</span> = <span class="r117 r">containers</span>.<a href="@0@System.Core/A.html#e73922753675387a" class="i method">Where</a>(<span id="r119 rd" class="r119 r">c</span> =&gt; <span class="r119 r">c</span>.<a href="/Azure.Storage.Blobs/A.html#93185e6245e64b03" class="i property">Name</a> == <a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#a2b6be6038e393b3" class="i property">Name</a>).<a href="@0@System.Core/A.html#8087366974af11d2" class="i method">FirstOrDefault</a>();
 
            <span class="c">// Assert</span>
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r118 r">containerItem</span>.<a href="/Azure.Storage.Blobs/A.html#a7bae2c7b16008cf" class="i property">Properties</a>.<a href="/Azure.Storage.Blobs/A.html#d2f37cb6b6376240" class="i property">HasImmutableStorageWithVersioning</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="57ef8689801d9fc8" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateAppendBlob_ImmutableStorageWithVersioning</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#ab2a0e921078c272" class="t t">AppendBlobClient</a> <span id="r120 rd" class="r120 r">appendBlob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#9b1458a6a968c4e1" class="i method">GetAppendBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r121 rd" class="r121 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r122 rd" class="r122 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r121 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#50534801949d7291" class="t t">AppendBlobCreateOptions</a> <span id="r123 rd" class="r123 r">options</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#563f867a17402c9a" class="t constructor">AppendBlobCreateOptions</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#28bb01389762e5c7" class="i property">ImmutabilityPolicy</a> = <span class="r121 r">immutabilityPolicy</span>,
                <a href="/Azure.Storage.Blobs/A.html#b76fa2f52b60089e" class="i property">HasLegalHold</a> = <b>true</b>
            };
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#66a553618c3f7c72" class="t t">BlobContentInfo</a>&gt; <span id="r124 rd" class="r124 r">createResponse</span> = <b>await</b> <span class="r120 r">appendBlob</span>.<a href="/Azure.Storage.Blobs/A.html#67b4747f6a28f9cb" class="i method">CreateAsync</a>(<span class="r123 r">options</span>);
 
            <span class="c">// Assert</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r125 rd" class="r125 r">propertiesResponse</span> = <b>await</b> <span class="r120 r">appendBlob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r122 r">expectedImmutabilityPolicyExpiry</span>, <span class="r125 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r121 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r125 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r125 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d0560185bd430764" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="3d1329f29a2ec327" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreatePageBlob_ImmutableStorageWithVersioning</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#22dff01887f5d331" class="t t">PageBlobClient</a> <span id="r126 rd" class="r126 r">pageBlob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#a4e5e603ddfe7b6c" class="i method">GetPageBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r127 rd" class="r127 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r128 rd" class="r128 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r127 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#9ccb23651eed8de3" class="t t">PageBlobCreateOptions</a> <span id="r129 rd" class="r129 r">options</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#7f7b83623ecb0158" class="t constructor">PageBlobCreateOptions</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#45aef23cdea2eda9" class="i property">ImmutabilityPolicy</a> = <span class="r127 r">immutabilityPolicy</span>,
                <a href="/Azure.Storage.Blobs/A.html#fc7aababd131b8cd" class="i property">LegalHold</a> = <b>true</b>
            };
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#66a553618c3f7c72" class="t t">BlobContentInfo</a>&gt; <span id="r130 rd" class="r130 r">createResponse</span> = <b>await</b> <span class="r126 r">pageBlob</span>.<a href="/Azure.Storage.Blobs/A.html#172a137b9481e758" class="i method">CreateAsync</a>(<span class="r131 r">size</span>: <a href="/Azure.Storage.Blobs/A.html#732c01506b3b1b85" class="t t">Constants</a>.<a href="/Azure.Storage.Blobs/A.html#4240fd6a2382c38e" class="i field">KB</a>, <span class="r129 r">options</span>);
 
            <span class="c">// Assert</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r132 rd" class="r132 r">propertiesResponse</span> = <b>await</b> <span class="r126 r">pageBlob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r128 r">expectedImmutabilityPolicyExpiry</span>, <span class="r132 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r127 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r132 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r132 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d0560185bd430764" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c443930f2d715437" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CommitBlockList_ImmutableStorageWithVersioning</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#a021487ec216e15d" class="t t">BlockBlobClient</a> <span id="r133 rd" class="r133 r">blockBlob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#9212d86e1f5d0a57" class="i method">GetBlockBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <b>byte</b>[] <span id="r134 rd" class="r134 r">data</span> = <a href="Shared/StorageTestBase.cs.html#0e277537c03074a3" class="i method">GetRandomBuffer</a>(<a href="/Azure.Storage.Blobs/A.html#732c01506b3b1b85" class="t t">Constants</a>.<a href="/Azure.Storage.Blobs/A.html#4240fd6a2382c38e" class="i field">KB</a>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r135 rd" class="r135 r">blockName</span> = <a href="BlobTestBase.cs.html#de6234ab0dd067f9" class="i method">GetNewBlockName</a>();
            <b>using</b> <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r136 rd" class="r136 r">stream</span> = <b>new</b> <a href="@0@mscorlib/A.html#f92fa270fda9a82b" class="t constructor">MemoryStream</a>(<span class="r134 r">data</span>);
            <b>await</b> <span class="r133 r">blockBlob</span>.<a href="/Azure.Storage.Blobs/A.html#77d30b9d503b0991" class="i method">StageBlockAsync</a>(<a href="BlobTestBase.cs.html#94fb7c8c1fabd83d" class="i method">ToBase64</a>(<span class="r135 r">blockName</span>), <span class="r136 r">stream</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r137 rd" class="r137 r">blockList</span> = <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[]
            {
                <a href="BlobTestBase.cs.html#94fb7c8c1fabd83d" class="i method">ToBase64</a>(<span class="r135 r">blockName</span>)
            };
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r138 rd" class="r138 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r139 rd" class="r139 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r138 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#ddf42b633a937e48" class="t t">CommitBlockListOptions</a> <span id="r140 rd" class="r140 r">options</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#d132dfcc53e4aa82" class="t constructor">CommitBlockListOptions</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#51647840e887323e" class="i property">ImmutabilityPolicy</a> = <span class="r138 r">immutabilityPolicy</span>,
                <a href="/Azure.Storage.Blobs/A.html#2d60d73decd00d46" class="i property">LegalHold</a> = <b>true</b>
            };
 
            <span class="c">// Act</span>
            <b>await</b> <span class="r133 r">blockBlob</span>.<a href="/Azure.Storage.Blobs/A.html#d39bbd049f65211a" class="i method">CommitBlockListAsync</a>(<span class="r137 r">blockList</span>, <span class="r140 r">options</span>);
 
            <span class="c">// Assert</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r141 rd" class="r141 r">propertiesResponse</span> = <b>await</b> <span class="r133 r">blockBlob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r139 r">expectedImmutabilityPolicyExpiry</span>, <span class="r141 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r138 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r141 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r141 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d0560185bd430764" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        [<span class="t constructor">TestCase</span>(<b>false</b>)]
        [<span class="t constructor">TestCase</span>(<b>true</b>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="901e7fcb94676f54" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Upload_ImmutableStorageWithVersioning</a>(<b>bool</b> <span id="r142 rd" class="r142 r">multipart</span>)
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#a021487ec216e15d" class="t t">BlockBlobClient</a> <span id="r143 rd" class="r143 r">blockBlob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#9212d86e1f5d0a57" class="i method">GetBlockBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <b>byte</b>[] <span id="r144 rd" class="r144 r">data</span> = <a href="Shared/StorageTestBase.cs.html#0e277537c03074a3" class="i method">GetRandomBuffer</a>(<a href="/Azure.Storage.Blobs/A.html#732c01506b3b1b85" class="t t">Constants</a>.<a href="/Azure.Storage.Blobs/A.html#4240fd6a2382c38e" class="i field">KB</a>);
            <b>using</b> <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r145 rd" class="r145 r">stream</span> = <b>new</b> <a href="@0@mscorlib/A.html#f92fa270fda9a82b" class="t constructor">MemoryStream</a>(<span class="r144 r">data</span>);
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r146 rd" class="r146 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r147 rd" class="r147 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r146 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#307f2aee9a33526f" class="t t">BlobUploadOptions</a> <span id="r148 rd" class="r148 r">options</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#c73b0861db1fe816" class="t constructor">BlobUploadOptions</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#b716dd9f3f1fa5d1" class="i property">ImmutabilityPolicy</a> = <span class="r146 r">immutabilityPolicy</span>,
                <a href="/Azure.Storage.Blobs/A.html#80130c887949eff5" class="i property">LegalHold</a> = <b>true</b>
            };
 
            <b>if</b> (<span class="r142 r">multipart</span>)
            {
                <a href="/Azure.Storage.Common/A.html#5906346a5aaad27d" class="t t">StorageTransferOptions</a> <span id="r149 rd" class="r149 r">transferOptions</span> = <b>new</b> <a href="/Azure.Storage.Common/A.html#5906346a5aaad27d" class="t constructor">StorageTransferOptions</a>
                {
                    <a href="/Azure.Storage.Common/A.html#ef29544986a37504" class="i property">InitialTransferSize</a> = <a href="/Azure.Storage.Blobs/A.html#732c01506b3b1b85" class="t t">Constants</a>.<a href="/Azure.Storage.Blobs/A.html#4240fd6a2382c38e" class="i field">KB</a> / 2,
                    <a href="/Azure.Storage.Common/A.html#e6cf33ac88512449" class="i property">MaximumTransferSize</a> = <a href="/Azure.Storage.Blobs/A.html#732c01506b3b1b85" class="t t">Constants</a>.<a href="/Azure.Storage.Blobs/A.html#4240fd6a2382c38e" class="i field">KB</a> / 2
                };
                <span class="r148 r">options</span>.<a href="/Azure.Storage.Blobs/A.html#12df3af1812980a4" class="i property">TransferOptions</a> = <span class="r149 r">transferOptions</span>;
            }
 
            <span class="c">// Act</span>
            <b>await</b> <span class="r143 r">blockBlob</span>.<a href="/Azure.Storage.Blobs/A.html#cccb66d517863ea0" class="i method">UploadAsync</a>(<span class="r145 r">stream</span>, <span class="r148 r">options</span>);
 
            <span class="c">// Assert</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r150 rd" class="r150 r">propertiesResponse</span> = <b>await</b> <span class="r143 r">blockBlob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r147 r">expectedImmutabilityPolicyExpiry</span>, <span class="r150 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r146 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r150 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r150 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d0560185bd430764" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="43c3d0b5897b8de1" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">SyncCopyFromUri_ImmutableStorageWithVersioning</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r151 rd" class="r151 r">srcBlob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>);
            <a href="/Azure.Storage.Blobs/A.html#a021487ec216e15d" class="t t">BlockBlobClient</a> <span id="r152 rd" class="r152 r">destBlob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#9212d86e1f5d0a57" class="i method">GetBlockBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r153 rd" class="r153 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r154 rd" class="r154 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r153 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#214bad0a180caa4a" class="t t">BlobCopyFromUriOptions</a> <span id="r155 rd" class="r155 r">options</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#755a79f1554e1e6a" class="t constructor">BlobCopyFromUriOptions</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#bdb68134ba043607" class="i property">DestinationImmutabilityPolicy</a> = <span class="r153 r">immutabilityPolicy</span>,
                <a href="/Azure.Storage.Blobs/A.html#fb1939806d9fa5a5" class="i property">LegalHold</a> = <b>true</b>
            };
 
            <span class="c">// Act</span>
            <b>await</b> <span class="r152 r">destBlob</span>.<a href="/Azure.Storage.Blobs/A.html#2e4ceb5e9062820e" class="i method">SyncCopyFromUriAsync</a>(<span class="r151 r">srcBlob</span>.<a href="/Azure.Storage.Blobs/A.html#ae31d23a19240d50" class="i property">Uri</a>, <span class="r155 r">options</span>);
 
            <span class="c">// Assert</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r156 rd" class="r156 r">propertiesResponse</span> = <b>await</b> <span class="r152 r">destBlob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r154 r">expectedImmutabilityPolicyExpiry</span>, <span class="r156 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r153 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r156 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r156 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d0560185bd430764" class="i property">HasLegalHold</a>);
        }
 
        [<span class="t constructor">Test</span>]
        [<a href="/Azure.Core.TestFramework/A.html#345a6ea4886b1205" class="t constructor">ServiceVersion</a>(<a href="/Azure.Core.TestFramework/A.html#74fe2facc5c52b45" class="i property">Min</a> = <a href="/Azure.Storage.Blobs/A.html#2a694af9228b837c" class="t t">BlobClientOptions</a>.<a href="/Azure.Storage.Blobs/A.html#2ee6d57a3e93d0a9" class="t t">ServiceVersion</a>.<a href="/Azure.Storage.Blobs/A.html#96a5aa77349da501" class="i field">V2020_06_12</a>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="6dd1c36274ffc603" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">StartCopyFromUri_ImmutableStorageWithVersioning</a>()
        {
            <span class="c">// Arrange</span>
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r157 rd" class="r157 r">srcBlob</span> = <b>await</b> <a href="BlobTestBase.cs.html#9e4c584bacdcd462" class="i method">GetNewBlobClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>);
            <a href="/Azure.Storage.Blobs/A.html#a021487ec216e15d" class="t t">BlockBlobClient</a> <span id="r158 rd" class="r158 r">destBlob</span> = <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<a href="#fc29a5ac1100b942" class="i field">_containerClient</a>.<a href="/Azure.Storage.Blobs/A.html#9212d86e1f5d0a57" class="i method">GetBlockBlobClient</a>(<a href="BlobTestBase.cs.html#3f238fe7b62cbaf1" class="i method">GetNewBlobName</a>()));
 
            <a href="/Azure.Storage.Blobs/A.html#fce84f4472331bbe" class="t t">BlobImmutabilityPolicy</a> <span id="r159 rd" class="r159 r">immutabilityPolicy</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#331d6f41ac2bced1" class="t constructor">BlobImmutabilityPolicy</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a> = <a href="/Azure.Core.TestFramework/A.html#9fc34d8f596ca70c" class="i property">Recording</a>.<a href="/Azure.Core.TestFramework/A.html#121ddf7990f13459" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(5),
                <a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a> = <a href="/Azure.Storage.Blobs/A.html#c9659df66887e6cf" class="t t">BlobImmutabilityPolicyMode</a>.<a href="/Azure.Storage.Blobs/A.html#e0b40513e36cd4a6" class="i field">Unlocked</a>
            };
 
            <span class="c">// The service rounds Immutability Policy Expiry to the nearest second.</span>
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r160 rd" class="r160 r">expectedImmutabilityPolicyExpiry</span> = <a href="#de8a68f637455f84" class="i method">RoundToNearestSecond</a>(<span class="r159 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>);
 
            <a href="/Azure.Storage.Blobs/A.html#214bad0a180caa4a" class="t t">BlobCopyFromUriOptions</a> <span id="r161 rd" class="r161 r">options</span> = <b>new</b> <a href="/Azure.Storage.Blobs/A.html#755a79f1554e1e6a" class="t constructor">BlobCopyFromUriOptions</a>
            {
                <a href="/Azure.Storage.Blobs/A.html#bdb68134ba043607" class="i property">DestinationImmutabilityPolicy</a> = <span class="r159 r">immutabilityPolicy</span>,
                <a href="/Azure.Storage.Blobs/A.html#fb1939806d9fa5a5" class="i property">LegalHold</a> = <b>true</b>
            };
 
            <span class="c">// Act</span>
            <a href="/Azure.Core/A.html#9f993becb7caf4ab" class="t t">Operation</a>&lt;<b>long</b>&gt; <span id="r162 rd" class="r162 r">operation</span> = <b>await</b> <span class="r158 r">destBlob</span>.<a href="/Azure.Storage.Blobs/A.html#d32f314829a57be8" class="i method">StartCopyFromUriAsync</a>(<span class="r157 r">srcBlob</span>.<a href="/Azure.Storage.Blobs/A.html#ae31d23a19240d50" class="i property">Uri</a>, <span class="r161 r">options</span>);
            <b>await</b> <span class="r162 r">operation</span>.<a href="/Azure.Core/A.html#a5c876e29e7551d3" class="i method">WaitForCompletionAsync</a>();
 
            <span class="c">// Assert</span>
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a>&gt; <span id="r163 rd" class="r163 r">propertiesResponse</span> = <b>await</b> <span class="r158 r">destBlob</span>.<a href="/Azure.Storage.Blobs/A.html#f0505a8f6a46fa3e" class="i method">GetPropertiesAsync</a>();
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r160 r">expectedImmutabilityPolicyExpiry</span>, <span class="r163 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#8d685caf791d49ea" class="i property">ExpiresOn</a>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r159 r">immutabilityPolicy</span>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>, <span class="r163 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#3ab8b3384a90a354" class="i property">ImmutabilityPolicy</a>.<a href="/Azure.Storage.Blobs/A.html#823d88d0f5529b99" class="i property">PolicyMode</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r163 r">propertiesResponse</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Storage.Blobs/A.html#d0560185bd430764" class="i property">HasLegalHold</a>);
        }
 
        <b>private</b> <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <a id="de8a68f637455f84" href="R/de8a68f637455f84.html" target="n" data-glyph="76,1" class="i method">RoundToNearestSecond</a>(<a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r164 rd" class="r164 r">initalDateTimeOffset</span>)
            =&gt; <b>new</b> <a href="@0@mscorlib/A.html#c5a5d2a27921e551" class="t constructor">DateTimeOffset</a>(
                <span class="r165 r">year</span>: <span class="r164 r">initalDateTimeOffset</span>.<a href="@0@mscorlib/A.html#42a91df814fec770" class="i property">Year</a>,
                <span class="r166 r">month</span>: <span class="r164 r">initalDateTimeOffset</span>.<a href="@0@mscorlib/A.html#f1e624c10bf957f0" class="i property">Month</a>,
                <span class="r167 r">day</span>: <span class="r164 r">initalDateTimeOffset</span>.<a href="@0@mscorlib/A.html#528bee8c49eca379" class="i property">Day</a>,
                <span class="r168 r">hour</span>: <span class="r164 r">initalDateTimeOffset</span>.<a href="@0@mscorlib/A.html#97c22877ef74e167" class="i property">Hour</a>,
                <span class="r169 r">minute</span>: <span class="r164 r">initalDateTimeOffset</span>.<a href="@0@mscorlib/A.html#156d0af979a9b719" class="i property">Minute</a>,
                <span class="r170 r">second</span>: <span class="r164 r">initalDateTimeOffset</span>.<a href="@0@mscorlib/A.html#70ac04e26b6794f0" class="i property">Second</a>,
                <span class="r171 r">offset</span>: <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#225346b4cd3a8300" class="i field">Zero</a>);
    }
}
</pre></td></tr></table></div></body></html>
