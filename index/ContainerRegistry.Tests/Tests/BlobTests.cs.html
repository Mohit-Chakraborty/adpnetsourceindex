<!DOCTYPE html>
<html><head><title>BlobTests.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(221);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#ContainerRegistry.Tests/Tests/BlobTests.cs" target="_top">Tests\BlobTests.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#ContainerRegistry.Tests" target="_top">Microsoft.Azure.ContainerRegistry.Tests.csproj</a> (ContainerRegistry.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>namespace</b> <span class="i n">ContainerRegistry</span>.<span class="i n">Tests</span>
{
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">ContainerRegistry</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">ContainerRegistry</span>.<span class="i n">Models</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">ClientRuntime</span>.<span class="i n">Azure</span>.<span class="i n">TestFramework</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
    <b>using</b> <span class="i n">Xunit</span>;
    <b>using static</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">ContainerRegistry</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#c1e81c0bbaef7c8d" class="t t">ContainerRegistryCredentials</a>;
 
    <b>public class</b> <a id="bc535a7bc71b281a" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="d0535abe2f16bdcb">BlobTests</span></a>
    {
        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="ff27d5c197c98be2" href="../R/ff27d5c197c98be2.html" target="n" data-glyph="46,1" class="i field">ProdConfigBlob</a> = <span class="s">&quot;{\&quot;architecture\&quot;:\&quot;amd64\&quot;,\&quot;config\&quot;:{\&quot;Hostname\&quot;:\&quot;\&quot;,\&quot;Domainname\&quot;:\&quot;\&quot;,\&quot;User\&quot;:\&quot;\&quot;,\&quot;AttachStdin\&quot;:false,\&quot;AttachStdout\&quot;:false,\&quot;AttachStderr\&quot;:false,\&quot;Tty\&quot;:false,\&quot;OpenStdin\&quot;:false,\&quot;StdinOnce\&quot;:false,\&quot;Env\&quot;:[\&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\&quot;,\&quot;_BASH_GPG_KEY=7C0135FB088AAF6C66C650B9BB5869F064EA74AB\&quot;,\&quot;_BASH_VERSION=5.0\&quot;,\&quot;_BASH_PATCH_LEVEL=0\&quot;,\&quot;_BASH_LATEST_PATCH=7\&quot;],\&quot;Cmd\&quot;:[\&quot;bash\&quot;],\&quot;ArgsEscaped\&quot;:true,\&quot;Image\&quot;:\&quot;sha256:38ad2fbc9f9c0a87dfe0a2b19bdca94be45f4663f73fd09fefee492afd2c0144\&quot;,\&quot;Volumes\&quot;:null,\&quot;WorkingDir\&quot;:\&quot;\&quot;,\&quot;Entrypoint\&quot;:[\&quot;docker-entrypoint.sh\&quot;],\&quot;OnBuild\&quot;:null,\&quot;Labels\&quot;:null},\&quot;container\&quot;:\&quot;4b0546fa49df5dcaed5b663717f442cef71a1b95c0ffb42c8c5ce7231b90c026\&quot;,\&quot;container_config\&quot;:{\&quot;Hostname\&quot;:\&quot;4b0546fa49df\&quot;,\&quot;Domainname\&quot;:\&quot;\&quot;,\&quot;User\&quot;:\&quot;\&quot;,\&quot;AttachStdin\&quot;:false,\&quot;AttachStdout\&quot;:false,\&quot;AttachStderr\&quot;:false,\&quot;Tty\&quot;:false,\&quot;OpenStdin\&quot;:false,\&quot;StdinOnce\&quot;:false,\&quot;Env\&quot;:[\&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\&quot;,\&quot;_BASH_GPG_KEY=7C0135FB088AAF6C66C650B9BB5869F064EA74AB\&quot;,\&quot;_BASH_VERSION=5.0\&quot;,\&quot;_BASH_PATCH_LEVEL=0\&quot;,\&quot;_BASH_LATEST_PATCH=7\&quot;],\&quot;Cmd\&quot;:[\&quot;/bin/sh\&quot;,\&quot;-c\&quot;,\&quot;#(nop) \&quot;,\&quot;CMD [\\\&quot;bash\\\&quot;]\&quot;],\&quot;ArgsEscaped\&quot;:true,\&quot;Image\&quot;:\&quot;sha256:38ad2fbc9f9c0a87dfe0a2b19bdca94be45f4663f73fd09fefee492afd2c0144\&quot;,\&quot;Volumes\&quot;:null,\&quot;WorkingDir\&quot;:\&quot;\&quot;,\&quot;Entrypoint\&quot;:[\&quot;docker-entrypoint.sh\&quot;],\&quot;OnBuild\&quot;:null,\&quot;Labels\&quot;:{}},\&quot;created\&quot;:\&quot;2019-07-13T01:16:06.527515902Z\&quot;,\&quot;docker_version\&quot;:\&quot;18.06.1-ce\&quot;,\&quot;history\&quot;:[{\&quot;created\&quot;:\&quot;2019-07-11T22:20:52.139709355Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop) ADD file:0eb5ea35741d23fe39cbac245b3a5d84856ed6384f4ff07d496369ee6d960bad in / \&quot;},{\&quot;created\&quot;:\&quot;2019-07-11T22:20:52.375286404Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop)  CMD [\\\&quot;/bin/sh\\\&quot;]\&quot;,\&quot;empty_layer\&quot;:true},{\&quot;created\&quot;:\&quot;2019-07-13T01:15:13.567669812Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop)  ENV _BASH_GPG_KEY=7C0135FB088AAF6C66C650B9BB5869F064EA74AB\&quot;,\&quot;empty_layer\&quot;:true},{\&quot;created\&quot;:\&quot;2019-07-13T01:15:13.745652098Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop)  ENV _BASH_VERSION=5.0\&quot;,\&quot;empty_layer\&quot;:true},{\&quot;created\&quot;:\&quot;2019-07-13T01:15:13.940455419Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop)  ENV _BASH_PATCH_LEVEL=0\&quot;,\&quot;empty_layer\&quot;:true},{\&quot;created\&quot;:\&quot;2019-07-13T01:15:14.099300075Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop)  ENV _BASH_LATEST_PATCH=7\&quot;,\&quot;empty_layer\&quot;:true},{\&quot;created\&quot;:\&quot;2019-07-13T01:16:05.928429262Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c set -eux; \\t\\tapk add --no-cache --virtual .build-deps \\t\\tbison \\t\\tcoreutils \\t\\tdpkg-dev dpkg \\t\\tgcc \\t\\tgnupg \\t\\tlibc-dev \\t\\tmake \\t\\tncurses-dev \\t\\tpatch \\t\\ttar \\t; \\t\\tversion=\\\&quot;$_BASH_VERSION\\\&quot;; \\tif [ \\\&quot;$_BASH_PATCH_LEVEL\\\&quot; -gt 0 ]; then \\t\\tversion=\\\&quot;$version.$_BASH_PATCH_LEVEL\\\&quot;; \\tfi; \\twget -O bash.tar.gz \\\&quot;https://ftp.gnu.org/gnu/bash/bash-$version.tar.gz\\\&quot;; \\twget -O bash.tar.gz.sig \\\&quot;https://ftp.gnu.org/gnu/bash/bash-$version.tar.gz.sig\\\&quot;; \\t\\tif [ \\\&quot;$_BASH_LATEST_PATCH\\\&quot; -gt \\\&quot;$_BASH_PATCH_LEVEL\\\&quot; ]; then \\t\\tmkdir -p bash-patches; \\t\\tfirst=\\\&quot;$(printf &#39;%03d&#39; \\\&quot;$(( _BASH_PATCH_LEVEL + 1 ))\\\&quot;)\\\&quot;; \\t\\tlast=\\\&quot;$(printf &#39;%03d&#39; \\\&quot;$_BASH_LATEST_PATCH\\\&quot;)\\\&quot;; \\t\\tfor patch in $(seq -w \\\&quot;$first\\\&quot; \\\&quot;$last\\\&quot;); do \\t\\t\\turl=\\\&quot;https://ftp.gnu.org/gnu/bash/bash-$_BASH_VERSION-patches/bash${_BASH_VERSION//./}-$patch\\\&quot;; \\t\\t\\twget -O \\\&quot;bash-patches/$patch\\\&quot; \\\&quot;$url\\\&quot;; \\t\\t\\twget -O \\\&quot;bash-patches/$patch.sig\\\&quot; \\\&quot;$url.sig\\\&quot;; \\t\\tdone; \\tfi; \\t\\texport GNUPGHOME=\\\&quot;$(mktemp -d)\\\&quot;; \\tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \\\&quot;$_BASH_GPG_KEY\\\&quot;; \\tgpg --batch --verify bash.tar.gz.sig bash.tar.gz; \\tgpgconf --kill all; \\trm bash.tar.gz.sig; \\tif [ -d bash-patches ]; then \\t\\tfor sig in bash-patches/*.sig; do \\t\\t\\tp=\\\&quot;${sig%.sig}\\\&quot;; \\t\\t\\tgpg --batch --verify \\\&quot;$sig\\\&quot; \\\&quot;$p\\\&quot;; \\t\\t\\trm \\\&quot;$sig\\\&quot;; \\t\\tdone; \\tfi; \\trm -rf \\\&quot;$GNUPGHOME\\\&quot;; \\t\\tmkdir -p /usr/src/bash; \\ttar \\t\\t--extract \\t\\t--file=bash.tar.gz \\t\\t--strip-components=1 \\t\\t--directory=/usr/src/bash \\t; \\trm bash.tar.gz; \\t\\tif [ -d bash-patches ]; then \\t\\tfor p in bash-patches/*; do \\t\\t\\tpatch \\t\\t\\t\\t--directory=/usr/src/bash \\t\\t\\t\\t--input=\\\&quot;$(readlink -f \\\&quot;$p\\\&quot;)\\\&quot; \\t\\t\\t\\t--strip=0 \\t\\t\\t; \\t\\t\\trm \\\&quot;$p\\\&quot;; \\t\\tdone; \\t\\trmdir bash-patches; \\tfi; \\t\\tcd /usr/src/bash; \\tgnuArch=\\\&quot;$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\\\&quot;; \\t./configure \\t\\t--build=\\\&quot;$gnuArch\\\&quot; \\t\\t--enable-readline \\t\\t--with-curses \\t\\t--without-bash-malloc \\t|| { \\t\\tcat \\u003e\\u00262 config.log; \\t\\tfalse; \\t}; \\tmake -j \\\&quot;$(nproc)\\\&quot;; \\tmake install; \\tcd /; \\trm -r /usr/src/bash; \\t\\trm -r \\t\\t/usr/local/share/doc/bash/*.html \\t\\t/usr/local/share/info \\t\\t/usr/local/share/locale \\t\\t/usr/local/share/man \\t; \\t\\trunDeps=\\\&quot;$( \\t\\tscanelf --needed --nobanner --format &#39;%n#p&#39; --recursive /usr/local \\t\\t\\t| tr &#39;,&#39; &#39;\\\\n&#39; \\t\\t\\t| sort -u \\t\\t\\t| awk &#39;system(\\\&quot;[ -e /usr/local/lib/\\\&quot; $1 \\\&quot; ]\\\&quot;) == 0 { next } { print \\\&quot;so:\\\&quot; $1 }&#39; \\t)\\\&quot;; \\tapk add --no-cache --virtual .bash-rundeps $runDeps; \\tapk del .build-deps; \\t\\t[ \\\&quot;$(which bash)\\\&quot; = &#39;/usr/local/bin/bash&#39; ]; \\tbash --version; \\t[ \\\&quot;$(bash -c &#39;echo \\\&quot;${BASH_VERSION%%[^0-9.]*}\\\&quot;&#39;)\\\&quot; = \\\&quot;${_BASH_VERSION%%-*}.$_BASH_LATEST_PATCH\\\&quot; ];\&quot;},{\&quot;created\&quot;:\&quot;2019-07-13T01:16:06.164128412Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop) COPY file:651b3bebeba8be9162c56b3eb561199905235f3e1c7811232b6c9f48ac333651 in /usr/local/bin/ \&quot;},{\&quot;created\&quot;:\&quot;2019-07-13T01:16:06.319375884Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop)  ENTRYPOINT [\\\&quot;docker-entrypoint.sh\\\&quot;]\&quot;,\&quot;empty_layer\&quot;:true},{\&quot;created\&quot;:\&quot;2019-07-13T01:16:06.527515902Z\&quot;,\&quot;created_by\&quot;:\&quot;/bin/sh -c #(nop)  CMD [\\\&quot;bash\\\&quot;]\&quot;,\&quot;empty_layer\&quot;:true}],\&quot;os\&quot;:\&quot;linux\&quot;,\&quot;rootfs\&quot;:{\&quot;type\&quot;:\&quot;layers\&quot;,\&quot;diff_ids\&quot;:[\&quot;sha256:1bfeebd65323b8ddf5bd6a51cc7097b72788bc982e9ab3280d53d3c613adffa7\&quot;,\&quot;sha256:483c980ac6abf63fc4d7262b17a1954d62266dac3029b5be384d03b39229803e\&quot;,\&quot;sha256:5f5f93a93305210a96cc417f579d70a496bbf0db8e80ea1e9436682c379f25d9\&quot;]}}&quot;</span>;
        <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="14d81e52c25369ed" href="../R/14d81e52c25369ed.html" target="n" data-glyph="46,1" class="i field">ProdConfigBlobDigest</a> = <span class="s">&quot;sha256:16463e0c481e161aabb735437d30b3c9c7391c2747cc564bb927e843b73dcb39&quot;</span>;
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="2c519e6867f176b3" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBlob</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r0 rd" class="r0 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">GetBlob</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r1 rd" class="r1 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r0 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>);
                <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r2 rd" class="r2 r">blob</span> = <b>await</b> <span class="r1 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#c52959f28e10f8d5" class="i method">GetAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#b6a55b6f15c61311" class="i field">ProdRepository</a>, <a href="#14d81e52c25369ed" class="i field">ProdConfigBlobDigest</a>);
                <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="t t">StreamReader</a> <span id="r3 rd" class="r3 r">reader</span> = <b>new</b> <a href="@0@mscorlib/A.html#90fd64afa4c33856" class="t constructor">StreamReader</a>(<span class="r2 r">blob</span>, <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">originalBlob</span> = <span class="r3 r">reader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>();
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ff27d5c197c98be2" class="i field">ProdConfigBlob</a>, <span class="r4 r">originalBlob</span>);
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a810428b99edfcb4" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CheckBlob</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r5 rd" class="r5 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">CheckBlob</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r6 rd" class="r6 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r5 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>);
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#aa94da72e91b42a3" class="k">var</a> <span id="r7 rd" class="r7 r">blob</span> = <b>await</b> <span class="r6 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#bfe779e01e3c699a" class="i method">CheckAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#b6a55b6f15c61311" class="i field">ProdRepository</a>, <a href="#14d81e52c25369ed" class="i field">ProdConfigBlobDigest</a>);
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="r7 r">blob</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#93936450146fd352" class="i property">DockerContentDigest</a>, <a href="#14d81e52c25369ed" class="i field">ProdConfigBlobDigest</a>);
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(5635, <span class="r7 r">blob</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#875fe1aa90f61530" class="i property">ContentLength</a>);
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="9ec5e54e32155f79" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DeleteBlob</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r8 rd" class="r8 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">DeleteBlob</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r9 rd" class="r9 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r8 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#01bc8061a38aa4bf" class="i field">ManagedTestRegistryForChanges</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">digest</span> = <b>await</b> <a href="#23edd8107611894f" class="i method">UploadLayer</a>(<a href="#4af5b4ac84f92f56" class="i method">GenerateStreamFromString</a>(<span class="s">&quot;Testdata&quot;</span>), <span class="r9 r">client</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#670f0a95f93affe3" class="i field">BlobTestRepository</a>);
                <b>await</b> <span class="r9 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#7f8e9ead9d0007aa" class="i method">DeleteAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#670f0a95f93affe3" class="i field">BlobTestRepository</a>, <span class="r10 r">digest</span>);
                <span class="c">// Should not find layer</span>
                <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="/Microsoft.Azure.ContainerRegistry/A.html#65d8012e9d36a057" class="t t">AcrErrorsException</a>&gt;(() =&gt; { <span class="r9 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#bfe779e01e3c699a" class="i method">CheckAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#670f0a95f93affe3" class="i field">BlobTestRepository</a>, <span class="r10 r">digest</span>).<a href="@0@mscorlib/A.html#e1d639f68b66715a" class="i method">GetAwaiter</a>().<a href="@0@mscorlib/A.html#c2597ba59f71d619" class="i method">GetResult</a>(); }); <span class="c">// Should error</span>
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="55b79233d19632ec" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">UploadLayerNext</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r11 rd" class="r11 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">UploadLayerNext</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r12 rd" class="r12 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r11 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r13 rd" class="r13 r">digest</span> = <b>await</b> <a href="#23edd8107611894f" class="i method">UploadLayer</a>(<a href="#4af5b4ac84f92f56" class="i method">GenerateStreamFromString</a>(<span class="s">&quot;SomethingElse&quot;</span>), <span class="r12 r">client</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#670f0a95f93affe3" class="i field">BlobTestRepository</a>);
                <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="k">var</a> <span id="r14 rd" class="r14 r">blob</span> = <b>await</b> <span class="r12 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#c52959f28e10f8d5" class="i method">GetAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#670f0a95f93affe3" class="i field">BlobTestRepository</a>, <span class="r13 r">digest</span>);
                <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="t t">StreamReader</a> <span id="r15 rd" class="r15 r">reader</span> = <b>new</b> <a href="@0@mscorlib/A.html#90fd64afa4c33856" class="t constructor">StreamReader</a>(<span class="r14 r">blob</span>, <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>);
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="s">&quot;SomethingElse&quot;</span>, <span class="r15 r">reader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>());
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="32e3e88d8824900f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CancelBlobUpload</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r16 rd" class="r16 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">CancelBlobUpload</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r17 rd" class="r17 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r16 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#01bc8061a38aa4bf" class="i field">ManagedTestRegistryForChanges</a>);
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#afd58e3169b72f44" class="k">var</a> <span id="r18 rd" class="r18 r">uploadInfo</span> = <b>await</b> <span class="r17 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#494cea0b113598b4" class="i method">StartUploadAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fdbeac02d0f37d2a" class="i field">changeableRepository</a>);
                <b>await</b> <span class="r17 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#55242efaf9ccc019" class="i method">CancelUploadAsync</a>(<span class="r18 r">uploadInfo</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#e20c101c87f801b2" class="i property">Location</a>);
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="874472a408f5d0d7" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBlobStatus</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r19 rd" class="r19 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">GetBlobStatus</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r20 rd" class="r20 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r19 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>);
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#afd58e3169b72f44" class="k">var</a> <span id="r21 rd" class="r21 r">uploadInfo</span> = <b>await</b> <span class="r20 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#494cea0b113598b4" class="i method">StartUploadAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#670f0a95f93affe3" class="i field">BlobTestRepository</a>);
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#1dc1ce412f5593c8" class="k">var</a> <span id="r22 rd" class="r22 r">status</span> = <b>await</b> <span class="r20 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#f334a860e7501ae6" class="i method">GetStatusAsync</a>(<span class="r21 r">uploadInfo</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#e20c101c87f801b2" class="i property">Location</a>.<a href="@0@mscorlib/A.html#882fa7998d6ca35a" class="i method">Substring</a>(1));
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="r21 r">uploadInfo</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#bebde558ecc28084" class="i property">DockerUploadUUID</a>, <span class="r22 r">status</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#e73a56d8e34cec7a" class="i property">DockerUploadUUID</a>);
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="s">&quot;0-0&quot;</span>, <span class="r22 r">status</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#d995dd9b7d31b940" class="i property">Range</a>);
                <b>await</b> <span class="r20 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#55242efaf9ccc019" class="i method">CancelUploadAsync</a>(<span class="r21 r">uploadInfo</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#e20c101c87f801b2" class="i property">Location</a>);
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f21bf5b6837f8c03" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBlobChunk</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r23 rd" class="r23 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">GetBlobChunk</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r24 rd" class="r24 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r23 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>);
                <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r25 rd" class="r25 r">blob</span> = <b>await</b> <span class="r24 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6d595bbdba6f3ef0" class="i method">GetChunkAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#b6a55b6f15c61311" class="i field">ProdRepository</a>, <a href="#14d81e52c25369ed" class="i field">ProdConfigBlobDigest</a>, <span class="s">&quot;bytes=0-299&quot;</span>);
                <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="t t">StreamReader</a> <span id="r26 rd" class="r26 r">reader</span> = <b>new</b> <a href="@0@mscorlib/A.html#90fd64afa4c33856" class="t constructor">StreamReader</a>(<span class="r25 r">blob</span>, <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r27 rd" class="r27 r">originalBlob</span> = <span class="r26 r">reader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>();
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ff27d5c197c98be2" class="i field">ProdConfigBlob</a>.<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 300), <span class="r27 r">originalBlob</span>);
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="0dee058a3c15fee2" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">MountBlob</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r28 rd" class="r28 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">MountBlob</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r29 rd" class="r29 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r28 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#01bc8061a38aa4bf" class="i field">ManagedTestRegistryForChanges</a>);
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#a198613e811208b9" class="k">var</a> <span id="r30 rd" class="r30 r">res</span> = <b>await</b> <span class="r29 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#31baf1f63d916a8a" class="i method">MountAsync</a>(<span class="s">&quot;somethingnew&quot;</span>, <span class="s">&quot;doundo/bash&quot;</span>, <span class="s">&quot;sha256:16463e0c481e161aabb735437d30b3c9c7391c2747cc564bb927e843b73dcb39&quot;</span>);
                <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r31 rd" class="r31 r">blob</span> = <b>await</b> <span class="r29 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#c52959f28e10f8d5" class="i method">GetAsync</a>(<span class="s">&quot;somethingnew&quot;</span>, <span class="s">&quot;sha256:16463e0c481e161aabb735437d30b3c9c7391c2747cc564bb927e843b73dcb39&quot;</span>);
                <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="t t">StreamReader</a> <span id="r32 rd" class="r32 r">reader</span> = <b>new</b> <a href="@0@mscorlib/A.html#90fd64afa4c33856" class="t constructor">StreamReader</a>(<span class="r31 r">blob</span>, <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r33 rd" class="r33 r">originalBlob</span> = <span class="r32 r">reader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>();
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ff27d5c197c98be2" class="i field">ProdConfigBlob</a>, <span class="r33 r">originalBlob</span>);
            }
        }
 
        [<span class="t constructor">Fact</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="118b1410d80351b9" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CheckBlobChunk</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r34 rd" class="r34 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">CheckBlobChunk</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r35 rd" class="r35 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r34 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>);
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#6672dd5cd180f760" class="k">var</a> <span id="r36 rd" class="r36 r">blobData</span> = <b>await</b> <span class="r35 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#837f0c6ce84b19f9" class="i method">CheckChunkAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#b6a55b6f15c61311" class="i field">ProdRepository</a>, <a href="#14d81e52c25369ed" class="i field">ProdConfigBlobDigest</a>, <span class="s">&quot;bytes=0-300&quot;</span>);
                <span class="c">//Range is actually ignored in this request. Ends up working quite similarly to CheckBlob</span>
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(5635, <span class="r36 r">blobData</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#94a2bcd6f092342c" class="i property">ContentLength</a>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This test should be run only live.</span>
        <span class="c">///</span><span class="c"> HTTP calls made by the clients in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Microsoft.Azure.ContainerRegistry/A.html#bf7bab1327bc1769" class="t t">ContainerRegistryRefreshToken</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Microsoft.Azure.ContainerRegistry/A.html#5cb89ef7a3af923b" class="t t">ContainerRegistryAccessToken</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> aren&#39;t being mocked by the test framework. This leads to issues when trying to refresh AADTokens during &quot;playback&quot; as these</span>
        <span class="c">///</span><span class="c"> clients&#39; requests are always &quot;live&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>(<span class="i property">Skip</span> = <span class="s">&quot;Should be run only live&quot;</span>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="02090dcc815419c9" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBlobOAuth</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r37 rd" class="r37 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">GetBlobOAuth</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#bef429a00669fc04" class="t t">LoginMode</a> <span id="r38 rd" class="r38 r">loginMode</span> = <a href="/Microsoft.Azure.ContainerRegistry/A.html#bef429a00669fc04" class="t t">LoginMode</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#e469f891103515c4" class="i field">TokenAuth</a>; <span class="c">// use oauth - exchange username and password for a refreshtoken</span>
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r39 rd" class="r39 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r37 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>, <span class="r38 r">loginMode</span>);
                <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r40 rd" class="r40 r">blob</span> = <b>await</b> <span class="r39 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#c52959f28e10f8d5" class="i method">GetAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#b6a55b6f15c61311" class="i field">ProdRepository</a>, <a href="#14d81e52c25369ed" class="i field">ProdConfigBlobDigest</a>);
                <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="t t">StreamReader</a> <span id="r41 rd" class="r41 r">reader</span> = <b>new</b> <a href="@0@mscorlib/A.html#90fd64afa4c33856" class="t constructor">StreamReader</a>(<span class="r40 r">blob</span>, <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r42 rd" class="r42 r">originalBlob</span> = <span class="r41 r">reader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>();
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ff27d5c197c98be2" class="i field">ProdConfigBlob</a>, <span class="r42 r">originalBlob</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This test should be run only live.</span>
        <span class="c">///</span><span class="c"> HTTP calls made by the clients in </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Microsoft.Azure.ContainerRegistry/A.html#bf7bab1327bc1769" class="t t">ContainerRegistryRefreshToken</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c"> and </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Microsoft.Azure.ContainerRegistry/A.html#5cb89ef7a3af923b" class="t t">ContainerRegistryAccessToken</a><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> aren&#39;t being mocked by the test framework. This leads to issues when trying to refresh AADTokens during &quot;playback&quot; as these</span>
        <span class="c">///</span><span class="c"> clients&#39; requests are always &quot;live&quot;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>(<span class="i property">Skip</span>=<span class="s">&quot;Should be run only live&quot;</span>)]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="889e368e5d0b63d4" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBlobAAD</a>()
        {
            <b>using</b> (<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="k">var</a> <span id="r43 rd" class="r43 r">context</span> = <a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#99795cd14ff6aa3c" class="t t">MockContext</a>.<a href="/Microsoft.Rest.ClientRuntime.Azure.TestFramework/A.html#7807b8f25afc69de" class="i method">Start</a>(<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>(), <b>nameof</b>(<span class="i">GetBlobAAD</span>)))
            {
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#bef429a00669fc04" class="t t">LoginMode</a> <span id="r44 rd" class="r44 r">loginMode</span> = <a href="/Microsoft.Azure.ContainerRegistry/A.html#bef429a00669fc04" class="t t">LoginMode</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#1d69753533dd2d92" class="i field">TokenAad</a>; <span class="c">// use AAD</span>
                <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r45 rd" class="r45 r">client</span> = <b>await</b> <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#fe2dd356e0c37a02" class="i method">GetACRClientAsync</a>(<span class="r43 r">context</span>, <a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#895683854d6ff8d6" class="i field">ManagedTestRegistry</a>, <span class="r44 r">loginMode</span>);
                <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r46 rd" class="r46 r">blob</span> = <b>await</b> <span class="r45 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#c52959f28e10f8d5" class="i method">GetAsync</a>(<a href="../Helpers/ACRTestUtil.cs.html#6997c9c5cad98dc3" class="t t">ACRTestUtil</a>.<a href="../Helpers/ACRTestUtil.cs.html#b6a55b6f15c61311" class="i field">ProdRepository</a>, <a href="#14d81e52c25369ed" class="i field">ProdConfigBlobDigest</a>);
                <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="t t">StreamReader</a> <span id="r47 rd" class="r47 r">reader</span> = <b>new</b> <a href="@0@mscorlib/A.html#90fd64afa4c33856" class="t constructor">StreamReader</a>(<span class="r46 r">blob</span>, <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>);
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r48 rd" class="r48 r">originalBlob</span> = <span class="r47 r">reader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>();
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ff27d5c197c98be2" class="i field">ProdConfigBlob</a>, <span class="r48 r">originalBlob</span>);
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Helpers
        <b>private async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="23edd8107611894f" href="../R/23edd8107611894f.html" target="n" data-glyph="76,1" class="i method">UploadLayer</a>(<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r49 rd" class="r49 r">blob</span>, <a href="/Microsoft.Azure.ContainerRegistry/A.html#452c83a914f45528" class="t t">AzureContainerRegistryClient</a> <span id="r50 rd" class="r50 r">client</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r51 rd" class="r51 r">repository</span>)
        {
            <span class="c">// Make copy to obtain the ability to rewind the stream</span>
            <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r52 rd" class="r52 r">cpy</span> = <b>new</b> <a href="@0@mscorlib/A.html#d308091cc690e78d" class="t constructor">MemoryStream</a>();
            <span class="r49 r">blob</span>.<a href="@0@mscorlib/A.html#295ec16c77d4fafb" class="i method">CopyTo</a>(<span class="r52 r">cpy</span>);
            <span class="r52 r">cpy</span>.<a href="@0@mscorlib/A.html#35112b2a53fb536a" class="i property">Position</a> = 0;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r53 rd" class="r53 r">digest</span> = <a href="#2d03f7bb55ab86f9" class="i method">ComputeDigest</a>(<span class="r52 r">cpy</span>);
            <span class="r52 r">cpy</span>.<a href="@0@mscorlib/A.html#35112b2a53fb536a" class="i property">Position</a> = 0;
 
            <a href="/Microsoft.Azure.ContainerRegistry/A.html#afd58e3169b72f44" class="k">var</a> <span id="r54 rd" class="r54 r">uploadInfo</span> = <b>await</b> <span class="r50 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#494cea0b113598b4" class="i method">StartUploadAsync</a>(<span class="r51 r">repository</span>);
            <a href="/Microsoft.Azure.ContainerRegistry/A.html#7af961cdaff889a4" class="k">var</a> <span id="r55 rd" class="r55 r">uploadedLayer</span> = <b>await</b> <span class="r50 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#ef10eea93cc12400" class="i method">UploadAsync</a>(<span class="r52 r">cpy</span>, <span class="r54 r">uploadInfo</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#e20c101c87f801b2" class="i property">Location</a>);
            <a href="/Microsoft.Azure.ContainerRegistry/A.html#f8532fce830496a3" class="k">var</a> <span id="r56 rd" class="r56 r">uploadedLayerEnd</span> = <b>await</b> <span class="r50 r">client</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#6673be4cd1a3cb10" class="i property">Blob</a>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#7d7c3aed91386f7a" class="i method">EndUploadAsync</a>(<span class="r53 r">digest</span>, <span class="r55 r">uploadedLayer</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#78049fc76ca4d3c7" class="i property">Location</a>);
            <b>return</b> <span class="r56 r">uploadedLayerEnd</span>.<a href="/Microsoft.Azure.ContainerRegistry/A.html#f0c4e108713f6ab1" class="i property">DockerContentDigest</a>;
        }
 
        <b>private static string</b> <a id="2d03f7bb55ab86f9" href="../R/2d03f7bb55ab86f9.html" target="n" data-glyph="76,1" class="i method">ComputeDigest</a>(<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r57 rd" class="r57 r">s</span>)
        {
            <span class="r57 r">s</span>.<a href="@0@mscorlib/A.html#35112b2a53fb536a" class="i property">Position</a> = 0;
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="t t">StringBuilder</a> <span id="r58 rd" class="r58 r">sb</span> = <b>new</b> <a href="@0@mscorlib/A.html#6e631639c1e2746b" class="t constructor">StringBuilder</a>();
 
            <b>using</b> (<a href="@0@mscorlib/A.html#b87ea7e64312d482" class="k">var</a> <span id="r59 rd" class="r59 r">hash</span> = <a href="@0@mscorlib/A.html#b87ea7e64312d482" class="t t">SHA256</a>.<a href="@0@mscorlib/A.html#4b15c607be98ae7f" class="i method">Create</a>())
            {
                <b>byte</b>[] <span id="r60 rd" class="r60 r">result</span> = <span class="r59 r">hash</span>.<a href="@0@mscorlib/A.html#5b02a2a217146fcf" class="i method">ComputeHash</a>(<span class="r57 r">s</span>);
 
                <b>foreach</b> (<b>byte</b> <span id="r61 rd" class="r61 r">b</span> <b>in</b> <span class="r60 r">result</span>)
                    <span class="r58 r">sb</span>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r61 r">b</span>.<a href="@0@mscorlib/A.html#51506b5791391f8f" class="i method">ToString</a>(<span class="s">&quot;x2&quot;</span>));
            }
 
            <b>return</b> <span class="s">&quot;sha256:&quot;</span> + <span class="r58 r">sb</span>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
 
        }
 
        <b>private static</b> <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <a id="4af5b4ac84f92f56" href="../R/4af5b4ac84f92f56.html" target="n" data-glyph="76,1" class="i method">GenerateStreamFromString</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r62 rd" class="r62 r">s</span>)
        {
            <a href="@0@mscorlib/A.html#1a4dcb744a23ba6f" class="k">var</a> <span id="r63 rd" class="r63 r">stream</span> = <b>new</b> <a href="@0@mscorlib/A.html#d308091cc690e78d" class="t constructor">MemoryStream</a>();
            <a href="@0@mscorlib/A.html#9e38cb1c84769eba" class="k">var</a> <span id="r64 rd" class="r64 r">writer</span> = <b>new</b> <a href="@0@mscorlib/A.html#c73af21c3340883d" class="t constructor">StreamWriter</a>(<span class="r63 r">stream</span>);
            <span class="r64 r">writer</span>.<a href="@0@mscorlib/A.html#715bd5de78456219" class="i method">Write</a>(<span class="r62 r">s</span>);
            <span class="r64 r">writer</span>.<a href="@0@mscorlib/A.html#4d8cd91791f0d47c" class="i method">Flush</a>();
            <span class="r63 r">stream</span>.<a href="@0@mscorlib/A.html#ad08f8ca81a5a763" class="i property">Position</a> = 0;
            <b>return</b> <span class="r63 r">stream</span>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
