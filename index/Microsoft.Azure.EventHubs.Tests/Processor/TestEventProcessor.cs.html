<!DOCTYPE html>
<html><head><title>TestEventProcessor.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(112);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Tests/Processor/TestEventProcessor.cs" target="_top">Processor\TestEventProcessor.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Tests" target="_top">Microsoft.Azure.EventHubs.Tests.csproj</a> (Microsoft.Azure.EventHubs.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">Tests</span>.<span class="i n">Processor</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">Processor</span>;
 
    <b>class</b> <a id="f29e43e5cd24e978" href="../R/f29e43e5cd24e978.html" target="n" data-glyph="2,0" class="t t"><span id="003c3270b37a6617">TestEventProcessor</span></a> : <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>
    {
        <b>public event</b> <a href="@0@mscorlib/A.html#96ed969784b9d510" class="t t">EventHandler</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>&gt; <a id="e6f629d830a0d42e" href="../R/e6f629d830a0d42e.html" target="n" data-glyph="30,1" class="i">OnOpen</a>;
        <b>public event</b> <a href="@0@mscorlib/A.html#96ed969784b9d510" class="t t">EventHandler</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="/Microsoft.Azure.EventHubs.Processor/A.html#b558f2f6b81c2c26" class="t t">CloseReason</a>&gt;&gt; <a id="257393cebe79a8fe" href="../R/257393cebe79a8fe.html" target="n" data-glyph="30,1" class="i">OnClose</a>;
        <b>public event</b> <a href="@0@mscorlib/A.html#96ed969784b9d510" class="t t">EventHandler</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="#457286ed82a1f250" class="t t">ReceivedEventArgs</a>&gt;&gt; <a id="e0bee2b99c1e18ec" href="../R/e0bee2b99c1e18ec.html" target="n" data-glyph="30,1" class="i">OnProcessEvents</a>;
        <b>public event</b> <a href="@0@mscorlib/A.html#96ed969784b9d510" class="t t">EventHandler</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;&gt; <a id="24ad11e89c1595d8" href="../R/24ad11e89c1595d8.html" target="n" data-glyph="30,1" class="i">OnProcessError</a>;
 
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="0295685680d746dc" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CloseAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r0 rd" class="r0 r">context</span>, <a href="/Microsoft.Azure.EventHubs.Processor/A.html#b558f2f6b81c2c26" class="t t">CloseReason</a> <span id="r1 rd" class="r1 r">reason</span>)
        {
            <a href="#f29e43e5cd24e978" class="k">this</a>.<a href="#257393cebe79a8fe" class="i">OnClose</a>?.<a href="@0@mscorlib/A.html#48225ee7c18a0e20" class="i method">Invoke</a>(<a href="#f29e43e5cd24e978" class="k">this</a>, <b>new</b> <a href="@0@mscorlib/A.html#ee1efa9bd0176f36" class="t constructor">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="/Microsoft.Azure.EventHubs.Processor/A.html#b558f2f6b81c2c26" class="t t">CloseReason</a>&gt;(<span class="r0 r">context</span>, <span class="r1 r">reason</span>));
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="52b0a3683a8fe5ba" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ProcessErrorAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r2 rd" class="r2 r">context</span>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r3 rd" class="r3 r">error</span>)
        {
            <a href="#f29e43e5cd24e978" class="k">this</a>.<a href="#24ad11e89c1595d8" class="i">OnProcessError</a>?.<a href="@0@mscorlib/A.html#48225ee7c18a0e20" class="i method">Invoke</a>(<a href="#f29e43e5cd24e978" class="k">this</a>, <b>new</b> <a href="@0@mscorlib/A.html#ee1efa9bd0176f36" class="t constructor">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>&gt;(<span class="r2 r">context</span>, <span class="r3 r">error</span>));
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="eee9493ff27f2825" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ProcessEventsAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r4 rd" class="r4 r">context</span>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r5 rd" class="r5 r">events</span>)
        {
            <a href="#457286ed82a1f250" class="k">var</a> <span id="r6 rd" class="r6 r">eventsArgs</span> = <b>new</b> <a href="#457286ed82a1f250" class="t constructor">ReceivedEventArgs</a>();
            <span class="r6 r">eventsArgs</span>.<a href="#30a65eb469eb9430" class="i field">events</a> = <span class="r5 r">events</span>;
            <a href="#f29e43e5cd24e978" class="k">this</a>.<a href="#e0bee2b99c1e18ec" class="i">OnProcessEvents</a>?.<a href="@0@mscorlib/A.html#48225ee7c18a0e20" class="i method">Invoke</a>(<a href="#f29e43e5cd24e978" class="k">this</a>, <b>new</b> <a href="@0@mscorlib/A.html#ee1efa9bd0176f36" class="t constructor">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="#457286ed82a1f250" class="t t">ReceivedEventArgs</a>&gt;(<span class="r4 r">context</span>, <span class="r6 r">eventsArgs</span>));
            <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a> <span id="r7 rd" class="r7 r">lastEvent</span> = <span class="r5 r">events</span>?.<a href="@0@System.Core/A.html#981cccb3b4b716eb" class="i method">LastOrDefault</a>();
 
            <span class="c">// Checkpoint with last event?</span>
            <b>if</b> (<span class="r6 r">eventsArgs</span>.<a href="#5803b970c2893041" class="i field">checkPointLastEvent</a> &amp;&amp; <span class="r7 r">lastEvent</span> != <b>null</b>)
            {
                <b>return</b> <span class="r4 r">context</span>.<span class="i">CheckpointAsync</span>(<span class="r7 r">lastEvent</span>);
            }
 
            <span class="c">// Checkpoint batch? This should checkpoint with last message delivered.</span>
            <b>else</b> <b>if</b> (<span class="r6 r">eventsArgs</span>.<a href="#6555fcb660180352" class="i field">checkPointBatch</a>)
            {
                <b>return</b> <span class="r4 r">context</span>.<span class="i">CheckpointAsync</span>();
            }
 
            <span class="c">// No checkpoint? Then just return CompletedTask</span>
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="7175cdfca862aa80" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OpenAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r8 rd" class="r8 r">context</span>)
        {
            <a href="#f29e43e5cd24e978" class="k">this</a>.<a href="#e6f629d830a0d42e" class="i">OnOpen</a>?.<a href="@0@mscorlib/A.html#48225ee7c18a0e20" class="i method">Invoke</a>(<a href="#f29e43e5cd24e978" class="k">this</a>, <span class="r8 r">context</span>);
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
    }
 
    <b>class</b> <a id="2b004f38e50eacdf" href="../R/2b004f38e50eacdf.html" target="n" data-glyph="2,0" class="t t"><span id="cc3282922f6318cb">SecondTestEventProcessor</span></a> : <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>
    {
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="f415f9d3c6eba4f5" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CloseAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r9 rd" class="r9 r">context</span>, <a href="/Microsoft.Azure.EventHubs.Processor/A.html#b558f2f6b81c2c26" class="t t">CloseReason</a> <span id="r10 rd" class="r10 r">reason</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="53ef306f7dfa6ded" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ProcessErrorAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r11 rd" class="r11 r">context</span>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r12 rd" class="r12 r">error</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="6b44506782610261" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ProcessEventsAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r13 rd" class="r13 r">context</span>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r14 rd" class="r14 r">events</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>.<a id="d526ccce8f593d38" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OpenAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r15 rd" class="r15 r">context</span>)
        {
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
    }
 
    <b>class</b> <a id="cd6c100af698c5b5" href="../R/cd6c100af698c5b5.html" target="n" data-glyph="2,0" class="t t"><span id="32031f44b3bd491d">TestEventProcessorFactory</span></a> : <a href="/Microsoft.Azure.EventHubs.Processor/A.html#a048cc9fbbcba0b4" class="t t">IEventProcessorFactory</a>
    {
        <b>public event</b> <a href="@0@mscorlib/A.html#96ed969784b9d510" class="t t">EventHandler</a>&lt;<a href="@0@mscorlib/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="#f29e43e5cd24e978" class="t t">TestEventProcessor</a>&gt;&gt; <a id="c3e7dc9dd916cb94" href="../R/c3e7dc9dd916cb94.html" target="n" data-glyph="30,1" class="i">OnCreateProcessor</a>;
 
        <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#a048cc9fbbcba0b4" class="t t">IEventProcessorFactory</a>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c393a01444da5a88" class="i method">CreateEventProcessor</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r16 rd" class="r16 r">context</span>)
        {
            <a href="#f29e43e5cd24e978" class="k">var</a> <span id="r17 rd" class="r17 r">processor</span> = <b>new</b> <a href="#f29e43e5cd24e978" class="t constructor">TestEventProcessor</a>();
            <a href="#cd6c100af698c5b5" class="k">this</a>.<a href="#c3e7dc9dd916cb94" class="i">OnCreateProcessor</a>?.<a href="@0@mscorlib/A.html#48225ee7c18a0e20" class="i method">Invoke</a>(<a href="#cd6c100af698c5b5" class="k">this</a>, <b>new</b> <a href="@0@mscorlib/A.html#ee1efa9bd0176f36" class="t constructor">Tuple</a>&lt;<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a>, <a href="#f29e43e5cd24e978" class="t t">TestEventProcessor</a>&gt;(<span class="r16 r">context</span>, <span class="r17 r">processor</span>));
            <b>return</b> <span class="r17 r">processor</span>;
        }
 
        <b>public static void</b> <a id="48d03dfe4ced7adb" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ErrorNotificationHandler</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#9b721c0052523fea" class="t t">ExceptionReceivedEventArgs</a> <span id="r18 rd" class="r18 r">t</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="t t">String</a> <span id="r19 rd" class="r19 r">identifier</span> = <span class="s">&quot;Host:&quot;</span> + <span class="r18 r">t</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#ceea81f6d9f1ac1e" class="i property">Hostname</a> + <span class="s">&quot;Partition:&quot;</span> + <span class="r18 r">t</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#160fec432f5ff093" class="i property">PartitionId</a> + <span class="s">&quot; Action:&quot;</span> + <span class="r18 r">t</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#779d5c4f318c365c" class="i property">Action</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r20 rd" class="r20 r">log</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<span class="i">Format</span>(<span class="s">&quot;{0} Exception caught (Identifier: {0}): {1}&quot;</span>, <span class="r19 r">identifier</span>, <span class="r18 r">t</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#6f606ce0e632c60c" class="i property">Exception</a>);
            <a href="@0@System/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@0@System/A.html#73de7bb60da320d3" class="i method">WriteLine</a>(<span class="r20 r">log</span>);
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="r20 r">log</span>);
        }
    }
 
    <b>class</b> <a id="457286ed82a1f250" href="../R/457286ed82a1f250.html" target="n" data-glyph="2,0" class="t t"><span id="0db42ade1fcaeffa">ReceivedEventArgs</span></a>
    {
        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <a id="30a65eb469eb9430" href="../R/30a65eb469eb9430.html" target="n" data-glyph="42,1" class="i field">events</a>;
        <b>public bool</b> <a id="5803b970c2893041" href="../R/5803b970c2893041.html" target="n" data-glyph="42,1" class="i field">checkPointLastEvent</a> = <b>true</b>;
        <b>public bool</b> <a id="6555fcb660180352" href="../R/6555fcb660180352.html" target="n" data-glyph="42,1" class="i field">checkPointBatch</a> = <b>false</b>;
    }
}
</pre></td></tr></table></div></body></html>
