<!DOCTYPE html>
<html><head><title>MigrationGuideSnippets.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(412);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Tests/Snippets/MigrationGuideSnippets.cs" target="_top">Snippets\MigrationGuideSnippets.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/eventhub/Microsoft.Azure.EventHubs/tests/Snippets/MigrationGuideSnippets.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Tests" target="_top">Microsoft.Azure.EventHubs.Tests.csproj</a> (Microsoft.Azure.EventHubs.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">Tests</span>.<span class="i n">Snippets</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">CodeAnalysis</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">Processor</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">IdentityModel</span>.<span class="i n">Clients</span>.<span class="i n">ActiveDirectory</span>;
    <b>using</b> <span class="i n">Xunit</span>;
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   The suite of tests defining the snippets used in the migration guide</span>
    <span class="c">///</span><span class="c">   illustrating concepts from Microsoft.Azure.EventHubs and</span>
    <span class="c">///</span><span class="c">   Azure.Messaging.EventHubs in a side-by-side manner.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span>
    [<a href="@0@mscorlib/A.html#5e00de6576fb9ce7" class="t constructor">SuppressMessage</a>(<span class="s">&quot;Style&quot;</span>, <span class="s">&quot;IDE0059:Unnecessary assignment of a value&quot;</span>, <a href="@0@mscorlib/A.html#ce02a652a479502a" class="i property">Justification</a> = <span class="s">&quot;Example assignments needed for snippet output content.&quot;</span>)]
    <b>public class</b> <a id="655821bd74fc018a" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="4e7a742e01fa4dc6">MigrationGuideSnippets</span></a>
    {
        [<span class="t constructor">Fact</span>]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public void</b> <a id="a7741c526ed3597e" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateWithConnectionString</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_CreateWithConnectionString
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r0 rd" class="r0 r">connectionString</span> = <span class="s">&quot;&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r1 rd" class="r1 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r0 r">connectionString</span> = <a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>;
            <span class="c">/*@@*/</span> <span class="r1 r">eventHubName</span> = <span class="s">&quot;fake&quot;</span>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="k">var</a> <span id="r2 rd" class="r2 r">builder</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#cf3f2e7ab687f745" class="t constructor">EventHubsConnectionStringBuilder</a>(<span class="r0 r">connectionString</span>);
            <span class="r2 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#07eaa0ed4c59a2a0" class="i property">EntityPath</a> = <span class="r1 r">eventHubName</span>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a> <span id="r3 rd" class="r3 r">client</span> = <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a>.<a href="/Microsoft.Azure.EventHubs/A.html#911ed71627886602" class="i method">CreateFromConnectionString</a>(<span class="r2 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#23287d656a851420" class="i method">ToString</a>());
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
            <span class="r3 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
        }
 
        [<span class="t constructor">Fact</span>(<span class="i property">Skip</span> = <span class="s">&quot;Manual run only&quot;</span>)]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="382b7913206ded69" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateWithAzureActiveDirectory</a>()
        {
            <b>await using</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="k">var</a> <span id="r4 rd" class="r4 r">scope</span> = <b>await</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="t t">EventHubScope</a>.<a href="../Infrastructure/EventHubScope.cs.html#fc500ef8b0ed81bf" class="i method">CreateAsync</a>(1);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_CreateWithAzureActiveDirectory
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r5 rd" class="r5 r">fullyQualifiedNamespace</span> = <span class="s">&quot;&lt;&lt; NAMESPACE (likely similar to {your-namespace}.servicebus.windows.net) &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r6 rd" class="r6 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r5 r">fullyQualifiedNamespace</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#cf3f2e7ab687f745" class="t constructor">EventHubsConnectionStringBuilder</a>(<a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>).<a href="/Microsoft.Azure.EventHubs/A.html#6d119b1fb797464e" class="i property">Endpoint</a>.<a href="@0@System/A.html#bf3caa11ab73e433" class="i method">ToString</a>();
            <span class="c">/*@@*/</span> <span class="r6 r">eventHubName</span> = <span class="r4 r">scope</span>.<a href="../Infrastructure/EventHubScope.cs.html#8005a78a892ade08" class="i property">EventHubName</a>;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r7 rd" class="r7 r">authority</span> = <span class="s">&quot;&lt;&lt; NAME OF THE AUTHORITY TO ASSOCIATE WITH THE TOKEN &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r8 rd" class="r8 r">aadAppId</span> = <span class="s">&quot;&lt;&lt; THE AZURE ACTIVE DIRECTORY APPLICATION ID TO REQUEST A TOKEN FOR &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r9 rd" class="r9 r">aadAppSecret</span> = <span class="s">&quot;&lt;&lt; THE AZURE ACTIVE DIRECTORY SECRET TO USE FOR THE TOKEN &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r7 r">authority</span> = <span class="s">&quot;&quot;</span>;     <span class="c">// Needed for manual run</span>
            <span class="c">/*@@*/</span> <span class="r8 r">aadAppId</span> = <span class="s">&quot;&quot;</span>;      <span class="c">// Needed for manual run</span>
            <span class="c">/*@@*/</span> <span class="r9 r">aadAppSecret</span> = <span class="s">&quot;&quot;</span>;  <span class="c">// Needed for manual run</span>
 
            <a href="/Microsoft.Azure.EventHubs/A.html#d47864b27a5d98b7" class="t t">AzureActiveDirectoryTokenProvider</a>.<a href="/Microsoft.Azure.EventHubs/A.html#70773f514790fdaa" class="t t">AuthenticationCallback</a> <span id="r10 rd" class="r10 r">authCallback</span> =
                <b>async</b> (<span id="r11 rd" class="r11 r">audience</span>, <span id="r12 rd" class="r12 r">authority</span>, <span id="r13 rd" class="r13 r">state</span>) =&gt;
                {
                    <b>var</b> <span id="r14 rd" class="r14 r">authContext</span> = <b>new</b> <span class="t constructor">AuthenticationContext</span>(<span class="r12 r">authority</span>);
                    <b>var</b> <span id="r15 rd" class="r15 r">clientCredential</span> = <b>new</b> <span class="t constructor">ClientCredential</span>(<span class="r8 r">aadAppId</span>, <span class="r9 r">aadAppSecret</span>);
 
                    <span class="t t">AuthenticationResult</span> <span id="r16 rd" class="r16 r">authResult</span> = <b>await</b> <span class="r14 r">authContext</span>.<span class="i method">AcquireTokenAsync</span>(<span class="r11 r">audience</span>, <span class="r15 r">clientCredential</span>);
                    <b>return</b> <span class="r16 r">authResult</span>.<span class="i property">AccessToken</span>;
                };
 
            <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a> <span id="r17 rd" class="r17 r">client</span> = <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a>.<a href="/Microsoft.Azure.EventHubs/A.html#ef5b1f3eb96bb2c3" class="i method">CreateWithAzureActiveDirectory</a>(
                <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r5 r">fullyQualifiedNamespace</span>),
                <span class="r6 r">eventHubName</span>,
                <span class="r10 r">authCallback</span>,
                <span class="r7 r">authority</span>);
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
            <span class="r17 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
        }
 
        [<span class="t constructor">Fact</span>(<span class="i property">Skip</span> = <span class="s">&quot;Manual run only&quot;</span>)]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7611f12aedfa0bb4" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateWithManagedIdentity</a>()
        {
            <b>await using</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="k">var</a> <span id="r18 rd" class="r18 r">scope</span> = <b>await</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="t t">EventHubScope</a>.<a href="../Infrastructure/EventHubScope.cs.html#fc500ef8b0ed81bf" class="i method">CreateAsync</a>(1);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_ManagedIdentity
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r19 rd" class="r19 r">fullyQualifiedNamespace</span> = <span class="s">&quot;&lt;&lt; NAMESPACE (likely similar to {your-namespace}.servicebus.windows.net) &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r20 rd" class="r20 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r19 r">fullyQualifiedNamespace</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#cf3f2e7ab687f745" class="t constructor">EventHubsConnectionStringBuilder</a>(<a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>).<a href="/Microsoft.Azure.EventHubs/A.html#6d119b1fb797464e" class="i property">Endpoint</a>.<a href="@0@System/A.html#bf3caa11ab73e433" class="i method">ToString</a>();
            <span class="c">/*@@*/</span> <span class="r20 r">eventHubName</span> = <span class="r18 r">scope</span>.<a href="../Infrastructure/EventHubScope.cs.html#8005a78a892ade08" class="i property">EventHubName</a>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a> <span id="r21 rd" class="r21 r">client</span> = <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a>.<a href="/Microsoft.Azure.EventHubs/A.html#6b30e3aed0afd5c8" class="i method">CreateWithManagedIdentity</a>(
                <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r19 r">fullyQualifiedNamespace</span>),
                <span class="r20 r">eventHubName</span>);
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
            <span class="r21 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5046dbe0542f18d7" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PublishWithAutomaticRouting</a>()
        {
            <b>await using</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="k">var</a> <span id="r22 rd" class="r22 r">scope</span> = <b>await</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="t t">EventHubScope</a>.<a href="../Infrastructure/EventHubScope.cs.html#fc500ef8b0ed81bf" class="i method">CreateAsync</a>(1);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_PublishWithAutomaticRouting
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r23 rd" class="r23 r">connectionString</span> = <span class="s">&quot;&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r24 rd" class="r24 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r23 r">connectionString</span> = <a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>;
            <span class="c">/*@@*/</span> <span class="r24 r">eventHubName</span> = <span class="r22 r">scope</span>.<a href="../Infrastructure/EventHubScope.cs.html#8005a78a892ade08" class="i property">EventHubName</a>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="k">var</a> <span id="r25 rd" class="r25 r">builder</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#cf3f2e7ab687f745" class="t constructor">EventHubsConnectionStringBuilder</a>(<span class="r23 r">connectionString</span>);
            <span class="r25 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#07eaa0ed4c59a2a0" class="i property">EntityPath</a> = <span class="r24 r">eventHubName</span>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a> <span id="r26 rd" class="r26 r">client</span> = <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a>.<a href="/Microsoft.Azure.EventHubs/A.html#911ed71627886602" class="i method">CreateFromConnectionString</a>(<span class="r25 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#23287d656a851420" class="i method">ToString</a>());
 
            <b>try</b>
            {
                <b>using</b> <a href="/Microsoft.Azure.EventHubs/A.html#3d69be77480a8202" class="k">var</a> <span id="r27 rd" class="r27 r">eventBatch</span> = <span class="r26 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#a40fe0f28540fe99" class="i method">CreateBatch</a>();
 
                <b>for</b> (<a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r28 rd" class="r28 r">index</span> = 0; <span class="r28 r">index</span> &lt; 5; ++<span class="r28 r">index</span>)
                {
                    <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="k">var</a> <span id="r29 rd" class="r29 r">eventData</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#3aa4f8c652e34b36" class="t constructor">EventData</a>(<a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="s">$&quot;</span><span class="s">Event #</span>{ <span class="r28 r">index</span> }<span class="s">&quot;</span>));
 
                    <b>if</b> (!<span class="r27 r">eventBatch</span>.<a href="/Microsoft.Azure.EventHubs/A.html#ede06a89dff1d816" class="i method">TryAdd</a>(<span class="r29 r">eventData</span>))
                    {
                        <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<span class="s">$&quot;</span><span class="s">The event at </span>{ <span class="r28 r">index</span> }<span class="s"> could not be added</span><span class="s">&quot;</span>);
                    }
                }
 
                <b>await</b> <span class="r26 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#63a3c6109b409413" class="i method">SendAsync</a>(<span class="r27 r">eventBatch</span>);
            }
            <b>finally</b>
            {
                <span class="r26 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="cadd51ade6e02594" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PublishWithAPartitionKey</a>()
        {
            <b>await using</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="k">var</a> <span id="r30 rd" class="r30 r">scope</span> = <b>await</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="t t">EventHubScope</a>.<a href="../Infrastructure/EventHubScope.cs.html#fc500ef8b0ed81bf" class="i method">CreateAsync</a>(1);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_PublishWithAPartitionKey
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r31 rd" class="r31 r">connectionString</span> = <span class="s">&quot;&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r32 rd" class="r32 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r31 r">connectionString</span> = <a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>;
            <span class="c">/*@@*/</span> <span class="r32 r">eventHubName</span> = <span class="r30 r">scope</span>.<a href="../Infrastructure/EventHubScope.cs.html#8005a78a892ade08" class="i property">EventHubName</a>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="k">var</a> <span id="r33 rd" class="r33 r">builder</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#cf3f2e7ab687f745" class="t constructor">EventHubsConnectionStringBuilder</a>(<span class="r31 r">connectionString</span>);
            <span class="r33 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#07eaa0ed4c59a2a0" class="i property">EntityPath</a> = <span class="r32 r">eventHubName</span>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a> <span id="r34 rd" class="r34 r">client</span> = <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a>.<a href="/Microsoft.Azure.EventHubs/A.html#911ed71627886602" class="i method">CreateFromConnectionString</a>(<span class="r33 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#23287d656a851420" class="i method">ToString</a>());
 
            <b>try</b>
            {
                <a href="/Microsoft.Azure.EventHubs/A.html#c6675183874cbefc" class="k">var</a> <span id="r35 rd" class="r35 r">batchOptions</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#095e126fd63e88bd" class="t constructor">BatchOptions</a>
                {
                    <a href="/Microsoft.Azure.EventHubs/A.html#bf2a27c161dfaf08" class="i property">PartitionKey</a> = <span class="s">&quot;Any Value Will Do...&quot;</span>
                };
 
                <b>using</b> <a href="/Microsoft.Azure.EventHubs/A.html#3d69be77480a8202" class="k">var</a> <span id="r36 rd" class="r36 r">eventBatch</span> = <span class="r34 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#98de05ec03d13db4" class="i method">CreateBatch</a>(<span class="r35 r">batchOptions</span>);
 
                <b>for</b> (<a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r37 rd" class="r37 r">index</span> = 0; <span class="r37 r">index</span> &lt; 5; ++<span class="r37 r">index</span>)
                {
                    <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="k">var</a> <span id="r38 rd" class="r38 r">eventData</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#3aa4f8c652e34b36" class="t constructor">EventData</a>(<a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="s">$&quot;</span><span class="s">Event #</span>{ <span class="r37 r">index</span> }<span class="s">&quot;</span>));
 
                    <b>if</b> (!<span class="r36 r">eventBatch</span>.<a href="/Microsoft.Azure.EventHubs/A.html#ede06a89dff1d816" class="i method">TryAdd</a>(<span class="r38 r">eventData</span>))
                    {
                        <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<span class="s">$&quot;</span><span class="s">The event at </span>{ <span class="r37 r">index</span> }<span class="s"> could not be added</span><span class="s">&quot;</span>);
                    }
                }
 
                <b>await</b> <span class="r34 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#63a3c6109b409413" class="i method">SendAsync</a>(<span class="r36 r">eventBatch</span>);
            }
            <b>finally</b>
            {
                <span class="r34 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f27643d1a20c5e16" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PublishToSpecificPartition</a>()
        {
            <b>await using</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="k">var</a> <span id="r39 rd" class="r39 r">scope</span> = <b>await</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="t t">EventHubScope</a>.<a href="../Infrastructure/EventHubScope.cs.html#fc500ef8b0ed81bf" class="i method">CreateAsync</a>(1);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_PublishToSpecificPartition
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r40 rd" class="r40 r">connectionString</span> = <span class="s">&quot;&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r41 rd" class="r41 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r40 r">connectionString</span> = <a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>;
            <span class="c">/*@@*/</span> <span class="r41 r">eventHubName</span> = <span class="r39 r">scope</span>.<a href="../Infrastructure/EventHubScope.cs.html#8005a78a892ade08" class="i property">EventHubName</a>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="k">var</a> <span id="r42 rd" class="r42 r">builder</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#cf3f2e7ab687f745" class="t constructor">EventHubsConnectionStringBuilder</a>(<span class="r40 r">connectionString</span>);
            <span class="r42 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#07eaa0ed4c59a2a0" class="i property">EntityPath</a> = <span class="r41 r">eventHubName</span>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a> <span id="r43 rd" class="r43 r">client</span> = <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a>.<a href="/Microsoft.Azure.EventHubs/A.html#911ed71627886602" class="i method">CreateFromConnectionString</a>(<span class="r42 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#23287d656a851420" class="i method">ToString</a>());
            <a href="/Microsoft.Azure.EventHubs/A.html#8b49c497c5b6a804" class="t t">PartitionSender</a> <span id="r44 rd" class="r44 r">sender</span> = <b>default</b>;
 
            <b>try</b>
            {
                <b>using</b> <a href="/Microsoft.Azure.EventHubs/A.html#3d69be77480a8202" class="k">var</a> <span id="r45 rd" class="r45 r">eventBatch</span> = <span class="r43 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#a40fe0f28540fe99" class="i method">CreateBatch</a>();
 
                <b>for</b> (<a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r46 rd" class="r46 r">index</span> = 0; <span class="r46 r">index</span> &lt; 5; ++<span class="r46 r">index</span>)
                {
                    <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="k">var</a> <span id="r47 rd" class="r47 r">eventData</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#3aa4f8c652e34b36" class="t constructor">EventData</a>(<a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="s">$&quot;</span><span class="s">Event #</span>{ <span class="r46 r">index</span> }<span class="s">&quot;</span>));
 
                    <b>if</b> (!<span class="r45 r">eventBatch</span>.<a href="/Microsoft.Azure.EventHubs/A.html#ede06a89dff1d816" class="i method">TryAdd</a>(<span class="r47 r">eventData</span>))
                    {
                        <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#df2d82d91ca29e40" class="t constructor">Exception</a>(<span class="s">$&quot;</span><span class="s">The event at </span>{ <span class="r46 r">index</span> }<span class="s"> could not be added</span><span class="s">&quot;</span>);
                    }
                }
 
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r48 rd" class="r48 r">firstPartition</span> = (<b>await</b> <span class="r43 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#c54802e92c6bcf7a" class="i method">GetRuntimeInformationAsync</a>()).<a href="/Microsoft.Azure.EventHubs/A.html#6f7d55289e44ee46" class="i property">PartitionIds</a>.<a href="@0@System.Core/A.html#bc8ae402a61dd9d6" class="i method">First</a>();
                <span class="r44 r">sender</span> = <span class="r43 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#a34202db42c39c02" class="i method">CreatePartitionSender</a>(<span class="r48 r">firstPartition</span>);
 
                <b>await</b> <span class="r44 r">sender</span>.<a href="/Microsoft.Azure.EventHubs/A.html#4f6d5d8a0ab5027c" class="i method">SendAsync</a>(<span class="r45 r">eventBatch</span>);
            }
            <b>finally</b>
            {
                <span class="r44 r">sender</span>?.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
                <span class="r43 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a4862af4855465db" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ReadFromSpecificPartition</a>()
        {
            <b>await using</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="k">var</a> <span id="r49 rd" class="r49 r">scope</span> = <b>await</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="t t">EventHubScope</a>.<a href="../Infrastructure/EventHubScope.cs.html#fc500ef8b0ed81bf" class="i method">CreateAsync</a>(1);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_ReadFromSpecificPartition
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r50 rd" class="r50 r">connectionString</span> = <span class="s">&quot;&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r51 rd" class="r51 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r52 rd" class="r52 r">consumerGroup</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB CONSUMER GROUP &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r50 r">connectionString</span> = <a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>;
            <span class="c">/*@@*/</span> <span class="r51 r">eventHubName</span> = <span class="r49 r">scope</span>.<a href="../Infrastructure/EventHubScope.cs.html#8005a78a892ade08" class="i property">EventHubName</a>;
            <span class="c">/*@@*/</span> <span class="r52 r">consumerGroup</span> = <a href="/Microsoft.Azure.EventHubs/A.html#c6301acd46b0811a" class="t t">PartitionReceiver</a>.<a href="/Microsoft.Azure.EventHubs/A.html#12f64878a4e0638b" class="i field">DefaultConsumerGroupName</a>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="k">var</a> <span id="r53 rd" class="r53 r">builder</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#cf3f2e7ab687f745" class="t constructor">EventHubsConnectionStringBuilder</a>(<span class="r50 r">connectionString</span>);
            <span class="r53 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#07eaa0ed4c59a2a0" class="i property">EntityPath</a> = <span class="r51 r">eventHubName</span>;
 
            <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a> <span id="r54 rd" class="r54 r">client</span> = <a href="/Microsoft.Azure.EventHubs/A.html#ef11bbb905992f88" class="t t">EventHubClient</a>.<a href="/Microsoft.Azure.EventHubs/A.html#911ed71627886602" class="i method">CreateFromConnectionString</a>(<span class="r53 r">builder</span>.<a href="/Microsoft.Azure.EventHubs/A.html#23287d656a851420" class="i method">ToString</a>());
            <a href="/Microsoft.Azure.EventHubs/A.html#c6301acd46b0811a" class="t t">PartitionReceiver</a> <span id="r55 rd" class="r55 r">receiver</span> = <b>default</b>;
 
            <b>try</b>
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r56 rd" class="r56 r">firstPartition</span> = (<b>await</b> <span class="r54 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#c54802e92c6bcf7a" class="i method">GetRuntimeInformationAsync</a>()).<a href="/Microsoft.Azure.EventHubs/A.html#6f7d55289e44ee46" class="i property">PartitionIds</a>.<a href="@0@System.Core/A.html#bc8ae402a61dd9d6" class="i method">First</a>();
                <span class="r55 r">receiver</span> = <span class="r54 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#de3b024c736874a2" class="i method">CreateReceiver</a>(<span class="r52 r">consumerGroup</span>, <span class="r56 r">firstPartition</span>, <a href="/Microsoft.Azure.EventHubs/A.html#5c55f1ce5bfdf68d" class="t t">EventPosition</a>.<a href="/Microsoft.Azure.EventHubs/A.html#1869cec8b62a47a2" class="i method">FromStart</a>());
 
                <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r57 rd" class="r57 r">events</span> = <b>await</b> <span class="r55 r">receiver</span>.<a href="/Microsoft.Azure.EventHubs/A.html#bb31ba9a4e2f93c1" class="i method">ReceiveAsync</a>(50);
 
                <b>foreach</b> (<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="k">var</a> <span id="r58 rd" class="r58 r">eventData</span> <b>in</b> <span class="r57 r">events</span>)
                {
                   <a href="@0@System/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@0@System/A.html#73de7bb60da320d3" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">Read event of length </span>{ <span class="r58 r">eventData</span>.<a href="/Microsoft.Azure.EventHubs/A.html#aff06bbfd9de811f" class="i property">Body</a>.<a href="@0@mscorlib/A.html#055f74de6571072a" class="i property">Count</a> }<span class="s"> from </span>{ <span class="r56 r">firstPartition</span> }<span class="s">&quot;</span>);
                }
            }
            <b>finally</b>
            {
                <span class="r55 r">receiver</span>?.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
                <span class="r54 r">client</span>.<a href="/Microsoft.Azure.EventHubs/A.html#e9728c4d03d8aef6" class="i method">Close</a>();
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="../Infrastructure/LiveTestAttribute.cs.html#8cfc2123769fcc29" class="t constructor">LiveTest</a>]
        [<a href="../Infrastructure/DisplayTestMethodNameAttribute.cs.html#9e80cd3901e2973d" class="t constructor">DisplayTestMethodName</a>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="21ff70cd8cda2cd5" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">BasicEventProcessorHost</a>()
        {
            <b>await using</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="k">var</a> <span id="r59 rd" class="r59 r">scope</span> = <b>await</b> <a href="../Infrastructure/EventHubScope.cs.html#4c9b7b58ec842865" class="t t">EventHubScope</a>.<a href="../Infrastructure/EventHubScope.cs.html#fc500ef8b0ed81bf" class="i method">CreateAsync</a>(1);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_BasicEventProcessorHost
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r60 rd" class="r60 r">storageConnectionString</span> = <span class="s">&quot;&lt;&lt; CONNECTION STRING FOR THE STORAGE ACCOUNT &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r61 rd" class="r61 r">blobContainerName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE BLOB CONTAINER &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r60 r">storageConnectionString</span> = <a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#b7dd237a63720ea2" class="i property">StorageConnectionString</a>;
            <span class="c">/*@@*/</span> <span class="r61 r">blobContainerName</span> = <span class="s">&quot;migragionsample&quot;</span>;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r62 rd" class="r62 r">eventHubsConnectionString</span> = <span class="s">&quot;&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r63 rd" class="r63 r">eventHubName</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;&quot;</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r64 rd" class="r64 r">consumerGroup</span> = <span class="s">&quot;&lt;&lt; NAME OF THE EVENT HUB CONSUMER GROUP &gt;&gt;&quot;</span>;
            <span class="c">/*@@*/</span>
            <span class="c">/*@@*/</span> <span class="r62 r">eventHubsConnectionString</span> = <a href="../Infrastructure/TestUtility.cs.html#1718c2e5884a4c76" class="t t">TestUtility</a>.<a href="../Infrastructure/TestUtility.cs.html#cfc64c00a99ba68c" class="i property">EventHubsConnectionString</a>;
            <span class="c">/*@@*/</span> <span class="r63 r">eventHubName</span> = <span class="r59 r">scope</span>.<a href="../Infrastructure/EventHubScope.cs.html#8005a78a892ade08" class="i property">EventHubName</a>;
            <span class="c">/*@@*/</span> <span class="r64 r">consumerGroup</span> = <a href="/Microsoft.Azure.EventHubs/A.html#c6301acd46b0811a" class="t t">PartitionReceiver</a>.<a href="/Microsoft.Azure.EventHubs/A.html#12f64878a4e0638b" class="i field">DefaultConsumerGroupName</a>;
 
            <a href="/Microsoft.Azure.EventHubs.Processor/A.html#ec134749c5d2bd58" class="k">var</a> <span id="r65 rd" class="r65 r">eventProcessorHost</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs.Processor/A.html#713f50f2a8de09cf" class="t constructor">EventProcessorHost</a>(
                <span class="r63 r">eventHubName</span>,
                <span class="r64 r">consumerGroup</span>,
                <span class="r62 r">eventHubsConnectionString</span>,
                <span class="r60 r">storageConnectionString</span>,
                <span class="r61 r">blobContainerName</span>);
 
            <b>try</b>
            {
                <span class="c">// Registering the processor class will also signal the</span>
                <span class="c">// host to begin processing events.</span>
 
                <b>await</b> <span class="r65 r">eventProcessorHost</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#3ab057f1de18d30e" class="i method">RegisterEventProcessorAsync</a>&lt;<a href="#ce7d79848d494a4d" class="t t">SimpleEventProcessor</a>&gt;();
 
                <span class="c">// The processor runs in the background, to allow it to process,</span>
                <span class="c">// this example will wait for 30 seconds and then trigger</span>
                <span class="c">// cancellation.</span>
 
                <b>using</b> <a href="@0@mscorlib/A.html#130a9536ac96b392" class="k">var</a> <span id="r66 rd" class="r66 r">cancellationSource</span> = <b>new</b> <a href="@0@mscorlib/A.html#0fd973cb6741d972" class="t constructor">CancellationTokenSource</a>();
                <span class="r66 r">cancellationSource</span>.<a href="@0@mscorlib/A.html#70756b542df0e802" class="i method">CancelAfter</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(30));
 
                <b>await</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#5fb80297e082b8d6" class="i method">Delay</a>(<a href="@0@mscorlib/A.html#6b53654d3452a8df" class="t t">Timeout</a>.<a href="@0@mscorlib/A.html#17ac04506b89ddd8" class="i field">Infinite</a>, <span class="r66 r">cancellationSource</span>.<a href="@0@mscorlib/A.html#9e22b9c8995bf195" class="i property">Token</a>);
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#30edb7a318d221fa" class="t t">TaskCanceledException</a>)
            {
                <span class="c">// This is expected when the cancellation token is</span>
                <span class="c">// signaled.</span>
            }
            <b>finally</b>
            {
                <span class="c">// Unregistering the processor class will signal the</span>
                <span class="c">// host to stop processing.</span>
 
                <b>await</b> <span class="r65 r">eventProcessorHost</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#1f377a441ff53bc7" class="i method">UnregisterEventProcessorAsync</a>();
            }
 
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:EventHubs_Migrate_T1_SimpleEventProcessor
 
    <b>public class</b> <a id="ce7d79848d494a4d" href="../R/ce7d79848d494a4d.html" target="n" data-glyph="0,0" class="t t"><span id="b802cdb4e6c96f67">SimpleEventProcessor</span></a> : <a href="/Microsoft.Azure.EventHubs.Processor/A.html#7062f369be53b4b4" class="t t">IEventProcessor</a>
    {
        <b>public</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="dc2af8b9ed0303cf" href="../R/dc2af8b9ed0303cf.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r67 rd" class="r67 r">context</span>, <a href="/Microsoft.Azure.EventHubs.Processor/A.html#b558f2f6b81c2c26" class="t t">CloseReason</a> <span id="r68 rd" class="r68 r">reason</span>)
        {
             <a href="@0@System/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@0@System/A.html#73de7bb60da320d3" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">Partition &#39;</span>{<span class="r67 r">context</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#e15eccbcf35c2384" class="i property">PartitionId</a>}<span class="s">&#39; is closing.</span><span class="s">&quot;</span>);
             <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>public</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="8d382723f2ae32d0" href="../R/8d382723f2ae32d0.html" target="n" data-glyph="72,1" class="i method">OpenAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r69 rd" class="r69 r">context</span>)
        {
            <a href="@0@System/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@0@System/A.html#73de7bb60da320d3" class="i method">WriteLine</a>(<span class="s">$&quot;</span><span class="s">Partition: &#39;</span>{<span class="r69 r">context</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#e15eccbcf35c2384" class="i property">PartitionId</a>}<span class="s">&#39; was initialized.</span><span class="s">&quot;</span>);
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>public</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7106f762b9ca46d4" href="../R/7106f762b9ca46d4.html" target="n" data-glyph="72,1" class="i method">ProcessErrorAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r70 rd" class="r70 r">context</span>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r71 rd" class="r71 r">error</span>)
        {
            <a href="@0@System/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@0@System/A.html#73de7bb60da320d3" class="i method">WriteLine</a>(
                <span class="s">$&quot;</span><span class="s">Error for partition: </span>{<span class="r70 r">context</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#e15eccbcf35c2384" class="i property">PartitionId</a>}<span class="s">, </span><span class="s">&quot;</span> +
                <span class="s">$&quot;</span><span class="s">Error: </span>{<span class="r71 r">error</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>}<span class="s">&quot;</span>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>public</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="f508393d2d2a674e" href="../R/f508393d2d2a674e.html" target="n" data-glyph="72,1" class="i method">ProcessEventsAsync</a>(<a href="/Microsoft.Azure.EventHubs.Processor/A.html#c380694dc3e40146" class="t t">PartitionContext</a> <span id="r72 rd" class="r72 r">context</span>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r73 rd" class="r73 r">messages</span>)
        {
            <b>foreach</b> (<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="k">var</a> <span id="r74 rd" class="r74 r">eventData</span> <b>in</b> <span class="r73 r">messages</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r75 rd" class="r75 r">data</span> = <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#233647d04fbec0c0" class="i method">GetString</a>(
                    <span class="r74 r">eventData</span>.<a href="/Microsoft.Azure.EventHubs/A.html#aff06bbfd9de811f" class="i property">Body</a>.<a href="@0@mscorlib/A.html#83b929c568ebc4d4" class="i property">Array</a>,
                    <span class="r74 r">eventData</span>.<a href="/Microsoft.Azure.EventHubs/A.html#aff06bbfd9de811f" class="i property">Body</a>.<a href="@0@mscorlib/A.html#d75349bb4a45cfec" class="i property">Offset</a>,
                    <span class="r74 r">eventData</span>.<a href="/Microsoft.Azure.EventHubs/A.html#aff06bbfd9de811f" class="i property">Body</a>.<a href="@0@mscorlib/A.html#055f74de6571072a" class="i property">Count</a>);
 
                <a href="@0@System/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@0@System/A.html#73de7bb60da320d3" class="i method">WriteLine</a>(
                    <span class="s">$&quot;</span><span class="s">Event received for partition: &#39;</span>{<span class="r72 r">context</span>.<a href="/Microsoft.Azure.EventHubs.Processor/A.html#e15eccbcf35c2384" class="i property">PartitionId</a>}<span class="s">&#39;, </span><span class="s">&quot;</span> +
                    <span class="s">$&quot;</span><span class="s">Data: &#39;</span>{<span class="r75 r">data</span>}<span class="s">&#39;</span><span class="s">&quot;</span>);
            }
 
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
}
</pre></td></tr></table></div></body></html>
