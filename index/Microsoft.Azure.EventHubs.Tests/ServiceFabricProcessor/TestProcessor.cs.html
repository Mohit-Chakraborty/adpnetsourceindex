<!DOCTYPE html>
<html><head><title>TestProcessor.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(199);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Tests/ServiceFabricProcessor/TestProcessor.cs" target="_top">ServiceFabricProcessor\TestProcessor.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.EventHubs.Tests" target="_top">Microsoft.Azure.EventHubs.Tests.csproj</a> (Microsoft.Azure.EventHubs.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// Licensed under the MIT license. See LICENSE file in the project root for full license information.</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">Tests</span>.<span class="i n">ServiceFabricProcessor</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">ServiceFabricProcessor</span>;
    <b>using</b> <span class="i">Xunit</span>;
 
    <b>public class</b> <a id="de78b670c747c700" href="../R/de78b670c747c700.html" target="n" data-glyph="0,0" class="t t">TestProcessor</a> : <a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#e56915915feb4fed" class="t t">IEventProcessor</a>
    {
        <b>private string</b> <a id="5044b39ea6489f30" href="../R/5044b39ea6489f30.html" target="n" data-glyph="46,1" class="i field">partitionId</a>;
        <b>private string</b> <a id="7063f962ae220d0e" href="../R/7063f962ae220d0e.html" target="n" data-glyph="46,1" class="i field">eventHub</a>;
        <b>private string</b> <a id="9e6dc75c2622ab93" href="../R/9e6dc75c2622ab93.html" target="n" data-glyph="46,1" class="i field">consumerGroup</a>;
 
        <b>private readonly</b> <a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#99ecb9feab823adf" class="t t">EventProcessorOptions</a> <a id="449e499549def0e4" href="../R/449e499549def0e4.html" target="n" data-glyph="46,1" class="i field">options</a>;
 
        <b>public enum</b> <a id="ee20558e2e2a3396" href="../R/ee20558e2e2a3396.html" target="n" data-glyph="18,1" class="t t"><span id="a5b3a267481a5ee2">ErrorLocation</span></a> { <a id="91821cbc49cf2b0e" href="../R/91821cbc49cf2b0e.html" target="n" data-glyph="24,2" class="i field">OnOpen</a>, <a id="6a6ef6dab360a3e7" href="../R/6a6ef6dab360a3e7.html" target="n" data-glyph="24,2" class="i field">OnEvents</a>, <a id="26104ec93bf91b1d" href="../R/26104ec93bf91b1d.html" target="n" data-glyph="24,2" class="i field">OnError</a>, <a id="bbd79e0204f81439" href="../R/bbd79e0204f81439.html" target="n" data-glyph="24,2" class="i field">OnClose</a> };
 
        <b>public</b> <a id="26d80cac0f2ebcf0" href="../R/26d80cac0f2ebcf0.html" target="n" data-glyph="72,1" class="t constructor">TestProcessor</a>(<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#99ecb9feab823adf" class="t t">EventProcessorOptions</a> <span id="r0 rd" class="r0 r">options</span>)
        {
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#36d16d9d9cfba05f" class="i property">Injector</a> = <b>null</b>;
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#a0c208281da648e8" class="i property">IsOpened</a> = <b>false</b>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#e1e1393b73db2907" class="i property">IsClosed</a> = <b>false</b>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#ff8ece59b1deb638" class="i property">TotalBatches</a> = 0;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#0b601622fe474794" class="i property">LastBatchEvents</a> = -1;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#d844e8d172a0e064" class="i property">TotalEvents</a> = 0;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#b393f46214cf9b90" class="i property">LastError</a> = <b>null</b>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#bf9349f3853ec43b" class="i property">FirstEvent</a> = <b>null</b>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#b656bc43a74b5b8e" class="i property">LastEvent</a> = <b>null</b>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#4f27e140c6ff301d" class="i property">TotalErrors</a> = 0;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#9bfaa42151ab6eec" class="i property">LatestContext</a> = <b>null</b>;
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#449e499549def0e4" class="i field">options</a> = <span class="r0 r">options</span>;
        }
 
        <b>public</b> <a href="#7f5b6b97f46c63cf" class="t t">ErrorInjector</a> <a id="36d16d9d9cfba05f" href="../R/36d16d9d9cfba05f.html" target="n" data-glyph="102,1" class="i property">Injector</a> { <b>get</b>; <b>set</b>; }
 
        <b>public bool</b> <a id="a0c208281da648e8" href="../R/a0c208281da648e8.html" target="n" data-glyph="102,1" class="i property">IsOpened</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public bool</b> <a id="e1e1393b73db2907" href="../R/e1e1393b73db2907.html" target="n" data-glyph="102,1" class="i property">IsClosed</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public int</b> <a id="ff8ece59b1deb638" href="../R/ff8ece59b1deb638.html" target="n" data-glyph="102,1" class="i property">TotalBatches</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public int</b> <a id="0b601622fe474794" href="../R/0b601622fe474794.html" target="n" data-glyph="102,1" class="i property">LastBatchEvents</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public int</b> <a id="d844e8d172a0e064" href="../R/d844e8d172a0e064.html" target="n" data-glyph="102,1" class="i property">TotalEvents</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public</b> <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <a id="b393f46214cf9b90" href="../R/b393f46214cf9b90.html" target="n" data-glyph="102,1" class="i property">LastError</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public</b> <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a> <a id="bf9349f3853ec43b" href="../R/bf9349f3853ec43b.html" target="n" data-glyph="102,1" class="i property">FirstEvent</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public</b> <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a> <a id="b656bc43a74b5b8e" href="../R/b656bc43a74b5b8e.html" target="n" data-glyph="102,1" class="i property">LastEvent</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public int</b> <a id="4f27e140c6ff301d" href="../R/4f27e140c6ff301d.html" target="n" data-glyph="102,1" class="i property">TotalErrors</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public</b> <a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#1a49dc0b2da9fcb8" class="t t">PartitionContext</a> <a id="9bfaa42151ab6eec" href="../R/9bfaa42151ab6eec.html" target="n" data-glyph="102,1" class="i property">LatestContext</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public override</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="e01bc789b120154a" href="../R/e01bc789b120154a.html" target="n" data-glyph="72,1" class="i method">CloseAsync</a>(<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#1a49dc0b2da9fcb8" class="t t">PartitionContext</a> <span id="r1 rd" class="r1 r">context</span>, <a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#214d5ae440ddfe86" class="t t">CloseReason</a> <span id="r2 rd" class="r2 r">reason</span>)
        {
            <span class="i">Assert</span>.<span class="i">True</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#a0c208281da648e8" class="i property">IsOpened</a>, <span class="s">&quot;Closing when not opened&quot;</span>); <span class="c">// open MUST come before close</span>
            <span class="i">Assert</span>.<span class="i">False</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#e1e1393b73db2907" class="i property">IsClosed</a>, <span class="s">&quot;Double close&quot;</span>); <span class="c">// close MUST NOT be called multiple times</span>
 
            <a href="#57fd158b88c3f65f" class="i method">ValidateContext</a>(<span class="r1 r">context</span>);
            <span class="c">// reason is an enum, can&#39;t be invalid</span>
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#36d16d9d9cfba05f" class="i property">Injector</a>?.<a href="#dbe99cd5f165e159" class="i method">Inject</a>(<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a>.<a href="#bbd79e0204f81439" class="i field">OnClose</a>);
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#e1e1393b73db2907" class="i property">IsClosed</a> = <b>true</b>;
 
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>public override</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a762e02a3bb2d62a" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">OpenAsync</a>(<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r3 rd" class="r3 r">cancellationToken</span>, <a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#1a49dc0b2da9fcb8" class="t t">PartitionContext</a> <span id="r4 rd" class="r4 r">context</span>)
        {
            <span class="i">Assert</span>.<span class="i">False</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#a0c208281da648e8" class="i property">IsOpened</a>, <span class="s">&quot;Double open&quot;</span>); <span class="c">// open MUST NOT be called multiple times</span>
            <span class="i">Assert</span>.<span class="i">False</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#e1e1393b73db2907" class="i property">IsClosed</a>, <span class="s">&quot;Open after close&quot;</span>); <span class="c">// open MUST NOT be called on a closed object</span>
 
            <span class="c">// cancellationToken is value type, can&#39;t be null</span>
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r4 r">context</span>);
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#9bfaa42151ab6eec" class="i property">LatestContext</a> = <span class="r4 r">context</span>;
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#36d16d9d9cfba05f" class="i property">Injector</a>?.<a href="#dbe99cd5f165e159" class="i method">Inject</a>(<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a>.<a href="#91821cbc49cf2b0e" class="i field">OnOpen</a>);
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#a0c208281da648e8" class="i property">IsOpened</a> = <b>true</b>;
 
            <span class="c">// set up for later validation</span>
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#5044b39ea6489f30" class="i field">partitionId</a> = <span class="r4 r">context</span>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#103246bc5457d1b2" class="i property">PartitionId</a>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#7063f962ae220d0e" class="i field">eventHub</a> = <span class="r4 r">context</span>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#eb53ce0d97f79f0d" class="i property">EventHubPath</a>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#9e6dc75c2622ab93" class="i field">consumerGroup</a> = <span class="r4 r">context</span>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#536c5f39984fdc92" class="i property">ConsumerGroupName</a>;
 
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>public override</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="7c3a15f7efa26385" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ProcessErrorAsync</a>(<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#1a49dc0b2da9fcb8" class="t t">PartitionContext</a> <span id="r5 rd" class="r5 r">context</span>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r6 rd" class="r6 r">error</span>)
        {
            <span class="i">Assert</span>.<span class="i">True</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#a0c208281da648e8" class="i property">IsOpened</a>, <span class="s">&quot;ProcessError when not open&quot;</span>); <span class="c">// object MUST be open</span>
            <span class="i">Assert</span>.<span class="i">False</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#e1e1393b73db2907" class="i property">IsClosed</a>, <span class="s">&quot;ProcessError after close&quot;</span>); <span class="c">// object MUST NOT be closed</span>
 
            <a href="#57fd158b88c3f65f" class="i method">ValidateContext</a>(<span class="r5 r">context</span>);
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r6 r">error</span>);
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#b393f46214cf9b90" class="i property">LastError</a> = <span class="r6 r">error</span>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#4f27e140c6ff301d" class="i property">TotalErrors</a>++;
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#36d16d9d9cfba05f" class="i property">Injector</a>?.<a href="#dbe99cd5f165e159" class="i method">Inject</a>(<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a>.<a href="#26104ec93bf91b1d" class="i field">OnError</a>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>public override</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="31a19142ff8b09ed" href="../R/31a19142ff8b09ed.html" target="n" data-glyph="72,1" class="i method">ProcessEventsAsync</a>(<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r7 rd" class="r7 r">cancellationToken</span>, <a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#1a49dc0b2da9fcb8" class="t t">PartitionContext</a> <span id="r8 rd" class="r8 r">context</span>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r9 rd" class="r9 r">events</span>)
        {
            <span class="i">Assert</span>.<span class="i">True</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#a0c208281da648e8" class="i property">IsOpened</a>, <span class="s">&quot;ProcessEvents when not open&quot;</span>); <span class="c">// object MUST be open to process</span>
            <span class="i">Assert</span>.<span class="i">False</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#e1e1393b73db2907" class="i property">IsClosed</a>, <span class="s">&quot;ProcessEvents after close&quot;</span>); <span class="c">// object MUST NOT be closed when processing</span>
 
            <span class="c">// cancellationToken is value type, can&#39;t be null</span>
            <a href="#57fd158b88c3f65f" class="i method">ValidateContext</a>(<span class="r8 r">context</span>);
            <a href="#ac758ee9ff10a9a2" class="i method">CountAndValidateBatch</a>(<span class="r9 r">events</span>);
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#36d16d9d9cfba05f" class="i property">Injector</a>?.<a href="#dbe99cd5f165e159" class="i method">Inject</a>(<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a>.<a href="#6a6ef6dab360a3e7" class="i field">OnEvents</a>);
 
            <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
        }
 
        <b>private void</b> <a id="57fd158b88c3f65f" href="../R/57fd158b88c3f65f.html" target="n" data-glyph="76,1" class="i method">ValidateContext</a>(<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#1a49dc0b2da9fcb8" class="t t">PartitionContext</a> <span id="r10 rd" class="r10 r">context</span>)
        {
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r10 r">context</span>);
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#9bfaa42151ab6eec" class="i property">LatestContext</a> = <span class="r10 r">context</span>;
 
            <span class="c">// A given processor instance MUST always process the same hub+cg+partition.</span>
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#5044b39ea6489f30" class="i field">partitionId</a>, <span class="r10 r">context</span>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#103246bc5457d1b2" class="i property">PartitionId</a>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#7063f962ae220d0e" class="i field">eventHub</a>, <span class="r10 r">context</span>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#eb53ce0d97f79f0d" class="i property">EventHubPath</a>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#de78b670c747c700" class="k">this</a>.<a href="#9e6dc75c2622ab93" class="i field">consumerGroup</a>, <span class="r10 r">context</span>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#536c5f39984fdc92" class="i property">ConsumerGroupName</a>);
        }
 
        <b>private void</b> <a id="ac758ee9ff10a9a2" href="../R/ac758ee9ff10a9a2.html" target="n" data-glyph="76,1" class="i method">CountAndValidateBatch</a>(<a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r11 rd" class="r11 r">events</span>)
        {
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r11 r">events</span>); <span class="c">// events MUST NOT be null -- empty can be valid, but null is a bug</span>
 
            <b>int</b> <span id="r12 rd" class="r12 r">count</span> = 0;
            <b>foreach</b> (<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a> <span id="r13 rd" class="r13 r">e</span> <b>in</b> <span class="r11 r">events</span>)
            {
                <b>if</b> (<a href="#de78b670c747c700" class="k">this</a>.<a href="#bf9349f3853ec43b" class="i property">FirstEvent</a> == <b>null</b>)
                {
                    <a href="#de78b670c747c700" class="k">this</a>.<a href="#bf9349f3853ec43b" class="i property">FirstEvent</a> = <span class="r13 r">e</span>;
                }
                <a href="#de78b670c747c700" class="k">this</a>.<a href="#b656bc43a74b5b8e" class="i property">LastEvent</a> = <span class="r13 r">e</span>;
                <span class="r12 r">count</span>++;
            }
 
            <span class="i">Assert</span>.<span class="i">True</span>(<span class="r12 r">count</span> &lt;= <a href="#de78b670c747c700" class="k">this</a>.<a href="#449e499549def0e4" class="i field">options</a>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#4458ab71cae449a4" class="i property">MaxBatchSize</a>, <span class="s">&quot;Batch too large&quot;</span>); <span class="c">// batch MUST NOT exceed user-set batch size</span>
            <b>if</b> (<a href="#de78b670c747c700" class="k">this</a>.<a href="#449e499549def0e4" class="i field">options</a>.<a href="/Microsoft.Azure.EventHubs.ServiceFabricProcessor/A.html#9ec549ff063eba68" class="i property">InvokeProcessorAfterReceiveTimeout</a>)
            {
                <span class="c">// count can only be 0 if options are set to call processor on receive timeout</span>
                <span class="i">Assert</span>.<span class="i">True</span>(<span class="r12 r">count</span> &gt;= 0, <span class="s">&quot;Batch less than 0&quot;</span>);
            }
            <b>else</b>
            {
                <span class="i">Assert</span>.<span class="i">True</span>(<span class="r12 r">count</span> &gt;= 1, <span class="s">&quot;Batch less than 1&quot;</span>); <span class="c">// otherwise, batch MUST contain at least one event</span>
            }
 
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#0b601622fe474794" class="i property">LastBatchEvents</a> = <span class="r12 r">count</span>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#d844e8d172a0e064" class="i property">TotalEvents</a> += <span class="r12 r">count</span>;
            <a href="#de78b670c747c700" class="k">this</a>.<a href="#ff8ece59b1deb638" class="i property">TotalBatches</a>++;
        }
 
        <b>public class</b> <a id="7f5b6b97f46c63cf" href="../R/7f5b6b97f46c63cf.html" target="n" data-glyph="0,1" class="t t">ErrorInjector</a>
        {
            <b>protected readonly</b> <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a>&gt; <a id="09cb998327f05556" href="../R/09cb998327f05556.html" target="n" data-glyph="45,2" class="i field">locations</a>;
            <b>protected readonly</b> <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <a id="d98ebb97a4415d56" href="../R/d98ebb97a4415d56.html" target="n" data-glyph="45,2" class="i field">error</a>;
 
            <b>internal</b> <a id="bd02fa72319679eb" href="../R/bd02fa72319679eb.html" target="n" data-glyph="74,2" class="t constructor">ErrorInjector</a>(<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a> <span id="r14 rd" class="r14 r">errorAt</span>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r15 rd" class="r15 r">error</span>)
            {
                <a href="#7f5b6b97f46c63cf" class="k">this</a>.<a href="#09cb998327f05556" class="i field">locations</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a>&gt;() { <span class="r14 r">errorAt</span> };
                <a href="#7f5b6b97f46c63cf" class="k">this</a>.<a href="#d98ebb97a4415d56" class="i field">error</a> = <span class="r15 r">error</span>;
            }
 
            <b>internal</b> <a id="aee669e9fea6ac24" href="../R/aee669e9fea6ac24.html" target="n" data-glyph="74,2" class="t constructor">ErrorInjector</a>(<a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a>&gt; <span id="r16 rd" class="r16 r">locations</span>, <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r17 rd" class="r17 r">error</span>)
            {
                <a href="#7f5b6b97f46c63cf" class="k">this</a>.<a href="#09cb998327f05556" class="i field">locations</a> = <span class="r16 r">locations</span>;
                <a href="#7f5b6b97f46c63cf" class="k">this</a>.<a href="#d98ebb97a4415d56" class="i field">error</a> = <span class="r17 r">error</span>;
            }
 
            <b>internal void</b> <a id="dbe99cd5f165e159" href="../R/dbe99cd5f165e159.html" target="n" data-glyph="74,2" class="i method">Inject</a>(<a href="#ee20558e2e2a3396" class="t t">ErrorLocation</a> <span id="r18 rd" class="r18 r">location</span>)
            {
                <b>if</b> (<a href="#7f5b6b97f46c63cf" class="k">this</a>.<a href="#09cb998327f05556" class="i field">locations</a>.<a href="@0@mscorlib/A.html#521b9f7129105e15" class="i method">Contains</a>(<span class="r18 r">location</span>))
                {
                    <b>throw</b> <a href="#7f5b6b97f46c63cf" class="k">this</a>.<a href="#d98ebb97a4415d56" class="i field">error</a>;
                }
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
