<!DOCTYPE html>
<html><head><title>LoggingExtensions.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(139);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Storage.Blobs/Shared/LoggingExtensions.cs" target="_top">Shared\LoggingExtensions.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Storage.Blobs" target="_top">Azure.Storage.Blobs.csproj</a> (Azure.Storage.Blobs)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>.<span class="i n">Headers</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">CompilerServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">ExceptionServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Web</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>
{
    <b>internal static class</b> <a id="a75e77af4027c5e2" href="../R/../../0000000000.html" target="n" data-glyph="2,0" class="t t">LoggingExtensions</a>
    {
        <span class="c">// The Azure.Core logging plan is still being settled, so we&#39;re adding</span>
        <span class="c">// [Condtional] extensions we can implement later to light up logging</span>
        <span class="c">// on par with the previous ILogger approach.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">IDE0060</span> <span class="c">// Remove unused parameter</span>
        <b>public static</b> <a href="@1@netstandard/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="5c6ad9b8db1bc018" href="../R/5c6ad9b8db1bc018.html" target="n" data-glyph="220,1" class="i method">BeginLoggingScope</a>(
            <b>this</b> <a href="/Azure.Core/A.html#ce2f2fae396f36c5" class="t t">HttpPipeline</a> <span id="r0 rd" class="r0 r">pipeline</span>,
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CA1801</span> <span class="c">// Review unused parameters</span>
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">className</span>,
            [<a href="@1@netstandard/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">member</span> = <b>default</b>)
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">CA1801</span> <span class="c">// Review unused parameters</span>
            <span class="c">// Methods that return values can&#39;t be marked [Conditional], but</span>
            <span class="c">// using statements will check for null before calling Dispose</span>
            =&gt; <b>null</b>;
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">IDE0060</span> <span class="c">// Remove unused parameter</span>
 
        [<a href="@1@netstandard/A.html#2cde19ac63a3b25e" class="t constructor">Conditional</a>(<span class="s">&quot;EnableLoggingHelpers&quot;</span>)]
        <b>public static void</b> <a id="06200f8cdbe2871e" href="../R/06200f8cdbe2871e.html" target="n" data-glyph="220,1" class="i method">LogMethodEnter</a>(
            <b>this</b> <a href="/Azure.Core/A.html#ce2f2fae396f36c5" class="t t">HttpPipeline</a> <span id="r3 rd" class="r3 r">pipeline</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">className</span>,
            [<a href="@1@netstandard/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">member</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">message</span> = <b>default</b>)
        =&gt; <a href="#479c54e6302464d6" class="i method">LogTrace</a>(<span class="r3 r">pipeline</span>, <span class="s">$&quot;</span><span class="s">ENTER METHOD </span>{<span class="r4 r">className</span>}<span class="s"> </span>{<span class="r5 r">member</span>}\n{<span class="r6 r">message</span>}<span class="s">&quot;</span>);
 
        [<a href="@1@netstandard/A.html#2cde19ac63a3b25e" class="t constructor">Conditional</a>(<span class="s">&quot;EnableLoggingHelpers&quot;</span>)]
        <b>public static void</b> <a id="c5d1437d862b682f" href="../R/c5d1437d862b682f.html" target="n" data-glyph="220,1" class="i method">LogMethodExit</a>(
            <b>this</b> <a href="/Azure.Core/A.html#ce2f2fae396f36c5" class="t t">HttpPipeline</a> <span id="r7 rd" class="r7 r">pipeline</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">className</span>,
            [<a href="@1@netstandard/A.html#3b59f8cb5102fd8b" class="t constructor">CallerMemberName</a>] <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">member</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">message</span> = <span class="s">&quot;&quot;</span>)
        =&gt; <a href="#479c54e6302464d6" class="i method">LogTrace</a>(<span class="r7 r">pipeline</span>, <span class="s">$&quot;</span><span class="s">EXIT METHOD </span>{<span class="r8 r">className</span>}<span class="s"> </span>{<span class="r9 r">member</span>}\n{<span class="r10 r">message</span>}<span class="s">&quot;</span>);
 
        [<a href="@1@netstandard/A.html#2cde19ac63a3b25e" class="t constructor">Conditional</a>(<span class="s">&quot;EnableLoggingHelpers&quot;</span>)]
        <b>public static void</b> <a id="442eee9b8a35098c" href="../R/442eee9b8a35098c.html" target="n" data-glyph="220,1" class="i method">LogException</a>(
            <b>this</b> <a href="/Azure.Core/A.html#ce2f2fae396f36c5" class="t t">HttpPipeline</a> <span id="r11 rd" class="r11 r">pipeline</span>,
            <a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r12 rd" class="r12 r">ex</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r13 rd" class="r13 r">message</span> = <b>default</b>)
        {
            <span class="c">// ExceptionDispatchInfo e =&gt;</span>
            <span class="c">//    if (e != default)</span>
            <span class="c">//    {</span>
            <span class="c">//        logger.LogError(e.SourceException, message);</span>
            <span class="c">//        e.Throw();</span>
            <span class="c">//    }</span>
        }
 
        [<a href="@1@netstandard/A.html#2cde19ac63a3b25e" class="t constructor">Conditional</a>(<span class="s">&quot;EnableLoggingHelpers&quot;</span>)]
        <b>public static void</b> <a id="479c54e6302464d6" href="../R/479c54e6302464d6.html" target="n" data-glyph="220,1" class="i method">LogTrace</a>(
            <b>this</b> <a href="/Azure.Core/A.html#ce2f2fae396f36c5" class="t t">HttpPipeline</a> <span id="r14 rd" class="r14 r">pipeline</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r15 rd" class="r15 r">message</span> = <b>default</b>)
        {
        }
 
        <span class="c">/*
        Temporarily removing unused code that depends on HttpUtility.ParseQueryString
 
 
        public static HttpRequestMessage Sanitize(this HttpRequestMessage httpRequest)
        {
            if (httpRequest == null)
            {
                return null;
            }
 
            var sanitizedRequest = new HttpRequestMessage
            {
                Content = httpRequest.Content,
                Method = httpRequest.Method,
                Version = httpRequest.Version,
            };
 
            foreach (var header in httpRequest.Headers)
            {
                // Redact Authorization header
                if (header.Key.Equals(Constants.Authorization, StringComparison.InvariantCulture))
                {
                    sanitizedRequest.Headers.Authorization = AuthenticationHeaderValue.Parse(Constants.Redacted);
                }
                else if(header.Key.Equals(Constants.CopySource, StringComparison.InvariantCulture))
                {
                    sanitizedRequest.Headers.Add(Constants.CopySource, new Uri(header.Value.First()).Sanitize().ToString());
                }
                else
                {
                    sanitizedRequest.Headers.Add(header.Key, header.Value);
                }
            }
 
            foreach (var property in httpRequest.Properties)
            {
                sanitizedRequest.Properties.Add(property);
            }
 
            // Redact SAS Signature, if necessary
            sanitizedRequest.RequestUri = httpRequest.RequestUri.Sanitize();
 
            return sanitizedRequest;
        }
 
        public static Uri Sanitize(this Uri uri)
        {
            if(uri?.Query == null)
            {
                return uri;
            }
            var parameters = HttpUtility.ParseQueryString(uri.Query);
            if (parameters[Constants.Sas.Parameters.Signature] != null)
            {
                parameters[Constants.Sas.Parameters.Signature] = Constants.Redacted;
            }
 
            var uriBuilder = new UriBuilder(uri)
            {
                Query = parameters.ToString()
            };
            return uriBuilder.Uri;
        }
        */</span>
    }
}
</pre></td></tr></table></div></body></html>
