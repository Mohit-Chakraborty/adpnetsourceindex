<!DOCTYPE html>
<html><head><title>TransportProducerPoolTests.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(396);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.EventHubs.Tests/Producer/TransportProducerPoolTests.cs" target="_top">Producer\TransportProducerPoolTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/eventhub/Azure.Messaging.EventHubs/tests/Producer/TransportProducerPoolTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.EventHubs.Tests" target="_top">Azure.Messaging.EventHubs.Tests.csproj</a> (Azure.Messaging.EventHubs.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Authorization</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Producer</span>;
<b>using</b> <span class="i n">Moq</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Tests</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c">   The suite of tests for the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> class.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span>
    [<span class="t constructor">TestFixture</span>]
    <b>public class</b> <a id="c762bd9ac66e3d64" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="b6275f8b6feff2fa">TransportProducerPoolTests</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The pool periodically removes and closes expired items.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="8fc61a81c447c942" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TransportProducerPoolRemovesExpiredItems</a>()
        {
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r0 rd" class="r0 r">transportProducer</span> = <b>new</b> <a href="#9515377d7967eda4" class="t constructor">ObservableTransportProducerMock</a>();
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r1 rd" class="r1 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r0 r">transportProducer</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r2 rd" class="r2 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r3 rd" class="r3 r">oneMinuteAgo</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#04abe0cac293ebd0" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4a343c29694bc9c8" class="i method">Subtract</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(1));
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r4 rd" class="r4 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                <span class="c">// An expired item in the pool</span>
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r0 r">transportProducer</span>, <span class="r5 r">removeAfter</span>: <span class="r3 r">oneMinuteAgo</span>),
                [<span class="s">&quot;1&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r0 r">transportProducer</span>),
                [<span class="s">&quot;2&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r0 r">transportProducer</span>),
            };
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r6 rd" class="r6 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r7 rd" class="r7 r">partition</span> =&gt; <span class="r1 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r7 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r2 r">retryPolicy</span>), <span class="r4 r">startingPool</span>);
 
            <a href="#2212bde3f2b6cd11" class="i method">GetExpirationCallBack</a>(<span class="r6 r">transportProducerPool</span>).<a href="@0@mscorlib/A.html#eeca6b881d42c0ce" class="i method">Invoke</a>(<b>null</b>);
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r4 r">startingPool</span>.<a href="@0@mscorlib/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="s">&quot;0&quot;</span>, <b>out _</b>), <span class="t t">Is</span>.<span class="i property">False</span>, <span class="s">&quot;PerformExpiration should remove an expired producer from the pool.&quot;</span>);
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r0 r">transportProducer</span>.<a href="#ded9a8394aef7f7d" class="i field">CloseCallCount</a>, <span class="t t">Is</span>.<span class="i method">EqualTo</span>(1), <span class="s">&quot;PerformExpiration should close an expired producer.&quot;</span>);
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r4 r">startingPool</span>.<a href="@0@mscorlib/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="s">&quot;1&quot;</span>, <b>out _</b>), <span class="t t">Is</span>.<span class="i property">True</span>, <span class="s">&quot;PerformExpiration should not remove valid producers.&quot;</span>);
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r4 r">startingPool</span>.<a href="@0@mscorlib/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="s">&quot;2&quot;</span>, <b>out _</b>), <span class="t t">Is</span>.<span class="i property">True</span>, <span class="s">&quot;PerformExpiration should not remove valid producers.&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   When a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is requested</span>
        <span class="c">///</span><span class="c">   its </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>.<a href="/Azure.Messaging.EventHubs/A.html#c685e065de8bf8c7" class="i property">RemoveAfter</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> will be increased.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="3ec41bfa05eb6e9b" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TransportProducerPoolRefreshesAccessedItems</a>()
        {
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r8 rd" class="r8 r">oneMinuteAgo</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#04abe0cac293ebd0" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4a343c29694bc9c8" class="i method">Subtract</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(1));
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r9 rd" class="r9 r">transportProducer</span> = <b>new</b> <a href="#9515377d7967eda4" class="t constructor">ObservableTransportProducerMock</a>();
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r10 rd" class="r10 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r9 r">transportProducer</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r11 rd" class="r11 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r12 rd" class="r12 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                <span class="c">// An expired item in the pool</span>
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r9 r">transportProducer</span>, <span class="r5 r">removeAfter</span>: <span class="r8 r">oneMinuteAgo</span>)
            };
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r13 rd" class="r13 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r14 rd" class="r14 r">partition</span> =&gt; <span class="r10 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r14 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r11 r">retryPolicy</span>), <span class="r12 r">startingPool</span>);
 
            <span class="c">// This call should refresh the timespan associated to the item</span>
            <b>_</b> = <span class="r13 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#2fcf6bab33a7b033" class="i method">GetPooledProducer</a>(<span class="s">&quot;0&quot;</span>);
 
            <span class="c">// The expiration call back should not remove the item</span>
            <a href="#2212bde3f2b6cd11" class="i method">GetExpirationCallBack</a>(<span class="r13 r">transportProducerPool</span>).<a href="@0@mscorlib/A.html#eeca6b881d42c0ce" class="i method">Invoke</a>(<b>null</b>);
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r12 r">startingPool</span>.<a href="@0@mscorlib/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="s">&quot;0&quot;</span>, <b>out _</b>), <span class="t t">Is</span>.<span class="i property">True</span>, <span class="s">&quot;The item in the pool should be refreshed and not have been removed.&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   When a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#6f70293ef8e7152c" class="t t">PooledProducer</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is disposed, the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a><span class="c">&quot;</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c">   of the associated </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> is increased.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="32569a02b69fd35d" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PoolItemsAreRefreshedOnDisposal</a>()
        {
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r15 rd" class="r15 r">transportProducer</span> = <b>new</b> <a href="#9515377d7967eda4" class="t constructor">ObservableTransportProducerMock</a>();
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r16 rd" class="r16 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r15 r">transportProducer</span>)
            };
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r17 rd" class="r17 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r15 r">transportProducer</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r18 rd" class="r18 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r19 rd" class="r19 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r20 rd" class="r20 r">partition</span> =&gt; <span class="r17 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r20 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r18 r">retryPolicy</span>));
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="k">var</a> <span id="r21 rd" class="r21 r">expectedTime</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#04abe0cac293ebd0" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(10);
 
            <b>await using</b> <a href="/Azure.Messaging.EventHubs/A.html#6f70293ef8e7152c" class="k">var</a> <span id="r22 rd" class="r22 r">pooledProducer</span> = <span class="r19 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#2fcf6bab33a7b033" class="i method">GetPooledProducer</a>(<span class="s">&quot;0&quot;</span>);
 
            <span class="c">// This call should refresh the timespan associated to an item in the pool</span>
            <b>await</b> <span class="r22 r">pooledProducer</span>.<a href="/Azure.Messaging.EventHubs/A.html#2142d875c4961a6b" class="i method">DisposeAsync</a>();
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r16 r">startingPool</span><a href="@0@mscorlib/A.html#52d16ab3fe5a7e2b">[</a><span class="s">&quot;0&quot;</span>].<a href="/Azure.Messaging.EventHubs/A.html#c685e065de8bf8c7" class="i property">RemoveAfter</a>, <span class="t t">Is</span>.<span class="i method">InRange</span>(<span class="r21 r">expectedTime</span>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(-1), <span class="r21 r">expectedTime</span>.<a href="@0@mscorlib/A.html#4658bd43b97f915c" class="i method">AddMinutes</a>(1)), <span class="s">$&quot;</span><span class="s">The remove after of a pool item should be extended.</span><span class="s">&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   When a partition producer is requested its expiration time will be increased.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="3d758f0a614b1bf5" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TransportProducerPoolTracksAProducerUsage</a>()
        {
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r23 rd" class="r23 r">oneMinuteAgo</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#04abe0cac293ebd0" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#4a343c29694bc9c8" class="i method">Subtract</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(1));
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r24 rd" class="r24 r">transportProducer</span> = <b>new</b> <a href="#9515377d7967eda4" class="t constructor">ObservableTransportProducerMock</a>();
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r25 rd" class="r25 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r24 r">transportProducer</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r26 rd" class="r26 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r27 rd" class="r27 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                <span class="c">// An expired item in the pool</span>
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r24 r">transportProducer</span>, <span class="r5 r">removeAfter</span>: <span class="r23 r">oneMinuteAgo</span>)
            };
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r28 rd" class="r28 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r29 rd" class="r29 r">partition</span> =&gt; <span class="r25 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r29 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r26 r">retryPolicy</span>), <span class="r27 r">startingPool</span>);
 
            <a href="/Azure.Messaging.EventHubs/A.html#6f70293ef8e7152c" class="k">var</a> <span id="r30 rd" class="r30 r">pooledProducer</span> = <span class="r28 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#2fcf6bab33a7b033" class="i method">GetPooledProducer</a>(<span class="s">&quot;0&quot;</span>);
            <span class="r27 r">startingPool</span>.<a href="@0@mscorlib/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="s">&quot;0&quot;</span>, <b>out</b> <a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="k">var</a> <span id="r31 rd" class="r31 r">poolItem</span>);
 
            <b>await using</b> (<span class="r30 r">pooledProducer</span>)
            {
                <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r31 r">poolItem</span>.<a href="/Azure.Messaging.EventHubs/A.html#b1d1739961f752e7" class="i property">ActiveInstances</a>.<a href="@0@mscorlib/A.html#40c23c8c36011417" class="i property">Count</a>, <span class="t t">Is</span>.<span class="i method">EqualTo</span>(1), <span class="s">&quot;The usage of a transport producer should be tracked.&quot;</span>);
            }
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r31 r">poolItem</span>.<a href="/Azure.Messaging.EventHubs/A.html#b1d1739961f752e7" class="i property">ActiveInstances</a>.<a href="@0@mscorlib/A.html#40c23c8c36011417" class="i property">Count</a>, <span class="t t">Is</span>.<span class="i method">EqualTo</span>(0), <span class="s">&quot;After usage an active instance should be removed from the pool.&quot;</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   It is possible to configure how long a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> should sit in memory.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="498ea2dd2f94a62f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TransportProducerPoolAllowsConfiguringRemoveAfter</a>()
        {
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r32 rd" class="r32 r">transportProducer</span> = <b>new</b> <a href="#9515377d7967eda4" class="t constructor">ObservableTransportProducerMock</a>();
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r33 rd" class="r33 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r32 r">transportProducer</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r34 rd" class="r34 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r35 rd" class="r35 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r32 r">transportProducer</span>)
            };
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r36 rd" class="r36 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r37 rd" class="r37 r">partition</span> =&gt; <span class="r33 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r37 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r34 r">retryPolicy</span>), <span class="r35 r">startingPool</span>);
 
            <a href="/Azure.Messaging.EventHubs/A.html#6f70293ef8e7152c" class="k">var</a> <span id="r38 rd" class="r38 r">pooledProducer</span> = <span class="r36 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#2fcf6bab33a7b033" class="i method">GetPooledProducer</a>(<span class="s">&quot;0&quot;</span>, <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(-1));
 
            <b>await using</b> (<b>var</b> <span id="r39 rd" class="r39 r">_</span> = <span class="r38 r">pooledProducer</span>.<span class="i method">ConfigureAwait</span>(<b>false</b>))
            {
            };
 
            <a href="#2212bde3f2b6cd11" class="i method">GetExpirationCallBack</a>(<span class="r36 r">transportProducerPool</span>).<a href="@0@mscorlib/A.html#eeca6b881d42c0ce" class="i method">Invoke</a>(<b>null</b>);
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r32 r">transportProducer</span>.<a href="#ded9a8394aef7f7d" class="i field">CloseCallCount</a>, <span class="t t">Is</span>.<span class="i method">EqualTo</span>(1));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> returns the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a><span class="c">&quot;</span> <span class="c">/&gt;</span>
        <span class="c">///</span><span class="c">   matching the right partition id.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        [<span class="t constructor">TestCase</span>(<b>null</b>)]
        [<span class="t constructor">TestCase</span>(<span class="s">&quot;0&quot;</span>)]
        <b>public void</b> <a id="5639af308fc5fece" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TransportProducerPoolAllowsTakingTheRightTransportProducer</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r40 rd" class="r40 r">partitionId</span>)
        {
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r41 rd" class="r41 r">transportProducer</span> = <b>new</b> <a href="#9515377d7967eda4" class="t constructor">ObservableTransportProducerMock</a>();
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r42 rd" class="r42 r">partitionProducer</span> = <b>new</b> <a href="#9515377d7967eda4" class="t constructor">ObservableTransportProducerMock</a>(<span class="r40 r">partitionId</span>);
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r43 rd" class="r43 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r42 r">partitionProducer</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r44 rd" class="r44 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r45 rd" class="r45 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r42 r">partitionProducer</span>)
            };
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r46 rd" class="r46 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r47 rd" class="r47 r">partition</span> =&gt; <span class="r43 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r47 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r44 r">retryPolicy</span>), <span class="r48 r">eventHubProducer</span>: <span class="r41 r">transportProducer</span>);
 
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r49 rd" class="r49 r">returnedProducer</span> = <span class="r46 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#2fcf6bab33a7b033" class="i method">GetPooledProducer</a>(<span class="r40 r">partitionId</span>).<a href="/Azure.Messaging.EventHubs/A.html#22fd7595026be5e3" class="i property">TransportProducer</a> <b>as</b> <a href="#e35326684efc10d6" class="t t">ObservableTransportProducerMock</a>;
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r49 r">returnedProducer</span>.<a href="#95b8eec9378a4c57" class="i property">PartitionId</a>, <span class="t t">Is</span>.<span class="i method">EqualTo</span>(<span class="r40 r">partitionId</span>));
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Verifies functionality of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#f9c50ea52da5d25b" class="i method">CloseAsync</a><span class="c">&quot;</span> <span class="c">/&gt;</span>
        <span class="c">///</span><span class="c">   method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="1785762264b1345e" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CloseAsyncSurfacesExceptionsForTransportProducer</a>()
        {
            <b>var</b> <span id="r50 rd" class="r50 r">transportProducer</span> = <b>new</b> <span class="t constructor">Mock</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt;();
            <b>var</b> <span id="r51 rd" class="r51 r">partitionProducer</span> = <b>new</b> <span class="t constructor">Mock</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt;();
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r52 rd" class="r52 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r51 r">partitionProducer</span>.<span class="i property">Object</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r53 rd" class="r53 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r54 rd" class="r54 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r51 r">partitionProducer</span>.<span class="i property">Object</span>)
            };
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r55 rd" class="r55 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r56 rd" class="r56 r">partition</span> =&gt; <span class="r52 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r56 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r53 r">retryPolicy</span>), <span class="r48 r">eventHubProducer</span>: <span class="r50 r">transportProducer</span>.<span class="i property">Object</span>);
 
            <span class="r50 r">transportProducer</span>
                .<span class="i method">Setup</span>(<span id="r57 rd" class="r57 r">producer</span> =&gt; <span class="r57 r">producer</span>.<a href="/Azure.Messaging.EventHubs/A.html#a752c8a6548bda34" class="i method">CloseAsync</a>(<span class="t t">It</span>.<span class="i method">IsAny</span>&lt;<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>&gt;()))
                .<span class="i method">Returns</span>(<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#55fe1e3de0db4621" class="i method">FromException</a>(<b>new</b> <a href="@0@mscorlib/A.html#754284a89e70ddea" class="t constructor">InvalidCastException</a>()));
 
            <a href="#e35326684efc10d6" class="k">var</a> <span id="r58 rd" class="r58 r">_</span> = <span class="r55 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#2fcf6bab33a7b033" class="i method">GetPooledProducer</a>(<b>null</b>).<a href="/Azure.Messaging.EventHubs/A.html#22fd7595026be5e3" class="i property">TransportProducer</a> <b>as</b> <a href="#e35326684efc10d6" class="t t">ObservableTransportProducerMock</a>;
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<b>async</b> () =&gt; <b>await</b> <span class="r55 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#f9c50ea52da5d25b" class="i method">CloseAsync</a>(), <span class="t t">Throws</span>.<span class="i method">InstanceOf</span>&lt;<a href="@0@mscorlib/A.html#e9f84ee35463e2da" class="t t">InvalidCastException</a>&gt;());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Verifies functionality of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#f9c50ea52da5d25b" class="i method">CloseAsync</a><span class="c">&quot;</span> <span class="c">/&gt;</span>
        <span class="c">///</span><span class="c">   method.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="1ef66d932829071b" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CloseAsyncSurfacesExceptionsForPartitionTransportProducer</a>()
        {
            <b>var</b> <span id="r59 rd" class="r59 r">transportProducer</span> = <b>new</b> <span class="t constructor">Mock</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt;();
            <b>var</b> <span id="r60 rd" class="r60 r">partitionProducer</span> = <b>new</b> <span class="t constructor">Mock</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt;();
            <a href="#148ecaadfd3bddf4" class="k">var</a> <span id="r61 rd" class="r61 r">connection</span> = <b>new</b> <a href="#fca143d7d463aaae" class="t constructor">MockConnection</a>(() =&gt; <span class="r60 r">partitionProducer</span>.<span class="i property">Object</span>);
            <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="k">var</a> <span id="r62 rd" class="r62 r">retryPolicy</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#62cbdacd933d6f96" class="t constructor">EventHubProducerClientOptions</a>().<a href="/Azure.Messaging.EventHubs/A.html#18c31e7bf251ae6e" class="i property">RetryOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f1a0f56e5cda073f" class="i method">ToRetryPolicy</a>();
            <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="k">var</a> <span id="r63 rd" class="r63 r">startingPool</span> = <b>new</b> <a href="@0@mscorlib/A.html#abc35f3c19fa0290" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#4def38409a7e68a7" class="t t">PoolItem</a>&gt;
            {
                [<span class="s">&quot;0&quot;</span>] = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>.<a href="/Azure.Messaging.EventHubs/A.html#8f6446793c15e8b2" class="t constructor">PoolItem</a>(<span class="s">&quot;0&quot;</span>, <span class="r60 r">partitionProducer</span>.<span class="i property">Object</span>)
            };
            <a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r64 rd" class="r64 r">transportProducerPool</span> = <b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#c63b09b0603442c7" class="t constructor">TransportProducerPool</a>(<span id="r65 rd" class="r65 r">partition</span> =&gt; <span class="r61 r">connection</span>.<a href="#ff4a137c536cec08" class="i method">CreateTransportProducer</a>(<span class="r65 r">partition</span>, <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a>.<a href="/Azure.Messaging.EventHubs/A.html#c8d680d719558fa5" class="i field">None</a>, <b>null</b>, <span class="r62 r">retryPolicy</span>), <span class="r48 r">eventHubProducer</span>: <span class="r59 r">transportProducer</span>.<span class="i property">Object</span>);
 
            <span class="r60 r">partitionProducer</span>
                .<span class="i method">Setup</span>(<span id="r66 rd" class="r66 r">producer</span> =&gt; <span class="r66 r">producer</span>.<a href="/Azure.Messaging.EventHubs/A.html#a752c8a6548bda34" class="i method">CloseAsync</a>(<span class="t t">It</span>.<span class="i method">IsAny</span>&lt;<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>&gt;()))
                .<span class="i method">Returns</span>(<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#55fe1e3de0db4621" class="i method">FromException</a>(<b>new</b> <a href="@0@mscorlib/A.html#754284a89e70ddea" class="t constructor">InvalidCastException</a>()));
 
            <a href="/Azure.Messaging.EventHubs/A.html#6f70293ef8e7152c" class="k">var</a> <span id="r67 rd" class="r67 r">_</span> = <span class="r64 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#2fcf6bab33a7b033" class="i method">GetPooledProducer</a>(<span class="s">&quot;0&quot;</span>);
 
            <span class="t t">Assert</span>.<span class="i method">That</span>(<b>async</b> () =&gt; <b>await</b> <span class="r64 r">transportProducerPool</span>.<a href="/Azure.Messaging.EventHubs/A.html#f9c50ea52da5d25b" class="i method">CloseAsync</a>(), <span class="t t">Throws</span>.<span class="i method">InstanceOf</span>&lt;<a href="@0@mscorlib/A.html#e9f84ee35463e2da" class="t t">InvalidCastException</a>&gt;());
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Gets the routine responsible of finding expired producers.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private static</b> <a href="@0@mscorlib/A.html#d728fdb343e326bc" class="t t">TimerCallback</a> <a id="2212bde3f2b6cd11" href="../R/2212bde3f2b6cd11.html" target="n" data-glyph="76,1" class="i method">GetExpirationCallBack</a>(<a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a> <span id="r68 rd" class="r68 r">pool</span>) =&gt;
            (<a href="@0@mscorlib/A.html#d728fdb343e326bc" class="t t">TimerCallback</a>)
                <b>typeof</b>(<a href="/Azure.Messaging.EventHubs/A.html#06f35c4320e1620b" class="t t">TransportProducerPool</a>)
                    .<a href="@0@mscorlib/A.html#f24e0c9fd5441fd5" class="i method">GetMethod</a>(<span class="s">&quot;CreateExpirationTimerCallback&quot;</span>, <a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#5144189c11f6b668" class="i field">NonPublic</a> | <a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#54a14f747b06c614" class="i field">Instance</a>)
                    .<a href="@0@mscorlib/A.html#c8277ed81262a367" class="i method">Invoke</a>(<span class="r68 r">pool</span>, <b>null</b>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Serves as a non-functional connection for testing producer functionality.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private class</b> <a id="148ecaadfd3bddf4" href="../R/148ecaadfd3bddf4.html" target="n" data-glyph="4,1" class="t t">MockConnection</a> : <a href="/Azure.Messaging.EventHubs/A.html#0646809725209998" class="t t">EventHubConnection</a>
        {
            <b>public</b> <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <a id="a827a4e907f23ac9" href="../R/a827a4e907f23ac9.html" target="n" data-glyph="42,2" class="i field">GetPropertiesInvokedWith</a> = <b>null</b>;
            <b>public</b> <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <a id="0646ce8c2dc46a69" href="../R/0646ce8c2dc46a69.html" target="n" data-glyph="42,2" class="i field">GetPartitionIdsInvokedWith</a> = <b>null</b>;
            <b>public</b> <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <a id="92928d5e7706ba77" href="../R/92928d5e7706ba77.html" target="n" data-glyph="42,2" class="i field">GetPartitionPropertiesInvokedWith</a> = <b>null</b>;
            <b>public</b> <a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt; <a id="4e3728b5be1edec7" href="../R/4e3728b5be1edec7.html" target="n" data-glyph="42,2" class="i field">TransportProducerFactory</a> = () =&gt; <span class="t t">Mock</span>.<span class="i method">Of</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt;();
 
            <b>public bool</b> <a id="912ba03a9a2860c4" href="../R/../../0000000000.html" target="n" data-glyph="42,2" class="i field">WasClosed</a> = <b>false</b>;
 
            <b>public</b> <a id="f0697468eaff60c3" href="../R/f0697468eaff60c3.html" target="n" data-glyph="72,2" class="t constructor">MockConnection</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r69 rd" class="r69 r">namespaceName</span> = <span class="s">&quot;fakeNamespace&quot;</span>,
                                  <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r70 rd" class="r70 r">eventHubName</span> = <span class="s">&quot;fakeEventHub&quot;</span>) : <a href="/Azure.Messaging.EventHubs/A.html#e3e858f9ffa9a28d" class="k">base</a>(<span class="r69 r">namespaceName</span>, <span class="r70 r">eventHubName</span>, <b>new</b> <span class="t constructor">Mock</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#799a8f6651c6d656" class="t t">EventHubTokenCredential</a>&gt;(<span class="t t">Mock</span>.<span class="i method">Of</span>&lt;<a href="/Azure.Core/A.html#d93a9ffee404e938" class="t t">TokenCredential</a>&gt;()).<span class="i property">Object</span>)
            {
            }
 
            <b>public</b> <a id="319f4e290100c199" href="../R/319f4e290100c199.html" target="n" data-glyph="72,2" class="t constructor">MockConnection</a>(<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt; <span id="r71 rd" class="r71 r">transportProducerFactory</span>,
                                  <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r72 rd" class="r72 r">namespaceName</span>,
                                  <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r73 rd" class="r73 r">eventHubName</span>) : <a href="#f0697468eaff60c3" class="k">this</a>(<span class="r72 r">namespaceName</span>, <span class="r73 r">eventHubName</span>)
            {
                <a href="#4e3728b5be1edec7" class="i field">TransportProducerFactory</a> = <span class="r71 r">transportProducerFactory</span>;
            }
 
            <b>public</b> <a id="fca143d7d463aaae" href="../R/fca143d7d463aaae.html" target="n" data-glyph="72,2" class="t constructor">MockConnection</a>(<a href="@0@mscorlib/A.html#87d60abb7092d5a4" class="t t">Func</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>&gt; <span id="r74 rd" class="r74 r">transportProducerFactory</span>) : <a href="#319f4e290100c199" class="k">this</a>(<span class="r74 r">transportProducerFactory</span>, <span class="s">&quot;fakeNamespace&quot;</span>, <span class="s">&quot;fakeEventHub&quot;</span>)
            {
            }
 
            <b>internal override</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#6ee60bd5de616192" class="t t">EventHubProperties</a>&gt; <a id="dc8f270f5f4a561b" href="../R/dc8f270f5f4a561b.html" target="n" data-glyph="74,2" class="i method">GetPropertiesAsync</a>(<a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <span id="r75 rd" class="r75 r">retryPolicy</span>,
                                                                          <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r76 rd" class="r76 r">cancellationToken</span> = <b>default</b>)
            {
                <a href="#a827a4e907f23ac9" class="i field">GetPropertiesInvokedWith</a> = <span class="r75 r">retryPolicy</span>;
                <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#11a386e7d7cae64a" class="i method">FromResult</a>(<b>new</b> <a href="/Azure.Messaging.EventHubs/A.html#d3bee90c99aeea44" class="t constructor">EventHubProperties</a>(<a href="/Azure.Messaging.EventHubs/A.html#9d66313561b8598d" class="i property">EventHubName</a>, <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#355516336bba15ac" class="i method">Parse</a>(<span class="s">&quot;2015-10-27T00:00:00Z&quot;</span>), <b>new</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[] { <span class="s">&quot;0&quot;</span>, <span class="s">&quot;1&quot;</span> }));
            }
 
            <b>internal async override</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>[]&gt; <a id="3928c9060b56d89b" href="../R/3928c9060b56d89b.html" target="n" data-glyph="74,2" class="i method">GetPartitionIdsAsync</a>(<a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <span id="r77 rd" class="r77 r">retryPolicy</span>,
                                                                        <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r78 rd" class="r78 r">cancellationToken</span> = <b>default</b>)
            {
                <a href="#0646ce8c2dc46a69" class="i field">GetPartitionIdsInvokedWith</a> = <span class="r77 r">retryPolicy</span>;
                <b>return</b> <b>await</b> <a href="/Azure.Messaging.EventHubs/A.html#0646809725209998" class="k">base</a>.<a href="/Azure.Messaging.EventHubs/A.html#44a63294469a3aeb" class="i method">GetPartitionIdsAsync</a>(<span class="r77 r">retryPolicy</span>, <span class="r78 r">cancellationToken</span>);
            }
 
            <b>internal override</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#9311a292681a1af8" class="t t">PartitionProperties</a>&gt; <a id="4091d375be66f8f4" href="../R/4091d375be66f8f4.html" target="n" data-glyph="74,2" class="i method">GetPartitionPropertiesAsync</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r79 rd" class="r79 r">partitionId</span>,
                                                                                    <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <span id="r80 rd" class="r80 r">retryPolicy</span>,
                                                                                    <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r81 rd" class="r81 r">cancellationToken</span> = <b>default</b>)
            {
                <a href="#92928d5e7706ba77" class="i field">GetPartitionPropertiesInvokedWith</a> = <span class="r80 r">retryPolicy</span>;
                <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#11a386e7d7cae64a" class="i method">FromResult</a>(<b>default</b>(<a href="/Azure.Messaging.EventHubs/A.html#9311a292681a1af8" class="t t">PartitionProperties</a>));
            }
 
            <b>internal override</b> <a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a> <a id="ff4a137c536cec08" href="../R/ff4a137c536cec08.html" target="n" data-glyph="74,2" class="i method">CreateTransportProducer</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r82 rd" class="r82 r">partitionId</span>,
                                                                        <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a> <span id="r83 rd" class="r83 r">requestedFeatures</span>,
                                                                        <a href="/Azure.Messaging.EventHubs/A.html#063aaefcca0dd9a1" class="t t">PartitionPublishingOptions</a> <span id="r84 rd" class="r84 r">partitionOptions</span>,
                                                                        <a href="/Azure.Messaging.EventHubs/A.html#bc28d871ab581a88" class="t t">EventHubsRetryPolicy</a> <span id="r85 rd" class="r85 r">retryPolicy</span>) =&gt; <a href="#4e3728b5be1edec7" class="i field">TransportProducerFactory</a>();
 
            <b>internal override</b> <a href="/Azure.Messaging.EventHubs/A.html#9812723e0dd3e9dc" class="t t">TransportClient</a> <a id="413a050c68fbee4e" href="../R/413a050c68fbee4e.html" target="n" data-glyph="74,2" class="i method">CreateTransportClient</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r86 rd" class="r86 r">fullyQualifiedNamespace</span>,
                                                                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r87 rd" class="r87 r">eventHubName</span>,
                                                                    <a href="/Azure.Messaging.EventHubs/A.html#799a8f6651c6d656" class="t t">EventHubTokenCredential</a> <span id="r88 rd" class="r88 r">credential</span>,
                                                                    <a href="/Azure.Messaging.EventHubs/A.html#f8df5ce6477308ff" class="t t">EventHubConnectionOptions</a> <span id="r89 rd" class="r89 r">options</span>)
            {
                <b>var</b> <span id="r90 rd" class="r90 r">client</span> = <b>new</b> <span class="t constructor">Mock</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#9812723e0dd3e9dc" class="t t">TransportClient</a>&gt;();
 
                <span class="r90 r">client</span>
                    .<span class="i method">Setup</span>(<span id="r91 rd" class="r91 r">client</span> =&gt; <span class="r91 r">client</span>.<a href="/Azure.Messaging.EventHubs/A.html#5bd4d4b06e003690" class="i property">ServiceEndpoint</a>)
                    .<span class="i method">Returns</span>(<b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="s">$&quot;</span><span class="s">amgp://</span>{ <span class="r86 r">fullyQualifiedNamespace</span> }<span class="s">.com/</span>{ <span class="r87 r">eventHubName</span> }<span class="s">&quot;</span>));
 
                <b>return</b> <span class="r90 r">client</span>.<span class="i property">Object</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Allows for observation of operations performed by the producer for testing purposes.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private class</b> <a id="e35326684efc10d6" href="../R/e35326684efc10d6.html" target="n" data-glyph="4,1" class="t t">ObservableTransportProducerMock</a> : <a href="/Azure.Messaging.EventHubs/A.html#3e8bff2a200aca1e" class="t t">TransportProducer</a>
        {
            <b>public int</b> <a id="ded9a8394aef7f7d" href="../R/ded9a8394aef7f7d.html" target="n" data-glyph="42,2" class="i field">CloseCallCount</a> = 0;
            <b>public bool</b> <a id="9811a5035d1c06ec" href="../R/9811a5035d1c06ec.html" target="n" data-glyph="42,2" class="i field">WasCloseCalled</a> = <b>false</b>;
            <b>public</b> (<a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#557aa370d1369b89" class="t t">EventData</a>&gt;, <a href="/Azure.Messaging.EventHubs/A.html#b41cc3b18fb38fa6" class="t t">SendEventOptions</a>) <a id="5c6e5039fd2f8cba" href="../R/5c6e5039fd2f8cba.html" target="n" data-glyph="42,2" class="i field">SendCalledWith</a>;
            <b>public</b> <a href="/Azure.Messaging.EventHubs/A.html#c992a211bbcf6874" class="t t">EventDataBatch</a> <a id="ae00c41c84abb69a" href="../R/ae00c41c84abb69a.html" target="n" data-glyph="42,2" class="i field">SendBatchCalledWith</a>;
            <b>public</b> <a href="/Azure.Messaging.EventHubs/A.html#efa8982626004b5d" class="t t">CreateBatchOptions</a> <a id="4a1306a32965cd05" href="../R/4a1306a32965cd05.html" target="n" data-glyph="42,2" class="i field">CreateBatchCalledWith</a>;
            <b>public string</b> <a id="95b8eec9378a4c57" href="../R/95b8eec9378a4c57.html" target="n" data-glyph="102,2" class="i property">PartitionId</a> { <b>get</b>; <b>set</b>; }
 
            <b>public</b> <a id="9515377d7967eda4" href="../R/9515377d7967eda4.html" target="n" data-glyph="72,2" class="t constructor">ObservableTransportProducerMock</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r92 rd" class="r92 r">partitionId</span> = <b>default</b>)
            {
                <a href="#95b8eec9378a4c57" class="i property">PartitionId</a> = <span class="r92 r">partitionId</span>;
            }
 
            <b>public override</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ba5db7eebc4a97dd" href="../R/ba5db7eebc4a97dd.html" target="n" data-glyph="72,2" class="i method">SendAsync</a>(<a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Azure.Messaging.EventHubs/A.html#557aa370d1369b89" class="t t">EventData</a>&gt; <span id="r93 rd" class="r93 r">events</span>,
                                           <a href="/Azure.Messaging.EventHubs/A.html#b41cc3b18fb38fa6" class="t t">SendEventOptions</a> <span id="r94 rd" class="r94 r">sendOptions</span>,
                                           <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r95 rd" class="r95 r">cancellationToken</span>)
            {
                <a href="#5c6e5039fd2f8cba" class="i field">SendCalledWith</a> = (<span class="r93 r">events</span>, <span class="r94 r">sendOptions</span>);
                <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
            }
 
            <b>public override</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="dd2bbb0c8669921c" href="../R/dd2bbb0c8669921c.html" target="n" data-glyph="72,2" class="i method">SendAsync</a>(<a href="/Azure.Messaging.EventHubs/A.html#c992a211bbcf6874" class="t t">EventDataBatch</a> <span id="r96 rd" class="r96 r">batch</span>,
                                           <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r97 rd" class="r97 r">cancellationToken</span>)
            {
                <a href="#ae00c41c84abb69a" class="i field">SendBatchCalledWith</a> = <span class="r96 r">batch</span>;
                <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
            }
 
            <b>public override</b> <span class="t t">ValueTask</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#d626c58b5be68e2d" class="t t">TransportEventBatch</a>&gt; <a id="511d461006e8ad5e" href="../R/511d461006e8ad5e.html" target="n" data-glyph="72,2" class="i method">CreateBatchAsync</a>(<a href="/Azure.Messaging.EventHubs/A.html#efa8982626004b5d" class="t t">CreateBatchOptions</a> <span id="r98 rd" class="r98 r">options</span>,
                                                                            <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r99 rd" class="r99 r">cancellationToken</span>)
            {
                <a href="#4a1306a32965cd05" class="i field">CreateBatchCalledWith</a> = <span class="r98 r">options</span>;
                <b>return</b> <b>new</b> <span class="t constructor">ValueTask</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#d626c58b5be68e2d" class="t t">TransportEventBatch</a>&gt;(<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#11a386e7d7cae64a" class="i method">FromResult</a>((<a href="/Azure.Messaging.EventHubs/A.html#d626c58b5be68e2d" class="t t">TransportEventBatch</a>)<b>new</b> <a href="#275f81da44f67707" class="t constructor">MockTransportBatch</a>()));
            }
 
            <b>public override</b> <span class="t t">ValueTask</span>&lt;<a href="/Azure.Messaging.EventHubs/A.html#6fbaf58e86a0ae15" class="t t">PartitionPublishingProperties</a>&gt; <a id="f50dfbbfeb54e885" href="../R/f50dfbbfeb54e885.html" target="n" data-glyph="72,2" class="i method">ReadInitializationPublishingPropertiesAsync</a>(<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r100 rd" class="r100 r">cancellationToken</span>) =&gt; <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#085d4139ffb78d13" class="t constructor">NotImplementedException</a>();
 
            <b>public override</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="efc58cd13ff7530e" href="../R/efc58cd13ff7530e.html" target="n" data-glyph="72,2" class="i method">CloseAsync</a>(<a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r101 rd" class="r101 r">cancellationToken</span>)
            {
                <a href="#9811a5035d1c06ec" class="i field">WasCloseCalled</a> = <b>true</b>;
                ++<a href="#ded9a8394aef7f7d" class="i field">CloseCallCount</a>;
                <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">   Serves as a non-functional transport event batch for satisfying the</span>
        <span class="c">///</span><span class="c">   non-null constraints of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Messaging.EventHubs/A.html#c992a211bbcf6874" class="t t">EventDataBatch</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> created by</span>
        <span class="c">///</span><span class="c">   the producer being tested.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>private class</b> <a id="275f81da44f67707" href="../R/275f81da44f67707.html" target="n" data-glyph="4,1" class="t t"><span id="e5da4f050269f171">MockTransportBatch</span></a> : <a href="/Azure.Messaging.EventHubs/A.html#d626c58b5be68e2d" class="t t">TransportEventBatch</a>
        {
            <b>public override long</b> <a id="be134e1b21b4ce2b" href="../R/be134e1b21b4ce2b.html" target="n" data-glyph="102,2" class="i property">MaximumSizeInBytes</a> { <b>get</b>; }
            <b>public override long</b> <a id="1429f9e9594d9388" href="../R/1429f9e9594d9388.html" target="n" data-glyph="102,2" class="i property">SizeInBytes</a> { <b>get</b>; }
            <b>public override int</b> <a id="820cf8f8d5e44917" href="../R/820cf8f8d5e44917.html" target="n" data-glyph="102,2" class="i property">Count</a> { <b>get</b>; }
            <b>public override</b> <a href="/Azure.Messaging.EventHubs/A.html#012a1c2da3174f00" class="t t">TransportProducerFeatures</a> <a id="f7dd127a5c4f4884" href="../R/f7dd127a5c4f4884.html" target="n" data-glyph="102,2" class="i property">ActiveFeatures</a> { <b>get</b>; }
            <b>public override bool</b> <a id="17841ee6db753d21" href="../R/17841ee6db753d21.html" target="n" data-glyph="72,2" class="i method">TryAdd</a>(<a href="/Azure.Messaging.EventHubs/A.html#557aa370d1369b89" class="t t">EventData</a> <span id="r102 rd" class="r102 r">eventData</span>) =&gt; <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#085d4139ffb78d13" class="t constructor">NotImplementedException</a>();
            <b>public override</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<span class="r103 r t">T</span>&gt; <a id="aca843b160089033" href="../R/aca843b160089033.html" target="n" data-glyph="72,2" class="i method">AsEnumerable</a>&lt;<span id="r103 rd t" class="r103 r t">T</span>&gt;() =&gt; <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#085d4139ffb78d13" class="t constructor">NotImplementedException</a>();
            <b>public override void</b> <a id="4900cf1b3a34de54" href="../R/4900cf1b3a34de54.html" target="n" data-glyph="72,2" class="i method">Dispose</a>() =&gt; <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#085d4139ffb78d13" class="t constructor">NotImplementedException</a>();
 
            <b>public override void</b> <a id="cc51a407006e9e91" href="../R/cc51a407006e9e91.html" target="n" data-glyph="72,2" class="i method">Clear</a>()
            {
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
