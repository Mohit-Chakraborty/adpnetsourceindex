<!DOCTYPE html>
<html><head><title>LoggingPolicy.cs</title><link rel="stylesheet" href="../../../styles.css"><script src="../../../scripts.js"></script></head>
<body class="cB" onload="i(452);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Core/Pipeline/Internal/LoggingPolicy.cs" target="_top">Pipeline\Internal\LoggingPolicy.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/core/Azure.Core/src/Pipeline/Internal/LoggingPolicy.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Core" target="_top">Azure.Core.csproj</a> (Azure.Core)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">Tracing</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Diagnostics</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>
{
    <b>internal class</b> <a id="9ecebce37ca6b420" href="../../R/9ecebce37ca6b420.html" target="n" data-glyph="2,0" class="t t">LoggingPolicy</a> : <a href="../HttpPipelinePolicy.cs.html#afce2b8855e35f1f" class="t t">HttpPipelinePolicy</a>
    {
        <b>public</b> <a id="3209d7f8f2a2cfaa" href="../../R/3209d7f8f2a2cfaa.html" target="n" data-glyph="72,1" class="t constructor">LoggingPolicy</a>(<b>bool</b> <span id="r0 rd" class="r0 r">logContent</span>, <b>int</b> <span id="r1 rd" class="r1 r">maxLength</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r2 rd" class="r2 r">allowedHeaderNames</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>[] <span id="r3 rd" class="r3 r">allowedQueryParameters</span>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r4 rd" class="r4 r">assemblyName</span>)
        {
            <a href="#3d0ff36a2cfe2c41" class="i field">_sanitizer</a> = <b>new</b> <a href="../../Shared/HttpMessageSanitizer.cs.html#4a3cf997ac595d7e" class="t constructor">HttpMessageSanitizer</a>(<span class="r3 r">allowedQueryParameters</span>, <span class="r2 r">allowedHeaderNames</span>);
            <a href="#814f0c7e1af7855f" class="i field">_logContent</a> = <span class="r0 r">logContent</span>;
            <a href="#c89975858b8237a5" class="i field">_maxLength</a> = <span class="r1 r">maxLength</span>;
            <a href="#a0500039cfaca06c" class="i field">_assemblyName</a> = <span class="r4 r">assemblyName</span>;
        }
 
        <b>private const double</b> <a id="a24d55afab05e6ef" href="../../R/a24d55afab05e6ef.html" target="n" data-glyph="10,1" class="i field">RequestTooLongTime</a> = 3.0; <span class="c">// sec</span>
 
        <b>private static readonly</b> <a href="../../Diagnostics/AzureCoreEventSource.cs.html#01d1d54631cb1734" class="t t">AzureCoreEventSource</a> <a id="572bf2d7183a2d25" href="../../R/572bf2d7183a2d25.html" target="n" data-glyph="46,1" class="i field">s_eventSource</a> = <a href="../../Diagnostics/AzureCoreEventSource.cs.html#01d1d54631cb1734" class="t t">AzureCoreEventSource</a>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#38a38c5956efb2e8" class="i property">Singleton</a>;
 
        <b>private readonly bool</b> <a id="814f0c7e1af7855f" href="../../R/814f0c7e1af7855f.html" target="n" data-glyph="46,1" class="i field">_logContent</a>;
        <b>private readonly int</b> <a id="c89975858b8237a5" href="../../R/c89975858b8237a5.html" target="n" data-glyph="46,1" class="i field">_maxLength</a>;
        <b>private readonly</b> <a href="../../Shared/HttpMessageSanitizer.cs.html#3b463fd80f178c98" class="t t">HttpMessageSanitizer</a> <a id="3d0ff36a2cfe2c41" href="../../R/3d0ff36a2cfe2c41.html" target="n" data-glyph="46,1" class="i field">_sanitizer</a>;
        <b>private readonly string</b>? <a id="a0500039cfaca06c" href="../../R/a0500039cfaca06c.html" target="n" data-glyph="46,1" class="i field">_assemblyName</a>;
 
        <b>public override void</b> <a id="fe9a3b3746429191" href="../../R/fe9a3b3746429191.html" target="n" data-glyph="72,1" class="i method">Process</a>(<a href="../../HttpMessage.cs.html#0d3a69186ac45549" class="t t">HttpMessage</a> <span id="r5 rd" class="r5 r">message</span>, <span class="t t">ReadOnlyMemory</span>&lt;<a href="../HttpPipelinePolicy.cs.html#afce2b8855e35f1f" class="t t">HttpPipelinePolicy</a>&gt; <span id="r6 rd" class="r6 r">pipeline</span>)
        {
            <b>if</b> (!<a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>.<a href="@1@netstandard/A.html#69fcbb5c318fe603" class="i method">IsEnabled</a>())
            {
                <a href="../HttpPipelinePolicy.cs.html#ed2e35356f769a1b" class="i method">ProcessNext</a>(<span class="r5 r">message</span>, <span class="r6 r">pipeline</span>);
                <b>return</b>;
            }
 
            <a href="#a3c4c62a3e783bdb" class="i method">ProcessAsync</a>(<span class="r5 r">message</span>, <span class="r6 r">pipeline</span>, <b>false</b>).<a href="../../Shared/TaskExtensions.cs.html#0c5100eb7549725f" class="i method">EnsureCompleted</a>();
        }
 
        <b>public override</b> <span class="t t">ValueTask</span> <a id="b888fd3b301f21eb" href="../../R/b888fd3b301f21eb.html" target="n" data-glyph="72,1" class="i method">ProcessAsync</a>(<a href="../../HttpMessage.cs.html#0d3a69186ac45549" class="t t">HttpMessage</a> <span id="r7 rd" class="r7 r">message</span>, <span class="t t">ReadOnlyMemory</span>&lt;<a href="../HttpPipelinePolicy.cs.html#afce2b8855e35f1f" class="t t">HttpPipelinePolicy</a>&gt; <span id="r8 rd" class="r8 r">pipeline</span>)
        {
            <b>if</b> (!<a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>.<a href="@1@netstandard/A.html#69fcbb5c318fe603" class="i method">IsEnabled</a>())
            {
                <b>return</b> <a href="../HttpPipelinePolicy.cs.html#7c63499783985c7e" class="i method">ProcessNextAsync</a>(<span class="r7 r">message</span>, <span class="r8 r">pipeline</span>);
            }
 
            <b>return</b> <a href="#a3c4c62a3e783bdb" class="i method">ProcessAsync</a>(<span class="r7 r">message</span>, <span class="r8 r">pipeline</span>, <b>true</b>);
        }
 
        <b>private async</b> <span class="t t">ValueTask</span> <a id="a3c4c62a3e783bdb" href="../../R/a3c4c62a3e783bdb.html" target="n" data-glyph="76,1" class="i method">ProcessAsync</a>(<a href="../../HttpMessage.cs.html#0d3a69186ac45549" class="t t">HttpMessage</a> <span id="r9 rd" class="r9 r">message</span>, <span class="t t">ReadOnlyMemory</span>&lt;<a href="../HttpPipelinePolicy.cs.html#afce2b8855e35f1f" class="t t">HttpPipelinePolicy</a>&gt; <span id="r10 rd" class="r10 r">pipeline</span>, <b>bool</b> <span id="r11 rd" class="r11 r">async</span>)
        {
            <a href="../../Request.cs.html#a519adbefba2e288" class="t t">Request</a> <span id="r12 rd" class="r12 r">request</span> = <span class="r9 r">message</span>.<a href="../../HttpMessage.cs.html#34fe7bc5cf4f67d5" class="i property">Request</a>;
 
            <a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#d35d77ffc68afeaf" class="i method">Request</a>(<span class="r12 r">request</span>.<a href="../../Request.cs.html#b180337469e3b6af" class="i property">ClientRequestId</a>, <span class="r12 r">request</span>.<a href="../../Request.cs.html#38781a2f20c88339" class="i property">Method</a>.<a href="../../RequestMethod.cs.html#d435400c76d319cc" class="i method">ToString</a>(), <a href="#8f7cd151e5a5f53f" class="i method">FormatUri</a>(<span class="r12 r">request</span>.<a href="../../Request.cs.html#a3954f29cb1a883c" class="i property">Uri</a>), <a href="#bd42cfe579a1a3af" class="i method">FormatHeaders</a>(<span class="r12 r">request</span>.<a href="../../Request.cs.html#e6c474e362de2358" class="i property">Headers</a>), <a href="#a0500039cfaca06c" class="i field">_assemblyName</a>);
 
            <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <span id="r13 rd" class="r13 r">requestTextEncoding</span> = <b>null</b>;
 
            <b>if</b> (<span class="r12 r">request</span>.<a href="../../Request.cs.html#be4c88cef4f971a1" class="i method">TryGetHeader</a>(<a href="../../HttpHeader.cs.html#c33e005b997e77ad" class="t t">HttpHeader</a>.<a href="../../HttpHeader.cs.html#9d4171ae0141e914" class="t t">Names</a>.<a href="../../HttpHeader.cs.html#bc72ca0e1abef094" class="i property">ContentType</a>, <b>out</b> <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r14 rd" class="r14 r">contentType</span>))
            {
                <a href="../../Shared/ContentTypeUtilities.cs.html#ccb9f9333821b24f" class="t t">ContentTypeUtilities</a>.<a href="../../Shared/ContentTypeUtilities.cs.html#23a11782ee4ca758" class="i method">TryGetTextEncoding</a>(<span class="r14 r">contentType</span>, <b>out</b> <span class="r13 r">requestTextEncoding</span>);
            }
 
            <a href="#fb48da9fa81e9917" class="k">var</a> <span id="r15 rd" class="r15 r">logWrapper</span> = <b>new</b> <a href="#1739e7d0dc5f4481" class="t constructor">ContentEventSourceWrapper</a>(<a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>, <a href="#814f0c7e1af7855f" class="i field">_logContent</a>, <a href="#c89975858b8237a5" class="i field">_maxLength</a>, <span class="r9 r">message</span>.<a href="../../HttpMessage.cs.html#2ab6b786b7d8daa8" class="i property">CancellationToken</a>);
 
            <b>await</b> <span class="r15 r">logWrapper</span>.<a href="#b92d540f381256c8" class="i method">LogAsync</a>(<span class="r12 r">request</span>.<a href="../../Request.cs.html#b180337469e3b6af" class="i property">ClientRequestId</a>, <span class="r12 r">request</span>.<a href="../../Request.cs.html#1517233642d6c203" class="i property">Content</a>, <span class="r13 r">requestTextEncoding</span>, <span class="r11 r">async</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>).<a href="../../Shared/TaskExtensions.cs.html#582366f5bca63de7" class="i method">EnsureCompleted</a>(<span class="r11 r">async</span>);
 
            <a href="@1@netstandard/A.html#e566178cce890c36" class="k">var</a> <span id="r16 rd" class="r16 r">before</span> = <a href="@1@netstandard/A.html#ceb0ba9cc88de82e" class="t t">Stopwatch</a>.<a href="@1@netstandard/A.html#69c6c3137e12dab4" class="i method">GetTimestamp</a>();
 
            <b>try</b>
            {
                <b>if</b> (<span class="r11 r">async</span>)
                {
                    <b>await</b> <a href="../HttpPipelinePolicy.cs.html#7c63499783985c7e" class="i method">ProcessNextAsync</a>(<span class="r9 r">message</span>, <span class="r10 r">pipeline</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>);
                }
                <b>else</b>
                {
                    <a href="../HttpPipelinePolicy.cs.html#ed2e35356f769a1b" class="i method">ProcessNext</a>(<span class="r9 r">message</span>, <span class="r10 r">pipeline</span>);
                }
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r17 rd" class="r17 r">ex</span>)
            {
                <a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#c9a410fff18374dd" class="i method">ExceptionResponse</a>(<span class="r12 r">request</span>.<a href="../../Request.cs.html#b180337469e3b6af" class="i property">ClientRequestId</a>, <span class="r17 r">ex</span>.<a href="@1@netstandard/A.html#e2e19f4ed8da81aa" class="i method">ToString</a>());
                <b>throw</b>;
            }
 
            <a href="@1@netstandard/A.html#e566178cce890c36" class="k">var</a> <span id="r18 rd" class="r18 r">after</span> = <a href="@1@netstandard/A.html#ceb0ba9cc88de82e" class="t t">Stopwatch</a>.<a href="@1@netstandard/A.html#69c6c3137e12dab4" class="i method">GetTimestamp</a>();
 
            <b>bool</b> <span id="r19 rd" class="r19 r">isError</span> = <span class="r9 r">message</span>.<a href="../../HttpMessage.cs.html#e098f6f0a9341072" class="i property">ResponseClassifier</a>.<a href="../../ResponseClassifier.cs.html#4e59b113d4e05ee4" class="i method">IsErrorResponse</a>(<span class="r9 r">message</span>);
 
            <a href="../../Response.cs.html#ad97b1910f5ca3eb" class="t t">Response</a> <span id="r20 rd" class="r20 r">response</span> = <span class="r9 r">message</span>.<a href="../../HttpMessage.cs.html#0bc18a223263c879" class="i property">Response</a>;
            <a href="../../Shared/ContentTypeUtilities.cs.html#ccb9f9333821b24f" class="t t">ContentTypeUtilities</a>.<a href="../../Shared/ContentTypeUtilities.cs.html#23a11782ee4ca758" class="i method">TryGetTextEncoding</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#9f6adbd7e81f8000" class="i property">Headers</a>.<a href="../../ResponseHeaders.cs.html#5944e38950e96214" class="i property">ContentType</a>, <b>out</b> <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <span id="r21 rd" class="r21 r">responseTextEncoding</span>);
 
            <b>bool</b> <span id="r22 rd" class="r22 r">wrapResponseContent</span> = <span class="r20 r">response</span>.<a href="../../Response.cs.html#e05b388d35abae58" class="i property">ContentStream</a> != <b>null</b> &amp;&amp;
                                       <span class="r20 r">response</span>.<a href="../../Response.cs.html#e05b388d35abae58" class="i property">ContentStream</a>?.<a href="@1@netstandard/A.html#73e4413d240b4cee" class="i property">CanSeek</a> == <b>false</b> &amp;&amp;
                                       <span class="r15 r">logWrapper</span>.<a href="#71e7ffd081007c68" class="i method">IsEnabled</a>(<span class="r19 r">isError</span>);
 
            <b>double</b> <span id="r23 rd" class="r23 r">elapsed</span> = (<span class="r18 r">after</span> - <span class="r16 r">before</span>) / (<b>double</b>)<a href="@1@netstandard/A.html#ceb0ba9cc88de82e" class="t t">Stopwatch</a>.<a href="@1@netstandard/A.html#886996f7146ffe4b" class="i field">Frequency</a>;
 
            <b>if</b> (<span class="r19 r">isError</span>)
            {
                <a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#d725bfaa6ee9d139" class="i method">ErrorResponse</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#0d9a1de2c559a434" class="i property">ClientRequestId</a>, <span class="r20 r">response</span>.<a href="../../Response.cs.html#53e6401c580f9719" class="i property">Status</a>, <span class="r20 r">response</span>.<a href="../../Response.cs.html#54274fa4acb84eec" class="i property">ReasonPhrase</a>, <a href="#bd42cfe579a1a3af" class="i method">FormatHeaders</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#9f6adbd7e81f8000" class="i property">Headers</a>), <span class="r23 r">elapsed</span>);
            }
            <b>else</b>
            {
                <a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#264d101c2e416cbc" class="i method">Response</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#0d9a1de2c559a434" class="i property">ClientRequestId</a>, <span class="r20 r">response</span>.<a href="../../Response.cs.html#53e6401c580f9719" class="i property">Status</a>, <span class="r20 r">response</span>.<a href="../../Response.cs.html#54274fa4acb84eec" class="i property">ReasonPhrase</a>, <a href="#bd42cfe579a1a3af" class="i method">FormatHeaders</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#9f6adbd7e81f8000" class="i property">Headers</a>), <span class="r23 r">elapsed</span>);
            }
 
            <b>if</b> (<span class="r22 r">wrapResponseContent</span>)
            {
                <span class="r20 r">response</span>.<a href="../../Response.cs.html#e05b388d35abae58" class="i property">ContentStream</a> = <b>new</b> <a href="#961e9f42118a2e0c" class="t constructor">LoggingStream</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#0d9a1de2c559a434" class="i property">ClientRequestId</a>, <span class="r15 r">logWrapper</span>, <a href="#c89975858b8237a5" class="i field">_maxLength</a>, <span class="r20 r">response</span>.<a href="../../Response.cs.html#e05b388d35abae58" class="i property">ContentStream</a>!, <span class="r19 r">isError</span>, <span class="r21 r">responseTextEncoding</span>);
            }
            <b>else</b>
            {
                <b>await</b> <span class="r15 r">logWrapper</span>.<a href="#4ab6c67656f018ee" class="i method">LogAsync</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#0d9a1de2c559a434" class="i property">ClientRequestId</a>, <span class="r19 r">isError</span>, <span class="r20 r">response</span>.<a href="../../Response.cs.html#e05b388d35abae58" class="i property">ContentStream</a>, <span class="r21 r">responseTextEncoding</span>, <span class="r11 r">async</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>).<a href="../../Shared/TaskExtensions.cs.html#582366f5bca63de7" class="i method">EnsureCompleted</a>(<span class="r11 r">async</span>);
            }
 
            <b>if</b> (<span class="r23 r">elapsed</span> &gt; <a href="#a24d55afab05e6ef" class="i field">RequestTooLongTime</a>)
            {
                <a href="#572bf2d7183a2d25" class="i field">s_eventSource</a>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#66ab7517b23eccd0" class="i method">ResponseDelay</a>(<span class="r20 r">response</span>.<a href="../../Response.cs.html#0d9a1de2c559a434" class="i property">ClientRequestId</a>, <span class="r23 r">elapsed</span>);
            }
        }
 
        <b>private string</b> <a id="8f7cd151e5a5f53f" href="../../R/8f7cd151e5a5f53f.html" target="n" data-glyph="76,1" class="i method">FormatUri</a>(<a href="../../RequestUriBuilder.cs.html#1bdcf0c93f2c4779" class="t t">RequestUriBuilder</a> <span id="r24 rd" class="r24 r">requestUri</span>)
        {
            <b>return</b> <a href="#3d0ff36a2cfe2c41" class="i field">_sanitizer</a>.<a href="../../Shared/HttpMessageSanitizer.cs.html#5d69ca0b461fb504" class="i method">SanitizeUrl</a>(<span class="r24 r">requestUri</span>.<a href="../../RequestUriBuilder.cs.html#3b2940e7eb7e5820" class="i method">ToString</a>());
        }
 
        <b>private string</b> <a id="bd42cfe579a1a3af" href="../../R/bd42cfe579a1a3af.html" target="n" data-glyph="76,1" class="i method">FormatHeaders</a>(<a href="@1@netstandard/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="../../HttpHeader.cs.html#c33e005b997e77ad" class="t t">HttpHeader</a>&gt; <span id="r25 rd" class="r25 r">headers</span>)
        {
            <a href="@1@netstandard/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r26 rd" class="r26 r">stringBuilder</span> = <b>new</b> <a href="@1@netstandard/A.html#6e631639c1e2746b" class="t constructor">StringBuilder</a>();
            <b>foreach</b> (<a href="../../HttpHeader.cs.html#c33e005b997e77ad" class="t t">HttpHeader</a> <span id="r27 rd" class="r27 r">header</span> <b>in</b> <span class="r25 r">headers</span>)
            {
                <span class="r26 r">stringBuilder</span>.<a href="@1@netstandard/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="r27 r">header</span>.<a href="../../HttpHeader.cs.html#403719d9eef522e3" class="i property">Name</a>);
                <span class="r26 r">stringBuilder</span>.<a href="@1@netstandard/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;:&#39;</span>);
                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r28 rd" class="r28 r">newValue</span> = <a href="#3d0ff36a2cfe2c41" class="i field">_sanitizer</a>.<a href="../../Shared/HttpMessageSanitizer.cs.html#65b0b53330943806" class="i method">SanitizeHeader</a>(<span class="r27 r">header</span>.<a href="../../HttpHeader.cs.html#403719d9eef522e3" class="i property">Name</a>, <span class="r27 r">header</span>.<a href="../../HttpHeader.cs.html#d75c2f422fc6c238" class="i property">Value</a>);
                <span class="r26 r">stringBuilder</span>.<a href="@1@netstandard/A.html#73bc75596acbac77" class="i method">AppendLine</a>(<span class="r28 r">newValue</span>);
            }
            <b>return</b> <span class="r26 r">stringBuilder</span>.<a href="@1@netstandard/A.html#5a97da49a158a3c9" class="i method">ToString</a>();
        }
 
        <b>private class</b> <a id="27ebf2fffe6c0f84" href="../../R/27ebf2fffe6c0f84.html" target="n" data-glyph="4,1" class="t t">LoggingStream</a> : <a href="ReadOnlyStream.cs.html#99665dd7d924a609" class="t t">ReadOnlyStream</a>
        {
            <b>private readonly string</b> <a id="478f3585042993c1" href="../../R/478f3585042993c1.html" target="n" data-glyph="46,2" class="i field">_requestId</a>;
 
            <b>private readonly</b> <a href="#fb48da9fa81e9917" class="t t">ContentEventSourceWrapper</a> <a id="8d403715a53be223" href="../../R/8d403715a53be223.html" target="n" data-glyph="46,2" class="i field">_eventSourceWrapper</a>;
 
            <b>private int</b> <a id="6767b183c4fc3146" href="../../R/6767b183c4fc3146.html" target="n" data-glyph="46,2" class="i field">_maxLoggedBytes</a>;
 
            <b>private readonly</b> <a href="@1@netstandard/A.html#f956b0c07e86df64" class="t t">Stream</a> <a id="923dcfb7fb607bb8" href="../../R/923dcfb7fb607bb8.html" target="n" data-glyph="46,2" class="i field">_originalStream</a>;
 
            <b>private readonly bool</b> <a id="84db319f4f404ad4" href="../../R/84db319f4f404ad4.html" target="n" data-glyph="46,2" class="i field">_error</a>;
 
            <b>private readonly</b> <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <a id="f3f11d1d59c00054" href="../../R/f3f11d1d59c00054.html" target="n" data-glyph="46,2" class="i field">_textEncoding</a>;
 
            <b>private int</b> <a id="e7dce5b89309d739" href="../../R/e7dce5b89309d739.html" target="n" data-glyph="46,2" class="i field">_blockNumber</a>;
 
            <b>public</b> <a id="961e9f42118a2e0c" href="../../R/961e9f42118a2e0c.html" target="n" data-glyph="72,2" class="t constructor">LoggingStream</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r29 rd" class="r29 r">requestId</span>, <a href="#fb48da9fa81e9917" class="t t">ContentEventSourceWrapper</a> <span id="r30 rd" class="r30 r">eventSourceWrapper</span>, <b>int</b> <span id="r31 rd" class="r31 r">maxLoggedBytes</span>, <a href="@1@netstandard/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r32 rd" class="r32 r">originalStream</span>, <b>bool</b> <span id="r33 rd" class="r33 r">error</span>, <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <span id="r34 rd" class="r34 r">textEncoding</span>)
            {
                <span class="c">// Should only wrap non-seekable streams</span>
                <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(!<span class="r32 r">originalStream</span>.<a href="@1@netstandard/A.html#73e4413d240b4cee" class="i property">CanSeek</a>);
                <a href="#478f3585042993c1" class="i field">_requestId</a> = <span class="r29 r">requestId</span>;
                <a href="#8d403715a53be223" class="i field">_eventSourceWrapper</a> = <span class="r30 r">eventSourceWrapper</span>;
                <a href="#6767b183c4fc3146" class="i field">_maxLoggedBytes</a> = <span class="r31 r">maxLoggedBytes</span>;
                <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a> = <span class="r32 r">originalStream</span>;
                <a href="#84db319f4f404ad4" class="i field">_error</a> = <span class="r33 r">error</span>;
                <a href="#f3f11d1d59c00054" class="i field">_textEncoding</a> = <span class="r34 r">textEncoding</span>;
            }
 
            <b>public override long</b> <a id="2ef88d565e483087" href="../../R/2ef88d565e483087.html" target="n" data-glyph="72,2" class="i method">Seek</a>(<b>long</b> <span id="r35 rd" class="r35 r">offset</span>, <a href="@1@netstandard/A.html#2cc1cf6635f00a52" class="t t">SeekOrigin</a> <span id="r36 rd" class="r36 r">origin</span>)
            {
                <b>return</b> <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#eb5599035c4388ce" class="i method">Seek</a>(<span class="r35 r">offset</span>, <span class="r36 r">origin</span>);
            }
 
            <b>public override int</b> <a id="732337c0ed1a61fd" href="../../R/732337c0ed1a61fd.html" target="n" data-glyph="72,2" class="i method">Read</a>(<b>byte</b>[] <span id="r37 rd" class="r37 r">buffer</span>, <b>int</b> <span id="r38 rd" class="r38 r">offset</span>, <b>int</b> <span id="r39 rd" class="r39 r">count</span>)
            {
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r40 rd" class="r40 r">result</span> = <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#6fb9c001d7524ba2" class="i method">Read</a>(<span class="r37 r">buffer</span>, <span class="r38 r">offset</span>, <span class="r39 r">count</span>);
 
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r41 rd" class="r41 r">countToLog</span> = <span class="r40 r">result</span>;
                <a href="#aa6f596770c1f455" class="i method">DecrementLength</a>(<b>ref</b> <span class="r41 r">countToLog</span>);
                <a href="#a5b45154e152e9c1" class="i method">LogBuffer</a>(<span class="r37 r">buffer</span>, <span class="r38 r">offset</span>, <span class="r41 r">countToLog</span>);
 
                <b>return</b> <span class="r40 r">result</span>;
            }
 
            <b>private void</b> <a id="a5b45154e152e9c1" href="../../R/a5b45154e152e9c1.html" target="n" data-glyph="76,2" class="i method">LogBuffer</a>(<b>byte</b>[] <span id="r42 rd" class="r42 r">buffer</span>, <b>int</b> <span id="r43 rd" class="r43 r">offset</span>, <b>int</b> <span id="r44 rd" class="r44 r">count</span>)
            {
                <b>if</b> (<span class="r44 r">count</span> == 0)
                {
                    <b>return</b>;
                }
 
                <a href="#8d403715a53be223" class="i field">_eventSourceWrapper</a>.<a href="#66521a3deaa5a1b4" class="i method">Log</a>(<a href="#478f3585042993c1" class="i field">_requestId</a>, <a href="#84db319f4f404ad4" class="i field">_error</a>, <span class="r42 r">buffer</span>, <span class="r43 r">offset</span>, <span class="r44 r">count</span>, <a href="#f3f11d1d59c00054" class="i field">_textEncoding</a>, <a href="#e7dce5b89309d739" class="i field">_blockNumber</a>);
 
                <a href="#e7dce5b89309d739" class="i field">_blockNumber</a>++;
            }
 
            <b>public override async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<b>int</b>&gt; <a id="b575105695d15530" href="../../R/b575105695d15530.html" target="n" data-glyph="72,2" class="i method">ReadAsync</a>(<b>byte</b>[] <span id="r45 rd" class="r45 r">buffer</span>, <b>int</b> <span id="r46 rd" class="r46 r">offset</span>, <b>int</b> <span id="r47 rd" class="r47 r">count</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r48 rd" class="r48 r">cancellationToken</span>)
            {
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CA1835</span> <span class="c">// ReadAsync(Memory&lt;&gt;) overload is not available in all targets</span>
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r49 rd" class="r49 r">result</span> = <b>await</b> <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#e224b4bec8748849" class="i method">ReadAsync</a>(<span class="r45 r">buffer</span>, <span class="r46 r">offset</span>, <span class="r47 r">count</span>, <span class="r48 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="c">// ReadAsync(Memory&lt;&gt;) overload is not available in all targets</span>
 
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r50 rd" class="r50 r">countToLog</span> = <span class="r49 r">result</span>;
                <a href="#aa6f596770c1f455" class="i method">DecrementLength</a>(<b>ref</b> <span class="r50 r">countToLog</span>);
                <a href="#a5b45154e152e9c1" class="i method">LogBuffer</a>(<span class="r45 r">buffer</span>, <span class="r46 r">offset</span>, <span class="r50 r">countToLog</span>);
 
                <b>return</b> <span class="r49 r">result</span>;
            }
 
            <b>public override bool</b> <a id="c1c1b381c04d7739" href="../../R/c1c1b381c04d7739.html" target="n" data-glyph="102,2" class="i property">CanRead</a> =&gt; <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#9d92fb3890523d38" class="i property">CanRead</a>;
            <b>public override bool</b> <a id="118a357ed69a14a0" href="../../R/118a357ed69a14a0.html" target="n" data-glyph="102,2" class="i property">CanSeek</a> =&gt; <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#73e4413d240b4cee" class="i property">CanSeek</a>;
            <b>public override long</b> <a id="d17caaa9149b0a76" href="../../R/d17caaa9149b0a76.html" target="n" data-glyph="102,2" class="i property">Length</a> =&gt; <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#48b7e39cfd844dc5" class="i property">Length</a>;
            <b>public override long</b> <a id="de6ca2a66932e958" href="../../R/de6ca2a66932e958.html" target="n" data-glyph="102,2" class="i property">Position</a>
            {
                <b>get</b> =&gt; <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#35112b2a53fb536a" class="i property">Position</a>;
                <b>set</b> =&gt; <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#35112b2a53fb536a" class="i property">Position</a> = <b>value</b>;
            }
 
            <b>public override void</b> <a id="78d17d3aa88d77bc" href="../../R/78d17d3aa88d77bc.html" target="n" data-glyph="72,2" class="i method">Close</a>()
            {
                <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#dc4ffe046b847b84" class="i method">Close</a>();
            }
 
            <b>protected override void</b> <a id="4e1d7390e6ce101b" href="../../R/4e1d7390e6ce101b.html" target="n" data-glyph="75,2" class="i method">Dispose</a>(<b>bool</b> <span id="r51 rd" class="r51 r">disposing</span>)
            {
                <a href="ReadOnlyStream.cs.html#99665dd7d924a609" class="k">base</a>.<a href="@1@netstandard/A.html#f35c7d226df4a465" class="i method">Dispose</a>(<span class="r51 r">disposing</span>);
 
                <a href="#923dcfb7fb607bb8" class="i field">_originalStream</a>.<a href="@1@netstandard/A.html#f1b4285950a82354" class="i method">Dispose</a>();
            }
 
            <b>private void</b> <a id="aa6f596770c1f455" href="../../R/aa6f596770c1f455.html" target="n" data-glyph="76,2" class="i method">DecrementLength</a>(<b>ref int</b> <span id="r52 rd" class="r52 r">count</span>)
            {
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r53 rd" class="r53 r">left</span> = <a href="@1@netstandard/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@1@netstandard/A.html#f441d55c88d635ad" class="i method">Min</a>(<span class="r52 r">count</span>, <a href="#6767b183c4fc3146" class="i field">_maxLoggedBytes</a>);
                <span class="r52 r">count</span> = <span class="r53 r">left</span>;
                <a href="#6767b183c4fc3146" class="i field">_maxLoggedBytes</a> -= <span class="r52 r">count</span>;
            }
        }
 
        <b>private readonly struct</b> <a id="fb48da9fa81e9917" href="../../R/fb48da9fa81e9917.html" target="n" data-glyph="112,1" class="t t"><span id="52376dbf95fcad1f">ContentEventSourceWrapper</span></a>
        {
            <b>private const int</b> <a id="4833e9b06bf0207c" href="../../R/4833e9b06bf0207c.html" target="n" data-glyph="10,2" class="i field">CopyBufferSize</a> = 8 * 1024;
            <b>private readonly</b> <a href="../../Diagnostics/AzureCoreEventSource.cs.html#01d1d54631cb1734" class="t t">AzureCoreEventSource</a>? <a id="e8c566da075fd046" href="../../R/e8c566da075fd046.html" target="n" data-glyph="46,2" class="i field">_eventSource</a>;
 
            <b>private readonly int</b> <a id="abd081036be41a82" href="../../R/abd081036be41a82.html" target="n" data-glyph="46,2" class="i field">_maxLength</a>;
 
            <b>private readonly</b> <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <a id="eeaee37d9363e733" href="../../R/eeaee37d9363e733.html" target="n" data-glyph="46,2" class="i field">_cancellationToken</a>;
 
            <b>public</b> <a id="1739e7d0dc5f4481" href="../../R/1739e7d0dc5f4481.html" target="n" data-glyph="72,2" class="t constructor">ContentEventSourceWrapper</a>(<a href="../../Diagnostics/AzureCoreEventSource.cs.html#01d1d54631cb1734" class="t t">AzureCoreEventSource</a> <span id="r54 rd" class="r54 r">eventSource</span>, <b>bool</b> <span id="r55 rd" class="r55 r">logContent</span>, <b>int</b> <span id="r56 rd" class="r56 r">maxLength</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r57 rd" class="r57 r">cancellationToken</span>)
            {
                <a href="#e8c566da075fd046" class="i field">_eventSource</a> = <span class="r55 r">logContent</span> ? <span class="r54 r">eventSource</span> : <b>null</b>;
                <a href="#abd081036be41a82" class="i field">_maxLength</a> = <span class="r56 r">maxLength</span>;
                <a href="#eeaee37d9363e733" class="i field">_cancellationToken</a> = <span class="r57 r">cancellationToken</span>;
            }
 
            <b>public async</b> <span class="t t">ValueTask</span> <a id="4ab6c67656f018ee" href="../../R/4ab6c67656f018ee.html" target="n" data-glyph="72,2" class="i method">LogAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r58 rd" class="r58 r">requestId</span>, <b>bool</b> <span id="r59 rd" class="r59 r">isError</span>, <a href="@1@netstandard/A.html#f956b0c07e86df64" class="t t">Stream</a>? <span id="r60 rd" class="r60 r">stream</span>, <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <span id="r61 rd" class="r61 r">textEncoding</span>, <b>bool</b> <span id="r62 rd" class="r62 r">async</span>)
            {
                <a href="#74877d74fd8acced" class="t t">EventType</a> <span id="r63 rd" class="r63 r">eventType</span> = <a href="#705968932c6185e5" class="i method">ResponseOrError</a>(<span class="r59 r">isError</span>);
 
                <b>if</b> (<span class="r60 r">stream</span> == <b>null</b> || !<a href="#53504a83a29e8ef7" class="i method">IsEnabled</a>(<span class="r63 r">eventType</span>))
                {
                    <b>return</b>;
                }
 
                <b>var</b> <span id="r64 rd" class="r64 r">bytes</span> = <b>await</b> <a href="#0ce2f4a8321bd767" class="i method">FormatAsync</a>(<span class="r60 r">stream</span>, <span class="r62 r">async</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>).<a href="../../Shared/TaskExtensions.cs.html#dcb1ea8954073c41" class="i method">EnsureCompleted</a>(<span class="r62 r">async</span>);
                <a href="#86ca00e454a1715d" class="i method">Log</a>(<span class="r58 r">requestId</span>, <span class="r63 r">eventType</span>, <span class="r64 r">bytes</span>, <span class="r61 r">textEncoding</span>);
            }
 
            <b>public async</b> <span class="t t">ValueTask</span> <a id="b92d540f381256c8" href="../../R/b92d540f381256c8.html" target="n" data-glyph="72,2" class="i method">LogAsync</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r65 rd" class="r65 r">requestId</span>, <a href="../../RequestContent.cs.html#81cccf3fb8acf2c9" class="t t">RequestContent</a>? <span id="r66 rd" class="r66 r">content</span>, <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <span id="r67 rd" class="r67 r">textEncoding</span>, <b>bool</b> <span id="r68 rd" class="r68 r">async</span>)
            {
                <a href="#74877d74fd8acced" class="t t">EventType</a> <span id="r69 rd" class="r69 r">eventType</span> = <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#fed381f565669910" class="i field">Request</a>;
 
                <b>if</b> (<span class="r66 r">content</span> == <b>null</b> || !<a href="#53504a83a29e8ef7" class="i method">IsEnabled</a>(<span class="r69 r">eventType</span>))
                {
                    <b>return</b>;
                }
 
                <b>var</b> <span id="r70 rd" class="r70 r">bytes</span> = <b>await</b> <a href="#92800f224561dcb3" class="i method">FormatAsync</a>(<span class="r66 r">content</span>, <span class="r68 r">async</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>).<a href="../../Shared/TaskExtensions.cs.html#dcb1ea8954073c41" class="i method">EnsureCompleted</a>(<span class="r68 r">async</span>);
 
                <a href="#86ca00e454a1715d" class="i method">Log</a>(<span class="r65 r">requestId</span>, <span class="r69 r">eventType</span>, <span class="r70 r">bytes</span>, <span class="r67 r">textEncoding</span>);
            }
 
            <b>public void</b> <a id="66521a3deaa5a1b4" href="../../R/66521a3deaa5a1b4.html" target="n" data-glyph="72,2" class="i method">Log</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r71 rd" class="r71 r">requestId</span>, <b>bool</b> <span id="r72 rd" class="r72 r">isError</span>, <b>byte</b>[] <span id="r73 rd" class="r73 r">buffer</span>, <b>int</b> <span id="r74 rd" class="r74 r">offset</span>, <b>int</b> <span id="r75 rd" class="r75 r">length</span>, <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <span id="r76 rd" class="r76 r">textEncoding</span>, <b>int</b>? <span id="r77 rd" class="r77 r">block</span> = <b>null</b>)
            {
                <a href="#74877d74fd8acced" class="t t">EventType</a> <span id="r78 rd" class="r78 r">eventType</span> = <a href="#705968932c6185e5" class="i method">ResponseOrError</a>(<span class="r72 r">isError</span>);
 
                <b>if</b> (<span class="r73 r">buffer</span> == <b>null</b> || !<a href="#53504a83a29e8ef7" class="i method">IsEnabled</a>(<span class="r78 r">eventType</span>))
                {
                    <b>return</b>;
                }
 
                <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r79 rd" class="r79 r">logLength</span> = <a href="@1@netstandard/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@1@netstandard/A.html#f441d55c88d635ad" class="i method">Min</a>(<span class="r75 r">length</span>, <a href="#abd081036be41a82" class="i field">_maxLength</a>);
 
                <b>byte</b>[] <span id="r80 rd" class="r80 r">bytes</span>;
                <b>if</b> (<span class="r75 r">length</span> == <span class="r79 r">logLength</span> &amp;&amp; <span class="r74 r">offset</span> == 0)
                {
                    <span class="r80 r">bytes</span> = <span class="r73 r">buffer</span>;
                }
                <b>else</b>
                {
                    <span class="r80 r">bytes</span> = <b>new</b> <b>byte</b>[<span class="r79 r">logLength</span>];
                    <a href="@1@netstandard/A.html#156e066ecc4ccedf" class="t t">Array</a>.<a href="@1@netstandard/A.html#7441c6721593042c" class="i method">Copy</a>(<span class="r73 r">buffer</span>, <span class="r74 r">offset</span>, <span class="r80 r">bytes</span>, 0, <span class="r79 r">logLength</span>);
                }
 
                <a href="#86ca00e454a1715d" class="i method">Log</a>(<span class="r71 r">requestId</span>, <span class="r78 r">eventType</span>, <span class="r80 r">bytes</span>, <span class="r76 r">textEncoding</span>, <span class="r77 r">block</span>);
            }
 
            <b>public bool</b> <a id="71e7ffd081007c68" href="../../R/71e7ffd081007c68.html" target="n" data-glyph="72,2" class="i method">IsEnabled</a>(<b>bool</b> <span id="r81 rd" class="r81 r">isError</span>)
            {
                <b>return</b> <a href="#53504a83a29e8ef7" class="i method">IsEnabled</a>(<a href="#705968932c6185e5" class="i method">ResponseOrError</a>(<span class="r81 r">isError</span>));
            }
 
            <b>private bool</b> <a id="53504a83a29e8ef7" href="../../R/53504a83a29e8ef7.html" target="n" data-glyph="76,2" class="i method">IsEnabled</a>(<a href="#74877d74fd8acced" class="t t">EventType</a> <span id="r82 rd" class="r82 r">errorResponse</span>)
            {
                <b>return</b> <a href="#e8c566da075fd046" class="i field">_eventSource</a> != <b>null</b> &amp;&amp;
                       (<a href="#e8c566da075fd046" class="i field">_eventSource</a>.<a href="@1@netstandard/A.html#189a4d7f2aeba885" class="i method">IsEnabled</a>(<a href="@1@netstandard/A.html#d492a500d07778e6" class="t t">EventLevel</a>.<a href="@1@netstandard/A.html#3f60527050b58a1a" class="i field">Informational</a>, <a href="@1@netstandard/A.html#d7541e9a7907a668" class="t t">EventKeywords</a>.<a href="@1@netstandard/A.html#e344fd2b5cf9fdf2" class="i field">All</a>) ||
                       (<span class="r82 r">errorResponse</span> == <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#aaf39e9f8bda37d9" class="i field">ErrorResponse</a> &amp;&amp; <a href="#e8c566da075fd046" class="i field">_eventSource</a>.<a href="@1@netstandard/A.html#189a4d7f2aeba885" class="i method">IsEnabled</a>(<a href="@1@netstandard/A.html#d492a500d07778e6" class="t t">EventLevel</a>.<a href="@1@netstandard/A.html#c09cab3d595581b8" class="i field">Warning</a>, <a href="@1@netstandard/A.html#d7541e9a7907a668" class="t t">EventKeywords</a>.<a href="@1@netstandard/A.html#e344fd2b5cf9fdf2" class="i field">All</a>)));
            }
 
            <b>private async</b> <span class="t t">ValueTask</span>&lt;<b>byte</b>[]&gt; <a id="92800f224561dcb3" href="../../R/92800f224561dcb3.html" target="n" data-glyph="76,2" class="i method">FormatAsync</a>(<a href="../../RequestContent.cs.html#81cccf3fb8acf2c9" class="t t">RequestContent</a> <span id="r83 rd" class="r83 r">requestContent</span>, <b>bool</b> <span id="r84 rd" class="r84 r">async</span>)
            {
                <b>using</b> <a href="#2e60759a3dfbfd56" class="k">var</a> <span id="r85 rd" class="r85 r">memoryStream</span> = <b>new</b> <a href="#dc81804b44f04ff7" class="t constructor">MaxLengthStream</a>(<a href="#abd081036be41a82" class="i field">_maxLength</a>);
 
                <b>if</b> (<span class="r84 r">async</span>)
                {
                    <b>await</b> <span class="r83 r">requestContent</span>.<a href="../../RequestContent.cs.html#04fd90344221ce03" class="i method">WriteToAsync</a>(<span class="r85 r">memoryStream</span>, <a href="#eeaee37d9363e733" class="i field">_cancellationToken</a>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>else</b>
                {
                    <span class="r83 r">requestContent</span>.<a href="../../RequestContent.cs.html#0662e44f35dd6163" class="i method">WriteTo</a>(<span class="r85 r">memoryStream</span>, <a href="#eeaee37d9363e733" class="i field">_cancellationToken</a>);
                }
 
                <b>return</b> <span class="r85 r">memoryStream</span>.<a href="@1@netstandard/A.html#5df5fc757781f05e" class="i method">ToArray</a>();
            }
 
            <b>private async</b> <span class="t t">ValueTask</span>&lt;<b>byte</b>[]&gt; <a id="0ce2f4a8321bd767" href="../../R/0ce2f4a8321bd767.html" target="n" data-glyph="76,2" class="i method">FormatAsync</a>(<a href="@1@netstandard/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r86 rd" class="r86 r">content</span>, <b>bool</b> <span id="r87 rd" class="r87 r">async</span>)
            {
                <b>using</b> <a href="#2e60759a3dfbfd56" class="k">var</a> <span id="r88 rd" class="r88 r">memoryStream</span> = <b>new</b> <a href="#dc81804b44f04ff7" class="t constructor">MaxLengthStream</a>(<a href="#abd081036be41a82" class="i field">_maxLength</a>);
 
                <b>if</b> (<span class="r87 r">async</span>)
                {
                    <b>await</b> <span class="r86 r">content</span>.<a href="@1@netstandard/A.html#8048a9680abdd13b" class="i method">CopyToAsync</a>(<span class="r88 r">memoryStream</span>, <a href="#4833e9b06bf0207c" class="i field">CopyBufferSize</a>, <a href="#eeaee37d9363e733" class="i field">_cancellationToken</a>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>else</b>
                {
                    <span class="r86 r">content</span>.<a href="@1@netstandard/A.html#295ec16c77d4fafb" class="i method">CopyTo</a>(<span class="r88 r">memoryStream</span>);
                }
 
                <span class="r86 r">content</span>.<a href="@1@netstandard/A.html#eb5599035c4388ce" class="i method">Seek</a>(0, <a href="@1@netstandard/A.html#2cc1cf6635f00a52" class="t t">SeekOrigin</a>.<a href="@1@netstandard/A.html#c29481af7c617299" class="i field">Begin</a>);
 
                <b>return</b> <span class="r88 r">memoryStream</span>.<a href="@1@netstandard/A.html#5df5fc757781f05e" class="i method">ToArray</a>();
            }
 
            <b>private void</b> <a id="86ca00e454a1715d" href="../../R/86ca00e454a1715d.html" target="n" data-glyph="76,2" class="i method">Log</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r89 rd" class="r89 r">requestId</span>, <a href="#74877d74fd8acced" class="t t">EventType</a> <span id="r90 rd" class="r90 r">eventType</span>, <b>byte</b>[] <span id="r91 rd" class="r91 r">bytes</span>, <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>? <span id="r92 rd" class="r92 r">textEncoding</span>, <b>int</b>? <span id="r93 rd" class="r93 r">block</span> = <b>null</b>)
            {
                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>? <span id="r94 rd" class="r94 r">stringValue</span> = <span class="r92 r">textEncoding</span>?.<a href="@1@netstandard/A.html#7310c9cccfaecd17" class="i method">GetString</a>(<span class="r91 r">bytes</span>);
 
                <span class="c">// We checked IsEnabled before we got here</span>
                <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<a href="#e8c566da075fd046" class="i field">_eventSource</a> != <b>null</b>);
                <a href="../../Diagnostics/AzureCoreEventSource.cs.html#01d1d54631cb1734" class="t t">AzureCoreEventSource</a> <span id="r95 rd" class="r95 r">azureCoreEventSource</span> = <a href="#e8c566da075fd046" class="i field">_eventSource</a>!;
 
                <b>switch</b> (<span class="r90 r">eventType</span>)
                {
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#fed381f565669910" class="i field">Request</a> <b>when</b> <span class="r94 r">stringValue</span> != <b>null</b>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#1601c610786c07fa" class="i method">RequestContentText</a>(<span class="r89 r">requestId</span>, <span class="r94 r">stringValue</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#fed381f565669910" class="i field">Request</a>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#8c8fb3d5ba545e97" class="i method">RequestContent</a>(<span class="r89 r">requestId</span>, <span class="r91 r">bytes</span>);
                        <b>break</b>;
 
                    <span class="c">// Response</span>
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#50eb2ddfb375cf79" class="i field">Response</a> <b>when</b> <span class="r93 r">block</span> != <b>null</b> &amp;&amp; <span class="r94 r">stringValue</span> != <b>null</b>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#03e7f936ee30581c" class="i method">ResponseContentTextBlock</a>(<span class="r89 r">requestId</span>, <span class="r93 r">block</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>, <span class="r94 r">stringValue</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#50eb2ddfb375cf79" class="i field">Response</a> <b>when</b> <span class="r93 r">block</span> != <b>null</b>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#c413d13dda77be2d" class="i method">ResponseContentBlock</a>(<span class="r89 r">requestId</span>, <span class="r93 r">block</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>, <span class="r91 r">bytes</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#50eb2ddfb375cf79" class="i field">Response</a> <b>when</b> <span class="r94 r">stringValue</span> != <b>null</b>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#d1df9c45b219374f" class="i method">ResponseContentText</a>(<span class="r89 r">requestId</span>, <span class="r94 r">stringValue</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#50eb2ddfb375cf79" class="i field">Response</a>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#5406e465f55464bf" class="i method">ResponseContent</a>(<span class="r89 r">requestId</span>, <span class="r91 r">bytes</span>);
                        <b>break</b>;
 
                    <span class="c">// ResponseError</span>
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#aaf39e9f8bda37d9" class="i field">ErrorResponse</a> <b>when</b> <span class="r93 r">block</span> != <b>null</b> &amp;&amp; <span class="r94 r">stringValue</span> != <b>null</b>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#e9018b33ddf486ce" class="i method">ErrorResponseContentTextBlock</a>(<span class="r89 r">requestId</span>, <span class="r93 r">block</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>, <span class="r94 r">stringValue</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#aaf39e9f8bda37d9" class="i field">ErrorResponse</a> <b>when</b> <span class="r93 r">block</span> != <b>null</b>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#7818a4ea3d47e776" class="i method">ErrorResponseContentBlock</a>(<span class="r89 r">requestId</span>, <span class="r93 r">block</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a>, <span class="r91 r">bytes</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#aaf39e9f8bda37d9" class="i field">ErrorResponse</a> <b>when</b> <span class="r94 r">stringValue</span> != <b>null</b>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#28268a88ec113fb8" class="i method">ErrorResponseContentText</a>(<span class="r89 r">requestId</span>, <span class="r94 r">stringValue</span>);
                        <b>break</b>;
                    <b>case</b> <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#aaf39e9f8bda37d9" class="i field">ErrorResponse</a>:
                        <span class="r95 r">azureCoreEventSource</span>.<a href="../../Diagnostics/AzureCoreEventSource.cs.html#c1f8c2838ecdcf38" class="i method">ErrorResponseContent</a>(<span class="r89 r">requestId</span>, <span class="r91 r">bytes</span>);
                        <b>break</b>;
                }
            }
 
            <b>private static</b> <a href="#74877d74fd8acced" class="t t">EventType</a> <a id="705968932c6185e5" href="../../R/705968932c6185e5.html" target="n" data-glyph="76,2" class="i method">ResponseOrError</a>(<b>bool</b> <span id="r96 rd" class="r96 r">isError</span>)
            {
                <b>return</b> <span class="r96 r">isError</span> ? <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#aaf39e9f8bda37d9" class="i field">ErrorResponse</a> : <a href="#74877d74fd8acced" class="t t">EventType</a>.<a href="#50eb2ddfb375cf79" class="i field">Response</a>;
            }
 
            <b>private enum</b> <a id="74877d74fd8acced" href="../../R/74877d74fd8acced.html" target="n" data-glyph="22,2" class="t t"><span id="52bf83f2669cdce2">EventType</span></a>
            {
                <a id="fed381f565669910" href="../../R/fed381f565669910.html" target="n" data-glyph="24,3" class="i field">Request</a>,
                <a id="50eb2ddfb375cf79" href="../../R/50eb2ddfb375cf79.html" target="n" data-glyph="24,3" class="i field">Response</a>,
                <a id="aaf39e9f8bda37d9" href="../../R/aaf39e9f8bda37d9.html" target="n" data-glyph="24,3" class="i field">ErrorResponse</a>
            }
 
            <b>private class</b> <a id="2e60759a3dfbfd56" href="../../R/2e60759a3dfbfd56.html" target="n" data-glyph="4,2" class="t t">MaxLengthStream</a> : <a href="@1@netstandard/A.html#1a4dcb744a23ba6f" class="t t">MemoryStream</a>
            {
                <b>private int</b> <a id="5d2da66eabb14a1f" href="../../R/5d2da66eabb14a1f.html" target="n" data-glyph="46,3" class="i field">_bytesLeft</a>;
 
                <b>public</b> <a id="dc81804b44f04ff7" href="../../R/dc81804b44f04ff7.html" target="n" data-glyph="72,3" class="t constructor">MaxLengthStream</a>(<b>int</b> <span id="r97 rd" class="r97 r">maxLength</span>) : <a href="@1@netstandard/A.html#d308091cc690e78d" class="k">base</a>()
                {
                    <a href="#5d2da66eabb14a1f" class="i field">_bytesLeft</a> = <span class="r97 r">maxLength</span>;
                }
 
                <b>public override void</b> <a id="42fceebe88660ba9" href="../../R/42fceebe88660ba9.html" target="n" data-glyph="72,3" class="i method">Write</a>(<b>byte</b>[] <span id="r98 rd" class="r98 r">buffer</span>, <b>int</b> <span id="r99 rd" class="r99 r">offset</span>, <b>int</b> <span id="r100 rd" class="r100 r">count</span>)
                {
                    <a href="#e132e6e0c1fe20a5" class="i method">DecrementLength</a>(<b>ref</b> <span class="r100 r">count</span>);
                    <b>if</b> (<span class="r100 r">count</span> &gt; 0)
                    {
                        <a href="@1@netstandard/A.html#1a4dcb744a23ba6f" class="k">base</a>.<a href="@1@netstandard/A.html#a27df287b28d9a2a" class="i method">Write</a>(<span class="r98 r">buffer</span>, <span class="r99 r">offset</span>, <span class="r100 r">count</span>);
                    }
                }
 
                <b>public override</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="978a84ff0582111c" href="../../R/978a84ff0582111c.html" target="n" data-glyph="72,3" class="i method">WriteAsync</a>(<b>byte</b>[] <span id="r101 rd" class="r101 r">buffer</span>, <b>int</b> <span id="r102 rd" class="r102 r">offset</span>, <b>int</b> <span id="r103 rd" class="r103 r">count</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r104 rd" class="r104 r">cancellationToken</span>)
                {
                    <b>return</b> <span class="r103 r">count</span> &gt; 0 ? <a href="@1@netstandard/A.html#1a4dcb744a23ba6f" class="k">base</a>.<a href="@1@netstandard/A.html#7c6cbea58a012b83" class="i method">WriteAsync</a>(<span class="r101 r">buffer</span>, <span class="r102 r">offset</span>, <span class="r103 r">count</span>, <span class="r104 r">cancellationToken</span>) : <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@1@netstandard/A.html#66f1c3e3e272f591" class="i property">CompletedTask</a>;
                }
 
                <b>private void</b> <a id="e132e6e0c1fe20a5" href="../../R/e132e6e0c1fe20a5.html" target="n" data-glyph="76,3" class="i method">DecrementLength</a>(<b>ref int</b> <span id="r105 rd" class="r105 r">count</span>)
                {
                    <a href="@1@netstandard/A.html#225942ed7b7a3252" class="k">var</a> <span id="r106 rd" class="r106 r">left</span> = <a href="@1@netstandard/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@1@netstandard/A.html#f441d55c88d635ad" class="i method">Min</a>(<span class="r105 r">count</span>, <a href="#5d2da66eabb14a1f" class="i field">_bytesLeft</a>);
                    <span class="r105 r">count</span> = <span class="r106 r">left</span>;
 
                    <a href="#5d2da66eabb14a1f" class="i field">_bytesLeft</a> -= <span class="r105 r">count</span>;
                }
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
