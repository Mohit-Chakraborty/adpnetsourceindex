<!DOCTYPE html>
<html><head><title>PolicyMetadataTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(109);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#PolicyInsights.Tests/PolicyMetadataTests.cs" target="_top">PolicyMetadataTests.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#PolicyInsights.Tests" target="_top">tests\Microsoft.Azure.Management.PolicyInsights.Tests.csproj</a> (PolicyInsights.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>namespace</b> <span class="i n">PolicyInsights</span>.<span class="i n">Tests</span>
{
    <b>using</b> <span class="i">System</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Linq</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">PolicyInsights</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">PolicyInsights</span>.<span class="i n">Models</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">ClientRuntime</span>.<span class="i">Azure</span>.<span class="i">TestFramework</span>;
    <b>using</b> <span class="i">Xunit</span>;
 
    <b>public class</b> <a id="2f4514a90eda510c" href="R/2f4514a90eda510c.html" target="n" data-glyph="0,0" class="t t"><span id="6f864fed8db4e96e">PolicyMetadataTests</span></a> : <span class="i">TestBase</span>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Test setup
 
        <b>private static string</b> <a id="43373dc42d9233d9" href="R/43373dc42d9233d9.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataName</a> = <span class="s">&quot;ACF1041&quot;</span>;
        <b>private static string</b> <a id="ba1fbddcaefcff30" href="R/ba1fbddcaefcff30.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataId</a> = <span class="s">&quot;Microsoft Managed Control 1041&quot;</span>;
        <b>private static string</b> <a id="66f8a7d0f7a74dcb" href="R/66f8a7d0f7a74dcb.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataCategory</a> = <span class="s">&quot;Access Control&quot;</span>;
        <b>private static string</b> <a id="48178d0125e76d6c" href="R/48178d0125e76d6c.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataTitle</a> = <span class="s">&quot;Least Privilege | Privilege Levels For Code Execution&quot;</span>;
        <b>private static string</b> <a id="5d7967ab58a18a4c" href="R/5d7967ab58a18a4c.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataOwner</a> = <span class="s">&quot;Microsoft Azure Security, Service Engineer Operations, Program Manager&quot;</span>;
        <b>private static string</b> <a id="9ea7df725f73ec1a" href="R/9ea7df725f73ec1a.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataDescription</a> = <span class="s">&quot;The information system prevents any software except software explicitly documented from executing at higher privilege levels than users executing the software.&quot;</span>;
        <b>private static string</b> <a id="614160a3d29b9391" href="R/614160a3d29b9391.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataRequirements</a> = <span class="s">&quot;Software execution at a higher privilege level than users executing the software is not applicable for servers and network devices. Microsoft Azure only permits administrator access to server who by default have code execution privileges. Access to tools are only accessible by Microsoft Azure administrators; therefore, no read-only access is provided. These administrators have full access to the system, preventing users being indirectly provided greater privileges than assigned by Microsoft.&quot;</span>;
        <b>private static string</b> <a id="fd0984749856e423" href="R/fd0984749856e423.html" target="n" data-glyph="46,1" class="i field">PolicyMetadataAdditionalContentUrl</a> = <b>string</b>.<span class="i">Empty</span>;
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Validation
 
        <b>private void</b> <a id="c817c62a43135bac" href="R/c817c62a43135bac.html" target="n" data-glyph="76,1" class="i method">ValidateCollection</a>(<span class="i">List</span>&lt;<a href="/Microsoft.Azure.Management.PolicyInsights/A.html#950f331f17f5198a" class="t t">SlimPolicyMetadata</a>&gt; <span id="r0 rd" class="r0 r">policyMetadata</span>)
        {
            <span class="c">// Check that there are no duplicates</span>
            <span class="i">Assert</span>.<span class="i">Equal</span>(<span class="r0 r">policyMetadata</span>.<span class="i">Count</span>, <span class="r0 r">policyMetadata</span>.<span class="i">Select</span>(<span id="r1 rd" class="r1 r">m</span> =&gt; <span class="r1 r">m</span>.<span class="i">Name</span>).<span class="i">Distinct</span>(<span class="i">comparer</span>: <span class="i">StringComparer</span>.<span class="i">OrdinalIgnoreCase</span>).<span class="i">Count</span>());
 
            <span class="c">// Check that all resources have id and type</span>
            <span class="i">Assert</span>.<span class="i">True</span>(<span class="r0 r">policyMetadata</span>.<span class="i">All</span>(<span id="r2 rd" class="r2 r">m</span> =&gt; <span class="r2 r">m</span>.<span class="i">Id</span>.<span class="i">Equals</span>(<span class="s">$&quot;</span><span class="s">/providers/Microsoft.PolicyInsights/policyMetadata/</span>{<span class="r2 r">m</span>.<span class="i">Name</span>}<span class="s">&quot;</span>, <span class="i">StringComparison</span>.<span class="i">OrdinalIgnoreCase</span>)));
            <span class="i">Assert</span>.<span class="i">True</span>(<span class="r0 r">policyMetadata</span>.<span class="i">All</span>(<span id="r3 rd" class="r3 r">m</span> =&gt; <span class="r3 r">m</span>.<span class="i">Type</span>.<span class="i">Equals</span>(<span class="s">&quot;Microsoft.PolicyInsights/policyMetadata&quot;</span>)));
 
            <b>var</b> <span id="r4 rd" class="r4 r">testMetadata</span> = <span class="r0 r">policyMetadata</span>.<span class="i">FirstOrDefault</span>(<span id="r5 rd" class="r5 r">m</span> =&gt; <span class="r5 r">m</span>.<span class="i">Name</span>.<span class="i">Equals</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#43373dc42d9233d9" class="i field">PolicyMetadataName</a>));
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r4 r">testMetadata</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#ba1fbddcaefcff30" class="i field">PolicyMetadataId</a>, <span class="r4 r">testMetadata</span>.<span class="i">MetadataId</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#66f8a7d0f7a74dcb" class="i field">PolicyMetadataCategory</a>, <span class="r4 r">testMetadata</span>.<span class="i">Category</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#48178d0125e76d6c" class="i field">PolicyMetadataTitle</a>, <span class="r4 r">testMetadata</span>.<span class="i">Title</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#5d7967ab58a18a4c" class="i field">PolicyMetadataOwner</a>, <span class="r4 r">testMetadata</span>.<span class="i">Owner</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#fd0984749856e423" class="i field">PolicyMetadataAdditionalContentUrl</a>, <span class="r4 r">testMetadata</span>.<span class="i">AdditionalContentUrl</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Test
 
        [<span class="i">Fact</span>]
        <b>public void</b> <a id="e97c95224551e71d" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PolicyMetadataTest_List</a>()
        {
            <b>using</b> (<b>var</b> <span id="r6 rd" class="r6 r">context</span> = <span class="i">MockContext</span>.<span class="i">Start</span>(<a href="#2f4514a90eda510c" class="k">this</a>.<span class="i">GetType</span>()))
            {
                <b>var</b> <span id="r7 rd" class="r7 r">policyInsightsClient</span> = <span class="r6 r">context</span>.<span class="i">GetServiceClient</span>&lt;<a href="/Microsoft.Azure.Management.PolicyInsights/A.html#a42b4003a7e9068d" class="t t">PolicyInsightsClient</a>&gt;();
 
                <b>string</b> <span id="r8 rd" class="r8 r">nextPageLink</span> = <b>null</b>;
                <b>var</b> <span id="r9 rd" class="r9 r">results</span> = <b>new</b> <span class="i">List</span>&lt;<a href="/Microsoft.Azure.Management.PolicyInsights/A.html#950f331f17f5198a" class="t t">SlimPolicyMetadata</a>&gt;();
                <b>do</b>
                {
                    <b>var</b> <span id="r10 rd" class="r10 r">response</span> = <span class="r8 r">nextPageLink</span> == <b>null</b> ? <span class="r7 r">policyInsightsClient</span>.<span class="i">PolicyMetadata</span>.<span class="i">ListAsync</span>().<span class="i">Result</span> : <span class="r7 r">policyInsightsClient</span>.<span class="i">PolicyMetadata</span>.<span class="i">ListNextAsync</span>(<span class="i">nextPageLink</span>: <span class="r8 r">nextPageLink</span>).<span class="i">Result</span>;
                    <span class="r9 r">results</span>.<span class="i">AddRange</span>(<span class="r10 r">response</span>);
                    <span class="r8 r">nextPageLink</span> = <span class="r10 r">response</span>.<span class="i">NextPageLink</span>;
 
                } <b>while</b> (<span class="r8 r">nextPageLink</span> != <b>null</b>);
 
                <a href="#2f4514a90eda510c" class="k">this</a>.<a href="#c817c62a43135bac" class="i method">ValidateCollection</a>(<span class="r9 r">results</span>);
            }
        }
 
        [<span class="i">Fact</span>]
        <b>public void</b> <a id="36574a05d060a1f6" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PolicyMetadataTest_List_Top</a>()
        {
            <b>using</b> (<b>var</b> <span id="r11 rd" class="r11 r">context</span> = <span class="i">MockContext</span>.<span class="i">Start</span>(<a href="#2f4514a90eda510c" class="k">this</a>.<span class="i">GetType</span>()))
            {
                <b>var</b> <span id="r12 rd" class="r12 r">policyInsightsClient</span> = <span class="r11 r">context</span>.<span class="i">GetServiceClient</span>&lt;<a href="/Microsoft.Azure.Management.PolicyInsights/A.html#a42b4003a7e9068d" class="t t">PolicyInsightsClient</a>&gt;();
                <b>var</b> <span id="r13 rd" class="r13 r">response</span> = <span class="r12 r">policyInsightsClient</span>.<span class="i">PolicyMetadata</span>.<span class="i">ListAsync</span>(<span class="i">queryOptions</span>: <b>new</b> <span class="t">QueryOptions</span>(<span class="i">top</span>: 1)).<span class="i">Result</span>;
                <span class="i">Assert</span>.<span class="i">Single</span>(<span class="r13 r">response</span>);
            }
        }
 
        [<span class="i">Fact</span>]
        <b>public void</b> <a id="dbc1115a91b164ee" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">PolicyMetadataTest_GetResource</a>()
        {
            <b>using</b> (<b>var</b> <span id="r14 rd" class="r14 r">context</span> = <span class="i">MockContext</span>.<span class="i">Start</span>(<a href="#2f4514a90eda510c" class="k">this</a>.<span class="i">GetType</span>()))
            {
                <b>var</b> <span id="r15 rd" class="r15 r">policyInsightsClient</span> = <span class="r14 r">context</span>.<span class="i">GetServiceClient</span>&lt;<a href="/Microsoft.Azure.Management.PolicyInsights/A.html#a42b4003a7e9068d" class="t t">PolicyInsightsClient</a>&gt;();
                <b>var</b> <span id="r16 rd" class="r16 r">response</span> = <span class="r15 r">policyInsightsClient</span>.<span class="i">PolicyMetadata</span>.<span class="i">GetResourceAsync</span>(<span class="i">resourceName</span>: <a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#43373dc42d9233d9" class="i field">PolicyMetadataName</a>).<span class="i">Result</span>;
 
                <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r16 r">response</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#43373dc42d9233d9" class="i field">PolicyMetadataName</a>, <span class="r16 r">response</span>.<span class="i">Name</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<span class="s">$&quot;</span><span class="s">/providers/Microsoft.PolicyInsights/policyMetadata/</span>{<span class="r16 r">response</span>.<span class="i">Name</span>}<span class="s">&quot;</span>, <span class="r16 r">response</span>.<span class="i">Id</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<span class="s">$&quot;</span><span class="s">Microsoft.PolicyInsights/policyMetadata</span><span class="s">&quot;</span>, <span class="r16 r">response</span>.<span class="i">Type</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#ba1fbddcaefcff30" class="i field">PolicyMetadataId</a>, <span class="r16 r">response</span>.<span class="i">MetadataId</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#66f8a7d0f7a74dcb" class="i field">PolicyMetadataCategory</a>, <span class="r16 r">response</span>.<span class="i">Category</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#48178d0125e76d6c" class="i field">PolicyMetadataTitle</a>, <span class="r16 r">response</span>.<span class="i">Title</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#5d7967ab58a18a4c" class="i field">PolicyMetadataOwner</a>, <span class="r16 r">response</span>.<span class="i">Owner</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#9ea7df725f73ec1a" class="i field">PolicyMetadataDescription</a>, <span class="r16 r">response</span>.<span class="i">Description</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#614160a3d29b9391" class="i field">PolicyMetadataRequirements</a>, <span class="r16 r">response</span>.<span class="i">Requirements</span>);
                <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="#2f4514a90eda510c" class="t t">PolicyMetadataTests</a>.<a href="#fd0984749856e423" class="i field">PolicyMetadataAdditionalContentUrl</a>, <span class="r16 r">response</span>.<span class="i">AdditionalContentUrl</span>);
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
