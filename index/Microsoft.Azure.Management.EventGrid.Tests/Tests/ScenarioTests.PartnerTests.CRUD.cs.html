<!DOCTYPE html>
<html><head><title>ScenarioTests.PartnerTests.CRUD.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(570);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Management.EventGrid.Tests/Tests/ScenarioTests.PartnerTests.CRUD.cs" target="_top">Tests\ScenarioTests.PartnerTests.CRUD.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Management.EventGrid.Tests" target="_top">Microsoft.Azure.Management.EventGrid.Tests.csproj</a> (Microsoft.Azure.Management.EventGrid.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">EventGrid</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">EventGrid</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">Azure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">ClientRuntime</span>.<span class="i">Azure</span>.<span class="i">TestFramework</span>;
<b>using</b> <span class="i n">EventGrid</span>.<span class="i n">Tests</span>.<span class="i n">TestHelper</span>;
<b>using</b> <span class="i">Xunit</span>;
 
<b>namespace</b> <span class="i n">EventGrid</span>.<span class="i n">Tests</span>.<span class="i n">ScenarioTests</span>
{
    <b>public</b> <a href="../P/9ffdfede6c6f9c92.html" target="s" class="k">partial</a> <b>class</b> <a id="9ffdfede6c6f9c92" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="fb9a6f505c1bd213">ScenarioTests</span></a>
    {
        <span class="c">// Disable the test as it is not part of the GA version yet</span>
        <span class="c">////////[Fact]</span>
        <span class="c">////////public void PartnerCreateGetUpdateDelete()</span>
        <span class="c">////////{</span>
        <span class="c">////////    using (MockContext context = MockContext.Start(this.GetType()))</span>
        <span class="c">////////    {</span>
        <span class="c">////////        this.InitializeClients(context);</span>
 
        <span class="c">////////        var location = this.ResourceManagementClient.GetLocationFromProvider();</span>
 
        <span class="c">////////        var resourceGroup = this.ResourceManagementClient.TryGetResourceGroup(location);</span>
        <span class="c">////////        if (string.IsNullOrWhiteSpace(resourceGroup))</span>
        <span class="c">////////        {</span>
        <span class="c">////////            resourceGroup = TestUtilities.GenerateName(EventGridManagementHelper.ResourceGroupPrefix);</span>
        <span class="c">////////            this.ResourceManagementClient.TryRegisterResourceGroup(location, resourceGroup);</span>
        <span class="c">////////        }</span>
 
        <span class="c">////////        bool partnerRegistrationCreated = false;</span>
        <span class="c">////////        bool partnerNamespaceCreated = false;</span>
        <span class="c">////////        bool eventChannelCreated = false;</span>
        <span class="c">////////        bool partnerTopicCreated = false;</span>
        <span class="c">////////        bool eventSubscriptionCreated = false;</span>
        <span class="c">////////        var partnerNamespaceName = TestUtilities.GenerateName(EventGridManagementHelper.PartnerNamespacePrefix);</span>
        <span class="c">////////        var eventChannelName = TestUtilities.GenerateName(EventGridManagementHelper.EventChannelPrefix);</span>
        <span class="c">////////        var partnerTopicName = TestUtilities.GenerateName(EventGridManagementHelper.PartnerTopicPrefix);</span>
        <span class="c">////////        var eventSubscriptionName = TestUtilities.GenerateName(EventGridManagementHelper.EventSubscriptionPrefix);</span>
 
        <span class="c">////////        var partnerRegistrationName = TestUtilities.GenerateName(EventGridManagementHelper.PartnerRegistrationPrefix);</span>
 
        <span class="c">////////        // Temporarily commenting this out as this is not yet enabled for the new API version</span>
        <span class="c">////////        // var operationsResponse = this.EventGridManagementClient.Operations.List();</span>
 
        <span class="c">////////        var originalTagsDictionary = new Dictionary&lt;string, string&gt;()</span>
        <span class="c">////////        {</span>
        <span class="c">////////            {&quot;originalTag1&quot;, &quot;originalValue1&quot;},</span>
        <span class="c">////////            {&quot;originalTag2&quot;, &quot;originalValue2&quot;}</span>
        <span class="c">////////        };</span>
 
        <span class="c">////////        Guid uniqueId = Guid.NewGuid();</span>
        <span class="c">////////        string subId = &quot;5b4b650e-28b9-4790-b3ab-ddbd88d727c4&quot;;</span>
 
        <span class="c">////////        try</span>
        <span class="c">////////        {</span>
        <span class="c">////////            PartnerRegistration partnerRegistration = new PartnerRegistration()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                Location = &quot;global&quot;,</span>
        <span class="c">////////                Tags = originalTagsDictionary,</span>
        <span class="c">////////                LogoUri = &quot;https://www.contoso.com/logo.png&quot;,</span>
        <span class="c">////////                SetupUri = &quot;https://www.contoso.com/setup.html&quot;,</span>
        <span class="c">////////                PartnerName = &quot;Contoso&quot;,</span>
        <span class="c">////////                PartnerResourceTypeName = $&quot;Accounts.{uniqueId}&quot;,</span>
        <span class="c">////////                PartnerResourceTypeDisplayName = $&quot;DisplayName Text -- {uniqueId}&quot;,</span>
        <span class="c">////////                PartnerResourceTypeDescription = $&quot;Description Text -- {uniqueId}&quot;,</span>
        <span class="c">////////                AuthorizedAzureSubscriptionIds = new List&lt;string&gt;</span>
        <span class="c">////////            {</span>
        <span class="c">////////                subId</span>
        <span class="c">////////            },</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            var createPartnerRegistrationResponse = this.EventGridManagementClient.PartnerRegistrations.CreateOrUpdateAsync(resourceGroup, partnerRegistrationName, partnerRegistration).Result;</span>
 
        <span class="c">////////            partnerRegistrationCreated = true;</span>
 
        <span class="c">////////            Assert.NotNull(createPartnerRegistrationResponse);</span>
        <span class="c">////////            Assert.Equal(createPartnerRegistrationResponse.Name, partnerRegistrationName);</span>
 
        <span class="c">////////            TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
 
        <span class="c">////////            // Get the created partnerRegistration</span>
        <span class="c">////////            var getPartnerRegistrationResponse = this.EventGridManagementClient.PartnerRegistrations.Get(resourceGroup, partnerRegistrationName);</span>
        <span class="c">////////            if (string.Compare(getPartnerRegistrationResponse.ProvisioningState, &quot;Succeeded&quot;, true) != 0)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            getPartnerRegistrationResponse = this.EventGridManagementClient.PartnerRegistrations.Get(resourceGroup, partnerRegistrationName);</span>
        <span class="c">////////            Assert.NotNull(getPartnerRegistrationResponse);</span>
        <span class="c">////////            Assert.Equal(&quot;Succeeded&quot;, getPartnerRegistrationResponse.ProvisioningState, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Equal(&quot;global&quot;, getPartnerRegistrationResponse.Location, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Contains(getPartnerRegistrationResponse.Tags, tag =&gt; tag.Key == &quot;originalTag1&quot;);</span>
 
        <span class="c">////////            // Get all partnerRegistrations created within a resourceGroup</span>
        <span class="c">////////            IPage&lt;PartnerRegistration&gt; partnerRegistrationsInResourceGroupPage = this.EventGridManagementClient.PartnerRegistrations.ListByResourceGroupAsync(resourceGroup).Result;</span>
        <span class="c">////////            var partnerRegistrationsInResourceGroupList = new List&lt;PartnerRegistration&gt;();</span>
        <span class="c">////////            if (partnerRegistrationsInResourceGroupPage.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerRegistrationsInResourceGroupList.AddRange(partnerRegistrationsInResourceGroupPage);</span>
        <span class="c">////////                var nextLink = partnerRegistrationsInResourceGroupPage.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    partnerRegistrationsInResourceGroupPage = this.EventGridManagementClient.PartnerRegistrations.ListByResourceGroupNextAsync(nextLink).Result;</span>
        <span class="c">////////                    partnerRegistrationsInResourceGroupList.AddRange(partnerRegistrationsInResourceGroupPage);</span>
        <span class="c">////////                    nextLink = partnerRegistrationsInResourceGroupPage.NextPageLink;</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerRegistrationsInResourceGroupList);</span>
        <span class="c">////////            Assert.True(partnerRegistrationsInResourceGroupList.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerRegistrationsInResourceGroupList, t =&gt; t.Name == partnerRegistrationName);</span>
        <span class="c">////////            Assert.True(partnerRegistrationsInResourceGroupList.All(ns =&gt; ns.Id.Contains(resourceGroup)));</span>
 
        <span class="c">////////            IPage&lt;PartnerRegistration&gt; partnerRegistrationsInResourceGroupPageWithTop = this.EventGridManagementClient.PartnerRegistrations.ListByResourceGroupAsync(resourceGroup, null, 5).Result;</span>
        <span class="c">////////            var partnerRegistrationsInResourceGroupListWithTop = new List&lt;PartnerRegistration&gt;();</span>
        <span class="c">////////            if (partnerRegistrationsInResourceGroupPageWithTop.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerRegistrationsInResourceGroupListWithTop.AddRange(partnerRegistrationsInResourceGroupPageWithTop);</span>
        <span class="c">////////                var nextLink = partnerRegistrationsInResourceGroupPageWithTop.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    partnerRegistrationsInResourceGroupPageWithTop = this.EventGridManagementClient.PartnerRegistrations.ListByResourceGroupNextAsync(nextLink).Result;</span>
        <span class="c">////////                    partnerRegistrationsInResourceGroupListWithTop.AddRange(partnerRegistrationsInResourceGroupPageWithTop);</span>
        <span class="c">////////                    nextLink = partnerRegistrationsInResourceGroupPageWithTop.NextPageLink;</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerRegistrationsInResourceGroupListWithTop);</span>
        <span class="c">////////            Assert.True(partnerRegistrationsInResourceGroupListWithTop.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerRegistrationsInResourceGroupListWithTop, t =&gt; t.Name == partnerRegistrationName);</span>
        <span class="c">////////            Assert.True(partnerRegistrationsInResourceGroupListWithTop.All(ns =&gt; ns.Id.Contains(resourceGroup)));</span>
 
        <span class="c">////////            // Get all partnerRegistrations created within the subscription irrespective of the resourceGroup</span>
        <span class="c">////////            IPage&lt;PartnerRegistration&gt; partnerRegistrationsInAzureSubscription = this.EventGridManagementClient.PartnerRegistrations.ListBySubscriptionAsync(null, 100).Result;</span>
        <span class="c">////////            var partnerRegistrationsInAzureSubscriptionList = new List&lt;PartnerRegistration&gt;();</span>
        <span class="c">////////            if (partnerRegistrationsInAzureSubscription.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerRegistrationsInAzureSubscriptionList.AddRange(partnerRegistrationsInAzureSubscription);</span>
        <span class="c">////////                var nextLink = partnerRegistrationsInAzureSubscription.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    try</span>
        <span class="c">////////                    {</span>
        <span class="c">////////                        partnerRegistrationsInAzureSubscription = this.EventGridManagementClient.PartnerRegistrations.ListBySubscriptionNextAsync(nextLink).Result;</span>
        <span class="c">////////                        partnerRegistrationsInAzureSubscriptionList.AddRange(partnerRegistrationsInAzureSubscription);</span>
        <span class="c">////////                        nextLink = partnerRegistrationsInAzureSubscription.NextPageLink;</span>
        <span class="c">////////                    }</span>
        <span class="c">////////                    catch (Exception ex)</span>
        <span class="c">////////                    {</span>
        <span class="c">////////                        Console.WriteLine(ex);</span>
        <span class="c">////////                        break;</span>
        <span class="c">////////                    }</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerRegistrationsInAzureSubscriptionList);</span>
        <span class="c">////////            Assert.True(partnerRegistrationsInAzureSubscriptionList.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerRegistrationsInAzureSubscriptionList, t =&gt; t.Name == partnerRegistrationName);</span>
 
        <span class="c">////////            var replacePartnerRegistrationTagsDictionary = new Dictionary&lt;string, string&gt;()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                { &quot;replacedTag1&quot;, &quot;replacedValue1&quot; },</span>
        <span class="c">////////                { &quot;replacedTag2&quot;, &quot;replacedValue2&quot; }</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            // Replace the partnerRegistration</span>
        <span class="c">////////            partnerRegistration.Tags = replacePartnerRegistrationTagsDictionary;</span>
        <span class="c">////////            var replacePartnerRegistrationResponse = this.EventGridManagementClient.PartnerRegistrations.CreateOrUpdateAsync(resourceGroup, partnerRegistrationName, partnerRegistration).Result;</span>
 
        <span class="c">////////            Assert.Contains(replacePartnerRegistrationResponse.Tags, tag =&gt; tag.Key == &quot;replacedTag1&quot;);</span>
        <span class="c">////////            Assert.DoesNotContain(replacePartnerRegistrationResponse.Tags, tag =&gt; tag.Key == &quot;originalTag1&quot;);</span>
 
        <span class="c">////////            // Update the partnerRegistration with tags</span>
        <span class="c">////////            //////PartnerRegistrationUpdateParameters partnerRegistrationUpdateParameters = new PartnerRegistrationUpdateParameters();</span>
        <span class="c">////////            //////partnerRegistrationUpdateParameters.Tags = new Dictionary&lt;string, string&gt;()</span>
        <span class="c">////////            //////{</span>
        <span class="c">////////            //////    { &quot;updatedTag1&quot;, &quot;updatedValue1&quot; },</span>
        <span class="c">////////            //////    { &quot;updatedTag2&quot;, &quot;updatedValue2&quot; }</span>
        <span class="c">////////            //////};</span>
 
        <span class="c">////////            //////var updatePartnerRegistrationResponse = this.EventGridManagementClient.PartnerRegistrations.UpdateAsync(resourceGroup, partnerRegistrationName, partnerRegistrationUpdateParameters).Result;</span>
        <span class="c">////////            //////Assert.Contains(updatePartnerRegistrationResponse.Tags, tag =&gt; tag.Key == &quot;updatedTag1&quot;);</span>
        <span class="c">////////            //////Assert.DoesNotContain(updatePartnerRegistrationResponse.Tags, tag =&gt; tag.Key == &quot;replacedTag1&quot;);</span>
 
        <span class="c">////////            // Partner namespace operations</span>
 
        <span class="c">////////            var originalNamespaceTagsDictionary = new Dictionary&lt;string, string&gt;()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                {&quot;originalTag111&quot;, &quot;originalValue111&quot;},</span>
        <span class="c">////////                {&quot;originalTag222&quot;, &quot;originalValue222&quot;}</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            PartnerNamespace partnerNamespace = new PartnerNamespace()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                Location = location,</span>
        <span class="c">////////                Tags = originalNamespaceTagsDictionary,</span>
        <span class="c">////////                PartnerRegistrationFullyQualifiedId = getPartnerRegistrationResponse.Id</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            var createPartnerNamespaceResponse = this.EventGridManagementClient.PartnerNamespaces.CreateOrUpdateAsync(resourceGroup, partnerNamespaceName, partnerNamespace).Result;</span>
        <span class="c">////////            partnerNamespaceCreated = true;</span>
 
        <span class="c">////////            Assert.NotNull(createPartnerNamespaceResponse);</span>
        <span class="c">////////            Assert.Equal(createPartnerNamespaceResponse.Name, partnerNamespaceName);</span>
 
        <span class="c">////////            TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
 
        <span class="c">////////            // Get the created partnerNamespace</span>
        <span class="c">////////            var getPartnerNamespaceResponse = this.EventGridManagementClient.PartnerNamespaces.Get(resourceGroup, partnerNamespaceName);</span>
        <span class="c">////////            if (string.Compare(getPartnerNamespaceResponse.ProvisioningState, &quot;Succeeded&quot;, true) != 0)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            getPartnerNamespaceResponse = this.EventGridManagementClient.PartnerNamespaces.Get(resourceGroup, partnerNamespaceName);</span>
        <span class="c">////////            Assert.NotNull(getPartnerNamespaceResponse);</span>
        <span class="c">////////            Assert.Equal(&quot;Succeeded&quot;, getPartnerNamespaceResponse.ProvisioningState, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Equal(location, getPartnerNamespaceResponse.Location, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Contains(getPartnerNamespaceResponse.Tags, tag =&gt; tag.Key == &quot;originalTag111&quot;);</span>
 
        <span class="c">////////            // Get all partnerNamespaces created within a resourceGroup</span>
        <span class="c">////////            IPage&lt;PartnerNamespace&gt; partnerNamespacesInResourceGroupPage = this.EventGridManagementClient.PartnerNamespaces.ListByResourceGroupAsync(resourceGroup).Result;</span>
        <span class="c">////////            var partnerNamespacesInResourceGroupList = new List&lt;PartnerNamespace&gt;();</span>
        <span class="c">////////            if (partnerNamespacesInResourceGroupPage.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerNamespacesInResourceGroupList.AddRange(partnerNamespacesInResourceGroupPage);</span>
        <span class="c">////////                var nextLink = partnerNamespacesInResourceGroupPage.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    partnerNamespacesInResourceGroupPage = this.EventGridManagementClient.PartnerNamespaces.ListByResourceGroupNextAsync(nextLink).Result;</span>
        <span class="c">////////                    partnerNamespacesInResourceGroupList.AddRange(partnerNamespacesInResourceGroupPage);</span>
        <span class="c">////////                    nextLink = partnerNamespacesInResourceGroupPage.NextPageLink;</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerNamespacesInResourceGroupList);</span>
        <span class="c">////////            Assert.True(partnerNamespacesInResourceGroupList.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerNamespacesInResourceGroupList, t =&gt; t.Name == partnerNamespaceName);</span>
        <span class="c">////////            Assert.True(partnerNamespacesInResourceGroupList.All(ns =&gt; ns.Id.Contains(resourceGroup)));</span>
 
        <span class="c">////////            IPage&lt;PartnerNamespace&gt; partnerNamespacesInResourceGroupPageWithTop = this.EventGridManagementClient.PartnerNamespaces.ListByResourceGroupAsync(resourceGroup, null, 5).Result;</span>
        <span class="c">////////            var partnerNamespacesInResourceGroupListWithTop = new List&lt;PartnerNamespace&gt;();</span>
        <span class="c">////////            if (partnerNamespacesInResourceGroupPageWithTop.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerNamespacesInResourceGroupListWithTop.AddRange(partnerNamespacesInResourceGroupPageWithTop);</span>
        <span class="c">////////                var nextLink = partnerNamespacesInResourceGroupPageWithTop.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    partnerNamespacesInResourceGroupPageWithTop = this.EventGridManagementClient.PartnerNamespaces.ListByResourceGroupNextAsync(nextLink).Result;</span>
        <span class="c">////////                    partnerNamespacesInResourceGroupListWithTop.AddRange(partnerNamespacesInResourceGroupPageWithTop);</span>
        <span class="c">////////                    nextLink = partnerNamespacesInResourceGroupPageWithTop.NextPageLink;</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerNamespacesInResourceGroupListWithTop);</span>
        <span class="c">////////            Assert.True(partnerNamespacesInResourceGroupListWithTop.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerNamespacesInResourceGroupListWithTop, t =&gt; t.Name == partnerNamespaceName);</span>
        <span class="c">////////            Assert.True(partnerNamespacesInResourceGroupListWithTop.All(ns =&gt; ns.Id.Contains(resourceGroup)));</span>
 
        <span class="c">////////            // Get all partnerNamespaces created within the subscription irrespective of the resourceGroup</span>
        <span class="c">////////            IPage&lt;PartnerNamespace&gt; partnerNamespacesInAzureSubscription = this.EventGridManagementClient.PartnerNamespaces.ListBySubscriptionAsync(null, 100).Result;</span>
        <span class="c">////////            var partnerNamespacesInAzureSubscriptionList = new List&lt;PartnerNamespace&gt;();</span>
        <span class="c">////////            if (partnerNamespacesInAzureSubscription.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerNamespacesInAzureSubscriptionList.AddRange(partnerNamespacesInAzureSubscription);</span>
        <span class="c">////////                var nextLink = partnerNamespacesInAzureSubscription.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    try</span>
        <span class="c">////////                    {</span>
        <span class="c">////////                        partnerNamespacesInAzureSubscription = this.EventGridManagementClient.PartnerNamespaces.ListBySubscriptionNextAsync(nextLink).Result;</span>
        <span class="c">////////                        partnerNamespacesInAzureSubscriptionList.AddRange(partnerNamespacesInAzureSubscription);</span>
        <span class="c">////////                        nextLink = partnerNamespacesInAzureSubscription.NextPageLink;</span>
        <span class="c">////////                    }</span>
        <span class="c">////////                    catch (Exception ex)</span>
        <span class="c">////////                    {</span>
        <span class="c">////////                        Console.WriteLine(ex);</span>
        <span class="c">////////                        break;</span>
        <span class="c">////////                    }</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerNamespacesInAzureSubscriptionList);</span>
        <span class="c">////////            Assert.True(partnerNamespacesInAzureSubscriptionList.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerNamespacesInAzureSubscriptionList, t =&gt; t.Name == partnerNamespaceName);</span>
 
        <span class="c">////////            var replacePartnerNamespaceTagsDictionary = new Dictionary&lt;string, string&gt;()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                { &quot;replacedTag111&quot;, &quot;replacedValue111&quot; },</span>
        <span class="c">////////                { &quot;replacedTag222&quot;, &quot;replacedValue222&quot; }</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            // Replace the partnerNamespace</span>
        <span class="c">////////            partnerNamespace.Tags = replacePartnerNamespaceTagsDictionary;</span>
        <span class="c">////////            var replacePartnerNamespaceResponse = this.EventGridManagementClient.PartnerNamespaces.CreateOrUpdateAsync(resourceGroup, partnerNamespaceName, partnerNamespace).Result;</span>
 
        <span class="c">////////            Assert.Contains(replacePartnerNamespaceResponse.Tags, tag =&gt; tag.Key == &quot;replacedTag111&quot;);</span>
        <span class="c">////////            Assert.DoesNotContain(replacePartnerNamespaceResponse.Tags, tag =&gt; tag.Key == &quot;originalTag111&quot;);</span>
 
        <span class="c">////////            // EventChannel/PartnerTopic operations</span>
        <span class="c">////////            var originalPartnerTopicTagsDictionary = new Dictionary&lt;string, string&gt;()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                {&quot;originalTag11111&quot;, &quot;originalValue11111&quot;},</span>
        <span class="c">////////                {&quot;originalTag22222&quot;, &quot;originalValue22222&quot;}</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            EventChannel eventChannel = new EventChannel()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                Source = new EventChannelSource</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    Source = $&quot;Accounts.User.{uniqueId}&quot;,</span>
        <span class="c">////////                },</span>
        <span class="c">////////                Destination = new EventChannelDestination</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    AzureSubscriptionId = subId,</span>
        <span class="c">////////                    ResourceGroup = resourceGroup,</span>
        <span class="c">////////                    PartnerTopicName = partnerTopicName</span>
        <span class="c">////////                },</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            var createEventChannelResponse = this.EventGridManagementClient.EventChannels.CreateOrUpdateAsync(resourceGroup, partnerNamespaceName, eventChannelName, eventChannel).Result;</span>
        <span class="c">////////            eventChannelCreated = true;</span>
        <span class="c">////////            partnerTopicCreated = true;</span>
 
        <span class="c">////////            Assert.NotNull(createEventChannelResponse);</span>
        <span class="c">////////            Assert.Equal(createEventChannelResponse.Name, eventChannelName);</span>
 
        <span class="c">////////            TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
 
        <span class="c">////////            // Get the created eventChannel</span>
        <span class="c">////////            var getEventChannelResponse = this.EventGridManagementClient.EventChannels.Get(resourceGroup, partnerNamespaceName, eventChannelName);</span>
        <span class="c">////////            if (string.Compare(getEventChannelResponse.ProvisioningState, &quot;Succeeded&quot;, true) != 0)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            getEventChannelResponse = this.EventGridManagementClient.EventChannels.Get(resourceGroup, partnerNamespaceName, eventChannelName);</span>
        <span class="c">////////            Assert.NotNull(getEventChannelResponse);</span>
        <span class="c">////////            Assert.Equal(&quot;Succeeded&quot;, getEventChannelResponse.ProvisioningState, StringComparer.CurrentCultureIgnoreCase);</span>
 
        <span class="c">////////            // Get all eventChannels created within a partnerNamespace</span>
        <span class="c">////////            IPage&lt;EventChannel&gt; eventChannelsInPartnerNamespacePage = this.EventGridManagementClient.EventChannels.ListByPartnerNamespaceAsync(resourceGroup, partnerNamespaceName).Result;</span>
        <span class="c">////////            var eventChannelsInPartnerNamespaceList = new List&lt;EventChannel&gt;();</span>
        <span class="c">////////            if (eventChannelsInPartnerNamespacePage.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                eventChannelsInPartnerNamespaceList.AddRange(eventChannelsInPartnerNamespacePage);</span>
        <span class="c">////////                var nextLink = eventChannelsInPartnerNamespacePage.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    eventChannelsInPartnerNamespacePage = this.EventGridManagementClient.EventChannels.ListByPartnerNamespaceNextAsync(nextLink).Result;</span>
        <span class="c">////////                    eventChannelsInPartnerNamespaceList.AddRange(eventChannelsInPartnerNamespacePage);</span>
        <span class="c">////////                    nextLink = eventChannelsInPartnerNamespacePage.NextPageLink;</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(eventChannelsInPartnerNamespaceList);</span>
        <span class="c">////////            Assert.True(eventChannelsInPartnerNamespaceList.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(eventChannelsInPartnerNamespaceList, t =&gt; t.Name == eventChannelName);</span>
        <span class="c">////////            Assert.True(eventChannelsInPartnerNamespaceList.All(ns =&gt; ns.Id.Contains(resourceGroup)));</span>
 
        <span class="c">////////            // Partner topic operations</span>
 
        <span class="c">////////            // Get the created partnerTopic</span>
        <span class="c">////////            var getPartnerTopicResponse = this.EventGridManagementClient.PartnerTopics.Get(resourceGroup, partnerTopicName);</span>
        <span class="c">////////            if (string.Compare(getPartnerTopicResponse.ProvisioningState, &quot;Succeeded&quot;, true) != 0)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            getPartnerTopicResponse = this.EventGridManagementClient.PartnerTopics.Get(resourceGroup, partnerTopicName);</span>
        <span class="c">////////            Assert.NotNull(getPartnerTopicResponse);</span>
        <span class="c">////////            Assert.Equal(&quot;Succeeded&quot;, getPartnerTopicResponse.ProvisioningState, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Equal(location, getPartnerTopicResponse.Location, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Null(getPartnerTopicResponse.Tags);</span>
 
        <span class="c">////////            // Get all partnerTopics created within a resourceGroup</span>
        <span class="c">////////            IPage&lt;PartnerTopic&gt; partnerTopicsInResourceGroupPage = this.EventGridManagementClient.PartnerTopics.ListByResourceGroupAsync(resourceGroup).Result;</span>
        <span class="c">////////            var partnerTopicsInResourceGroupList = new List&lt;PartnerTopic&gt;();</span>
        <span class="c">////////            if (partnerTopicsInResourceGroupPage.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerTopicsInResourceGroupList.AddRange(partnerTopicsInResourceGroupPage);</span>
        <span class="c">////////                var nextLink = partnerTopicsInResourceGroupPage.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    partnerTopicsInResourceGroupPage = this.EventGridManagementClient.PartnerTopics.ListByResourceGroupNextAsync(nextLink).Result;</span>
        <span class="c">////////                    partnerTopicsInResourceGroupList.AddRange(partnerTopicsInResourceGroupPage);</span>
        <span class="c">////////                    nextLink = partnerTopicsInResourceGroupPage.NextPageLink;</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerTopicsInResourceGroupList);</span>
        <span class="c">////////            Assert.True(partnerTopicsInResourceGroupList.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerTopicsInResourceGroupList, t =&gt; t.Name == partnerTopicName);</span>
        <span class="c">////////            Assert.True(partnerTopicsInResourceGroupList.All(ns =&gt; ns.Id.Contains(resourceGroup)));</span>
 
        <span class="c">////////            IPage&lt;PartnerTopic&gt; partnerTopicsInResourceGroupPageWithTop = this.EventGridManagementClient.PartnerTopics.ListByResourceGroupAsync(resourceGroup, null, 5).Result;</span>
        <span class="c">////////            var partnerTopicsInResourceGroupListWithTop = new List&lt;PartnerTopic&gt;();</span>
        <span class="c">////////            if (partnerTopicsInResourceGroupPageWithTop.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerTopicsInResourceGroupListWithTop.AddRange(partnerTopicsInResourceGroupPageWithTop);</span>
        <span class="c">////////                var nextLink = partnerTopicsInResourceGroupPageWithTop.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    partnerTopicsInResourceGroupPageWithTop = this.EventGridManagementClient.PartnerTopics.ListByResourceGroupNextAsync(nextLink).Result;</span>
        <span class="c">////////                    partnerTopicsInResourceGroupListWithTop.AddRange(partnerTopicsInResourceGroupPageWithTop);</span>
        <span class="c">////////                    nextLink = partnerTopicsInResourceGroupPageWithTop.NextPageLink;</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerTopicsInResourceGroupListWithTop);</span>
        <span class="c">////////            Assert.True(partnerTopicsInResourceGroupListWithTop.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerTopicsInResourceGroupListWithTop, t =&gt; t.Name == partnerTopicName);</span>
        <span class="c">////////            Assert.True(partnerTopicsInResourceGroupListWithTop.All(ns =&gt; ns.Id.Contains(resourceGroup)));</span>
 
        <span class="c">////////            // Get all partnerTopics created within the subscription irrespective of the resourceGroup</span>
        <span class="c">////////            IPage&lt;PartnerTopic&gt; partnerTopicsInAzureSubscription = this.EventGridManagementClient.PartnerTopics.ListBySubscriptionAsync(null, 100).Result;</span>
        <span class="c">////////            var partnerTopicsInAzureSubscriptionList = new List&lt;PartnerTopic&gt;();</span>
        <span class="c">////////            if (partnerTopicsInAzureSubscription.Any())</span>
        <span class="c">////////            {</span>
        <span class="c">////////                partnerTopicsInAzureSubscriptionList.AddRange(partnerTopicsInAzureSubscription);</span>
        <span class="c">////////                var nextLink = partnerTopicsInAzureSubscription.NextPageLink;</span>
        <span class="c">////////                while (nextLink != null)</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    try</span>
        <span class="c">////////                    {</span>
        <span class="c">////////                        partnerTopicsInAzureSubscription = this.EventGridManagementClient.PartnerTopics.ListBySubscriptionNextAsync(nextLink).Result;</span>
        <span class="c">////////                        partnerTopicsInAzureSubscriptionList.AddRange(partnerTopicsInAzureSubscription);</span>
        <span class="c">////////                        nextLink = partnerTopicsInAzureSubscription.NextPageLink;</span>
        <span class="c">////////                    }</span>
        <span class="c">////////                    catch (Exception ex)</span>
        <span class="c">////////                    {</span>
        <span class="c">////////                        Console.WriteLine(ex);</span>
        <span class="c">////////                        break;</span>
        <span class="c">////////                    }</span>
        <span class="c">////////                }</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            Assert.NotNull(partnerTopicsInAzureSubscriptionList);</span>
        <span class="c">////////            Assert.True(partnerTopicsInAzureSubscriptionList.Count() &gt;= 1);</span>
        <span class="c">////////            Assert.Contains(partnerTopicsInAzureSubscriptionList, t =&gt; t.Name == partnerTopicName);</span>
 
        <span class="c">////////            EventSubscription eventSubscription = new EventSubscription()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                Destination = new StorageQueueEventSubscriptionDestination()</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    QueueName = &quot;queue1&quot;,</span>
        <span class="c">////////                    ResourceId = &quot;/subscriptions/5b4b650e-28b9-4790-b3ab-ddbd88d727c4/resourceGroups/DevExpRg/providers/Microsoft.Storage/storageAccounts/devexpstg&quot;</span>
        <span class="c">////////                },</span>
        <span class="c">////////                Filter = new EventSubscriptionFilter()</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    IncludedEventTypes = null,</span>
        <span class="c">////////                    IsSubjectCaseSensitive = true,</span>
        <span class="c">////////                    SubjectBeginsWith = &quot;TestPrefix&quot;,</span>
        <span class="c">////////                    SubjectEndsWith = &quot;TestSuffix&quot;</span>
        <span class="c">////////                },</span>
        <span class="c">////////                Labels = new List&lt;string&gt;()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                &quot;TestLabel1&quot;,</span>
        <span class="c">////////                &quot;TestLabel2&quot;</span>
        <span class="c">////////            }</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            var eventSubscriptionResponse = this.EventGridManagementClient.PartnerTopicEventSubscriptions.CreateOrUpdateAsync(resourceGroup, partnerTopicName, eventSubscriptionName, eventSubscription).Result;</span>
        <span class="c">////////            eventSubscriptionCreated = true;</span>
 
        <span class="c">////////            Assert.NotNull(eventSubscriptionResponse);</span>
        <span class="c">////////            Assert.Equal(eventSubscriptionResponse.Name, eventSubscriptionName);</span>
 
        <span class="c">////////            TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
 
        <span class="c">////////            // Get the created event subscription</span>
        <span class="c">////////            eventSubscriptionResponse = EventGridManagementClient.PartnerTopicEventSubscriptions.Get(resourceGroup, partnerTopicName, eventSubscriptionName);</span>
        <span class="c">////////            if (string.Compare(eventSubscriptionResponse.ProvisioningState, &quot;Succeeded&quot;, true) != 0)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                TestUtilities.Wait(TimeSpan.FromSeconds(5));</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            eventSubscriptionResponse = EventGridManagementClient.PartnerTopicEventSubscriptions.Get(resourceGroup, partnerTopicName, eventSubscriptionName);</span>
        <span class="c">////////            Assert.NotNull(eventSubscriptionResponse);</span>
        <span class="c">////////            Assert.Equal(&quot;Succeeded&quot;, eventSubscriptionResponse.ProvisioningState, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Equal(&quot;TestPrefix&quot;, eventSubscriptionResponse.Filter.SubjectBeginsWith, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Equal(&quot;TestSuffix&quot;, eventSubscriptionResponse.Filter.SubjectEndsWith, StringComparer.CurrentCultureIgnoreCase);</span>
 
        <span class="c">////////            // Update the event subscription</span>
        <span class="c">////////            var eventSubscriptionUpdateParameters = new EventSubscriptionUpdateParameters()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                Destination = new StorageQueueEventSubscriptionDestination()</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    QueueName = &quot;queue1&quot;,</span>
        <span class="c">////////                    ResourceId = &quot;/subscriptions/5b4b650e-28b9-4790-b3ab-ddbd88d727c4/resourceGroups/DevExpRg/providers/Microsoft.Storage/storageAccounts/devexpstg&quot;</span>
        <span class="c">////////                },</span>
        <span class="c">////////                Filter = new EventSubscriptionFilter()</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    IncludedEventTypes = new List&lt;string&gt;()</span>
        <span class="c">////////                {</span>
        <span class="c">////////                    &quot;Event1&quot;,</span>
        <span class="c">////////                    &quot;Event2&quot;</span>
        <span class="c">////////                },</span>
        <span class="c">////////                    SubjectEndsWith = &quot;.jpg&quot;,</span>
        <span class="c">////////                    SubjectBeginsWith = &quot;TestPrefix&quot;</span>
        <span class="c">////////                },</span>
        <span class="c">////////                Labels = new List&lt;string&gt;()</span>
        <span class="c">////////            {</span>
        <span class="c">////////                &quot;UpdatedLabel1&quot;,</span>
        <span class="c">////////                &quot;UpdatedLabel2&quot;,</span>
        <span class="c">////////            }</span>
        <span class="c">////////            };</span>
 
        <span class="c">////////            eventSubscriptionResponse = this.eventGridManagementClient.PartnerTopicEventSubscriptions.UpdateAsync(resourceGroup, partnerTopicName, eventSubscriptionName, eventSubscriptionUpdateParameters).Result;</span>
        <span class="c">////////            Assert.Equal(&quot;.jpg&quot;, eventSubscriptionResponse.Filter.SubjectEndsWith, StringComparer.CurrentCultureIgnoreCase);</span>
        <span class="c">////////            Assert.Contains(eventSubscriptionResponse.Labels, label =&gt; label == &quot;UpdatedLabel1&quot;);</span>
 
        <span class="c">////////            // List event subscriptions</span>
        <span class="c">////////            ////////var eventSubscriptionsPage = this.EventGridManagementClient.PartnerTopicEventSubscriptions.ListByPartnerTopicAsync(resourceGroup, partnerTopicName).Result;</span>
        <span class="c">////////            ////////List&lt;EventSubscription&gt; eventSubscriptionsList = new List&lt;EventSubscription&gt;();</span>
        <span class="c">////////            ////////string nextLink = null;</span>
 
        <span class="c">////////            ////////if (eventSubscriptionsPage != null)</span>
        <span class="c">////////            ////////{</span>
        <span class="c">////////            ////////    eventSubscriptionsList.AddRange(eventSubscriptionsPage);</span>
        <span class="c">////////            ////////    nextLink = eventSubscriptionsPage.NextPageLink;</span>
        <span class="c">////////            ////////    while (nextLink != null)</span>
        <span class="c">////////            ////////    {</span>
        <span class="c">////////            ////////        eventSubscriptionsPage = this.EventGridManagementClient.EventSubscriptions.ListRegionalByResourceGroupNextAsync(nextLink).Result;</span>
        <span class="c">////////            ////////        eventSubscriptionsList.AddRange(eventSubscriptionsPage);</span>
        <span class="c">////////            ////////        nextLink = eventSubscriptionsPage.NextPageLink;</span>
        <span class="c">////////            ////////    }</span>
        <span class="c">////////            ////////}</span>
        <span class="c">////////        }</span>
        <span class="c">////////        finally</span>
        <span class="c">////////        {</span>
        <span class="c">////////            if (eventSubscriptionCreated)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                // Delete the event subscription</span>
        <span class="c">////////                EventGridManagementClient.PartnerTopicEventSubscriptions.DeleteAsync(resourceGroup, partnerTopicName, eventSubscriptionName).Wait();</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            if (partnerTopicCreated)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                // Delete partnerTopic</span>
        <span class="c">////////                this.EventGridManagementClient.PartnerTopics.DeleteAsync(resourceGroup, partnerTopicName).Wait();</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            if (eventChannelCreated)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                // Delete eventChannel</span>
        <span class="c">////////                this.EventGridManagementClient.EventChannels.DeleteAsync(resourceGroup, partnerNamespaceName, eventChannelName).Wait();</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            if (partnerNamespaceCreated)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                // Delete partnerNamespace</span>
        <span class="c">////////                this.EventGridManagementClient.PartnerNamespaces.DeleteAsync(resourceGroup, partnerNamespaceName).Wait();</span>
        <span class="c">////////            }</span>
 
        <span class="c">////////            if (partnerRegistrationCreated)</span>
        <span class="c">////////            {</span>
        <span class="c">////////                // Delete partnerRegistration</span>
        <span class="c">////////                this.EventGridManagementClient.PartnerRegistrations.DeleteAsync(resourceGroup, partnerRegistrationName).Wait();</span>
        <span class="c">////////            }</span>
        <span class="c">////////        }</span>
        <span class="c">////////    }</span>
        <span class="c">////////}</span>
    }
}</pre></td></tr></table></div></body></html>
