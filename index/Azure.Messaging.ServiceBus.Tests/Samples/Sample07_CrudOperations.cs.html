<!DOCTYPE html>
<html><head><title>Sample07_CrudOperations.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(216);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Messaging.ServiceBus.Tests/Samples/Sample07_CrudOperations.cs" target="_top">Samples\Sample07_CrudOperations.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/servicebus/Azure.Messaging.ServiceBus/tests/Samples/Sample07_CrudOperations.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Messaging.ServiceBus.Tests" target="_top">Azure.Messaging.ServiceBus.Tests.csproj</a> (Azure.Messaging.ServiceBus.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Administration</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">ServiceBus</span>.<span class="i n">Tests</span>.<span class="i n">Samples</span>
{
    <b>public class</b> <a id="bf3c6582d98f0976" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="140dbf280054cd59">Sample07_CrudOperations</span></a> : <a href="../Infrastructure/ServiceBusLiveTestBase.cs.html#dbd57f23a90c8f04" class="t t">ServiceBusLiveTestBase</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Authenticate with a connection string/&gt;.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="4b488d91c55bc4d2" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AuthenticateWithConnectionString</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:ServiceBusAdministrationClientConnectionString
            <span class="c">// Create a ServiceBusAdministrationClient that will authenticate using a connection string</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">connectionString</span> = <span class="s">&quot;&lt;connection_string&gt;&quot;</span>;
            <a href="/Azure.Messaging.ServiceBus/A.html#827d49874cba94ba" class="t t">ServiceBusAdministrationClient</a> <span id="r1 rd" class="r1 r">client</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#819724559c9b9f7f" class="t constructor">ServiceBusAdministrationClient</a>(<span class="r0 r">connectionString</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Authenticate with </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Identity/A.html#636a819641215bd9" class="t t">DefaultAzureCredential</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public void</b> <a id="267a859f596c32f6" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AuthenticateWithAAD</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:ServiceBusAdministrationClientAAD
            <span class="c">// Create a ServiceBusAdministrationClient that will authenticate using default credentials</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">fullyQualifiedNamespace</span> = <span class="s">&quot;yournamespace.servicebus.windows.net&quot;</span>;
            <a href="/Azure.Messaging.ServiceBus/A.html#827d49874cba94ba" class="t t">ServiceBusAdministrationClient</a> <span id="r3 rd" class="r3 r">client</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#b4969505efbd8bd0" class="t constructor">ServiceBusAdministrationClient</a>(<span class="r2 r">fullyQualifiedNamespace</span>, <b>new</b> <a href="/Azure.Identity/A.html#ebe3cac3c2be1903" class="t constructor">DefaultAzureCredential</a>());
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ce0a99a7da4b1a17" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateQueue</a>()
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">SNIPPET</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">queueName</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">connectionString</span> = <a href="../Infrastructure/ServiceBusLiveTestBase.cs.html#cbe8820d3b2455e1" class="i property">TestEnvironment</a>.<a href="../Infrastructure/ServiceBusTestEnvironment.cs.html#2e255d4a6d75bc9a" class="i property">ServiceBusConnectionString</a>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>try</b>
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:CreateQueue
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">SNIPPET</span>
<span class="e">                string connectionString = &quot;&lt;connection_string&gt;&quot;;
                string queueName = &quot;&lt;queue_name&gt;&quot;;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <a href="/Azure.Messaging.ServiceBus/A.html#827d49874cba94ba" class="k">var</a> <span id="r6 rd" class="r6 r">client</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#819724559c9b9f7f" class="t constructor">ServiceBusAdministrationClient</a>(<span class="r5 r">connectionString</span>);
                <a href="/Azure.Messaging.ServiceBus/A.html#2c2ef75199dd1be9" class="k">var</a> <span id="r7 rd" class="r7 r">options</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#8b61abee28dc382e" class="t constructor">CreateQueueOptions</a>(<span class="r4 r">queueName</span>)
                {
                    <a href="/Azure.Messaging.ServiceBus/A.html#8a93788e5d00d055" class="i property">AutoDeleteOnIdle</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#e7c4baa19fa38e8e" class="i method">FromDays</a>(7),
                    <a href="/Azure.Messaging.ServiceBus/A.html#fb2dfc0f886801af" class="i property">DefaultMessageTimeToLive</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#e7c4baa19fa38e8e" class="i method">FromDays</a>(2),
                    <a href="/Azure.Messaging.ServiceBus/A.html#e30adca9d5574156" class="i property">DuplicateDetectionHistoryTimeWindow</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(1),
                    <a href="/Azure.Messaging.ServiceBus/A.html#1b24da94174f60c2" class="i property">EnableBatchedOperations</a> = <b>true</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#5049a683f3698da2" class="i property">DeadLetteringOnMessageExpiration</a> = <b>true</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#d37e6516a208bd69" class="i property">EnablePartitioning</a> = <b>false</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#204e5bbbbf067660" class="i property">ForwardDeadLetteredMessagesTo</a> = <b>null</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#613f0cf9b8e20919" class="i property">ForwardTo</a> = <b>null</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#9681fa888d0621b5" class="i property">LockDuration</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(45),
                    <a href="/Azure.Messaging.ServiceBus/A.html#ad00ca6078583f7f" class="i property">MaxDeliveryCount</a> = 8,
                    <a href="/Azure.Messaging.ServiceBus/A.html#42a7caeb1d0bbf19" class="i property">MaxSizeInMegabytes</a> = 2048,
                    <a href="/Azure.Messaging.ServiceBus/A.html#8b97b212de2916e9" class="i property">RequiresDuplicateDetection</a> = <b>true</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#58674e6e8216f854" class="i property">RequiresSession</a> = <b>true</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#dedd41ca3d1c6ae3" class="i property">UserMetadata</a> = <span class="s">&quot;some metadata&quot;</span>
                };
 
                <span class="r7 r">options</span>.<a href="/Azure.Messaging.ServiceBus/A.html#ed5389e471e79f2f" class="i property">AuthorizationRules</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#b230abdc50c5414f" class="t constructor">SharedAccessAuthorizationRule</a>(
                    <span class="s">&quot;allClaims&quot;</span>,
                    <b>new</b>[] { <a href="/Azure.Messaging.ServiceBus/A.html#ccbea8c4913a9067" class="t t">AccessRights</a>.<a href="/Azure.Messaging.ServiceBus/A.html#76a6933c4f91b2ca" class="i field">Manage</a>, <a href="/Azure.Messaging.ServiceBus/A.html#ccbea8c4913a9067" class="t t">AccessRights</a>.<a href="/Azure.Messaging.ServiceBus/A.html#c90ec6186494f70e" class="i field">Send</a>, <a href="/Azure.Messaging.ServiceBus/A.html#ccbea8c4913a9067" class="t t">AccessRights</a>.<a href="/Azure.Messaging.ServiceBus/A.html#5912059b67b3d1b8" class="i field">Listen</a> }));
 
                <a href="/Azure.Messaging.ServiceBus/A.html#96f80aae2e1f18c8" class="t t">QueueProperties</a> <span id="r8 rd" class="r8 r">createdQueue</span> = <b>await</b> <span class="r6 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#bc456f01412c2478" class="i method">CreateQueueAsync</a>(<span class="r7 r">options</span>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r7 r">options</span>, <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#c67dbe6c1b69264b" class="t constructor">CreateQueueOptions</a>(<span class="r8 r">createdQueue</span>));
            }
            <b>finally</b>
            {
                <b>await</b> <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#819724559c9b9f7f" class="t constructor">ServiceBusAdministrationClient</a>(<span class="r5 r">connectionString</span>).<a href="/Azure.Messaging.ServiceBus/A.html#aa79dd9ee3fb68cc" class="i method">DeleteQueueAsync</a>(<span class="r4 r">queueName</span>);
            }
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="3170d6f29687f72c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetUpdateDeleteQueue</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">queueName</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">connectionString</span> = <a href="../Infrastructure/ServiceBusLiveTestBase.cs.html#cbe8820d3b2455e1" class="i property">TestEnvironment</a>.<a href="../Infrastructure/ServiceBusTestEnvironment.cs.html#2e255d4a6d75bc9a" class="i property">ServiceBusConnectionString</a>;
            <a href="/Azure.Messaging.ServiceBus/A.html#827d49874cba94ba" class="k">var</a> <span id="r11 rd" class="r11 r">client</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#819724559c9b9f7f" class="t constructor">ServiceBusAdministrationClient</a>(<span class="r10 r">connectionString</span>);
            <a href="/Azure.Messaging.ServiceBus/A.html#2c2ef75199dd1be9" class="k">var</a> <span id="r12 rd" class="r12 r">qd</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#8b61abee28dc382e" class="t constructor">CreateQueueOptions</a>(<span class="r9 r">queueName</span>);
            <b>await</b> <span class="r11 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#bc456f01412c2478" class="i method">CreateQueueAsync</a>(<span class="r12 r">qd</span>);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:GetQueue
            <a href="/Azure.Messaging.ServiceBus/A.html#96f80aae2e1f18c8" class="t t">QueueProperties</a> <span id="r13 rd" class="r13 r">queue</span> = <b>await</b> <span class="r11 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#7ef668a5655aa5fa" class="i method">GetQueueAsync</a>(<span class="r9 r">queueName</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:UpdateQueue
            <span class="r13 r">queue</span>.<a href="/Azure.Messaging.ServiceBus/A.html#b57ef2dd0d4aa428" class="i property">LockDuration</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(60);
            <a href="/Azure.Messaging.ServiceBus/A.html#96f80aae2e1f18c8" class="t t">QueueProperties</a> <span id="r14 rd" class="r14 r">updatedQueue</span> = <b>await</b> <span class="r11 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#a0db9a47432f6b65" class="i method">UpdateQueueAsync</a>(<span class="r13 r">queue</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(60), <span class="r14 r">updatedQueue</span>.<a href="/Azure.Messaging.ServiceBus/A.html#b57ef2dd0d4aa428" class="i property">LockDuration</a>);
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DeleteQueue
            <b>await</b> <span class="r11 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#aa79dd9ee3fb68cc" class="i method">DeleteQueueAsync</a>(<span class="r9 r">queueName</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="t t">Assert</span>.<span class="i method">That</span>(
                  <b>async</b> () =&gt;
                  <b>await</b> <span class="r11 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#7ef668a5655aa5fa" class="i method">GetQueueAsync</a>(<span class="r9 r">queueName</span>),
                  <span class="t t">Throws</span>.<span class="i method">InstanceOf</span>&lt;<a href="/Azure.Messaging.ServiceBus/A.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>&gt;().<span class="i property">And</span>.<span class="i method">Property</span>(<b>nameof</b>(<a href="/Azure.Messaging.ServiceBus/A.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="/Azure.Messaging.ServiceBus/A.html#b39014a14c98853e" class="i property">Reason</a>)).<span class="i method">EqualTo</span>(<a href="/Azure.Messaging.ServiceBus/A.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="/Azure.Messaging.ServiceBus/A.html#90caee8029a933c8" class="i field">MessagingEntityNotFound</a>));
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ff982b574ee9a903" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">CreateTopicAndSubscription</a>()
        {
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">SNIPPET</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r15 rd" class="r15 r">topicName</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r16 rd" class="r16 r">subscriptionName</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r17 rd" class="r17 r">connectionString</span> = <a href="../Infrastructure/ServiceBusLiveTestBase.cs.html#cbe8820d3b2455e1" class="i property">TestEnvironment</a>.<a href="../Infrastructure/ServiceBusTestEnvironment.cs.html#2e255d4a6d75bc9a" class="i property">ServiceBusConnectionString</a>;
            <a href="/Azure.Messaging.ServiceBus/A.html#827d49874cba94ba" class="k">var</a> <span id="r18 rd" class="r18 r">client</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#819724559c9b9f7f" class="t constructor">ServiceBusAdministrationClient</a>(<span class="r17 r">connectionString</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>try</b>
            {
                <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:CreateTopicAndSubscription
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">SNIPPET</span>
<span class="e">                string connectionString = &quot;&lt;connection_string&gt;&quot;;
                string topicName = &quot;&lt;topic_name&gt;&quot;;
                var client = new ServiceBusManagementClient(connectionString);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <a href="/Azure.Messaging.ServiceBus/A.html#ecbb5f425eb88c96" class="k">var</a> <span id="r19 rd" class="r19 r">topicOptions</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#9d7b3a77ecfa63ef" class="t constructor">CreateTopicOptions</a>(<span class="r15 r">topicName</span>)
                {
                    <a href="/Azure.Messaging.ServiceBus/A.html#0462655cdea1d7a9" class="i property">AutoDeleteOnIdle</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#e7c4baa19fa38e8e" class="i method">FromDays</a>(7),
                    <a href="/Azure.Messaging.ServiceBus/A.html#9408d4efd64ab15d" class="i property">DefaultMessageTimeToLive</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#e7c4baa19fa38e8e" class="i method">FromDays</a>(2),
                    <a href="/Azure.Messaging.ServiceBus/A.html#d83a99f7355004de" class="i property">DuplicateDetectionHistoryTimeWindow</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(1),
                    <a href="/Azure.Messaging.ServiceBus/A.html#25280fd8b0aa49c7" class="i property">EnableBatchedOperations</a> = <b>true</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#b395cc08d4f067ff" class="i property">EnablePartitioning</a> = <b>false</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#eed8d7ee28ec42c4" class="i property">MaxSizeInMegabytes</a> = 2048,
                    <a href="/Azure.Messaging.ServiceBus/A.html#e2bf25032ee4d922" class="i property">RequiresDuplicateDetection</a> = <b>true</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#68b62dc3de2a3a39" class="i property">UserMetadata</a> = <span class="s">&quot;some metadata&quot;</span>
                };
 
                <span class="r19 r">topicOptions</span>.<a href="/Azure.Messaging.ServiceBus/A.html#7c46a1fdf0f3696b" class="i property">AuthorizationRules</a>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#b230abdc50c5414f" class="t constructor">SharedAccessAuthorizationRule</a>(
                    <span class="s">&quot;allClaims&quot;</span>,
                    <b>new</b>[] { <a href="/Azure.Messaging.ServiceBus/A.html#ccbea8c4913a9067" class="t t">AccessRights</a>.<a href="/Azure.Messaging.ServiceBus/A.html#76a6933c4f91b2ca" class="i field">Manage</a>, <a href="/Azure.Messaging.ServiceBus/A.html#ccbea8c4913a9067" class="t t">AccessRights</a>.<a href="/Azure.Messaging.ServiceBus/A.html#c90ec6186494f70e" class="i field">Send</a>, <a href="/Azure.Messaging.ServiceBus/A.html#ccbea8c4913a9067" class="t t">AccessRights</a>.<a href="/Azure.Messaging.ServiceBus/A.html#5912059b67b3d1b8" class="i field">Listen</a> }));
 
                <a href="/Azure.Messaging.ServiceBus/A.html#5f455b5c63b17daf" class="t t">TopicProperties</a> <span id="r20 rd" class="r20 r">createdTopic</span> = <b>await</b> <span class="r18 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#1a1bd1ddd84e0245" class="i method">CreateTopicAsync</a>(<span class="r19 r">topicOptions</span>);
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">SNIPPET</span>
<span class="e">                string subscriptionName = &quot;&lt;subscription_name&gt;&quot;;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                <a href="/Azure.Messaging.ServiceBus/A.html#c374bdb1cfd05a1d" class="k">var</a> <span id="r21 rd" class="r21 r">subscriptionOptions</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#deaf86a90ba7e12a" class="t constructor">CreateSubscriptionOptions</a>(<span class="r15 r">topicName</span>, <span class="r16 r">subscriptionName</span>)
                {
                    <a href="/Azure.Messaging.ServiceBus/A.html#571df52c7f1dc576" class="i property">AutoDeleteOnIdle</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#e7c4baa19fa38e8e" class="i method">FromDays</a>(7),
                    <a href="/Azure.Messaging.ServiceBus/A.html#317ca7f85dab057c" class="i property">DefaultMessageTimeToLive</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#e7c4baa19fa38e8e" class="i method">FromDays</a>(2),
                    <a href="/Azure.Messaging.ServiceBus/A.html#a390b23015512457" class="i property">EnableBatchedOperations</a> = <b>true</b>,
                    <a href="/Azure.Messaging.ServiceBus/A.html#d6698ae6af8bd37e" class="i property">UserMetadata</a> = <span class="s">&quot;some metadata&quot;</span>
                };
                <a href="/Azure.Messaging.ServiceBus/A.html#e56c1e71370bb3d4" class="t t">SubscriptionProperties</a> <span id="r22 rd" class="r22 r">createdSubscription</span> = <b>await</b> <span class="r18 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#ca96fd0c2a6c0c3c" class="i method">CreateSubscriptionAsync</a>(<span class="r21 r">subscriptionOptions</span>);
                <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r19 r">topicOptions</span>, <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#3dc324d79e3b4172" class="t constructor">CreateTopicOptions</a>(<span class="r20 r">createdTopic</span>));
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r21 r">subscriptionOptions</span>, <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#a2461f3300d13025" class="t constructor">CreateSubscriptionOptions</a>(<span class="r22 r">createdSubscription</span>));
            }
            <b>finally</b>
            {
                <b>await</b> <span class="r18 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#22d770ae7b158317" class="i method">DeleteTopicAsync</a>(<span class="r15 r">topicName</span>);
            }
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="bc774d6799345646" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetUpdateDeleteTopicAndSubscription</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r23 rd" class="r23 r">topicName</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r24 rd" class="r24 r">subscriptionName</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#8015cb30da6ca742" class="i method">ToString</a>(<span class="s">&quot;D&quot;</span>).<a href="@0@mscorlib/A.html#8124961f027d9ac9" class="i method">Substring</a>(0, 8);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r25 rd" class="r25 r">connectionString</span> = <a href="../Infrastructure/ServiceBusLiveTestBase.cs.html#cbe8820d3b2455e1" class="i property">TestEnvironment</a>.<a href="../Infrastructure/ServiceBusTestEnvironment.cs.html#2e255d4a6d75bc9a" class="i property">ServiceBusConnectionString</a>;
            <a href="/Azure.Messaging.ServiceBus/A.html#827d49874cba94ba" class="k">var</a> <span id="r26 rd" class="r26 r">client</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#819724559c9b9f7f" class="t constructor">ServiceBusAdministrationClient</a>(<span class="r25 r">connectionString</span>);
            <a href="/Azure.Messaging.ServiceBus/A.html#ecbb5f425eb88c96" class="k">var</a> <span id="r27 rd" class="r27 r">topicOptions</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#9d7b3a77ecfa63ef" class="t constructor">CreateTopicOptions</a>(<span class="r23 r">topicName</span>);
            <a href="/Azure.Messaging.ServiceBus/A.html#c374bdb1cfd05a1d" class="k">var</a> <span id="r28 rd" class="r28 r">subscriptionOptions</span> = <b>new</b> <a href="/Azure.Messaging.ServiceBus/A.html#deaf86a90ba7e12a" class="t constructor">CreateSubscriptionOptions</a>(<span class="r23 r">topicName</span>, <span class="r24 r">subscriptionName</span>);
            <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#1a1bd1ddd84e0245" class="i method">CreateTopicAsync</a>(<span class="r27 r">topicOptions</span>);
            <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#ca96fd0c2a6c0c3c" class="i method">CreateSubscriptionAsync</a>(<span class="r28 r">subscriptionOptions</span>);
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:GetTopic
            <a href="/Azure.Messaging.ServiceBus/A.html#5f455b5c63b17daf" class="t t">TopicProperties</a> <span id="r29 rd" class="r29 r">topic</span> = <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#5f2a934089e15cda" class="i method">GetTopicAsync</a>(<span class="r23 r">topicName</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:GetSubscription
            <a href="/Azure.Messaging.ServiceBus/A.html#e56c1e71370bb3d4" class="t t">SubscriptionProperties</a> <span id="r30 rd" class="r30 r">subscription</span> = <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#4077a0bee6144052" class="i method">GetSubscriptionAsync</a>(<span class="r23 r">topicName</span>, <span class="r24 r">subscriptionName</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:UpdateTopic
            <span class="r29 r">topic</span>.<a href="/Azure.Messaging.ServiceBus/A.html#6c67e6c5ebd1d543" class="i property">UserMetadata</a> = <span class="s">&quot;some metadata&quot;</span>;
            <a href="/Azure.Messaging.ServiceBus/A.html#5f455b5c63b17daf" class="t t">TopicProperties</a> <span id="r31 rd" class="r31 r">updatedTopic</span> = <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#81a63608fd179315" class="i method">UpdateTopicAsync</a>(<span class="r29 r">topic</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;some metadata&quot;</span>, <span class="r31 r">updatedTopic</span>.<a href="/Azure.Messaging.ServiceBus/A.html#6c67e6c5ebd1d543" class="i property">UserMetadata</a>);
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:UpdateSubscription
            <span class="r30 r">subscription</span>.<a href="/Azure.Messaging.ServiceBus/A.html#e07c83a970c7258b" class="i property">UserMetadata</a> = <span class="s">&quot;some metadata&quot;</span>;
            <a href="/Azure.Messaging.ServiceBus/A.html#e56c1e71370bb3d4" class="t t">SubscriptionProperties</a> <span id="r32 rd" class="r32 r">updatedSubscription</span> = <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#af2e258377fa417c" class="i method">UpdateSubscriptionAsync</a>(<span class="r30 r">subscription</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="s">&quot;some metadata&quot;</span>, <span class="r32 r">updatedSubscription</span>.<a href="/Azure.Messaging.ServiceBus/A.html#e07c83a970c7258b" class="i property">UserMetadata</a>);
 
            <span class="c">// need to delete the subscription before the topic, as deleting</span>
            <span class="c">// the topic would automatically delete the subscription</span>
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DeleteSubscription
            <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#c1f8a48543acf559" class="i method">DeleteSubscriptionAsync</a>(<span class="r23 r">topicName</span>, <span class="r24 r">subscriptionName</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="t t">Assert</span>.<span class="i method">That</span>(
                  <b>async</b> () =&gt;
                  <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#4077a0bee6144052" class="i method">GetSubscriptionAsync</a>(<span class="r23 r">topicName</span>, <span class="r24 r">subscriptionName</span>),
                  <span class="t t">Throws</span>.<span class="i method">InstanceOf</span>&lt;<a href="/Azure.Messaging.ServiceBus/A.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>&gt;().<span class="i property">And</span>.<span class="i method">Property</span>(<b>nameof</b>(<a href="/Azure.Messaging.ServiceBus/A.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="/Azure.Messaging.ServiceBus/A.html#b39014a14c98853e" class="i property">Reason</a>)).<span class="i method">EqualTo</span>(<a href="/Azure.Messaging.ServiceBus/A.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="/Azure.Messaging.ServiceBus/A.html#90caee8029a933c8" class="i field">MessagingEntityNotFound</a>));
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:DeleteTopic
            <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#22d770ae7b158317" class="i method">DeleteTopicAsync</a>(<span class="r23 r">topicName</span>);
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
            <span class="t t">Assert</span>.<span class="i method">That</span>(
                  <b>async</b> () =&gt;
                  <b>await</b> <span class="r26 r">client</span>.<a href="/Azure.Messaging.ServiceBus/A.html#5f2a934089e15cda" class="i method">GetTopicAsync</a>(<span class="r23 r">topicName</span>),
                  <span class="t t">Throws</span>.<span class="i method">InstanceOf</span>&lt;<a href="/Azure.Messaging.ServiceBus/A.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>&gt;().<span class="i property">And</span>.<span class="i method">Property</span>(<b>nameof</b>(<a href="/Azure.Messaging.ServiceBus/A.html#a5716ddcbc4510f2" class="t t">ServiceBusException</a>.<a href="/Azure.Messaging.ServiceBus/A.html#b39014a14c98853e" class="i property">Reason</a>)).<span class="i method">EqualTo</span>(<a href="/Azure.Messaging.ServiceBus/A.html#ac3a011acdeef28e" class="t t">ServiceBusFailureReason</a>.<a href="/Azure.Messaging.ServiceBus/A.html#90caee8029a933c8" class="i field">MessagingEntityNotFound</a>));
        }
    }
}
</pre></td></tr></table></div></body></html>
