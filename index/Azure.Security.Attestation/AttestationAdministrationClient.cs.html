<!DOCTYPE html>
<html><head><title>AttestationAdministrationClient.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(677);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Security.Attestation/AttestationAdministrationClient.cs" target="_top">AttestationAdministrationClient.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/attestation/Azure.Security.Attestation/src/AttestationAdministrationClient.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Security.Attestation" target="_top">Azure.Security.Attestation.csproj</a> (Azure.Security.Attestation)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Security</span>.<span class="i n">Cryptography</span>.<span class="i n">X509Certificates</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">Json</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Security</span>.<span class="i n">Attestation</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Attestation Client for the Microsoft Azure Attestation service.</span>
    <span class="c">///</span>
    <span class="c">///</span><span class="c"> The Attestation client contains the implementation of the &quot;Attest&quot; family of MAA apis.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="a99baaa4028ac1c6" href="R/a99baaa4028ac1c6.html" target="n" data-glyph="0,0" class="t t">AttestationAdministrationClient</a> : <a href="@1@netstandard/A.html#1f55292c3174123d" class="t t">IDisposable</a>
    {
        <b>private readonly</b> <a href="AttestationClientOptions.cs.html#9d0ecd576a12aeef" class="t t">AttestationClientOptions</a> <a id="02b28a5ff521fa66" href="R/02b28a5ff521fa66.html" target="n" data-glyph="46,1" class="i field">_options</a>;
        <b>private readonly</b> <a href="/Azure.Core/A.html#ce2f2fae396f36c5" class="t t">HttpPipeline</a> <a id="a72a98f35f789f43" href="R/a72a98f35f789f43.html" target="n" data-glyph="46,1" class="i field">_pipeline</a>;
        <b>private readonly</b> <a href="Shared/ClientDiagnostics.cs.html#60221cb69e1f903a" class="t t">ClientDiagnostics</a> <a id="faab5a77f8b71b43" href="R/faab5a77f8b71b43.html" target="n" data-glyph="46,1" class="i field">_clientDiagnostics</a>;
        <b>private readonly</b> <a href="Generated/PolicyRestClient.cs.html#e448f2e06edc9250" class="t t">PolicyRestClient</a> <a id="64ce84d1dc2eb402" href="R/64ce84d1dc2eb402.html" target="n" data-glyph="46,1" class="i field">_policyClient</a>;
        <b>private readonly</b> <a href="Generated/PolicyCertificatesRestClient.cs.html#57578ecdb25041ed" class="t t">PolicyCertificatesRestClient</a> <a id="64ada79922f7aa1f" href="R/64ada79922f7aa1f.html" target="n" data-glyph="46,1" class="i field">_policyManagementClient</a>;
        <b>private readonly</b> <a href="AttestationClient.cs.html#e26fa450a413a421" class="t t">AttestationClient</a> <a id="28ac14a2f1d08905" href="R/28ac14a2f1d08905.html" target="n" data-glyph="46,1" class="i field">_attestationClient</a>;
 
        <b>private</b> <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="Models/AttestationSigner.cs.html#52699b74934bdfd6" class="t t">AttestationSigner</a>&gt; <a id="3433c55686c690eb" href="R/3433c55686c690eb.html" target="n" data-glyph="46,1" class="i field">_signers</a>;
        <b>private</b> <a href="@1@netstandard/A.html#d57f52e0341a581f" class="t t">SemaphoreSlim</a> <a id="2c83ea81477d44d5" href="R/2c83ea81477d44d5.html" target="n" data-glyph="46,1" class="i field">_statelock</a> = <b>new</b> <a href="@1@netstandard/A.html#ed5ff10a1fcba4d4" class="t constructor">SemaphoreSlim</a>(1, 1);
        <b>private bool</b> <a id="efccdb9765f04c21" href="R/efccdb9765f04c21.html" target="n" data-glyph="46,1" class="i field">_disposedValue</a>;
 
        <span class="c">// Default scope for data plane APIs.</span>
        <b>private const string</b> <a id="95a8162c569e13cc" href="R/95a8162c569e13cc.html" target="n" data-glyph="10,1" class="i field">DefaultScope</a> = <span class="s">&quot;https://attest.azure.net/.default&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the URI used to communicate with the service.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="@1@netstandard/A.html#991565dd25f47c90" class="t t">Uri</a> <a id="b624d87275515435" href="R/b624d87275515435.html" target="n" data-glyph="102,1" class="i property">Endpoint</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationClient.cs.html#e26fa450a413a421" class="t t">AttestationClient</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">endpoint</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Uri for the Microsoft Azure Attestation Service Instance to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Credentials to be used in the Client.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="fed02bc589309501" href="R/fed02bc589309501.html" target="n" data-glyph="72,1" class="t constructor">AttestationAdministrationClient</a>(<a href="@1@netstandard/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r0 rd" class="r0 r">endpoint</span>, <a href="/Azure.Core/A.html#d93a9ffee404e938" class="t t">TokenCredential</a> <span id="r1 rd" class="r1 r">credential</span>)
            : <a href="#c8ebd50a451344f0" class="k">this</a>(<span class="r0 r">endpoint</span>, <span class="r1 r">credential</span>, <b>new</b> <a href="AttestationClientOptions.cs.html#4a470be75cf325f4" class="t constructor">AttestationClientOptions</a>())
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Initializes a new instance of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationClient.cs.html#e26fa450a413a421" class="t t">AttestationClient</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">endpoint</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Uri for the Microsoft Azure Attestation Service Instance to use.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">credential</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Credentials to be used in the Client.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationClientOptions.cs.html#9d0ecd576a12aeef" class="t t">AttestationClientOptions</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> used to configure the API client.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="c8ebd50a451344f0" href="R/c8ebd50a451344f0.html" target="n" data-glyph="72,1" class="t constructor">AttestationAdministrationClient</a>(<a href="@1@netstandard/A.html#991565dd25f47c90" class="t t">Uri</a> <span id="r2 rd" class="r2 r">endpoint</span>, <a href="/Azure.Core/A.html#d93a9ffee404e938" class="t t">TokenCredential</a> <span id="r3 rd" class="r3 r">credential</span>, <a href="AttestationClientOptions.cs.html#9d0ecd576a12aeef" class="t t">AttestationClientOptions</a> <span id="r4 rd" class="r4 r">options</span>)
        {
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r2 r">endpoint</span>, <b>nameof</b>(<span class="r2 r">endpoint</span>));
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r3 r">credential</span>, <b>nameof</b>(<span class="r3 r">credential</span>));
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r4 r">options</span>, <b>nameof</b>(<span class="r4 r">options</span>));
 
            <a href="#02b28a5ff521fa66" class="i field">_options</a> = <span class="r4 r">options</span>;
 
            <span class="c">// Add the authentication policy to our builder.</span>
            <a href="#a72a98f35f789f43" class="i field">_pipeline</a> = <a href="/Azure.Core/A.html#caf101e059b27790" class="t t">HttpPipelineBuilder</a>.<a href="/Azure.Core/A.html#e4c688f935b020a5" class="i method">Build</a>(<span class="r4 r">options</span>, <b>new</b> <a href="/Azure.Core/A.html#91bc5621659120f1" class="t constructor">BearerTokenAuthenticationPolicy</a>(<span class="r3 r">credential</span>, <a href="#95a8162c569e13cc" class="i field">DefaultScope</a>));
 
            <span class="c">// Initialize the ClientDiagnostics.</span>
            <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a> = <b>new</b> <a href="Shared/ClientDiagnostics.cs.html#4399d236463c3dac" class="t constructor">ClientDiagnostics</a>(<span class="r4 r">options</span>);
 
            <a href="#b624d87275515435" class="i property">Endpoint</a> = <span class="r2 r">endpoint</span>;
 
            <span class="c">// Initialize the Policy Rest Client.</span>
            <a href="#64ce84d1dc2eb402" class="i field">_policyClient</a> = <b>new</b> <a href="Generated/PolicyRestClient.cs.html#5f1f545516d83a46" class="t constructor">PolicyRestClient</a>(<a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>, <a href="#a72a98f35f789f43" class="i field">_pipeline</a>, <a href="#b624d87275515435" class="i property">Endpoint</a>.<a href="@1@netstandard/A.html#e335fec0022465e6" class="i property">AbsoluteUri</a>, <span class="r4 r">options</span>.<a href="AttestationClientOptions.cs.html#e606963c34425947" class="i property">Version</a>);
 
            <span class="c">// Initialize the Certificates Rest Client.</span>
            <a href="#64ada79922f7aa1f" class="i field">_policyManagementClient</a> = <b>new</b> <a href="Generated/PolicyCertificatesRestClient.cs.html#a2efc9f54735f089" class="t constructor">PolicyCertificatesRestClient</a>(<a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>, <a href="#a72a98f35f789f43" class="i field">_pipeline</a>, <a href="#b624d87275515435" class="i property">Endpoint</a>.<a href="@1@netstandard/A.html#e335fec0022465e6" class="i property">AbsoluteUri</a>, <span class="r4 r">options</span>.<a href="AttestationClientOptions.cs.html#e606963c34425947" class="i property">Version</a>);
 
            <span class="c">// Initialize the Attestation Rest Client.</span>
            <a href="#28ac14a2f1d08905" class="i field">_attestationClient</a> = <b>new</b> <a href="AttestationClient.cs.html#29aa135d73c3bd9b" class="t constructor">AttestationClient</a>(<span class="r2 r">endpoint</span>, <span class="r3 r">credential</span>, <span class="r4 r">options</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parameterless constructor for mocking.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>protected</b> <a id="9022244ee490faf6" href="R/../../0000000000.html" target="n" data-glyph="75,1" class="t constructor">AttestationAdministrationClient</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the attesttion policy for the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">attestationType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to retrive.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r7 r t">String</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This API returns the underlying attestation policy object stored in the attestation service for this </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">attestationType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The actual service response to the API is an RFC 7519 JSON Web Token. This token can be retrieved from </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r8 r t">T</span>}.<a href="AttestationResponse.cs.html#3d377c2ce6ae2463" class="i property">Token</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> For the GetPolicy API, the body of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r9 r t">T</span>}.<a href="AttestationResponse.cs.html#3d377c2ce6ae2463" class="i property">Token</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/d13f20bdd393c969.html#d13f20bdd393c969" class="t t">StoredAttestationPolicy</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object, NOT a string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="76b727ca19b070e9" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetPolicy</a>(<a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a> <span id="r5 rd" class="r5 r">attestationType</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r6 rd" class="r6 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r10 rd" class="r10 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">GetPolicy</span>)}<span class="s">&quot;</span>);
            <span class="r10 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r11 rd" class="r11 r">result</span> = <a href="#64ce84d1dc2eb402" class="i field">_policyClient</a>.<a href="Generated/PolicyRestClient.cs.html#d514094520a3fbd4" class="i method">Get</a>(<span class="r5 r">attestationType</span>, <span class="r6 r">cancellationToken</span>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r12 rd" class="r12 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r11 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyResponse.cs.html#ddfa5aa877faea09" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <span class="r12 r">token</span>.<a href="AttestationToken.cs.html#5fcd8ebb92f3fd97" class="i method">ValidateToken</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <a href="#a290fe8202b59af9" class="i method">GetSigners</a>(<span class="r6 r">cancellationToken</span>), <span class="r6 r">cancellationToken</span>);
                }
 
                <b>using</b> <b>var</b> <span id="r13 rd" class="r13 r">document</span> = <span class="t t">JsonDocument</span>.<span class="i method">Parse</span>(<span class="r12 r">token</span>.<a href="AttestationToken.cs.html#66a76bf06b2e2675" class="i property">TokenBody</a>);
                <a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a> <span id="r14 rd" class="r14 r">policyResult</span> = <a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Generated/Models/PolicyResult.Serialization.cs.html#c9f5b56967ef119e" class="i method">DeserializePolicyResult</a>(<span class="r13 r">document</span>.<span class="i property">RootElement</span>);
 
                <a href="AttestationResponse.cs.html#fcdef98218d64497" class="k">var</a> <span id="r15 rd" class="r15 r">response</span> = <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/d13f20bdd393c969.html#d13f20bdd393c969" class="t t">StoredAttestationPolicy</a>&gt;(<span class="r11 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r14 r">policyResult</span>.<a href="Models/PolicyResult.cs.html#8f4d8f51e0aba4d9" class="i property">PolicyToken</a>);
 
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>&gt;(<span class="r11 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r14 r">policyResult</span>.<a href="Models/PolicyResult.cs.html#8f4d8f51e0aba4d9" class="i property">PolicyToken</a>, <span class="r15 r">response</span>.<a href="AttestationResponse.cs.html#de5c84d79e11d6a1" class="i property">Value</a>.<a href="Models/StoredAttestationPolicy.cs.html#16a9ab04809aa9e7" class="i property">AttestationPolicy</a>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r16 rd" class="r16 r">ex</span>)
            {
                <span class="r10 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r16 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the attesttion policy for the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">attestationType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Attestation Type to retrive.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r19 r t">String</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> This API returns the underlying attestation policy object stored in the attestation service for this </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">attestationType</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> The actual service response to the API is an RFC 7519 JSON Web Token. This token can be retrieved from </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r20 r t">T</span>}.<a href="AttestationResponse.cs.html#3d377c2ce6ae2463" class="i property">Token</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> For the GetPolicyAsync API, the body of the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r21 r t">T</span>}.<a href="AttestationResponse.cs.html#3d377c2ce6ae2463" class="i property">Token</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> is a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/d13f20bdd393c969.html#d13f20bdd393c969" class="t t">StoredAttestationPolicy</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> object, NOT a string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>&gt;&gt; <a id="67c4a5a5d1c93605" href="R/67c4a5a5d1c93605.html" target="n" data-glyph="72,1" class="i method">GetPolicyAsync</a>(<a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a> <span id="r17 rd" class="r17 r">attestationType</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r18 rd" class="r18 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r22 rd" class="r22 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">GetPolicy</span>)}<span class="s">&quot;</span>);
            <span class="r22 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r23 rd" class="r23 r">result</span> = <b>await</b> <a href="#64ce84d1dc2eb402" class="i field">_policyClient</a>.<a href="Generated/PolicyRestClient.cs.html#1cf34195002a1ad5" class="i method">GetAsync</a>(<span class="r17 r">attestationType</span>, <span class="r18 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r24 rd" class="r24 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r23 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyResponse.cs.html#ddfa5aa877faea09" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <b>await</b> <span class="r24 r">token</span>.<a href="AttestationToken.cs.html#0bbeb118b6ac45fd" class="i method">ValidateTokenAsync</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <b>await</b> <a href="#f8946c75e65199eb" class="i method">GetSignersAsync</a>(<span class="r18 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>), <span class="r18 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>using</b> <b>var</b> <span id="r25 rd" class="r25 r">document</span> = <span class="t t">JsonDocument</span>.<span class="i method">Parse</span>(<span class="r24 r">token</span>.<a href="AttestationToken.cs.html#66a76bf06b2e2675" class="i property">TokenBody</a>);
                <a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a> <span id="r26 rd" class="r26 r">policyResult</span> = <a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Generated/Models/PolicyResult.Serialization.cs.html#c9f5b56967ef119e" class="i method">DeserializePolicyResult</a>(<span class="r25 r">document</span>.<span class="i property">RootElement</span>);
                <a href="AttestationResponse.cs.html#fcdef98218d64497" class="k">var</a> <span id="r27 rd" class="r27 r">response</span> = <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/d13f20bdd393c969.html#d13f20bdd393c969" class="t t">StoredAttestationPolicy</a>&gt;(<span class="r23 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r26 r">policyResult</span>.<a href="Models/PolicyResult.cs.html#8f4d8f51e0aba4d9" class="i property">PolicyToken</a>);
 
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>&gt;(<span class="r23 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r26 r">policyResult</span>.<a href="Models/PolicyResult.cs.html#8f4d8f51e0aba4d9" class="i property">PolicyToken</a>, <span class="r27 r">response</span>.<a href="AttestationResponse.cs.html#de5c84d79e11d6a1" class="i property">Value</a>.<a href="Models/StoredAttestationPolicy.cs.html#16a9ab04809aa9e7" class="i property">AttestationPolicy</a>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r28 rd" class="r28 r">ex</span>)
            {
                <span class="r22 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r28 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the attesttion policy for the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r29 r">attestationType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> whose policy should be set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">policyToSet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies the attestation policy to set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">signingKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, specifies the signing key used to sign the request to the attestation service.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r32 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r33 r t">PolicyResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r31 r">signingKey</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter is not provided, then the policy document sent to the</span>
        <span class="c">///</span><span class="c"> attestation service will be unsigned. Unsigned attestation policies are only allowed when the attestation instance is running in AAD mode - if the</span>
        <span class="c">///</span><span class="c"> attestation instance is running in Isolated mode, then a signing key and signing certificate MUST be provided to ensure that the caller of the API is authorized to change policy.</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a>.<a href="Models/TokenSigningKey.cs.html#36b9155cb8ec909f" class="i property">Certificate</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> field MUST be one of the certificates returned by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#6f55657bbf42b37e" class="i method">GetPolicyManagementCertificates</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> API.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> Clients need to be able to verify that the attestation policy document was not modified before the policy document was received by the attestation service&#39;s enclave.</span>
        <span class="c">///</span><span class="c"> There are two properties provided in the [PolicyResult][attestation_policy_result] that can be used to verify that the service received the policy document:</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">list</span> <span class="c">type</span><span class="c">=</span><span class="c">&quot;</span><span class="c">bullet</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">description</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Models/PolicyResult.cs.html#de3ab3b0ef0e1a4c" class="i property">PolicySigner</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> - if the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#315f39ae6a298c41" class="i method">SetPolicy</a>(<a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> call included a signing certificate, this will be the certificate provided at the time of the `SetPolicy` call. If no policy signer was set, this will be null. </span><span class="c">&lt;/</span><span class="c">description</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">description</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Models/PolicyResult.cs.html#bc6548b029ae3f38" class="i property">PolicyTokenHash</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> - this is the hash of the [JSON Web Token][json_web_token] sent to the service</span><span class="c">&lt;/</span><span class="c">description</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">list</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> To verify the hash, clients can generate an attestation token and verify the hash generated from that token:</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">code</span> <span class="c">snippet</span><span class="c">=</span><span class="c">&quot;</span><span class="c">Snippet:VerifySigningHash</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> // The SetPolicyAsync API will create an AttestationToken signed with the TokenSigningKey to transmit the policy.</span>
        <span class="c">///</span><span class="c"> // To verify that the policy specified by the caller was received by the service inside the enclave, we</span>
        <span class="c">///</span><span class="c"> // verify that the hash of the policy document returned from the Attestation Service matches the hash</span>
        <span class="c">///</span><span class="c"> // of an attestation token created locally.</span>
        <span class="c">///</span><span class="c"> TokenSigningKey signingKey = new TokenSigningKey(</span><span class="c">&amp;lt;</span><span class="c">Customer provided signing key</span><span class="c">&amp;gt;</span><span class="c">, </span><span class="c">&amp;lt;</span><span class="c">Customer provided certificate</span><span class="c">&amp;gt;</span><span class="c">)</span>
        <span class="c">///</span><span class="c"> var policySetToken = new AttestationToken(</span>
        <span class="c">///</span><span class="c">     new StoredAttestationPolicy { AttestationPolicy = attestationPolicy },</span>
        <span class="c">///</span><span class="c">     signingKey);</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> using var shaHasher = SHA256Managed.Create();</span>
        <span class="c">///</span><span class="c"> var attestationPolicyHash = shaHasher.ComputeHash(Encoding.UTF8.GetBytes(policySetToken.ToString()));</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Debug.Assert(attestationPolicyHash.SequenceEqual(setResult.Value.PolicyTokenHash));</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If the signing key and certificate are not provided, then the SetPolicyAsync API will create an unsecured attestation token</span>
        <span class="c">///</span><span class="c"> wrapping the attestation policy. To validate the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Models/PolicyResult.cs.html#bc6548b029ae3f38" class="i property">PolicyTokenHash</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> return value, a developer</span>
        <span class="c">///</span><span class="c"> can create their own </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationToken.cs.html#fe59844e2c351bcf" class="t t">AttestationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and create the hash of that.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> using var shaHasher = SHA256Managed.Create();</span>
        <span class="c">///</span><span class="c"> var policySetToken = new UnsecuredAttestationToken(new StoredAttestationPolicy { AttestationPolicy = disallowDebugging });</span>
        <span class="c">///</span><span class="c"> disallowDebuggingHash = shaHasher.ComputeHash(Encoding.UTF8.GetBytes(policySetToken.ToString()));</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt; <a id="315f39ae6a298c41" href="R/315f39ae6a298c41.html" target="n" data-glyph="72,1" class="i method">SetPolicy</a>(
            <a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a> <span id="r29 rd" class="r29 r">attestationType</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r30 rd" class="r30 r">policyToSet</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r31 rd" class="r31 r">signingKey</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r32 rd" class="r32 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#fa55a5c88c3dc11d" class="i method">AssertNotNullOrWhiteSpace</a>(<span class="r30 r">policyToSet</span>, <b>nameof</b>(<span class="r30 r">policyToSet</span>));
 
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r34 rd" class="r34 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">SetPolicy</span>)}<span class="s">&quot;</span>);
            <span class="r34 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="t t">AttestationToken</a> <span id="r35 rd" class="r35 r">tokenToSet</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(
                    <b>new</b> <a href="Models/StoredAttestationPolicy.cs.html#84c6487c0cfffc1f" class="t constructor">StoredAttestationPolicy</a> { <a href="Models/StoredAttestationPolicy.cs.html#16a9ab04809aa9e7" class="i property">AttestationPolicy</a> = <span class="r30 r">policyToSet</span>, },
                    <span class="r31 r">signingKey</span>);
 
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r36 rd" class="r36 r">result</span> = <a href="#64ce84d1dc2eb402" class="i field">_policyClient</a>.<a href="Generated/PolicyRestClient.cs.html#62a256bf6628f088" class="i method">Set</a>(<span class="r29 r">attestationType</span>, <span class="r35 r">tokenToSet</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r32 r">cancellationToken</span>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r37 rd" class="r37 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r36 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyResponse.cs.html#ddfa5aa877faea09" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <span class="r37 r">token</span>.<a href="AttestationToken.cs.html#5fcd8ebb92f3fd97" class="i method">ValidateToken</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <a href="#a290fe8202b59af9" class="i method">GetSigners</a>(<span class="r32 r">cancellationToken</span>), <span class="r32 r">cancellationToken</span>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt;(<span class="r36 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r37 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r38 rd" class="r38 r">ex</span>)
            {
                <span class="r34 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r38 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Sets the attesttion policy for the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">attestationType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> whose policy should be set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">policyToSet</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Specifies the attestation policy to set.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">signingKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, specifies the signing key used to sign the request to the attestation service.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r43 r t">PolicyResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">signingKey</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter is not provided, then the policy document sent to the</span>
        <span class="c">///</span><span class="c"> attestation service will be unsigned. Unsigned attestation policies are only allowed when the attestation instance is running in AAD mode - if the</span>
        <span class="c">///</span><span class="c"> attestation instance is running in Isolated mode, then a signing key and signing certificate MUST be provided to ensure that the caller of the API is authorized to change policy.</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a>.<a href="Models/TokenSigningKey.cs.html#36b9155cb8ec909f" class="i property">Certificate</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> field MUST be one of the certificates returned by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#6f55657bbf42b37e" class="i method">GetPolicyManagementCertificates</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> API.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> Clients need to be able to verify that the attestation policy document was not modified before the policy document was received by the attestation service&#39;s enclave.</span>
        <span class="c">///</span><span class="c"> There are two properties provided in the [PolicyResult][attestation_policy_result] that can be used to verify that the service received the policy document:</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">list</span> <span class="c">type</span><span class="c">=</span><span class="c">&quot;</span><span class="c">bullet</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">description</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Models/PolicyResult.cs.html#de3ab3b0ef0e1a4c" class="i property">PolicySigner</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> - if the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#315f39ae6a298c41" class="i method">SetPolicy</a>(<a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a>, <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> call included a signing certificate, this will be the certificate provided at the time of the `SetPolicy` call. If no policy signer was set, this will be null. </span><span class="c">&lt;/</span><span class="c">description</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">description</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Models/PolicyResult.cs.html#bc6548b029ae3f38" class="i property">PolicyTokenHash</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> - this is the hash of the [JSON Web Token][json_web_token] sent to the service</span><span class="c">&lt;/</span><span class="c">description</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">item</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">list</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> To verify the hash, clients can generate an attestation token and verify the hash generated from that token:</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">code</span> <span class="c">snippet</span><span class="c">=</span><span class="c">&quot;</span><span class="c">Snippet:VerifySigningHash</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> // The SetPolicyAsync API will create an AttestationToken signed with the TokenSigningKey to transmit the policy.</span>
        <span class="c">///</span><span class="c"> // To verify that the policy specified by the caller was received by the service inside the enclave, we</span>
        <span class="c">///</span><span class="c"> // verify that the hash of the policy document returned from the Attestation Service matches the hash</span>
        <span class="c">///</span><span class="c"> // of an attestation token created locally.</span>
        <span class="c">///</span><span class="c"> TokenSigningKey signingKey = new TokenSigningKey(</span><span class="c">&amp;lt;</span><span class="c">Customer provided signing key</span><span class="c">&amp;gt;</span><span class="c">, </span><span class="c">&amp;lt;</span><span class="c">Customer provided certificate</span><span class="c">&amp;gt;</span><span class="c">)</span>
        <span class="c">///</span><span class="c"> var policySetToken = new AttestationToken(</span>
        <span class="c">///</span><span class="c">     new StoredAttestationPolicy { AttestationPolicy = attestationPolicy },</span>
        <span class="c">///</span><span class="c">     signingKey);</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> using var shaHasher = SHA256Managed.Create();</span>
        <span class="c">///</span><span class="c"> var attestationPolicyHash = shaHasher.ComputeHash(Encoding.UTF8.GetBytes(policySetToken.ToString()));</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> Debug.Assert(attestationPolicyHash.SequenceEqual(setResult.Value.PolicyTokenHash));</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If the signing key and certificate are not provided, then the SetPolicyAsync API will create an unsecured attestation token</span>
        <span class="c">///</span><span class="c"> wrapping the attestation policy. To validate the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>.<a href="Models/PolicyResult.cs.html#bc6548b029ae3f38" class="i property">PolicyTokenHash</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> return value, a developer</span>
        <span class="c">///</span><span class="c"> can create their own </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationToken.cs.html#fe59844e2c351bcf" class="t t">AttestationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> and create the hash of that.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> using var shaHasher = SHA256Managed.Create();</span>
        <span class="c">///</span><span class="c"> var policySetToken = new AttestationToken(new StoredAttestationPolicy { AttestationPolicy = disallowDebugging });</span>
        <span class="c">///</span><span class="c"> disallowDebuggingHash = shaHasher.ComputeHash(Encoding.UTF8.GetBytes(policySetToken.ToString()));</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">code</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt;&gt; <a id="10e5c0645f1d5be6" href="R/10e5c0645f1d5be6.html" target="n" data-glyph="72,1" class="i method">SetPolicyAsync</a>(
            <a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a> <span id="r39 rd" class="r39 r">attestationType</span>,
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r40 rd" class="r40 r">policyToSet</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r41 rd" class="r41 r">signingKey</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r42 rd" class="r42 r">cancellationToken</span> = <b>default</b>)
        {
            <b>if</b> (<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@1@netstandard/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r40 r">policyToSet</span>))
            {
                <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#4b20cd3790b6426a" class="t constructor">ArgumentException</a>(<span class="s">$&quot;</span><span class="s">&#39;</span>{<b>nameof</b>(<span class="r40 r">policyToSet</span>)}<span class="s">&#39; cannot be null or empty.</span><span class="s">&quot;</span>, <b>nameof</b>(<span class="r40 r">policyToSet</span>));
            }
 
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r44 rd" class="r44 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">SetPolicy</span>)}<span class="s">&quot;</span>);
            <span class="r44 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="t t">AttestationToken</a> <span id="r45 rd" class="r45 r">tokenToSet</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(<b>new</b> <a href="Models/StoredAttestationPolicy.cs.html#84c6487c0cfffc1f" class="t constructor">StoredAttestationPolicy</a> { <a href="Models/StoredAttestationPolicy.cs.html#16a9ab04809aa9e7" class="i property">AttestationPolicy</a> = <span class="r40 r">policyToSet</span>, }, <span class="r41 r">signingKey</span>);
 
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r46 rd" class="r46 r">result</span> = <b>await</b> <a href="#64ce84d1dc2eb402" class="i field">_policyClient</a>.<a href="Generated/PolicyRestClient.cs.html#384bc140a4fbe87d" class="i method">SetAsync</a>(<span class="r39 r">attestationType</span>, <span class="r45 r">tokenToSet</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r42 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r47 rd" class="r47 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r46 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyResponse.cs.html#ddfa5aa877faea09" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <b>await</b> <span class="r47 r">token</span>.<a href="AttestationToken.cs.html#0bbeb118b6ac45fd" class="i method">ValidateTokenAsync</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <b>await</b> <a href="#f8946c75e65199eb" class="i method">GetSignersAsync</a>(<span class="r42 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>), <span class="r42 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt;(<span class="r46 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r47 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r48 rd" class="r48 r">ex</span>)
            {
                <span class="r44 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r48 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resets the policy for the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to the default value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r49 r">attestationType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> whose policy should be reset.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">signingKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, specifies the signing key and certificate used to sign the request to the attestation service.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r51 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r52 r t">PolicyResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r50 r">signingKey</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter is not provided, then the policy document sent to the</span>
        <span class="c">///</span><span class="c"> attestation service will be unsigned. Unsigned attestation policies are only allowed when the attestation instance is running in AAD mode - if the</span>
        <span class="c">///</span><span class="c"> attestation instance is running in Isolated mode, then a signing key and signing certificate MUST be provided to ensure that the caller of the API is authorized to change policy.</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a>.<a href="Models/TokenSigningKey.cs.html#36b9155cb8ec909f" class="i property">Certificate</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> fieldMUST be one of the certificates returned by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#6f55657bbf42b37e" class="i method">GetPolicyManagementCertificates</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> API.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span>
        <b>public virtual</b> <a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt; <a id="34e0dbce10124651" href="R/34e0dbce10124651.html" target="n" data-glyph="72,1" class="i method">ResetPolicy</a>(
            <a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a> <span id="r49 rd" class="r49 r">attestationType</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r50 rd" class="r50 r">signingKey</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r51 rd" class="r51 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r53 rd" class="r53 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">ResetPolicy</span>)}<span class="s">&quot;</span>);
            <span class="r53 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="t t">AttestationToken</a> <span id="r54 rd" class="r54 r">tokenToSet</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(<b>null</b>, <span class="r50 r">signingKey</span>);
 
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r55 rd" class="r55 r">result</span> = <a href="#64ce84d1dc2eb402" class="i field">_policyClient</a>.<a href="Generated/PolicyRestClient.cs.html#eba2176918e66baf" class="i method">Reset</a>(<span class="r49 r">attestationType</span>, <span class="r54 r">tokenToSet</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r51 r">cancellationToken</span>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r56 rd" class="r56 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r55 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyResponse.cs.html#ddfa5aa877faea09" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <span class="r56 r">token</span>.<a href="AttestationToken.cs.html#5fcd8ebb92f3fd97" class="i method">ValidateToken</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <a href="#a290fe8202b59af9" class="i method">GetSigners</a>(<span class="r51 r">cancellationToken</span>), <span class="r51 r">cancellationToken</span>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt;(<span class="r55 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r56 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r57 rd" class="r57 r">ex</span>)
            {
                <span class="r53 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r57 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Resets the policy for the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to the default value.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r58 r">attestationType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> whose policy should be reset.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">signingKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">If provided, specifies the signing key used to sign the request to the attestation service.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r60 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r61 r t">PolicyResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> If the </span><span class="c">&lt;</span><span class="c">paramref</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r59 r">signingKey</span><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter is not provided, then the policy document sent to the</span>
        <span class="c">///</span><span class="c"> attestation service will be unsigned. Unsigned attestation policies are only allowed when the attestation instance is running in AAD mode - if the</span>
        <span class="c">///</span><span class="c"> attestation instance is running in Isolated mode, then a signing key and signing certificate MUST be provided to ensure that the caller of the API is authorized to change policy.</span>
        <span class="c">///</span><span class="c"> The </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a>.<a href="Models/TokenSigningKey.cs.html#36b9155cb8ec909f" class="i property">Certificate</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> parameter MUST be one of the certificates returned by the </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="#6f55657bbf42b37e" class="i method">GetPolicyManagementCertificates</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>)<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> API.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">para</span><span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt;&gt; <a id="5113c6410a90f431" href="R/5113c6410a90f431.html" target="n" data-glyph="72,1" class="i method">ResetPolicyAsync</a>(
            <a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a> <span id="r58 rd" class="r58 r">attestationType</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r59 rd" class="r59 r">signingKey</span> = <b>default</b>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r60 rd" class="r60 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r62 rd" class="r62 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">ResetPolicy</span>)}<span class="s">&quot;</span>);
            <span class="r62 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="t t">AttestationToken</a> <span id="r63 rd" class="r63 r">tokenToSet</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(<b>null</b>, <span class="r59 r">signingKey</span>);
 
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r64 rd" class="r64 r">result</span> = <b>await</b> <a href="#64ce84d1dc2eb402" class="i field">_policyClient</a>.<a href="Generated/PolicyRestClient.cs.html#205aebb64439f050" class="i method">ResetAsync</a>(<span class="r58 r">attestationType</span>, <span class="r63 r">tokenToSet</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r60 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r65 rd" class="r65 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r64 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyResponse.cs.html#ddfa5aa877faea09" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <b>await</b> <span class="r65 r">token</span>.<a href="AttestationToken.cs.html#0bbeb118b6ac45fd" class="i method">ValidateTokenAsync</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <b>await</b> <a href="#f8946c75e65199eb" class="i method">GetSignersAsync</a>(<span class="r60 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>), <span class="r60 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/40fb353b280f924c.html#40fb353b280f924c" class="t t">PolicyResult</a>&gt;(<span class="r64 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r65 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r66 rd" class="r66 r">ex</span>)
            {
                <span class="r62 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r66 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the set of policy management certificates currently configured for the attestation service instance.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If the service instance is running in AAD mode, this list will always be empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r67 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A set of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> objects representing the set of root certificates for policy management.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/220dc6174baaeef0.html#220dc6174baaeef0" class="t t">PolicyCertificatesResult</a>&gt; <a id="6f55657bbf42b37e" href="R/6f55657bbf42b37e.html" target="n" data-glyph="72,1" class="i method">GetPolicyManagementCertificates</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r67 rd" class="r67 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r68 rd" class="r68 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">GetPolicyManagementCertificates</span>)}<span class="s">&quot;</span>);
            <span class="r68 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r69 rd" class="r69 r">result</span> = <a href="#64ada79922f7aa1f" class="i field">_policyManagementClient</a>.<a href="Generated/PolicyCertificatesRestClient.cs.html#20a8db31f72bac2b" class="i method">Get</a>(<span class="r67 r">cancellationToken</span>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r70 rd" class="r70 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r69 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyCertificatesResponse.cs.html#11d52e5b82e8596c" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <span class="r70 r">token</span>.<a href="AttestationToken.cs.html#5fcd8ebb92f3fd97" class="i method">ValidateToken</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <a href="#a290fe8202b59af9" class="i method">GetSigners</a>(<span class="r67 r">cancellationToken</span>), <span class="r67 r">cancellationToken</span>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/220dc6174baaeef0.html#220dc6174baaeef0" class="t t">PolicyCertificatesResult</a>&gt;(<span class="r69 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r70 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r71 rd" class="r71 r">ex</span>)
            {
                <span class="r68 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r71 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns the set of policy management certificates currently configured for the attestation service instance.</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> If the service instance is running in AAD mode, this list will always be empty.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r72 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel the operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A set of </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> objects representing the set of root certificates for policy management.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/220dc6174baaeef0.html#220dc6174baaeef0" class="t t">PolicyCertificatesResult</a>&gt;&gt; <a id="60a732e114d07df5" href="R/60a732e114d07df5.html" target="n" data-glyph="72,1" class="i method">GetPolicyManagementCertificatesAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r72 rd" class="r72 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r73 rd" class="r73 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">GetPolicyManagementCertificates</span>)}<span class="s">&quot;</span>);
            <span class="r73 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r74 rd" class="r74 r">result</span> = <b>await</b> <a href="#64ada79922f7aa1f" class="i field">_policyManagementClient</a>.<a href="Generated/PolicyCertificatesRestClient.cs.html#3cae677c7731fa86" class="i method">GetAsync</a>(<span class="r72 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r75 rd" class="r75 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r74 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyCertificatesResponse.cs.html#11d52e5b82e8596c" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <b>await</b> <span class="r75 r">token</span>.<a href="AttestationToken.cs.html#0bbeb118b6ac45fd" class="i method">ValidateTokenAsync</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <b>await</b> <a href="#f8946c75e65199eb" class="i method">GetSignersAsync</a>(<span class="r72 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>), <span class="r72 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/220dc6174baaeef0.html#220dc6174baaeef0" class="t t">PolicyCertificatesResult</a>&gt;(<span class="r74 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r75 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r76 rd" class="r76 r">ex</span>)
            {
                <span class="r73 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r76 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds the specified new signing certificate to the set of policy management certificates.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r77 r">newSigningCertificate</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new certificate to add.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r78 r">existingSigningKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An existing key corresponding to the existing certificate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r79 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r80 r t">PolicyCertificatesModificationResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt; <a id="67a231566461c8e4" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddPolicyManagementCertificate</a>(
            <a href="@1@netstandard/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r77 rd" class="r77 r">newSigningCertificate</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r78 rd" class="r78 r">existingSigningKey</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r79 rd" class="r79 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r78 r">existingSigningKey</span>, <b>nameof</b>(<span class="r78 r">existingSigningKey</span>));
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r77 r">newSigningCertificate</span>, <b>nameof</b>(<span class="r77 r">newSigningCertificate</span>));
 
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r81 rd" class="r81 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">AddPolicyManagementCertificate</span>)}<span class="s">&quot;</span>);
            <span class="r81 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r82 rd" class="r82 r">tokenToAdd</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(
                        <b>new</b> <a href="Models/PolicyCertificateModification.cs.html#b821bd04120f2fd2" class="t constructor">PolicyCertificateModification</a>(<span class="r77 r">newSigningCertificate</span>),
                        <span class="r78 r">existingSigningKey</span>);
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r83 rd" class="r83 r">result</span> = <a href="#64ada79922f7aa1f" class="i field">_policyManagementClient</a>.<a href="Generated/PolicyCertificatesRestClient.cs.html#1f3a857852a2b04c" class="i method">Add</a>(<span class="r82 r">tokenToAdd</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r79 r">cancellationToken</span>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r84 rd" class="r84 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r83 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyCertificatesModifyResponse.cs.html#972a5d0e6cd16bd6" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <span class="r84 r">token</span>.<a href="AttestationToken.cs.html#5fcd8ebb92f3fd97" class="i method">ValidateToken</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <a href="#a290fe8202b59af9" class="i method">GetSigners</a>(<span class="r79 r">cancellationToken</span>), <span class="r79 r">cancellationToken</span>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt;(<span class="r83 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r84 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r85 rd" class="r85 r">ex</span>)
            {
                <span class="r81 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r85 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds the specified new signing certificate to the set of policy management certificates.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r86 r">newSigningCertificate</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The new certificate to add.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r87 r">existingSigningKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An existing key corresponding to the existing certificate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r88 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r89 r t">PolicyCertificatesModificationResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt;&gt; <a id="85b85c3497328f76" href="R/85b85c3497328f76.html" target="n" data-glyph="72,1" class="i method">AddPolicyManagementCertificateAsync</a>(
            <a href="@1@netstandard/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r86 rd" class="r86 r">newSigningCertificate</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r87 rd" class="r87 r">existingSigningKey</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r88 rd" class="r88 r">cancellationToken</span> = <b>default</b>)
        {
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r87 r">existingSigningKey</span>, <b>nameof</b>(<span class="r87 r">existingSigningKey</span>));
            <a href="Shared/Argument.cs.html#0198b1312554d2ed" class="t t">Argument</a>.<a href="Shared/Argument.cs.html#208d023d6fa23d33" class="i method">AssertNotNull</a>(<span class="r86 r">newSigningCertificate</span>, <b>nameof</b>(<span class="r86 r">newSigningCertificate</span>));
 
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r90 rd" class="r90 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">AddPolicyManagementCertificate</span>)}<span class="s">&quot;</span>);
            <span class="r90 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r91 rd" class="r91 r">tokenToAdd</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(
                        <b>new</b> <a href="Models/PolicyCertificateModification.cs.html#b821bd04120f2fd2" class="t constructor">PolicyCertificateModification</a>(<span class="r86 r">newSigningCertificate</span>),
                        <span class="r87 r">existingSigningKey</span>);
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r92 rd" class="r92 r">result</span> = <b>await</b> <a href="#64ada79922f7aa1f" class="i field">_policyManagementClient</a>.<a href="Generated/PolicyCertificatesRestClient.cs.html#d6ec21ce73fe2913" class="i method">AddAsync</a>(<span class="r91 r">tokenToAdd</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r88 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r93 rd" class="r93 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r92 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyCertificatesModifyResponse.cs.html#972a5d0e6cd16bd6" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <b>await</b> <span class="r93 r">token</span>.<a href="AttestationToken.cs.html#0bbeb118b6ac45fd" class="i method">ValidateTokenAsync</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <b>await</b> <a href="#f8946c75e65199eb" class="i method">GetSignersAsync</a>(<span class="r88 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>), <span class="r88 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt;(<span class="r92 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r93 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r94 rd" class="r94 r">ex</span>)
            {
                <span class="r90 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r94 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Retrieves the attesttion policy for the specified </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="P/a754d9f3213c01b0.html#a754d9f3213c01b0" class="t t">AttestationType</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c">.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r95 r">certificateToRemove</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The certificate to remove.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r96 r">existingSigningKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An existing key corresponding to the existing certificate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r97 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r98 r t">PolicyCertificatesModificationResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual</b> <a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt; <a id="2f7c09aad8565200" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">RemovePolicyManagementCertificate</a>(
            <a href="@1@netstandard/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r95 rd" class="r95 r">certificateToRemove</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r96 rd" class="r96 r">existingSigningKey</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r97 rd" class="r97 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r99 rd" class="r99 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">RemovePolicyManagementCertificate</span>)}<span class="s">&quot;</span>);
            <span class="r99 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r100 rd" class="r100 r">tokenToRemove</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(
                        <b>new</b> <a href="Models/PolicyCertificateModification.cs.html#b821bd04120f2fd2" class="t constructor">PolicyCertificateModification</a>(<span class="r95 r">certificateToRemove</span>),
                        <span class="r96 r">existingSigningKey</span>);
 
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r101 rd" class="r101 r">result</span> = <a href="#64ada79922f7aa1f" class="i field">_policyManagementClient</a>.<a href="Generated/PolicyCertificatesRestClient.cs.html#a7152d6b01476665" class="i method">Remove</a>(<span class="r100 r">tokenToRemove</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r97 r">cancellationToken</span>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r102 rd" class="r102 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r101 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyCertificatesModifyResponse.cs.html#972a5d0e6cd16bd6" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <span class="r102 r">token</span>.<a href="AttestationToken.cs.html#5fcd8ebb92f3fd97" class="i method">ValidateToken</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <a href="#a290fe8202b59af9" class="i method">GetSigners</a>(<span class="r97 r">cancellationToken</span>), <span class="r97 r">cancellationToken</span>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt;(<span class="r101 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r102 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r103 rd" class="r103 r">ex</span>)
            {
                <span class="r99 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r103 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes one of the attestation policy management certificates.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r104 r">certificateToRemove</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The certificate to remove.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r105 r">existingSigningKey</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An existing key corresponding to the existing certificate.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r106 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Cancellation token used to cancel this operation.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>{<span class="r107 r t">PolicyCertificatesModificationResult</span>}<span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> with the policy for the specified attestation type.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public virtual async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="AttestationResponse.cs.html#fcdef98218d64497" class="t t">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt;&gt; <a id="fecf6439a14f34ba" href="R/fecf6439a14f34ba.html" target="n" data-glyph="72,1" class="i method">RemovePolicyManagementCertificateAsync</a>(
            <a href="@1@netstandard/A.html#2e8ad9e6007798e5" class="t t">X509Certificate2</a> <span id="r104 rd" class="r104 r">certificateToRemove</span>,
            <a href="Models/TokenSigningKey.cs.html#3484077e80836623" class="t t">TokenSigningKey</a> <span id="r105 rd" class="r105 r">existingSigningKey</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r106 rd" class="r106 r">cancellationToken</span> = <b>default</b>)
        {
            <b>using</b> <a href="Shared/DiagnosticScope.cs.html#df3fc9a09421f052" class="t t">DiagnosticScope</a> <span id="r108 rd" class="r108 r">scope</span> = <a href="#faab5a77f8b71b43" class="i field">_clientDiagnostics</a>.<a href="Shared/DiagnosticScopeFactory.cs.html#74f1bd8b1f1143c8" class="i method">CreateScope</a>(<span class="s">$&quot;</span>{<b>nameof</b>(<a href="#a99baaa4028ac1c6" class="t t">AttestationAdministrationClient</a>)}<span class="s">.</span>{<b>nameof</b>(<span class="i">RemovePolicyManagementCertificate</span>)}<span class="s">&quot;</span>);
            <span class="r108 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#687cad18b595ff81" class="i method">Start</a>();
            <b>try</b>
            {
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r109 rd" class="r109 r">tokenToRemove</span> = <b>new</b> <a href="AttestationToken.cs.html#0d3fd014249847d0" class="t constructor">AttestationToken</a>(
                        <b>new</b> <a href="Models/PolicyCertificateModification.cs.html#b821bd04120f2fd2" class="t constructor">PolicyCertificateModification</a>(<span class="r104 r">certificateToRemove</span>),
                        <span class="r105 r">existingSigningKey</span>);
 
                <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r110 rd" class="r110 r">result</span> = <b>await</b> <a href="#64ada79922f7aa1f" class="i field">_policyManagementClient</a>.<a href="Generated/PolicyCertificatesRestClient.cs.html#78b1ee33e34f6852" class="i method">RemoveAsync</a>(<span class="r109 r">tokenToRemove</span>.<a href="AttestationToken.cs.html#60b26ef333128ae4" class="i method">ToString</a>(), <span class="r106 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="AttestationToken.cs.html#fe59844e2c351bcf" class="k">var</a> <span id="r111 rd" class="r111 r">token</span> = <b>new</b> <a href="AttestationToken.cs.html#23e0c37f55381f64" class="t constructor">AttestationToken</a>(<span class="r110 r">result</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="Generated/Models/PolicyCertificatesModifyResponse.cs.html#972a5d0e6cd16bd6" class="i property">Token</a>);
                <b>if</b> (<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>.<a href="TokenValidationOptions.cs.html#89ec825218d54501" class="i property">ValidateToken</a>)
                {
                    <b>await</b> <span class="r111 r">token</span>.<a href="AttestationToken.cs.html#0bbeb118b6ac45fd" class="i method">ValidateTokenAsync</a>(<a href="#02b28a5ff521fa66" class="i field">_options</a>.<a href="AttestationClientOptions.cs.html#43c32bb36826ad1b" class="i property">TokenOptions</a>, <b>await</b> <a href="#f8946c75e65199eb" class="i method">GetSignersAsync</a>(<span class="r106 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>), <span class="r106 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>return</b> <b>new</b> <a href="AttestationResponse.cs.html#8232f270543a580c" class="t constructor">AttestationResponse</a>&lt;<a href="P/9d1716104cb27be1.html#9d1716104cb27be1" class="t t">PolicyCertificatesModificationResult</a>&gt;(<span class="r110 r">result</span>.<a href="/Azure.Core/A.html#959994a72d6ef38a" class="i method">GetRawResponse</a>(), <span class="r111 r">token</span>);
            }
            <b>catch</b> (<a href="@1@netstandard/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r112 rd" class="r112 r">ex</span>)
            {
                <span class="r108 r">scope</span>.<a href="Shared/DiagnosticScope.cs.html#3d6de3437ae4c961" class="i method">Failed</a>(<span class="r112 r">ex</span>);
                <b>throw</b>;
            }
        }
 
        <b>private async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="Models/AttestationSigner.cs.html#52699b74934bdfd6" class="t t">AttestationSigner</a>&gt;&gt; <a id="f8946c75e65199eb" href="R/f8946c75e65199eb.html" target="n" data-glyph="76,1" class="i method">GetSignersAsync</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r113 rd" class="r113 r">cancellationToken</span>)
        {
            <b>await</b> <a href="#2c83ea81477d44d5" class="i field">_statelock</a>.<a href="@1@netstandard/A.html#7a679e542c73988f" class="i method">WaitAsync</a>(<span class="r113 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            <b>try</b>
            {
                <b>if</b> (<a href="#3433c55686c690eb" class="i field">_signers</a> == <b>null</b>)
                {
                    <a href="#3433c55686c690eb" class="i field">_signers</a> = (<b>await</b> <a href="#28ac14a2f1d08905" class="i field">_attestationClient</a>.<a href="AttestationClient.cs.html#2c2daf7a67d90414" class="i method">GetSigningCertificatesAsync</a>(<span class="r113 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>)).<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>;
                }
 
                <b>return</b> <a href="#3433c55686c690eb" class="i field">_signers</a>;
            }
            <b>finally</b>
            {
                <a href="#2c83ea81477d44d5" class="i field">_statelock</a>.<a href="@1@netstandard/A.html#f7527810bcfc0842" class="i method">Release</a>();
            }
        }
 
        <b>private</b> <a href="@1@netstandard/A.html#b040fb780bdd59f4" class="t t">IReadOnlyList</a>&lt;<a href="Models/AttestationSigner.cs.html#52699b74934bdfd6" class="t t">AttestationSigner</a>&gt; <a id="a290fe8202b59af9" href="R/a290fe8202b59af9.html" target="n" data-glyph="76,1" class="i method">GetSigners</a>(<a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r114 rd" class="r114 r">cancellationToken</span>)
        {
            <a href="#2c83ea81477d44d5" class="i field">_statelock</a>.<a href="@1@netstandard/A.html#03b17b43bf2a7131" class="i method">Wait</a>(<span class="r114 r">cancellationToken</span>);
            <b>try</b>
            {
                <b>if</b> (<a href="#3433c55686c690eb" class="i field">_signers</a> == <b>null</b>)
                {
                    <a href="#3433c55686c690eb" class="i field">_signers</a> = <a href="#28ac14a2f1d08905" class="i field">_attestationClient</a>.<a href="AttestationClient.cs.html#ba2389cd480254c0" class="i method">GetSigningCertificates</a>(<span class="r114 r">cancellationToken</span>).<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>;
                }
 
                <b>return</b> <a href="#3433c55686c690eb" class="i field">_signers</a>;
            }
            <b>finally</b>
            {
                <a href="#2c83ea81477d44d5" class="i field">_statelock</a>.<a href="@1@netstandard/A.html#f7527810bcfc0842" class="i method">Release</a>();
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Dispose this object.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r115 r">disposing</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">True if the caller wants us to dispose our underlying objects.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>protected virtual void</b> <a id="60ae5049d1c29c66" href="R/60ae5049d1c29c66.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r115 rd" class="r115 r">disposing</span>)
        {
            <b>if</b> (!<a href="#efccdb9765f04c21" class="i field">_disposedValue</a>)
            {
                <b>if</b> (<span class="r115 r">disposing</span>)
                {
                    <span class="c">// Dispose managed state (managed objects)</span>
                    <a href="#2c83ea81477d44d5" class="i field">_statelock</a>.<a href="@1@netstandard/A.html#c4ae555dae3752b1" class="i method">Dispose</a>();
                    <a href="#28ac14a2f1d08905" class="i field">_attestationClient</a>.<a href="AttestationClient.cs.html#52aa5e683558baa2" class="i method">Dispose</a>();
                }
 
                <a href="#efccdb9765f04c21" class="i field">_disposedValue</a> = <b>true</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">inheritdoc</span><span class="c">/&gt;</span>
        <b>public void</b> <a id="03371d313b7ed651" href="R/03371d313b7ed651.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <span class="c">// Do not change this code. Put cleanup code in &#39;Dispose(bool disposing)&#39; method</span>
            <a href="#60ae5049d1c29c66" class="i method">Dispose</a>(<span class="r115 r">disposing</span>: <b>true</b>);
            <a href="@1@netstandard/A.html#25d9c1e022317a99" class="t t">GC</a>.<a href="@1@netstandard/A.html#2673f5220a565bf2" class="i method">SuppressFinalize</a>(<a href="#a99baaa4028ac1c6" class="k">this</a>);
        }
    }
}
</pre></td></tr></table></div></body></html>
