<!DOCTYPE html>
<html><head><title>JobPrepReleaseIntegrationTests.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(857);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Batch.Integration.Tests/JobPrepReleaseIntegrationTests.cs" target="_top">JobPrepReleaseIntegrationTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master//sdk/batch/Microsoft.Azure.Batch/tests/IntegrationTests/JobPrepReleaseIntegrationTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Batch.Integration.Tests" target="_top">Microsoft.Azure.Batch.Integration.Tests.csproj</a> (Microsoft.Azure.Batch.Integration.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>namespace</b> <span class="i n">BatchClientIntegrationTests</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
    <b>using</b> <span class="i n">BatchTestCommon</span>;
    <b>using</b> <span class="i n">Fixtures</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Batch</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Batch</span>.<span class="i n">Common</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Batch</span>.<span class="i n">FileStaging</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Batch</span>.<span class="i n">Integration</span>.<span class="i n">Tests</span>.<span class="i n">Infrastructure</span>;
    <b>using</b> <span class="i n">TestResources</span>;
    <b>using</b> <span class="i n">IntegrationTestUtilities</span>;
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">Azure</span>;
    <b>using</b> <span class="i n">Xunit</span>.<span class="i n">Abstractions</span>;
    <b>using</b> <span class="i n">Xunit</span>;
    <b>using</b> <span class="t">Constants</span> = <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Batch</span>.<a href="/Microsoft.Azure.Batch/A.html#9295672bd7b4088f" class="t t">Constants</a>;
    <b>using</b> <span class="i">Protocol</span> = <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Batch</span>.<span class="i n">Protocol</span>;
 
    [<span class="t constructor">Collection</span>(<span class="s">&quot;SharedPoolCollection&quot;</span>)]
    <b>public class</b> <a id="6de475f86049c68a" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t">JobPrepReleaseIntegrationTests</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Test Constants
 
        <b>private const string</b> <a id="9af4175a258edcae" href="R/9af4175a258edcae.html" target="n" data-glyph="10,1" class="i field">JobPrepCommandLine</a> = <span class="s">@&quot;cmd /c dir /s .. &amp; echo JobPreparation Task!! &amp; dir &amp; type localwords.txt&quot;</span>;
        <b>private static readonly</b> <a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a> <a id="f6db495c90ac19f9" href="R/f6db495c90ac19f9.html" target="n" data-glyph="46,1" class="i field">JobPrepEnvSettingOM</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#6024c14f4a82642c" class="t constructor">EnvironmentSetting</a>(<span class="r0 r">name</span>: <span class="s">&quot;JobPrepEnvSetting00&quot;</span>, <span class="r1 r">value</span>: <span class="s">&quot;JobPrepEnvSetting00Value&quot;</span>);
        <b>private const string</b> <a id="f0194430aab00964" href="R/f0194430aab00964.html" target="n" data-glyph="10,1" class="i field">JobPrepId</a> = <span class="s">&quot;AddJobPrepOM&quot;</span>;
        <b>private const bool</b> <a id="61b5489fa0578281" href="R/61b5489fa0578281.html" target="n" data-glyph="10,1" class="i field">JobPrepRerunOnComputeNodeRebootAfterSuccess</a> = <b>true</b>;
        <b>private static readonly</b> <a href="/Microsoft.Azure.Batch/A.html#8a16546147bc4033" class="t t">AutoUserSpecification</a> <a id="2453a83381c4c02b" href="R/2453a83381c4c02b.html" target="n" data-glyph="46,1" class="i field">JobPrepUserSpec</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#5ef3a195e1f58040" class="t constructor">AutoUserSpecification</a>(<span class="r2 r">scope</span>:<a href="/Microsoft.Azure.Batch/A.html#2c8a73dd65f3010c" class="t t">AutoUserScope</a>.<a href="/Microsoft.Azure.Batch/A.html#828a5f3058edff85" class="i field">Task</a>, <span class="r3 r">elevationLevel</span>: <a href="/Microsoft.Azure.Batch/A.html#2ec9b8fd9e4e5f24" class="t t">ElevationLevel</a>.<a href="/Microsoft.Azure.Batch/A.html#adcbf6050cda5520" class="i field">Admin</a>);
        <b>private static readonly</b> <a href="/Microsoft.Azure.Batch/A.html#bca321c33cb9d469" class="t t">TaskConstraints</a> <a id="ad93bce9671b17c0" href="R/ad93bce9671b17c0.html" target="n" data-glyph="46,1" class="i field">JobPrepTaskConstraintsOM</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#8c9d79e0ce7cf04f" class="t constructor">TaskConstraints</a>(<span class="r4 r">maxTaskRetryCount</span>: 4, <span class="r5 r">maxWallClockTime</span>: <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#060fe8cc38e0a7e3" class="i method">FromHours</a>(1.0), <span class="r6 r">retentionTime</span>: <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#060fe8cc38e0a7e3" class="i method">FromHours</a>(2.0));
        <b>private const bool</b> <a id="09bb59746212bf7e" href="R/09bb59746212bf7e.html" target="n" data-glyph="10,1" class="i field">JobPrepWaitForSuccessCreate</a> = <b>false</b>;  <span class="c">// true is the default so try false even though its crazy</span>
        <b>private const bool</b> <a id="1e61ea2922471540" href="R/1e61ea2922471540.html" target="n" data-glyph="10,1" class="i field">JobPrepWaitForSuccessUpdate</a> = <b>false</b>;  <span class="c">// we need WfS so we can test the exeinfo.state</span>
        <b>private const string</b> <a id="daa1e81a82033149" href="R/daa1e81a82033149.html" target="n" data-glyph="10,1" class="i field">JobReleaseTaskCommandLine</a> = <span class="s">@&quot;cmd /c dir /s .. &amp; echo JobRelease Task!! &amp; dir &amp; type localwords.txt&quot;</span>;
        <b>private static readonly</b> <a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a> <a id="0215ad27faf35144" href="R/0215ad27faf35144.html" target="n" data-glyph="46,1" class="i field">JobRelEnvSettingOM</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#6024c14f4a82642c" class="t constructor">EnvironmentSetting</a>(<span class="r0 r">name</span>: <span class="s">&quot;JobReleaseEnvSetting00Name&quot;</span>, <span class="r1 r">value</span>: <span class="s">&quot;JobReleaseEnvSetting00Value&quot;</span>);
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="cdc90c6364d13d29" href="R/cdc90c6364d13d29.html" target="n" data-glyph="46,1" class="i field">JobRelMaxWallClockTime</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(5.0);
        <b>private const string</b> <a id="443d29a65e2af4bb" href="R/443d29a65e2af4bb.html" target="n" data-glyph="10,1" class="i field">JobRelId</a> = <span class="s">&quot;AddJobReleaseOM&quot;</span>;
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="96c69b7ef09e375a" href="R/96c69b7ef09e375a.html" target="n" data-glyph="46,1" class="i field">JobRelRetentionTime</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(10.0);
        <b>private static readonly</b> <a href="/Microsoft.Azure.Batch/A.html#8a16546147bc4033" class="t t">AutoUserSpecification</a> <a id="e55ec22b5297e510" href="R/e55ec22b5297e510.html" target="n" data-glyph="46,1" class="i field">JobRelUserSpec</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#5ef3a195e1f58040" class="t constructor">AutoUserSpecification</a>(<span class="r2 r">scope</span>: <a href="/Microsoft.Azure.Batch/A.html#2c8a73dd65f3010c" class="t t">AutoUserScope</a>.<a href="/Microsoft.Azure.Batch/A.html#828a5f3058edff85" class="i field">Task</a>, <span class="r3 r">elevationLevel</span>: <a href="/Microsoft.Azure.Batch/A.html#2ec9b8fd9e4e5f24" class="t t">ElevationLevel</a>.<a href="/Microsoft.Azure.Batch/A.html#adcbf6050cda5520" class="i field">Admin</a>);
        <b>private static readonly</b> <a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a> <a id="7fe73a8e71ec5eb5" href="R/7fe73a8e71ec5eb5.html" target="n" data-glyph="46,1" class="i field">JobCommonEnvSettingOM</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#6024c14f4a82642c" class="t constructor">EnvironmentSetting</a>(<span class="r0 r">name</span>: <span class="s">&quot;JobCommenEnv00Name&quot;</span>, <span class="r1 r">value</span>: <span class="s">&quot;JobCommonEnv00Value&quot;</span>);
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="38b9c2b9d380d4e2" href="R/38b9c2b9d380d4e2.html" target="n" data-glyph="46,1" class="i field">TestTimeout</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(2);
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <a id="7803b3661b329e4a" href="R/7803b3661b329e4a.html" target="n" data-glyph="46,1" class="i field">LongTestTimeout</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(10);
        <b>private readonly</b> <span class="t t">ITestOutputHelper</span> <a id="64e7188906e7341e" href="R/64e7188906e7341e.html" target="n" data-glyph="46,1" class="i field">testOutputHelper</a>;
        <b>private readonly</b> <a href="Fixtures/PoolFixture.cs.html#adc4366cd44e6b53" class="t t">PoolFixture</a> <a id="0e3bafbf351ec53c" href="R/0e3bafbf351ec53c.html" target="n" data-glyph="46,1" class="i field">poolFixture</a>;
 
        <b>public</b> <a id="98459a44d2a19c45" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">JobPrepReleaseIntegrationTests</a>(<span class="t t">ITestOutputHelper</span> <span id="r7 rd" class="r7 r">testOutputHelper</span>, <a href="Fixtures/PaasWindowsPoolFixture.cs.html#048ac1aafc5883da" class="t t">PaasWindowsPoolFixture</a> <span id="r8 rd" class="r8 r">poolFixture</span>)
        {
            <a href="#6de475f86049c68a" class="k">this</a>.<a href="#64e7188906e7341e" class="i field">testOutputHelper</a> = <span class="r7 r">testOutputHelper</span>;
            <a href="#6de475f86049c68a" class="k">this</a>.<a href="#0e3bafbf351ec53c" class="i field">poolFixture</a> = <span class="r8 r">poolFixture</span>;
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="Infrastructure/LiveTestAttribute.cs.html#a1847f7966bb21d7" class="t constructor">LiveTest</a>]
        [<span class="t constructor">Trait</span>(<a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#9c1513f600f7ef29" class="i field">TraitName</a>, <a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#3192e26026a08a2c" class="t t">Values</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#1ede27a5c32e7e21" class="i field">MediumDuration</a>)]
        <b>public void</b> <a id="2e415448b122d9e5" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestOMJobSpecAndRelease</a>()
        {
            <b>void</b> <a id="7e374ba360687970" href="R/7e374ba360687970.html" target="n" data-glyph="76,2" class="i method">test</a>()
            {
                <a href="IntegrationTestUtilities/FileUploadUtilities.cs.html#3b9275d3afe2c09e" class="t t">StagingStorageAccount</a> <span id="r9 rd" class="r9 r">stagingCreds</span> = <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#2f9dcbe8d3162db7" class="i method">GetStorageCredentialsFromEnvironment</a>();
                <b>using</b> <a href="/Microsoft.Azure.Batch/A.html#a93c5701bdd04ea3" class="t t">BatchClient</a> <span id="r10 rd" class="r10 r">client</span> = <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#70323b9a3f92692c" class="i method">OpenBatchClient</a>(<a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#554e2d8347b023b3" class="i method">GetCredentialsFromEnvironment</a>());
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">jsId</span> = <span class="s">&quot;JobPrepAndRelease-&quot;</span> + <span class="c">/* &quot;OM-static-c&quot; */</span> <span class="s">&quot;dynamic-&quot;</span> + <a href="#1a56c240ec2b259d" class="i method">CraftTimeString</a>() + <span class="s">&quot;-&quot;</span> + <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#71e76a83fc8dd577" class="i method">GetMyName</a>();
 
                <b>try</b>
                {
                    <span class="c">// increase request timeout interceptor</span>
                    <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#0a5fcca20b641bf0" class="t t">RequestInterceptor</a> <span id="r12 rd" class="r12 r">increaseTimeoutInterceptor</span> =
                        <b>new</b> <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#20b6019ccd20581f" class="t constructor">RequestInterceptor</a>((<span id="r13 rd" class="r13 r">x</span>) =&gt;
                        {
                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;TestOMJobSpecAndRelease: setting request timeout.  Request type: &quot;</span> + <span class="r13 r">x</span>.<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>().<a href="@0@mscorlib/A.html#3b264aebc8d4c084" class="i method">ToString</a>() + <span class="s">&quot;, ClientRequestID: &quot;</span> + <span class="r13 r">x</span>.<a href="/Microsoft.Azure.Batch/A.html#7d4e0947fd57ad7a" class="i property">Options</a>.<a href="/Microsoft.Azure.Batch/A.html#96c72a4173baba53" class="i property">ClientRequestId</a>);
                            <a href="/Microsoft.Azure.Batch/A.html#14768c154c95f4f2" class="k">var</a> <span id="r14 rd" class="r14 r">timeoutOptions</span> = <span class="r13 r">x</span>.<a href="/Microsoft.Azure.Batch/A.html#7d4e0947fd57ad7a" class="i property">Options</a> <b>as</b> <span class="i n">Protocol</span>.<span class="i n">Models</span>.<a href="/Microsoft.Azure.Batch/A.html#14768c154c95f4f2" class="t t">ITimeoutOptions</a>;
                            <span class="r14 r">timeoutOptions</span>.<a href="/Microsoft.Azure.Batch/A.html#c9e16ed9131fd757" class="i property">Timeout</a> = 5 * 60;
                        });
 
                    <span class="c">// lets use a timer too</span>
                    <a href="#9d8d2a070d7f773f" class="t t">CallTimerViaInterceptors</a> <span id="r15 rd" class="r15 r">timerInterceptor</span> = <b>new</b> <a href="#2c5e55306954536c" class="t constructor">CallTimerViaInterceptors</a>();
 
                    <span class="c">// seeing client side timeouts... so increase the durations on every call</span>
                    <span class="r10 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#53317aeec21c3477" class="i property">CustomBehaviors</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<span class="r12 r">increaseTimeoutInterceptor</span>);
                    <span class="c">// add a call timer spammer/logger</span>
                    <span class="r10 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#53317aeec21c3477" class="i property">CustomBehaviors</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<span class="r15 r">timerInterceptor</span>.<a href="#445bced83fb57e60" class="i field">ReqInterceptor</a>);
 
                    <span class="c">// get some resource files to play with</span>
                    <a href="@0@mscorlib/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt; <span id="r16 rd" class="r16 r">resFiles</span> = <a href="#456dfeeaf6d8ae1b" class="i method">UploadFilesMakeResFiles</a>(<span class="r9 r">stagingCreds</span>);
 
                    <span class="c">// create job schedule with prep/release</span>
                    {
                        <a href="/Microsoft.Azure.Batch/A.html#4b760c6b2e3f73cc" class="t t">CloudJobSchedule</a> <span id="r17 rd" class="r17 r">unboundJobSchedule</span> = <span class="r10 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#58e4181ca7752f7b" class="i property">JobScheduleOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#52c7805e45b8f1ad" class="i method">CreateJobSchedule</a>(<span class="r11 r">jsId</span>, <b>null</b>, <b>null</b>);
                        <span class="r17 r">unboundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#eba5a49776afbfd4" class="t constructor">JobSpecification</a>(<b>new</b> <a href="/Microsoft.Azure.Batch/A.html#f201a869350242a6" class="t constructor">PoolInformation</a>());
                        <span class="r17 r">unboundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#eabe433f211f732a" class="i property">PoolInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#269cf0d6e56e7e5e" class="i property">PoolId</a> = <a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a>;
                        <span class="r17 r">unboundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#e3b8223f17800015" class="i property">Schedule</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#7b650a4f530f6872" class="t constructor">Schedule</a>() { <a href="/Microsoft.Azure.Batch/A.html#306c8a6d070235fc" class="i property">RecurrenceInterval</a> = <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(3) };
 
                        <span class="c">// add the jobPrep task to the job schedule</span>
                        {
                            <a href="/Microsoft.Azure.Batch/A.html#0deb1ca70552b381" class="t t">JobPreparationTask</a> <span id="r18 rd" class="r18 r">prep</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#c7d6223ea012387e" class="t constructor">JobPreparationTask</a>(<a href="#9af4175a258edcae" class="i field">JobPrepCommandLine</a>);
                            <span class="r17 r">unboundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a> = <span class="r18 r">prep</span>;
 
                            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt; <span id="r19 rd" class="r19 r">prepEnvSettings</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt;
                            {
                                <a href="#f6db495c90ac19f9" class="i field">JobPrepEnvSettingOM</a>
                            };
                            <span class="r18 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#38e94e7b3178dbda" class="i property">EnvironmentSettings</a> = <span class="r19 r">prepEnvSettings</span>;
 
                            <span class="r18 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#e0bb2629373d681d" class="i property">Id</a> = <a href="#f0194430aab00964" class="i field">JobPrepId</a>;
                            <span class="r18 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#2ea0c28dcd7c1744" class="i property">RerunOnComputeNodeRebootAfterSuccess</a> = <a href="#61b5489fa0578281" class="i field">JobPrepRerunOnComputeNodeRebootAfterSuccess</a>;
 
                            <span class="r18 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#eb0cfec25e77433c" class="i property">ResourceFiles</a> = <span class="r16 r">resFiles</span>; <span class="c">// bug: incorrect type this should be IList&lt;&gt;</span>
 
                            <span class="c">/*
                                prep.ResourceFiles = new List&lt;ResourceFile&gt;();  // this is actually read into our concurrent iList thing
 
                                // why not, merge them in.  exersize the concurent  IList thing
                                foreach (ResourceFile curRF in resFiles)
                                {
                                    prep.ResourceFiles.Add(curRF);
                                }
                                */</span>
 
                            <span class="r18 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#a768bba277cc40aa" class="i property">UserIdentity</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#46da7b82e9935470" class="t constructor">UserIdentity</a>(<a href="#2453a83381c4c02b" class="i field">JobPrepUserSpec</a>);
                            <span class="r18 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#aaec841c7d671b82" class="i property">Constraints</a> = <a href="#ad93bce9671b17c0" class="i field">JobPrepTaskConstraintsOM</a>;
                            <span class="r18 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#1fb31b6894240464" class="i property">WaitForSuccess</a> = <a href="#09bb59746212bf7e" class="i field">JobPrepWaitForSuccessCreate</a>;
                        }
 
                        <span class="c">// add a jobRelease task to the job schedule</span>
                        {
                            <a href="/Microsoft.Azure.Batch/A.html#6e57e67ad07386ca" class="t t">JobReleaseTask</a> <span id="r20 rd" class="r20 r">relTask</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#d88bdd204eb0394c" class="t constructor">JobReleaseTask</a>(<a href="#daa1e81a82033149" class="i field">JobReleaseTaskCommandLine</a>);
                            <span class="r17 r">unboundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#f3de6c2a0d369b17" class="i property">JobReleaseTask</a> = <span class="r20 r">relTask</span>;
 
                            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt; <span id="r21 rd" class="r21 r">relEnvSettings</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt;
                            {
                                <a href="#0215ad27faf35144" class="i field">JobRelEnvSettingOM</a>
                            };
                            <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#785dd2cd03686039" class="i property">EnvironmentSettings</a> = <span class="r21 r">relEnvSettings</span>;
 
                            <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#e87f942e34561e41" class="i property">MaxWallClockTime</a> = <a href="#cdc90c6364d13d29" class="i field">JobRelMaxWallClockTime</a>;
 
                            <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#a210275440fefd8f" class="i property">Id</a> = <a href="#443d29a65e2af4bb" class="i field">JobRelId</a>;
 
                            <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#ba3980d002eba422" class="i property">ResourceFiles</a> = <b>null</b>;
 
                            <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#ba3980d002eba422" class="i property">ResourceFiles</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt;();
 
                            <span class="c">// why not, merge them in.  work the concurrent  IList thing</span>
                            <b>foreach</b> (<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a> <span id="r22 rd" class="r22 r">curRF</span> <b>in</b> <span class="r16 r">resFiles</span>)
                            {
                                <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#ba3980d002eba422" class="i property">ResourceFiles</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<span class="r22 r">curRF</span>);
                            }
 
                            <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#bb8678dd687aeffb" class="i property">RetentionTime</a> = <a href="#96c69b7ef09e375a" class="i field">JobRelRetentionTime</a>;
                            <span class="r20 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#43ddebf622181cdd" class="i property">UserIdentity</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#46da7b82e9935470" class="t constructor">UserIdentity</a>(<a href="#e55ec22b5297e510" class="i field">JobRelUserSpec</a>);
                        }
 
                        <span class="c">// set JobCommonEnvSettings</span>
                        {
                            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt; <span id="r23 rd" class="r23 r">jobCommonES</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt;
                            {
                                <a href="#7fe73a8e71ec5eb5" class="i field">JobCommonEnvSettingOM</a>
                            };
 
                            <span class="r17 r">unboundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#e7b58aeb41c5516f" class="i property">CommonEnvironmentSettings</a> = <span class="r23 r">jobCommonES</span>;
                        }
 
                        <span class="c">// add the job schedule to the service</span>
                        <span class="r17 r">unboundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#c97bee099e052f5b" class="i method">Commit</a>();
                    }
 
                    <span class="c">// now we have a jobschedule with jobprep/release...now test the values on the jobschedule</span>
                    {
                        <a href="/Microsoft.Azure.Batch/A.html#4b760c6b2e3f73cc" class="t t">CloudJobSchedule</a> <span id="r24 rd" class="r24 r">boundJobSchedule</span> = <span class="r10 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#58e4181ca7752f7b" class="i property">JobScheduleOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#347c6f1a0c3fd898" class="i method">GetJobSchedule</a>(<span class="r11 r">jsId</span>);
 
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r24 r">boundJobSchedule</span>);
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>);
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a>);
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#f3de6c2a0d369b17" class="i property">JobReleaseTask</a>);
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#e7b58aeb41c5516f" class="i property">CommonEnvironmentSettings</a>);
 
                        <a href="#f3d17a9402564077" class="i method">AssertGoodCommonEnvSettingsOM</a>(<span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#e7b58aeb41c5516f" class="i property">CommonEnvironmentSettings</a>);
                        <a href="#62c4701a20d2eb59" class="i method">AssertGoodJobPrepTaskOM</a>(<span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a>);
                        <a href="#c6e43c7ba1f3cbbc" class="i method">AssertGoodJobReleaseTaskOM</a>(<span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#f3de6c2a0d369b17" class="i property">JobReleaseTask</a>);
                        <a href="#f8eb9693b068e245" class="i method">AssertGoodResourceFiles</a>(<span class="r16 r">resFiles</span>, <span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a>.<a href="/Microsoft.Azure.Batch/A.html#eb0cfec25e77433c" class="i property">ResourceFiles</a>);
                        <a href="#f8eb9693b068e245" class="i method">AssertGoodResourceFiles</a>(<span class="r16 r">resFiles</span>, <span class="r24 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#f3de6c2a0d369b17" class="i property">JobReleaseTask</a>.<a href="/Microsoft.Azure.Batch/A.html#ba3980d002eba422" class="i property">ResourceFiles</a>);
 
                        <span class="c">//todo: test mutability</span>
                    }
 
                    <a href="/Microsoft.Azure.Batch/A.html#4b760c6b2e3f73cc" class="t t">CloudJobSchedule</a> <span id="r25 rd" class="r25 r">boundJobScheduleWithJob</span>; <span class="c">// set on job test</span>
 
                    <span class="c">// test the values on the job</span>
                    {
                        <span class="r25 r">boundJobScheduleWithJob</span> = <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#6f07729b71dc5cd8" class="i method">WaitForJobOnJobSchedule</a>(<span class="r10 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#58e4181ca7752f7b" class="i property">JobScheduleOperations</a>, <span class="r11 r">jsId</span>);
                        <a href="/Microsoft.Azure.Batch/A.html#f7086b8696d5b14e" class="t t">CloudJob</a> <span id="r26 rd" class="r26 r">bndJob</span> = <span class="r10 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#b87926cb72ba1c69" class="i method">GetJob</a>(<span class="r25 r">boundJobScheduleWithJob</span>.<a href="/Microsoft.Azure.Batch/A.html#b29aaa63bb1d7e76" class="i property">ExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#1f7cea9588eac068" class="i property">RecentJob</a>.<a href="/Microsoft.Azure.Batch/A.html#c7ecbae614b11d1d" class="i property">Id</a>);
 
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r26 r">bndJob</span>);
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#e558fa4901478bb3" class="i property">CommonEnvironmentSettings</a>);
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#7dc0967b967afca9" class="i property">JobPreparationTask</a>);
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#0d1d2fb2fe0e13a2" class="i property">JobReleaseTask</a>);
 
                        <a href="#f3d17a9402564077" class="i method">AssertGoodCommonEnvSettingsOM</a>(<span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#e558fa4901478bb3" class="i property">CommonEnvironmentSettings</a> <b>as</b> <a href="@0@mscorlib/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt;
                            <span class="c">/* we know it is our internal IList */</span>);
                        <a href="#62c4701a20d2eb59" class="i method">AssertGoodJobPrepTaskOM</a>(<span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#7dc0967b967afca9" class="i property">JobPreparationTask</a>);
                        <a href="#c6e43c7ba1f3cbbc" class="i method">AssertGoodJobReleaseTaskOM</a>(<span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#0d1d2fb2fe0e13a2" class="i property">JobReleaseTask</a>);
                        <a href="#f8eb9693b068e245" class="i method">AssertGoodResourceFiles</a>(<span class="r16 r">resFiles</span>, <span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#7dc0967b967afca9" class="i property">JobPreparationTask</a>.<a href="/Microsoft.Azure.Batch/A.html#eb0cfec25e77433c" class="i property">ResourceFiles</a>);
                        <a href="#f8eb9693b068e245" class="i method">AssertGoodResourceFiles</a>(<span class="r16 r">resFiles</span>, <span class="r26 r">bndJob</span>.<a href="/Microsoft.Azure.Batch/A.html#0d1d2fb2fe0e13a2" class="i property">JobReleaseTask</a>.<a href="/Microsoft.Azure.Batch/A.html#ba3980d002eba422" class="i property">ResourceFiles</a>);
 
                        <span class="c">//TODO: test immutability</span>
                    }
 
                    <span class="c">// used for on get-status test</span>
                    <a href="/Microsoft.Azure.Batch/A.html#4b760c6b2e3f73cc" class="t t">CloudJobSchedule</a> <span id="r27 rd" class="r27 r">updatedJobSchedule</span>;
 
                    <span class="c">// test update on the WI jobprep/jobrelease</span>
                    {
                        <span class="c">// change props</span>
                        <span class="r25 r">boundJobScheduleWithJob</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a>.<a href="/Microsoft.Azure.Batch/A.html#1fb31b6894240464" class="i property">WaitForSuccess</a> = <a href="#1e61ea2922471540" class="i field">JobPrepWaitForSuccessUpdate</a>;
 
                        <span class="c">// commit changes</span>
                        <span class="r25 r">boundJobScheduleWithJob</span>.<a href="/Microsoft.Azure.Batch/A.html#c97bee099e052f5b" class="i method">Commit</a>();
 
                        <span class="c">// get new values</span>
                        <span class="r27 r">updatedJobSchedule</span> = <span class="r10 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#58e4181ca7752f7b" class="i property">JobScheduleOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#347c6f1a0c3fd898" class="i method">GetJobSchedule</a>(<span class="r11 r">jsId</span>);
 
                        <span class="c">// confirm values changed</span>
                        <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#1e61ea2922471540" class="i field">JobPrepWaitForSuccessUpdate</a>, <span class="r27 r">updatedJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a>.<a href="/Microsoft.Azure.Batch/A.html#1fb31b6894240464" class="i property">WaitForSuccess</a>);
                    }
 
                    <a href="#7a4546db14897819" class="i method">TestGetPrepReleaseStatusCalls</a>(<span class="r10 r">client</span>, <span class="r27 r">updatedJobSchedule</span>, <a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a>, <span class="r16 r">resFiles</span>);
                }
                <b>finally</b>
                {
                    <span class="c">// cleanup</span>
                    <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#bdc1f31faf14fcc2" class="i method">DeleteJobScheduleIfExistsAsync</a>(<span class="r10 r">client</span>, <span class="r11 r">jsId</span>).<a href="@0@mscorlib/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                }
 
            }
 
            <a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#6ab3759e02709037" class="t t">SynchronizationContextHelper</a>.<a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#a1219f5208e7e69c" class="i method">RunTest</a>(<a href="#7e374ba360687970" class="i method">test</a>, <a href="#7803b3661b329e4a" class="i field">LongTestTimeout</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c">  Test the english text returned when a status call is made on a compute node that has not run the JP/JR</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="t constructor">Fact</span>]
        [<a href="Infrastructure/LiveTestAttribute.cs.html#a1847f7966bb21d7" class="t constructor">LiveTest</a>]
        [<span class="t constructor">Trait</span>(<a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#9c1513f600f7ef29" class="i field">TraitName</a>, <a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#3192e26026a08a2c" class="t t">Values</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#cb987dbcc4b85937" class="i field">ShortDuration</a>)]
        <b>public void</b> <a id="57a2526a4caa957a" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestOMJobPrepReleaseRunOnNaiveComputeNode</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r28 rd" class="r28 r">jobId</span> = <span class="s">&quot;TestOMJobPrepReleaseRunOnNaiveComputeNode-&quot;</span> + <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#71e76a83fc8dd577" class="i method">GetMyName</a>();
            <b>void</b> <a id="7e374ba360687970" href="R/7e374ba360687970.html" target="n" data-glyph="76,2" class="i method">test</a>()
            {
                <b>using</b> <a href="/Microsoft.Azure.Batch/A.html#a93c5701bdd04ea3" class="t t">BatchClient</a> <span id="r29 rd" class="r29 r">client</span> = <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#70323b9a3f92692c" class="i method">OpenBatchClient</a>(<a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#554e2d8347b023b3" class="i method">GetCredentialsFromEnvironment</a>());
                <b>try</b>
                {
                    <span class="c">// create job with prep/release</span>
                    {
                        <a href="/Microsoft.Azure.Batch/A.html#f7086b8696d5b14e" class="t t">CloudJob</a> <span id="r30 rd" class="r30 r">unboundJob</span> = <span class="r29 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#2ea94429ae1a83f7" class="i method">CreateJob</a>(<span class="r28 r">jobId</span>, <b>null</b>);
                        <span class="r30 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#329db8c4fbdc5168" class="i property">PoolInformation</a> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#f201a869350242a6" class="t constructor">PoolInformation</a>();
                        <span class="r30 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#329db8c4fbdc5168" class="i property">PoolInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#269cf0d6e56e7e5e" class="i property">PoolId</a> = <a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a>;
 
                        <span class="c">// add the jobPrep task to the job</span>
                        {
                            <a href="/Microsoft.Azure.Batch/A.html#0deb1ca70552b381" class="t t">JobPreparationTask</a> <span id="r31 rd" class="r31 r">prep</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#c7d6223ea012387e" class="t constructor">JobPreparationTask</a>(<span class="s">&quot;cmd /c echo JobPrep!!&quot;</span>);
                            <span class="r30 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#7dc0967b967afca9" class="i property">JobPreparationTask</a> = <span class="r31 r">prep</span>;
 
                            <span class="r31 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#1fb31b6894240464" class="i property">WaitForSuccess</a> = <b>true</b>; <span class="c">// be explicit even though this is the default.  need JP/JP to not run</span>
                        }
 
 
                        <span class="c">// add a jobRelease task to the job</span>
                        {
                            <a href="/Microsoft.Azure.Batch/A.html#6e57e67ad07386ca" class="t t">JobReleaseTask</a> <span id="r32 rd" class="r32 r">relTask</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#d88bdd204eb0394c" class="t constructor">JobReleaseTask</a>(<a href="#daa1e81a82033149" class="i field">JobReleaseTaskCommandLine</a>);
                            <span class="r30 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#0d1d2fb2fe0e13a2" class="i property">JobReleaseTask</a> = <span class="r32 r">relTask</span>;
                        }
 
                        <span class="c">// add the job to the service</span>
                        <span class="r30 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#3616feec2b409ce3" class="i method">Commit</a>();
                    }
 
                    <span class="c">// the victim nodes.  pool should have size 1.</span>
                    <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#421adebf5be96011" class="t t">ComputeNode</a>&gt; <span id="r33 rd" class="r33 r">computeNodes</span> = <span class="r29 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1eaf767b0e49d294" class="i property">PoolOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#0d48998befef9ca9" class="i method">ListComputeNodes</a>(<a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
                    <span class="t t">Assert</span>.<span class="i method">Single</span>(<span class="r33 r">computeNodes</span>);
                    <span class="c">// now we have a job with zero tasks... lets call get-status methods</span>
 
                    <span class="c">// call it</span>
                    <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a>&gt; <span id="r34 rd" class="r34 r">jrStatusList</span> =
                        <span class="r29 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#f9992e57128c3e50" class="i method">ListJobPreparationAndReleaseTaskStatus</a>(<span class="r28 r">jobId</span>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
                    <a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a> <span id="r35 rd" class="r35 r">prepAndReleaseStatus</span> = <span class="r34 r">jrStatusList</span>.<a href="@0@System.Core/A.html#8087366974af11d2" class="i method">FirstOrDefault</a>();
 
                    <span class="t t">Assert</span>.<span class="i method">Null</span>(<span class="r35 r">prepAndReleaseStatus</span>);
                }
                <b>finally</b>
                {
                    <span class="c">// cleanup</span>
                    <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#febdf0c7a8df4568" class="i method">DeleteJobIfExistsAsync</a>(<span class="r29 r">client</span>, <span class="r28 r">jobId</span>).<a href="@0@mscorlib/A.html#1bfe9e19e44f4cfa" class="i method">Wait</a>();
                }
            }
 
            <a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#6ab3759e02709037" class="t t">SynchronizationContextHelper</a>.<a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#a1219f5208e7e69c" class="i method">RunTest</a>(<a href="#7e374ba360687970" class="i method">test</a>, <a href="#38b9c2b9d380d4e2" class="i field">TestTimeout</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="Infrastructure/LiveTestAttribute.cs.html#a1847f7966bb21d7" class="t constructor">LiveTest</a>]
        [<span class="t constructor">Trait</span>(<a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#9c1513f600f7ef29" class="i field">TraitName</a>, <a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#3192e26026a08a2c" class="t t">Values</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#4e0c76c1a7231ee3" class="i field">LongDuration</a>)]
        <b>public void</b> <a id="6be557407c90ad13" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestOMJobPrepSchedulingError</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r36 rd" class="r36 r">jobId</span> = <span class="s">&quot;TestOMJobPrepSchedulingError-&quot;</span> + <a href="#1a56c240ec2b259d" class="i method">CraftTimeString</a>() + <span class="s">&quot;-&quot;</span> + <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#71e76a83fc8dd577" class="i method">GetMyName</a>();
 
            <b>void</b> <a id="7e374ba360687970" href="R/7e374ba360687970.html" target="n" data-glyph="76,2" class="i method">test</a>()
            {
                <b>using</b> <a href="/Microsoft.Azure.Batch/A.html#a93c5701bdd04ea3" class="t t">BatchClient</a> <span id="r37 rd" class="r37 r">client</span> = <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#70323b9a3f92692c" class="i method">OpenBatchClient</a>(<a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#554e2d8347b023b3" class="i method">GetCredentialsFromEnvironment</a>());
                <b>try</b>
                {
                    <span class="c">// create job with prep that triggers prep scheduling error</span>
                    {
                        <a href="/Microsoft.Azure.Batch/A.html#f7086b8696d5b14e" class="t t">CloudJob</a> <span id="r38 rd" class="r38 r">unboundJob</span> = <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#2ea94429ae1a83f7" class="i method">CreateJob</a>(<span class="r36 r">jobId</span>, <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#f201a869350242a6" class="t constructor">PoolInformation</a>() { <a href="/Microsoft.Azure.Batch/A.html#269cf0d6e56e7e5e" class="i property">PoolId</a> = <a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a> });
                        <span class="c">// add the jobPrep task to the job</span>
                        {
                            <a href="/Microsoft.Azure.Batch/A.html#0deb1ca70552b381" class="t t">JobPreparationTask</a> <span id="r39 rd" class="r39 r">prep</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#c7d6223ea012387e" class="t constructor">JobPreparationTask</a>(<span class="s">&quot;cmd /c JobPrep Task&quot;</span>);
                            <span class="r38 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#7dc0967b967afca9" class="i property">JobPreparationTask</a> = <span class="r39 r">prep</span>;
 
                            <a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>[] <span id="r40 rd" class="r40 r">badResFiles</span> = { <a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>.<a href="/Microsoft.Azure.Batch/A.html#a610813b70cc2552" class="i method">FromUrl</a>(<span class="s">&quot;https://not.a.domain.invalid/file&quot;</span>, <span class="s">&quot;bob.txt&quot;</span>) };
 
                            <span class="r39 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#eb0cfec25e77433c" class="i property">ResourceFiles</a> = <span class="r40 r">badResFiles</span>;
 
                            <span class="r39 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#1fb31b6894240464" class="i property">WaitForSuccess</a> = <b>true</b>; <span class="c">// be explicit even though this is the default.  need JP/ to not run</span>
                        }
 
                        <span class="c">// add the job to the service</span>
                        <span class="r38 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#3616feec2b409ce3" class="i method">Commit</a>();
                    }
 
                    <a href="/Microsoft.Azure.Batch/A.html#f7086b8696d5b14e" class="t t">CloudJob</a> <span id="r41 rd" class="r41 r">boundJob</span> = <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#b87926cb72ba1c69" class="i method">GetJob</a>(<span class="r36 r">jobId</span>);
 
                    <span class="c">// add a trivial task to force the JP</span>
                    <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#0ae8bcd2f0d07053" class="i method">AddTask</a>(<span class="r41 r">boundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#5ac471c8cd7bd4d6" class="i property">Id</a>, <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#9feffc4561b02162" class="t constructor">CloudTask</a>(<span class="s">&quot;ForceJobPrep&quot;</span>, <span class="s">&quot;cmd /c echo TestOMJobPrepSchedulingError&quot;</span>));
 
                    <span class="c">// the victim compute node.  pool should have size 1.</span>
                    <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#421adebf5be96011" class="t t">ComputeNode</a>&gt; <span id="r42 rd" class="r42 r">nodes</span> = <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1eaf767b0e49d294" class="i property">PoolOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#0d48998befef9ca9" class="i method">ListComputeNodes</a>(<a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
                    <span class="t t">Assert</span>.<span class="i method">Single</span>(<span class="r42 r">nodes</span>);
 
                    <span class="c">// now we have a job that should be trying to run the JP</span>
                    <span class="c">// poll for the JP to have been run, and it must have a scheduling error</span>
                    <b>bool</b> <span id="r43 rd" class="r43 r">prepNotCompleted</span> = <b>true</b>;
 
                    <span class="c">// gotta poll to find out when the jp has been run</span>
                    <b>while</b> (<span class="r43 r">prepNotCompleted</span>)
                    {
                        <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a>&gt; <span id="r44 rd" class="r44 r">jpStatsList</span> =
                            <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#f9992e57128c3e50" class="i method">ListJobPreparationAndReleaseTaskStatus</a>(<span class="r36 r">jobId</span>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
                        <a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a> <span id="r45 rd" class="r45 r">jpStatus</span> = <span class="r44 r">jpStatsList</span>.<a href="@0@System.Core/A.html#8087366974af11d2" class="i method">FirstOrDefault</a>();
 
                        <b>if</b> (<span class="r45 r">jpStatus</span> == <b>null</b>)
                        {
                            <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(2000);
                        }
                        <b>else</b>
                        {
                            <b>if</b> (<a href="/Microsoft.Azure.Batch/A.html#9aa7499bfc03ca37" class="t t">JobPreparationTaskState</a>.<a href="/Microsoft.Azure.Batch/A.html#4a8a73b01a3a7b84" class="i field">Completed</a> == <span class="r45 r">jpStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#1c4f375fc4e70293" class="i property">State</a>)
                            {
                                <span class="r43 r">prepNotCompleted</span> = <b>false</b>; <span class="c">// we see a JP has completed</span>
 
                                <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r45 r">jpStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#170957d84cb78160" class="i property">FailureInformation</a>);
                                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="/Microsoft.Azure.Batch/A.html#41f481b96170d5a0" class="t t">TaskExecutionResult</a>.<a href="/Microsoft.Azure.Batch/A.html#22c38eb340f97fca" class="i field">Failure</a>, <span class="r45 r">jpStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#1f5bd6a72bfac3f3" class="i property">Result</a>);
 
                                <span class="c">// spew the failure</span>
                                <a href="#a82e152a9b05285b" class="i method">OutputFailureInfo</a>(<span class="r45 r">jpStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#170957d84cb78160" class="i property">FailureInformation</a>);
                            }
 
                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;Job Prep is running (waiting for blob dl to timeout)&quot;</span>);
                        }
                    }
                }
                <b>finally</b>
                {
                    <span class="c">// cleanup</span>
                    <span class="r37 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#2cc5ad442e1b1f0d" class="i method">DeleteJob</a>(<span class="r36 r">jobId</span>);
                }
            }
 
            <a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#6ab3759e02709037" class="t t">SynchronizationContextHelper</a>.<a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#a1219f5208e7e69c" class="i method">RunTest</a>(<a href="#7e374ba360687970" class="i method">test</a>, <a href="#38b9c2b9d380d4e2" class="i field">TestTimeout</a>);
        }
 
        [<span class="t constructor">Fact</span>]
        [<a href="Infrastructure/LiveTestAttribute.cs.html#a1847f7966bb21d7" class="t constructor">LiveTest</a>]
        [<span class="t constructor">Trait</span>(<a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#9c1513f600f7ef29" class="i field">TraitName</a>, <a href="/Microsoft.Azure.Batch.Common/A.html#f12b116e0e4623de" class="t t">TestTraits</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#8972788bc05b4b9f" class="t t">Duration</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#3192e26026a08a2c" class="t t">Values</a>.<a href="/Microsoft.Azure.Batch.Common/A.html#4e0c76c1a7231ee3" class="i field">LongDuration</a>)]
        <b>public void</b> <a id="9d1c0291dc62fb17" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">TestOMJobReleaseSchedulingError</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r46 rd" class="r46 r">jobId</span> = <span class="s">&quot;TestOMJobReleaseSchedulingError-&quot;</span> + <a href="#1a56c240ec2b259d" class="i method">CraftTimeString</a>() + <span class="s">&quot;-&quot;</span> + <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#71e76a83fc8dd577" class="i method">GetMyName</a>();
            <b>void</b> <a id="7e374ba360687970" href="R/7e374ba360687970.html" target="n" data-glyph="76,2" class="i method">test</a>()
            {
                <b>using</b> <a href="/Microsoft.Azure.Batch/A.html#a93c5701bdd04ea3" class="t t">BatchClient</a> <span id="r47 rd" class="r47 r">client</span> = <a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#70323b9a3f92692c" class="i method">OpenBatchClient</a>(<a href="IntegrationTestUtilities/TestUtilities.cs.html#f71534b6d265a791" class="t t">TestUtilities</a>.<a href="IntegrationTestUtilities/TestUtilities.cs.html#554e2d8347b023b3" class="i method">GetCredentialsFromEnvironment</a>());
                <b>try</b>
                {
                    <span class="c">// create job schedule with prep that succeeds and release the triggers scheduling error</span>
                    {
                        <a href="/Microsoft.Azure.Batch/A.html#e2a7639da69bf434" class="t t">PoolInformation</a> <span id="r48 rd" class="r48 r">poolInfo</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#f201a869350242a6" class="t constructor">PoolInformation</a>() { <a href="/Microsoft.Azure.Batch/A.html#269cf0d6e56e7e5e" class="i property">PoolId</a> = <a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a> };
                        <a href="/Microsoft.Azure.Batch/A.html#f7086b8696d5b14e" class="t t">CloudJob</a> <span id="r49 rd" class="r49 r">unboundJob</span> = <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#2ea94429ae1a83f7" class="i method">CreateJob</a>(<span class="r46 r">jobId</span>, <span class="r48 r">poolInfo</span>);
 
                        <span class="c">// add the jobPrep task to the job</span>
                        {
                            <a href="/Microsoft.Azure.Batch/A.html#0deb1ca70552b381" class="t t">JobPreparationTask</a> <span id="r50 rd" class="r50 r">prep</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#c7d6223ea012387e" class="t constructor">JobPreparationTask</a>(<span class="s">&quot;cmd /c echo the quick job prep jumped over the...&quot;</span>);
                            <span class="r49 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#7dc0967b967afca9" class="i property">JobPreparationTask</a> = <span class="r50 r">prep</span>;
 
                            <span class="r50 r">prep</span>.<a href="/Microsoft.Azure.Batch/A.html#1fb31b6894240464" class="i property">WaitForSuccess</a> = <b>false</b>; <span class="c">// we don&#39;t really care but why not set this</span>
                        }
 
                        <span class="c">// add a jobRelease task to the job</span>
                        {
                            <a href="/Microsoft.Azure.Batch/A.html#6e57e67ad07386ca" class="t t">JobReleaseTask</a> <span id="r51 rd" class="r51 r">relTask</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#d88bdd204eb0394c" class="t constructor">JobReleaseTask</a>(<span class="s">&quot;cmd /c echo Job Release Task&quot;</span>);
                            <span class="r49 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#0d1d2fb2fe0e13a2" class="i property">JobReleaseTask</a> = <span class="r51 r">relTask</span>;
 
                            <a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>[] <span id="r52 rd" class="r52 r">badResFiles</span> = { <a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>.<a href="/Microsoft.Azure.Batch/A.html#a610813b70cc2552" class="i method">FromUrl</a>(<span class="s">&quot;https://not.a.domain.invalid/file&quot;</span>, <span class="s">&quot;bob.txt&quot;</span>) };
 
                            <span class="r51 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#ba3980d002eba422" class="i property">ResourceFiles</a> = <span class="r52 r">badResFiles</span>;
 
                            <span class="r51 r">relTask</span>.<a href="/Microsoft.Azure.Batch/A.html#a210275440fefd8f" class="i property">Id</a> = <span class="s">&quot;jobRelease&quot;</span>;
                        }
 
                        <span class="c">// add the job to the service</span>
                        <span class="r49 r">unboundJob</span>.<a href="/Microsoft.Azure.Batch/A.html#3616feec2b409ce3" class="i method">Commit</a>();
                    }
 
                    <span class="c">// add a trivial task to force the JP</span>
                    <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#0ae8bcd2f0d07053" class="i method">AddTask</a>(<span class="r46 r">jobId</span>, <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#9feffc4561b02162" class="t constructor">CloudTask</a>(<span class="s">&quot;ForceJobPrep&quot;</span>, <span class="s">&quot;cmd /c echo TestOMJobReleaseSchedulingError&quot;</span>));
 
                    <span class="c">// wait for the task to complete</span>
 
                    <a href="/Microsoft.Azure.Batch/A.html#c27f3744780e0805" class="t t">TaskStateMonitor</a> <span id="r53 rd" class="r53 r">tsm</span> = <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#64529c3a532b3f2b" class="i property">Utilities</a>.<a href="/Microsoft.Azure.Batch/A.html#d4ceea47a8cdb7ed" class="i method">CreateTaskStateMonitor</a>();
 
                    <span class="r53 r">tsm</span>.<a href="/Microsoft.Azure.Batch/A.html#b5caf4dea114966b" class="i method">WaitAll</a>(
                        <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#385a3919a7427604" class="i method">ListTasks</a>(<span class="r46 r">jobId</span>),
                        <a href="/Microsoft.Azure.Batch/A.html#61427e025d3132b9" class="t t">TaskState</a>.<a href="/Microsoft.Azure.Batch/A.html#9dc78f8044c6f13b" class="i field">Completed</a>,
                        <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#ae74be5264df78d8" class="i method">FromMinutes</a>(10),
                        <span class="r54 r">additionalBehaviors</span>:
                            <b>new</b>[]
                            {
                                    <span class="c">// spam/logging interceptor</span>
                                    <b>new</b> <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#20b6019ccd20581f" class="t constructor">RequestInterceptor</a>((<span id="r55 rd" class="r55 r">x</span>) =&gt;
                                        {
                                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;Issuing request type: &quot;</span> + <span class="r55 r">x</span>.<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>().<a href="@0@mscorlib/A.html#3b264aebc8d4c084" class="i method">ToString</a>());
 
                                            <span class="c">// print out the compute node states... we are actually waiting on the compute nodes</span>
                                            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#421adebf5be96011" class="t t">ComputeNode</a>&gt; <span id="r56 rd" class="r56 r">allComputeNodes</span> = <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1eaf767b0e49d294" class="i property">PoolOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#0d48998befef9ca9" class="i method">ListComputeNodes</a>(<a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
                                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;    #compute nodes: &quot;</span> + <span class="r56 r">allComputeNodes</span>.<a href="@0@mscorlib/A.html#78a69d857716bc68" class="i property">Count</a>);
 
                                            <span class="r56 r">allComputeNodes</span>.<a href="@0@mscorlib/A.html#0e5a9cf0a310b9e5" class="i method">ForEach</a>((<span id="r57 rd" class="r57 r">icn</span>) =&gt;
                                                {
                                                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;  computeNode.id: &quot;</span> + <span class="r57 r">icn</span>.<a href="/Microsoft.Azure.Batch/A.html#3601106c4cbb0f72" class="i property">Id</a> + <span class="s">&quot;, state: &quot;</span> + <span class="r57 r">icn</span>.<a href="/Microsoft.Azure.Batch/A.html#60eb6d2c95c20192" class="i property">State</a>);
                                                });
                                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;&quot;</span>);
                                        })
                            }
                        );
 
                    <span class="c">// ok terminate job to trigger job release</span>
                    <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#a3ab103e0510a330" class="i method">TerminateJob</a>(<span class="r46 r">jobId</span>, <span class="s">&quot;BUG: Server will throw 500 if I don&#39;t provide reason&quot;</span>);
 
                    <span class="c">// the victim compute node.  pool should have size 1.</span>
                    <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#421adebf5be96011" class="t t">ComputeNode</a>&gt; <span id="r58 rd" class="r58 r">computeNodes</span> = <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1eaf767b0e49d294" class="i property">PoolOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#0d48998befef9ca9" class="i method">ListComputeNodes</a>(<a href="#0e3bafbf351ec53c" class="i field">poolFixture</a>.<a href="Fixtures/PoolFixture.cs.html#df55b1cdf3dae3af" class="i property">PoolId</a>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
                    <span class="t t">Assert</span>.<span class="i method">Single</span>(<span class="r58 r">computeNodes</span>);
 
                    <span class="c">// now we have a job that should be trying to run the JP</span>
                    <span class="c">// poll for the JP to have been run, and it must have a scheduling error</span>
                    <b>bool</b> <span id="r59 rd" class="r59 r">releaseNotCompleted</span> = <b>true</b>;
 
                    <span class="c">// gotta poll to find out when the jp has been run</span>
                    <b>while</b> (<span class="r59 r">releaseNotCompleted</span>)
                    {
                        <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a>&gt; <span id="r60 rd" class="r60 r">jrStatusList</span> =
                            <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#f9992e57128c3e50" class="i method">ListJobPreparationAndReleaseTaskStatus</a>(<span class="r46 r">jobId</span>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
                        <a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a> <span id="r61 rd" class="r61 r">prepAndReleaseStatus</span> = <span class="r60 r">jrStatusList</span>.<a href="@0@System.Core/A.html#8087366974af11d2" class="i method">FirstOrDefault</a>();
 
                        <b>if</b> (<span class="r61 r">prepAndReleaseStatus</span> != <b>null</b> &amp;&amp; <b>null</b> != <span class="r61 r">prepAndReleaseStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>)
                        {
                            <b>if</b> (<a href="/Microsoft.Azure.Batch/A.html#29b972fbe5e14888" class="t t">JobReleaseTaskState</a>.<a href="/Microsoft.Azure.Batch/A.html#b7c96c09c4b552c1" class="i field">Completed</a> == <span class="r61 r">prepAndReleaseStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#51fcd570e33aea6a" class="i property">State</a>)
                            {
                                <span class="r59 r">releaseNotCompleted</span> = <b>false</b>; <span class="c">// we see a JP has been run</span>
 
                                <span class="c">// now assert the failure info</span>
                                <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r61 r">prepAndReleaseStatus</span>);
                                <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r61 r">prepAndReleaseStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#9be1fcbf919e397e" class="i property">FailureInformation</a>);
                                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="/Microsoft.Azure.Batch/A.html#41f481b96170d5a0" class="t t">TaskExecutionResult</a>.<a href="/Microsoft.Azure.Batch/A.html#22c38eb340f97fca" class="i field">Failure</a>, <span class="r61 r">prepAndReleaseStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#db932c5f5e7c09ab" class="i property">Result</a>);
 
                                <span class="c">// spew the failure info</span>
                                <a href="#a82e152a9b05285b" class="i method">OutputFailureInfo</a>(<span class="r61 r">prepAndReleaseStatus</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#9be1fcbf919e397e" class="i property">FailureInformation</a>);
                            }
                        }
                        <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(2000);
                        <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;Job Release tasks still running (waiting for blob dl to timeout).&quot;</span>);
                    }
                }
                <b>finally</b>
                {
                    <span class="r47 r">client</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#2cc5ad442e1b1f0d" class="i method">DeleteJob</a>(<span class="r46 r">jobId</span>);
                }
            }
 
            <a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#6ab3759e02709037" class="t t">SynchronizationContextHelper</a>.<a href="IntegrationTestUtilities/SynchronizationContextHelper.cs.html#a1219f5208e7e69c" class="i method">RunTest</a>(<a href="#7e374ba360687970" class="i method">test</a>, <a href="#7803b3661b329e4a" class="i field">LongTestTimeout</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private helpers
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> calls the two new get-status REST APIs and asserts their values</span>
        <span class="c">///</span>
        <span class="c">///</span><span class="c"> 1: add a single quick task (quick because we don&#39;t need it to run very long)</span>
        <span class="c">///</span><span class="c"> 2: this forces a victim compute node to run the JobPrep</span>
        <span class="c">///</span><span class="c"> 3: poll for this compute node, ignore others (sharedPool.size probably &gt; 1)</span>
        <span class="c">///</span><span class="c"> 4: check status of JobPrep</span>
        <span class="c">///</span><span class="c"> 4a: assert as many values as makes sense... this is not a retry test</span>
        <span class="c">///</span><span class="c"> 5: JobPrep succeeds, task runs</span>
        <span class="c">///</span><span class="c"> 6: poll for JobRelease.. it is long running</span>
        <span class="c">///</span><span class="c"> 7: assert as many values as makes sense.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r62 r">batchCli</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="7a4546db14897819" href="R/7a4546db14897819.html" target="n" data-glyph="76,1" class="i method">TestGetPrepReleaseStatusCalls</a>(<a href="/Microsoft.Azure.Batch/A.html#a93c5701bdd04ea3" class="t t">BatchClient</a> <span id="r62 rd" class="r62 r">batchCli</span>, <a href="/Microsoft.Azure.Batch/A.html#4b760c6b2e3f73cc" class="t t">CloudJobSchedule</a> <span id="r63 rd" class="r63 r">boundJobSchedule</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r64 rd" class="r64 r">sharedPool</span>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt; <span id="r65 rd" class="r65 r">correctResFiles</span>)
        {
            <span class="c">// need this often enough lets just pull it out</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r66 rd" class="r66 r">jobId</span> = <span class="r63 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#b29aaa63bb1d7e76" class="i property">ExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#1f7cea9588eac068" class="i property">RecentJob</a>.<a href="/Microsoft.Azure.Batch/A.html#c7ecbae614b11d1d" class="i property">Id</a>;
 
            <a href="/Microsoft.Azure.Batch/A.html#b07a5caddfdabf69" class="t t">PoolOperations</a> <span id="r67 rd" class="r67 r">poolOps</span> = <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1eaf767b0e49d294" class="i property">PoolOperations</a>;
            <a href="/Microsoft.Azure.Batch/A.html#5e7b544980420a0e" class="t t">JobScheduleOperations</a> <span id="r68 rd" class="r68 r">jobScheduleOperations</span> = <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#58e4181ca7752f7b" class="i property">JobScheduleOperations</a>;
            {
                <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a> <span id="r69 rd" class="r69 r">beforeJobPrepRuns</span> = <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#b0d5e4c9a8d4ddac" class="i property">UtcNow</a>;  <span class="c">// used to test start time</span>
 
                <span class="c">// need a task to force JobPrep</span>
                <a href="/Microsoft.Azure.Batch/A.html#eeca8189f6dd1bc1" class="t t">CloudTask</a> <span id="r70 rd" class="r70 r">sillyTask</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#9feffc4561b02162" class="t constructor">CloudTask</a>(<span class="s">&quot;forceJobPrep&quot;</span>, <span class="s">&quot;cmd /c hostname&quot;</span>);
 
                <span class="c">// add the task</span>
                <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#0ae8bcd2f0d07053" class="i method">AddTask</a>(<span class="r66 r">jobId</span>, <span class="r70 r">sillyTask</span>);
 
                <b>bool</b> <span id="r71 rd" class="r71 r">keepLooking</span> = <b>true</b>;
 
                <b>while</b> (<span class="r71 r">keepLooking</span>)
                {
                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;Waiting for task to be scheduled.&quot;</span>);
 
                    <b>foreach</b> (<a href="/Microsoft.Azure.Batch/A.html#eeca8189f6dd1bc1" class="t t">CloudTask</a> <span id="r72 rd" class="r72 r">curTask</span> <b>in</b> <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#b87926cb72ba1c69" class="i method">GetJob</a>(<span class="r66 r">jobId</span>).<a href="/Microsoft.Azure.Batch/A.html#b430aef69f3915ce" class="i method">ListTasks</a>())
                    {
                        <b>if</b> (<span class="r72 r">curTask</span>.<a href="/Microsoft.Azure.Batch/A.html#86841c3d70596d99" class="i property">State</a> != <a href="/Microsoft.Azure.Batch/A.html#61427e025d3132b9" class="t t">TaskState</a>.<a href="/Microsoft.Azure.Batch/A.html#2b077eb1246c20cb" class="i field">Active</a>)
                        {
                            <span class="r71 r">keepLooking</span> = <b>false</b>;
 
                            <b>break</b>;
                        }
                    }
 
                    <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(1000);
                }
 
                <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a>&gt; <span id="r73 rd" class="r73 r">jobPrepStatusList</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a>&gt;();
                <b>while</b> (<span class="r73 r">jobPrepStatusList</span>.<a href="@0@mscorlib/A.html#78a69d857716bc68" class="i property">Count</a> == 0)
                {
                    <span class="r73 r">jobPrepStatusList</span> = <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#f9992e57128c3e50" class="i method">ListJobPreparationAndReleaseTaskStatus</a>(<span class="r66 r">jobId</span>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
                }
                <a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a> <span id="r74 rd" class="r74 r">jptei</span> = <span class="r73 r">jobPrepStatusList</span>.<a href="@0@System.Core/A.html#bc8ae402a61dd9d6" class="i method">First</a>();
 
                <a href="/Microsoft.Azure.Batch/A.html#421adebf5be96011" class="t t">ComputeNode</a> <span id="r75 rd" class="r75 r">victimComputeNodeRunningPrepAndRelease</span> = <span class="r67 r">poolOps</span>.<a href="/Microsoft.Azure.Batch/A.html#647af1c959d523b8" class="i method">GetComputeNode</a>(<span class="r64 r">sharedPool</span>, <span class="r74 r">jptei</span>.<a href="/Microsoft.Azure.Batch/A.html#9da7806e4de785ef" class="i property">ComputeNodeId</a>);
 
                <span class="c">// job prep tests</span>
                {
                    <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r74 r">jptei</span>);
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(0, <span class="r74 r">jptei</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#1a8db3545f38ee65" class="i property">RetryCount</a>);
                    <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r69 r">beforeJobPrepRuns</span> &lt; <span class="r74 r">jptei</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#b49fb878507253fa" class="i property">StartTime</a> + <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(10));  <span class="c">// test that the start time is rational -- 10s of wiggle room</span>
                    <span class="t t">Assert</span>.<span class="i method">Null</span>(<span class="r74 r">jptei</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#170957d84cb78160" class="i property">FailureInformation</a>);
 
                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;&quot;</span>);
                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;listing files for compute node: &quot;</span> + <span class="r75 r">victimComputeNodeRunningPrepAndRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#3601106c4cbb0f72" class="i property">Id</a>);
 
                    <span class="c">// fiter the list so reduce noise</span>
                    <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="t t">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#dc33c510bc82e4a3" class="t t">NodeFile</a>&gt; <span id="r76 rd" class="r76 r">filteredListJobPrep</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#dc33c510bc82e4a3" class="t t">NodeFile</a>&gt;();
 
                    <b>foreach</b> (<a href="/Microsoft.Azure.Batch/A.html#dc33c510bc82e4a3" class="t t">NodeFile</a> <span id="r77 rd" class="r77 r">curTF</span> <b>in</b> <span class="r75 r">victimComputeNodeRunningPrepAndRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#6a235968c9e6c70e" class="i method">ListNodeFiles</a>(<span class="r78 r">recursive</span>: <b>true</b>))
                    {
                        <span class="c">// filter on the jsId since we only run one job per job in this test.</span>
                        <b>if</b> (<span class="r77 r">curTF</span>.<a href="/Microsoft.Azure.Batch/A.html#9d73ef017f880d7c" class="i property">Path</a>.<a href="@0@mscorlib/A.html#7d6aed52d875ec59" class="i method">IndexOf</a>(<span class="r63 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#adfd091600c3264c" class="i property">Id</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#eabf4db5f5c52b6a" class="i field">InvariantCultureIgnoreCase</a>) &gt;= 0)
                        {
                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;    name:&quot;</span> + <span class="r77 r">curTF</span>.<a href="/Microsoft.Azure.Batch/A.html#9d73ef017f880d7c" class="i property">Path</a> + <span class="s">&quot;, size: &quot;</span> + ((<span class="r77 r">curTF</span>.<a href="/Microsoft.Azure.Batch/A.html#6781ecb5492bc18e" class="i property">IsDirectory</a>.<a href="@0@mscorlib/A.html#7bbe60e33e857298" class="i property">HasValue</a> &amp;&amp; <span class="r77 r">curTF</span>.<a href="/Microsoft.Azure.Batch/A.html#6781ecb5492bc18e" class="i property">IsDirectory</a>.<a href="@0@mscorlib/A.html#7b38d1fa76071c95" class="i property">Value</a>) ? <span class="s">&quot;&lt;dir&gt;&quot;</span> : <span class="r77 r">curTF</span>.<a href="/Microsoft.Azure.Batch/A.html#51c1c4ab80cdbc1e" class="i property">Properties</a>.<a href="/Microsoft.Azure.Batch/A.html#d2c5d7f25c4dffa9" class="i property">ContentLength</a>.<a href="@0@mscorlib/A.html#76873dfc1b95c712" class="i method">ToString</a>()));
 
                            <span class="r76 r">filteredListJobPrep</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r77 r">curTF</span>);
                        }
                    }
 
                    <span class="c">// confirm resource files made it</span>
                    <b>foreach</b> (<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a> <span id="r79 rd" class="r79 r">curCorrectRF</span> <b>in</b> <span class="r65 r">correctResFiles</span>)
                    {
                        <b>bool</b> <span id="r80 rd" class="r80 r">found</span> = <b>false</b>;
 
                        <b>foreach</b> (<a href="/Microsoft.Azure.Batch/A.html#dc33c510bc82e4a3" class="t t">NodeFile</a> <span id="r81 rd" class="r81 r">curTF</span> <b>in</b> <span class="r76 r">filteredListJobPrep</span>)
                        {
                            <span class="c">// look for the resfile filepath in the taskfile name</span>
                            <span class="r80 r">found</span> |= <span class="r81 r">curTF</span>.<a href="/Microsoft.Azure.Batch/A.html#9d73ef017f880d7c" class="i property">Path</a>.<a href="@0@mscorlib/A.html#7d6aed52d875ec59" class="i method">IndexOf</a>(<span class="r79 r">curCorrectRF</span>.<a href="/Microsoft.Azure.Batch/A.html#8691f0768f7371cf" class="i property">FilePath</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#eabf4db5f5c52b6a" class="i field">InvariantCultureIgnoreCase</a>) &gt;= 0;
                        }
                        <span class="t t">Assert</span>.<span class="i method">True</span>(<span class="r80 r">found</span>, <span class="s">&quot;Looking for resourcefile: &quot;</span> + <span class="r79 r">curCorrectRF</span>.<a href="/Microsoft.Azure.Batch/A.html#8691f0768f7371cf" class="i property">FilePath</a>);
                    }
 
                    <span class="c">// poll for completion</span>
                    <b>while</b> (<a href="/Microsoft.Azure.Batch/A.html#9aa7499bfc03ca37" class="t t">JobPreparationTaskState</a>.<a href="/Microsoft.Azure.Batch/A.html#4a8a73b01a3a7b84" class="i field">Completed</a> != <span class="r74 r">jptei</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#1c4f375fc4e70293" class="i property">State</a>)
                    {
                        <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;waiting for jopPrep to complete&quot;</span>);
                        <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(2000);
 
                        <span class="c">// refresh the state info</span>
                        <a href="/Microsoft.Azure.Batch/A.html#e8b2b7d2634345fb" class="t t">ODATADetailLevel</a> <span id="r82 rd" class="r82 r">detailLevel</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#1442fdcd5a900cb9" class="t constructor">ODATADetailLevel</a>() { <a href="/Microsoft.Azure.Batch/A.html#320e51351a44e333" class="i property">FilterClause</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;nodeId eq &#39;{0}&#39;&quot;</span>, <span class="r75 r">victimComputeNodeRunningPrepAndRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#3601106c4cbb0f72" class="i property">Id</a>) };
                        <span class="r73 r">jobPrepStatusList</span> = <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#f9992e57128c3e50" class="i method">ListJobPreparationAndReleaseTaskStatus</a>(<span class="r66 r">jobId</span>, <span class="r83 r">detailLevel</span>: <span class="r82 r">detailLevel</span>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
                        <span class="r74 r">jptei</span> = <span class="r73 r">jobPrepStatusList</span>.<a href="@0@System.Core/A.html#bc8ae402a61dd9d6" class="i method">First</a>();
                    }
 
                    <span class="c">// need success</span>
                    <span class="t t">Assert</span>.<span class="i method">Equal</span>(0, <span class="r74 r">jptei</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#2e93eeeaad67c4ca" class="i property">ExitCode</a>);
 
                    <span class="c">// check stdout to confirm prep ran</span>
 
                    <span class="c">//Why do I have to use the hardcoded string job-1 here...?</span>
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r84 rd" class="r84 r">stdOutFileSpec</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#65c63f5b94b2ac9b" class="i method">Combine</a>(<span class="s">&quot;workitems&quot;</span>, <span class="r63 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#adfd091600c3264c" class="i property">Id</a>, <span class="s">&quot;job-1&quot;</span>, <span class="r63 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a>.<a href="/Microsoft.Azure.Batch/A.html#e0bb2629373d681d" class="i property">Id</a>, <a href="/Microsoft.Azure.Batch/A.html#9295672bd7b4088f" class="t t">Constants</a>.<a href="/Microsoft.Azure.Batch/A.html#d30384bdc08e5a4b" class="i field">StandardOutFileName</a>);
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r85 rd" class="r85 r">stdOut</span> = <span class="r75 r">victimComputeNodeRunningPrepAndRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#5bce22cd037339be" class="i method">GetNodeFile</a>(<span class="r84 r">stdOutFileSpec</span>).<a href="/Microsoft.Azure.Batch/A.html#5abec1c7ffbf3f4a" class="i method">ReadAsString</a>();
 
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r86 rd" class="r86 r">stdErrFileSpec</span> = <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#65c63f5b94b2ac9b" class="i method">Combine</a>(<span class="s">&quot;workitems&quot;</span>, <span class="r63 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#adfd091600c3264c" class="i property">Id</a>, <span class="s">&quot;job-1&quot;</span>, <span class="r63 r">boundJobSchedule</span>.<a href="/Microsoft.Azure.Batch/A.html#93b05f691f3a6525" class="i property">JobSpecification</a>.<a href="/Microsoft.Azure.Batch/A.html#7ed4025fd0c171f5" class="i property">JobPreparationTask</a>.<a href="/Microsoft.Azure.Batch/A.html#e0bb2629373d681d" class="i property">Id</a>, <a href="/Microsoft.Azure.Batch/A.html#9295672bd7b4088f" class="t t">Constants</a>.<a href="/Microsoft.Azure.Batch/A.html#df894fb6cf51b539" class="i field">StandardErrorFileName</a>);
 
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r87 rd" class="r87 r">stdErr</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
 
                    <b>try</b>
                    {
                        <span class="r87 r">stdErr</span> = <span class="r75 r">victimComputeNodeRunningPrepAndRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#5bce22cd037339be" class="i method">GetNodeFile</a>(<span class="r86 r">stdErrFileSpec</span>).<a href="/Microsoft.Azure.Batch/A.html#5abec1c7ffbf3f4a" class="i method">ReadAsString</a>();
                    }
                    <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a>)
                    {
                        <span class="c">//Swallow any exceptions here since stderr may not exist</span>
                    }
 
                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="r85 r">stdOut</span>);
                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="r87 r">stdErr</span>);
 
                    <span class="t t">Assert</span>.<span class="i method">True</span>(!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r85 r">stdOut</span>));
                    <span class="t t">Assert</span>.<span class="i method">Contains</span>(<span class="s">&quot;jobpreparation&quot;</span>, <span class="r85 r">stdOut</span>.<a href="@0@mscorlib/A.html#0b5a1ee33618e0b3" class="i method">ToLower</a>());
                }
 
                <span class="c">// jobPrep tests completed.  let JobPrep complete and task run and wait for JobRelease</span>
 
                <a href="/Microsoft.Azure.Batch/A.html#c27f3744780e0805" class="t t">TaskStateMonitor</a> <span id="r88 rd" class="r88 r">tsm</span> = <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#64529c3a532b3f2b" class="i property">Utilities</a>.<a href="/Microsoft.Azure.Batch/A.html#d4ceea47a8cdb7ed" class="i method">CreateTaskStateMonitor</a>();
 
                <span class="c">// spam/logging interceptor</span>
                <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#0a5fcca20b641bf0" class="t t">RequestInterceptor</a> <span id="r89 rd" class="r89 r">consoleSpammer</span> =
                                                <b>new</b> <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#20b6019ccd20581f" class="t constructor">RequestInterceptor</a>((<span id="r90 rd" class="r90 r">x</span>) =&gt;
                                                {
                                                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;TestGetPrepReleaseStatusCalls: waiting for JobPrep and task to complete&quot;</span>);
 
                                                    <a href="/Microsoft.Azure.Batch/A.html#e8b2b7d2634345fb" class="t t">ODATADetailLevel</a> <span id="r91 rd" class="r91 r">detailLevel</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#1442fdcd5a900cb9" class="t constructor">ODATADetailLevel</a>() { <a href="/Microsoft.Azure.Batch/A.html#320e51351a44e333" class="i property">FilterClause</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;nodeId eq &#39;{0}&#39;&quot;</span>, <span class="r75 r">victimComputeNodeRunningPrepAndRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#3601106c4cbb0f72" class="i property">Id</a>) };
                                                    <span class="r73 r">jobPrepStatusList</span> = <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#f9992e57128c3e50" class="i method">ListJobPreparationAndReleaseTaskStatus</a>(<span class="r66 r">jobId</span>, <span class="r83 r">detailLevel</span>: <span class="r91 r">detailLevel</span>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
                                                    <a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a> <span id="r92 rd" class="r92 r">jpteiInterceptor</span> =
                                                        <span class="r73 r">jobPrepStatusList</span>.<a href="@0@System.Core/A.html#bc8ae402a61dd9d6" class="i method">First</a>();
 
                                                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;    JobPrep.State: &quot;</span> + <span class="r92 r">jpteiInterceptor</span>.<a href="/Microsoft.Azure.Batch/A.html#d1af4514aba652c3" class="i property">JobPreparationTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#1c4f375fc4e70293" class="i property">State</a>);
 
                                                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;&quot;</span>);
                                                });
 
                <span class="c">// waiting for the task to complete means so JobRelease is run.</span>
                <span class="r88 r">tsm</span>.<a href="/Microsoft.Azure.Batch/A.html#b5caf4dea114966b" class="i method">WaitAll</a>(
                    <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#b87926cb72ba1c69" class="i method">GetJob</a>(<span class="r66 r">jobId</span>).<a href="/Microsoft.Azure.Batch/A.html#b430aef69f3915ce" class="i method">ListTasks</a>(<span class="r93 r">additionalBehaviors</span>: <b>new</b>[] { <span class="r89 r">consoleSpammer</span> }),
                    <a href="/Microsoft.Azure.Batch/A.html#61427e025d3132b9" class="t t">TaskState</a>.<a href="/Microsoft.Azure.Batch/A.html#9dc78f8044c6f13b" class="i field">Completed</a>,
                    <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(120),
                    <span class="r54 r">additionalBehaviors</span>: <b>new</b>[] { <span class="r89 r">consoleSpammer</span> });
                
                <span class="c">// trigger JobRelease</span>
                <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#a3ab103e0510a330" class="i method">TerminateJob</a>(<span class="r66 r">jobId</span>, <span class="r94 r">terminateReason</span>: <span class="s">&quot;die! I want JobRelease to run!&quot;</span>);
 
                <span class="c">// now that the task has competed, we are racing with the JobRelease... but it is sleeping so we can can catch it</span>
                <b>while</b> (<b>true</b>)
                {
                    <a href="/Microsoft.Azure.Batch/A.html#e8b2b7d2634345fb" class="t t">ODATADetailLevel</a> <span id="r95 rd" class="r95 r">detailLevel</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#1442fdcd5a900cb9" class="t constructor">ODATADetailLevel</a>() { <a href="/Microsoft.Azure.Batch/A.html#320e51351a44e333" class="i property">FilterClause</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;nodeId eq &#39;{0}&#39;&quot;</span>, <span class="r75 r">victimComputeNodeRunningPrepAndRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#3601106c4cbb0f72" class="i property">Id</a>) };
                    <span class="r73 r">jobPrepStatusList</span> = <span class="r62 r">batchCli</span>.<a href="/Microsoft.Azure.Batch/A.html#1b81be84b4bbfd3b" class="i property">JobOperations</a>.<a href="/Microsoft.Azure.Batch/A.html#f9992e57128c3e50" class="i method">ListJobPreparationAndReleaseTaskStatus</a>(<span class="r66 r">jobId</span>, <span class="r83 r">detailLevel</span>: <span class="r95 r">detailLevel</span>).<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
                    <a href="/Microsoft.Azure.Batch/A.html#fe38a1e82a1c512b" class="t t">JobPreparationAndReleaseTaskExecutionInformation</a> <span id="r96 rd" class="r96 r">jrtei</span> = <span class="r73 r">jobPrepStatusList</span>.<a href="@0@System.Core/A.html#8087366974af11d2" class="i method">FirstOrDefault</a>();
 
                    <b>if</b> ((<span class="r96 r">jrtei</span> == <b>null</b>) || (<b>null</b> == <span class="r96 r">jrtei</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>))
                    {
                        <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(2000);
                    }
                    <b>else</b>
                    {
                        <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r96 r">jrtei</span>);
                        <b>if</b> (<span class="r96 r">jrtei</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#51fcd570e33aea6a" class="i property">State</a> != <a href="/Microsoft.Azure.Batch/A.html#29b972fbe5e14888" class="t t">JobReleaseTaskState</a>.<a href="/Microsoft.Azure.Batch/A.html#b7c96c09c4b552c1" class="i field">Completed</a>)
                        {
                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;JobReleaseTask state is: &quot;</span> + <span class="r96 r">jrtei</span>.<a href="/Microsoft.Azure.Batch/A.html#feb4a6cb12d41d97" class="i property">JobReleaseTaskExecutionInformation</a>.<a href="/Microsoft.Azure.Batch/A.html#51fcd570e33aea6a" class="i property">State</a>);
 
                            <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(5000);
                        }
                        <b>else</b>
                        {
                            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;JobRelease commpleted!&quot;</span>);
 
                            <span class="c">// we are done</span>
                            <b>break</b>;
                        }
                    }
                }
            }
        }
 
        <b>private static void</b> <a id="62c4701a20d2eb59" href="R/62c4701a20d2eb59.html" target="n" data-glyph="76,1" class="i method">AssertGoodJobPrepTaskOM</a>(<a href="/Microsoft.Azure.Batch/A.html#0deb1ca70552b381" class="t t">JobPreparationTask</a> <span id="r97 rd" class="r97 r">jobPrep</span>)
        {
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#9af4175a258edcae" class="i field">JobPrepCommandLine</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#be92858ef78ad46e" class="i property">CommandLine</a>);
 
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#38e94e7b3178dbda" class="i property">EnvironmentSettings</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(1, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#38e94e7b3178dbda" class="i property">EnvironmentSettings</a>.<a href="@0@mscorlib/A.html#3d6c21c4e9bd5f63" class="i property">Count</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#f6db495c90ac19f9" class="i field">JobPrepEnvSettingOM</a>.<a href="/Microsoft.Azure.Batch/A.html#a40d6ed84a859422" class="i property">Name</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#38e94e7b3178dbda" class="i property">EnvironmentSettings</a>[0].<a href="/Microsoft.Azure.Batch/A.html#a40d6ed84a859422" class="i property">Name</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#f6db495c90ac19f9" class="i field">JobPrepEnvSettingOM</a>.<a href="/Microsoft.Azure.Batch/A.html#21e188961a2e4292" class="i property">Value</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#38e94e7b3178dbda" class="i property">EnvironmentSettings</a>[0].<a href="/Microsoft.Azure.Batch/A.html#21e188961a2e4292" class="i property">Value</a>);
 
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#f0194430aab00964" class="i field">JobPrepId</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#e0bb2629373d681d" class="i property">Id</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#61b5489fa0578281" class="i field">JobPrepRerunOnComputeNodeRebootAfterSuccess</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#2ea0c28dcd7c1744" class="i property">RerunOnComputeNodeRebootAfterSuccess</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#2453a83381c4c02b" class="i field">JobPrepUserSpec</a>.<a href="/Microsoft.Azure.Batch/A.html#ca17bab085382f98" class="i property">ElevationLevel</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#a768bba277cc40aa" class="i property">UserIdentity</a>.<a href="/Microsoft.Azure.Batch/A.html#94e5dbbfc9e42dd0" class="i property">AutoUser</a>.<a href="/Microsoft.Azure.Batch/A.html#ca17bab085382f98" class="i property">ElevationLevel</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#2453a83381c4c02b" class="i field">JobPrepUserSpec</a>.<a href="/Microsoft.Azure.Batch/A.html#f5b980b5f3150503" class="i property">Scope</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#a768bba277cc40aa" class="i property">UserIdentity</a>.<a href="/Microsoft.Azure.Batch/A.html#94e5dbbfc9e42dd0" class="i property">AutoUser</a>.<a href="/Microsoft.Azure.Batch/A.html#f5b980b5f3150503" class="i property">Scope</a>);
 
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ad93bce9671b17c0" class="i field">JobPrepTaskConstraintsOM</a>.<a href="/Microsoft.Azure.Batch/A.html#5dc6fdff2b966843" class="i property">MaxTaskRetryCount</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#aaec841c7d671b82" class="i property">Constraints</a>.<a href="/Microsoft.Azure.Batch/A.html#5dc6fdff2b966843" class="i property">MaxTaskRetryCount</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ad93bce9671b17c0" class="i field">JobPrepTaskConstraintsOM</a>.<a href="/Microsoft.Azure.Batch/A.html#22394aba8879a3b9" class="i property">MaxWallClockTime</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#aaec841c7d671b82" class="i property">Constraints</a>.<a href="/Microsoft.Azure.Batch/A.html#22394aba8879a3b9" class="i property">MaxWallClockTime</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#ad93bce9671b17c0" class="i field">JobPrepTaskConstraintsOM</a>.<a href="/Microsoft.Azure.Batch/A.html#67a1bc35c2c6a7e0" class="i property">RetentionTime</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#aaec841c7d671b82" class="i property">Constraints</a>.<a href="/Microsoft.Azure.Batch/A.html#67a1bc35c2c6a7e0" class="i property">RetentionTime</a>);
 
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#09bb59746212bf7e" class="i field">JobPrepWaitForSuccessCreate</a>, <span class="r97 r">jobPrep</span>.<a href="/Microsoft.Azure.Batch/A.html#1fb31b6894240464" class="i property">WaitForSuccess</a>);
 
            <span class="c">// TODO:  assert on resourcefiles and contents therein</span>
        }
 
        <b>private static void</b> <a id="c6e43c7ba1f3cbbc" href="R/c6e43c7ba1f3cbbc.html" target="n" data-glyph="76,1" class="i method">AssertGoodJobReleaseTaskOM</a>(<a href="/Microsoft.Azure.Batch/A.html#6e57e67ad07386ca" class="t t">JobReleaseTask</a> <span id="r98 rd" class="r98 r">jobRelease</span>)
        {
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#daa1e81a82033149" class="i field">JobReleaseTaskCommandLine</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#84a1c155865fab61" class="i property">CommandLine</a>);
 
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#785dd2cd03686039" class="i property">EnvironmentSettings</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(1, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#785dd2cd03686039" class="i property">EnvironmentSettings</a>.<a href="@0@mscorlib/A.html#3d6c21c4e9bd5f63" class="i property">Count</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#0215ad27faf35144" class="i field">JobRelEnvSettingOM</a>.<a href="/Microsoft.Azure.Batch/A.html#a40d6ed84a859422" class="i property">Name</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#785dd2cd03686039" class="i property">EnvironmentSettings</a>[0].<a href="/Microsoft.Azure.Batch/A.html#a40d6ed84a859422" class="i property">Name</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#0215ad27faf35144" class="i field">JobRelEnvSettingOM</a>.<a href="/Microsoft.Azure.Batch/A.html#21e188961a2e4292" class="i property">Value</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#785dd2cd03686039" class="i property">EnvironmentSettings</a>[0].<a href="/Microsoft.Azure.Batch/A.html#21e188961a2e4292" class="i property">Value</a>);
 
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#cdc90c6364d13d29" class="i field">JobRelMaxWallClockTime</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#e87f942e34561e41" class="i property">MaxWallClockTime</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#443d29a65e2af4bb" class="i field">JobRelId</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#a210275440fefd8f" class="i property">Id</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#96c69b7ef09e375a" class="i field">JobRelRetentionTime</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#bb8678dd687aeffb" class="i property">RetentionTime</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#e55ec22b5297e510" class="i field">JobRelUserSpec</a>.<a href="/Microsoft.Azure.Batch/A.html#ca17bab085382f98" class="i property">ElevationLevel</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#43ddebf622181cdd" class="i property">UserIdentity</a>.<a href="/Microsoft.Azure.Batch/A.html#94e5dbbfc9e42dd0" class="i property">AutoUser</a>.<a href="/Microsoft.Azure.Batch/A.html#ca17bab085382f98" class="i property">ElevationLevel</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#e55ec22b5297e510" class="i field">JobRelUserSpec</a>.<a href="/Microsoft.Azure.Batch/A.html#f5b980b5f3150503" class="i property">Scope</a>, <span class="r98 r">jobRelease</span>.<a href="/Microsoft.Azure.Batch/A.html#43ddebf622181cdd" class="i property">UserIdentity</a>.<a href="/Microsoft.Azure.Batch/A.html#94e5dbbfc9e42dd0" class="i property">AutoUser</a>.<a href="/Microsoft.Azure.Batch/A.html#f5b980b5f3150503" class="i property">Scope</a>);
        }
 
        <b>private static void</b> <a id="f3d17a9402564077" href="R/f3d17a9402564077.html" target="n" data-glyph="76,1" class="i method">AssertGoodCommonEnvSettingsOM</a>(<a href="@0@mscorlib/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#86c40f0fcd35b717" class="t t">EnvironmentSetting</a>&gt; <span id="r99 rd" class="r99 r">jobCommonEnvSettings</span>)
        {
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(1, <span class="r99 r">jobCommonEnvSettings</span>.<a href="@0@mscorlib/A.html#3d6c21c4e9bd5f63" class="i property">Count</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#7fe73a8e71ec5eb5" class="i field">JobCommonEnvSettingOM</a>.<a href="/Microsoft.Azure.Batch/A.html#a40d6ed84a859422" class="i property">Name</a>, <span class="r99 r">jobCommonEnvSettings</span>[0].<a href="/Microsoft.Azure.Batch/A.html#a40d6ed84a859422" class="i property">Name</a>);
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<a href="#7fe73a8e71ec5eb5" class="i field">JobCommonEnvSettingOM</a>.<a href="/Microsoft.Azure.Batch/A.html#21e188961a2e4292" class="i property">Value</a>, <span class="r99 r">jobCommonEnvSettings</span>[0].<a href="/Microsoft.Azure.Batch/A.html#21e188961a2e4292" class="i property">Value</a>);
        }
 
        <b>private static void</b> <a id="f8eb9693b068e245" href="R/f8eb9693b068e245.html" target="n" data-glyph="76,1" class="i method">AssertGoodResourceFiles</a>(<a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt; <span id="r100 rd" class="r100 r">correctValues</span>, <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt; <span id="r101 rd" class="r101 r">unknownValues</span>)
        {
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r100 r">correctValues</span>);
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r101 r">unknownValues</span>);
 
            <a href="@0@mscorlib/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt; <span id="r102 rd" class="r102 r">correctIList</span> = <span class="r100 r">correctValues</span>.<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
            <a href="@0@mscorlib/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt; <span id="r103 rd" class="r103 r">unknownIList</span> = <span class="r101 r">unknownValues</span>.<a href="@0@System.Core/A.html#e276d6892241255b" class="i method">ToList</a>();
 
            <span class="c">//Assert.Equal(correctValues, unknownValues);</span>
 
            <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="r102 r">correctIList</span>.<a href="@0@mscorlib/A.html#3d6c21c4e9bd5f63" class="i property">Count</a>, <span class="r103 r">unknownIList</span>.<a href="@0@mscorlib/A.html#3d6c21c4e9bd5f63" class="i property">Count</a>);
 
            <b>for</b> (<b>int</b> <span id="r104 rd" class="r104 r">i</span> = 0; <span class="r104 r">i</span> &lt; <span class="r102 r">correctIList</span>.<a href="@0@mscorlib/A.html#3d6c21c4e9bd5f63" class="i property">Count</a>; <span class="r104 r">i</span>++)
            {
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="r102 r">correctIList</span><a href="@0@mscorlib/A.html#396bb785d31f5979">[</a><span class="r104 r">i</span>].<a href="/Microsoft.Azure.Batch/A.html#4dcb98a01982e047" class="i property">HttpUrl</a>, <span class="r103 r">unknownIList</span><a href="@0@mscorlib/A.html#396bb785d31f5979">[</a><span class="r104 r">i</span>].<a href="/Microsoft.Azure.Batch/A.html#4dcb98a01982e047" class="i property">HttpUrl</a>);
                <span class="t t">Assert</span>.<span class="i method">Equal</span>(<span class="r102 r">correctIList</span><a href="@0@mscorlib/A.html#396bb785d31f5979">[</a><span class="r104 r">i</span>].<a href="/Microsoft.Azure.Batch/A.html#8691f0768f7371cf" class="i property">FilePath</a>, <span class="r103 r">unknownIList</span><a href="@0@mscorlib/A.html#396bb785d31f5979">[</a><span class="r104 r">i</span>].<a href="/Microsoft.Azure.Batch/A.html#8691f0768f7371cf" class="i property">FilePath</a>);
            }
        }
 
        <b>private static string</b> <a id="1a56c240ec2b259d" href="R/1a56c240ec2b259d.html" target="n" data-glyph="76,1" class="i method">CraftTimeString</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r105 rd" class="r105 r">uniqueLetsHope</span> = <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#b0d5e4c9a8d4ddac" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#5088b43558351160" class="i method">ToString</a>(<span class="s">&quot;yyyy-MM-dd-HH-mm-ss-fff&quot;</span>);
 
            <b>return</b> <span class="r105 r">uniqueLetsHope</span>;
        }
 
 
        <span class="c">// an interceptor based call timer</span>
        <b>internal class</b> <a id="9d8d2a070d7f773f" href="R/9d8d2a070d7f773f.html" target="n" data-glyph="2,1" class="t t">CallTimerViaInterceptors</a>
        {
            <b>private readonly</b> <a href="@0@System/A.html#ceb0ba9cc88de82e" class="t t">Stopwatch</a> <a id="efffd7709fa02613" href="R/efffd7709fa02613.html" target="n" data-glyph="46,2" class="i field">stopwatch</a> = <b>new</b> <a href="@0@System/A.html#e0a8bcc83e66a717" class="t constructor">Stopwatch</a>();
 
            <b>internal</b> <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#0a5fcca20b641bf0" class="t t">RequestInterceptor</a> <a id="445bced83fb57e60" href="R/445bced83fb57e60.html" target="n" data-glyph="44,2" class="i field">ReqInterceptor</a>;
            <b>internal</b> <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#08ed0dc3de4b0fec" class="t t">ResponseInterceptor</a> <a id="299d24404b2a28a1" href="R/299d24404b2a28a1.html" target="n" data-glyph="44,2" class="i field">ResInterceptor</a>;
 
            <b>private void</b> <a id="76c228aa90243eb8" href="R/76c228aa90243eb8.html" target="n" data-glyph="76,2" class="i method">RequestInterceptHandler</a>(<span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#db591edc93adb428" class="t t">IBatchRequest</a> <span id="r106 rd" class="r106 r">request</span>)
            {
                <a href="#efffd7709fa02613" class="i field">stopwatch</a>.<a href="@0@System/A.html#e0ffb49b2a24b579" class="i method">Reset</a>();
                <a href="#efffd7709fa02613" class="i field">stopwatch</a>.<a href="@0@System/A.html#f56fda03f3c59486" class="i method">Start</a>();
            }
 
            <b>private</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#0e56d021396907c5" class="t t">IAzureOperationResponse</a>&gt; <a id="a5f369c8f457de1c" href="R/a5f369c8f457de1c.html" target="n" data-glyph="76,2" class="i method">ResponseInterceptHandler</a>(<a href="/Microsoft.Rest.ClientRuntime.Azure/A.html#0e56d021396907c5" class="t t">IAzureOperationResponse</a> <span id="r107 rd" class="r107 r">response</span>, <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#db591edc93adb428" class="t t">IBatchRequest</a> <span id="r108 rd" class="r108 r">request</span>)
            {
                <a href="#efffd7709fa02613" class="i field">stopwatch</a>.<a href="@0@System/A.html#9dd6cac7fc1e2117" class="i method">Stop</a>();
 
                <b>return</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#11a386e7d7cae64a" class="i method">FromResult</a>(<span class="r107 r">response</span>);
            }
 
            <b>internal</b> <a id="2c5e55306954536c" href="R/2c5e55306954536c.html" target="n" data-glyph="74,2" class="t constructor">CallTimerViaInterceptors</a>()
            {
                <a href="#445bced83fb57e60" class="i field">ReqInterceptor</a> = <b>new</b> <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#20b6019ccd20581f" class="t constructor">RequestInterceptor</a>(<a href="#76c228aa90243eb8" class="i method">RequestInterceptHandler</a>);
                <a href="#299d24404b2a28a1" class="i field">ResInterceptor</a> = <b>new</b> <span class="i n">Protocol</span>.<a href="/Microsoft.Azure.Batch/A.html#184ef1277c7ab78d" class="t constructor">ResponseInterceptor</a>(<a href="#a5f369c8f457de1c" class="i method">ResponseInterceptHandler</a>);
            }
        }
 
        <b>private static</b> <a href="@0@mscorlib/A.html#b19f71a84062554b" class="t t">IList</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#2b9679370e5dc8dd" class="t t">ResourceFile</a>&gt; <a id="456dfeeaf6d8ae1b" href="R/456dfeeaf6d8ae1b.html" target="n" data-glyph="76,1" class="i method">UploadFilesMakeResFiles</a>(<a href="IntegrationTestUtilities/FileUploadUtilities.cs.html#3b9275d3afe2c09e" class="t t">StagingStorageAccount</a> <span id="r109 rd" class="r109 r">stagingCreds</span>)
        {
            <span class="c">// use a dummy task to stage fsome files and generate resource files</span>
            <a href="/Microsoft.Azure.Batch/A.html#eeca8189f6dd1bc1" class="t t">CloudTask</a> <span id="r110 rd" class="r110 r">myTask</span> = <b>new</b> <a href="/Microsoft.Azure.Batch/A.html#9feffc4561b02162" class="t constructor">CloudTask</a>(<span class="r111 r">id</span>: <span class="s">&quot;CountWordsTask&quot;</span>, <span class="r112 r">commandline</span>: <span class="s">@&quot;cmd /c dir /s .. &amp; dir &amp; type localwords.txt&quot;</span>);
 
            <span class="c">// first we have local files that we want pushed to the compute node before the commandline is invoked</span>
            <a href="IntegrationTestUtilities/FileUploadUtilities.cs.html#d0ef0c77ff91fc4c" class="t t">FileToStage</a> <span id="r113 rd" class="r113 r">wordsDotText</span> = <b>new</b> <a href="IntegrationTestUtilities/FileUploadUtilities.cs.html#1c8ee6606b53dcc2" class="t constructor">FileToStage</a>(<a href="TestResources/Resources.cs.html#abf405f1afad448e" class="t t">Resources</a>.<a href="TestResources/Resources.cs.html#31c1d866dc2faf39" class="i field">LocalWordsDotText</a>, <span class="r109 r">stagingCreds</span>);                <span class="c">// use &quot;default&quot; mapping to base name of local file</span>
 
            <span class="c">// add in the files to stage</span>
            <span class="r110 r">myTask</span>.<a href="/Microsoft.Azure.Batch/A.html#d624cff35ee00815" class="i property">FilesToStage</a> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="/Microsoft.Azure.Batch/A.html#a1e33437d516696b" class="t t">IFileStagingProvider</a>&gt;
            {
                <span class="r113 r">wordsDotText</span>
            };
 
            <span class="c">// trigger file staging</span>
            <span class="r110 r">myTask</span>.<a href="/Microsoft.Azure.Batch/A.html#7212433b08bb24ff" class="i method">StageFiles</a>();
 
            <span class="c">// return the resolved resource files</span>
            <b>return</b> <span class="r110 r">myTask</span>.<a href="/Microsoft.Azure.Batch/A.html#b42e5eabd845ed9f" class="i property">ResourceFiles</a>;
        }
 
        <b>private void</b> <a id="a82e152a9b05285b" href="R/a82e152a9b05285b.html" target="n" data-glyph="76,1" class="i method">OutputFailureInfo</a>(<a href="/Microsoft.Azure.Batch/A.html#6a8a3cc1ed20a0d0" class="t t">TaskFailureInformation</a> <span id="r114 rd" class="r114 r">failureInfo</span>)
        {
            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;JP Failure Info:&quot;</span>);
            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;    category: &quot;</span> + <span class="r114 r">failureInfo</span>.<a href="/Microsoft.Azure.Batch/A.html#8342aff60ef729f9" class="i property">Category</a>);
            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;    code: &quot;</span> + <span class="r114 r">failureInfo</span>.<a href="/Microsoft.Azure.Batch/A.html#fa0de020a358c8c5" class="i property">Code</a>);
            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;    details:&quot;</span> + (<b>null</b> == <span class="r114 r">failureInfo</span>.<a href="/Microsoft.Azure.Batch/A.html#80c237b60d0b2275" class="i property">Details</a> ? <span class="s">&quot; &lt;null&gt;&quot;</span> : <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>));
 
            <b>if</b> (<b>null</b> != <span class="r114 r">failureInfo</span>.<a href="/Microsoft.Azure.Batch/A.html#80c237b60d0b2275" class="i property">Details</a>)
            {
                <b>foreach</b> (<a href="/Microsoft.Azure.Batch/A.html#a03271979c0242a7" class="t t">NameValuePair</a> <span id="r115 rd" class="r115 r">curDetail</span> <b>in</b> <span class="r114 r">failureInfo</span>.<a href="/Microsoft.Azure.Batch/A.html#80c237b60d0b2275" class="i property">Details</a>)
                {
                    <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;        name: &quot;</span> + <span class="r115 r">curDetail</span>.<a href="/Microsoft.Azure.Batch/A.html#751cc211b2e62203" class="i property">Name</a> + <span class="s">&quot;, value: &quot;</span> + <span class="r115 r">curDetail</span>.<a href="/Microsoft.Azure.Batch/A.html#cf967c20e938c4f7" class="i property">Value</a>);
                }
            }
 
            <a href="#64e7188906e7341e" class="i field">testOutputHelper</a>.<span class="i method">WriteLine</span>(<span class="s">&quot;    message: &quot;</span> + <span class="r114 r">failureInfo</span>.<a href="/Microsoft.Azure.Batch/A.html#9f08fecdcf293c87" class="i property">Message</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
