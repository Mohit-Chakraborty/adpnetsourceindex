<!DOCTYPE html>
<html><head><title>EventHubOptions.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(319);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.EventHubs/Config/EventHubOptions.cs" target="_top">Config\EventHubOptions.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.EventHubs" target="_top">src\Microsoft.Azure.WebJobs.Extensions.EventHubs.csproj</a> (Microsoft.Azure.WebJobs.Extensions.EventHubs)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) .NET Foundation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Globalization</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Text</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Consumer</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Primitives</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Messaging</span>.<span class="i n">EventHubs</span>.<span class="i n">Producer</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">EventHubs</span>.<span class="i n">Processor</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i">Hosting</span>;
<b>using</b> <span class="i">Newtonsoft</span>.<span class="i">Json</span>;
<b>using</b> <span class="i">Newtonsoft</span>.<span class="i">Json</span>.<span class="i">Linq</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">EventHubs</span>
{
    <b>public class</b> <a id="9d2c8806e713ed80" href="../R/9d2c8806e713ed80.html" target="n" data-glyph="0,0" class="t t">EventHubOptions</a> : <span class="i">IOptionsFormatter</span>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Name of the blob container that the EventHostProcessor instances uses to coordinate load balancing listening on an event hub.</span>
        <span class="c">///</span><span class="c"> Each event hub gets its own blob prefix within the container.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public const string</b> <a id="8f5a08f7111f43ba" href="../R/8f5a08f7111f43ba.html" target="n" data-glyph="6,1" class="i field">LeaseContainerName</a> = <span class="s">&quot;azure-webjobs-eventhub&quot;</span>;
 
        <b>public</b> <a id="29ea629a70818781" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">EventHubOptions</a>()
        {
            <a href="#eb970121bee9f2a2" class="i property">MaxBatchSize</a> = 10;
            <a href="#ada1fc0110c4be6d" class="i property">InvokeProcessorAfterReceiveTimeout</a> = <b>false</b>;
            <a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a> = <b>new</b> <span class="t">EventProcessorOptions</span>()
            {
                <a href="/Azure.Messaging.EventHubs/A.html#de96937c4bdb5883" class="i property">TrackLastEnqueuedEventProperties</a> = <b>false</b>,
                <a href="/Azure.Messaging.EventHubs/A.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a> = <span class="i">TimeSpan</span>.<span class="i">FromMinutes</span>(1),
                <a href="/Azure.Messaging.EventHubs/A.html#d7f12816f1250e29" class="i property">PrefetchCount</a> = 300,
                <span class="i">DefaultStartingPosition</span> = <a href="/Azure.Messaging.EventHubs/A.html#97742fa7b7b6b68f" class="t t">EventPosition</a>.<a href="/Azure.Messaging.EventHubs/A.html#b013e57545f70f5a" class="i property">Earliest</a>,
            };
            <a href="#4361ee45f736f8f1" class="i property">InitialOffsetOptions</a> = <b>new</b> <span class="t">InitialOffsetOptions</span>();
        }
 
        <b>public</b> <a href="/Azure.Messaging.EventHubs/A.html#ff5042f1902a1c50" class="t t">EventProcessorOptions</a> <a id="9d37c6ccff406c24" href="../R/9d37c6ccff406c24.html" target="n" data-glyph="102,1" class="i property">EventProcessorOptions</a> { <b>get</b>; }
 
        <b>private int</b> <a id="868e968550677dae" href="../R/868e968550677dae.html" target="n" data-glyph="46,1" class="i field">_batchCheckpointFrequency</a> = 1;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the number of batches to process before creating an EventHub cursor checkpoint. Default 1.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public int</b> <a id="7c54aa1e6877edde" href="../R/7c54aa1e6877edde.html" target="n" data-glyph="102,1" class="i property">BatchCheckpointFrequency</a>
        {
            <b>get</b> =&gt; <a href="#868e968550677dae" class="i field">_batchCheckpointFrequency</a>;
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> &lt;= 0)
                {
                    <b>throw</b> <b>new</b> <span class="i">InvalidOperationException</span>(<span class="s">&quot;Batch checkpoint frequency must be larger than 0.&quot;</span>);
                }
                <a href="#868e968550677dae" class="i field">_batchCheckpointFrequency</a> = <b>value</b>;
            }
        }
 
        <b>private int</b> <a id="a06ce3130e340ada" href="../R/a06ce3130e340ada.html" target="n" data-glyph="46,1" class="i field">_maxBatchSize</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the maximum number of events delivered in a batch. Default 10.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public int</b> <a id="eb970121bee9f2a2" href="../R/eb970121bee9f2a2.html" target="n" data-glyph="102,1" class="i property">MaxBatchSize</a>
        {
            <b>get</b> =&gt; <a href="#a06ce3130e340ada" class="i field">_maxBatchSize</a>;
 
            <b>set</b>
            {
                <b>if</b> (<b>value</b> &lt; 1)
                {
                    <b>throw</b> <b>new</b> <span class="i">ArgumentException</span>(<span class="s">&quot;Batch size must be larger than 0.&quot;</span>);
                }
                <a href="#a06ce3130e340ada" class="i field">_maxBatchSize</a> = <b>value</b>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Returns whether the function would be triggered when a receive timeout occurs.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="ada1fc0110c4be6d" href="../R/ada1fc0110c4be6d.html" target="n" data-glyph="102,1" class="i property">InvokeProcessorAfterReceiveTimeout</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets the initial offset options to apply when processing. This only applies</span>
        <span class="c">///</span><span class="c"> when no checkpoint information is available.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public</b> <a href="InitialOffsetOptions.cs.html#f23845b1265f539e" class="t t">InitialOffsetOptions</a> <a id="4361ee45f736f8f1" href="../R/4361ee45f736f8f1.html" target="n" data-glyph="102,1" class="i property">InitialOffsetOptions</a> { <b>get</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets the Azure Blobs container name that the event processor uses to coordinate load balancing listening on an event hub.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal string</b> <a id="810deb26038bc9d9" href="../R/810deb26038bc9d9.html" target="n" data-glyph="104,1" class="i property">CheckpointContainer</a> { <b>get</b>; <b>set</b>; } = <a href="#8f5a08f7111f43ba" class="i field">LeaseContainerName</a>;
 
        <b>internal</b> <span class="i">Action</span>&lt;<a href="../Processor/ExceptionReceivedEventArgs.cs.html#2101d683bffd4066" class="t t">ExceptionReceivedEventArgs</a>&gt; <a id="448496507ac4b123" href="../R/448496507ac4b123.html" target="n" data-glyph="104,1" class="i property">ExceptionHandler</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">// Event Hub Names are case-insensitive.</span>
        <span class="c">// The same path can have multiple connection strings with different permissions (sending and receiving),</span>
        <span class="c">// so we track senders and receivers separately and infer which one to use based on the EventHub (sender) vs. EventHubTrigger (receiver) attribute.</span>
        <span class="c">// Connection strings may also encapsulate different endpoints.</span>
        <b>internal</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="/Azure.Messaging.EventHubs/A.html#b7beffbdf44e79fc" class="t t">EventHubProducerClient</a>&gt; <a id="131ab14e763c2453" href="../R/131ab14e763c2453.html" target="n" data-glyph="104,1" class="i property">RegisteredProducers</a> { <b>get</b>; } = <b>new</b> ();
        <b>internal</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#6964b429ba6b6db0" class="t t">ReceiverCredentials</a>&gt; <a id="b99cee7dcdfe4998" href="../R/b99cee7dcdfe4998.html" target="n" data-glyph="104,1" class="i property">RegisteredConsumerCredentials</a> { <b>get</b>; } = <b>new</b> ();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add an existing client for sending messages to an event hub.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">name of the event hub</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">client</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="532a57991b41baad" href="../R/532a57991b41baad.html" target="n" data-glyph="74,1" class="i method">AddEventHubProducerClient</a>(<b>string</b> <span id="r0 rd" class="r0 r">eventHubName</span>, <a href="/Azure.Messaging.EventHubs/A.html#b7beffbdf44e79fc" class="t t">EventHubProducerClient</a> <span id="r1 rd" class="r1 r">client</span>)
        {
            <b>if</b> (<span class="r0 r">eventHubName</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r0 r">eventHubName</span>));
            }
            <b>if</b> (<span class="r1 r">client</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r1 r">client</span>));
            }
 
            <a href="#131ab14e763c2453" class="i property">RegisteredProducers</a>[<span class="r0 r">eventHubName</span>] = <span class="r1 r">client</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a connection for sending messages to an event hub. Connect via the connection string.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">name of the event hub. </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">sendConnectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">connection string for sending messages. If this includes an EntityPath, it takes precedence over the eventHubName parameter.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="62fe5c7079b268de" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddSender</a>(<b>string</b> <span id="r2 rd" class="r2 r">eventHubName</span>, <b>string</b> <span id="r3 rd" class="r3 r">sendConnectionString</span>)
        {
            <b>if</b> (<span class="r2 r">eventHubName</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r2 r">eventHubName</span>));
            }
            <b>if</b> (<span class="r3 r">sendConnectionString</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r3 r">sendConnectionString</span>));
            }
 
            <a href="/Azure.Messaging.EventHubs/A.html#b7beffbdf44e79fc" class="k">var</a> <span id="r4 rd" class="r4 r">client</span> = <b>new</b> <span class="t">EventHubProducerClient</span>(<a href="EventHubClientFactory.cs.html#083b120ed67a8314" class="t t">EventHubClientFactory</a>.<a href="EventHubClientFactory.cs.html#ba93cdb66155f562" class="i method">NormalizeConnectionString</a>(<span class="r3 r">sendConnectionString</span>, <span class="r2 r">eventHubName</span>));
            <a href="#532a57991b41baad" class="i method">AddEventHubProducerClient</a>(<span class="r2 r">eventHubName</span>, <span class="r4 r">client</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a connection for listening on events from an event hub. Connect via the connection string and use the SDK&#39;s built-in storage account.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">name of the event hub</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">receiverConnectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">connection string for receiving messages. This can encapsulate other service bus properties like the namespace and endpoints.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="819cf24feb07be3b" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddReceiver</a>(<b>string</b> <span id="r5 rd" class="r5 r">eventHubName</span>, <b>string</b> <span id="r6 rd" class="r6 r">receiverConnectionString</span>)
        {
            <b>if</b> (<span class="r5 r">eventHubName</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r5 r">eventHubName</span>));
            }
            <b>if</b> (<span class="r6 r">receiverConnectionString</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r6 r">receiverConnectionString</span>));
            }
 
            <a href="#b99cee7dcdfe4998" class="i property">RegisteredConsumerCredentials</a>[<span class="r5 r">eventHubName</span>] = <b>new</b> <span class="t">ReceiverCredentials</span>
            {
                <a href="#78c0965b8b98e390" class="i property">EventHubConnectionString</a> = <span class="r6 r">receiverConnectionString</span>
            };
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add a connection for listening on events from an event hub. Connect via the connection string and use the supplied storage account</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">name of the event hub</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">receiverConnectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">connection string for receiving messages</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">storageConnectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">storage connection string that the EventProcessorHost client will use to coordinate multiple listener instances. </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="82ea7f57c23a0d6b" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AddReceiver</a>(<b>string</b> <span id="r7 rd" class="r7 r">eventHubName</span>, <b>string</b> <span id="r8 rd" class="r8 r">receiverConnectionString</span>, <b>string</b> <span id="r9 rd" class="r9 r">storageConnectionString</span>)
        {
            <b>if</b> (<span class="r7 r">eventHubName</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r7 r">eventHubName</span>));
            }
            <b>if</b> (<span class="r8 r">receiverConnectionString</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r8 r">receiverConnectionString</span>));
            }
            <b>if</b> (<span class="r9 r">storageConnectionString</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r9 r">storageConnectionString</span>));
            }
 
            <a href="#b99cee7dcdfe4998" class="i property">RegisteredConsumerCredentials</a>[<span class="r7 r">eventHubName</span>] = <b>new</b> <span class="t">ReceiverCredentials</span>
            {
                <a href="#78c0965b8b98e390" class="i property">EventHubConnectionString</a> = <span class="r8 r">receiverConnectionString</span>,
                <a href="#8c47ac5b1ff097ea" class="i property">StorageConnectionString</a> = <span class="r9 r">storageConnectionString</span>
            };
        }
 
        <b>private static string</b> <a id="cc323d06c1d6e370" href="../R/cc323d06c1d6e370.html" target="n" data-glyph="76,1" class="i method">EscapeStorageCharacter</a>(<b>char</b> <span id="r10 rd" class="r10 r">character</span>)
        {
            <b>var</b> <span id="r11 rd" class="r11 r">ordinalValue</span> = (<b>ushort</b>)<span class="r10 r">character</span>;
            <b>if</b> (<span class="r11 r">ordinalValue</span> &lt; 0x100)
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;:{0:X2}&quot;</span>, <span class="r11 r">ordinalValue</span>);
            }
            <b>else</b>
            {
                <b>return</b> <b>string</b>.<span class="i">Format</span>(<span class="i">CultureInfo</span>.<span class="i">InvariantCulture</span>, <span class="s">&quot;::{0:X4}&quot;</span>, <span class="r11 r">ordinalValue</span>);
            }
        }
 
        <span class="c">// Escape a blob path.</span>
        <span class="c">// For diagnostics, we want human-readble strings that resemble the input.</span>
        <span class="c">// Inputs are most commonly alphanumeric with a fex extra chars (dash, underscore, dot).</span>
        <span class="c">// Escape character is a &#39;:&#39;, which is also escaped.</span>
        <span class="c">// Blob names are case sensitive; whereas input is case insensitive, so normalize to lower.</span>
        <b>private static string</b> <a id="0cb24b1df5db18be" href="../R/0cb24b1df5db18be.html" target="n" data-glyph="76,1" class="i method">EscapeBlobPath</a>(<b>string</b> <span id="r12 rd" class="r12 r">path</span>)
        {
            <span class="i">StringBuilder</span> <span id="r13 rd" class="r13 r">sb</span> = <b>new</b> <span class="i">StringBuilder</span>(<span class="r12 r">path</span>.<span class="i">Length</span>);
            <b>foreach</b> (<b>char</b> <span id="r14 rd" class="r14 r">c</span> <b>in</b> <span class="r12 r">path</span>)
            {
                <b>if</b> (<span class="r14 r">c</span> &gt;= <span class="s">&#39;a&#39;</span> &amp;&amp; <span class="r14 r">c</span> &lt;= <span class="s">&#39;z&#39;</span>)
                {
                    <span class="r13 r">sb</span>.<span class="i">Append</span>(<span class="r14 r">c</span>);
                }
                <b>else</b> <b>if</b> (<span class="r14 r">c</span> == <span class="s">&#39;-&#39;</span> || <span class="r14 r">c</span> == <span class="s">&#39;_&#39;</span> || <span class="r14 r">c</span> == <span class="s">&#39;.&#39;</span>)
                {
                    <span class="c">// Potentially common carahcters.</span>
                    <span class="r13 r">sb</span>.<span class="i">Append</span>(<span class="r14 r">c</span>);
                }
                <b>else</b> <b>if</b> (<span class="r14 r">c</span> &gt;= <span class="s">&#39;A&#39;</span> &amp;&amp; <span class="r14 r">c</span> &lt;= <span class="s">&#39;Z&#39;</span>)
                {
                    <span class="r13 r">sb</span>.<span class="i">Append</span>((<b>char</b>)(<span class="r14 r">c</span> - <span class="s">&#39;A&#39;</span> + <span class="s">&#39;a&#39;</span>)); <span class="c">// ToLower</span>
                }
                <b>else</b> <b>if</b> (<span class="r14 r">c</span> &gt;= <span class="s">&#39;0&#39;</span> &amp;&amp; <span class="r14 r">c</span> &lt;= <span class="s">&#39;9&#39;</span>)
                {
                    <span class="r13 r">sb</span>.<span class="i">Append</span>(<span class="r14 r">c</span>);
                }
                <b>else</b>
                {
                    <span class="r13 r">sb</span>.<span class="i">Append</span>(<a href="#cc323d06c1d6e370" class="i method">EscapeStorageCharacter</a>(<span class="r14 r">c</span>));
                }
            }
 
            <b>return</b> <span class="r13 r">sb</span>.<span class="i">ToString</span>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get the blob prefix used with EventProcessorHost for a given event hub.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">eventHubName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">the event hub path</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r16 r">serviceBusNamespace</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">the event hub&#39;s service bus namespace.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">a blob prefix path that can be passed to EventProcessorHost.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">remarks</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An event hub is defined by it&#39;s path and namespace. The namespace is extracted from the connection string.</span>
        <span class="c">///</span><span class="c"> This must be an injective one-to-one function because:</span>
        <span class="c">///</span><span class="c"> 1. multiple machines listening on the same event hub must use the same blob prefix. This means it must be deterministic.</span>
        <span class="c">///</span><span class="c"> 2. different event hubs must not resolve to the same path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">remarks</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="72da8389430279e7" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetBlobPrefix</a>(<b>string</b> <span id="r15 rd" class="r15 r">eventHubName</span>, <b>string</b> <span id="r16 rd" class="r16 r">serviceBusNamespace</span>)
        {
            <b>if</b> (<span class="r15 r">eventHubName</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r15 r">eventHubName</span>));
            }
            <b>if</b> (<span class="r16 r">serviceBusNamespace</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <span class="i">ArgumentNullException</span>(<b>nameof</b>(<span class="r16 r">serviceBusNamespace</span>));
            }
 
            <b>string</b> <span id="r17 rd" class="r17 r">key</span> = <a href="#0cb24b1df5db18be" class="i method">EscapeBlobPath</a>(<span class="r16 r">serviceBusNamespace</span>) + <span class="s">&quot;/&quot;</span> + <a href="#0cb24b1df5db18be" class="i method">EscapeBlobPath</a>(<span class="r15 r">eventHubName</span>) + <span class="s">&quot;/&quot;</span>;
            <b>return</b> <span class="r17 r">key</span>;
        }
 
        <b>public string</b> <a id="2cccccb5ce5423fc" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Format</a>()
        {
            <span class="i">JObject</span> <span id="r18 rd" class="r18 r">eventProcessorOptions</span> = <b>null</b>;
            <b>if</b> (<a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a> != <b>null</b>)
            {
                <span class="r18 r">eventProcessorOptions</span> = <b>new</b> <span class="i">JObject</span>
                {
                    { <b>nameof</b>(<a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#de96937c4bdb5883" class="i property">TrackLastEnqueuedEventProperties</a>), <a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#de96937c4bdb5883" class="i property">TrackLastEnqueuedEventProperties</a> },
                    { <b>nameof</b>(<a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#d7f12816f1250e29" class="i property">PrefetchCount</a>), <a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#d7f12816f1250e29" class="i property">PrefetchCount</a> },
                    { <b>nameof</b>(<a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a>), <a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#0a82497014b9abb1" class="i property">MaximumWaitTime</a> },
                    { <b>nameof</b>(<a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f9c560e2baa1fef3" class="i property">PartitionOwnershipExpirationInterval</a>), <a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#f9c560e2baa1fef3" class="i property">PartitionOwnershipExpirationInterval</a> },
                    { <b>nameof</b>(<a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#683a6b0c2592ec66" class="i property">LoadBalancingUpdateInterval</a>), <a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>.<a href="/Azure.Messaging.EventHubs/A.html#683a6b0c2592ec66" class="i property">LoadBalancingUpdateInterval</a> },
                };
            }
 
            <span class="i">JObject</span> <span id="r19 rd" class="r19 r">initialOffsetOptions</span> = <b>null</b>;
            <b>if</b> (<a href="#4361ee45f736f8f1" class="i property">InitialOffsetOptions</a> != <b>null</b>)
            {
                <span class="r19 r">initialOffsetOptions</span> = <b>new</b> <span class="i">JObject</span>
                {
                    { <b>nameof</b>(<a href="#4361ee45f736f8f1" class="i property">InitialOffsetOptions</a>.<a href="InitialOffsetOptions.cs.html#e56d7688620ddba7" class="i property">Type</a>), <a href="#4361ee45f736f8f1" class="i property">InitialOffsetOptions</a>.<a href="InitialOffsetOptions.cs.html#e56d7688620ddba7" class="i property">Type</a> },
                    { <b>nameof</b>(<a href="#4361ee45f736f8f1" class="i property">InitialOffsetOptions</a>.<a href="InitialOffsetOptions.cs.html#2979b7dba76d395b" class="i property">EnqueuedTimeUTC</a>), <a href="#4361ee45f736f8f1" class="i property">InitialOffsetOptions</a>.<a href="InitialOffsetOptions.cs.html#2979b7dba76d395b" class="i property">EnqueuedTimeUTC</a> },
                };
            }
 
            <span class="i">JObject</span> <span id="r20 rd" class="r20 r">options</span> = <b>new</b> <span class="i">JObject</span>
            {
                { <b>nameof</b>(<a href="#eb970121bee9f2a2" class="i property">MaxBatchSize</a>), <a href="#eb970121bee9f2a2" class="i property">MaxBatchSize</a> },
                { <b>nameof</b>(<a href="#ada1fc0110c4be6d" class="i property">InvokeProcessorAfterReceiveTimeout</a>), <a href="#ada1fc0110c4be6d" class="i property">InvokeProcessorAfterReceiveTimeout</a> },
                { <b>nameof</b>(<a href="#7c54aa1e6877edde" class="i property">BatchCheckpointFrequency</a>), <a href="#7c54aa1e6877edde" class="i property">BatchCheckpointFrequency</a> },
                { <b>nameof</b>(<a href="#9d37c6ccff406c24" class="i property">EventProcessorOptions</a>), <span class="r18 r">eventProcessorOptions</span> },
                { <b>nameof</b>(<a href="#4361ee45f736f8f1" class="i property">InitialOffsetOptions</a>), <span class="r19 r">initialOffsetOptions</span> }
            };
 
            <b>return</b> <span class="r20 r">options</span>.<span class="i">ToString</span>(<span class="i">Formatting</span>.<span class="i">Indented</span>);
        }
 
        <span class="c">// Hold credentials for a given eventHub name.</span>
        <span class="c">// Multiple consumer groups (and multiple listeners) on the same hub can share the same credentials.</span>
        <b>internal class</b> <a id="6964b429ba6b6db0" href="../R/6964b429ba6b6db0.html" target="n" data-glyph="2,1" class="t t"><span id="3c8654f70d8bdd55">ReceiverCredentials</span></a>
        {
            <span class="c">// Required.</span>
            <b>public string</b> <a id="78c0965b8b98e390" href="../R/78c0965b8b98e390.html" target="n" data-glyph="102,2" class="i property">EventHubConnectionString</a> { <b>get</b>; <b>set</b>; }
 
            <span class="c">// Optional. If not found, use the stroage from JobHostConfiguration</span>
            <b>public string</b> <a id="8c47ac5b1ff097ea" href="../R/8c47ac5b1ff097ea.html" target="n" data-glyph="102,2" class="i property">StorageConnectionString</a> { <b>get</b>; <b>set</b>; }
        }
    }
}
</pre></td></tr></table></div></body></html>
