<!DOCTYPE html>
<html><head><title>CallingServerLiveTestBase.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(403);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Communication.CallingServer.Tests/Infrastructure/CallingServerLiveTestBase.cs" target="_top">Infrastructure\CallingServerLiveTestBase.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/communication/Azure.Communication.CallingServer/tests/Infrastructure/CallingServerLiveTestBase.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Communication.CallingServer.Tests" target="_top">Azure.Communication.CallingServer.Tests.csproj</a> (Azure.Communication.CallingServer.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Communication</span>.<span class="i n">Identity</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Communication</span>.<span class="i n">CallingServer</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="5389b11fee447c5d" href="../R/5389b11fee447c5d.html" target="n" data-glyph="0,0" class="t t">CallingServerLiveTestBase</a> : <a href="/Azure.Core.TestFramework/A.html#2d2d9cc2c3882f17" class="t t">RecordedTestBase</a>&lt;<a href="CallingServerTestEnvironment.cs.html#926aa09ccbe8a102" class="t t">CallingServerTestEnvironment</a>&gt;
    {
        <span class="c">// Random Gen Guid</span>
        <b>protected const string</b> <a id="67a28c92760c20a3" href="../R/67a28c92760c20a3.html" target="n" data-glyph="9,1" class="i field">FROM_USER_IDENTIFIER</a> = <a href="../../GuidAssembly/R/e3560385-776f-41d1-bf04-07ef738f2f23.html" target="n" class="s">&quot;e3560385-776f-41d1-bf04-07ef738f2f23&quot;</a>;
 
        <span class="c">// Random Gen Guid</span>
        <b>protected const string</b> <a id="daf8db5458585d22" href="../R/daf8db5458585d22.html" target="n" data-glyph="9,1" class="i field">TO_USER_IDENTIFIER</a> = <a href="../../GuidAssembly/R/e3560385-776f-41d1-bf04-07ef738f2fc1.html" target="n" class="s">&quot;e3560385-776f-41d1-bf04-07ef738f2fc1&quot;</a>;
 
        <span class="c">// From ACS Resource &quot;immutableResourceId&quot;.</span>
        <b>protected const string</b> <a id="56863721e5ba9421" href="../R/56863721e5ba9421.html" target="n" data-glyph="9,1" class="i field">RESOURCE_IDENTIFIER</a> = <a href="../../GuidAssembly/R/016a7064-0581-40b9-be73-6dde64d69d72.html" target="n" class="s">&quot;016a7064-0581-40b9-be73-6dde64d69d72&quot;</a>;
 
        <span class="c">// Random Gen Guid</span>
        <b>protected const string</b> <a id="65ca7eda3b357af7" href="../R/65ca7eda3b357af7.html" target="n" data-glyph="9,1" class="i field">GROUP_IDENTIFIER</a> = <a href="../../GuidAssembly/R/3500789f-e11b-4ceb-85cb-bc8df2a01768.html" target="n" class="s">&quot;3500789f-e11b-4ceb-85cb-bc8df2a01768&quot;</a>;
 
        <b>protected string</b> <a id="2830d3757ed249c9" href="../R/2830d3757ed249c9.html" target="n" data-glyph="75,1" class="i method">GetResourceId</a>()
        {
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#6de2da8c848daf8b" class="i field">Live</a>)
            {
                <b>return</b> <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#7c664c26b4b30a10" class="i property">ResourceIdentifier</a>;
            }
            <b>return</b> <a href="#56863721e5ba9421" class="i field">RESOURCE_IDENTIFIER</a>;
        }
 
        <b>protected string</b> <a id="a898be262502079b" href="../R/a898be262502079b.html" target="n" data-glyph="75,1" class="i method">GetRandomUserId</a>()
        {
            <b>return</b> <span class="s">&quot;8:acs:&quot;</span> + <a href="#2830d3757ed249c9" class="i method">GetResourceId</a>() + <span class="s">&quot;_&quot;</span> + <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
        }
 
        <b>protected string</b> <a id="b3acbda7e84b196e" href="../R/b3acbda7e84b196e.html" target="n" data-glyph="75,1" class="i method">GetFixedUserId</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">userGuid</span>)
        {
            <b>return</b> <span class="s">&quot;8:acs:&quot;</span> + <a href="#2830d3757ed249c9" class="i method">GetResourceId</a>() + <span class="s">&quot;_&quot;</span> + <span class="r0 r">userGuid</span>;
        }
 
        <b>protected string</b> <a id="a5ea4acc6097835f" href="../R/a5ea4acc6097835f.html" target="n" data-glyph="75,1" class="i method">GetFromUserId</a>()
        {
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#6de2da8c848daf8b" class="i field">Live</a>)
            {
                <b>return</b> <a href="#a898be262502079b" class="i method">GetRandomUserId</a>();
            }
            <b>return</b> <a href="#b3acbda7e84b196e" class="i method">GetFixedUserId</a>(<a href="#67a28c92760c20a3" class="i field">FROM_USER_IDENTIFIER</a>);
        }
 
        <b>protected string</b> <a id="a862d7b12800f493" href="../R/a862d7b12800f493.html" target="n" data-glyph="75,1" class="i method">GetToUserId</a>()
        {
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#6de2da8c848daf8b" class="i field">Live</a>)
            {
                <b>return</b> <a href="#a898be262502079b" class="i method">GetRandomUserId</a>();
            }
            <b>return</b> <a href="#b3acbda7e84b196e" class="i method">GetFixedUserId</a>(<a href="#daf8db5458585d22" class="i field">TO_USER_IDENTIFIER</a>);
        }
 
        <b>protected string</b> <a id="86ed14b1afe1a155" href="../R/86ed14b1afe1a155.html" target="n" data-glyph="75,1" class="i method">GetGroupId</a>()
        {
            <span class="c">/**</span>
             <span class="c">*</span><span class="c"> If tests are running in live mode, we want them to all</span>
             <span class="c">*</span><span class="c"> have unique groupId&#39;s so they do not conflict with other</span>
             <span class="c">*</span><span class="c"> recording tests running in live mode.</span>
             <span class="c">*/</span>
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#6de2da8c848daf8b" class="i field">Live</a>)
            {
                <b>return</b> <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            }
 
            <span class="c">/**</span>
             <span class="c">*</span><span class="c"> For recording tests we need to make sure the groupId</span>
             <span class="c">*</span><span class="c"> matches the recorded groupId, or the call will fail.</span>
             <span class="c">*/</span>
            <b>return</b> <a href="#65ca7eda3b357af7" class="i field">GROUP_IDENTIFIER</a>;
        }
 
        <b>public</b> <a id="5cd537cdd11796fc" href="../R/5cd537cdd11796fc.html" target="n" data-glyph="72,1" class="t constructor">CallingServerLiveTestBase</a>(<b>bool</b> <span id="r1 rd" class="r1 r">isAsync</span>) : <a href="/Azure.Core.TestFramework/A.html#0697801b8bd5bedb" class="k">base</a>(<span class="r1 r">isAsync</span>)
            =&gt; <a href="/Azure.Core.TestFramework/A.html#2800a862b6d5bdce" class="i property">Sanitizer</a> = <b>new</b> <a href="CallingServerRecordedTestSanitizer.cs.html#74b112ea94aac0e9" class="t constructor">CallingServerRecordedTestSanitizer</a>();
 
        <b>public bool</b> <a id="d770a28d17622438" href="../R/d770a28d17622438.html" target="n" data-glyph="102,1" class="i property">SkipCallingServerInteractionLiveTests</a>
            =&gt; <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="/Azure.Core.TestFramework/A.html#1454744fa3bc6218" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#6de2da8c848daf8b" class="i field">Live</a> &amp;&amp; <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;SKIP_CALLINGSERVER_INTERACTION_LIVE_TESTS&quot;</span>) == <span class="s">&quot;TRUE&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Communication.Identity/A.html#34cfd954a8ba7f75" class="t t">CommunicationIdentityClient</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c"> with the connectionstring via environment</span>
        <span class="c">///</span><span class="c"> variables and instruments it to make use of the Azure Core Test Framework functionalities.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The instrumented </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Communication.Identity/A.html#34cfd954a8ba7f75" class="t t">CommunicationIdentityClient</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected</b> <a href="/Azure.Communication.Identity/A.html#34cfd954a8ba7f75" class="t t">CommunicationIdentityClient</a> <a id="9b7a9b726a4280f4" href="../R/9b7a9b726a4280f4.html" target="n" data-glyph="75,1" class="i method">CreateInstrumentedCommunicationIdentityClient</a>()
            =&gt; <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(
                <b>new</b> <a href="/Azure.Communication.Identity/A.html#4fda106aa83b2ed9" class="t constructor">CommunicationIdentityClient</a>(
                    <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="/Azure.Communication.Common.Tests/A.html#73aa0b3ac6f7fa66" class="i property">LiveTestStaticConnectionString</a>,
                    <a href="/Azure.Core.TestFramework/A.html#ab5a62dcc84b8f3e" class="i method">InstrumentClientOptions</a>(<b>new</b> <a href="/Azure.Communication.Identity/A.html#8f26cbb46bdad8eb" class="t constructor">CommunicationIdentityClientOptions</a>(<a href="/Azure.Communication.Identity/A.html#a930d9c0ca2de12e" class="t t">CommunicationIdentityClientOptions</a>.<a href="/Azure.Communication.Identity/A.html#4ec0462cff91b7dc" class="t t">ServiceVersion</a>.<a href="/Azure.Communication.Identity/A.html#61e28c7d782c3792" class="i field">V2021_03_07</a>))));
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Communication.CallingServer/A.html#9f943c4e2b6174ec" class="t t">CallingServerClient</a><span class="c">&quot;</span> <span class="c">/&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The instrumented </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="/Azure.Communication.CallingServer/A.html#9f943c4e2b6174ec" class="t t">CallingServerClient</a><span class="c">&quot;</span> <span class="c">/&gt;</span><span class="c">.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>protected</b> <a href="/Azure.Communication.CallingServer/A.html#9f943c4e2b6174ec" class="t t">CallingServerClient</a> <a id="8d8b28e4d0c4fc29" href="../R/8d8b28e4d0c4fc29.html" target="n" data-glyph="75,1" class="i method">CreateInstrumentedCallingServerClient</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r2 rd" class="r2 r">connectionString</span> = <a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="/Azure.Communication.Common.Tests/A.html#73aa0b3ac6f7fa66" class="i property">LiveTestStaticConnectionString</a>;
            <a href="/Azure.Communication.CallingServer/A.html#9f943c4e2b6174ec" class="t t">CallingServerClient</a> <span id="r3 rd" class="r3 r">callingServerClient</span> = <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#9e0713f2c0dcab63" class="t constructor">CallingServerClient</a>(<span class="r2 r">connectionString</span>, <a href="#c0c59c7543bb737e" class="i method">CreateServerCallingClientOptionsWithCorrelationVectorLogs</a>());
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_Samples_CreateServerCallingClient
            <span class="c">//@@var connectionString = &quot;&lt;connection_string&gt;&quot;; // Find your Communication Services resource in the Azure portal</span>
            <span class="c">//@@CallingServerClient callingServerClient = new CallingServerClient(connectionString);</span>
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_Samples_CreateServerCallingClient
 
            <b>return</b> <a href="/Azure.Core.TestFramework/A.html#11829fdeef1b6d51" class="i method">InstrumentClient</a>(<span class="r3 r">callingServerClient</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Api operation functions
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_CreateGroupCallOperation
        <b>internal async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a>&gt;&gt; <a id="c039e1b44a697b3d" href="../R/c039e1b44a697b3d.html" target="n" data-glyph="74,1" class="i method">CreateGroupCallOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#9f943c4e2b6174ec" class="t t">CallingServerClient</a> <span id="r4 rd" class="r4 r">callingServerClient</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">groupId</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">from</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">to</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">callBackUri</span>)
        {
            <a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a>? <span id="r9 rd" class="r9 r">fromCallConnection</span> = <b>null</b>;
            <a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a>? <span id="r10 rd" class="r10 r">toCallConnection</span> = <b>null</b>;
 
            <b>try</b>
            {
                <a href="/Azure.Communication.Common/A.html#bf4167177e5a0f24" class="t t">CommunicationIdentifier</a> <span id="r11 rd" class="r11 r">fromParticipant</span> = <b>new</b> <a href="/Azure.Communication.Common/A.html#3f018c0cfc695658" class="t constructor">CommunicationUserIdentifier</a>(<span class="r6 r">from</span>);
                <a href="/Azure.Communication.Common/A.html#bf4167177e5a0f24" class="t t">CommunicationIdentifier</a> <span id="r12 rd" class="r12 r">toParticipant</span> = <b>new</b> <a href="/Azure.Communication.Common/A.html#3f018c0cfc695658" class="t constructor">CommunicationUserIdentifier</a>(<span class="r7 r">to</span>);
 
                <a href="/Azure.Communication.CallingServer/A.html#d7fc582ef4858b3d" class="t t">JoinCallOptions</a> <span id="r13 rd" class="r13 r">fromCallOptions</span> = <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#220b67135a647ff8" class="t constructor">JoinCallOptions</a>(
                    <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r8 r">callBackUri</span>),
                    <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#c7cbdf27d7e8f5b0" class="t t">MediaType</a>[] { <a href="/Azure.Communication.CallingServer/A.html#c7cbdf27d7e8f5b0" class="t t">MediaType</a>.<a href="/Azure.Communication.CallingServer/A.html#36d63003a0b5142b" class="i property">Audio</a> },
                    <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#4de570215bf03118" class="t t">EventSubscriptionType</a>[] { <a href="/Azure.Communication.CallingServer/A.html#4de570215bf03118" class="t t">EventSubscriptionType</a>.<a href="/Azure.Communication.CallingServer/A.html#4d0a46e007cd1e84" class="i property">ParticipantsUpdated</a> });
                <span class="r9 r">fromCallConnection</span> = <b>await</b> <span class="r4 r">callingServerClient</span>.<a href="/Azure.Communication.CallingServer/A.html#fe992740108f99af" class="i method">JoinCallAsync</a>(<span class="r5 r">groupId</span>, <span class="r11 r">fromParticipant</span>, <span class="r13 r">fromCallOptions</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="#cd9d40e3fca07b96" class="i method">SleepInTest</a>(1000);
                <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r9 r">fromCallConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#2aad017960f8d98e" class="i property">CallConnectionId</a>));
 
                <a href="/Azure.Communication.CallingServer/A.html#d7fc582ef4858b3d" class="t t">JoinCallOptions</a> <span id="r14 rd" class="r14 r">joinCallOptions</span> = <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#220b67135a647ff8" class="t constructor">JoinCallOptions</a>(
                    <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r8 r">callBackUri</span>),
                    <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#c7cbdf27d7e8f5b0" class="t t">MediaType</a>[] { <a href="/Azure.Communication.CallingServer/A.html#c7cbdf27d7e8f5b0" class="t t">MediaType</a>.<a href="/Azure.Communication.CallingServer/A.html#36d63003a0b5142b" class="i property">Audio</a> },
                    <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#4de570215bf03118" class="t t">EventSubscriptionType</a>[] { <a href="/Azure.Communication.CallingServer/A.html#4de570215bf03118" class="t t">EventSubscriptionType</a>.<a href="/Azure.Communication.CallingServer/A.html#4d0a46e007cd1e84" class="i property">ParticipantsUpdated</a>});
 
                <span class="r10 r">toCallConnection</span> = <b>await</b> <span class="r4 r">callingServerClient</span>.<a href="/Azure.Communication.CallingServer/A.html#fe992740108f99af" class="i method">JoinCallAsync</a>(<span class="r5 r">groupId</span>, <span class="r12 r">toParticipant</span>, <span class="r14 r">joinCallOptions</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="#cd9d40e3fca07b96" class="i method">SleepInTest</a>(1000);
                <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r10 r">toCallConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#2aad017960f8d98e" class="i property">CallConnectionId</a>));
 
                <b>return</b> <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a>[] { <span class="r9 r">fromCallConnection</span>, <span class="r10 r">toCallConnection</span> };
            }
            <b>catch</b> (<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a> <span id="r15 rd" class="r15 r">ex</span>)
            {
                <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="r15 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                <span class="t t">Assert</span>.<span class="i method">Fail</span>(<span class="s">$&quot;</span><span class="s">Unexpected error: </span>{<span class="r15 r">ex</span>}<span class="s">&quot;</span>);
                <b>throw</b>;
            }
            <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r16 rd" class="r16 r">ex</span>)
            {
                <span class="t t">Assert</span>.<span class="i method">Fail</span>(<span class="s">$&quot;</span><span class="s">Unexpected error: </span>{<span class="r16 r">ex</span>}<span class="s">&quot;</span>);
 
                <b>if</b> (<span class="r9 r">fromCallConnection</span> != <b>null</b>)
                {
                    <b>await</b> <span class="r9 r">fromCallConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#18c9d6caa5edbe73" class="i method">HangupAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
 
                <b>if</b> (<span class="r10 r">toCallConnection</span> != <b>null</b>)
                {
                    <b>await</b> <span class="r10 r">toCallConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#18c9d6caa5edbe73" class="i method">HangupAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                }
                <b>throw</b>;
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_CreateGroupCallOperation
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_CreateCallConnectionOperation
        <b>internal async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a>&gt;&gt; <a id="fd33b46ed832ec94" href="../R/fd33b46ed832ec94.html" target="n" data-glyph="74,1" class="i method">CreateCallConnectionOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#9f943c4e2b6174ec" class="t t">CallingServerClient</a> <span id="r17 rd" class="r17 r">client</span>)
        {
            <a href="/Azure.Communication.Identity/A.html#34cfd954a8ba7f75" class="t t">CommunicationIdentityClient</a> <span id="r18 rd" class="r18 r">communicationIdentityClient</span> = <a href="#9b7a9b726a4280f4" class="i method">CreateInstrumentedCommunicationIdentityClient</a>();
            <a href="/Azure.Communication.Common/A.html#fc9b614c8e272747" class="k">var</a> <span id="r19 rd" class="r19 r">source</span> = <b>await</b> <a href="#3ea6d4eee8261d56" class="i method">CreateUserAsync</a>(<span class="r18 r">communicationIdentityClient</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <b>var</b> <span id="r20 rd" class="r20 r">targets</span> = <b>new</b>[] { <b>new</b> <a href="/Azure.Communication.Common/A.html#7f5e8789e46bab4d" class="t constructor">PhoneNumberIdentifier</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#d47a09a2c3af1651" class="i property">TargetPhoneNumber</a>) };
            <a href="/Azure.Communication.CallingServer/A.html#0f3f14d4f2c826ce" class="k">var</a> <span id="r21 rd" class="r21 r">createCallOption</span> = <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#b92add00a3e5a3f7" class="t constructor">CreateCallOptions</a>(
                   <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#1444079159850b8a" class="i property">AppCallbackUrl</a>),
                   <b>new</b>[] { <a href="/Azure.Communication.CallingServer/A.html#c7cbdf27d7e8f5b0" class="t t">MediaType</a>.<a href="/Azure.Communication.CallingServer/A.html#36d63003a0b5142b" class="i property">Audio</a> },
                   <b>new</b>[] { <a href="/Azure.Communication.CallingServer/A.html#4de570215bf03118" class="t t">EventSubscriptionType</a>.<a href="/Azure.Communication.CallingServer/A.html#4d0a46e007cd1e84" class="i property">ParticipantsUpdated</a>, <a href="/Azure.Communication.CallingServer/A.html#4de570215bf03118" class="t t">EventSubscriptionType</a>.<a href="/Azure.Communication.CallingServer/A.html#de968d85c17a25d7" class="i property">DtmfReceived</a> });
            <span class="r21 r">createCallOption</span>.<a href="/Azure.Communication.CallingServer/A.html#8384924cdbd0f85d" class="i property">AlternateCallerId</a> = <b>new</b> <a href="/Azure.Communication.Common/A.html#7f5e8789e46bab4d" class="t constructor">PhoneNumberIdentifier</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#99ea0684bbc7fb08" class="i property">SourcePhoneNumber</a>);
 
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing CreateCall operation&quot;</span>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r22 rd" class="r22 r">callConnection</span> = <b>await</b> <span class="r17 r">client</span>.<a href="/Azure.Communication.CallingServer/A.html#04bebf76bb3105e9" class="i method">CreateCallConnectionAsync</a>(<span class="r23 r">source</span>: <span class="r19 r">source</span>, <span class="r24 r">targets</span>: <span class="r20 r">targets</span>, <span class="r25 r">options</span>: <span class="r21 r">createCallOption</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#406b854997305c45" class="i method">WriteLine</a>(<span class="s">&quot;Call initiated with Call connection id: {0}&quot;</span>, <span class="r22 r">callConnection</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#2aad017960f8d98e" class="i property">CallConnectionId</a>);
 
            <span class="t t">Assert</span>.<span class="i method">IsFalse</span>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#55e241b6143365ef" class="i method">IsNullOrWhiteSpace</a>(<span class="r22 r">callConnection</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#2aad017960f8d98e" class="i property">CallConnectionId</a>));
            <b>return</b> <span class="r22 r">callConnection</span>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_CreateCallConnectionOperation
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_PlayAudioOperation
        <b>internal async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="acb5755dbe41a3b2" href="../R/acb5755dbe41a3b2.html" target="n" data-glyph="74,1" class="i method">PlayAudioOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a> <span id="r26 rd" class="r26 r">callConnection</span>)
        {
            <a href="/Azure.Communication.CallingServer/A.html#63506de1f54eff46" class="k">var</a> <span id="r27 rd" class="r27 r">playAudioOptions</span> = <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#25069bc8c957d743" class="t constructor">PlayAudioOptions</a>()
            {
                <a href="/Azure.Communication.CallingServer/A.html#3f0f6aa5dcd46e66" class="i property">AudioFileUri</a> = <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#0bf7284548c62e6e" class="i property">AudioFileUrl</a>),
                <a href="/Azure.Communication.CallingServer/A.html#2177ab81e4fe4dfe" class="i property">OperationContext</a> = <a href="../../GuidAssembly/R/de346f03-7f8d-41ab-a232-cc5e14990769.html" target="n" class="s">&quot;de346f03-7f8d-41ab-a232-cc5e14990769&quot;</a>,
                <a href="/Azure.Communication.CallingServer/A.html#124de717994b3dfe" class="i property">Loop</a> = <b>false</b>,
                <a href="/Azure.Communication.CallingServer/A.html#44ac20a74cec5a24" class="i property">AudioFileId</a> = <a href="../../GuidAssembly/R/ebb1d98d-fd86-4204-800c-f7bdfc2e515c.html" target="n" class="s">&quot;ebb1d98d-fd86-4204-800c-f7bdfc2e515c&quot;</a>
            };
 
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing PlayAudio operation&quot;</span>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r28 rd" class="r28 r">response</span> = <b>await</b> <span class="r26 r">callConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#19166b9d4e0465bc" class="i method">PlayAudioAsync</a>(<span class="r27 r">playAudioOptions</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r28 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#a33b7c143095ea75" class="i property">Status</a>, <a href="/Azure.Communication.CallingServer/A.html#d60d6b4f6215407c" class="t t">OperationStatus</a>.<a href="/Azure.Communication.CallingServer/A.html#28905fc43f9de730" class="i property">Running</a>);
        }
 
        <b>internal async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="29a4ea653748c6c5" href="../R/29a4ea653748c6c5.html" target="n" data-glyph="74,1" class="i method">PlayAudioOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#16dd536c1c1303dd" class="t t">ServerCall</a> <span id="r29 rd" class="r29 r">serverCall</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing PlayAudio operation&quot;</span>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r30 rd" class="r30 r">response</span> = <b>await</b> <span class="r29 r">serverCall</span>.<a href="/Azure.Communication.CallingServer/A.html#c1a0337d0f341f6d" class="i method">PlayAudioAsync</a>(
                <span class="r31 r">audioFileUri</span>: <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#0bf7284548c62e6e" class="i property">AudioFileUrl</a>),
                <span class="r32 r">audioFileId</span>: <a href="../../GuidAssembly/R/ebb1d98d-fd86-4204-800c-f7bdfc2e515c.html" target="n" class="s">&quot;ebb1d98d-fd86-4204-800c-f7bdfc2e515c&quot;</a>,
                <span class="r33 r">callbackUri</span>: <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#1444079159850b8a" class="i property">AppCallbackUrl</a>),
                <span class="r34 r">operationContext</span>: <a href="../../GuidAssembly/R/de346f03-7f8d-41ab-a232-cc5e14990769.html" target="n" class="s">&quot;de346f03-7f8d-41ab-a232-cc5e14990769&quot;</a>
                ).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r30 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#a33b7c143095ea75" class="i property">Status</a>, <a href="/Azure.Communication.CallingServer/A.html#d60d6b4f6215407c" class="t t">OperationStatus</a>.<a href="/Azure.Communication.CallingServer/A.html#28905fc43f9de730" class="i property">Running</a>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_PlayAudioOperation
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_HangupCallOperation
        <b>internal async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="eb94d3cb2b241007" href="../R/eb94d3cb2b241007.html" target="n" data-glyph="74,1" class="i method">HangupOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a> <span id="r35 rd" class="r35 r">callConnection</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing Hangup operation&quot;</span>);
 
            <a href="/Azure.Core/A.html#ad97b1910f5ca3eb" class="k">var</a> <span id="r36 rd" class="r36 r">response</span> = <b>await</b> <span class="r35 r">callConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#18c9d6caa5edbe73" class="i method">HangupAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(202, <span class="r36 r">response</span>.<a href="/Azure.Core/A.html#53e6401c580f9719" class="i property">Status</a>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_HangupCallOperation
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_CancelMediaOperationsOperation
        <b>internal async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="30a22ba35dc86bbb" href="../R/30a22ba35dc86bbb.html" target="n" data-glyph="74,1" class="i method">CancelAllMediaOperationsOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a> <span id="r37 rd" class="r37 r">callConnection</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing cancel media processing operation to stop playing audio&quot;</span>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r38 rd" class="r38 r">response</span> = <b>await</b> <span class="r37 r">callConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#776aef1c900f36f8" class="i method">CancelAllMediaOperationsAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Communication.CallingServer/A.html#d60d6b4f6215407c" class="t t">OperationStatus</a>.<a href="/Azure.Communication.CallingServer/A.html#0d7acf74d52dfad9" class="i property">Completed</a>, <span class="r38 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#a17c07ec2ac894a5" class="i property">Status</a>);
        }
 
        <b>internal async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5aceec19c3528260" href="../R/5aceec19c3528260.html" target="n" data-glyph="74,1" class="i method">CancelAllMediaOperationsOperation</a>(<a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a>&gt; <span id="r39 rd" class="r39 r">callConnections</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing cancel media processing operation to stop playing audio&quot;</span>);
 
            <b>if</b> (<span class="r39 r">callConnections</span> == <b>null</b>)
            {
                <b>return</b>;
            }
            <b>foreach</b> (<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a> <span id="r40 rd" class="r40 r">callConnection</span> <b>in</b> <span class="r39 r">callConnections</span>)
            {
                <b>if</b> (<span class="r40 r">callConnection</span> != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r41 rd" class="r41 r">response</span> = <b>await</b> <span class="r40 r">callConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#776aef1c900f36f8" class="i method">CancelAllMediaOperationsAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                        <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="/Azure.Communication.CallingServer/A.html#d60d6b4f6215407c" class="t t">OperationStatus</a>.<a href="/Azure.Communication.CallingServer/A.html#0d7acf74d52dfad9" class="i property">Completed</a>, <span class="r41 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#a17c07ec2ac894a5" class="i property">Status</a>);
                    }
                    <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r42 rd" class="r42 r">ex</span>)
                    {
                        <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Error hanging up: &quot;</span> + <span class="r42 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                    }
                }
            }
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_CancelMediaOperationsOperation
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_AddParticipantOperation
        <b>internal async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="e26d2b1d2265e893" href="../R/e26d2b1d2265e893.html" target="n" data-glyph="74,1" class="i method">AddParticipantOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a> <span id="r43 rd" class="r43 r">callConnection</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing add participant operation to add a participant&quot;</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r44 rd" class="r44 r">invitedUser</span> = <a href="#b3acbda7e84b196e" class="i method">GetFixedUserId</a>(<a href="../../GuidAssembly/R/0000000a-b200-7a0d-570c-113a0d00288d.html" target="n" class="s">&quot;0000000a-b200-7a0d-570c-113a0d00288d&quot;</a>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r45 rd" class="r45 r">response</span> = <b>await</b> <span class="r43 r">callConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#d8e530a6cc5fd225" class="i method">AddParticipantAsync</a>(<b>new</b> <a href="/Azure.Communication.Common/A.html#3f018c0cfc695658" class="t constructor">CommunicationUserIdentifier</a>(<span class="r44 r">invitedUser</span>)).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<b>false</b>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r45 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#60e43d657ffc218e" class="i property">ParticipantId</a>));
 
            <b>return</b> <span class="r45 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#60e43d657ffc218e" class="i property">ParticipantId</a>;
        }
 
        <b>internal async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="4f46aa2231b1efd2" href="../R/4f46aa2231b1efd2.html" target="n" data-glyph="74,1" class="i method">AddParticipantOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#16dd536c1c1303dd" class="t t">ServerCall</a> <span id="r46 rd" class="r46 r">serverCall</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing add participant operation to add a participant&quot;</span>);
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r47 rd" class="r47 r">invitedUser</span> = <a href="#b3acbda7e84b196e" class="i method">GetFixedUserId</a>(<a href="../../GuidAssembly/R/0000000a-b200-7a0d-570c-113a0d00288d.html" target="n" class="s">&quot;0000000a-b200-7a0d-570c-113a0d00288d&quot;</a>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="k">var</a> <span id="r48 rd" class="r48 r">response</span> = <b>await</b> <span class="r46 r">serverCall</span>.<a href="/Azure.Communication.CallingServer/A.html#6547a44d904ea370" class="i method">AddParticipantAsync</a>(
                <b>new</b> <a href="/Azure.Communication.Common/A.html#3f018c0cfc695658" class="t constructor">CommunicationUserIdentifier</a>(<span class="r47 r">invitedUser</span>),
                <span class="r49 r">callbackUri</span>: <b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="CallingServerTestEnvironment.cs.html#1444079159850b8a" class="i property">AppCallbackUrl</a>)
                ).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<b>false</b>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r48 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#60e43d657ffc218e" class="i property">ParticipantId</a>));
 
            <b>return</b> <span class="r48 r">response</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="/Azure.Communication.CallingServer/A.html#60e43d657ffc218e" class="i property">ParticipantId</a>;
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_AddParticipantOperation
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Azure_Communication_ServerCalling_Tests_RemoveParticipantOperation
        <b>internal async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="16184511c72c527c" href="../R/16184511c72c527c.html" target="n" data-glyph="74,1" class="i method">RemoveParticipantOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a> <span id="r50 rd" class="r50 r">callConnection</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r51 rd" class="r51 r">participantId</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing remove participant operation to remove a participant&quot;</span>);
 
            <a href="/Azure.Core/A.html#ad97b1910f5ca3eb" class="k">var</a> <span id="r52 rd" class="r52 r">response</span> = <b>await</b> <span class="r50 r">callConnection</span>.<a href="/Azure.Communication.CallingServer/A.html#5def11bc89292021" class="i method">RemoveParticipantAsync</a>(<span class="r51 r">participantId</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(202, <span class="r52 r">response</span>.<a href="/Azure.Core/A.html#53e6401c580f9719" class="i property">Status</a>);
        }
 
        <b>internal async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="2519393c00ff223b" href="../R/2519393c00ff223b.html" target="n" data-glyph="74,1" class="i method">RemoveParticipantOperation</a>(<a href="/Azure.Communication.CallingServer/A.html#16dd536c1c1303dd" class="t t">ServerCall</a> <span id="r53 rd" class="r53 r">serverCall</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r54 rd" class="r54 r">participantId</span>)
        {
            <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Performing remove participant operation to remove a participant&quot;</span>);
 
            <a href="/Azure.Core/A.html#ad97b1910f5ca3eb" class="k">var</a> <span id="r55 rd" class="r55 r">response</span> = <b>await</b> <span class="r53 r">serverCall</span>.<a href="/Azure.Communication.CallingServer/A.html#8cdf983310c6cac2" class="i method">RemoveParticipantAsync</a>(<span class="r54 r">participantId</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(202, <span class="r55 r">response</span>.<a href="/Azure.Core/A.html#53e6401c580f9719" class="i property">Status</a>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Snippet:Azure_Communication_ServerCalling_Tests_RemoveParticipantOperation
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Api operation functions
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Support functions
        <b>private</b> <a href="/Azure.Communication.Common/A.html#fc9b614c8e272747" class="t t">CommunicationUserIdentifier</a> <a id="d58b2c8b3d2c05ec" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">CreateUser</a>(<a href="/Azure.Communication.Identity/A.html#34cfd954a8ba7f75" class="t t">CommunicationIdentityClient</a> <span id="r56 rd" class="r56 r">communicationIdentityClient</span>)
        {
            <span class="c">// reserve for living test, expect adding more content in the future.</span>
            <b>return</b> <span class="r56 r">communicationIdentityClient</span>.<a href="/Azure.Communication.Identity/A.html#7e2b99028c66d450" class="i method">CreateUser</a>();
        }
 
        <b>private async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Azure.Communication.Common/A.html#fc9b614c8e272747" class="t t">CommunicationUserIdentifier</a>&gt; <a id="3ea6d4eee8261d56" href="../R/3ea6d4eee8261d56.html" target="n" data-glyph="76,1" class="i method">CreateUserAsync</a>(<a href="/Azure.Communication.Identity/A.html#34cfd954a8ba7f75" class="t t">CommunicationIdentityClient</a> <span id="r57 rd" class="r57 r">communicationIdentityClient</span>)
        {
            <span class="c">// reserve for living test, expect adding more content in the future.</span>
            <b>return</b> <b>await</b> <span class="r57 r">communicationIdentityClient</span>.<a href="/Azure.Communication.Identity/A.html#104281511bf7438a" class="i method">CreateUserAsync</a>();
        }
 
        <b>protected async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="d643c780a7633e45" href="../R/d643c780a7633e45.html" target="n" data-glyph="75,1" class="i method">CleanUpConnectionsAsync</a>(<a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a>&gt; <span id="r58 rd" class="r58 r">connections</span>)
        {
            <b>if</b> (<span class="r58 r">connections</span> == <b>null</b>)
            {
                <b>return</b>;
            }
            <b>foreach</b> (<a href="/Azure.Communication.CallingServer/A.html#7bda1a5661076940" class="t t">CallConnection</a> <span id="r59 rd" class="r59 r">connection</span> <b>in</b> <span class="r58 r">connections</span>)
            {
                <b>if</b> (<span class="r59 r">connection</span> != <b>null</b>)
                {
                    <b>try</b>
                    {
                        <b>await</b> <span class="r59 r">connection</span>.<a href="/Azure.Communication.CallingServer/A.html#18c9d6caa5edbe73" class="i method">HangupAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                    }
                    <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r60 rd" class="r60 r">ex</span>)
                    {
                        <a href="@0@mscorlib/A.html#f907d79481da6ba4" class="t t">Console</a>.<a href="@0@mscorlib/A.html#5ac7c4fda643413b" class="i method">WriteLine</a>(<span class="s">&quot;Error hanging up: &quot;</span> + <span class="r60 r">ex</span>.<a href="@0@mscorlib/A.html#5fba0e16215b42a3" class="i property">Message</a>);
                    }
                }
            }
        }
 
        <b>protected async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="ef93d3976d895e4e" href="../R/ef93d3976d895e4e.html" target="n" data-glyph="75,1" class="i method">SleepIfNotInPlaybackModeAsync</a>(<b>int</b> <span id="r61 rd" class="r61 r">milliSeconds</span> = 10000)
        {
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>.<a href="/Azure.Core.TestFramework/A.html#1454744fa3bc6218" class="i property">Mode</a> != <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>)
                <b>await</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#34b191a243434f6a" class="i method">Delay</a>(10000);
        }
 
        <b>protected void</b> <a id="cd9d40e3fca07b96" href="../R/cd9d40e3fca07b96.html" target="n" data-glyph="75,1" class="i method">SleepInTest</a>(<b>int</b> <span id="r62 rd" class="r62 r">milliSeconds</span>)
        {
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>)
                <b>return</b>;
            <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#5f1072b92dae1dd8" class="i method">Sleep</a>(<span class="r62 r">milliSeconds</span>);
        }
 
        <b>protected async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="31dcd15546c7b9cb" href="../R/31dcd15546c7b9cb.html" target="n" data-glyph="75,1" class="i method">ValidateCallRecordingStateAsync</a>(<a href="/Azure.Communication.CallingServer/A.html#16dd536c1c1303dd" class="t t">ServerCall</a> <span id="r63 rd" class="r63 r">serverCall</span>,
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r64 rd" class="r64 r">recordingId</span>,
            <a href="/Azure.Communication.CallingServer/A.html#d37eaf152781bf57" class="t t">CallRecordingState</a> <span id="r65 rd" class="r65 r">expectedCallRecordingState</span>)
        {
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r63 r">serverCall</span>);
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r64 r">recordingId</span>);
 
            <span class="c">// There is a delay between the action and when the state is available.</span>
            <span class="c">// Waiting to make sure we get the updated state, when we are running</span>
            <span class="c">// against a live service.</span>
            <a href="#cd9d40e3fca07b96" class="i method">SleepInTest</a>(6000);
 
            <a href="/Azure.Communication.CallingServer/A.html#54439f30e1d0dbba" class="t t">CallRecordingProperties</a> <span id="r66 rd" class="r66 r">callRecordingProperties</span> = <b>await</b> <span class="r63 r">serverCall</span>.<a href="/Azure.Communication.CallingServer/A.html#e427084a878726d0" class="i method">GetRecordingStateAsync</a>(<span class="r64 r">recordingId</span>).<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r66 r">callRecordingProperties</span>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r66 r">callRecordingProperties</span>.<a href="/Azure.Communication.CallingServer/A.html#7c45924e85998c10" class="i property">RecordingState</a>, <span class="r65 r">expectedCallRecordingState</span>);
        }
 
        <b>private</b> <a href="/Azure.Communication.CallingServer/A.html#d48c19dde6b25271" class="t t">CallingServerClientOptions</a> <a id="c0c59c7543bb737e" href="../R/c0c59c7543bb737e.html" target="n" data-glyph="76,1" class="i method">CreateServerCallingClientOptionsWithCorrelationVectorLogs</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#d48c19dde6b25271" class="t t">CallingServerClientOptions</a> <span id="r67 rd" class="r67 r">callClientOptions</span> = <b>new</b> <a href="/Azure.Communication.CallingServer/A.html#edabb0db7b5fe0af" class="t constructor">CallingServerClientOptions</a>();
            <span class="r67 r">callClientOptions</span>.<a href="/Azure.Core/A.html#474c2d6954521438" class="i property">Diagnostics</a>.<a href="/Azure.Core/A.html#64ba7f8037ee5e72" class="i property">LoggedHeaderNames</a>.<a href="@0@mscorlib/A.html#a9319db8c62ae453" class="i method">Add</a>(<span class="s">&quot;MS-CV&quot;</span>);
            <b>return</b> <a href="/Azure.Core.TestFramework/A.html#ab5a62dcc84b8f3e" class="i method">InstrumentClientOptions</a>(<span class="r67 r">callClientOptions</span>);
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span> Support functions
    }
}
</pre></td></tr></table></div></body></html>
