<!DOCTYPE html>
<html><head><title>ContentDownloadTests.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(236);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Communication.CallingServer.Tests/ConversationClients/ContentDownloadTests.cs" target="_top">ConversationClients\ContentDownloadTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/communication/Azure.Communication.CallingServer/tests/ConversationClients/ContentDownloadTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Communication.CallingServer.Tests" target="_top">Azure.Communication.CallingServer.Tests.csproj</a> (Azure.Communication.CallingServer.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">Json</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Communication</span>.<span class="i n">CallingServer</span>.<span class="i n">Tests</span>.<span class="i n">ConversationClients</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Communication</span>.<span class="i n">CallingServer</span>.<span class="i n">Tests</span>.<span class="i n">ContentDownloadTests</span>
{
    <b>public class</b> <a id="ca7051a27241b479" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="36d8df539a847107">ContentDownloadTests</span></a> : <a href="ConversationClientBaseTests.cs.html#f4a8b48a3c31565d" class="t t">ConversationClientBaseTests</a>
    {
        <b>private const string</b> <a id="7f3bd40585071c0b" href="../R/7f3bd40585071c0b.html" target="n" data-glyph="10,1" class="i field">DummyRecordingMetadata</a> = <span class="s">&quot;{&quot;</span> +
                                                <span class="s">&quot;\&quot;chunkDocumentId\&quot;: \&quot;dummyDocId\&quot;,&quot;</span> +
                                                <span class="s">&quot;\&quot;resourceId\&quot;: \&quot;dummyResourceId\&quot;,&quot;</span> +
                                                <span class="s">&quot;\&quot;callId\&quot;: \&quot;dummyCallId\&quot;,&quot;</span> +
                                                <span class="s">&quot;\&quot;chunkIndex\&quot;: 0,&quot;</span> +
                                                <span class="s">&quot;\&quot;chunkStartTime\&quot;: \&quot;dummyStartTime\&quot;,&quot;</span> +
                                                <span class="s">&quot;\&quot;chunkDuration\&quot;: 1.5,&quot;</span> +
                                                <span class="s">&quot;\&quot;version\&quot;: \&quot;1.0\&quot;,&quot;</span> +
                                                <span class="s">&quot;\&quot;pauseResumeIntervals\&quot;: [{&quot;</span> +
                                                <span class="s">&quot;\&quot;startTime\&quot;: \&quot;pauseStartTime\&quot;,&quot;</span> +
                                                <span class="s">&quot;\&quot;duration\&quot;: 0.5&quot;</span> +
                                                <span class="s">&quot;}],&quot;</span> +
                                                <span class="s">&quot;\&quot;recordingInfo\&quot;: {},&quot;</span> +
                                                <span class="s">&quot;\&quot;participants\&quot;: [&quot;</span> +
                                                <span class="s">&quot;{\&quot;participantId\&quot;: \&quot;participantId00\&quot;},&quot;</span> +
                                                <span class="s">&quot;{\&quot;participantId\&quot;: \&quot;participantId01\&quot;}&quot;</span> +
                                                <span class="s">&quot;]&quot;</span> +
                                                <span class="s">&quot;}&quot;</span>;
        <b>private readonly byte</b>[] <a id="a087c341b584ae2f" href="../R/a087c341b584ae2f.html" target="n" data-glyph="46,1" class="i field">_dummyRecordingStream</a> = <b>new</b> <b>byte</b>[]
        {
            1, 2, 3, 4, 5, 6, 7, 8, 9, 0
        };
 
        <b>private readonly</b> <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <a id="78fd26dc1aa2d982" href="../R/78fd26dc1aa2d982.html" target="n" data-glyph="46,1" class="i field">_dummyMetadataLocation</a> = <b>new</b>(<span class="s">&quot;https://localhost/documents/metadata/document_id/acsmetadata&quot;</span>);
        <b>private readonly</b> <a href="@0@System/A.html#991565dd25f47c90" class="t t">Uri</a> <a id="0033a974ee13330c" href="../R/0033a974ee13330c.html" target="n" data-glyph="46,1" class="i field">_dummyRecordingLocation</a> = <b>new</b>(<span class="s">&quot;https://localhost/documents/document_id/&quot;</span>);
 
        <b>private readonly</b> <a href="/Azure.Core/A.html#c33e005b997e77ad" class="t t">HttpHeader</a>[] <a id="1a4581fb5a6a2f5e" href="../R/1a4581fb5a6a2f5e.html" target="n" data-glyph="46,1" class="i field">_rangeResponseHeaders</a> = <b>new</b> <a href="/Azure.Core/A.html#c33e005b997e77ad" class="t t">HttpHeader</a>[]
            {
                <b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes 0-4/5&quot;</span>)
            };
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="b0abaea991723c83" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadMetadata_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r0 rd" class="r0 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(200, <a href="#7f3bd40585071c0b" class="i field">DummyRecordingMetadata</a>);
 
            <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r1 rd" class="r1 r">metadata</span> = <span class="r0 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#ddeacd310a70a77a" class="i method">DownloadStreaming</a>(<a href="#78fd26dc1aa2d982" class="i field">_dummyMetadataLocation</a>);
 
            <a href="#4e4fe232001e9708" class="i method">VerifyExpectedMetadata</a>(<span class="r1 r">metadata</span>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a759efadbe497467" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadMetadataAsync_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r2 rd" class="r2 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(200, <a href="#7f3bd40585071c0b" class="i field">DummyRecordingMetadata</a>);
 
            <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r3 rd" class="r3 r">metadata</span> = <b>await</b> <span class="r2 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#80f4db39a890ae51" class="i method">DownloadStreamingAsync</a>(<a href="#78fd26dc1aa2d982" class="i field">_dummyMetadataLocation</a>);
 
            <a href="#4e4fe232001e9708" class="i method">VerifyExpectedMetadata</a>(<span class="r3 r">metadata</span>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="f45e2f7a1a305c61" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadRecording_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r4 rd" class="r4 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(200, <a href="#a087c341b584ae2f" class="i field">_dummyRecordingStream</a>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a>&gt; <span id="r5 rd" class="r5 r">recording</span> = <span class="r4 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#ddeacd310a70a77a" class="i method">DownloadStreaming</a>(<a href="#0033a974ee13330c" class="i field">_dummyRecordingLocation</a>);
 
            <a href="#d4bc9470a4957c77" class="i method">VerifyExpectedRecording</a>(<span class="r5 r">recording</span>, 10);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="e7d2b6eca009a7e8" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadRecordingByRanges_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r6 rd" class="r6 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(206, <a href="#a087c341b584ae2f" class="i field">_dummyRecordingStream</a>.<a href="@0@System.Core/A.html#aae92b018fa12b39" class="i method">Take</a>(5).<a href="@0@System.Core/A.html#783a052330e7d48d" class="i method">ToArray</a>(), <a href="#1a4581fb5a6a2f5e" class="i field">_rangeResponseHeaders</a>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a>&gt; <span id="r7 rd" class="r7 r">recording</span> = <span class="r6 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#ddeacd310a70a77a" class="i method">DownloadStreaming</a>(<a href="#0033a974ee13330c" class="i field">_dummyRecordingLocation</a>, <b>new</b> <a href="/Azure.Core/A.html#6ed33a49a04456b8" class="t constructor">HttpRange</a>(0, 4));
 
            <a href="#d4bc9470a4957c77" class="i method">VerifyExpectedRecording</a>(<span class="r7 r">recording</span>, 5);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="3a885b88bc694363" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadRecordingAsync_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r8 rd" class="r8 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(200, <a href="#a087c341b584ae2f" class="i field">_dummyRecordingStream</a>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a>&gt; <span id="r9 rd" class="r9 r">recording</span> = <b>await</b> <span class="r8 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#80f4db39a890ae51" class="i method">DownloadStreamingAsync</a>(<a href="#0033a974ee13330c" class="i field">_dummyRecordingLocation</a>);
 
            <a href="#d4bc9470a4957c77" class="i method">VerifyExpectedRecording</a>(<span class="r9 r">recording</span>, 10);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="b97d6480f4426189" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadRecordingByRangesAsync_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r10 rd" class="r10 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(206, <a href="#a087c341b584ae2f" class="i field">_dummyRecordingStream</a>.<a href="@0@System.Core/A.html#aae92b018fa12b39" class="i method">Take</a>(5).<a href="@0@System.Core/A.html#783a052330e7d48d" class="i method">ToArray</a>(), <a href="#1a4581fb5a6a2f5e" class="i field">_rangeResponseHeaders</a>);
 
            <a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a>&gt; <span id="r11 rd" class="r11 r">recording</span> = <b>await</b> <span class="r10 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#80f4db39a890ae51" class="i method">DownloadStreamingAsync</a>(<a href="#0033a974ee13330c" class="i field">_dummyRecordingLocation</a>, <b>new</b> <a href="/Azure.Core/A.html#6ed33a49a04456b8" class="t constructor">HttpRange</a>(0, 4));
 
            <a href="#d4bc9470a4957c77" class="i method">VerifyExpectedRecording</a>(<span class="r11 r">recording</span>, 5);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="7ccdd2867fff3620" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadRecordingToStream_Test</a>()
        {
            <a href="/Azure.Core/A.html#c33e005b997e77ad" class="t t">HttpHeader</a>[] <span id="r12 rd" class="r12 r">rangeHeaderResponse</span> = <b>new</b> <a href="/Azure.Core/A.html#c33e005b997e77ad" class="t t">HttpHeader</a>[]
            {
                <b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes 0-9/10&quot;</span>),
                <b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Length&quot;</span>, <span class="s">&quot;10&quot;</span>),
            };
 
            <a href="/Azure.Communication.CallingServer/A.html#82d4af3e8c1d86ee" class="t t">ContentTransferOptions</a> <span id="r13 rd" class="r13 r">options</span> = <b>new</b>();
            <span class="r13 r">options</span>.<a href="/Azure.Communication.CallingServer/A.html#382ae4182cedcd3b" class="i property">InitialTransferSize</a> = 10;
 
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r14 rd" class="r14 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(206, <a href="#a087c341b584ae2f" class="i field">_dummyRecordingStream</a>, <span class="r12 r">rangeHeaderResponse</span>);
 
            <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r15 rd" class="r15 r">destination</span> = <b>new</b> <a href="@0@mscorlib/A.html#d308091cc690e78d" class="t constructor">MemoryStream</a>();
            <span class="r14 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#a473e5660a891aa6" class="i method">DownloadTo</a>(<a href="#0033a974ee13330c" class="i field">_dummyRecordingLocation</a>, <span class="r15 r">destination</span>, <span class="r13 r">options</span>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(10, <span class="r15 r">destination</span>.<a href="@0@mscorlib/A.html#48b7e39cfd844dc5" class="i property">Length</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="2afdebe51e43994f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadNotExistentContent_Failure_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r16 rd" class="r16 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(404);
            <a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>? <span id="r17 rd" class="r17 r">ex</span> = <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(() =&gt; <span class="r16 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#ddeacd310a70a77a" class="i method">DownloadStreaming</a>(<a href="#78fd26dc1aa2d982" class="i field">_dummyMetadataLocation</a>));
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r17 r">ex</span>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r17 r">ex</span>?.<a href="/Azure.Core/A.html#2e95914e1b156417" class="i property">Status</a>, 404);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="bf10429b70232cf1" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">DownloadNotExistentContentAsync_Failure_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r18 rd" class="r18 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(404);
            <a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>? <span id="r19 rd" class="r19 r">ex</span> = <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(<b>async</b> () =&gt; <b>await</b> <span class="r18 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#80f4db39a890ae51" class="i method">DownloadStreamingAsync</a>(<a href="#78fd26dc1aa2d982" class="i field">_dummyMetadataLocation</a>));
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r19 r">ex</span>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r19 r">ex</span>?.<a href="/Azure.Core/A.html#2e95914e1b156417" class="i property">Status</a>, 404);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="ddc83663ce05388c" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AccessDenied_Failure_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r20 rd" class="r20 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(401);
            <a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>? <span id="r21 rd" class="r21 r">ex</span> = <span class="t t">Assert</span>.<span class="i method">Throws</span>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(() =&gt; <span class="r20 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#ddeacd310a70a77a" class="i method">DownloadStreaming</a>(<a href="#78fd26dc1aa2d982" class="i field">_dummyMetadataLocation</a>));
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r21 r">ex</span>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r21 r">ex</span>?.<a href="/Azure.Core/A.html#2e95914e1b156417" class="i property">Status</a>, 401);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="1f48f29f266e78b2" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">AccessDeniedAsync_Failure_Test</a>()
        {
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r22 rd" class="r22 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#89da5445202183b8" class="i method">CreateMockConversationClient</a>(401);
            <a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>? <span id="r23 rd" class="r23 r">ex</span> = <span class="t t">Assert</span>.<span class="i method">ThrowsAsync</span>&lt;<a href="/Azure.Core/A.html#253c51f73f5cd67d" class="t t">RequestFailedException</a>&gt;(<b>async</b> () =&gt; <b>await</b> <span class="r22 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#80f4db39a890ae51" class="i method">DownloadStreamingAsync</a>(<a href="#78fd26dc1aa2d982" class="i field">_dummyMetadataLocation</a>));
            <span class="t t">Assert</span>.<span class="i method">NotNull</span>(<span class="r23 r">ex</span>);
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r23 r">ex</span>?.<a href="/Azure.Core/A.html#2e95914e1b156417" class="i property">Status</a>, 401);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public void</b> <a id="b0f516c908c99ae0" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ParallelDownloadWithInvalidRangeFirst</a>()
        {
            <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r24 rd" class="r24 r">invalidResponse</span> = <b>new</b>(416); <span class="c">// Invalid range</span>
            <span class="r24 r">invalidResponse</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes */10&quot;</span>));
            <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r25 rd" class="r25 r">validResponse1</span> = <b>new</b>(206);
            <span class="r25 r">validResponse1</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Length&quot;</span>, <span class="s">&quot;5&quot;</span>));
            <span class="r25 r">validResponse1</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes 0-4/10&quot;</span>));
            <span class="r25 r">validResponse1</span>.<a href="/Azure.Core.TestFramework/A.html#7d39b242c3bde3ab" class="i method">SetContent</a>(<b>new</b> <b>byte</b>[] { 0, 1, 2, 3, 4 });
            <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r26 rd" class="r26 r">validResponse2</span> = <b>new</b>(206);
            <span class="r26 r">validResponse2</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Length&quot;</span>, <span class="s">&quot;5&quot;</span>));
            <span class="r26 r">validResponse2</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes 5-9/10&quot;</span>));
            <span class="r26 r">validResponse2</span>.<a href="/Azure.Core.TestFramework/A.html#7d39b242c3bde3ab" class="i method">SetContent</a>(<b>new</b> <b>byte</b>[] { 5, 6, 7, 8, 9 });
 
            <a href="/Azure.Communication.CallingServer/A.html#82d4af3e8c1d86ee" class="t t">ContentTransferOptions</a> <span id="r27 rd" class="r27 r">options</span> = <b>new</b>()
            {
                <a href="/Azure.Communication.CallingServer/A.html#382ae4182cedcd3b" class="i property">InitialTransferSize</a> = 5,
                <a href="/Azure.Communication.CallingServer/A.html#9f6f554edf31e149" class="i property">MaximumTransferSize</a> = 5
            };
 
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r28 rd" class="r28 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#5c2012b357ce082f" class="i method">CreateMockConversationClient</a>(<b>new</b> <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a>[] { <span class="r24 r">invalidResponse</span>, <span class="r25 r">validResponse1</span>, <span class="r26 r">validResponse2</span> });
            <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r29 rd" class="r29 r">destination</span> = <b>new</b> <a href="@0@mscorlib/A.html#d308091cc690e78d" class="t constructor">MemoryStream</a>();
            <span class="r28 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#a473e5660a891aa6" class="i method">DownloadTo</a>(<a href="#0033a974ee13330c" class="i field">_dummyRecordingLocation</a>, <span class="r29 r">destination</span>, <span class="r27 r">options</span>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(10, <span class="r29 r">destination</span>.<a href="@0@mscorlib/A.html#48b7e39cfd844dc5" class="i property">Length</a>);
        }
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="cd561013efe6ecc1" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ParallelDownloadWithInvalidRangeFirstAsync</a>()
        {
            <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r30 rd" class="r30 r">invalidResponse</span> = <b>new</b>(416); <span class="c">// Invalid range</span>
            <span class="r30 r">invalidResponse</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes */10&quot;</span>));
            <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r31 rd" class="r31 r">validResponse1</span> = <b>new</b>(206);
            <span class="r31 r">validResponse1</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Length&quot;</span>, <span class="s">&quot;5&quot;</span>));
            <span class="r31 r">validResponse1</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes 0-4/10&quot;</span>));
            <span class="r31 r">validResponse1</span>.<a href="/Azure.Core.TestFramework/A.html#7d39b242c3bde3ab" class="i method">SetContent</a>(<b>new</b> <b>byte</b>[] { 0, 1, 2, 3, 4 });
            <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <span id="r32 rd" class="r32 r">validResponse2</span> = <b>new</b>(206);
            <span class="r32 r">validResponse2</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Length&quot;</span>, <span class="s">&quot;5&quot;</span>));
            <span class="r32 r">validResponse2</span>.<a href="/Azure.Core.TestFramework/A.html#4ea6c2ac143d5631" class="i method">AddHeader</a>(<b>new</b> <a href="/Azure.Core/A.html#3df78227d19062f7" class="t constructor">HttpHeader</a>(<span class="s">&quot;Content-Range&quot;</span>, <span class="s">&quot;bytes 5-9/10&quot;</span>));
            <span class="r32 r">validResponse2</span>.<a href="/Azure.Core.TestFramework/A.html#7d39b242c3bde3ab" class="i method">SetContent</a>(<b>new</b> <b>byte</b>[] { 5, 6, 7, 8, 9 });
 
            <a href="/Azure.Communication.CallingServer/A.html#82d4af3e8c1d86ee" class="t t">ContentTransferOptions</a> <span id="r33 rd" class="r33 r">options</span> = <b>new</b>()
            {
                <a href="/Azure.Communication.CallingServer/A.html#382ae4182cedcd3b" class="i property">InitialTransferSize</a> = 5,
                <a href="/Azure.Communication.CallingServer/A.html#9f6f554edf31e149" class="i property">MaximumTransferSize</a> = 5
            };
 
            <a href="/Azure.Communication.CallingServer/A.html#ab51e102d7669309" class="t t">ConversationClient</a> <span id="r34 rd" class="r34 r">_convClient</span> = <a href="ConversationClientBaseTests.cs.html#5c2012b357ce082f" class="i method">CreateMockConversationClient</a>(<b>new</b> <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a>[] { <span class="r30 r">invalidResponse</span>, <span class="r31 r">validResponse1</span>, <span class="r32 r">validResponse2</span> });
            <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r35 rd" class="r35 r">destination</span> = <b>new</b> <a href="@0@mscorlib/A.html#d308091cc690e78d" class="t constructor">MemoryStream</a>();
            <b>await</b> <span class="r34 r">_convClient</span>.<a href="/Azure.Communication.CallingServer/A.html#fdc998be0ece9df3" class="i method">DownloadToAsync</a>(<a href="#0033a974ee13330c" class="i field">_dummyRecordingLocation</a>, <span class="r35 r">destination</span>, <span class="r33 r">options</span>);
 
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(10, <span class="r35 r">destination</span>.<a href="@0@mscorlib/A.html#48b7e39cfd844dc5" class="i property">Length</a>);
        }
 
        <b>private static void</b> <a id="4e4fe232001e9708" href="../R/4e4fe232001e9708.html" target="n" data-glyph="76,1" class="i method">VerifyExpectedMetadata</a>(<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r36 rd" class="r36 r">metadata</span>)
        {
            <span class="t t">Assert</span>.<span class="i method">IsNotNull</span>(<span class="r36 r">metadata</span>);
            <span class="t t">JsonElement</span> <span id="r37 rd" class="r37 r">expected</span> = <span class="t t">JsonDocument</span>.<span class="i method">Parse</span>(<a href="#7f3bd40585071c0b" class="i field">DummyRecordingMetadata</a>).<span class="i property">RootElement</span>;
            <span class="t t">JsonElement</span> <span id="r38 rd" class="r38 r">actual</span> = <span class="t t">JsonDocument</span>.<span class="i method">Parse</span>(<span class="r36 r">metadata</span>).<span class="i property">RootElement</span>;
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r37 r">expected</span>.<span class="i method">GetProperty</span>(<span class="s">&quot;chunkDocumentId&quot;</span>).<span class="i method">GetString</span>(), <span class="r38 r">actual</span>.<span class="i method">GetProperty</span>(<span class="s">&quot;chunkDocumentId&quot;</span>).<span class="i method">GetString</span>());
        }
 
        <b>private static void</b> <a id="d4bc9470a4957c77" href="../R/d4bc9470a4957c77.html" target="n" data-glyph="76,1" class="i method">VerifyExpectedRecording</a>(<a href="/Azure.Core/A.html#f0acdd38dd24ccb7" class="t t">Response</a>&lt;<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a>&gt; <span id="r39 rd" class="r39 r">recording</span>, <b>int</b> <span id="r40 rd" class="r40 r">recordingLength</span>)
        {
            <span class="t t">Assert</span>.<span class="i method">IsNotNull</span>(<span class="r39 r">recording</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>);
            <span class="t t">Assert</span>.<span class="i method">IsTrue</span>(<span class="r39 r">recording</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>().<a href="@0@mscorlib/A.html#aa4f112f79364b6e" class="i property">Name</a>.<a href="@0@mscorlib/A.html#428c5c9954dea844" class="i method">Contains</a>(<b>typeof</b>(<a href="../Shared/RetriableStream.cs.html#05d6d0686c9088f4" class="t t">RetriableStream</a>).<a href="@0@mscorlib/A.html#aa4f112f79364b6e" class="i property">Name</a>));
            <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<span class="r40 r">recordingLength</span>, <span class="r39 r">recording</span>.<a href="/Azure.Core/A.html#26af68e791f2f80a" class="i property">Value</a>.<a href="@0@mscorlib/A.html#48b7e39cfd844dc5" class="i property">Length</a>);
        }
    }
}
</pre></td></tr></table></div></body></html>
