<!DOCTYPE html>
<html><head><title>PlatformInfo.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(247);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Rest.ClientRuntime/PlatformInfo.cs" target="_top">PlatformInfo.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Rest.ClientRuntime" target="_top">Microsoft.Rest.ClientRuntime.csproj</a> (Microsoft.Rest.ClientRuntime)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>
{
    <b>using</b> <span class="i n">System</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">InteropServices</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
    <b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">RegularExpressions</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">FullNetFx</span>
    <b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Win32</span>;
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
    <b>internal class</b> <a id="22985e95fb769d47" href="R/22985e95fb769d47.html" target="n" data-glyph="2,0" class="t t"><span id="3bca0165452bc987">PlatformInfo</span></a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Fields
        <b>private</b> <a href="#0eb48653b4a9f465" class="t t">OsInfo</a> <a id="6b6910762f84d2cc" href="R/6b6910762f84d2cc.html" target="n" data-glyph="46,1" class="i field">_osInfo</a>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        <b>public</b> <a href="#0eb48653b4a9f465" class="t t">OsInfo</a> <a id="cb989523f3670cb3" href="R/cb989523f3670cb3.html" target="n" data-glyph="102,1" class="i property">OsInfo</a>
        {
            <b>get</b>
            {
                <b>if</b>(<a href="#6b6910762f84d2cc" class="i field">_osInfo</a> == <b>null</b>)
                {
                    <a href="#6b6910762f84d2cc" class="i field">_osInfo</a> = <b>new</b> <a href="#a35f7f21ec08eac6" class="t constructor">OsInfo</a>();
                }
 
                <b>return</b> <a href="#6b6910762f84d2cc" class="i field">_osInfo</a>;
            }
        }
    }
 
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Provides basic information of underlying OS</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="0eb48653b4a9f465" href="R/0eb48653b4a9f465.html" target="n" data-glyph="2,0" class="t t">OsInfo</a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Const
        <b>const string</b> <a id="2c4ceac839553987" href="R/2c4ceac839553987.html" target="n" data-glyph="10,1" class="i field">WIN_OS_NAME</a> = <span class="s">&quot;Windows&quot;</span>;
        <b>const string</b> <a id="d4150254cae1d8e2" href="R/d4150254cae1d8e2.html" target="n" data-glyph="10,1" class="i field">LINUX_OS_NAME</a> = <span class="s">&quot;Linux&quot;</span>;
        <b>const string</b> <a id="11cf39158ee4e398" href="R/11cf39158ee4e398.html" target="n" data-glyph="10,1" class="i field">MAC_OSX_OS_NAME</a> = <span class="s">&quot;MacOs&quot;</span>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Fields
        <b>private string</b> <a id="f24c181b5f77a895" href="R/f24c181b5f77a895.html" target="n" data-glyph="46,1" class="i field">_osName</a>;
        <b>private bool</b> <a id="72d6097a5db800c7" href="R/72d6097a5db800c7.html" target="n" data-glyph="46,1" class="i field">_isOsWindows</a>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>public string</b> <a id="3ae473069c146a7e" href="R/3ae473069c146a7e.html" target="n" data-glyph="102,1" class="i property">OsName</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<a href="#f24c181b5f77a895" class="i field">_osName</a>))
                {
                    <a href="#f24c181b5f77a895" class="i field">_osName</a> = <a href="#5c536d02a626e965" class="i method">GetOsName</a>();
                }
 
                <b>return</b> <a href="#f24c181b5f77a895" class="i field">_osName</a>;
            }
        }
        <b>public string</b> <a id="e10d71aa3677b29e" href="R/e10d71aa3677b29e.html" target="n" data-glyph="102,1" class="i property">OsVersion</a>
        {
            <b>get</b>
            {
                <b>return</b> <a href="#bd7dcda7456bed46" class="i method">GetOsVersion</a>();
            }
        }
 
        <b>public bool</b> <a id="2092d279a22a0083" href="R/2092d279a22a0083.html" target="n" data-glyph="102,1" class="i property">IsOsWindows</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#3ae473069c146a7e" class="i property">OsName</a>.<a href="@0@mscorlib/A.html#b98069ccbe2d3960" class="i method">Equals</a>(<a href="#2c4ceac839553987" class="i field">WIN_OS_NAME</a>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
                {
                    <a href="#72d6097a5db800c7" class="i field">_isOsWindows</a> = <b>true</b>;
                }
                <b>else</b>
                {
                    <a href="#72d6097a5db800c7" class="i field">_isOsWindows</a> = <b>false</b>;
                }
 
                <b>return</b> <a href="#72d6097a5db800c7" class="i field">_isOsWindows</a>;
            }
        }
 
 
        <b>public</b> <a id="a35f7f21ec08eac6" href="R/a35f7f21ec08eac6.html" target="n" data-glyph="72,1" class="t constructor">OsInfo</a>() { }
 
        <b>private string</b> <a id="bd7dcda7456bed46" href="R/bd7dcda7456bed46.html" target="n" data-glyph="76,1" class="i method">GetOsVersion</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">osVer</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
            <b>try</b>
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">FullNetFx</span>
                <span class="r0 r">osVer</span> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#67900ccbbcff63a2" class="i property">OSVersion</a>.<a href="@0@mscorlib/A.html#7ed000628190bd24" class="i property">Version</a>.<a href="@0@mscorlib/A.html#3b32a91c30a49c52" class="i method">ToString</a>();
<span class="k preprocess">#</span><span class="k preprocess">elif</span> !<span class="i">FullNetFx</span>
<span class="e">                osVer = RuntimeInformation.OSDescription;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r0 r">osVer</span>))
                {
                    <span class="r0 r">osVer</span> = <a href="#4f5bf76e44d44848" class="i method">GetOsVersionBackup</a>();
                }
            }
            <b>catch</b>
            {
                <span class="r0 r">osVer</span> = <a href="#4f5bf76e44d44848" class="i method">GetOsVersionBackup</a>();
            }
 
            <b>return</b> <span class="r0 r">osVer</span>;
        }
 
        <b>private string</b> <a id="5c536d02a626e965" href="R/5c536d02a626e965.html" target="n" data-glyph="76,1" class="i method">GetOsName</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">detectedOs</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">exceptionFormat</span> = <span class="s">&quot;Unsupported Platform &#39;{0}&#39;&quot;</span>;
            <b>try</b>
            {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">FullNetFx</span>
                <b>switch</b> (<a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#67900ccbbcff63a2" class="i property">OSVersion</a>.<a href="@0@mscorlib/A.html#f23195260b6f56fc" class="i property">Platform</a>)
                {
                    <b>case</b> <a href="@0@mscorlib/A.html#065a6a7be5e74336" class="t t">PlatformID</a>.<a href="@0@mscorlib/A.html#6d482632710a81f5" class="i field">Unix</a>:
                        <span class="r1 r">detectedOs</span> = <a href="#d4150254cae1d8e2" class="i field">LINUX_OS_NAME</a>;
                        <b>break</b>;
                    <b>case</b> <a href="@0@mscorlib/A.html#065a6a7be5e74336" class="t t">PlatformID</a>.<a href="@0@mscorlib/A.html#e8b92790a2a353a3" class="i field">MacOSX</a>:
                        <span class="r1 r">detectedOs</span> = <a href="#11cf39158ee4e398" class="i field">MAC_OSX_OS_NAME</a>;
                        <b>break</b>;
                    <b>case</b> <a href="@0@mscorlib/A.html#065a6a7be5e74336" class="t t">PlatformID</a>.<a href="@0@mscorlib/A.html#953dcb25cf190546" class="i field">Win32NT</a>:
                    <b>case</b> <a href="@0@mscorlib/A.html#065a6a7be5e74336" class="t t">PlatformID</a>.<a href="@0@mscorlib/A.html#6cb29083f610adce" class="i field">Win32S</a>:
                    <b>case</b> <a href="@0@mscorlib/A.html#065a6a7be5e74336" class="t t">PlatformID</a>.<a href="@0@mscorlib/A.html#b9a94b0d99b54764" class="i field">Win32Windows</a>:
                        <span class="r1 r">detectedOs</span> = <a href="#2c4ceac839553987" class="i field">WIN_OS_NAME</a>;
                        <b>break</b>;
                    <b>default</b>:
                        <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#1bdc83295b86b4d6" class="t constructor">ApplicationException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="r2 r">exceptionFormat</span>, <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#67900ccbbcff63a2" class="i property">OSVersion</a>.<a href="@0@mscorlib/A.html#f23195260b6f56fc" class="i property">Platform</a>.<a href="@0@mscorlib/A.html#1365cfeffd45409d" class="i method">ToString</a>()));
                }
<span class="k preprocess">#</span><span class="k preprocess">elif</span> !<span class="i">FullNetFx</span>
<span class="e">                if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
                {
                    detectedOs = WIN_OS_NAME;
                }
                else if (RuntimeInformation.IsOSPlatform(OSPlatform.Linux))
                {
                    detectedOs = LINUX_OS_NAME;
                }
                else if (RuntimeInformation.IsOSPlatform(OSPlatform.OSX))
                {
                    detectedOs = MAC_OSX_OS_NAME;
                }
                else
                {
                    throw new System.PlatformNotSupportedException(string.Format(exceptionFormat, string.Empty));
                }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
            }
            <b>catch</b>
            {
                <span class="r1 r">detectedOs</span> = <a href="#829f07bb09131979" class="i method">GetOsNameBackup</a>();
            }
 
            <b>return</b> <span class="r1 r">detectedOs</span>;
        }
 
 
        <b>private string</b> <a id="829f07bb09131979" href="R/829f07bb09131979.html" target="n" data-glyph="76,1" class="i method">GetOsNameBackup</a>()
        {
            <span class="c">//Using a way posted on this thread http://aka.ms/OSNameCR</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r3 rd" class="r3 r">osName</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
            <b>try</b>
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">windir</span> = <a href="@0@mscorlib/A.html#7d2f1469d916fc63" class="t t">Environment</a>.<a href="@0@mscorlib/A.html#3956c71d4fc09576" class="i method">GetEnvironmentVariable</a>(<span class="s">&quot;windir&quot;</span>);
                <b>if</b> (!<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r4 r">windir</span>) &amp;&amp; <span class="r4 r">windir</span>.<a href="@0@mscorlib/A.html#428c5c9954dea844" class="i method">Contains</a>(<span class="s">@&quot;\&quot;</span>) &amp;&amp; <a href="@0@mscorlib/A.html#b3ad5f0ba800bb28" class="t t">Directory</a>.<a href="@0@mscorlib/A.html#6a2a3bee6b62826f" class="i method">Exists</a>(<span class="r4 r">windir</span>))
                {
                    <span class="r3 r">osName</span> = <a href="#2c4ceac839553987" class="i field">WIN_OS_NAME</a>;
                }
                <b>else</b> <b>if</b> (<a href="@0@mscorlib/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@0@mscorlib/A.html#3360368484a9f131" class="i method">Exists</a>(<span class="s">@&quot;/proc/sys/kernel/ostype&quot;</span>))
                {
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r5 rd" class="r5 r">osType</span> = <a href="@0@mscorlib/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@0@mscorlib/A.html#8a84c56a62fd8d45" class="i method">ReadAllText</a>(<span class="s">@&quot;/proc/sys/kernel/ostype&quot;</span>);
                    <b>if</b> (<span class="r5 r">osType</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r5 r">osType</span>.<a href="@0@mscorlib/A.html#1c787ba07a7b11ab" class="i method">StartsWith</a>(<span class="s">&quot;Linux&quot;</span>, <a href="@0@mscorlib/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@0@mscorlib/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
                        {
                            <span class="r3 r">osName</span> = <a href="#d4150254cae1d8e2" class="i field">LINUX_OS_NAME</a>;
                        }
                    }
                }
                <b>else</b> <b>if</b> (<a href="@0@mscorlib/A.html#1c7421e464f67b7e" class="t t">File</a>.<a href="@0@mscorlib/A.html#3360368484a9f131" class="i method">Exists</a>(<span class="s">@&quot;/System/Library/CoreServices/SystemVersion.plist&quot;</span>))
                {
                    <span class="r3 r">osName</span> = <a href="#11cf39158ee4e398" class="i field">MAC_OSX_OS_NAME</a>;
                }
            }
            <b>catch</b> { }
 
            <b>return</b> <span class="r3 r">osName</span>;
        }
 
 
        <b>private string</b> <a id="4f5bf76e44d44848" href="R/4f5bf76e44d44848.html" target="n" data-glyph="76,1" class="i method">GetOsVersionBackup</a>()
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">osVerBackup</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
            <b>try</b>
            {
                <b>if</b> (<a href="#2092d279a22a0083" class="i property">IsOsWindows</a>)
                {
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">FullNetFx</span>
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">osMajorMinorVersion</span> = <a href="#8b71fe75be751b63" class="i method">ReadHKLMRegistry</a>(<span class="s">@&quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot;</span>, <span class="s">&quot;CurrentVersion&quot;</span>);
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r8 rd" class="r8 r">osBuildNumber</span> = <a href="#8b71fe75be751b63" class="i method">ReadHKLMRegistry</a>(<span class="s">@&quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion&quot;</span>, <span class="s">&quot;CurrentBuild&quot;</span>);
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r9 rd" class="r9 r">_osVersion</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;{0}.{1}&quot;</span>, <span class="r7 r">osMajorMinorVersion</span>, <span class="r8 r">osBuildNumber</span>);
                    <a href="@0@System/A.html#bbe3b2eb80ae5526" class="t t">Regex</a> <span id="r10 rd" class="r10 r">pattern</span> = <b>new</b> <a href="@0@System/A.html#71b5945bb883860b" class="t constructor">Regex</a>(<span class="s">&quot;[~`!@#$%^&amp;*(),&lt;&gt;?{} ]&quot;</span>);
                    <span class="r6 r">osVerBackup</span> = <span class="r10 r">pattern</span>.<a href="@0@System/A.html#1f2acfa32796faaa" class="i method">Replace</a>(<span class="r9 r">_osVersion</span>, <span class="s">&quot;&quot;</span>);
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
                }
            }
            <b>catch</b> { }
 
            <b>return</b> <span class="r6 r">osVerBackup</span>;
        }
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">FullNetFx</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reads HKLM registry key from the provided path/key combination</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">path</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Path to HKLM key</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">key</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">HKLM key name</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Value for provided HKLM key</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>private string</b> <a id="8b71fe75be751b63" href="R/8b71fe75be751b63.html" target="n" data-glyph="76,1" class="i method">ReadHKLMRegistry</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r11 rd" class="r11 r">path</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">key</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r13 rd" class="r13 r">regValue</span> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
            <b>try</b>
            {
                <b>if</b> (<a href="#2092d279a22a0083" class="i property">IsOsWindows</a>)
                {
                    <b>using</b> (<a href="@0@mscorlib/A.html#8816e0f3c40b0213" class="t t">RegistryKey</a> <span id="r14 rd" class="r14 r">rk</span> = <a href="@0@mscorlib/A.html#1b1d922117815d60" class="t t">Registry</a>.<a href="@0@mscorlib/A.html#3c3ed260949590e6" class="i field">LocalMachine</a>.<a href="@0@mscorlib/A.html#537f1afcd9c6e89d" class="i method">OpenSubKey</a>(<span class="r11 r">path</span>))
                    {
                        <b>if</b> (<span class="r14 r">rk</span> != <b>null</b>)
                        {
                            <span class="r13 r">regValue</span> = <span class="r14 r">rk</span>.<a href="@0@mscorlib/A.html#29b18a8139ca3964" class="i method">GetValue</a>(<span class="r12 r">key</span>) <b>as string</b>;
                        }
                    }
                }
            }
            <b>catch</b> { }
 
            <b>return</b> <span class="r13 r">regValue</span>;
        }
<span class="k preprocess">#</span><span class="k preprocess">endif</span>
    }
}
</pre></td></tr></table></div></body></html>
