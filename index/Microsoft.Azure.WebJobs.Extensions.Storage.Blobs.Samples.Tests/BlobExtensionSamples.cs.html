<!DOCTYPE html>
<html><head><title>BlobExtensionSamples.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(115);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.Storage.Blobs.Samples.Tests/BlobExtensionSamples.cs" target="_top">BlobExtensionSamples.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.Storage.Blobs.Samples.Tests" target="_top">Microsoft.Azure.WebJobs.Extensions.Storage.Blobs\samples\Microsoft.Azure.WebJobs.Extensions.Storage.Blobs.Samples.Tests.csproj</a> (Microsoft.Azure.WebJobs.Extensions.Storage.Blobs.Samples.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i">Storage</span>.<span class="i">Blobs</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i">Storage</span>.<span class="i">Blobs</span>.<span class="i">Models</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i">Storage</span>.<span class="i">Blobs</span>.<span class="i">Specialized</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">Storage</span>.<span class="i n">Common</span>.<span class="i n">Tests</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i">Azure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Hosting</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i">Logging</span>;
<b>using</b> <span class="i">NUnit</span>.<span class="i">Framework</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Samples</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="aa8e6d4528ad0431" href="R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="a78c297e2acb793d">BlobExtensionSamples</span></a>
    {
        [<span class="i">TestCase</span>(<b>typeof</b>(<a href="#5035b1bca237245c" class="t t">BlobFunction_String</a>))]
        [<span class="i">TestCase</span>(<b>typeof</b>(<a href="#6f33a708f8a1ee32" class="t t">BlobFunction_ReadStream</a>))]
        [<span class="i">TestCase</span>(<b>typeof</b>(<a href="#87eaaa921ac3b4f3" class="t t">BlobFunction_WriteStream</a>))]
        [<span class="i">TestCase</span>(<b>typeof</b>(<a href="#7ad1cf11ec647a55" class="t t">BlobFunction_BlobClient</a>))]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="95e607bd0707d7dc" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Run_BlobFunction</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r0 rd" class="r0 r">programType</span>)
        {
            <b>var</b> <span id="r1 rd" class="r1 r">containerClient</span> = <a href="Shared/AzuriteNUnitFixture.cs.html#eb5e3a22026110cd" class="t t">AzuriteNUnitFixture</a>.<a href="Shared/AzuriteNUnitFixture.cs.html#2debfead00347dbd" class="i property">Instance</a>.<span class="i">GetBlobServiceClient</span>().<span class="i">GetBlobContainerClient</span>(<span class="s">&quot;sample-container&quot;</span>);
            <b>await</b> <span class="r1 r">containerClient</span>.<span class="i">CreateIfNotExistsAsync</span>();
            <b>await</b> <span class="r1 r">containerClient</span>.<span class="i">GetBlockBlobClient</span>(<span class="s">&quot;sample-blob&quot;</span>).<span class="i">UploadTextAsync</span>(<span class="s">&quot;content&quot;</span>);
            <b>await</b> <span class="r1 r">containerClient</span>.<span class="i">GetBlockBlobClient</span>(<span class="s">&quot;sample-blob-1&quot;</span>).<span class="i">UploadTextAsync</span>(<span class="s">&quot;content-1&quot;</span>);
            <b>await</b> <span class="r1 r">containerClient</span>.<span class="i">GetBlockBlobClient</span>(<span class="s">&quot;sample-blob-2&quot;</span>).<span class="i">UploadTextAsync</span>(<span class="s">&quot;content-2&quot;</span>);
            <b>await</b> <a href="#c4df2e1347a64f4e" class="i method">RunTrigger</a>(<span class="r0 r">programType</span>);
        }
 
        <b>private async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="c4df2e1347a64f4e" href="R/c4df2e1347a64f4e.html" target="n" data-glyph="76,1" class="i method">RunTrigger</a>(<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r2 rd" class="r2 r">programType</span>)
        {
            <b>await</b> <a href="/Microsoft.Azure.WebJobs.Extensions.Storage.Common.Tests/A.html#2f452443c345e67f" class="t t">FunctionalTest</a>.<span class="i">RunTriggerAsync</span>(<span id="r3 rd" class="r3 r">b</span> =&gt; {
                <span class="r3 r">b</span>.<span class="i">Services</span>.<span class="i">AddAzureClients</span>(<span id="r4 rd" class="r4 r">builder</span> =&gt;
                {
                    <span class="r4 r">builder</span>.<span class="i">ConfigureDefaults</span>(<span id="r5 rd" class="r5 r">options</span> =&gt; <span class="r5 r">options</span>.<span class="i">Transport</span> = <a href="Shared/AzuriteNUnitFixture.cs.html#eb5e3a22026110cd" class="t t">AzuriteNUnitFixture</a>.<a href="Shared/AzuriteNUnitFixture.cs.html#2debfead00347dbd" class="i property">Instance</a>.<span class="i">GetTransport</span>());
                });
                <span class="r3 r">b</span>.<span class="i">AddAzureStorageBlobs</span>();
            }, <span class="r2 r">programType</span>,
            <span class="i">settings</span>: <b>new</b> <a href="@0@mscorlib/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;() {
                <span class="c">// This takes precedence over env variables.</span>
                { <span class="s">&quot;ConnectionStrings:AzureWebJobsStorage&quot;</span>, <a href="Shared/AzuriteNUnitFixture.cs.html#eb5e3a22026110cd" class="t t">AzuriteNUnitFixture</a>.<a href="Shared/AzuriteNUnitFixture.cs.html#2debfead00347dbd" class="i property">Instance</a>.<a href="/Microsoft.Azure.WebJobs.Extensions.Storage.Common.Tests/A.html#e537de2eaf9fd25e" class="i method">GetAzureAccount</a>().<a href="/Microsoft.Azure.WebJobs.Extensions.Storage.Common.Tests/A.html#ab5abcb4109475aa" class="i property">ConnectionString</a> }
            });
        }
    }
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:BlobFunction_String
    <b>public static class</b> <a id="5035b1bca237245c" href="R/5035b1bca237245c.html" target="n" data-glyph="0,0" class="t t">BlobFunction_String</a>
    {
        [<span class="i">FunctionName</span>(<span class="s">&quot;BlobFunction&quot;</span>)]
        <b>public static void</b> <a id="5d2b5a7fca453cc5" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Run</a>(
            [<span class="i">BlobTrigger</span>(<span class="s">&quot;sample-container/sample-blob-1&quot;</span>)] <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">blobTriggerContent</span>,
            [<span class="i">Blob</span>(<span class="s">&quot;sample-container/sample-blob-2&quot;</span>)] <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r7 rd" class="r7 r">blobContent</span>,
            <span class="i">ILogger</span> <span id="r8 rd" class="r8 r">logger</span>)
        {
            <span class="r8 r">logger</span>.<span class="i">LogInformation</span>(<span class="s">&quot;Blob sample-container/sample-blob-1 has been updated with content: {content}&quot;</span>, <span class="r6 r">blobTriggerContent</span>);
            <span class="r8 r">logger</span>.<span class="i">LogInformation</span>(<span class="s">&quot;Blob sample-container/sample-blob-2 has content: {content}&quot;</span>, <span class="r7 r">blobContent</span>);
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:BlobFunction_ReadStream
    <b>public static class</b> <a id="6f33a708f8a1ee32" href="R/6f33a708f8a1ee32.html" target="n" data-glyph="0,0" class="t t">BlobFunction_ReadStream</a>
    {
        [<span class="i">FunctionName</span>(<span class="s">&quot;BlobFunction&quot;</span>)]
        <b>public static void</b> <a id="22970bf38228505b" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Run</a>(
            [<span class="i">BlobTrigger</span>(<span class="s">&quot;sample-container/sample-blob-1&quot;</span>)] <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r9 rd" class="r9 r">blobTriggerStream</span>,
            [<span class="i">Blob</span>(<span class="s">&quot;sample-container/sample-blob-2&quot;</span>, <a href="@0@mscorlib/A.html#5cc5644ae3acd24b" class="t t">FileAccess</a>.<a href="@0@mscorlib/A.html#0f1c68c756d0636b" class="i field">Read</a>)] <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r10 rd" class="r10 r">blobStream</span>,
            <span class="i">ILogger</span> <span id="r11 rd" class="r11 r">logger</span>)
        {
            <b>using</b> <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="k">var</a> <span id="r12 rd" class="r12 r">blobTriggerStreamReader</span> = <b>new</b> <a href="@0@mscorlib/A.html#72447927169f6b77" class="t constructor">StreamReader</a>(<span class="r9 r">blobTriggerStream</span>);
            <span class="r11 r">logger</span>.<span class="i">LogInformation</span>(<span class="s">&quot;Blob sample-container/sample-blob-1 has been updated with content: {content}&quot;</span>, <span class="r12 r">blobTriggerStreamReader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>());
            <b>using</b> <a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="k">var</a> <span id="r13 rd" class="r13 r">blobStreamReader</span> = <b>new</b> <a href="@0@mscorlib/A.html#72447927169f6b77" class="t constructor">StreamReader</a>(<span class="r10 r">blobStream</span>);
            <span class="r11 r">logger</span>.<span class="i">LogInformation</span>(<span class="s">&quot;Blob sample-container/sample-blob-2 has content: {content}&quot;</span>, <span class="r13 r">blobStreamReader</span>.<a href="@0@mscorlib/A.html#dc5c2420e739a03e" class="i method">ReadToEnd</a>());
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:BlobFunction_WriteStream
    <b>public static class</b> <a id="87eaaa921ac3b4f3" href="R/87eaaa921ac3b4f3.html" target="n" data-glyph="0,0" class="t t">BlobFunction_WriteStream</a>
    {
        [<span class="i">FunctionName</span>(<span class="s">&quot;BlobFunction&quot;</span>)]
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a444fde562a84a90" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Run</a>(
            [<span class="i">BlobTrigger</span>(<span class="s">&quot;sample-container/sample-blob-1&quot;</span>)] <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r14 rd" class="r14 r">blobTriggerStream</span>,
            [<span class="i">Blob</span>(<span class="s">&quot;sample-container/sample-blob-2&quot;</span>, <a href="@0@mscorlib/A.html#5cc5644ae3acd24b" class="t t">FileAccess</a>.<a href="@0@mscorlib/A.html#4715fa16da583c25" class="i field">Write</a>)] <a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r15 rd" class="r15 r">blobStream</span>,
            <span class="i">ILogger</span> <span id="r16 rd" class="r16 r">logger</span>)
        {
            <b>await</b> <span class="r14 r">blobTriggerStream</span>.<a href="@0@mscorlib/A.html#1ed7a6d41a19abf9" class="i method">CopyToAsync</a>(<span class="r15 r">blobStream</span>);
            <span class="r16 r">logger</span>.<span class="i">LogInformation</span>(<span class="s">&quot;Blob sample-container/sample-blob-1 has been copied to sample-container/sample-blob-2&quot;</span>);
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:BlobFunction_BlobClient
    <b>public static class</b> <a id="7ad1cf11ec647a55" href="R/7ad1cf11ec647a55.html" target="n" data-glyph="0,0" class="t t">BlobFunction_BlobClient</a>
    {
        [<span class="i">FunctionName</span>(<span class="s">&quot;BlobFunction&quot;</span>)]
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="6e66518875cf336f" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Run</a>(
            [<span class="i">BlobTrigger</span>(<span class="s">&quot;sample-container/sample-blob-1&quot;</span>)] <span class="i">BlobClient</span> <span id="r17 rd" class="r17 r">blobTriggerClient</span>,
            [<span class="i">Blob</span>(<span class="s">&quot;sample-container/sample-blob-2&quot;</span>)] <span class="i">BlobClient</span> <span id="r18 rd" class="r18 r">blobClient</span>,
            <span class="i">ILogger</span> <span id="r19 rd" class="r19 r">logger</span>)
        {
            <span class="i">BlobProperties</span> <span id="r20 rd" class="r20 r">blobTriggerProperties</span> = <b>await</b> <span class="r17 r">blobTriggerClient</span>.<span class="i">GetPropertiesAsync</span>();
            <span class="r19 r">logger</span>.<span class="i">LogInformation</span>(<span class="s">&quot;Blob sample-container/sample-blob-1 has been updated on: {datetime}&quot;</span>, <span class="r20 r">blobTriggerProperties</span>.<span class="i">LastModified</span>);
            <span class="i">BlobProperties</span> <span id="r21 rd" class="r21 r">blobProperties</span> = <b>await</b> <span class="r18 r">blobClient</span>.<span class="i">GetPropertiesAsync</span>();
            <span class="r19 r">logger</span>.<span class="i">LogInformation</span>(<span class="s">&quot;Blob sample-container/sample-blob-2 has been updated on: {datetime}&quot;</span>, <span class="r21 r">blobProperties</span>.<span class="i">LastModified</span>);
        }
    }
    <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
}
</pre></td></tr></table></div></body></html>
