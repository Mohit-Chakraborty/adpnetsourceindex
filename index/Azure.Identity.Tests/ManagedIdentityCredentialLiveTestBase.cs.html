<!DOCTYPE html>
<html><head><title>ManagedIdentityCredentialLiveTestBase.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(66);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Identity.Tests/ManagedIdentityCredentialLiveTestBase.cs" target="_top">ManagedIdentityCredentialLiveTestBase.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Identity.Tests" target="_top">tests\Azure.Identity.Tests.csproj</a> (Azure.Identity.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Reflection</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i">Security</span>.<span class="i">KeyVault</span>.<span class="i">Secrets</span>;
<b>using</b> <span class="i">NUnit</span>.<span class="i">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>.<span class="i n">Tests</span>
{
    [<span class="i">NonParallelizable</span>]
    <b>public class</b> <a id="8c22460023a2f8c9" href="R/8c22460023a2f8c9.html" target="n" data-glyph="0,0" class="t t">ManagedIdentityCredentialLiveTestBase</a> : <a href="IdentityRecordedTestBase.cs.html#d1e619c0b46397c2" class="t t">IdentityRecordedTestBase</a>
    {
        <b>public</b> <a id="afb7d3539ee8e65d" href="R/afb7d3539ee8e65d.html" target="n" data-glyph="72,1" class="t constructor">ManagedIdentityCredentialLiveTestBase</a>(<b>bool</b> <span id="r0 rd" class="r0 r">isAsync</span>) : <a href="IdentityRecordedTestBase.cs.html#0ea9ae1ae0933c01" class="k">base</a>(<span class="r0 r">isAsync</span>)
        {
        }
 
        <b>public</b> <a id="d87d773b41392f2f" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">ManagedIdentityCredentialLiveTestBase</a>(<b>bool</b> <span id="r1 rd" class="r1 r">isAsync</span>, <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a> <span id="r2 rd" class="r2 r">mode</span>) : <a href="IdentityRecordedTestBase.cs.html#efe98399a3c9c037" class="k">base</a>(<span class="r1 r">isAsync</span>, <span class="r2 r">mode</span>)
        {
        }
 
        <b>protected</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="ff3fe1f287576070" href="R/ff3fe1f287576070.html" target="n" data-glyph="75,1" class="i method">ReadOrRestoreManagedIdentityEnvironment</a>()
        {
            <b>return</b> <b>new</b> <a href="#6075479aa3d31900" class="t constructor">ManagedIdenityEnvironment</a>(<a href="/Azure.Core.TestFramework/A.html#9185092834304053" class="i property">TestEnvironment</a>);
        }
 
        [<span class="i">SetUp</span>]
        <b>public void</b> <a id="d9329f67c3082ba0" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">ClearChallengeCacheforRecord</a>()
        {
            <span class="c">// in record mode we reset the challenge cache before each test so that the challenge call</span>
            <span class="c">// is always made.  This allows tests to be replayed independently and in any order</span>
            <b>if</b> (<a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#62f98a4a2b1d56c3" class="i field">Record</a> || <a href="/Azure.Core.TestFramework/A.html#eb077c11a09b6b1e" class="i property">Mode</a> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>)
            {
                <b>typeof</b>(<span class="i">SecretClient</span>).<a href="@0@mscorlib/A.html#e87d536bd07fab01" class="i property">Assembly</a>.<a href="@0@mscorlib/A.html#d2c38740a6b7facd" class="i method">GetType</a>(<span class="s">&quot;Azure.Security.KeyVault.ChallengeBasedAuthenticationPolicy+AuthenticationChallenge&quot;</span>).<a href="@0@mscorlib/A.html#f24e0c9fd5441fd5" class="i method">GetMethod</a>(<span class="s">&quot;ClearCache&quot;</span>, <a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#5144189c11f6b668" class="i field">NonPublic</a> | <a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#d1fa47f9abe3c16a" class="i field">Static</a>).<a href="@0@mscorlib/A.html#c8277ed81262a367" class="i method">Invoke</a>(<b>null</b>, <b>null</b>);
            }
        }
 
        <b>private class</b> <a id="af7fde1de671cce6" href="R/af7fde1de671cce6.html" target="n" data-glyph="4,1" class="t t">ManagedIdenityEnvironment</a> : <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
        {
            <b>private readonly</b> <a href="TestEnvVar.cs.html#715a9bb4ad5abfea" class="t t">TestEnvVar</a>[] <a id="4e3b0a6707184760" href="R/4e3b0a6707184760.html" target="n" data-glyph="46,2" class="i field">_envVars</a>;
 
            <b>public</b> <a id="6075479aa3d31900" href="R/6075479aa3d31900.html" target="n" data-glyph="72,2" class="t constructor">ManagedIdenityEnvironment</a>(<a href="IdentityTestEnvironment.cs.html#089505885d9aaf59" class="t t">IdentityTestEnvironment</a> <span id="r3 rd" class="r3 r">env</span>)
            {
                <a href="#4e3b0a6707184760" class="i field">_envVars</a> = <b>new</b> <a href="TestEnvVar.cs.html#715a9bb4ad5abfea" class="t t">TestEnvVar</a>[]
                {
                    <b>new</b> <a href="TestEnvVar.cs.html#3973275e5b3893ef" class="t constructor">TestEnvVar</a>(<span class="s">&quot;IDENTITY_ENDPOINT&quot;</span>, <span class="r3 r">env</span>.<a href="IdentityTestEnvironment.cs.html#02d4540b22db421d" class="i property">IdentityEndpoint</a>),
                    <b>new</b> <a href="TestEnvVar.cs.html#3973275e5b3893ef" class="t constructor">TestEnvVar</a>(<span class="s">&quot;IMDS_ENDPOINT&quot;</span>, <span class="r3 r">env</span>.<a href="IdentityTestEnvironment.cs.html#e9b8594f51463e7c" class="i property">ImdsEndpoint</a>),
                    <b>new</b> <a href="TestEnvVar.cs.html#3973275e5b3893ef" class="t constructor">TestEnvVar</a>(<span class="s">&quot;MSI_ENDPOINT&quot;</span>, <span class="r3 r">env</span>.<a href="IdentityTestEnvironment.cs.html#6cfcd22ef2e3f8d9" class="i property">MsiEndpoint</a>),
                    <b>new</b> <a href="TestEnvVar.cs.html#3973275e5b3893ef" class="t constructor">TestEnvVar</a>(<span class="s">&quot;MSI_SECRET&quot;</span>, <span class="r3 r">env</span>.<a href="IdentityTestEnvironment.cs.html#c78bb52ae0b7e66a" class="i property">MsiSecret</a>),
                    <b>new</b> <a href="TestEnvVar.cs.html#3973275e5b3893ef" class="t constructor">TestEnvVar</a>(<span class="s">&quot;IDENTITY_HEADER&quot;</span>, <span class="r3 r">env</span>.<a href="IdentityTestEnvironment.cs.html#84bcdca291deaeaa" class="i property">IdentityHeader</a>),
                    <b>new</b> <a href="TestEnvVar.cs.html#3973275e5b3893ef" class="t constructor">TestEnvVar</a>(<span class="s">&quot;IDENTITY_SERVER_THUMBPRINT&quot;</span>, <span class="r3 r">env</span>.<a href="IdentityTestEnvironment.cs.html#4ea88017330fb185" class="i property">IdentityServerThumbprint</a>)
                };
            }
 
            <b>public void</b> <a id="920bbb560e1d2461" href="R/920bbb560e1d2461.html" target="n" data-glyph="72,2" class="i method">Dispose</a>()
            {
                <b>foreach</b> (<a href="TestEnvVar.cs.html#715a9bb4ad5abfea" class="t t">TestEnvVar</a> <span id="r4 rd" class="r4 r">envVar</span> <b>in</b> <a href="#4e3b0a6707184760" class="i field">_envVars</a>)
                {
                    <span class="r4 r">envVar</span>.<a href="TestEnvVar.cs.html#0cc8801acb00507a" class="i method">Dispose</a>();
                }
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
