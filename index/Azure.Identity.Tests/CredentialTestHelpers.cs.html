<!DOCTYPE html>
<html><head><title>CredentialTestHelpers.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(353);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Identity.Tests/CredentialTestHelpers.cs" target="_top">CredentialTestHelpers.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/identity/Azure.Identity/tests/CredentialTestHelpers.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Identity.Tests" target="_top">Azure.Identity.Tests.csproj</a> (Azure.Identity.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">InteropServices</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">Json</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Identity</span>.<span class="i n">Client</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>.<span class="i n">Tests</span>
{
    <b>internal static class</b> <a id="701304a25ddd93df" href="R/701304a25ddd93df.html" target="n" data-glyph="2,0" class="t t">CredentialTestHelpers</a>
    {
        <b>public static</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="2417772bf49bb79a" href="R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">Token</a>, <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <a id="8e09b1b26b65fee4" href="R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">ExpiresOn</a>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <a id="7ada366d59dc9522" href="R/../../0000000000.html" target="n" data-glyph="42,1" class="i field">Json</a>) <a id="b116d1db187f2fd3" href="R/b116d1db187f2fd3.html" target="n" data-glyph="72,1" class="i method">CreateTokenForAzureCli</a>() =&gt; <a href="#eecc21030aca6fa7" class="i method">CreateTokenForAzureCli</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(30));
 
        <b>public static</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Token</span>, <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span class="i field">ExpiresOn</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Json</span>) <a id="eecc21030aca6fa7" href="R/eecc21030aca6fa7.html" target="n" data-glyph="72,1" class="i method">CreateTokenForAzureCli</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r0 rd" class="r0 r">expiresOffset</span>)
        {
            <b>const string</b> <span id="r1 rd" class="r1 r">expiresOnStringFormat</span> = <span class="s">&quot;yyyy-MM-dd HH:mm:ss.ffffff&quot;</span>;
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r2 rd" class="r2 r">expiresOnString</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#c6573f48ac6bd630" class="i property">Now</a>.<a href="@0@mscorlib/A.html#5cff8f26f5c7c095" class="i method">Add</a>(<span class="r0 r">expiresOffset</span>).<a href="@0@mscorlib/A.html#85b407cde54cb34e" class="i method">ToString</a>(<span class="r1 r">expiresOnStringFormat</span>);
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="k">var</a> <span id="r3 rd" class="r3 r">expiresOn</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#4d8798567dcb0001" class="i method">ParseExact</a>(<span class="r2 r">expiresOnString</span>, <span class="r1 r">expiresOnStringFormat</span>, <a href="@0@mscorlib/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@0@mscorlib/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>, <a href="@0@mscorlib/A.html#0052cfe5031c0372" class="t t">DateTimeStyles</a>.<a href="@0@mscorlib/A.html#37f818ebce76df2a" class="i field">AdjustToUniversal</a> | <a href="@0@mscorlib/A.html#0052cfe5031c0372" class="t t">DateTimeStyles</a>.<a href="@0@mscorlib/A.html#6865c402d99dbad3" class="i field">AssumeLocal</a>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r4 rd" class="r4 r">token</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r5 rd" class="r5 r">json</span> = <span class="s">$&quot;</span><span class="s">{{ \&quot;accessToken\&quot;: \&quot;</span>{<span class="r4 r">token</span>}<span class="s">\&quot;, \&quot;expiresOn\&quot;: \&quot;</span>{<span class="r2 r">expiresOnString</span>}<span class="s">\&quot; }}</span><span class="s">&quot;</span>;
            <b>return</b> (<span class="r4 r">token</span>, <span class="r3 r">expiresOn</span>, <span class="r5 r">json</span>);
        }
 
        <b>public static</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Token</span>, <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span class="i field">ExpiresOn</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Json</span>) <a id="ccb66c2ed903272f" href="R/ccb66c2ed903272f.html" target="n" data-glyph="72,1" class="i method">CreateTokenForAzureCliExpiresIn</a>(<b>int</b> <span id="r6 rd" class="r6 r">seconds</span> = 30)
        {
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="k">var</a> <span id="r7 rd" class="r7 r">expiresOn</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#04abe0cac293ebd0" class="i property">UtcNow</a> + <a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(<span class="r6 r">seconds</span>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r8 rd" class="r8 r">token</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r9 rd" class="r9 r">json</span> = <span class="s">$&quot;</span><span class="s">{{ \&quot;accessToken\&quot;: \&quot;</span>{<span class="r8 r">token</span>}<span class="s">\&quot;, \&quot;expiresIn\&quot;: </span>{<span class="r6 r">seconds</span>}<span class="s"> }}</span><span class="s">&quot;</span>;
            <b>return</b> (<span class="r8 r">token</span>, <span class="r7 r">expiresOn</span>, <span class="r9 r">json</span>);
        }
 
        <b>public static</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Token</span>, <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span class="i field">ExpiresOn</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Json</span>) <a id="18a41230d0085ae8" href="R/18a41230d0085ae8.html" target="n" data-glyph="72,1" class="i method">CreateTokenForAzurePowerShell</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r10 rd" class="r10 r">expiresOffset</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r11 rd" class="r11 r">expiresOnString</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#c6573f48ac6bd630" class="i property">Now</a>.<a href="@0@mscorlib/A.html#5cff8f26f5c7c095" class="i method">Add</a>(<span class="r10 r">expiresOffset</span>).<a href="@0@mscorlib/A.html#15c21deb87e2d552" class="i method">ToString</a>();
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="k">var</a> <span id="r12 rd" class="r12 r">expiresOn</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#69a63656bdb67745" class="i method">Parse</a>(<span class="r11 r">expiresOnString</span>,  <a href="@0@mscorlib/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@0@mscorlib/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>, <a href="@0@mscorlib/A.html#0052cfe5031c0372" class="t t">DateTimeStyles</a>.<a href="@0@mscorlib/A.html#37f818ebce76df2a" class="i field">AdjustToUniversal</a> | <a href="@0@mscorlib/A.html#0052cfe5031c0372" class="t t">DateTimeStyles</a>.<a href="@0@mscorlib/A.html#6865c402d99dbad3" class="i field">AssumeLocal</a>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r13 rd" class="r13 r">token</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r14 rd" class="r14 r">xml</span> = <span class="s">@$&quot;</span><span class="s">&lt;Object Type=&quot;&quot;Microsoft.Azure.Commands.Profile.Models.PSAccessToken&quot;&quot;&gt;&lt;Property Name=&quot;&quot;Token&quot;&quot; Type=&quot;&quot;System.String&quot;&quot;&gt;</span>{<span class="r13 r">token</span>}<span class="s">&lt;/Property&gt;&lt;Property Name=&quot;&quot;ExpiresOn&quot;&quot; Type=&quot;&quot;System.DateTimeOffset&quot;&quot;&gt;</span>{<span class="r11 r">expiresOnString</span>}<span class="s">&lt;/Property&gt;&lt;Property Name=&quot;&quot;TenantId&quot;&quot; Type=&quot;&quot;System.String&quot;&quot;&gt;</span>{<a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>()}<span class="s">&lt;/Property&gt;&lt;Property Name=&quot;&quot;UserId&quot;&quot; Type=&quot;&quot;System.String&quot;&quot;&gt;foo@contoso.com&lt;/Property&gt;&lt;Property Name=&quot;&quot;Type&quot;&quot; Type=&quot;&quot;System.String&quot;&quot;&gt;Bearer&lt;/Property&gt;&lt;/Object&gt;</span><span class="s">&quot;</span>;
            <b>return</b> (<span class="r13 r">token</span>, <span class="r12 r">expiresOn</span>, <span class="r14 r">xml</span>);
        }
 
        <b>public static</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Token</span>, <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span class="i field">ExpiresOn</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Json</span>) <a id="3a002a00f989592f" href="R/3a002a00f989592f.html" target="n" data-glyph="72,1" class="i method">CreateTokenForVisualStudio</a>() =&gt; <a href="#27fc194035204faa" class="i method">CreateTokenForVisualStudio</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#c24437e069f958f9" class="i method">FromSeconds</a>(30));
 
        <b>public static</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Token</span>, <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span class="i field">ExpiresOn</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span class="i field">Json</span>) <a id="27fc194035204faa" href="R/27fc194035204faa.html" target="n" data-glyph="72,1" class="i method">CreateTokenForVisualStudio</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a> <span id="r15 rd" class="r15 r">expiresOffset</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r16 rd" class="r16 r">expiresOnString</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#04abe0cac293ebd0" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#5cff8f26f5c7c095" class="i method">Add</a>(<span class="r15 r">expiresOffset</span>).<a href="@0@mscorlib/A.html#85b407cde54cb34e" class="i method">ToString</a>(<span class="s">&quot;s&quot;</span>);
            <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="k">var</a> <span id="r17 rd" class="r17 r">expiresOn</span> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#355516336bba15ac" class="i method">Parse</a>(<span class="r16 r">expiresOnString</span>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r18 rd" class="r18 r">token</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r19 rd" class="r19 r">json</span> = <span class="s">$&quot;</span><span class="s">{{ \&quot;access_token\&quot;: \&quot;</span>{<span class="r18 r">token</span>}<span class="s">\&quot;, \&quot;expires_on\&quot;: \&quot;</span>{<span class="r16 r">expiresOnString</span>}<span class="s">\&quot; }}</span><span class="s">&quot;</span>;
            <b>return</b> (<span class="r18 r">token</span>, <span class="r17 r">expiresOn</span>, <span class="r19 r">json</span>);
        }
 
        <b>public static</b> <a href="TestFileSystemService.cs.html#72029291dc59d958" class="t t">TestFileSystemService</a> <a id="df1c12fc5df8e0ee" href="R/df1c12fc5df8e0ee.html" target="n" data-glyph="72,1" class="i method">CreateFileSystemForVisualStudio</a>(<b>params int</b>[] <span id="r20 rd" class="r20 r">preferences</span>)
        {
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r21 rd" class="r21 r">sb</span> = <b>new</b> <a href="@0@mscorlib/A.html#6e631639c1e2746b" class="t constructor">StringBuilder</a>();
            <a href="@0@mscorlib/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r22 rd" class="r22 r">paths</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt;();
 
            <b>for</b> (<a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r23 rd" class="r23 r">i</span> = 0; <span class="r23 r">i</span> &lt; <span class="r20 r">preferences</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a> || <span class="r23 r">i</span> == 0; <span class="r23 r">i</span>++)
            {
                <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r24 rd" class="r24 r">preference</span> = <span class="r20 r">preferences</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a> &gt; 0 ? <span class="r20 r">preferences</span>[<span class="r23 r">i</span>] : 0;
                <b>if</b> (<span class="r23 r">i</span> &gt; 0)
                {
                    <span class="r21 r">sb</span>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">&quot;, &quot;</span>);
                }
 
                <span class="r22 r">paths</span>.<a href="@0@mscorlib/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="s">$&quot;</span><span class="s">c:\\VS</span>{<span class="r24 r">preference</span>}<span class="s">\\service.exe</span><span class="s">&quot;</span>);
                <span class="r21 r">sb</span>.<a href="@0@mscorlib/A.html#e8eaef3c361184bc" class="i method">Append</a>(<span class="s">$&quot;</span><span class="s">{{\&quot;Path\&quot;: \&quot;c:\\\\VS</span>{<span class="r24 r">preference</span>}<span class="s">\\\\service.exe\&quot;, \&quot;Arguments\&quot;: [\&quot;</span>{<span class="r24 r">preference</span>}<span class="s">\&quot;], \&quot;Preference\&quot;: </span>{<span class="r24 r">preference</span>}}}<span class="s">&quot;</span>);
            }
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r25 rd" class="r25 r">json</span> = <span class="s">$&quot;</span><span class="s">{{ \&quot;TokenProviders\&quot;: [</span>{<span class="r21 r">sb</span>}<span class="s">] }}</span><span class="s">&quot;</span>;
            <b>return</b> <b>new</b> <a href="TestFileSystemService.cs.html#72029291dc59d958" class="t constructor">TestFileSystemService</a> { <a href="TestFileSystemService.cs.html#6eef5d02b1e13fcd" class="i field">FileExistsHandler</a> = <span id="r26 rd" class="r26 r">p</span> =&gt; <span class="r22 r">paths</span>.<a href="@0@mscorlib/A.html#521b9f7129105e15" class="i method">Contains</a>(<span class="r26 r">p</span>), <a href="TestFileSystemService.cs.html#73ee5a2fb3c128e9" class="i field">ReadAllHandler</a> = <span id="r27 rd" class="r27 r">p</span> =&gt; <span class="r25 r">json</span> };
        }
 
        <b>public static</b> <a href="TestFileSystemService.cs.html#72029291dc59d958" class="t t">TestFileSystemService</a> <a id="083984da1795af36" href="R/083984da1795af36.html" target="n" data-glyph="72,1" class="i method">CreateFileSystemForVisualStudioCode</a>(<a href="IdentityTestEnvironment.cs.html#089505885d9aaf59" class="t t">IdentityTestEnvironment</a> <span id="r28 rd" class="r28 r">testEnvironment</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r29 rd" class="r29 r">cloudName</span> = <b>default</b>)
        {
            <a href="@0@mscorlib/A.html#adf60ee46ebd299f" class="k">var</a> <span id="r30 rd" class="r30 r">sb</span> = <b>new</b> <a href="@0@mscorlib/A.html#57b9d3a70c2aba34" class="t constructor">StringBuilder</a>(<span class="s">&quot;{&quot;</span>);
 
            <b>if</b> (<span class="r28 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9ec514946f7cd3bd" class="i property">TestTenantId</a> != <b>default</b>)
            {
                <span class="r30 r">sb</span>.<a href="@0@mscorlib/A.html#ad46fb2c09cab59a" class="i method">AppendFormat</a>(<span class="s">&quot;\&quot;azure.tenant\&quot;: \&quot;{0}\&quot;&quot;</span>, <span class="r28 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9ec514946f7cd3bd" class="i property">TestTenantId</a>);
            }
 
            <b>if</b> (<span class="r28 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9ec514946f7cd3bd" class="i property">TestTenantId</a> != <b>default</b> &amp;&amp; <span class="r29 r">cloudName</span> != <b>default</b>)
            {
                <span class="r30 r">sb</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;,&#39;</span>);
            }
 
            <b>if</b> (<span class="r29 r">cloudName</span> != <b>default</b>)
            {
                <span class="r30 r">sb</span>.<a href="@0@mscorlib/A.html#ad46fb2c09cab59a" class="i method">AppendFormat</a>(<span class="s">&quot;\&quot;azure.cloud\&quot;: \&quot;{0}\&quot;&quot;</span>, <span class="r29 r">cloudName</span>);
            }
 
            <span class="r30 r">sb</span>.<a href="@0@mscorlib/A.html#a2e7c78d85807da5" class="i method">Append</a>(<span class="s">&#39;}&#39;</span>);
 
            <b>return</b> <b>new</b> <a href="TestFileSystemService.cs.html#72029291dc59d958" class="t constructor">TestFileSystemService</a> { <a href="TestFileSystemService.cs.html#6eef5d02b1e13fcd" class="i field">FileExistsHandler</a> = <span id="r31 rd" class="r31 r">p</span> =&gt; <a href="@0@mscorlib/A.html#090eca8621a248ee" class="t t">Path</a>.<a href="@0@mscorlib/A.html#526189dbe2ce4d2e" class="i method">HasExtension</a>(<span class="s">&quot;json&quot;</span>), <a href="TestFileSystemService.cs.html#73ee5a2fb3c128e9" class="i field">ReadAllHandler</a> = <span id="r32 rd" class="r32 r">s</span> =&gt; <span class="r30 r">sb</span>.<a href="@0@mscorlib/A.html#5a97da49a158a3c9" class="i method">ToString</a>() };
        }
 
        <b>public static async</b> <span class="t t">ValueTask</span>&lt;<a href="/Azure.Identity/A.html#21becee4cc870d44" class="t t">AuthenticationRecord</a>&gt; <a id="aaff370d389f8821" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetAuthenticationRecordAsync</a>(<a href="IdentityTestEnvironment.cs.html#089505885d9aaf59" class="t t">IdentityTestEnvironment</a> <span id="r33 rd" class="r33 r">testEnvironment</span>, <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a> <span id="r34 rd" class="r34 r">mode</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r35 rd" class="r35 r">clientId</span> = <a href="../GuidAssembly/R/04b07795-8ddb-461a-bbee-02f9e1bf7b46.html" target="n" class="s">&quot;04b07795-8ddb-461a-bbee-02f9e1bf7b46&quot;</a>;
            <b>if</b> (<span class="r34 r">mode</span> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r36 rd" class="r36 r">mockUsername</span> = <span class="s">&quot;mockuser@mockdomain.com&quot;</span>;
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r37 rd" class="r37 r">mockEnvironment</span> = <a href="/Azure.Identity/A.html#b2210b8902fd1425" class="t t">AzureAuthorityHosts</a>.<a href="/Azure.Identity/A.html#ee9f5238cefd3afa" class="i property">AzurePublicCloud</a>.<a href="@0@System/A.html#bf3caa11ab73e433" class="i method">ToString</a>();
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r38 rd" class="r38 r">mockHomeId</span> = <span class="s">$&quot;</span>{<a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>()}<span class="s">.</span>{<a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>()}<span class="s">&quot;</span>;
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r39 rd" class="r39 r">mockTenantId</span> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
 
                <b>return</b> <b>new</b> <a href="/Azure.Identity/A.html#171b86ddf5a50ce3" class="t constructor">AuthenticationRecord</a>(<span class="r36 r">mockUsername</span>, <span class="r37 r">mockEnvironment</span>, <span class="r38 r">mockHomeId</span>, <span class="r39 r">mockTenantId</span>, <span class="r35 r">clientId</span>);
            }
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r40 rd" class="r40 r">username</span> = <span class="r33 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9857c92773bd6955" class="i property">Username</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r41 rd" class="r41 r">password</span> = <span class="r33 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#3208dd0537c481c4" class="i property">Password</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r42 rd" class="r42 r">tenantId</span> = <span class="r33 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9ec514946f7cd3bd" class="i property">TestTenantId</a>;
 
            <b>var</b> <span id="r43 rd" class="r43 r">result</span> = <b>await</b> <span class="t t">PublicClientApplicationBuilder</span>.<span class="i method">Create</span>(<span class="r35 r">clientId</span>)
                .<span class="i method">WithTenantId</span>(<span class="r42 r">tenantId</span>)
                .<span class="i method">Build</span>()
                .<span class="i method">AcquireTokenByUsernamePassword</span>(<b>new</b>[] { <span class="s">&quot;.default&quot;</span> }, <span class="r40 r">username</span>, <span class="r41 r">password</span>.<a href="TestAccessorExtensions.cs.html#997e1a2fb342ab9e" class="i method">ToSecureString</a>())
                .<span class="i method">ExecuteAsync</span>();
 
            <b>return</b> <b>new</b> <a href="/Azure.Identity/A.html#3ce44404eddb18fb" class="t constructor">AuthenticationRecord</a>(<span class="r43 r">result</span>, <span class="r35 r">clientId</span>);
        }
 
        <b>public static async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="b5e7b99eb18f075d" href="R/b5e7b99eb18f075d.html" target="n" data-glyph="72,1" class="i method">GetRefreshTokenAsync</a>(<a href="IdentityTestEnvironment.cs.html#089505885d9aaf59" class="t t">IdentityTestEnvironment</a> <span id="r44 rd" class="r44 r">testEnvironment</span>, <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a> <span id="r45 rd" class="r45 r">mode</span>)
        {
            <b>if</b> (<span class="r45 r">mode</span> == <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a>.<a href="/Azure.Core.TestFramework/A.html#bde4663b03b59b85" class="i field">Playback</a>)
            {
                <b>return</b> <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            }
 
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r46 rd" class="r46 r">clientId</span> = <a href="../GuidAssembly/R/aebc6443-996d-45c2-90f0-388ff96faa56.html" target="n" class="s">&quot;aebc6443-996d-45c2-90f0-388ff96faa56&quot;</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r47 rd" class="r47 r">username</span> = <span class="r44 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9857c92773bd6955" class="i property">Username</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r48 rd" class="r48 r">password</span> = <span class="r44 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#3208dd0537c481c4" class="i property">Password</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r49 rd" class="r49 r">authorityUri</span> = <b>new</b> <a href="@0@System/A.html#67d3260816440b78" class="t constructor">Uri</a>(<b>new</b> <a href="@0@System/A.html#9e1bb2fef0d1159b" class="t constructor">Uri</a>(<span class="r44 r">testEnvironment</span>.<a href="/Azure.Core.TestFramework/A.html#a97d05f1a459eabb" class="i property">AuthorityHostUrl</a>), <span class="r44 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9ec514946f7cd3bd" class="i property">TestTenantId</a>).<a href="@0@System/A.html#bf3caa11ab73e433" class="i method">ToString</a>();
 
            <b>var</b> <span id="r50 rd" class="r50 r">client</span> = <span class="t t">PublicClientApplicationBuilder</span>.<span class="i method">Create</span>(<span class="r46 r">clientId</span>)
                .<span class="i method">WithAuthority</span>(<span class="r49 r">authorityUri</span>)
                .<span class="i method">WithTenantId</span>(<span class="r44 r">testEnvironment</span>.<a href="IdentityTestEnvironment.cs.html#9ec514946f7cd3bd" class="i property">TestTenantId</a>)
                .<span class="i method">Build</span>();
 
            <a href="#d5b3ee661526cd64" class="k">var</a> <span id="r51 rd" class="r51 r">retriever</span> = <b>new</b> <a href="#3741a79b4be660d2" class="t constructor">RefreshTokenRetriever</a>(<span class="r50 r">client</span>.<span class="i property">UserTokenCache</span>);
            <b>await</b> <span class="r50 r">client</span>.<span class="i method">AcquireTokenByUsernamePassword</span>(<b>new</b>[] { <span class="s">&quot;.default&quot;</span> }, <span class="r47 r">username</span>, <span class="r48 r">password</span>.<a href="TestAccessorExtensions.cs.html#997e1a2fb342ab9e" class="i method">ToSecureString</a>()).<span class="i method">ExecuteAsync</span>();
 
            <a href="StaticCachesUtilities.cs.html#150b8836eb7758a9" class="t t">StaticCachesUtilities</a>.<a href="StaticCachesUtilities.cs.html#449b49b546d464be" class="i method">ClearStaticMetadataProviderCache</a>();
            <a href="StaticCachesUtilities.cs.html#150b8836eb7758a9" class="t t">StaticCachesUtilities</a>.<a href="StaticCachesUtilities.cs.html#f823e635a682d33f" class="i method">ClearAuthorityEndpointResolutionManagerCache</a>();
            <b>return</b> <span class="r51 r">retriever</span>.<a href="#f206bd3e4c139fed" class="i property">RefreshToken</a>;
        }
 
        <b>public static async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>&gt; <a id="a4a14e9662f9a436" href="R/a4a14e9662f9a436.html" target="n" data-glyph="72,1" class="i method">CreateRefreshTokenFixtureAsync</a>(<a href="IdentityTestEnvironment.cs.html#089505885d9aaf59" class="t t">IdentityTestEnvironment</a> <span id="r52 rd" class="r52 r">testEnvironment</span>, <a href="/Azure.Core.TestFramework/A.html#d7d5cc97dd76217f" class="t t">RecordedTestMode</a> <span id="r53 rd" class="r53 r">mode</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r54 rd" class="r54 r">serviceName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r55 rd" class="r55 r">cloudName</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r56 rd" class="r56 r">refreshToken</span> = <b>await</b> <a href="#b5e7b99eb18f075d" class="i method">GetRefreshTokenAsync</a>(<span class="r52 r">testEnvironment</span>, <span class="r53 r">mode</span>);
 
            <b>if</b> (<span class="t t">RuntimeInformation</span>.<span class="i method">IsOSPlatform</span>(<span class="t t">OSPlatform</span>.<span class="i property">Windows</span>))
            {
                <b>return</b> <a href="#1b3b1c81d0756ce5" class="t t">WindowsRefreshTokenFixture</a>.<a href="#35e1b019bb90da17" class="i method">Create</a>(<span class="r54 r">serviceName</span>, <span class="r55 r">cloudName</span>, <span class="r56 r">refreshToken</span>);
            }
 
            <b>if</b> (<span class="t t">RuntimeInformation</span>.<span class="i method">IsOSPlatform</span>(<span class="t t">OSPlatform</span>.<span class="i property">OSX</span>))
            {
                <b>return</b> <a href="#56a77a8b755ab974" class="t t">OsxRefreshTokenFixture</a>.<a href="#f6d439d519a6e3b7" class="i method">Create</a>(<span class="r54 r">serviceName</span>, <span class="r55 r">cloudName</span>, <span class="r56 r">refreshToken</span>);
            }
 
            <b>if</b> (<span class="t t">RuntimeInformation</span>.<span class="i method">IsOSPlatform</span>(<span class="t t">OSPlatform</span>.<span class="i property">Linux</span>))
            {
                <b>return</b> <a href="#be403ecfd790cd29" class="t t">LinuxRefreshTokenFixture</a>.<a href="#658c5052cd76623c" class="i method">Create</a>(<span class="r54 r">serviceName</span>, <span class="r55 r">cloudName</span>, <span class="r56 r">refreshToken</span>);
            }
 
            <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#ad07c3864de72561" class="t constructor">PlatformNotSupportedException</a>();
        }
 
        <b>private sealed class</b> <a id="d5b3ee661526cd64" href="R/d5b3ee661526cd64.html" target="n" data-glyph="4,1" class="t t">RefreshTokenRetriever</a>
        {
            <b>public string</b> <a id="f206bd3e4c139fed" href="R/f206bd3e4c139fed.html" target="n" data-glyph="102,2" class="i property">RefreshToken</a> { <b>get</b>; <b>private set</b>; }
 
            <b>public</b> <a id="3741a79b4be660d2" href="R/3741a79b4be660d2.html" target="n" data-glyph="72,2" class="t constructor">RefreshTokenRetriever</a>(<span class="t t">ITokenCache</span> <span id="r57 rd" class="r57 r">tokenCache</span>)
            {
                <span class="r57 r">tokenCache</span>.<span class="i method">SetAfterAccess</span>(<a href="#adbd1c6bd72176c0" class="i method">AfterAccessHandler</a>);
            }
 
            <b>private void</b> <a id="adbd1c6bd72176c0" href="R/adbd1c6bd72176c0.html" target="n" data-glyph="76,2" class="i method">AfterAccessHandler</a>(<span class="t t">TokenCacheNotificationArgs</span> <span id="r58 rd" class="r58 r">args</span>)
            {
                <b>var</b> <span id="r59 rd" class="r59 r">data</span> = <span class="r58 r">args</span>.<span class="i property">TokenCache</span>.<span class="i method">SerializeMsalV3</span>();
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r60 rd" class="r60 r">serializedData</span> = <b>new</b> <a href="@0@mscorlib/A.html#21efe420a875356a" class="t constructor">UTF8Encoding</a>().<a href="@0@mscorlib/A.html#7310c9cccfaecd17" class="i method">GetString</a>(<span class="r59 r">data</span>);
                <b>var</b> <span id="r61 rd" class="r61 r">root</span> = <span class="t t">JsonDocument</span>.<span class="i method">Parse</span>(<span class="r60 r">serializedData</span>).<span class="i property">RootElement</span>;
                <b>var</b> <span id="r62 rd" class="r62 r">refreshTokenObject</span> = <span class="r61 r">root</span>.<span class="i method">GetProperty</span>(<span class="s">&quot;RefreshToken&quot;</span>);
                <b>foreach</b> (<span class="t t">JsonProperty</span> <span id="r63 rd" class="r63 r">property</span> <b>in</b> <span class="r62 r">refreshTokenObject</span>.<span class="i method">EnumerateObject</span>())
                {
                    <b>if</b> (<span class="r63 r">property</span>.<span class="i property">Name</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="r58 r">args</span>.<span class="i property">Account</span>.<span class="i property">HomeAccountId</span>.<span class="i property">Identifier</span>))
                    {
                        <a href="#f206bd3e4c139fed" class="i property">RefreshToken</a> = <span class="r63 r">property</span>.<span class="i property">Value</span>.<span class="i method">GetProperty</span>(<span class="s">&quot;secret&quot;</span>).<span class="i method">GetString</span>();
                        <b>return</b>;
                    }
                }
            }
        }
 
        <b>private sealed class</b> <a id="1b3b1c81d0756ce5" href="R/1b3b1c81d0756ce5.html" target="n" data-glyph="4,1" class="t t">WindowsRefreshTokenFixture</a> : <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
        {
            <b>private readonly string</b> <a id="22dfef680684dc58" href="R/22dfef680684dc58.html" target="n" data-glyph="46,2" class="i field">_target</a>;
 
            <b>public static</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="35e1b019bb90da17" href="R/35e1b019bb90da17.html" target="n" data-glyph="72,2" class="i method">Create</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r64 rd" class="r64 r">serviceName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r65 rd" class="r65 r">cloudName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r66 rd" class="r66 r">refreshToken</span>)
            {
                <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r67 rd" class="r67 r">target</span> = <span class="s">$&quot;</span><span class="s">VS Code Azure/</span>{<span class="r65 r">cloudName</span>}<span class="s">&quot;</span>;
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="k">var</a> <span id="r68 rd" class="r68 r">credentialBlobPtr</span> = <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#6a0a9abff99fc610" class="i method">StringToHGlobalAnsi</a>(<span class="r66 r">refreshToken</span>);
 
                <a href="/Azure.Identity/A.html#92e0c7ad64aede35" class="k">var</a> <span id="r69 rd" class="r69 r">credentialData</span> = <b>new</b> <a href="/Azure.Identity/A.html#9e9fce24d89a2c8f" class="t t">WindowsNativeMethods</a>.<a href="/Azure.Identity/A.html#92e0c7ad64aede35" class="t constructor">CredentialData</a>
                {
                    <a href="/Azure.Identity/A.html#9ba67b2117757cda" class="i field">AttributeCount</a> = 0,
                    <a href="/Azure.Identity/A.html#be234658df77aaf6" class="i field">Attributes</a> = <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>,
                    <a href="/Azure.Identity/A.html#b44e7e9ee4b385d0" class="i field">Comment</a> = <b>null</b>,
                    <a href="/Azure.Identity/A.html#621ca848c13cb76a" class="i field">CredentialBlob</a> = <span class="r68 r">credentialBlobPtr</span>,
                    <a href="/Azure.Identity/A.html#15c06a89e8881bc9" class="i field">CredentialBlobSize</a> = (<b>uint</b>)<span class="r66 r">refreshToken</span>.<a href="@0@mscorlib/A.html#e13f5829ef28aa07" class="i property">Length</a>,
                    <a href="/Azure.Identity/A.html#d20f78a29e33970b" class="i field">Flags</a> = 0,
                    <a href="/Azure.Identity/A.html#fe256ed1d442344c" class="i field">Persist</a> = <a href="/Azure.Identity/A.html#9e9fce24d89a2c8f" class="t t">WindowsNativeMethods</a>.<a href="/Azure.Identity/A.html#0fce07d7c6fed2b4" class="t t">CRED_PERSIST</a>.<a href="/Azure.Identity/A.html#04f115a996c9785b" class="i field">CRED_PERSIST_LOCAL_MACHINE</a>,
                    <a href="/Azure.Identity/A.html#b82401c82715a9ec" class="i field">TargetAlias</a> = <b>null</b>,
                    <a href="/Azure.Identity/A.html#e6d41fcacb84d6ca" class="i field">TargetName</a> = <span class="s">$&quot;</span>{<span class="r64 r">serviceName</span>}<span class="s">/</span>{<span class="r65 r">cloudName</span>}<span class="s">&quot;</span>,
                    <a href="/Azure.Identity/A.html#0dd83a2f911abeab" class="i field">Type</a> = <a href="/Azure.Identity/A.html#9e9fce24d89a2c8f" class="t t">WindowsNativeMethods</a>.<a href="/Azure.Identity/A.html#36c91679188be41d" class="t t">CRED_TYPE</a>.<a href="/Azure.Identity/A.html#e8dcd916c85d5996" class="i field">GENERIC</a>,
                    <a href="/Azure.Identity/A.html#f7e075cb4708a019" class="i field">UserName</a> = <span class="s">&quot;Azure&quot;</span>
                };
 
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="k">var</a> <span id="r70 rd" class="r70 r">credentialDataPtr</span> = <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#ad604d46784bcdda" class="i method">AllocHGlobal</a>(<a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#d71739319af5a9d4" class="i method">SizeOf</a>(<span class="r69 r">credentialData</span>));
 
                <b>try</b>
                {
                    <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#ef8bb2f25ef4f5d7" class="i method">StructureToPtr</a>(<span class="r69 r">credentialData</span>, <span class="r70 r">credentialDataPtr</span>, <b>false</b>);
                    <a href="/Azure.Identity/A.html#9e9fce24d89a2c8f" class="t t">WindowsNativeMethods</a>.<a href="/Azure.Identity/A.html#c51127ae5e6ccec3" class="i method">CredWrite</a>(<span class="r70 r">credentialDataPtr</span>);
                    <b>return</b> <b>new</b> <a href="#7e0dc90a1d9a437a" class="t constructor">WindowsRefreshTokenFixture</a>(<span class="r67 r">target</span>);
                }
                <b>finally</b>
                {
                    <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#eebf9c918f94b6bd" class="i method">FreeHGlobal</a>(<span class="r70 r">credentialDataPtr</span>);
                    <a href="@0@mscorlib/A.html#489a61c84168b119" class="t t">Marshal</a>.<a href="@0@mscorlib/A.html#eebf9c918f94b6bd" class="i method">FreeHGlobal</a>(<span class="r68 r">credentialBlobPtr</span>);
                }
            }
 
            <b>private</b> <a id="7e0dc90a1d9a437a" href="R/7e0dc90a1d9a437a.html" target="n" data-glyph="76,2" class="t constructor">WindowsRefreshTokenFixture</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r71 rd" class="r71 r">target</span>)
            {
                <a href="#22dfef680684dc58" class="i field">_target</a> = <span class="r71 r">target</span>;
            }
 
            <b>public void</b> <a id="eff6854eead8c0e3" href="R/eff6854eead8c0e3.html" target="n" data-glyph="72,2" class="i method">Dispose</a>() =&gt; <a href="/Azure.Identity/A.html#9e9fce24d89a2c8f" class="t t">WindowsNativeMethods</a>.<a href="/Azure.Identity/A.html#f8dad8a6152fffac" class="i method">CredDelete</a>(<a href="#22dfef680684dc58" class="i field">_target</a>, <a href="/Azure.Identity/A.html#9e9fce24d89a2c8f" class="t t">WindowsNativeMethods</a>.<a href="/Azure.Identity/A.html#36c91679188be41d" class="t t">CRED_TYPE</a>.<a href="/Azure.Identity/A.html#e8dcd916c85d5996" class="i field">GENERIC</a>);
        }
 
        <b>private sealed class</b> <a id="56a77a8b755ab974" href="R/56a77a8b755ab974.html" target="n" data-glyph="4,1" class="t t">OsxRefreshTokenFixture</a> : <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
        {
            <b>private readonly string</b> <a id="77fccdd90baf2f5c" href="R/77fccdd90baf2f5c.html" target="n" data-glyph="46,2" class="i field">_serviceName</a>;
            <b>private readonly string</b> <a id="972e38247d963b26" href="R/972e38247d963b26.html" target="n" data-glyph="46,2" class="i field">_cloudName</a>;
 
            <b>public static</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="f6d439d519a6e3b7" href="R/f6d439d519a6e3b7.html" target="n" data-glyph="72,2" class="i method">Create</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r72 rd" class="r72 r">serviceName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r73 rd" class="r73 r">cloudName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r74 rd" class="r74 r">refreshToken</span>)
            {
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r75 rd" class="r75 r">itemRef</span> = <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>;
 
                <b>try</b>
                {
                    <a href="/Azure.Identity/A.html#d12d920fab918357" class="t t">MacosNativeMethods</a>.<a href="/Azure.Identity/A.html#40e76728c33d2467" class="i method">SecKeychainAddGenericPassword</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>, <span class="r72 r">serviceName</span>, <span class="r73 r">cloudName</span>, <span class="r74 r">refreshToken</span>, <b>out</b> <span class="r75 r">itemRef</span>);
                }
                <b>finally</b>
                {
                    <a href="/Azure.Identity/A.html#d12d920fab918357" class="t t">MacosNativeMethods</a>.<a href="/Azure.Identity/A.html#2189e8fb80bbb05c" class="i method">CFRelease</a>(<span class="r75 r">itemRef</span>);
                }
 
                <b>return</b> <b>new</b> <a href="#a6b9377a8f663bf1" class="t constructor">OsxRefreshTokenFixture</a>(<span class="r72 r">serviceName</span>, <span class="r73 r">cloudName</span>);
            }
 
            <b>private</b> <a id="a6b9377a8f663bf1" href="R/a6b9377a8f663bf1.html" target="n" data-glyph="76,2" class="t constructor">OsxRefreshTokenFixture</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r76 rd" class="r76 r">serviceName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r77 rd" class="r77 r">cloudName</span>)
            {
                <a href="#77fccdd90baf2f5c" class="i field">_serviceName</a> = <span class="r76 r">serviceName</span>;
                <a href="#972e38247d963b26" class="i field">_cloudName</a> = <span class="r77 r">cloudName</span>;
            }
 
            <b>public void</b> <a id="76fc95fef2dd0ad0" href="R/76fc95fef2dd0ad0.html" target="n" data-glyph="72,2" class="i method">Dispose</a>()
            {
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r78 rd" class="r78 r">credentialsPtr</span> = <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>;
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r79 rd" class="r79 r">itemRef</span> = <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>;
 
                <b>try</b>
                {
                    <a href="/Azure.Identity/A.html#d12d920fab918357" class="t t">MacosNativeMethods</a>.<a href="/Azure.Identity/A.html#b1d6dd1d0982eb6f" class="i method">SecKeychainFindGenericPassword</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>, <a href="#77fccdd90baf2f5c" class="i field">_serviceName</a>, <a href="#972e38247d963b26" class="i field">_cloudName</a>, <b>out _</b>, <b>out</b> <span class="r78 r">credentialsPtr</span>, <b>out</b> <span class="r79 r">itemRef</span>);
                    <a href="/Azure.Identity/A.html#d12d920fab918357" class="t t">MacosNativeMethods</a>.<a href="/Azure.Identity/A.html#b5b4447ae3949a43" class="i method">SecKeychainItemDelete</a>(<span class="r79 r">itemRef</span>);
                }
                <b>finally</b>
                {
                    <b>try</b>
                    {
                        <a href="/Azure.Identity/A.html#d12d920fab918357" class="t t">MacosNativeMethods</a>.<a href="/Azure.Identity/A.html#dcdaa181fad02509" class="i method">SecKeychainItemFreeContent</a>(<a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>, <span class="r78 r">credentialsPtr</span>);
                    }
                    <b>finally</b>
                    {
                        <a href="/Azure.Identity/A.html#d12d920fab918357" class="t t">MacosNativeMethods</a>.<a href="/Azure.Identity/A.html#2189e8fb80bbb05c" class="i method">CFRelease</a>(<span class="r79 r">itemRef</span>);
                    }
                }
            }
        }
 
        <b>private sealed class</b> <a id="be403ecfd790cd29" href="R/be403ecfd790cd29.html" target="n" data-glyph="4,1" class="t t">LinuxRefreshTokenFixture</a> : <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a>
        {
            <b>private readonly string</b> <a id="1941bbd0a8bc9f67" href="R/1941bbd0a8bc9f67.html" target="n" data-glyph="46,2" class="i field">_serviceName</a>;
            <b>private readonly string</b> <a id="0a74f8dd52c94fb4" href="R/0a74f8dd52c94fb4.html" target="n" data-glyph="46,2" class="i field">_cloudName</a>;
 
            <b>public static</b> <a href="@0@mscorlib/A.html#1f55292c3174123d" class="t t">IDisposable</a> <a id="658c5052cd76623c" href="R/658c5052cd76623c.html" target="n" data-glyph="72,2" class="i method">Create</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r80 rd" class="r80 r">serviceName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r81 rd" class="r81 r">cloudName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r82 rd" class="r82 r">refreshToken</span>)
            {
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r83 rd" class="r83 r">schemaPtr</span> = <a href="#032d163eff82493f" class="i method">GetLibsecretSchema</a>();
 
                <b>try</b>
                {
                    <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#31b523954f9f0f54" class="i method">secret_password_store_sync</a>(<span class="r83 r">schemaPtr</span>, <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#c9d57ecce8e1ce39" class="i field">SECRET_COLLECTION_SESSION</a>, <span class="s">$&quot;</span>{<span class="r80 r">serviceName</span>}<span class="s">/</span>{<span class="r81 r">cloudName</span>}<span class="s">&quot;</span>, <span class="r82 r">refreshToken</span>, <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>, <span class="s">&quot;service&quot;</span>, <span class="r80 r">serviceName</span>, <span class="s">&quot;account&quot;</span>, <span class="r81 r">cloudName</span>);
                }
                <b>finally</b>
                {
                    <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#c3663dd3dce80779" class="i method">secret_schema_unref</a>(<span class="r83 r">schemaPtr</span>);
                }
 
                <b>return</b> <b>new</b> <a href="#fe4ed06c8de2d009" class="t constructor">LinuxRefreshTokenFixture</a>(<span class="r80 r">serviceName</span>, <span class="r81 r">cloudName</span>);
            }
 
            <b>public</b> <a id="fe4ed06c8de2d009" href="R/fe4ed06c8de2d009.html" target="n" data-glyph="72,2" class="t constructor">LinuxRefreshTokenFixture</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r84 rd" class="r84 r">serviceName</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r85 rd" class="r85 r">cloudName</span>)
            {
                <a href="#1941bbd0a8bc9f67" class="i field">_serviceName</a> = <span class="r84 r">serviceName</span>;
                <a href="#0a74f8dd52c94fb4" class="i field">_cloudName</a> = <span class="r85 r">cloudName</span>;
            }
 
            <b>public void</b> <a id="ab26b389d9723651" href="R/ab26b389d9723651.html" target="n" data-glyph="72,2" class="i method">Dispose</a>()
            {
                <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <span id="r86 rd" class="r86 r">schemaPtr</span> = <a href="#032d163eff82493f" class="i method">GetLibsecretSchema</a>();
 
                <b>try</b>
                {
                    <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#9eabc8b598331017" class="i method">secret_password_clear_sync</a>(<span class="r86 r">schemaPtr</span>, <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a>.<a href="@0@mscorlib/A.html#d46202ed9b6005b2" class="i field">Zero</a>, <span class="s">&quot;service&quot;</span>, <a href="#1941bbd0a8bc9f67" class="i field">_serviceName</a>, <span class="s">&quot;account&quot;</span>, <a href="#0a74f8dd52c94fb4" class="i field">_cloudName</a>);
                }
                <b>finally</b>
                {
                    <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#c3663dd3dce80779" class="i method">secret_schema_unref</a>(<span class="r86 r">schemaPtr</span>);
                }
            }
 
            <b>private static</b> <a href="@0@mscorlib/A.html#d99bf6ad49979009" class="t t">IntPtr</a> <a id="032d163eff82493f" href="R/032d163eff82493f.html" target="n" data-glyph="76,2" class="i method">GetLibsecretSchema</a>()
                =&gt; <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#ccc8b606fe94a6b0" class="i method">secret_schema_new</a>(<span class="s">&quot;org.freedesktop.Secret.Generic&quot;</span>,
                    <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#17441b4ed7bb95f8" class="t t">SecretSchemaFlags</a>.<a href="/Azure.Identity/A.html#08dc8b1a13fb4095" class="i field">SECRET_SCHEMA_DONT_MATCH_NAME</a>,
                    <span class="s">&quot;service&quot;</span>,
                    <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#c128e4a77655b6d9" class="t t">SecretSchemaAttributeType</a>.<a href="/Azure.Identity/A.html#7d9b08e83a87772f" class="i field">SECRET_SCHEMA_ATTRIBUTE_STRING</a>,
                    <span class="s">&quot;account&quot;</span>,
                    <a href="/Azure.Identity/A.html#8c6ed1440536a9c9" class="t t">LinuxNativeMethods</a>.<a href="/Azure.Identity/A.html#c128e4a77655b6d9" class="t t">SecretSchemaAttributeType</a>.<a href="/Azure.Identity/A.html#7d9b08e83a87772f" class="i field">SECRET_SCHEMA_ATTRIBUTE_STRING</a>);
        }
    }
}
</pre></td></tr></table></div></body></html>
