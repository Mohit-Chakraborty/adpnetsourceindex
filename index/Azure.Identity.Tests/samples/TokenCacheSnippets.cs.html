<!DOCTYPE html>
<html><head><title>TokenCacheSnippets.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(112);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Identity.Tests/samples/TokenCacheSnippets.cs" target="_top">samples\TokenCacheSnippets.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/identity/Azure.Identity/tests/samples/TokenCacheSnippets.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Identity.Tests" target="_top">Azure.Identity.Tests.csproj</a> (Azure.Identity.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Azure</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CS8892</span> <span class="c">// Method &#39;UserAuthenticationSnippets.Main()&#39; will not be used as an entry point because a synchronous entry point &#39;AutoGeneratedProgram.Main(string[])&#39; was found.</span>
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>.<span class="i n">Samples</span>
{
    <b>public class</b> <a id="9f0777f8288ea5de" href="../R/../../0000000000.html" target="n" data-glyph="0,0" class="t t"><span id="55432546ac2ea150">TokenCacheSnippets</span></a>
    {
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Identity_TokenCache_CustomPersistence_Usage_TokenCachePath
        <b>private const string</b> <a id="7df22f9102049852" href="../R/7df22f9102049852.html" target="n" data-glyph="10,1" class="i field">TOKEN_CACHE_PATH</a> = <span class="s">&quot;./tokencache.bin&quot;</span>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <b>public void</b> <a id="041e26389b3141ec" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Identity_TokenCache_PersistentDefault</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Identity_TokenCache_PersistentDefault
            <a href="/Azure.Identity/A.html#413f5d23e0e79034" class="k">var</a> <span id="r0 rd" class="r0 r">credential</span> = <b>new</b> <a href="/Azure.Identity/A.html#f559650b4f0eccd3" class="t constructor">InteractiveBrowserCredential</a>(
                <b>new</b> <a href="/Azure.Identity/A.html#b83da106f8611392" class="t constructor">InteractiveBrowserCredentialOptions</a> {
                    <a href="/Azure.Identity/A.html#ce1b743931fd9201" class="i property">TokenCache</a> = <b>new</b> <a href="/Azure.Identity/A.html#f2f05c1ae04652f0" class="t constructor">PersistentTokenCache</a>()
                });
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <b>public void</b> <a id="bf1f3fc5f4738cb1" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Identity_TokenCache_PersistentNamed</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Identity_TokenCache_PersistentNamed
            <a href="/Azure.Identity/A.html#cf0d5f4f3763f0bc" class="k">var</a> <span id="r1 rd" class="r1 r">tokenCache</span> = <b>new</b> <a href="/Azure.Identity/A.html#f2f05c1ae04652f0" class="t constructor">PersistentTokenCache</a>(
                <b>new</b> <a href="/Azure.Identity/A.html#da148d6cadb90fd8" class="t constructor">PersistentTokenCacheOptions</a> { <a href="/Azure.Identity/A.html#36b105b6b2f0f772" class="i property">Name</a> = <span class="s">&quot;my_application_name&quot;</span> }
            );
 
            <a href="/Azure.Identity/A.html#413f5d23e0e79034" class="k">var</a> <span id="r2 rd" class="r2 r">credential</span> = <b>new</b> <a href="/Azure.Identity/A.html#f559650b4f0eccd3" class="t constructor">InteractiveBrowserCredential</a>(
                <b>new</b> <a href="/Azure.Identity/A.html#b83da106f8611392" class="t constructor">InteractiveBrowserCredentialOptions</a> { <a href="/Azure.Identity/A.html#ce1b743931fd9201" class="i property">TokenCache</a> = <span class="r1 r">tokenCache</span> }
            );
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <b>public void</b> <a id="996338ba501e77cd" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Identity_TokenCache_PersistentUnencrypted</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Identity_TokenCache_PersistentUnencrypted
            <a href="/Azure.Identity/A.html#cf0d5f4f3763f0bc" class="k">var</a> <span id="r3 rd" class="r3 r">tokenCache</span> = <b>new</b> <a href="/Azure.Identity/A.html#f2f05c1ae04652f0" class="t constructor">PersistentTokenCache</a>(
                <b>new</b> <a href="/Azure.Identity/A.html#da148d6cadb90fd8" class="t constructor">PersistentTokenCacheOptions</a> { <a href="/Azure.Identity/A.html#17ff46f0f62eeb36" class="i property">AllowUnencryptedStorage</a> = <b>true</b> }
            );
 
            <a href="/Azure.Identity/A.html#413f5d23e0e79034" class="k">var</a> <span id="r4 rd" class="r4 r">credential</span> = <b>new</b> <a href="/Azure.Identity/A.html#f559650b4f0eccd3" class="t constructor">InteractiveBrowserCredential</a>(
                <b>new</b> <a href="/Azure.Identity/A.html#b83da106f8611392" class="t constructor">InteractiveBrowserCredentialOptions</a> { <a href="/Azure.Identity/A.html#ce1b743931fd9201" class="i property">TokenCache</a> =  <span class="r3 r">tokenCache</span>}
            );
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="e2badacd4be2ac9f" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Identity_TokenCache_CustomPersistence_Read</a>()
        {
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Identity_TokenCache_CustomPersistence_Read
            <a href="/Azure.Identity/A.html#f7486f13450160f0" class="t t">TokenCache</a> <span id="r5 rd" class="r5 r">tokenCache</span>;
 
            <b>using</b> (<a href="@0@mscorlib/A.html#e23a38af5d11ddd3" class="k">var</a> <span id="r6 rd" class="r6 r">cacheStream</span> = <b>new</b> <a href="@0@mscorlib/A.html#234a29d0d3012e5c" class="t constructor">FileStream</a>(<a href="#7df22f9102049852" class="i field">TOKEN_CACHE_PATH</a>, <a href="@0@mscorlib/A.html#c0cb6ba6af625b3a" class="t t">FileMode</a>.<a href="@0@mscorlib/A.html#80a500db887477f8" class="i field">OpenOrCreate</a>, <a href="@0@mscorlib/A.html#5cc5644ae3acd24b" class="t t">FileAccess</a>.<a href="@0@mscorlib/A.html#0f1c68c756d0636b" class="i field">Read</a>))
            {
                <span class="r5 r">tokenCache</span> = <b>await</b> <a href="/Azure.Identity/A.html#f60e59d8e927e80d" class="t t">TokenCacheSerializer</a>.<a href="/Azure.Identity/A.html#9535adae2e3f1e71" class="i method">DeserializeAsync</a>(<span class="r6 r">cacheStream</span>);
            }
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="284a9f3501716e9e" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Identity_TokenCache_CustomPersistence_Write</a>()
        {
            <a href="/Azure.Identity/A.html#f7486f13450160f0" class="k">var</a> <span id="r7 rd" class="r7 r">tokenCache</span> = <b>new</b> <a href="/Azure.Identity/A.html#fd1f32013ce191d6" class="t constructor">TokenCache</a>();
 
            <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Identity_TokenCache_CustomPersistence_Write
            <b>using</b> (<a href="@0@mscorlib/A.html#e23a38af5d11ddd3" class="k">var</a> <span id="r8 rd" class="r8 r">cacheStream</span> = <b>new</b> <a href="@0@mscorlib/A.html#234a29d0d3012e5c" class="t constructor">FileStream</a>(<a href="#7df22f9102049852" class="i field">TOKEN_CACHE_PATH</a>, <a href="@0@mscorlib/A.html#c0cb6ba6af625b3a" class="t t">FileMode</a>.<a href="@0@mscorlib/A.html#17684d43e30dc120" class="i field">Create</a>, <a href="@0@mscorlib/A.html#5cc5644ae3acd24b" class="t t">FileAccess</a>.<a href="@0@mscorlib/A.html#4715fa16da583c25" class="i field">Write</a>))
            {
                <b>await</b> <a href="/Azure.Identity/A.html#f60e59d8e927e80d" class="t t">TokenCacheSerializer</a>.<a href="/Azure.Identity/A.html#d031c7abd8383bdc" class="i method">SerializeAsync</a>(<span class="r7 r">tokenCache</span>, <span class="r8 r">cacheStream</span>);
            }
            <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Snippet:Identity_TokenCache_CustomPersistence_Usage
        <b>public static async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="/Azure.Identity/A.html#f7486f13450160f0" class="t t">TokenCache</a>&gt; <a id="96ecae6ea8ba2478" href="../R/96ecae6ea8ba2478.html" target="n" data-glyph="72,1" class="i method">ReadTokenCacheAsync</a>()
        {
            <a href="/Azure.Identity/A.html#f7486f13450160f0" class="t t">TokenCache</a> <span id="r9 rd" class="r9 r">tokenCache</span>;
 
            <b>using</b> (<a href="@0@mscorlib/A.html#e23a38af5d11ddd3" class="k">var</a> <span id="r10 rd" class="r10 r">cacheStream</span> = <b>new</b> <a href="@0@mscorlib/A.html#234a29d0d3012e5c" class="t constructor">FileStream</a>(<a href="#7df22f9102049852" class="i field">TOKEN_CACHE_PATH</a>, <a href="@0@mscorlib/A.html#c0cb6ba6af625b3a" class="t t">FileMode</a>.<a href="@0@mscorlib/A.html#80a500db887477f8" class="i field">OpenOrCreate</a>, <a href="@0@mscorlib/A.html#5cc5644ae3acd24b" class="t t">FileAccess</a>.<a href="@0@mscorlib/A.html#0f1c68c756d0636b" class="i field">Read</a>))
            {
                <span class="r9 r">tokenCache</span> = <b>await</b> <a href="/Azure.Identity/A.html#f60e59d8e927e80d" class="t t">TokenCacheSerializer</a>.<a href="/Azure.Identity/A.html#9535adae2e3f1e71" class="i method">DeserializeAsync</a>(<span class="r10 r">cacheStream</span>);
                <span class="r9 r">tokenCache</span>.<a href="/Azure.Identity/A.html#5f7d26663a86c521" class="i">Updated</a> += <a href="#306b864e5750edaf" class="i method">WriteCacheOnUpdateAsync</a>;
            }
 
            <b>return</b> <span class="r9 r">tokenCache</span>;
        }
 
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="306b864e5750edaf" href="../R/306b864e5750edaf.html" target="n" data-glyph="72,1" class="i method">WriteCacheOnUpdateAsync</a>(<a href="/Azure.Identity/A.html#5da0c9c92e4d21f1" class="t t">TokenCacheUpdatedArgs</a> <span id="r11 rd" class="r11 r">args</span>)
        {
            <b>using</b> (<a href="@0@mscorlib/A.html#e23a38af5d11ddd3" class="k">var</a> <span id="r12 rd" class="r12 r">cacheStream</span> = <b>new</b> <a href="@0@mscorlib/A.html#234a29d0d3012e5c" class="t constructor">FileStream</a>(<a href="#7df22f9102049852" class="i field">TOKEN_CACHE_PATH</a>, <a href="@0@mscorlib/A.html#c0cb6ba6af625b3a" class="t t">FileMode</a>.<a href="@0@mscorlib/A.html#17684d43e30dc120" class="i field">Create</a>, <a href="@0@mscorlib/A.html#5cc5644ae3acd24b" class="t t">FileAccess</a>.<a href="@0@mscorlib/A.html#4715fa16da583c25" class="i field">Write</a>))
            {
                <b>await</b> <a href="/Azure.Identity/A.html#f60e59d8e927e80d" class="t t">TokenCacheSerializer</a>.<a href="/Azure.Identity/A.html#d031c7abd8383bdc" class="i method">SerializeAsync</a>(<span class="r11 r">args</span>.<a href="/Azure.Identity/A.html#836c42d3fa9e90d7" class="i property">Cache</a>, <span class="r12 r">cacheStream</span>);
            }
        }
 
        <b>public static async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="78435a728d3a4040" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Main</a>()
        {
            <a href="/Azure.Identity/A.html#f7486f13450160f0" class="k">var</a> <span id="r13 rd" class="r13 r">tokenCache</span> = <b>await</b> <a href="#96ecae6ea8ba2478" class="i method">ReadTokenCacheAsync</a>();
 
            <a href="/Azure.Identity/A.html#413f5d23e0e79034" class="k">var</a> <span id="r14 rd" class="r14 r">credential</span> = <b>new</b> <a href="/Azure.Identity/A.html#f559650b4f0eccd3" class="t constructor">InteractiveBrowserCredential</a>(
                <b>new</b> <a href="/Azure.Identity/A.html#b83da106f8611392" class="t constructor">InteractiveBrowserCredentialOptions</a> { <a href="/Azure.Identity/A.html#ce1b743931fd9201" class="i property">TokenCache</a> = <span class="r13 r">tokenCache</span> }
            );
        }
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
