<!DOCTYPE html>
<html><head><title>CredentialTestBase.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(426);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Identity.Tests/CredentialTestBase.cs" target="_top">CredentialTestBase.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/identity/Azure.Identity/tests/CredentialTestBase.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Identity.Tests" target="_top">Azure.Identity.Tests.csproj</a> (Azure.Identity.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">Tracing</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">Json</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">TestFramework</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>.<span class="i n">Tests</span>.<span class="i n">Mock</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Identity</span>.<span class="i n">Client</span>;
<b>using</b> <span class="i n">NUnit</span>.<span class="i n">Framework</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>.<span class="i n">Tests</span>
{
    <b>public abstract class</b> <a id="6266551867b5bb05" href="R/6266551867b5bb05.html" target="n" data-glyph="0,0" class="t t">CredentialTestBase</a> : <a href="/Azure.Core.TestFramework/A.html#3fc3fa6031b8ce5e" class="t t">ClientTestBase</a>
    {
        <b>protected const string</b> <a id="3ded116cf5a8fdb5" href="R/3ded116cf5a8fdb5.html" target="n" data-glyph="9,1" class="i field">Scope</a> = <span class="s">&quot;https://vault.azure.net/.default&quot;</span>;
        <b>protected const string</b> <a id="ed5426e95a0b8e9f" href="R/ed5426e95a0b8e9f.html" target="n" data-glyph="9,1" class="i field">TenantIdHint</a> = <a href="../GuidAssembly/R/a0287521-e002-0026-7112-207c0c001234.html" target="n" class="s">&quot;a0287521-e002-0026-7112-207c0c001234&quot;</a>;
        <b>protected const string</b> <a id="70fd0194bc78b1c6" href="R/70fd0194bc78b1c6.html" target="n" data-glyph="9,1" class="i field">ClientId</a> = <a href="../GuidAssembly/R/04b07795-8ddb-461a-bbee-02f9e1bf7b46.html" target="n" class="s">&quot;04b07795-8ddb-461a-bbee-02f9e1bf7b46&quot;</a>;
        <b>protected const string</b> <a id="62afd43d3f5cb514" href="R/62afd43d3f5cb514.html" target="n" data-glyph="9,1" class="i field">TenantId</a> = <a href="../GuidAssembly/R/a0287521-e002-0026-7112-207c0c000000.html" target="n" class="s">&quot;a0287521-e002-0026-7112-207c0c000000&quot;</a>;
        <b>protected const string</b> <a id="72c20251e7cf4721" href="R/72c20251e7cf4721.html" target="n" data-glyph="9,1" class="i field">expectedUsername</a> = <span class="s">&quot;mockuser@mockdomain.com&quot;</span>;
        <b>protected string</b> <a id="a1e8b20d0b9f2e86" href="R/a1e8b20d0b9f2e86.html" target="n" data-glyph="45,1" class="i field">expectedToken</a>;
        <b>protected string</b> <a id="660592f0b54e9cd8" href="R/660592f0b54e9cd8.html" target="n" data-glyph="45,1" class="i field">expectedUserAssertion</a>;
        <b>protected string</b> <a id="b7dc83377b596516" href="R/b7dc83377b596516.html" target="n" data-glyph="45,1" class="i field">expectedTenantId</a>;
        <b>protected string</b> <a id="f20565359794c17e" href="R/f20565359794c17e.html" target="n" data-glyph="45,1" class="i field">expectedReplyUri</a>;
        <b>protected string</b> <a id="9d577e2c3a53cc39" href="R/9d577e2c3a53cc39.html" target="n" data-glyph="45,1" class="i field">authCode</a>;
        <b>protected const string</b> <a id="d3af15756f0b5c49" href="R/d3af15756f0b5c49.html" target="n" data-glyph="9,1" class="i field">ReplyUrl</a> = <span class="s">&quot;https://myredirect/&quot;</span>;
        <b>protected string</b> <a id="411f6cdbac9f80e2" href="R/411f6cdbac9f80e2.html" target="n" data-glyph="45,1" class="i field">clientSecret</a> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
        <b>protected</b> <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <a id="b096661ab56300ad" href="R/b096661ab56300ad.html" target="n" data-glyph="45,1" class="i field">expiresOn</a>;
        <b>internal</b> <a href="Mock/MockMsalConfidentialClient.cs.html#a748e4b7288bcd7a" class="t t">MockMsalConfidentialClient</a> <a id="bddf6ab05e4d38b6" href="R/bddf6ab05e4d38b6.html" target="n" data-glyph="44,1" class="i field">mockConfidentialMsalClient</a>;
        <b>internal</b> <a href="Mock/MockMsalPublicClient.cs.html#9076dccec6708b6f" class="t t">MockMsalPublicClient</a> <a id="cea2989d7f2e70d5" href="R/cea2989d7f2e70d5.html" target="n" data-glyph="44,1" class="i field">mockPublicMsalClient</a>;
        <b>protected</b> <a href="/Azure.Identity/A.html#dafb68b5bfeb49a1" class="t t">TokenCredentialOptions</a> <a id="35df151d3b95c64e" href="R/35df151d3b95c64e.html" target="n" data-glyph="45,1" class="i field">options</a>;
        <b>protected</b> <span class="t t">AuthenticationResult</span> <a id="993ca79b5750cc3a" href="R/993ca79b5750cc3a.html" target="n" data-glyph="45,1" class="i field">result</a>;
        <b>protected string</b> <a id="2bb00d5695fa1e4a" href="R/2bb00d5695fa1e4a.html" target="n" data-glyph="45,1" class="i field">expectedCode</a>;
        <b>protected</b> <span class="t t">DeviceCodeResult</span> <a id="96c166105cb7aff6" href="R/96c166105cb7aff6.html" target="n" data-glyph="45,1" class="i field">deviceCodeResult</a>;
 
        <b>protected const string</b> <a id="5cd916c99bc14f99" href="R/5cd916c99bc14f99.html" target="n" data-glyph="9,1" class="i field">DiscoveryResponseBody</a> =
            <span class="s">&quot;{\&quot;tenant_discovery_endpoint\&quot;: \&quot;https://login.microsoftonline.com/c54fac88-3dd3-461f-a7c4-8a368e0340b3/v2.0/.well-known/openid-configuration\&quot;,\&quot;api-version\&quot;: \&quot;1.1\&quot;,\&quot;metadata\&quot;:[{\&quot;preferred_network\&quot;: \&quot;login.microsoftonline.com\&quot;,\&quot;preferred_cache\&quot;: \&quot;login.windows.net\&quot;,\&quot;aliases\&quot;:[\&quot;login.microsoftonline.com\&quot;,\&quot;login.windows.net\&quot;,\&quot;login.microsoft.com\&quot;,\&quot;sts.windows.net\&quot;]},{\&quot;preferred_network\&quot;: \&quot;login.partner.microsoftonline.cn\&quot;,\&quot;preferred_cache\&quot;: \&quot;login.partner.microsoftonline.cn\&quot;,\&quot;aliases\&quot;:[\&quot;login.partner.microsoftonline.cn\&quot;,\&quot;login.chinacloudapi.cn\&quot;]},{\&quot;preferred_network\&quot;: \&quot;login.microsoftonline.de\&quot;,\&quot;preferred_cache\&quot;: \&quot;login.microsoftonline.de\&quot;,\&quot;aliases\&quot;:[\&quot;login.microsoftonline.de\&quot;]},{\&quot;preferred_network\&quot;: \&quot;login.microsoftonline.us\&quot;,\&quot;preferred_cache\&quot;: \&quot;login.microsoftonline.us\&quot;,\&quot;aliases\&quot;:[\&quot;login.microsoftonline.us\&quot;,\&quot;login.usgovcloudapi.net\&quot;]},{\&quot;preferred_network\&quot;: \&quot;login-us.microsoftonline.com\&quot;,\&quot;preferred_cache\&quot;: \&quot;login-us.microsoftonline.com\&quot;,\&quot;aliases\&quot;:[\&quot;login-us.microsoftonline.com\&quot;]}]}&quot;</span>;
 
        <b>public</b> <a id="7c7e9e8cc984cb39" href="R/7c7e9e8cc984cb39.html" target="n" data-glyph="72,1" class="t constructor">CredentialTestBase</a>(<b>bool</b> <span id="r0 rd" class="r0 r">isAsync</span>) : <a href="/Azure.Core.TestFramework/A.html#c7659bbcafd87c98" class="k">base</a>(<span class="r0 r">isAsync</span>)
        {
        }
 
        <b>public abstract</b> <a href="/Azure.Core/A.html#d93a9ffee404e938" class="t t">TokenCredential</a> <a id="fbb793416fecff9b" href="R/fbb793416fecff9b.html" target="n" data-glyph="72,1" class="i method">GetTokenCredential</a>(<a href="/Azure.Identity/A.html#dafb68b5bfeb49a1" class="t t">TokenCredentialOptions</a> <span id="r1 rd" class="r1 r">options</span>);
 
        [<span class="t constructor">Test</span>]
        <b>public async</b> <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="5f9e74ec67d9f463" href="R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">IsAccountIdentifierLoggingEnabled</a>([<span class="t constructor">Values</span>(<b>true</b>, <b>false</b>)] <b>bool</b> <span id="r2 rd" class="r2 r">isOptionSet</span>)
        {
            <a href="/Azure.Identity/A.html#dafb68b5bfeb49a1" class="k">var</a> <span id="r3 rd" class="r3 r">options</span> = <b>new</b> <a href="/Azure.Identity/A.html#b897d34e43e8b601" class="t constructor">TokenCredentialOptions</a> { <a href="/Azure.Identity/A.html#f2fa3532972eab1c" class="i property">Diagnostics</a> = { <a href="/Azure.Identity/A.html#cdcc357b4f799fdc" class="i property">IsAccountIdentifierLoggingEnabled</a> = <span class="r2 r">isOptionSet</span> } };
            <a href="#56086bb66a204bdb" class="i method">TestSetup</a>(<span class="r3 r">options</span>);
            <a href="#b7dc83377b596516" class="i field">expectedTenantId</a> = <a href="#62afd43d3f5cb514" class="i field">TenantId</a>;
            <b>using</b> <a href="/Azure.Core.TestFramework/A.html#5c8cbc7b9ecad8a5" class="k">var</a> <span id="r4 rd" class="r4 r">_listener</span> = <b>new</b> <a href="/Azure.Core.TestFramework/A.html#526cf8ef71b8b08b" class="t constructor">TestEventListener</a>();
            <span class="r4 r">_listener</span>.<a href="@0@mscorlib/A.html#5e21ae33e3d72714" class="i method">EnableEvents</a>(<a href="/Azure.Identity/A.html#701613034463cf11" class="t t">AzureIdentityEventSource</a>.<a href="/Azure.Identity/A.html#98bb7a765a3c850a" class="i property">Singleton</a>, <a href="@0@mscorlib/A.html#d492a500d07778e6" class="t t">EventLevel</a>.<a href="@0@mscorlib/A.html#238fa91fc75be60e" class="i field">Verbose</a>);
            <a href="/Azure.Core/A.html#d93a9ffee404e938" class="k">var</a> <span id="r5 rd" class="r5 r">credential</span> = <a href="#fbb793416fecff9b" class="i method">GetTokenCredential</a>(<span class="r3 r">options</span>);
            <a href="/Azure.Core/A.html#9d9eb2813d5fd899" class="k">var</a> <span id="r6 rd" class="r6 r">context</span> = <b>new</b> <a href="/Azure.Core/A.html#c5c0cfb0c2523861" class="t constructor">TokenRequestContext</a>(<b>new</b>[] { <a href="#3ded116cf5a8fdb5" class="i field">Scope</a> }, <span class="r7 r">tenantId</span>: <a href="#62afd43d3f5cb514" class="i field">TenantId</a>);
            <b>await</b> <span class="r5 r">credential</span>.<a href="/Azure.Core/A.html#5d3072c4f10c9db9" class="i method">GetTokenAsync</a>(<span class="r6 r">context</span>, <b>default</b>);
 
            <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="k">var</a> <span id="r8 rd" class="r8 r">loggedEvents</span> = <span class="r4 r">_listener</span>.<a href="/Azure.Core.TestFramework/A.html#5f3e84ebf7a477ba" class="i method">EventsById</a>(<a href="/Azure.Identity/A.html#701613034463cf11" class="t t">AzureIdentityEventSource</a>.<a href="/Azure.Identity/A.html#9b786dc5355a42ca" class="i field">AuthenticatedAccountDetailsEvent</a>);
            <b>if</b> (<span class="r2 r">isOptionSet</span>)
            {
                <span class="t t">CollectionAssert</span>.<span class="i method">IsNotEmpty</span>(<span class="r8 r">loggedEvents</span>);
            }
            <b>else</b>
            {
                <span class="t t">CollectionAssert</span>.<span class="i method">IsEmpty</span>(<span class="r8 r">loggedEvents</span>);
            }
        }
 
        <b>public void</b> <a id="56086bb66a204bdb" href="R/56086bb66a204bdb.html" target="n" data-glyph="72,1" class="i method">TestSetup</a>(<a href="/Azure.Identity/A.html#dafb68b5bfeb49a1" class="t t">TokenCredentialOptions</a> <span id="r9 rd" class="r9 r">options</span> = <b>null</b>)
        {
            <a href="#b7dc83377b596516" class="i field">expectedTenantId</a> = <b>null</b>;
            <a href="#f20565359794c17e" class="i field">expectedReplyUri</a> = <b>null</b>;
            <a href="#9d577e2c3a53cc39" class="i field">authCode</a> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <span class="r9 r">options</span> = <span class="r9 r">options</span> ?? <b>new</b> <a href="/Azure.Identity/A.html#b897d34e43e8b601" class="t constructor">TokenCredentialOptions</a>();
            <a href="#a1e8b20d0b9f2e86" class="i field">expectedToken</a> = <a href="TokenGenerator.cs.html#1f30fe7d889dfc07" class="t t">TokenGenerator</a>.<a href="TokenGenerator.cs.html#8a0a43ad42c7da14" class="i method">GenerateToken</a>(<a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>(), <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>(), <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>(), <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>(), <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#b0d5e4c9a8d4ddac" class="i property">UtcNow</a>.<a href="@0@mscorlib/A.html#1673702782a58887" class="i method">AddHours</a>(1));
            <a href="#660592f0b54e9cd8" class="i field">expectedUserAssertion</a> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <a href="#b096661ab56300ad" class="i field">expiresOn</a> = <a href="@0@mscorlib/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@0@mscorlib/A.html#c6573f48ac6bd630" class="i property">Now</a>.<a href="@0@mscorlib/A.html#f349aa0ae92c3ec6" class="i method">AddHours</a>(1);
            <a href="#993ca79b5750cc3a" class="i field">result</a> = <b>new</b> <span class="t constructor">AuthenticationResult</span>(
                <a href="#a1e8b20d0b9f2e86" class="i field">expectedToken</a>,
                <b>false</b>,
                <b>null</b>,
                <a href="#b096661ab56300ad" class="i field">expiresOn</a>,
                <a href="#b096661ab56300ad" class="i field">expiresOn</a>,
                <a href="#62afd43d3f5cb514" class="i field">TenantId</a>,
                <b>new</b> <a href="Mock/MockAccount.cs.html#a0ce7c866540140c" class="t constructor">MockAccount</a>(<span class="s">&quot;username&quot;</span>),
                <b>null</b>,
                <b>new</b>[] {<a href="#3ded116cf5a8fdb5" class="i field">Scope</a>},
                <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>(),
                <b>null</b>,
                <span class="s">&quot;Bearer&quot;</span>);
 
            <a href="#bddf6ab05e4d38b6" class="i field">mockConfidentialMsalClient</a> = <b>new</b> <a href="Mock/MockMsalConfidentialClient.cs.html#e282d6051bc34570" class="t constructor">MockMsalConfidentialClient</a>(<b>null</b>, <b>null</b>, <b>null</b>, <b>null</b>, <b>null</b>, <span class="r9 r">options</span>)
                .<a href="Mock/MockMsalConfidentialClient.cs.html#6932b857ab80081a" class="i method">WithSilentFactory</a>(
                    (<b>_</b>, <span id="r10 rd" class="r10 r">_tenantId</span>, <span id="r11 rd" class="r11 r">_replyUri</span>, <b>_</b>) =&gt;
                    {
                        <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r10 r">_tenantId</span>);
                        <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#f20565359794c17e" class="i field">expectedReplyUri</a>, <span class="r11 r">_replyUri</span>);
                        <b>return</b> <b>new</b> <span class="t constructor">ValueTask</span>&lt;<span class="t t">AuthenticationResult</span>&gt;(<a href="#993ca79b5750cc3a" class="i field">result</a>);
                    })
                .<a href="Mock/MockMsalConfidentialClient.cs.html#c22477815802acb2" class="i method">WithAuthCodeFactory</a>(
                    (<b>_</b>, <span id="r12 rd" class="r12 r">_tenantId</span>, <span id="r13 rd" class="r13 r">_replyUri</span>, <b>_</b>) =&gt;
                    {
                        <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r12 r">_tenantId</span>);
                        <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#f20565359794c17e" class="i field">expectedReplyUri</a>, <span class="r13 r">_replyUri</span>);
                        <b>return</b> <a href="#993ca79b5750cc3a" class="i field">result</a>;
                    })
                .<a href="Mock/MockMsalConfidentialClient.cs.html#b0effa60c9d4e4e3" class="i method">WithOnBehalfOfFactory</a>(
                    (<b>_</b>, <b>_</b>, <span id="r14 rd" class="r14 r">userAssertion</span>, <b>_</b>, <b>_</b>) =&gt;
                    {
                        <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#660592f0b54e9cd8" class="i field">expectedUserAssertion</a>, <span class="r14 r">userAssertion</span>.<span class="i property">Assertion</span>);
                        <b>return</b> <b>new</b> <span class="t constructor">ValueTask</span>&lt;<span class="t t">AuthenticationResult</span>&gt;(<a href="#993ca79b5750cc3a" class="i field">result</a>);
                    })
                .<a href="Mock/MockMsalConfidentialClient.cs.html#c484dd3a68525243" class="i method">WithClientFactory</a>(
                    (<span id="r15 rd" class="r15 r">_</span>, <span id="r16 rd" class="r16 r">_tenantId</span>) =&gt;
                    {
                        <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r16 r">_tenantId</span>);
                        <b>return</b> <a href="#993ca79b5750cc3a" class="i field">result</a>;
                    });
 
            <a href="#2bb00d5695fa1e4a" class="i field">expectedCode</a> = <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>();
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a> = <b>new</b> <a href="Mock/MockMsalPublicClient.cs.html#e2d084aa7f45a39b" class="t constructor">MockMsalPublicClient</a>(<b>null</b>, <b>null</b>, <b>null</b>, <b>null</b>, <span class="r9 r">options</span>);
            <a href="#96c166105cb7aff6" class="i field">deviceCodeResult</a> = <a href="Mock/MockMsalPublicClient.cs.html#9076dccec6708b6f" class="t t">MockMsalPublicClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#ef8a79a64cbd0df4" class="i method">GetDeviceCodeResult</a>(<span class="r17 r">deviceCode</span>: <a href="#2bb00d5695fa1e4a" class="i field">expectedCode</a>);
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#ea08cc08c785b7eb" class="i property">DeviceCodeResult</a> = <a href="#96c166105cb7aff6" class="i field">deviceCodeResult</a>;
            <b>var</b> <span id="r18 rd" class="r18 r">publicResult</span> = <b>new</b> <span class="t constructor">AuthenticationResult</span>(
                <a href="#a1e8b20d0b9f2e86" class="i field">expectedToken</a>,
                <b>false</b>,
                <b>null</b>,
                <a href="#b096661ab56300ad" class="i field">expiresOn</a>,
                <a href="#b096661ab56300ad" class="i field">expiresOn</a>,
                <a href="#62afd43d3f5cb514" class="i field">TenantId</a>,
                <b>new</b> <a href="Mock/MockAccount.cs.html#a0ce7c866540140c" class="t constructor">MockAccount</a>(<span class="s">&quot;username&quot;</span>),
                <b>null</b>,
                <b>new</b>[] {<a href="#3ded116cf5a8fdb5" class="i field">Scope</a>},
                <a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>(),
                <b>null</b>,
                <span class="s">&quot;Bearer&quot;</span>);
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#cd7aa785cf5c3f7e" class="i property">SilentAuthFactory</a> = (<span id="r19 rd" class="r19 r">_</span>, <span id="r20 rd" class="r20 r">tId</span>) =&gt;
            {
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r20 r">tId</span>);
                <b>return</b> <span class="r18 r">publicResult</span>;
            };
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#a702c24fedc92b32" class="i property">DeviceCodeAuthFactory</a> = (<b>_</b>, <b>_</b>) =&gt;
            {
                <span class="c">// Assert.AreEqual(tenantId, tId);</span>
                <b>return</b> <span class="r18 r">publicResult</span>;
            };
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#9a61dc08da365389" class="i property">InteractiveAuthFactory</a> = (<b>_</b>, <b>_</b>, <b>_</b>, <b>_</b>, <span id="r21 rd" class="r21 r">tenant</span>, <b>_</b>, <b>_</b>) =&gt;
            {
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r21 r">tenant</span>, <span class="s">&quot;TenantId passed to msal should match&quot;</span>);
                <b>return</b> <a href="#993ca79b5750cc3a" class="i field">result</a>;
            };
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#cd7aa785cf5c3f7e" class="i property">SilentAuthFactory</a> = (<span id="r22 rd" class="r22 r">_</span>, <span id="r23 rd" class="r23 r">tenant</span>) =&gt;
            {
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r23 r">tenant</span>, <span class="s">&quot;TenantId passed to msal should match&quot;</span>);
                <b>return</b> <a href="#993ca79b5750cc3a" class="i field">result</a>;
            };
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#3f414150de30acbc" class="i property">ExtendedSilentAuthFactory</a> = (<b>_</b>, <b>_</b>, <b>_</b>, <span id="r24 rd" class="r24 r">tenant</span>, <b>_</b>, <b>_</b>) =&gt;
            {
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r24 r">tenant</span>, <span class="s">&quot;TenantId passed to msal should match&quot;</span>);
                <b>return</b> <a href="#993ca79b5750cc3a" class="i field">result</a>;
            };
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#72897f4614ea9f40" class="i property">UserPassAuthFactory</a> = (<span id="r25 rd" class="r25 r">_</span>, <span id="r26 rd" class="r26 r">tenant</span>) =&gt;
            {
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r26 r">tenant</span>, <span class="s">&quot;TenantId passed to msal should match&quot;</span>);
                <b>return</b> <a href="#993ca79b5750cc3a" class="i field">result</a>;
            };
            <a href="#cea2989d7f2e70d5" class="i field">mockPublicMsalClient</a>.<a href="Mock/MockMsalPublicClient.cs.html#696cb20851d39112" class="i property">RefreshTokenFactory</a> = (<b>_</b>, <b>_</b>, <b>_</b>, <b>_</b>, <span id="r27 rd" class="r27 r">tenant</span>, <b>_</b>, <b>_</b>) =&gt;
            {
                <span class="t t">Assert</span>.<span class="i method">AreEqual</span>(<a href="#b7dc83377b596516" class="i field">expectedTenantId</a>, <span class="r27 r">tenant</span>, <span class="s">&quot;TenantId passed to msal should match&quot;</span>);
                <b>return</b> <a href="#993ca79b5750cc3a" class="i field">result</a>;
            };
        }
 
        <b>protected async</b> <a href="@0@mscorlib/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>&gt; <a id="b01ddba8daa0c9c5" href="R/b01ddba8daa0c9c5.html" target="n" data-glyph="75,1" class="i method">ReadMockRequestContent</a>(<a href="/Azure.Core.TestFramework/A.html#73aa5a1075c6b033" class="t t">MockRequest</a> <span id="r28 rd" class="r28 r">request</span>)
        {
            <b>if</b> (<span class="r28 r">request</span>.<a href="/Azure.Core.TestFramework/A.html#414713479906a0a9" class="i property">Content</a> == <b>null</b>)
            {
                <b>return</b> <b>null</b>;
            }
 
            <b>using</b> <a href="@0@mscorlib/A.html#1a4dcb744a23ba6f" class="k">var</a> <span id="r29 rd" class="r29 r">memoryStream</span> = <b>new</b> <a href="@0@mscorlib/A.html#d308091cc690e78d" class="t constructor">MemoryStream</a>();
            <span class="r28 r">request</span>.<a href="/Azure.Core.TestFramework/A.html#414713479906a0a9" class="i property">Content</a>.<a href="/Azure.Core/A.html#0662e44f35dd6163" class="i method">WriteTo</a>(<span class="r29 r">memoryStream</span>, <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@0@mscorlib/A.html#ec32c41597007382" class="i property">None</a>);
            <span class="r29 r">memoryStream</span>.<a href="@0@mscorlib/A.html#ad08f8ca81a5a763" class="i property">Position</a> = 0;
            <b>using</b> (<a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="k">var</a> <span id="r30 rd" class="r30 r">streamReader</span> = <b>new</b> <a href="@0@mscorlib/A.html#72447927169f6b77" class="t constructor">StreamReader</a>(<span class="r29 r">memoryStream</span>))
            {
                <b>return</b> <b>await</b> <span class="r30 r">streamReader</span>.<a href="@0@mscorlib/A.html#670e67dfb6e4b237" class="i method">ReadToEndAsync</a>().<a href="@0@mscorlib/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
        }
 
        <b>protected</b> <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="t t">MockResponse</a> <a id="0efb9be08fdb8cbc" href="R/0efb9be08fdb8cbc.html" target="n" data-glyph="75,1" class="i method">CreateMockMsalTokenResponse</a>(<b>int</b> <span id="r31 rd" class="r31 r">responseCode</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r32 rd" class="r32 r">token</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r33 rd" class="r33 r">tenantId</span>,
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r34 rd" class="r34 r">userName</span>)
        {
            <a href="/Azure.Core.TestFramework/A.html#df767807e2c243e9" class="k">var</a> <span id="r35 rd" class="r35 r">response</span> = <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2adc622c2950d8" class="t constructor">MockResponse</a>(<span class="r31 r">responseCode</span>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r36 rd" class="r36 r">idToken</span> = <a href="#b625ff65ad64fa2f" class="i method">CreateMsalIdToken</a>(<a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>(), <span class="r34 r">userName</span>, <span class="r33 r">tenantId</span>);
            <span class="r35 r">response</span>.<a href="/Azure.Core.TestFramework/A.html#2af07c9f6a842649" class="i method">SetContent</a>(
                <span class="s">$&quot;</span><span class="s">{{\&quot;token_type\&quot;: \&quot;Bearer\&quot;,\&quot;access_token\&quot;: \&quot;</span>{<span class="r32 r">token</span>}<span class="s">\&quot;,\&quot;refresh_token\&quot;: \&quot;</span>{<span class="r32 r">token</span>}<span class="s">\&quot;,\&quot;scope\&quot;: null,\&quot;client_info\&quot;: null,\&quot;id_token\&quot;: null,\&quot;expires_in\&quot;: 10000,\&quot;ext_expires_in\&quot;: 100000,\&quot;refresh_in\&quot;: 1000, \&quot;correlation_id\&quot;: \&quot;</span>{<a href="@0@mscorlib/A.html#b622ef5f6b76c10a" class="t t">Guid</a>.<a href="@0@mscorlib/A.html#b7fae6994c22c22e" class="i method">NewGuid</a>().<a href="@0@mscorlib/A.html#a6547a472def7796" class="i method">ToString</a>()}<span class="s">\&quot;, \&quot;client_info\&quot;: \&quot;</span>{<a href="#8bbd3812777ec4d1" class="i method">CreateMsalClientInfo</a>()}<span class="s">\&quot;,\&quot;id_token\&quot;: \&quot;</span>{<span class="r36 r">idToken</span>}<span class="s">\&quot;}}</span><span class="s">&quot;</span>);
            <b>return</b> <span class="r35 r">response</span>;
        }
 
        <b>public static string</b> <a id="8bbd3812777ec4d1" href="R/8bbd3812777ec4d1.html" target="n" data-glyph="72,1" class="i method">CreateMsalClientInfo</a>()
        {
            <b>return</b> <a href="#7af071cfdc4397ec" class="i method">MsalEncode</a>(<span class="s">&quot;{\&quot;uid\&quot;:\&quot;myuid\&quot;,\&quot;utid\&quot;:\&quot;myutid\&quot;}&quot;</span>);
        }
 
        <b>public static string</b> <a id="b625ff65ad64fa2f" href="R/b625ff65ad64fa2f.html" target="n" data-glyph="72,1" class="i method">CreateMsalIdToken</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r37 rd" class="r37 r">uniqueId</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r38 rd" class="r38 r">displayableId</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r39 rd" class="r39 r">tenantId</span>)
        {
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r40 rd" class="r40 r">id</span> = <span class="s">&quot;{\&quot;aud\&quot;: \&quot;e854a4a7-6c34-449c-b237-fc7a28093d84\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;iss\&quot;: \&quot;https://login.microsoftonline.com/6c3d51dd-f0e5-4959-b4ea-a80c4e36fe5e/v2.0/\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;iat\&quot;: 1455833828,&quot;</span> +
                        <span class="s">&quot;\&quot;nbf\&quot;: 1455833828,&quot;</span> +
                        <span class="s">&quot;\&quot;exp\&quot;: 1455837728,&quot;</span> +
                        <span class="s">&quot;\&quot;ipaddr\&quot;: \&quot;131.107.159.117\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;name\&quot;: \&quot;Marrrrrio Bossy\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;oid\&quot;: \&quot;&quot;</span> + <span class="r37 r">uniqueId</span> + <span class="s">&quot;\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;preferred_username\&quot;: \&quot;&quot;</span> + <span class="r38 r">displayableId</span> + <span class="s">&quot;\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;sub\&quot;: \&quot;K4_SGGxKqW1SxUAmhg6C1F6VPiFzcx-Qd80ehIEdFus\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;tid\&quot;: \&quot;&quot;</span> + <span class="r39 r">tenantId</span> + <span class="s">&quot;\&quot;,&quot;</span> +
                        <span class="s">&quot;\&quot;ver\&quot;: \&quot;2.0\&quot;}&quot;</span>;
            <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c07c3772222caaff" class="i method">Format</a>(<a href="@0@mscorlib/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@0@mscorlib/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>, <span class="s">&quot;someheader.{0}.somesignature&quot;</span>, <a href="#7af071cfdc4397ec" class="i method">MsalEncode</a>(<span class="r40 r">id</span>));
        }
 
        <b>private const char</b> <a id="fc050a90bf647be4" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">base64PadCharacter</a> = <span class="s">&#39;=&#39;</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">NET45</span>
<span class="e">        private const string doubleBase64PadCharacter = &quot;==&quot;;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
        <b>private const char</b> <a id="7115f2f9901fb0af" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">base64Character62</a> = <span class="s">&#39;+&#39;</span>;
        <b>private const char</b> <a id="6f97524811b313ff" href="R/../../0000000000.html" target="n" data-glyph="10,1" class="i field">base64Character63</a> = <span class="s">&#39;/&#39;</span>;
        <b>private const char</b> <a id="cdec204ea12d5a3e" href="R/cdec204ea12d5a3e.html" target="n" data-glyph="10,1" class="i field">base64UrlCharacter62</a> = <span class="s">&#39;-&#39;</span>;
        <b>private const char</b> <a id="61cb235971718bd8" href="R/61cb235971718bd8.html" target="n" data-glyph="10,1" class="i field">base64UrlCharacter63</a> = <span class="s">&#39;_&#39;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Encoding table</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal static readonly char</b>[] <a id="eac9986e6d0845c8" href="R/eac9986e6d0845c8.html" target="n" data-glyph="44,1" class="i field">s_base64Table</a> =
        {
            <span class="s">&#39;A&#39;</span>, <span class="s">&#39;B&#39;</span>, <span class="s">&#39;C&#39;</span>, <span class="s">&#39;D&#39;</span>, <span class="s">&#39;E&#39;</span>, <span class="s">&#39;F&#39;</span>, <span class="s">&#39;G&#39;</span>, <span class="s">&#39;H&#39;</span>, <span class="s">&#39;I&#39;</span>, <span class="s">&#39;J&#39;</span>, <span class="s">&#39;K&#39;</span>, <span class="s">&#39;L&#39;</span>, <span class="s">&#39;M&#39;</span>, <span class="s">&#39;N&#39;</span>, <span class="s">&#39;O&#39;</span>, <span class="s">&#39;P&#39;</span>, <span class="s">&#39;Q&#39;</span>, <span class="s">&#39;R&#39;</span>, <span class="s">&#39;S&#39;</span>, <span class="s">&#39;T&#39;</span>, <span class="s">&#39;U&#39;</span>, <span class="s">&#39;V&#39;</span>, <span class="s">&#39;W&#39;</span>, <span class="s">&#39;X&#39;</span>, <span class="s">&#39;Y&#39;</span>,
            <span class="s">&#39;Z&#39;</span>, <span class="s">&#39;a&#39;</span>, <span class="s">&#39;b&#39;</span>, <span class="s">&#39;c&#39;</span>, <span class="s">&#39;d&#39;</span>, <span class="s">&#39;e&#39;</span>, <span class="s">&#39;f&#39;</span>, <span class="s">&#39;g&#39;</span>, <span class="s">&#39;h&#39;</span>, <span class="s">&#39;i&#39;</span>, <span class="s">&#39;j&#39;</span>, <span class="s">&#39;k&#39;</span>, <span class="s">&#39;l&#39;</span>, <span class="s">&#39;m&#39;</span>, <span class="s">&#39;n&#39;</span>, <span class="s">&#39;o&#39;</span>, <span class="s">&#39;p&#39;</span>, <span class="s">&#39;q&#39;</span>, <span class="s">&#39;r&#39;</span>, <span class="s">&#39;s&#39;</span>, <span class="s">&#39;t&#39;</span>, <span class="s">&#39;u&#39;</span>, <span class="s">&#39;v&#39;</span>, <span class="s">&#39;w&#39;</span>, <span class="s">&#39;x&#39;</span>,
            <span class="s">&#39;y&#39;</span>, <span class="s">&#39;z&#39;</span>, <span class="s">&#39;0&#39;</span>, <span class="s">&#39;1&#39;</span>, <span class="s">&#39;2&#39;</span>, <span class="s">&#39;3&#39;</span>, <span class="s">&#39;4&#39;</span>, <span class="s">&#39;5&#39;</span>, <span class="s">&#39;6&#39;</span>, <span class="s">&#39;7&#39;</span>, <span class="s">&#39;8&#39;</span>, <span class="s">&#39;9&#39;</span>, <a href="#cdec204ea12d5a3e" class="i field">base64UrlCharacter62</a>, <a href="#61cb235971718bd8" class="i field">base64UrlCharacter63</a>
        };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The following functions perform base64url encoding which differs from regular base64 encoding as follows</span>
        <span class="c">///</span><span class="c"> * padding is skipped so the pad character &#39;=&#39; doesn&#39;t have to be percent encoded</span>
        <span class="c">///</span><span class="c"> * the 62nd and 63rd regular base64 encoding characters (&#39;+&#39; and &#39;/&#39;) are replace with (&#39;-&#39; and &#39;_&#39;)</span>
        <span class="c">///</span><span class="c"> The changes make the encoding alphabet file and URL safe.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">arg</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">string to encode.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Base64Url encoding of the UTF8 bytes.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="7af071cfdc4397ec" href="R/7af071cfdc4397ec.html" target="n" data-glyph="72,1" class="i method">MsalEncode</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r41 rd" class="r41 r">arg</span>)
        {
            <b>if</b> (<span class="r41 r">arg</span> == <b>null</b>)
                <b>return</b> <b>null</b>;
 
            <b>return</b> <a href="#bfaae1abbfc894f3" class="i method">MsalEncode</a>(<a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(<span class="r41 r">arg</span>));
        }
 
        <span class="c">// From https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/blob/master/src/client/Microsoft.Identity.Client/Utils/Base64UrlHelpers.cs</span>
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a subset of an array of 8-bit unsigned integers to its equivalent string representation that is encoded with base-64-url digits. Parameters specify</span>
        <span class="c">///</span><span class="c"> the subset as an offset in the input array, and the number of elements in the array to convert.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r42 r">inArray</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An array of 8-bit unsigned integers.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r">length</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An offset in inArray.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">offset</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The number of elements of inArray to convert.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The string representation in base 64 url encoding of length elements of inArray, starting at position offset.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&#39;inArray&#39; is null.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@0@mscorlib/A.html#2975f0aa875d4a32" class="t t">ArgumentOutOfRangeException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">offset or length is negative OR offset plus length is greater than the length of inArray.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>private static string</b> <a id="a6e366f2f1374591" href="R/a6e366f2f1374591.html" target="n" data-glyph="76,1" class="i method">MsalEncode</a>(<b>byte</b>[] <span id="r42 rd" class="r42 r">inArray</span>, <b>int</b> <span id="r44 rd" class="r44 r">offset</span>, <b>int</b> <span id="r43 rd" class="r43 r">length</span>)
        {
            <b>_</b> = <span class="r42 r">inArray</span> ?? <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r42 r">inArray</span>));
 
            <b>if</b> (<span class="r43 r">length</span> == 0)
                <b>return</b> <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#c9f70a27facb27cf" class="i field">Empty</a>;
 
            <b>if</b> (<span class="r43 r">length</span> &lt; 0)
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#5fec5e06371b1f6c" class="t constructor">ArgumentOutOfRangeException</a>(<b>nameof</b>(<span class="r43 r">length</span>));
 
            <b>if</b> (<span class="r44 r">offset</span> &lt; 0 || <span class="r42 r">inArray</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a> &lt; <span class="r44 r">offset</span>)
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#5fec5e06371b1f6c" class="t constructor">ArgumentOutOfRangeException</a>(<b>nameof</b>(<span class="r44 r">offset</span>));
 
            <b>if</b> (<span class="r42 r">inArray</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a> &lt; <span class="r44 r">offset</span> + <span class="r43 r">length</span>)
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#5fec5e06371b1f6c" class="t constructor">ArgumentOutOfRangeException</a>(<b>nameof</b>(<span class="r43 r">length</span>));
 
            <b>int</b> <span id="r45 rd" class="r45 r">lengthmod3</span> = <span class="r43 r">length</span> % 3;
            <b>int</b> <span id="r46 rd" class="r46 r">limit</span> = <span class="r44 r">offset</span> + (<span class="r43 r">length</span> - <span class="r45 r">lengthmod3</span>);
            <b>char</b>[] <span id="r47 rd" class="r47 r">output</span> = <b>new</b> <b>char</b>[(<span class="r43 r">length</span> + 2) / 3 * 4];
            <b>char</b>[] <span id="r48 rd" class="r48 r">table</span> = <a href="#eac9986e6d0845c8" class="i field">s_base64Table</a>;
            <b>int</b> <span id="r49 rd" class="r49 r">i</span>, <span id="r50 rd" class="r50 r">j</span> = 0;
 
            <span class="c">// takes 3 bytes from inArray and insert 4 bytes into output</span>
            <b>for</b> (<span class="r49 r">i</span> = <span class="r44 r">offset</span>; <span class="r49 r">i</span> &lt; <span class="r46 r">limit</span>; <span class="r49 r">i</span> += 3)
            {
                <b>byte</b> <span id="r51 rd" class="r51 r">d0</span> = <span class="r42 r">inArray</span>[<span class="r49 r">i</span>];
                <b>byte</b> <span id="r52 rd" class="r52 r">d1</span> = <span class="r42 r">inArray</span>[<span class="r49 r">i</span> + 1];
                <b>byte</b> <span id="r53 rd" class="r53 r">d2</span> = <span class="r42 r">inArray</span>[<span class="r49 r">i</span> + 2];
 
                <span class="r47 r">output</span>[<span class="r50 r">j</span> + 0] = <span class="r48 r">table</span>[<span class="r51 r">d0</span> &gt;&gt; 2];
                <span class="r47 r">output</span>[<span class="r50 r">j</span> + 1] = <span class="r48 r">table</span>[((<span class="r51 r">d0</span> &amp; 0x03) &lt;&lt; 4) | (<span class="r52 r">d1</span> &gt;&gt; 4)];
                <span class="r47 r">output</span>[<span class="r50 r">j</span> + 2] = <span class="r48 r">table</span>[((<span class="r52 r">d1</span> &amp; 0x0f) &lt;&lt; 2) | (<span class="r53 r">d2</span> &gt;&gt; 6)];
                <span class="r47 r">output</span>[<span class="r50 r">j</span> + 3] = <span class="r48 r">table</span>[<span class="r53 r">d2</span> &amp; 0x3f];
                <span class="r50 r">j</span> += 4;
            }
 
            <span class="c">//Where we left off before</span>
            <span class="r49 r">i</span> = <span class="r46 r">limit</span>;
 
            <b>switch</b> (<span class="r45 r">lengthmod3</span>)
            {
                <b>case</b> 2:
                    {
                        <b>byte</b> <span id="r54 rd" class="r54 r">d0</span> = <span class="r42 r">inArray</span>[<span class="r49 r">i</span>];
                        <b>byte</b> <span id="r55 rd" class="r55 r">d1</span> = <span class="r42 r">inArray</span>[<span class="r49 r">i</span> + 1];
 
                        <span class="r47 r">output</span>[<span class="r50 r">j</span> + 0] = <span class="r48 r">table</span>[<span class="r54 r">d0</span> &gt;&gt; 2];
                        <span class="r47 r">output</span>[<span class="r50 r">j</span> + 1] = <span class="r48 r">table</span>[((<span class="r54 r">d0</span> &amp; 0x03) &lt;&lt; 4) | (<span class="r55 r">d1</span> &gt;&gt; 4)];
                        <span class="r47 r">output</span>[<span class="r50 r">j</span> + 2] = <span class="r48 r">table</span>[(<span class="r55 r">d1</span> &amp; 0x0f) &lt;&lt; 2];
                        <span class="r50 r">j</span> += 3;
                    }
                    <b>break</b>;
 
                <b>case</b> 1:
                    {
                        <b>byte</b> <span id="r56 rd" class="r56 r">d0</span> = <span class="r42 r">inArray</span>[<span class="r49 r">i</span>];
 
                        <span class="r47 r">output</span>[<span class="r50 r">j</span> + 0] = <span class="r48 r">table</span>[<span class="r56 r">d0</span> &gt;&gt; 2];
                        <span class="r47 r">output</span>[<span class="r50 r">j</span> + 1] = <span class="r48 r">table</span>[(<span class="r56 r">d0</span> &amp; 0x03) &lt;&lt; 4];
                        <span class="r50 r">j</span> += 2;
                    }
                    <b>break</b>;
 
                <span class="c">//default or case 0: no further operations are needed.</span>
            }
 
            <b>return</b> <b>new</b> <a href="@0@mscorlib/A.html#9c38fc5901f2a9f5" class="k">string</a>(<span class="r47 r">output</span>, 0, <span class="r50 r">j</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Converts a subset of an array of 8-bit unsigned integers to its equivalent string representation that is encoded with base-64-url digits. Parameters specify</span>
        <span class="c">///</span><span class="c"> the subset as an offset in the input array, and the number of elements in the array to convert.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r57 r">inArray</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">An array of 8-bit unsigned integers.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The string representation in base 64 url encoding of length elements of inArray, starting at position offset.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@0@mscorlib/A.html#c742289497493bb8" class="t t">ArgumentNullException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&#39;inArray&#39; is null.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@0@mscorlib/A.html#2975f0aa875d4a32" class="t t">ArgumentOutOfRangeException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">offset or length is negative OR offset plus length is greater than the length of inArray.</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="bfaae1abbfc894f3" href="R/bfaae1abbfc894f3.html" target="n" data-glyph="72,1" class="i method">MsalEncode</a>(<b>byte</b>[] <span id="r57 rd" class="r57 r">inArray</span>)
        {
            <b>if</b> (<span class="r57 r">inArray</span> == <b>null</b>)
                <b>return</b> <b>null</b>;
 
            <b>return</b> <a href="#a6e366f2f1374591" class="i method">MsalEncode</a>(<span class="r57 r">inArray</span>, 0, <span class="r57 r">inArray</span>.<a href="@0@mscorlib/A.html#42e9b7616956cf94" class="i property">Length</a>);
        }
 
        <b>protected bool</b> <a id="25bd586ca9a2d559" href="R/25bd586ca9a2d559.html" target="n" data-glyph="75,1" class="i method">RequestBodyHasUserAssertionWithHeader</a>(<a href="/Azure.Core/A.html#a519adbefba2e288" class="t t">Request</a> <span id="r58 rd" class="r58 r">req</span>, <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r59 rd" class="r59 r">headerName</span>)
        {
            <span class="r58 r">req</span>.<a href="/Azure.Core/A.html#1517233642d6c203" class="i property">Content</a>.<a href="/Azure.Core/A.html#226e895dc5f37950" class="i method">TryComputeLength</a>(<b>out</b> <a href="@0@mscorlib/A.html#e566178cce890c36" class="k">var</a> <span id="r60 rd" class="r60 r">len</span>);
            <b>byte</b>[] <span id="r61 rd" class="r61 r">content</span> = <b>new</b> <b>byte</b>[<span class="r60 r">len</span>];
            <a href="@0@mscorlib/A.html#1a4dcb744a23ba6f" class="k">var</a> <span id="r62 rd" class="r62 r">stream</span> = <b>new</b> <a href="@0@mscorlib/A.html#0db5cb2960bec2f2" class="t constructor">MemoryStream</a>((<b>int</b>)<span class="r60 r">len</span>);
            <span class="r58 r">req</span>.<a href="/Azure.Core/A.html#1517233642d6c203" class="i property">Content</a>.<a href="/Azure.Core/A.html#0662e44f35dd6163" class="i method">WriteTo</a>(<span class="r62 r">stream</span>, <b>default</b>);
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r63 rd" class="r63 r">body</span> = <a href="@0@mscorlib/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@0@mscorlib/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@0@mscorlib/A.html#233647d04fbec0c0" class="i method">GetString</a>(<span class="r62 r">stream</span>.<a href="@0@mscorlib/A.html#e51e5d198cd08d97" class="i method">GetBuffer</a>(), 0, (<b>int</b>)<span class="r62 r">stream</span>.<a href="@0@mscorlib/A.html#af4720ccd5d86f14" class="i property">Length</a>);
            <b>var</b> <span id="r64 rd" class="r64 r">parts</span> = <span class="r63 r">body</span>.<a href="@0@mscorlib/A.html#1c4a9dc78ba38999" class="i method">Split</a>(<span class="s">&#39;&amp;&#39;</span>);
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r65 rd" class="r65 r">part</span> <b>in</b> <span class="r64 r">parts</span>)
            {
                <b>if</b> (<span class="r65 r">part</span>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;client_assertion=&quot;</span>))
                {
                    <b>var</b> <span id="r66 rd" class="r66 r">assertion</span> = <span class="r65 r">part</span>.<span class="i method">AsSpan</span>();
                    <b>int</b> <span id="r67 rd" class="r67 r">start</span> = <span class="r66 r">assertion</span>.<span class="i method">IndexOf</span>(<span class="s">&#39;=&#39;</span>) + 1;
                    <span class="r66 r">assertion</span> = <span class="r66 r">assertion</span>.<span class="i method">Slice</span>(<span class="r67 r">start</span>);
                    <b>int</b> <span id="r68 rd" class="r68 r">end</span> = <span class="r66 r">assertion</span>.<span class="i method">IndexOf</span>(<span class="s">&#39;.&#39;</span>);
                    <b>var</b> <span id="r69 rd" class="r69 r">jwt</span> = <span class="r66 r">assertion</span>.<span class="i method">Slice</span>(0, <span class="r68 r">end</span>);
                    <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r70 rd" class="r70 r">convertedToken</span> = <span class="r69 r">jwt</span>.<span class="i method">ToString</span>().<a href="@0@mscorlib/A.html#987da5dfb39f1927" class="i method">Replace</a>(<span class="s">&#39;_&#39;</span>, <span class="s">&#39;/&#39;</span>).<a href="@0@mscorlib/A.html#987da5dfb39f1927" class="i method">Replace</a>(<span class="s">&#39;-&#39;</span>, <span class="s">&#39;+&#39;</span>);
                    <b>switch</b> (<span class="r69 r">jwt</span>.<span class="i property">Length</span> % 4)
                    {
                        <b>case</b> 2:
                            <span class="r70 r">convertedToken</span> += <span class="s">&quot;==&quot;</span>;
                            <b>break</b>;
                        <b>case</b> 3:
                            <span class="r70 r">convertedToken</span> += <span class="s">&quot;=&quot;</span>;
                            <b>break</b>;
                    }
 
                    <span class="t t">Utf8JsonReader</span> <span id="r71 rd" class="r71 r">reader</span> = <b>new</b> <span class="t constructor">Utf8JsonReader</span>(<a href="@0@mscorlib/A.html#fc990bd1275d43d6" class="t t">Convert</a>.<a href="@0@mscorlib/A.html#08c34f52087ba624" class="i method">FromBase64String</a>(<span class="r70 r">convertedToken</span>));
                    <b>while</b> (<span class="r71 r">reader</span>.<span class="i method">Read</span>())
                    {
                        <b>if</b> (<span class="r71 r">reader</span>.<span class="i property">TokenType</span> == <span class="t t">JsonTokenType</span>.<span class="i field">PropertyName</span>)
                        {
                            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r72 rd" class="r72 r">header</span> = <span class="r71 r">reader</span>.<span class="i method">GetString</span>();
                            <b>if</b> (<span class="r72 r">header</span> == <span class="r59 r">headerName</span>)
                            {
                                <b>return</b> <b>true</b>;
                            }
 
                            <span class="r71 r">reader</span>.<span class="i method">Read</span>();
                        }
                    }
                }
            }
 
            <b>return</b> <b>false</b>;
        }
 
        <b>protected</b> <a href="/Azure.Core.TestFramework/A.html#44bcb3ab7dfe168b" class="t t">MockTransport</a> <a id="9c3de2a6de842900" href="R/9c3de2a6de842900.html" target="n" data-glyph="75,1" class="i method">Createx5cValidatingTransport</a>(<b>bool</b> <span id="r73 rd" class="r73 r">sendCertChain</span>) =&gt; <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2dbf873c88022e" class="t constructor">MockTransport</a>((<span id="r74 rd" class="r74 r">req</span>) =&gt;
        {
            <span class="c">// respond to tenant discovery</span>
            <b>if</b> (<span class="r74 r">req</span>.<a href="/Azure.Core/A.html#a3954f29cb1a883c" class="i property">Uri</a>.<a href="/Azure.Core/A.html#f3e88afa3894ee8e" class="i property">Path</a>.<a href="@0@mscorlib/A.html#23804789ea4c9c0e" class="i method">StartsWith</a>(<span class="s">&quot;/common/discovery&quot;</span>))
            {
                <b>return</b> <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2adc622c2950d8" class="t constructor">MockResponse</a>(200).<a href="/Azure.Core.TestFramework/A.html#2af07c9f6a842649" class="i method">SetContent</a>(<a href="#5cd916c99bc14f99" class="i field">DiscoveryResponseBody</a>);
            }
 
            <span class="c">// respond to token request</span>
            <b>if</b> (<span class="r74 r">req</span>.<a href="/Azure.Core/A.html#a3954f29cb1a883c" class="i property">Uri</a>.<a href="/Azure.Core/A.html#f3e88afa3894ee8e" class="i property">Path</a>.<a href="@0@mscorlib/A.html#cb74053b3f2d03f4" class="i method">EndsWith</a>(<span class="s">&quot;/token&quot;</span>))
            {
                <span class="t t">Assert</span>.<span class="i method">That</span>(<span class="r73 r">sendCertChain</span>, <span class="t t">Is</span>.<span class="i method">EqualTo</span>(<a href="#25bd586ca9a2d559" class="i method">RequestBodyHasUserAssertionWithHeader</a>(<span class="r74 r">req</span>, <span class="s">&quot;x5c&quot;</span>)));
                <b>return</b> <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2adc622c2950d8" class="t constructor">MockResponse</a>(200).<a href="MockExtensions.cs.html#e645ccd97cdbf892" class="i method">WithContent</a>(
                        <span class="s">$&quot;</span><span class="s">{{\&quot;token_type\&quot;: \&quot;Bearer\&quot;,\&quot;expires_in\&quot;: 9999,\&quot;ext_expires_in\&quot;: 9999,\&quot;access_token\&quot;: \&quot;</span>{<a href="#a1e8b20d0b9f2e86" class="i field">expectedToken</a>}<span class="s">\&quot; }}</span><span class="s">&quot;</span>);
            }
            <b>return</b> <b>new</b> <a href="/Azure.Core.TestFramework/A.html#ef2adc622c2950d8" class="t constructor">MockResponse</a>(200);
        });
    }
}
</pre></td></tr></table></div></body></html>
