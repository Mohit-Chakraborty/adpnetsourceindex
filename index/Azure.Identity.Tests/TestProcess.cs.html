<!DOCTYPE html>
<html><head><title>TestProcess.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(150);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Identity.Tests/TestProcess.cs" target="_top">TestProcess.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Identity.Tests" target="_top">Azure.Identity.Tests.csproj</a> (Azure.Identity.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>.<span class="i n">Expressions</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Reflection</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Identity</span>.<span class="i n">Tests</span>
{
    <b>internal sealed class</b> <a id="79dba6dec36650f9" href="R/79dba6dec36650f9.html" target="n" data-glyph="2,0" class="t t"><span id="f14d5a1a716929ac">TestProcess</span></a> : <a href="/Azure.Identity/A.html#3316f7f4db3dec08" class="t t">IProcess</a>
    {
        <b>private static readonly</b> <a href="@0@mscorlib/A.html#8b99c1f377873554" class="t t">Lazy</a>&lt;<a href="@0@mscorlib/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@System/A.html#f1cfee83ea96c1cc" class="t t">DataReceivedEventArgs</a>&gt;&gt; <a id="03738c91f616e9c9" href="R/03738c91f616e9c9.html" target="n" data-glyph="46,1" class="i field">s_createDataReceivedEventArgs</a> = <b>new</b> <a href="@0@mscorlib/A.html#c0f7b98bacad370a" class="t constructor">Lazy</a>&lt;<a href="@0@mscorlib/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@System/A.html#f1cfee83ea96c1cc" class="t t">DataReceivedEventArgs</a>&gt;&gt;(() =&gt;
        {
            <a href="@0@mscorlib/A.html#efafec8b833cfa7f" class="t t">ConstructorInfo</a> <span id="r0 rd" class="r0 r">constructor</span> = <b>typeof</b>(<a href="@0@System/A.html#f1cfee83ea96c1cc" class="t t">DataReceivedEventArgs</a>).<a href="@0@mscorlib/A.html#2b0cd0144efca2ad" class="i method">GetConstructors</a>(<a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#5144189c11f6b668" class="i field">NonPublic</a> | <a href="@0@mscorlib/A.html#4795caf3b483702d" class="t t">BindingFlags</a>.<a href="@0@mscorlib/A.html#54a14f747b06c614" class="i field">Instance</a>)[0];
            <a href="@0@System.Core/A.html#f4308bded2e9d66a" class="t t">ParameterExpression</a> <span id="r1 rd" class="r1 r">dataParameter</span> = <a href="@0@System.Core/A.html#39a9b098482b765d" class="t t">Expression</a>.<a href="@0@System.Core/A.html#f33e409059e36577" class="i method">Parameter</a>(<b>typeof</b>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>), <span class="s">&quot;data&quot;</span>);
            <a href="@0@System.Core/A.html#1d8501cdde70b9f4" class="t t">NewExpression</a> <span id="r2 rd" class="r2 r">callConstructor</span> = <a href="@0@System.Core/A.html#39a9b098482b765d" class="t t">Expression</a>.<a href="@0@System.Core/A.html#a19495ccb1914c6b" class="i method">New</a>(<span class="r0 r">constructor</span>, <span class="r1 r">dataParameter</span>);
            <b>return</b> <a href="@0@System.Core/A.html#39a9b098482b765d" class="t t">Expression</a>.<a href="@0@System.Core/A.html#23094e18bae0345d" class="i method">Lambda</a>&lt;<a href="@0@mscorlib/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@System/A.html#f1cfee83ea96c1cc" class="t t">DataReceivedEventArgs</a>&gt;&gt;(<span class="r2 r">callConstructor</span>, <span class="r1 r">dataParameter</span>).<a href="@0@System.Core/A.html#9d4912c02133de4e" class="i method">Compile</a>();
        });
 
        <b>private bool</b> <a id="0804deacb1e56ec9" href="R/0804deacb1e56ec9.html" target="n" data-glyph="46,1" class="i field">_hasStarted</a>;
        <b>private bool</b> <a id="2fef0dca5bd70e0f" href="R/2fef0dca5bd70e0f.html" target="n" data-glyph="46,1" class="i field">_hasExited</a>;
        <b>private int</b> <a id="4d45ff07d28b8ef6" href="R/4d45ff07d28b8ef6.html" target="n" data-glyph="46,1" class="i field">_exitCode</a>;
        <b>private</b> <a href="@0@mscorlib/A.html#130a9536ac96b392" class="t t">CancellationTokenSource</a> <a id="3626479c4115593c" href="R/3626479c4115593c.html" target="n" data-glyph="46,1" class="i field">_cts</a>;
        <b>private</b> <a href="@0@System/A.html#7caf1ab108119a18" class="t t">ProcessStartInfo</a> <a id="85747a907723a5d1" href="R/85747a907723a5d1.html" target="n" data-glyph="46,1" class="i field">_startInfo</a>;
 
        <b>public</b> <a href="@0@System/A.html#7caf1ab108119a18" class="t t">ProcessStartInfo</a> <a id="92b0e2b5def72cb4" href="R/92b0e2b5def72cb4.html" target="n" data-glyph="102,1" class="i property">StartInfo</a>
        {
            <b>get</b> =&gt; <a href="#85747a907723a5d1" class="i field">_startInfo</a> ??= <b>new</b> <a href="@0@System/A.html#c9102a49613227be" class="t constructor">ProcessStartInfo</a>();
            <b>set</b> =&gt; <a href="#85747a907723a5d1" class="i field">_startInfo</a> = <b>value</b>;
        }
 
        <b>public bool</b> <a id="405cfb2b686cc096" href="R/405cfb2b686cc096.html" target="n" data-glyph="102,1" class="i property">FailedToStart</a> { <b>get</b>; <b>set</b>; }
        <b>public string</b> <a id="88f1597d1d987c03" href="R/88f1597d1d987c03.html" target="n" data-glyph="102,1" class="i property">Output</a> { <b>get</b>; <b>set</b>; }
        <b>public string</b> <a id="2e19a4ff11718885" href="R/2e19a4ff11718885.html" target="n" data-glyph="102,1" class="i property">Error</a> { <b>get</b>; <b>set</b>; }
        <b>public int</b>? <a id="c022a7cab9362caf" href="R/c022a7cab9362caf.html" target="n" data-glyph="102,1" class="i property">CodeOnExit</a> { <b>get</b>; <b>set</b>; }
        <b>public int</b> <a id="720cf53b115cc4a2" href="R/720cf53b115cc4a2.html" target="n" data-glyph="102,1" class="i property">Timeout</a> { <b>get</b>; <b>set</b>; }
        <b>public</b> <a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <a id="e39ba1fe48fef256" href="R/e39ba1fe48fef256.html" target="n" data-glyph="102,1" class="i property">ExceptionOnProcessKill</a> { <b>get</b>; <b>set</b>; }
 
        <b>public void</b> <a id="5c0d76eaa3d24c3e" href="R/5c0d76eaa3d24c3e.html" target="n" data-glyph="72,1" class="i method">Dispose</a>() { }
 
        <b>public bool</b> <a id="1ac0cd94193918b3" href="R/1ac0cd94193918b3.html" target="n" data-glyph="102,1" class="i property">HasExited</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#0804deacb1e56ec9" class="i field">_hasStarted</a>)
                {
                    <b>return</b> <a href="#2fef0dca5bd70e0f" class="i field">_hasExited</a>;
                }
 
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#265d72f49e915224" class="t constructor">InvalidOperationException</a>(<span class="s">&quot;No process is associated with this object&quot;</span>);
            }
        }
 
        <b>public int</b> <a id="733686b6ad19cd4a" href="R/733686b6ad19cd4a.html" target="n" data-glyph="102,1" class="i property">ExitCode</a>
        {
            <b>get</b>
            {
                <b>if</b> (<a href="#2fef0dca5bd70e0f" class="i field">_hasExited</a>)
                {
                    <b>return</b> <a href="#4d45ff07d28b8ef6" class="i field">_exitCode</a>;
                }
 
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8d6a52a5496ce078" class="t constructor">InvalidOperationException</a>();
            }
        }
 
        <b>public event</b> <a href="@0@mscorlib/A.html#3b79d2b06c15f250" class="t t">EventHandler</a> <a id="15540dfd446afcf3" href="R/15540dfd446afcf3.html" target="n" data-glyph="30,1" class="i">Exited</a>;
        <b>public event</b> <a href="@0@mscorlib/A.html#3b79d2b06c15f250" class="t t">EventHandler</a> <a id="7187ea157fe88ddb" href="R/7187ea157fe88ddb.html" target="n" data-glyph="30,1" class="i">Started</a>;
        <b>public event</b> <a href="@0@System/A.html#81871d3af8a8e74d" class="t t">DataReceivedEventHandler</a> <a id="68e213795e9a11ab" href="R/68e213795e9a11ab.html" target="n" data-glyph="30,1" class="i">OutputDataReceived</a>;
        <b>public event</b> <a href="@0@System/A.html#81871d3af8a8e74d" class="t t">DataReceivedEventHandler</a> <a id="4359f9a44ca471ab" href="R/4359f9a44ca471ab.html" target="n" data-glyph="30,1" class="i">ErrorDataReceived</a>;
 
        <b>public bool</b> <a id="1bec004a3c7ca1e1" href="R/1bec004a3c7ca1e1.html" target="n" data-glyph="72,1" class="i method">Start</a>()
        {
            <b>if</b> (<a href="#405cfb2b686cc096" class="i property">FailedToStart</a>)
            {
                <b>return</b> <b>false</b>;
            }
 
            <a href="#0804deacb1e56ec9" class="i field">_hasStarted</a> = <b>true</b>;
            <a href="#7187ea157fe88ddb" class="i">Started</a>?.<a href="@0@mscorlib/A.html#aaedcaa3f05a32f9" class="i method">Invoke</a>(<a href="#79dba6dec36650f9" class="k">this</a>, <a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a>.<a href="@0@mscorlib/A.html#433622385e05af0d" class="i field">Empty</a>);
 
            <b>if</b> (<a href="#720cf53b115cc4a2" class="i property">Timeout</a> &gt; 0)
            {
                <a href="#3626479c4115593c" class="i field">_cts</a> = <b>new</b> <a href="@0@mscorlib/A.html#0fd973cb6741d972" class="t constructor">CancellationTokenSource</a>();
                <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#5fb80297e082b8d6" class="i method">Delay</a>(<a href="#720cf53b115cc4a2" class="i property">Timeout</a>, <a href="#3626479c4115593c" class="i field">_cts</a>.<a href="@0@mscorlib/A.html#9e22b9c8995bf195" class="i property">Token</a>).<a href="@0@mscorlib/A.html#e71924f994d1bb54" class="i method">ContinueWith</a>(<a href="#722ea7affb418e2b" class="i method">FinishProcessRun</a>);
            }
            <b>else</b>
            {
                <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#89fc01f3bb88eed9" class="i method">Run</a>(<a href="#cee4d4136a0a2066" class="i method">FinishProcessRun</a>);
            }
 
            <b>return</b> <b>true</b>;
        }
 
        <b>private void</b> <a id="722ea7affb418e2b" href="R/722ea7affb418e2b.html" target="n" data-glyph="76,1" class="i method">FinishProcessRun</a>(<a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a> <span id="r3 rd" class="r3 r">delayTask</span>)
        {
            <b>if</b> (!<span class="r3 r">delayTask</span>.<a href="@0@mscorlib/A.html#37cd1e11bb77b197" class="i property">IsCanceled</a>)
            {
                <a href="#cee4d4136a0a2066" class="i method">FinishProcessRun</a>();
            }
        }
 
        <b>private void</b> <a id="cee4d4136a0a2066" href="R/cee4d4136a0a2066.html" target="n" data-glyph="76,1" class="i method">FinishProcessRun</a>()
        {
            <a href="#06198e25df51f1ec" class="i method">Notify</a>(<a href="#88f1597d1d987c03" class="i property">Output</a>, <a href="#68e213795e9a11ab" class="i">OutputDataReceived</a>);
            <a href="#06198e25df51f1ec" class="i method">Notify</a>(<a href="#2e19a4ff11718885" class="i property">Error</a>, <a href="#4359f9a44ca471ab" class="i">ErrorDataReceived</a>);
 
            <a href="#2fef0dca5bd70e0f" class="i field">_hasExited</a> = <b>true</b>;
            <a href="#4d45ff07d28b8ef6" class="i field">_exitCode</a> = <a href="#c022a7cab9362caf" class="i property">CodeOnExit</a> ?? (<a href="#2e19a4ff11718885" class="i property">Error</a> != <b>default</b> ? 1 : 0);
            <a href="#15540dfd446afcf3" class="i">Exited</a>?.<a href="@0@mscorlib/A.html#aaedcaa3f05a32f9" class="i method">Invoke</a>(<a href="#79dba6dec36650f9" class="k">this</a>, <a href="@0@mscorlib/A.html#9a1496aa60befd10" class="t t">EventArgs</a>.<a href="@0@mscorlib/A.html#433622385e05af0d" class="i field">Empty</a>);
        }
 
        <b>private void</b> <a id="06198e25df51f1ec" href="R/06198e25df51f1ec.html" target="n" data-glyph="76,1" class="i method">Notify</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r4 rd" class="r4 r">data</span>, <a href="@0@System/A.html#81871d3af8a8e74d" class="t t">DataReceivedEventHandler</a> <span id="r5 rd" class="r5 r">handler</span>)
        {
            <b>if</b> (<span class="r5 r">handler</span> == <b>default</b>)
            {
                <b>return</b>;
            }
 
            <a href="@0@mscorlib/A.html#045a746eb48cbaa9" class="t t">Task</a>.<a href="@0@mscorlib/A.html#89fc01f3bb88eed9" class="i method">Run</a>(() =&gt;
            {
                <b>if</b> (<span class="r4 r">data</span> != <b>default</b>)
                {
                    <span class="r5 r">handler</span>(<a href="#79dba6dec36650f9" class="k">this</a>, <a href="#2cc7429f9357bf06" class="i method">CreateDataReceivedEventArgs</a>(<span class="r4 r">data</span>));
                }
                <span class="r5 r">handler</span>(<a href="#79dba6dec36650f9" class="k">this</a>, <a href="#2cc7429f9357bf06" class="i method">CreateDataReceivedEventArgs</a>(<b>null</b>));
            });
        }
 
        <b>public void</b> <a id="1b055ebe0b2fd6c2" href="R/1b055ebe0b2fd6c2.html" target="n" data-glyph="72,1" class="i method">Kill</a>()
        {
            <a href="#3626479c4115593c" class="i field">_cts</a>?.<a href="@0@mscorlib/A.html#93c25ccd0946470f" class="i method">Cancel</a>();
 
            <b>if</b> (<a href="#e39ba1fe48fef256" class="i property">ExceptionOnProcessKill</a> != <b>default</b>)
            {
                <a href="#2fef0dca5bd70e0f" class="i field">_hasExited</a> = <b>true</b>;
                <b>throw</b> <a href="#e39ba1fe48fef256" class="i property">ExceptionOnProcessKill</a>;
            }
        }
 
        <b>public void</b> <a id="cafa7f41ccc62e9b" href="R/cafa7f41ccc62e9b.html" target="n" data-glyph="72,1" class="i method">BeginOutputReadLine</a>() {}
        <b>public void</b> <a id="8143cafe54f4361a" href="R/8143cafe54f4361a.html" target="n" data-glyph="72,1" class="i method">BeginErrorReadLine</a>() {}
 
        <b>private static</b> <a href="@0@System/A.html#f1cfee83ea96c1cc" class="t t">DataReceivedEventArgs</a> <a id="2cc7429f9357bf06" href="R/2cc7429f9357bf06.html" target="n" data-glyph="76,1" class="i method">CreateDataReceivedEventArgs</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r6 rd" class="r6 r">data</span>) =&gt; <a href="#03738c91f616e9c9" class="i field">s_createDataReceivedEventArgs</a>.<a href="@0@mscorlib/A.html#606a17645b0dc0ff" class="i property">Value</a>(<span class="r6 r">data</span>);
    }
}
</pre></td></tr></table></div></body></html>
