<!DOCTYPE html>
<html><head><title>DataCollectionRulesTests.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(545);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Management.Monitor.Tests/BasicTests/DataCollectionRulesTests.cs" target="_top">BasicTests\DataCollectionRulesTests.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/main/sdk/monitor/Microsoft.Azure.Management.Monitor/tests/BasicTests/DataCollectionRulesTests.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Management.Monitor.Tests" target="_top">Microsoft.Azure.Management.Monitor.Tests.csproj</a> (Microsoft.Azure.Management.Monitor.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Linq</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Net</span>.<span class="i n">Http</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Monitor</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">Monitor</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Rest</span>.<span class="i n">Azure</span>;
<b>using</b> <span class="i n">Monitor</span>.<span class="i n">Tests</span>.<span class="i n">Helpers</span>;
 
<b>using</b> <span class="i n">Newtonsoft</span>.<span class="i n">Json</span>;
 
<b>using</b> <span class="i n">Xunit</span>;
 
<b>namespace</b> <span class="i n">Monitor</span>.<span class="i n">Tests</span>.<span class="i n">BasicTests</span>
{
    <span class="c">/**</span><span class="c"> commenting this out because DataCollectionRules have a different error response format from everything else in AzureMonitor and so they can&#39;t be built with this SDK.</span>
    <span class="c">public class DataCollectionRulesTests : TestBase</span>
    <span class="c">{</span>
        <span class="c">#region DCR Tests</span>
        <span class="c">[Fact]</span>
        <span class="c">[Trait(&quot;Category&quot;, &quot;Mock&quot;)]</span>
        <span class="c">public void CreateDataCollectionRuleTest()</span>
        <span class="c">{</span>
            <span class="c">DataCollectionRuleResource expectedResult = new DataCollectionRuleResource(</span>
                <span class="c">location: &quot;eastus&quot;,</span>
                <span class="c">destinations: new DataCollectionRuleDestinations(), </span>
                <span class="c">dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(), </span>
                <span class="c">description: &quot;Second DCR&quot;, </span>
                <span class="c">dataSources: new DataCollectionRuleDataSources());</span>
 
            <span class="c">var handler = new RecordedDelegatingHandler();</span>
            <span class="c">var insightsClient = GetMonitorManagementClient(handler);</span>
            <span class="c">var serializedObject = Microsoft.Rest.Serialization.SafeJsonConvert.SerializeObject(expectedResult, insightsClient.SerializationSettings);            </span>
            <span class="c">var expectedResponse = new HttpResponseMessage(HttpStatusCode.OK)</span>
            <span class="c">{</span>
                <span class="c">Content = new StringContent(serializedObject)</span>
            <span class="c">};</span>
 
            <span class="c">handler = new RecordedDelegatingHandler(expectedResponse);</span>
            <span class="c">insightsClient = GetMonitorManagementClient(handler);</span>
            
            <span class="c">var result = insightsClient.DataCollectionRules.Create(&quot;rg-amcs-test&quot;, &quot;dcrCreateDataCollectionRuleTest&quot;, new DataCollectionRuleResource(</span>
                    <span class="c">destinations: new DataCollectionRuleDestinations(), </span>
                    <span class="c">dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(), </span>
                    <span class="c">location: &quot;eastus&quot;, </span>
                    <span class="c">description: &quot;Second DCR&quot;, </span>
                    <span class="c">dataSources: new DataCollectionRuleDataSources(), </span>
                    <span class="c">tags: null, </span>
                    <span class="c">id: null, </span>
                    <span class="c">name: null, </span>
                    <span class="c">type: null</span>
                <span class="c">));</span>
 
            <span class="c">AreEqual(expectedResult, result);</span>
        <span class="c">}</span>
 
        <span class="c">[Fact]</span>
        <span class="c">[Trait(&quot;Category&quot;, &quot;Mock&quot;)]</span>
        <span class="c">public async Task DeleteDataCollectionRuleTestAsync()</span>
        <span class="c">{</span>
            <span class="c">var expectedResponse = new HttpResponseMessage(HttpStatusCode.OK);</span>
 
            <span class="c">var handler = new RecordedDelegatingHandler(expectedResponse);</span>
            <span class="c">var monitorManagementClient = GetMonitorManagementClient(handler);</span>
 
            <span class="c">var response = await monitorManagementClient.DataCollectionRules.DeleteWithHttpMessagesAsync(&quot;rg-amcs-test&quot;, &quot;dcrDeleteDataCollectionRuleTest&quot;);</span>
 
            <span class="c">Assert.Equal(HttpStatusCode.OK, response.Response.StatusCode);</span>
        <span class="c">}</span>
 
        <span class="c">[Fact]</span>
        <span class="c">[Trait(&quot;Category&quot;, &quot;Mock&quot;)]</span>
        <span class="c">public void GetDataCollectionRuleTest()</span>
        <span class="c">{</span>
            <span class="c">var expectedResult = new DataCollectionRuleResource(</span>
                <span class="c">location: &quot;eastus&quot;,</span>
                <span class="c">destinations: new DataCollectionRuleDestinations(),</span>
                <span class="c">dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(),</span>
                <span class="c">description: &quot;Second DCR&quot;,</span>
                <span class="c">dataSources: new DataCollectionRuleDataSources());</span>
 
            <span class="c">var handler = new RecordedDelegatingHandler();</span>
            <span class="c">var insightsClient = GetMonitorManagementClient(handler);</span>
            <span class="c">var serializedObject = Microsoft.Rest.Serialization.SafeJsonConvert.SerializeObject(expectedResult, insightsClient.SerializationSettings);</span>
            <span class="c">var expectedResponse = new HttpResponseMessage(HttpStatusCode.OK)</span>
            <span class="c">{</span>
                <span class="c">Content = new StringContent(serializedObject)</span>
            <span class="c">};</span>
 
            <span class="c">handler = new RecordedDelegatingHandler(expectedResponse);</span>
            <span class="c">insightsClient = GetMonitorManagementClient(handler);</span>
 
            <span class="c">var result = insightsClient.DataCollectionRules.Get(&quot;rg-amcs-test&quot;, &quot;dcrGetDataCollectionRuleTest&quot;);</span>
 
            <span class="c">AreEqual(expectedResult, result);</span>
        <span class="c">}</span>
 
        <span class="c">[Fact]</span>
        <span class="c">[Trait(&quot;Category&quot;, &quot;Mock&quot;)]</span>
        <span class="c">public void ListDataCollectionRulesByResourceGroupTest()</span>
        <span class="c">{</span>
            <span class="c">List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleResource</span><span class="c">&gt;</span><span class="c"> expectedResult = new List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleResource</span><span class="c">&gt;</span>
            <span class="c">{</span>
                <span class="c">new DataCollectionRuleResource(</span>
                    <span class="c">destinations: new DataCollectionRuleDestinations</span>
                    <span class="c">{</span>
                        <span class="c">AzureMonitorMetrics = new DestinationsSpecAzureMonitorMetrics(&quot;defaultAmm&quot;)</span>
                    <span class="c">},</span>
                    <span class="c">dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(),</span>
                    <span class="c">location: &quot;eastus&quot;,</span>
                    <span class="c">description: &quot;First DCR&quot;,</span>
                    <span class="c">dataSources: new DataCollectionRuleDataSources()),</span>
                <span class="c">new DataCollectionRuleResource(destinations: new DataCollectionRuleDestinations(), dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(), location: &quot;eastus&quot;, description: &quot;Second DCR&quot;, dataSources: new DataCollectionRuleDataSources()),</span>
                <span class="c">new DataCollectionRuleResource(destinations: new DataCollectionRuleDestinations(), dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(), location: &quot;eastus&quot;, description: &quot;Third DCR&quot;, dataSources: new DataCollectionRuleDataSources())</span>
            <span class="c">};</span>
 
            <span class="c">var handler = new RecordedDelegatingHandler();</span>
            <span class="c">var insightsClient = GetMonitorManagementClient(handler);</span>
            <span class="c">var serializedObject = Microsoft.Rest.Serialization.SafeJsonConvert.SerializeObject(expectedResult, insightsClient.SerializationSettings);</span>
            <span class="c">var expectedResponse = new HttpResponseMessage(HttpStatusCode.OK)</span>
            <span class="c">{</span>
                <span class="c">Content = new StringContent(string.Concat(&quot;{ \&quot;value\&quot;:&quot;, serializedObject, &quot;}&quot;))</span>
            <span class="c">};</span>
 
            <span class="c">handler = new RecordedDelegatingHandler(expectedResponse);</span>
            <span class="c">insightsClient = GetMonitorManagementClient(handler);</span>
 
            <span class="c">var actualDcrs = insightsClient.DataCollectionRules.ListByResourceGroup(resourceGroupName: &quot;rg-amcs-test&quot;);</span>
 
            <span class="c">AreEqual(expectedResult, actualDcrs.ToList());</span>
        <span class="c">}</span>
 
        <span class="c">[Fact]</span>
        <span class="c">[Trait(&quot;Category&quot;, &quot;Mock&quot;)]</span>
        <span class="c">public void ListDataCollectionRulesBySusbscriptionTest()</span>
        <span class="c">{</span>
            <span class="c">List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleResource</span><span class="c">&gt;</span><span class="c"> expectedResult = new List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleResource</span><span class="c">&gt;</span>
            <span class="c">{</span>
                <span class="c">new DataCollectionRuleResource(</span>
                    <span class="c">destinations: new DataCollectionRuleDestinations</span>
                    <span class="c">{</span>
                        <span class="c">LogAnalytics = new List</span><span class="c">&lt;</span><span class="c">LogAnalyticsDestination</span><span class="c">&gt;</span>
                        <span class="c">{</span>
                            <span class="c">new LogAnalyticsDestination(&quot;/subscription/aaa/&quot;, &quot;la-testing&quot;)</span>
                        <span class="c">}</span>
                    <span class="c">},</span>
                    <span class="c">dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(),</span>
                    <span class="c">location: &quot;eastus&quot;, </span>
                    <span class="c">description: &quot;First DCR&quot;,</span>
                    <span class="c">dataSources: new DataCollectionRuleDataSources()),</span>
                <span class="c">new DataCollectionRuleResource(destinations: new DataCollectionRuleDestinations(), dataFlows: new List</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c">(), location: &quot;eastus&quot;, description: &quot;Second DCR&quot;, dataSources: new DataCollectionRuleDataSources()),</span>
            <span class="c">};</span>
 
            <span class="c">var handler = new RecordedDelegatingHandler();</span>
            <span class="c">var insightsClient = GetMonitorManagementClient(handler);</span>
            <span class="c">var serializedObject = Microsoft.Rest.Serialization.SafeJsonConvert.SerializeObject(expectedResult, insightsClient.SerializationSettings);</span>
            <span class="c">var expectedResponse = new HttpResponseMessage(HttpStatusCode.OK)</span>
            <span class="c">{</span>
                <span class="c">Content = new StringContent(string.Concat(&quot;{ \&quot;value\&quot;:&quot;, serializedObject, &quot;}&quot;))</span>
            <span class="c">};</span>
 
            <span class="c">handler = new RecordedDelegatingHandler(expectedResponse);</span>
            <span class="c">insightsClient = GetMonitorManagementClient(handler);</span>
 
            <span class="c">var actualDcrs = insightsClient.DataCollectionRules.ListBySubscription();</span>
 
            <span class="c">AreEqual(expectedResult, actualDcrs.ToList());</span>
        <span class="c">}</span>
 
        <span class="c">[Fact]</span>
        <span class="c">[Trait(&quot;Category&quot;, &quot;Mock&quot;)]</span>
        <span class="c">public void UpdateDataCollectionRuleTest()</span>
        <span class="c">{</span>
            <span class="c">var expectedResult = new Dictionary</span><span class="c">&lt;</span><span class="c">string</span><span class="c">,</span> <span class="c">string</span><span class="c">&gt;</span>
            <span class="c">{</span>
                <span class="c">{ &quot;tag1&quot;, &quot;value1&quot; },</span>
                <span class="c">{ &quot;tag2&quot;, &quot;value2&quot; }</span>
            <span class="c">};</span>
 
            <span class="c">var handler = new RecordedDelegatingHandler();</span>
            <span class="c">var insightsClient = GetMonitorManagementClient(handler);</span>
            <span class="c">var serializedObject = Microsoft.Rest.Serialization.SafeJsonConvert.SerializeObject(new DataCollectionRuleResource { Tags = expectedResult }, insightsClient.SerializationSettings);</span>
 
            <span class="c">var expectedResponse = new HttpResponseMessage(HttpStatusCode.OK)</span>
            <span class="c">{</span>
                <span class="c">Content = new StringContent(serializedObject)</span>
            <span class="c">};</span>
 
            <span class="c">handler = new RecordedDelegatingHandler(expectedResponse);</span>
            <span class="c">insightsClient = GetMonitorManagementClient(handler);</span>
 
            <span class="c">var result = insightsClient.DataCollectionRules.Update(&quot;rg-amcs-test&quot;, &quot;dcrUpdateDataCollectionRuleTest&quot;, expectedResult);</span>
            <span class="c">Utilities.AreEqual(expectedResult, result.Tags);</span>
        <span class="c">}</span>
        <span class="c">#endregion</span>
 
        <span class="c">#region DCR AreEqual Helpers</span>
        <span class="c">private static void AreEqual(DataCollectionRuleResource exp, DataCollectionRuleResource act)</span>
        <span class="c">{</span>
            <span class="c">if (exp != null)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal(exp.Id, act.Id);</span>
                <span class="c">Assert.Equal(exp.Name, act.Name);</span>
                <span class="c">Assert.Equal(exp.Description, act.Description);</span>
                <span class="c">Assert.Equal(exp.Etag, act.Etag);</span>
                <span class="c">Assert.Equal(exp.Location, act.Location);</span>
                <span class="c">Assert.Equal(exp.ProvisioningState, act.ProvisioningState);</span>
                <span class="c">Assert.Equal(exp.Type, act.Type);</span>
                <span class="c">Utilities.AreEqual(exp.Tags, act.Tags);</span>
 
                <span class="c">AreEqual(exp.DataFlows, act.DataFlows);</span>
                <span class="c">AreEqual(exp.DataSources, act.DataSources);</span>
                <span class="c">AreEqual(exp.Destinations, act.Destinations);</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private static void AreEqual(IList</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c"> exp, IList</span><span class="c">&lt;</span><span class="c">DataFlow</span><span class="c">&gt;</span><span class="c"> act)</span>
        <span class="c">{</span>
            <span class="c">if (exp != null)</span>
            <span class="c">{</span>
                <span class="c">for (int i = 0; i </span><span class="c">&lt;</span> <span class="c">exp.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                <span class="c">}</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleResource</span><span class="c">&gt;</span><span class="c"> exp, List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleResource</span><span class="c">&gt;</span><span class="c"> act)</span>
        <span class="c">{</span>
            <span class="c">if (exp != null)</span>
            <span class="c">{</span>
                <span class="c">for (int i = 0; i </span><span class="c">&lt;</span> <span class="c">exp.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                <span class="c">}</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">DataCollectionRuleDataSources</span> <span class="c">exp</span><span class="c">,</span> <span class="c">DataCollectionRuleDataSources</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">if</span> <span class="c">(</span><span class="c">exp.PerformanceCounters</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">for</span> <span class="c">(</span><span class="c">int</span> <span class="c">i</span> <span class="c">=</span> <span class="c">0</span><span class="c">;</span> <span class="c">i</span><span class="c"> </span><span class="c">&lt;</span> <span class="c">exp.PerformanceCounters.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                    <span class="c">{</span>
                        <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp.PerformanceCounters</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act.PerformanceCounters</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                    <span class="c">}</span>
                <span class="c">}</span>
 
                <span class="c">if</span> <span class="c">(</span><span class="c">exp.WindowsEventLogs</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">for</span> <span class="c">(</span><span class="c">int</span> <span class="c">i</span> <span class="c">=</span> <span class="c">0</span><span class="c">;</span> <span class="c">i</span><span class="c"> </span><span class="c">&lt;</span> <span class="c">exp.WindowsEventLogs.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                    <span class="c">{</span>
                        <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp.WindowsEventLogs</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act.WindowsEventLogs</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                    <span class="c">}</span>
                <span class="c">}</span>
 
                <span class="c">if</span> <span class="c">(</span><span class="c">exp.Syslog</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">for</span> <span class="c">(</span><span class="c">int</span> <span class="c">i</span> <span class="c">=</span> <span class="c">0</span><span class="c">;</span> <span class="c">i</span><span class="c"> </span><span class="c">&lt;</span> <span class="c">exp.Syslog.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                    <span class="c">{</span>
                        <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp.Syslog</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act.Syslog</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                    <span class="c">}</span>
                <span class="c">}</span>
                
                <span class="c">if</span> <span class="c">(</span><span class="c">exp.Extensions</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">for</span> <span class="c">(</span><span class="c">int</span> <span class="c">i</span> <span class="c">=</span> <span class="c">0</span><span class="c">;</span> <span class="c">i</span><span class="c"> </span><span class="c">&lt;</span> <span class="c">exp.Extensions.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                    <span class="c">{</span>
                        <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp.Extensions</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act.Extensions</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                    <span class="c">}</span>
                <span class="c">}</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">DataCollectionRuleDestinations</span> <span class="c">exp</span><span class="c">,</span> <span class="c">DataCollectionRuleDestinations</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">if</span> <span class="c">(</span><span class="c">exp.AzureMonitorMetrics</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.AzureMonitorMetrics.Name</span><span class="c">,</span> <span class="c">act.AzureMonitorMetrics.Name</span><span class="c">)</span><span class="c">;</span>
                <span class="c">}</span>
 
                <span class="c">if</span> <span class="c">(</span><span class="c">exp.LogAnalytics</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">for</span> <span class="c">(</span><span class="c">int</span> <span class="c">i</span> <span class="c">=</span> <span class="c">0</span><span class="c">;</span> <span class="c">i</span><span class="c"> </span><span class="c">&lt;</span> <span class="c">exp.LogAnalytics.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                    <span class="c">{</span>
                        <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp.LogAnalytics</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act.LogAnalytics</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                    <span class="c">}</span>
                <span class="c">}</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">DataFlow</span> <span class="c">exp</span><span class="c">,</span> <span class="c">DataFlow</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Destinations.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.Destinations.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">PerfCounterDataSource</span> <span class="c">exp</span><span class="c">,</span> <span class="c">PerfCounterDataSource</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.CounterSpecifiers.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.CounterSpecifiers.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Name</span><span class="c">,</span> <span class="c">act.Name</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.SamplingFrequencyInSeconds</span><span class="c">,</span> <span class="c">act.SamplingFrequencyInSeconds</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">WindowsEventLogDataSource</span> <span class="c">exp</span><span class="c">,</span> <span class="c">WindowsEventLogDataSource</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Name</span><span class="c">,</span> <span class="c">act.Name</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.XPathQueries.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.XPathQueries.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">SyslogDataSource</span> <span class="c">exp</span><span class="c">,</span> <span class="c">SyslogDataSource</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.FacilityNames.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.FacilityNames.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.LogLevels.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.LogLevels.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Name</span><span class="c">,</span> <span class="c">act.Name</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">ExtensionDataSource</span> <span class="c">exp</span><span class="c">,</span> <span class="c">ExtensionDataSource</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.ExtensionName</span><span class="c">,</span> <span class="c">act.ExtensionName</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.ExtensionSettings.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.ExtensionSettings.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Name</span><span class="c">,</span> <span class="c">act.Name</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">,</span> <span class="c">act.Streams.ToJson</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">static</span> <span class="c">void</span> <span class="c">AreEqual</span><span class="c">(</span><span class="c">LogAnalyticsDestination</span> <span class="c">exp</span><span class="c">,</span> <span class="c">LogAnalyticsDestination</span> <span class="c">act</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">if</span> <span class="c">(</span><span class="c">exp</span> <span class="c">!</span><span class="c">=</span> <span class="c">null</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.Name</span><span class="c">,</span> <span class="c">act.Name</span><span class="c">)</span><span class="c">;</span>
                <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">exp.WorkspaceResourceId</span><span class="c">,</span> <span class="c">act.WorkspaceResourceId</span><span class="c">)</span><span class="c">;</span>
            <span class="c">}</span>
        <span class="c">}</span>
        <span class="c">#</span><span class="c">endregion</span>
 
        <span class="c">#</span><span class="c">region</span> <span class="c">DCRA</span> <span class="c">Tests</span>
        <span class="c">[</span><span class="c">Fact</span><span class="c">]</span>
        <span class="c">[</span><span class="c">Trait</span><span class="c">(</span><span class="c">&quot;</span><span class="c">Category</span><span class="c">&quot;</span><span class="c">,</span> <span class="c">&quot;</span><span class="c">Mock</span><span class="c">&quot;</span><span class="c">)</span><span class="c">]</span>
        <span class="c">public</span> <span class="c">void</span> <span class="c">CreateDataCollectionRuleAssociationTest</span><span class="c">(</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">var</span> <span class="c">expectedResult</span> <span class="c">=</span> <span class="c">GetOneDcra</span><span class="c">(</span><span class="c">&quot;</span><span class="c">CreateTest</span><span class="c">&quot;</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">expectedResponse</span> <span class="c">=</span> <span class="c">new</span> <span class="c">HttpResponseMessage</span><span class="c">(</span><span class="c">HttpStatusCode.OK</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Content</span> <span class="c">=</span> <span class="c">new</span> <span class="c">StringContent</span><span class="c">(</span><span class="c">SerializeDcra</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">insightsClient.SerializationSettings</span><span class="c">)</span><span class="c">)</span>
            <span class="c">}</span><span class="c">;</span>
 
            <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">expectedResponse</span><span class="c">)</span><span class="c">;</span>
            <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">result</span> <span class="c">=</span> <span class="c">insightsClient.DataCollectionRuleAssociations.Create</span><span class="c">(</span>
                <span class="c">resourceUri</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">/</span><span class="c">subscriptions</span><span class="c">/</span><span class="c">xxxxxxx-xxxx-xxxx</span><span class="c">/</span><span class="c">resourceGroups</span><span class="c">/</span><span class="c">rgGroup</span><span class="c">/</span><span class="c">providers</span><span class="c">/</span><span class="c">Microsoft.Compute</span><span class="c">/</span><span class="c">virtualMachines</span><span class="c">/</span><span class="c">vm-Test</span><span class="c">&quot;</span><span class="c">,</span> 
                <span class="c">associationName</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">dcrBcdrTestAssoc</span><span class="c">&quot;</span><span class="c">,</span> 
                <span class="c">body</span><span class="c">:</span> <span class="c">expectedResult</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">AreEqual</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">result</span><span class="c">)</span><span class="c">;</span>
        <span class="c">}</span>
 
        <span class="c">[</span><span class="c">Fact</span><span class="c">]</span>
        <span class="c">[</span><span class="c">Trait</span><span class="c">(</span><span class="c">&quot;</span><span class="c">Category</span><span class="c">&quot;</span><span class="c">,</span> <span class="c">&quot;</span><span class="c">Mock</span><span class="c">&quot;</span><span class="c">)</span><span class="c">]</span>
        <span class="c">public</span> <span class="c">async</span> <span class="c">Task</span> <span class="c">DeleteDataCollectionRuleAssociationTestAsync</span><span class="c">(</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">var</span> <span class="c">expectedResponse</span> <span class="c">=</span> <span class="c">new</span> <span class="c">HttpResponseMessage</span><span class="c">(</span><span class="c">HttpStatusCode.OK</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">expectedResponse</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">monitorManagementClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">response</span> <span class="c">=</span> <span class="c">await</span> <span class="c">monitorManagementClient.DataCollectionRuleAssociations.DeleteWithHttpMessagesAsync</span><span class="c">(</span>
                <span class="c">resourceUri</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">/</span><span class="c">subscriptions</span><span class="c">/</span><span class="c">xxxxxxx-xxxx-xxxx</span><span class="c">/</span><span class="c">resourceGroups</span><span class="c">/</span><span class="c">rgGroup</span><span class="c">/</span><span class="c">providers</span><span class="c">/</span><span class="c">Microsoft.Compute</span><span class="c">/</span><span class="c">virtualMachines</span><span class="c">/</span><span class="c">vm-Test</span><span class="c">&quot;</span><span class="c">,</span>
                <span class="c">associationName</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">dcrBcdrTestAssoc</span><span class="c">&quot;</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">Assert.Equal</span><span class="c">(</span><span class="c">HttpStatusCode.OK</span><span class="c">,</span> <span class="c">response.Response.StatusCode</span><span class="c">)</span><span class="c">;</span>
        <span class="c">}</span>
 
        <span class="c">[</span><span class="c">Fact</span><span class="c">]</span>
        <span class="c">[</span><span class="c">Trait</span><span class="c">(</span><span class="c">&quot;</span><span class="c">Category</span><span class="c">&quot;</span><span class="c">,</span> <span class="c">&quot;</span><span class="c">Mock</span><span class="c">&quot;</span><span class="c">)</span><span class="c">]</span>
        <span class="c">public</span> <span class="c">void</span> <span class="c">GetDataCollectionRuleAssociationTest</span><span class="c">(</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">var</span> <span class="c">expectedResult</span> <span class="c">=</span> <span class="c">GetOneDcra</span><span class="c">(</span><span class="c">&quot;</span><span class="c">GetTest</span><span class="c">&quot;</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">expectedResponse</span> <span class="c">=</span> <span class="c">new</span> <span class="c">HttpResponseMessage</span><span class="c">(</span><span class="c">HttpStatusCode.OK</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Content</span> <span class="c">=</span> <span class="c">new</span> <span class="c">StringContent</span><span class="c">(</span><span class="c">SerializeDcra</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">insightsClient.SerializationSettings</span><span class="c">)</span><span class="c">)</span>
            <span class="c">}</span><span class="c">;</span>
 
            <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">expectedResponse</span><span class="c">)</span><span class="c">;</span>
            <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">result</span> <span class="c">=</span> <span class="c">insightsClient.DataCollectionRuleAssociations.Get</span><span class="c">(</span><span class="c">&quot;</span><span class="c">rg-amcs-test</span><span class="c">&quot;</span><span class="c">,</span> <span class="c">&quot;</span><span class="c">dcrAssoc</span><span class="c">&quot;</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">AreEqual</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">result</span><span class="c">)</span><span class="c">;</span>
        <span class="c">}</span>
 
        <span class="c">[</span><span class="c">Fact</span><span class="c">]</span>
        <span class="c">[</span><span class="c">Trait</span><span class="c">(</span><span class="c">&quot;</span><span class="c">Category</span><span class="c">&quot;</span><span class="c">,</span> <span class="c">&quot;</span><span class="c">Mock</span><span class="c">&quot;</span><span class="c">)</span><span class="c">]</span>
        <span class="c">public</span> <span class="c">void</span> <span class="c">ListDataCollectionRulesAssociationByResourceTest</span><span class="c">(</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">var</span> <span class="c">expectedResult</span> <span class="c">=</span> <span class="c">GetListDcra</span><span class="c">(</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">expectedResponse</span> <span class="c">=</span> <span class="c">new</span> <span class="c">HttpResponseMessage</span><span class="c">(</span><span class="c">HttpStatusCode.OK</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Content</span> <span class="c">=</span> <span class="c">new</span> <span class="c">StringContent</span><span class="c">(</span><span class="c">SerializeDcraList</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">insightsClient.SerializationSettings</span><span class="c">)</span><span class="c">)</span>
            <span class="c">}</span><span class="c">;</span>
 
            <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">expectedResponse</span><span class="c">)</span><span class="c">;</span>
            <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">actualDcrs</span> <span class="c">=</span> <span class="c">insightsClient.DataCollectionRuleAssociations.ListByResource</span><span class="c">(</span>
                <span class="c">resourceUri</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">/</span><span class="c">subscriptions</span><span class="c">/</span><span class="c">xxxxxxx-xxxx-xxxx</span><span class="c">/</span><span class="c">resourceGroups</span><span class="c">/</span><span class="c">rgGroup</span><span class="c">/</span><span class="c">providers</span><span class="c">/</span><span class="c">Microsoft.Compute</span><span class="c">/</span><span class="c">virtualMachines</span><span class="c">/</span><span class="c">vm-Test</span><span class="c">&quot;</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">AreEqual</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">actualDcrs.ToList</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
        <span class="c">}</span>
 
        <span class="c">[</span><span class="c">Fact</span><span class="c">]</span>
        <span class="c">[</span><span class="c">Trait</span><span class="c">(</span><span class="c">&quot;</span><span class="c">Category</span><span class="c">&quot;</span><span class="c">,</span> <span class="c">&quot;</span><span class="c">Mock</span><span class="c">&quot;</span><span class="c">)</span><span class="c">]</span>
        <span class="c">public</span> <span class="c">void</span> <span class="c">ListDataCollectionRulesAssociationByRuleTest</span><span class="c">(</span><span class="c">)</span>
        <span class="c">{</span>
            <span class="c">var</span> <span class="c">expectedResult</span> <span class="c">=</span> <span class="c">GetListDcra</span><span class="c">(</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
            <span class="c">var</span> <span class="c">expectedResponse</span> <span class="c">=</span> <span class="c">new</span> <span class="c">HttpResponseMessage</span><span class="c">(</span><span class="c">HttpStatusCode.OK</span><span class="c">)</span>
            <span class="c">{</span>
                <span class="c">Content</span> <span class="c">=</span> <span class="c">new</span> <span class="c">StringContent</span><span class="c">(</span><span class="c">SerializeDcraList</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">insightsClient.SerializationSettings</span><span class="c">)</span><span class="c">)</span>
            <span class="c">}</span><span class="c">;</span>
 
            <span class="c">handler</span> <span class="c">=</span> <span class="c">new</span> <span class="c">RecordedDelegatingHandler</span><span class="c">(</span><span class="c">expectedResponse</span><span class="c">)</span><span class="c">;</span>
            <span class="c">insightsClient</span> <span class="c">=</span> <span class="c">GetMonitorManagementClient</span><span class="c">(</span><span class="c">handler</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">var</span> <span class="c">actualDcrs</span> <span class="c">=</span> <span class="c">insightsClient.DataCollectionRuleAssociations.ListByRule</span><span class="c">(</span>
                <span class="c">&quot;</span><span class="c">rg-amcs-test</span><span class="c">&quot;</span><span class="c">,</span> <span class="c">&quot;</span><span class="c">dcrGetDataCollectionRuleTest</span><span class="c">&quot;</span><span class="c">)</span><span class="c">;</span>
 
            <span class="c">AreEqual</span><span class="c">(</span><span class="c">expectedResult</span><span class="c">,</span> <span class="c">actualDcrs.ToList</span><span class="c">(</span><span class="c">)</span><span class="c">)</span><span class="c">;</span>
        <span class="c">}</span>
        <span class="c">#</span><span class="c">endregion</span>
 
        <span class="c">#</span><span class="c">region</span> <span class="c">DCRA</span> <span class="c">Helpers</span>
        <span class="c">private</span> <span class="c">DataCollectionRuleAssociationProxyOnlyResource</span> <span class="c">GetOneDcra</span><span class="c">(</span><span class="c">string</span> <span class="c">id</span><span class="c">)</span> 
        <span class="c">{</span> 
            <span class="c">return</span> <span class="c">new</span> <span class="c">DataCollectionRuleAssociationProxyOnlyResource</span><span class="c">(</span>
                    <span class="c">dataCollectionRuleId</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">/</span><span class="c">subscriptions</span><span class="c">/</span><span class="c">xxxxxxx-xxxx-xxxx</span><span class="c">/</span><span class="c">resourceGroups</span><span class="c">/</span><span class="c">rgGroup</span><span class="c">/</span><span class="c">providers</span><span class="c">/</span><span class="c">Microsoft.Insights</span><span class="c">/</span><span class="c">dataCollectionRules</span><span class="c">/</span><span class="c">dcrName</span><span class="c">&quot;</span><span class="c">,</span>
                    <span class="c">description</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">Associate</span> <span class="c">VM</span> <span class="c">to</span> <span class="c">DCR</span><span class="c">&quot;</span><span class="c">,</span>
                    <span class="c">id</span><span class="c">:</span> <span class="c">id</span><span class="c">,</span>
                    <span class="c">name</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">dcrBcdrTestAssoc</span><span class="c">&quot;</span><span class="c">,</span>
                    <span class="c">type</span><span class="c">:</span> <span class="c">&quot;</span><span class="c">Microsoft.Insights</span><span class="c">/</span><span class="c">dataCollectionRuleAssociations</span><span class="c">&quot;</span>
                <span class="c">)</span><span class="c">;</span>
        <span class="c">}</span>
 
        <span class="c">private</span> <span class="c">List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleAssociationProxyOnlyResource</span><span class="c">&gt;</span><span class="c"> GetListDcra()</span>
        <span class="c">{</span>
            <span class="c">return new List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleAssociationProxyOnlyResource</span><span class="c">&gt;</span><span class="c"> </span>
            <span class="c">{ </span>
                <span class="c">GetOneDcra(&quot;First DCRA&quot;),</span>
                <span class="c">GetOneDcra(&quot;Second DCRA&quot;),</span>
                <span class="c">GetOneDcra(&quot;Third DCRA&quot;)</span>
            <span class="c">};</span>
        <span class="c">}</span>
 
        <span class="c">private string SerializeDcra(DataCollectionRuleAssociationProxyOnlyResource drca, JsonSerializerSettings jsonSerializerSettings)</span>
        <span class="c">{</span>
            <span class="c">var serializedObject = Microsoft.Rest.Serialization.SafeJsonConvert.SerializeObject(drca, jsonSerializerSettings);</span>
            <span class="c">var currPos = serializedObject.IndexOf(&quot;\&quot;properties\&quot;:&quot;, 0);</span>
            <span class="c">serializedObject = serializedObject.Insert(currPos, &quot;\&quot;name\&quot;:\&quot;&quot; + drca.Name + &quot;\&quot;,\r\n\&quot;type\&quot;:\&quot;&quot; + drca.Type + &quot;\&quot;,\r\n\&quot;id\&quot;:\&quot;&quot; + drca.Id + &quot;\&quot;,\r\n&quot;);</span>
            
            <span class="c">return serializedObject;</span>
        <span class="c">}</span>
 
        <span class="c">private string SerializeDcraList(List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleAssociationProxyOnlyResource</span><span class="c">&gt;</span><span class="c"> drcaList, JsonSerializerSettings jsonSerializerSettings)</span>
        <span class="c">{</span>
            <span class="c">var serializedObject = Microsoft.Rest.Serialization.SafeJsonConvert.SerializeObject(drcaList, jsonSerializerSettings);</span>
 
            <span class="c">var startIndex = 0;</span>
            <span class="c">foreach (var dcra in drcaList)</span>
            <span class="c">{</span>
                <span class="c">var currPos = serializedObject.IndexOf(&quot;\&quot;properties\&quot;:&quot;, startIndex);</span>
                <span class="c">serializedObject = serializedObject.Insert(currPos, &quot;\&quot;name\&quot;:\&quot;&quot; + dcra.Name + &quot;\&quot;,\r\n\&quot;type\&quot;:\&quot;&quot; + dcra.Type + &quot;\&quot;,\r\n\&quot;id\&quot;:\&quot;&quot; + dcra.Id + &quot;\&quot;,\r\n&quot;);</span>
                <span class="c">startIndex = serializedObject.IndexOf(&quot;\&quot;properties\&quot;:&quot;, startIndex) + 1;</span>
            <span class="c">}</span>
 
            <span class="c">return string.Concat(&quot;{ \&quot;value\&quot;:&quot;, serializedObject, &quot;}&quot;);</span>
        <span class="c">}</span>
 
        <span class="c">private static void AreEqual(DataCollectionRuleAssociationProxyOnlyResource exp, DataCollectionRuleAssociationProxyOnlyResource act)</span>
        <span class="c">{</span>
            <span class="c">if (exp != null)</span>
            <span class="c">{</span>
                <span class="c">Assert.Equal(exp.DataCollectionRuleId, act.DataCollectionRuleId);</span>
                <span class="c">Assert.Equal(exp.Description, act.Description);</span>
                <span class="c">Assert.Equal(exp.Etag, act.Etag);</span>
                <span class="c">Assert.Equal(exp.Id, act.Id);</span>
                <span class="c">Assert.Equal(exp.Name, act.Name);</span>
                <span class="c">Assert.Equal(exp.ProvisioningState, act.ProvisioningState);</span>
                <span class="c">Assert.Equal(exp.Type, act.Type);</span>
            <span class="c">}</span>
        <span class="c">}</span>
 
        <span class="c">private static void AreEqual(List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleAssociationProxyOnlyResource</span><span class="c">&gt;</span><span class="c"> exp, List</span><span class="c">&lt;</span><span class="c">DataCollectionRuleAssociationProxyOnlyResource</span><span class="c">&gt;</span><span class="c"> act) </span>
        <span class="c">{</span>
            <span class="c">if (exp != null)</span>
            <span class="c">{</span>
                <span class="c">for (int i = 0; i </span><span class="c">&lt;</span> <span class="c">exp.Count</span><span class="c">;</span> <span class="c">i</span><span class="c">+</span><span class="c">+</span><span class="c">)</span>
                <span class="c">{</span>
                    <span class="c">AreEqual</span><span class="c">(</span><span class="c">exp</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">,</span> <span class="c">act</span><span class="c">[</span><span class="c">i</span><span class="c">]</span><span class="c">)</span><span class="c">;</span>
                <span class="c">}</span>
            <span class="c">}</span>
        <span class="c">}</span>
        <span class="c">#</span><span class="c">endregion</span>
    <span class="c">}</span>
    <span class="c">*/</span>
}
</pre></td></tr></table></div></body></html>
