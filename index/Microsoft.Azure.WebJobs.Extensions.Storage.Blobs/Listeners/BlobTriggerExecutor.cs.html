<!DOCTYPE html>
<html><head><title>BlobTriggerExecutor.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(151);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.Storage.Blobs/Listeners/BlobTriggerExecutor.cs" target="_top">Listeners\BlobTriggerExecutor.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master//sdk/storage/Microsoft.Azure.WebJobs.Extensions.Storage.Blobs/src/Listeners/BlobTriggerExecutor.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.Storage.Blobs" target="_top">Microsoft.Azure.WebJobs.Extensions.Storage.Blobs.csproj</a> (Microsoft.Azure.WebJobs.Extensions.Storage.Blobs)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Specialized</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">Storage</span>.<span class="i n">Common</span>.<span class="i n">Listeners</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>.<span class="i n">Executors</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>.<span class="i n">Protocols</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Logging</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Listeners</span>
{
    <b>internal</b> <a href="../P/7a3540ac8598c441.html" target="s" class="k">partial</a> <b>class</b> <a id="7a3540ac8598c441" href="../R/7a3540ac8598c441.html" target="n" data-glyph="2,0" class="t t">BlobTriggerExecutor</a> : <a href="../Shared/Listeners/ITriggerExecutor.cs.html#7371353e2f184692" class="t t">ITriggerExecutor</a>&lt;<a href="BlobTriggerExecutorContext.cs.html#082c94806db01159" class="t t">BlobTriggerExecutorContext</a>&gt;
    {
        <b>internal const string</b> <a id="67a1a25e244505cb" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">TriggerSourceKey</a> = <span class="s">&quot;MS_TriggerSource&quot;</span>;
        <b>internal const string</b> <a id="a08f7f62419caeff" href="../R/../../0000000000.html" target="n" data-glyph="8,1" class="i field">TriggerClientRequestIdKey</a> = <span class="s">&quot;MS_ClientRequestId&quot;</span>;
 
        <b>private readonly string</b> <a id="5c62dd3c7c83e7fb" href="../R/5c62dd3c7c83e7fb.html" target="n" data-glyph="46,1" class="i field">_hostId</a>;
        <b>private readonly</b> <span class="t t">FunctionDescriptor</span> <a id="122ff6dcd9b8600e" href="../R/122ff6dcd9b8600e.html" target="n" data-glyph="46,1" class="i field">_functionDescriptor</a>;
        <b>private readonly</b> <a href="../IBlobPathSource.cs.html#fb74667cb17e1efd" class="t t">IBlobPathSource</a> <a id="91d380ae6bc47477" href="../R/91d380ae6bc47477.html" target="n" data-glyph="46,1" class="i field">_input</a>;
        <b>private readonly</b> <a href="IBlobTriggerQueueWriter.cs.html#fdf2312af6bfb940" class="t t">IBlobTriggerQueueWriter</a> <a id="cedf9b9803d2cb5d" href="../R/cedf9b9803d2cb5d.html" target="n" data-glyph="46,1" class="i field">_queueWriter</a>;
        <b>private readonly</b> <a href="IBlobReceiptManager.cs.html#961e2e44d223de03" class="t t">IBlobReceiptManager</a> <a id="35752b4a23df661e" href="../R/35752b4a23df661e.html" target="n" data-glyph="46,1" class="i field">_receiptManager</a>;
        <b>private readonly</b> <span class="t t">ILogger</span>&lt;<a href="BlobListener.cs.html#f6072afdd237218d" class="t t">BlobListener</a>&gt; <a id="f5ec93f5852c8db7" href="../R/f5ec93f5852c8db7.html" target="n" data-glyph="46,1" class="i field">_logger</a>;
 
        <b>public</b> <a id="67dc4286e088891c" href="../R/67dc4286e088891c.html" target="n" data-glyph="72,1" class="t constructor">BlobTriggerExecutor</a>(<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">hostId</span>, <span class="t t">FunctionDescriptor</span> <span id="r1 rd" class="r1 r">functionDescriptor</span>, <a href="../IBlobPathSource.cs.html#fb74667cb17e1efd" class="t t">IBlobPathSource</a> <span id="r2 rd" class="r2 r">input</span>,
            <a href="IBlobReceiptManager.cs.html#961e2e44d223de03" class="t t">IBlobReceiptManager</a> <span id="r3 rd" class="r3 r">receiptManager</span>, <a href="IBlobTriggerQueueWriter.cs.html#fdf2312af6bfb940" class="t t">IBlobTriggerQueueWriter</a> <span id="r4 rd" class="r4 r">queueWriter</span>, <span class="t t">ILogger</span>&lt;<a href="BlobListener.cs.html#f6072afdd237218d" class="t t">BlobListener</a>&gt; <span id="r5 rd" class="r5 r">logger</span>)
        {
            <a href="#5c62dd3c7c83e7fb" class="i field">_hostId</a> = <span class="r0 r">hostId</span>;
            <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a> = <span class="r1 r">functionDescriptor</span>;
            <a href="#91d380ae6bc47477" class="i field">_input</a> = <span class="r2 r">input</span>;
            <a href="#cedf9b9803d2cb5d" class="i field">_queueWriter</a> = <span class="r4 r">queueWriter</span>;
            <a href="#35752b4a23df661e" class="i field">_receiptManager</a> = <span class="r3 r">receiptManager</span>;
            <a href="#f5ec93f5852c8db7" class="i field">_logger</a> = <span class="r5 r">logger</span> ?? <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r5 r">logger</span>));
        }
 
        <b>public async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<span class="t t">FunctionResult</span>&gt; <a id="6a154dff885f0039" href="../R/6a154dff885f0039.html" target="n" data-glyph="72,1" class="i method">ExecuteAsync</a>(<a href="BlobTriggerExecutorContext.cs.html#082c94806db01159" class="t t">BlobTriggerExecutorContext</a> <span id="r6 rd" class="r6 r">context</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r7 rd" class="r7 r">cancellationToken</span>)
        {
            <a href="/Azure.Storage.Blobs/A.html#853236f95f48385e" class="t t">BlobBaseClient</a> <span id="r8 rd" class="r8 r">value</span> = <span class="r6 r">context</span>.<a href="BlobTriggerExecutorContext.cs.html#77ab4d235fdc4693" class="i property">Blob</a>.<a href="../BlobWithContainer.cs.html#ddc63f43d1a50e2f" class="i property">BlobClient</a>;
            <a href="BlobTriggerScanSource.cs.html#b885eb1843a6758f" class="t t">BlobTriggerScanSource</a> <span id="r9 rd" class="r9 r">triggerSource</span> = <span class="r6 r">context</span>.<a href="BlobTriggerExecutorContext.cs.html#09678fddb71cf595" class="i property">TriggerSource</a>;
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">pollId</span> = <span class="r6 r">context</span>.<a href="BlobTriggerExecutorContext.cs.html#900f32443c7a41c2" class="i property">PollId</a>;
 
            <span class="c">// Avoid unnecessary network calls for non-matches. First, check to see if the blob matches this trigger.</span>
            <a href="@1@netstandard/A.html#f786bcc5e7b69c7d" class="t t">IReadOnlyDictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt; <span id="r11 rd" class="r11 r">bindingData</span> = <a href="#91d380ae6bc47477" class="i field">_input</a>.<a href="../IBlobPathSource.cs.html#b6e20136b33d73fa" class="i method">CreateBindingData</a>(<span class="r8 r">value</span>.<a href="../BlobBaseClientExtensions.cs.html#918ef4d15e9f504b" class="i method">ToBlobPath</a>());
 
            <b>if</b> (<span class="r11 r">bindingData</span> == <b>null</b>)
            {
                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r12 rd" class="r12 r">pattern</span> = <b>new</b> <a href="../BlobPath.cs.html#a83a213b41513536" class="t constructor">BlobPath</a>(<a href="#91d380ae6bc47477" class="i field">_input</a>.<a href="../IBlobPathSource.cs.html#7fc40467f00eab05" class="i property">ContainerNamePattern</a>, <a href="#91d380ae6bc47477" class="i field">_input</a>.<a href="../IBlobPathSource.cs.html#9d43bccd6b82cb21" class="i property">BlobNamePattern</a>).<a href="../BlobPath.cs.html#8539113ead48dbdd" class="i method">ToString</a>();
                <a href="BlobTriggerExecutor.Logger.cs.html#6a39dd294b710df6" class="t t">Logger</a>.<a href="BlobTriggerExecutor.Logger.cs.html#5e89d505d1922fd2" class="i method">BlobDoesNotMatchPattern</a>(<a href="#f5ec93f5852c8db7" class="i field">_logger</a>, <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a>.<span class="i property">LogName</span>, <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>, <span class="r12 r">pattern</span>, <span class="r10 r">pollId</span>, <span class="r9 r">triggerSource</span>);
 
                <span class="c">// Blob is not a match for this trigger.</span>
                <b>return</b> <b>new</b> <span class="t constructor">FunctionResult</span>(<b>true</b>);
            }
 
            <span class="c">// Next, check to see if the blob currently exists (and, if so, what the current ETag is).</span>
            <a href="/Azure.Storage.Blobs/A.html#5eac1727e6cdaafb" class="t t">BlobProperties</a> <span id="r13 rd" class="r13 r">blobProperties</span> = <b>await</b> <span class="r8 r">value</span>.<a href="../BlobBaseClientExtensions.cs.html#de152e12539b2906" class="i method">FetchPropertiesOrNullIfNotExistAsync</a>(<span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r14 rd" class="r14 r">possibleETag</span> = <b>null</b>;
            <b>if</b> (<span class="r13 r">blobProperties</span> != <b>null</b>)
            {
                <span class="r14 r">possibleETag</span> = <span class="r13 r">blobProperties</span>.<a href="/Azure.Storage.Blobs/A.html#8491b5521f600f18" class="i property">ETag</a>.<a href="/Azure.Core/A.html#c02596ded366f933" class="i method">ToString</a>();
            }
 
            <b>if</b> (<span class="r14 r">possibleETag</span> == <b>null</b>)
            {
                <a href="BlobTriggerExecutor.Logger.cs.html#6a39dd294b710df6" class="t t">Logger</a>.<a href="BlobTriggerExecutor.Logger.cs.html#387a42522c84998f" class="i method">BlobHasNoETag</a>(<a href="#f5ec93f5852c8db7" class="i field">_logger</a>, <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a>.<span class="i property">LogName</span>, <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>, <span class="r10 r">pollId</span>, <span class="r9 r">triggerSource</span>);
 
                <span class="c">// If the blob doesn&#39;t exist and have an ETag, don&#39;t trigger on it.</span>
                <b>return</b> <b>new</b> <span class="t constructor">FunctionResult</span>(<b>true</b>);
            }
 
            <a href="/Azure.Storage.Blobs/A.html#a021487ec216e15d" class="k">var</a> <span id="r15 rd" class="r15 r">receiptBlob</span> = <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#f3cbbfe02c1b45d1" class="i method">CreateReference</a>(<a href="#5c62dd3c7c83e7fb" class="i field">_hostId</a>, <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a>.<span class="i property">Id</span>, <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#8125465144699fdb" class="i property">BlobContainerName</a>,
                <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>, <span class="r14 r">possibleETag</span>);
 
            <span class="c">// Check for the completed receipt. If it&#39;s already there, noop.</span>
            <a href="BlobReceipt.cs.html#852b85da8b5dc0b4" class="t t">BlobReceipt</a> <span id="r16 rd" class="r16 r">unleasedReceipt</span> = <b>await</b> <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#c1239dacb89dbc05" class="i method">TryReadAsync</a>(<span class="r15 r">receiptBlob</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <b>if</b> (<span class="r16 r">unleasedReceipt</span> != <b>null</b> &amp;&amp; <span class="r16 r">unleasedReceipt</span>.<a href="BlobReceipt.cs.html#1850c4aac59d3297" class="i property">IsCompleted</a>)
            {
                <a href="BlobTriggerExecutor.Logger.cs.html#6a39dd294b710df6" class="t t">Logger</a>.<a href="BlobTriggerExecutor.Logger.cs.html#625899d07c54ae03" class="i method">BlobAlreadyProcessed</a>(<a href="#f5ec93f5852c8db7" class="i field">_logger</a>, <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a>.<span class="i property">LogName</span>, <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>, <span class="r14 r">possibleETag</span>, <span class="r10 r">pollId</span>, <span class="r9 r">triggerSource</span>);
 
                <b>return</b> <b>new</b> <span class="t constructor">FunctionResult</span>(<b>true</b>);
            }
            <b>else</b> <b>if</b> (<span class="r16 r">unleasedReceipt</span> == <b>null</b>)
            {
                <span class="c">// Try to create (if not exists) an incomplete receipt.</span>
                <b>if</b> (!<b>await</b> <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#df2ad73bd13439df" class="i method">TryCreateAsync</a>(<span class="r15 r">receiptBlob</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>))
                {
                    <span class="c">// Someone else just created the receipt; wait to try to trigger until later.</span>
                    <span class="c">// Alternatively, we could just ignore the return result and see who wins the race to acquire the</span>
                    <span class="c">// lease.</span>
                    <b>return</b> <b>new</b> <span class="t constructor">FunctionResult</span>(<b>false</b>);
                }
            }
 
            <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r17 rd" class="r17 r">leaseId</span> = <b>await</b> <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#d5f0035db53c1b44" class="i method">TryAcquireLeaseAsync</a>(<span class="r15 r">receiptBlob</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
            <b>if</b> (<span class="r17 r">leaseId</span> == <b>null</b>)
            {
                <span class="c">// If someone else owns the lease and just took over this receipt or deleted it;</span>
                <span class="c">// wait to try to trigger until later.</span>
                <b>return</b> <b>new</b> <span class="t constructor">FunctionResult</span>(<b>false</b>);
            }
 
            <b>try</b>
            {
                <span class="c">// Check again for the completed receipt. If it&#39;s already there, noop.</span>
                <a href="BlobReceipt.cs.html#852b85da8b5dc0b4" class="t t">BlobReceipt</a> <span id="r18 rd" class="r18 r">receipt</span> = <b>await</b> <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#c1239dacb89dbc05" class="i method">TryReadAsync</a>(<span class="r15 r">receiptBlob</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
                <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<span class="r18 r">receipt</span> != <b>null</b>); <span class="c">// We have a (30 second) lease on the blob; it should never disappear on us.</span>
 
                <b>if</b> (<span class="r18 r">receipt</span>.<a href="BlobReceipt.cs.html#1850c4aac59d3297" class="i property">IsCompleted</a>)
                {
                    <a href="BlobTriggerExecutor.Logger.cs.html#6a39dd294b710df6" class="t t">Logger</a>.<a href="BlobTriggerExecutor.Logger.cs.html#625899d07c54ae03" class="i method">BlobAlreadyProcessed</a>(<a href="#f5ec93f5852c8db7" class="i field">_logger</a>, <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a>.<span class="i property">LogName</span>, <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>, <span class="r14 r">possibleETag</span>, <span class="r10 r">pollId</span>, <span class="r9 r">triggerSource</span>);
 
                    <b>await</b> <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#e2e505312ab5a160" class="i method">ReleaseLeaseAsync</a>(<span class="r15 r">receiptBlob</span>, <span class="r17 r">leaseId</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
                    <b>return</b> <b>new</b> <span class="t constructor">FunctionResult</span>(<b>true</b>);
                }
 
                <span class="c">// We&#39;ve successfully acquired a lease to enqueue the message for this blob trigger. Enqueue the message,</span>
                <span class="c">// complete the receipt and release the lease.</span>
 
                <span class="c">// Enqueue a message: function ID + blob path + ETag</span>
                <a href="BlobTriggerMessage.cs.html#3a8c324a1655791b" class="t t">BlobTriggerMessage</a> <span id="r19 rd" class="r19 r">message</span> = <b>new</b> <a href="BlobTriggerMessage.cs.html#3a8c324a1655791b" class="t constructor">BlobTriggerMessage</a>
                {
                    <a href="BlobTriggerMessage.cs.html#99f8e76f04390054" class="i property">FunctionId</a> = <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a>.<span class="i property">Id</span>,
                    <a href="BlobTriggerMessage.cs.html#96aa06a1a3064443" class="i property">BlobType</a> = <span class="r13 r">blobProperties</span>.<a href="/Azure.Storage.Blobs/A.html#4bb615dfc67eef0a" class="i property">BlobType</a>,
                    <a href="BlobTriggerMessage.cs.html#3f498978906e5988" class="i property">ContainerName</a> = <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#8125465144699fdb" class="i property">BlobContainerName</a>,
                    <a href="BlobTriggerMessage.cs.html#ad960702f4cedc02" class="i property">BlobName</a> = <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>,
                    <a href="BlobTriggerMessage.cs.html#826c96667eb11018" class="i property">ETag</a> = <span class="r14 r">possibleETag</span>
                };
 
                <b>var</b> (<span id="r20 rd" class="r20 r">queueName</span>, <span id="r21 rd" class="r21 r">messageId</span>) = <b>await</b> <a href="#cedf9b9803d2cb5d" class="i field">_queueWriter</a>.<a href="IBlobTriggerQueueWriter.cs.html#4e432d6b83eaffae" class="i method">EnqueueAsync</a>(<span class="r19 r">message</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#07ef75a8fa372c94" class="i method">ConfigureAwait</a>(<b>false</b>);
 
                <a href="BlobTriggerExecutor.Logger.cs.html#6a39dd294b710df6" class="t t">Logger</a>.<a href="BlobTriggerExecutor.Logger.cs.html#7ef44e776094c620" class="i method">BlobMessageEnqueued</a>(<a href="#f5ec93f5852c8db7" class="i field">_logger</a>, <a href="#122ff6dcd9b8600e" class="i field">_functionDescriptor</a>.<span class="i property">LogName</span>, <span class="r8 r">value</span>.<a href="/Azure.Storage.Blobs/A.html#157bb830a0c2db34" class="i property">Name</a>, <span class="r21 r">messageId</span>, <span class="r20 r">queueName</span>, <span class="r10 r">pollId</span>, <span class="r9 r">triggerSource</span>);
 
                <span class="c">// Complete the receipt</span>
                <b>await</b> <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#15d1be6ade14744b" class="i method">MarkCompletedAsync</a>(<span class="r15 r">receiptBlob</span>, <span class="r17 r">leaseId</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
 
                <b>return</b> <b>new</b> <span class="t constructor">FunctionResult</span>(<b>true</b>);
            }
            <b>finally</b>
            {
                <b>await</b> <a href="#35752b4a23df661e" class="i field">_receiptManager</a>.<a href="IBlobReceiptManager.cs.html#e2e505312ab5a160" class="i method">ReleaseLeaseAsync</a>(<span class="r15 r">receiptBlob</span>, <span class="r17 r">leaseId</span>, <span class="r7 r">cancellationToken</span>).<a href="@1@netstandard/A.html#9ca6b2f012ce7587" class="i method">ConfigureAwait</a>(<b>false</b>);
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
