<!DOCTYPE html>
<html><head><title>SharedBlobQueueListenerFactory.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(142);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.Storage.Blobs/Listeners/SharedBlobQueueListenerFactory.cs" target="_top">Listeners\SharedBlobQueueListenerFactory.cs</a><br/></td><td><a class="blueLink" href="https://github.com/Azure/azure-sdk-for-net/tree/master/sdk/storage/Microsoft.Azure.WebJobs.Extensions.Storage.Blobs/src/Listeners/SharedBlobQueueListenerFactory.cs" target="_blank">View on GitHub</a></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.WebJobs.Extensions.Storage.Blobs" target="_top">Microsoft.Azure.WebJobs.Extensions.Storage.Blobs.csproj</a> (Microsoft.Azure.WebJobs.Extensions.Storage.Blobs)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Queues</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Storage</span>.<span class="i n">Queues</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">Storage</span>.<span class="i n">Common</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">Storage</span>.<span class="i n">Common</span>.<span class="i n">Listeners</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>.<span class="i n">Listeners</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>.<span class="i n">Protocols</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>.<span class="i n">Queues</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Host</span>.<span class="i n">Timers</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Extensions</span>.<span class="i n">Logging</span>;
<b>using</b> <span class="i n">Newtonsoft</span>.<span class="i n">Json</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">WebJobs</span>.<span class="i n">Extensions</span>.<span class="i n">Storage</span>.<span class="i n">Blobs</span>.<span class="i n">Listeners</span>
{
    <b>internal class</b> <a id="edfc97c688203658" href="../R/edfc97c688203658.html" target="n" data-glyph="2,0" class="t t">SharedBlobQueueListenerFactory</a> : <a href="../Shared/IFactory.cs.html#74657e00cf3cd5ef" class="t t">IFactory</a>&lt;<a href="SharedBlobQueueListener.cs.html#b2dbe6c23b9f1d4b" class="t t">SharedBlobQueueListener</a>&gt;
    {
        <span class="c">// the shared queue listener for blobs doesn&#39;t have a corresponding function, so we use</span>
        <span class="c">// this constant for the scale monitor</span>
        <b>private const string</b> <a id="979b22209c1502c2" href="../R/979b22209c1502c2.html" target="n" data-glyph="10,1" class="i field">SharedBlobQueueListenerFunctionId</a> = <span class="s">&quot;SharedBlobQueueListener&quot;</span>;
 
        <b>private readonly</b> <a href="../Shared/Queues/SharedQueueWatcher.cs.html#85491c179e24020e" class="t t">SharedQueueWatcher</a> <a id="0671e677a952e613" href="../R/0671e677a952e613.html" target="n" data-glyph="46,1" class="i field">_sharedQueueWatcher</a>;
        <b>private readonly</b> <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <a id="42b7335be7cb37c4" href="../R/42b7335be7cb37c4.html" target="n" data-glyph="46,1" class="i field">_hostBlobTriggerQueue</a>;
        <b>private readonly</b> <a href="../Config/BlobsOptions.cs.html#b67bb939c196dcb2" class="t t">BlobsOptions</a> <a id="fb75ddd52f8e3ba4" href="../R/fb75ddd52f8e3ba4.html" target="n" data-glyph="46,1" class="i field">_blobsOptions</a>;
        <b>private readonly</b> <span class="t t">IWebJobsExceptionHandler</span> <a id="260bc20311eea441" href="../R/260bc20311eea441.html" target="n" data-glyph="46,1" class="i field">_exceptionHandler</a>;
        <b>private readonly</b> <a href="../IBlobWrittenWatcher.cs.html#79f2f00bd03cfb0b" class="t t">IBlobWrittenWatcher</a> <a id="af5249c8f75f39b1" href="../R/af5249c8f75f39b1.html" target="n" data-glyph="46,1" class="i field">_blobWrittenWatcher</a>;
        <b>private readonly</b> <span class="t t">FunctionDescriptor</span> <a id="275822ed17de9124" href="../R/275822ed17de9124.html" target="n" data-glyph="46,1" class="i field">_functionDescriptor</a>;
        <b>private readonly</b> <a href="/Azure.Storage.Queues/A.html#ef0f353b721b0444" class="t t">QueueServiceClient</a> <a id="b7dac26ff81e54eb" href="../R/b7dac26ff81e54eb.html" target="n" data-glyph="46,1" class="i field">_hostQueueServiceClient</a>;
        <b>private readonly</b> <span class="t t">ILoggerFactory</span> <a id="e8201e5188e909c7" href="../R/e8201e5188e909c7.html" target="n" data-glyph="46,1" class="i field">_loggerFactory</a>;
        <b>private readonly</b> <a href="../BlobTriggerSource.cs.html#f5021f2685114f63" class="t t">BlobTriggerSource</a> <a id="d85bbef5806086e5" href="../R/d85bbef5806086e5.html" target="n" data-glyph="46,1" class="i field">_blobTriggerSource</a>;
 
        <b>public</b> <a id="a993e5608b96595f" href="../R/a993e5608b96595f.html" target="n" data-glyph="72,1" class="t constructor">SharedBlobQueueListenerFactory</a>(
            <a href="/Azure.Storage.Queues/A.html#ef0f353b721b0444" class="t t">QueueServiceClient</a> <span id="r0 rd" class="r0 r">hostQueueServiceClient</span>,
            <a href="../Shared/Queues/SharedQueueWatcher.cs.html#85491c179e24020e" class="t t">SharedQueueWatcher</a> <span id="r1 rd" class="r1 r">sharedQueueWatcher</span>,
            <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r2 rd" class="r2 r">hostBlobTriggerQueue</span>,
            <a href="../Config/BlobsOptions.cs.html#b67bb939c196dcb2" class="t t">BlobsOptions</a> <span id="r3 rd" class="r3 r">blobsOptions</span>,
            <span class="t t">IWebJobsExceptionHandler</span> <span id="r4 rd" class="r4 r">exceptionHandler</span>,
            <span class="t t">ILoggerFactory</span> <span id="r5 rd" class="r5 r">loggerFactory</span>,
            <a href="../IBlobWrittenWatcher.cs.html#79f2f00bd03cfb0b" class="t t">IBlobWrittenWatcher</a> <span id="r6 rd" class="r6 r">blobWrittenWatcher</span>,
            <span class="t t">FunctionDescriptor</span> <span id="r7 rd" class="r7 r">functionDescriptor</span>,
            <a href="../BlobTriggerSource.cs.html#f5021f2685114f63" class="t t">BlobTriggerSource</a> <span id="r8 rd" class="r8 r">blobTriggerSource</span>)
        {
            <a href="#b7dac26ff81e54eb" class="i field">_hostQueueServiceClient</a> = <span class="r0 r">hostQueueServiceClient</span> ?? <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r0 r">hostQueueServiceClient</span>));
            <a href="#0671e677a952e613" class="i field">_sharedQueueWatcher</a> = <span class="r1 r">sharedQueueWatcher</span> ?? <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r1 r">sharedQueueWatcher</span>));
            <a href="#42b7335be7cb37c4" class="i field">_hostBlobTriggerQueue</a> = <span class="r2 r">hostBlobTriggerQueue</span> ?? <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r2 r">hostBlobTriggerQueue</span>));
            <a href="#fb75ddd52f8e3ba4" class="i field">_blobsOptions</a> = <span class="r3 r">blobsOptions</span> ?? <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r3 r">blobsOptions</span>));
            <a href="#260bc20311eea441" class="i field">_exceptionHandler</a> = <span class="r4 r">exceptionHandler</span> ?? <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r4 r">exceptionHandler</span>));
            <a href="#e8201e5188e909c7" class="i field">_loggerFactory</a> = <span class="r5 r">loggerFactory</span>;
            <a href="#af5249c8f75f39b1" class="i field">_blobWrittenWatcher</a> = <span class="r6 r">blobWrittenWatcher</span>;
            <a href="#275822ed17de9124" class="i field">_functionDescriptor</a> = <span class="r7 r">functionDescriptor</span>;
            <a href="#d85bbef5806086e5" class="i field">_blobTriggerSource</a> = <span class="r8 r">blobTriggerSource</span>;
        }
 
        [<span class="i n">System</span>.<span class="i n">Diagnostics</span>.<span class="i n">CodeAnalysis</span>.<a href="@1@netstandard/A.html#5e00de6576fb9ce7" class="t constructor">SuppressMessage</a>(<span class="s">&quot;Microsoft.Reliability&quot;</span>, <span class="s">&quot;CA2000:Dispose objects before losing scope&quot;</span>)]
        <b>public</b> <a href="SharedBlobQueueListener.cs.html#b2dbe6c23b9f1d4b" class="t t">SharedBlobQueueListener</a> <a id="be7f8fdd74b1c7e2" href="../R/be7f8fdd74b1c7e2.html" target="n" data-glyph="72,1" class="i method">Create</a>()
        {
            <a href="../P/6c5429c22b60f97d.html#6c5429c22b60f97d" class="t t">BlobQueueTriggerExecutor</a> <span id="r9 rd" class="r9 r">triggerExecutor</span> = <b>new</b> <a href="BlobQueueTriggerExecutor.cs.html#37ff8ce50abc737d" class="t constructor">BlobQueueTriggerExecutor</a>(<a href="#d85bbef5806086e5" class="i field">_blobTriggerSource</a>, <a href="#af5249c8f75f39b1" class="i field">_blobWrittenWatcher</a>, <a href="#e8201e5188e909c7" class="i field">_loggerFactory</a>.<span class="i method">CreateLogger</span>&lt;<a href="BlobListener.cs.html#f6072afdd237218d" class="t t">BlobListener</a>&gt;());
 
            <span class="c">// The poison queue to use for a given poison blob lives in the same</span>
            <span class="c">// storage account as the triggering blob by default. In multi-storage account scenarios</span>
            <span class="c">// that means that we&#39;ll be writing to different poison queues, determined by</span>
            <span class="c">// the triggering blob.</span>
            <span class="c">// However we use a poison queue in the host storage account as a fallback default</span>
            <span class="c">// in case a particular blob lives in a restricted &quot;blob only&quot; storage account (i.e. no queues).</span>
            <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="k">var</a> <span id="r10 rd" class="r10 r">defaultPoisonQueue</span> = <a href="#b7dac26ff81e54eb" class="i field">_hostQueueServiceClient</a>.<a href="/Azure.Storage.Queues/A.html#3691ef0a47344425" class="i method">GetQueueClient</a>(<a href="../Shared/HostQueueNames.cs.html#a7d39a9ce13e3a6e" class="t t">HostQueueNames</a>.<a href="../Shared/HostQueueNames.cs.html#0a40c76569729c79" class="i field">BlobTriggerPoisonQueue</a>);
 
            <span class="c">// This special queue bypasses the QueueProcessorFactory - we don&#39;t want people to override this.</span>
            <span class="c">// So we define our own custom queue processor factory for this listener</span>
            <a href="../Shared/Queues/QueuesOptions.cs.html#10aa607ae6dd925f" class="k">var</a> <span id="r11 rd" class="r11 r">queuesOptions</span> = <a href="#825efbdb40625c9e" class="i method">BlobsOptionsToQueuesOptions</a>(<a href="#fb75ddd52f8e3ba4" class="i field">_blobsOptions</a>);
            <a href="#d073031257a8a1cc" class="k">var</a> <span id="r12 rd" class="r12 r">queueProcessor</span> = <b>new</b> <a href="#092102b5c90cf7d0" class="t constructor">SharedBlobQueueProcessor</a>(<span class="r9 r">triggerExecutor</span>, <a href="#42b7335be7cb37c4" class="i field">_hostBlobTriggerQueue</a>, <span class="r10 r">defaultPoisonQueue</span>, <a href="#e8201e5188e909c7" class="i field">_loggerFactory</a>, <span class="r11 r">queuesOptions</span>);
            <a href="../P/b7371ab585831a7b.html#b7371ab585831a7b" class="t t">QueueListener</a>.<a href="../Shared/Queues/QueueListener.cs.html#9c9bab45fef0f1d3" class="i method">RegisterSharedWatcherWithQueueProcessor</a>(<span class="r12 r">queueProcessor</span>, <a href="#0671e677a952e613" class="i field">_sharedQueueWatcher</a>);
            <span class="t t">IListener</span> <span id="r13 rd" class="r13 r">listener</span> = <b>new</b> <a href="../Shared/Queues/QueueListener.cs.html#882e07106b7ab370" class="t constructor">QueueListener</a>(<a href="#42b7335be7cb37c4" class="i field">_hostBlobTriggerQueue</a>, <span class="r10 r">defaultPoisonQueue</span>, <span class="r9 r">triggerExecutor</span>, <a href="#260bc20311eea441" class="i field">_exceptionHandler</a>, <a href="#e8201e5188e909c7" class="i field">_loggerFactory</a>,
                <a href="#0671e677a952e613" class="i field">_sharedQueueWatcher</a>, <span class="r11 r">queuesOptions</span>, <span class="r12 r">queueProcessor</span>, <a href="#275822ed17de9124" class="i field">_functionDescriptor</a>, <span class="r14 r">functionId</span>: <a href="#979b22209c1502c2" class="i field">SharedBlobQueueListenerFunctionId</a>);
 
            <b>return</b> <b>new</b> <a href="SharedBlobQueueListener.cs.html#5e3f4cbb7288ced6" class="t constructor">SharedBlobQueueListener</a>(<span class="r13 r">listener</span>, <span class="r9 r">triggerExecutor</span>);
        }
 
        <b>internal static</b> <a href="../Shared/Queues/QueuesOptions.cs.html#10aa607ae6dd925f" class="t t">QueuesOptions</a> <a id="825efbdb40625c9e" href="../R/825efbdb40625c9e.html" target="n" data-glyph="74,1" class="i method">BlobsOptionsToQueuesOptions</a>(<a href="../Config/BlobsOptions.cs.html#b67bb939c196dcb2" class="t t">BlobsOptions</a> <span id="r15 rd" class="r15 r">blobsOptions</span>)
        {
            <span class="c">// The maximum parallelism of QueueListener is BatchSize + NewBatchThreshold when configuring queue options. I.e. extension will keep requesting new batches until number</span>
            <span class="c">// of tasks that are still processing messages is below NewBatchThreshold.</span>
 
            <span class="c">// Split MaxDegreeOfParallelism between BatchSize and NewBatchThreshold. Cap at MaxBatchSize to not exceed the limit and make sure there&#39;s at least 1 message pulled</span>
            <span class="c">// if MaxDegreeOfParallelism is 1.</span>
            <b>int</b> <span id="r16 rd" class="r16 r">batchSize</span> = <a href="@1@netstandard/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@1@netstandard/A.html#f441d55c88d635ad" class="i method">Min</a>(<a href="../Shared/Queues/QueuesOptions.cs.html#10aa607ae6dd925f" class="t t">QueuesOptions</a>.<a href="../Shared/Queues/QueuesOptions.cs.html#7569e93fb4455785" class="i field">MaxBatchSize</a>, <span class="r15 r">blobsOptions</span>.<a href="../Config/BlobsOptions.cs.html#2febd97e448db362" class="i property">MaxDegreeOfParallelism</a> / 2 + 1);
            <b>int</b> <span id="r17 rd" class="r17 r">newBatchThreshold</span> = <span class="r15 r">blobsOptions</span>.<a href="../Config/BlobsOptions.cs.html#2febd97e448db362" class="i property">MaxDegreeOfParallelism</a> - <span class="r16 r">batchSize</span>;
 
            <b>return</b> <b>new</b> <a href="../Shared/Queues/QueuesOptions.cs.html#e2bcbaa6723fbf57" class="t constructor">QueuesOptions</a>()
            {
                <a href="../Shared/Queues/QueuesOptions.cs.html#cff646d56d719788" class="i property">BatchSize</a> = <span class="r16 r">batchSize</span>,
                <a href="../Shared/Queues/QueuesOptions.cs.html#ca82c7161a128734" class="i property">NewBatchThreshold</a> = <span class="r17 r">newBatchThreshold</span>,
            };
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Custom queue processor for the shared blob queue.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private class</b> <a id="d073031257a8a1cc" href="../R/d073031257a8a1cc.html" target="n" data-glyph="4,1" class="t t">SharedBlobQueueProcessor</a> : <a href="../Shared/Queues/QueueProcessor.cs.html#0d92dbb32568bea4" class="t t">QueueProcessor</a>
        {
            <b>private</b> <a href="../P/6c5429c22b60f97d.html#6c5429c22b60f97d" class="t t">BlobQueueTriggerExecutor</a> <a id="9221ed9e9e74fe1c" href="../R/9221ed9e9e74fe1c.html" target="n" data-glyph="46,2" class="i field">_executor</a>;
 
            <b>public</b> <a id="092102b5c90cf7d0" href="../R/092102b5c90cf7d0.html" target="n" data-glyph="72,2" class="t constructor">SharedBlobQueueProcessor</a>(<a href="../P/6c5429c22b60f97d.html#6c5429c22b60f97d" class="t t">BlobQueueTriggerExecutor</a> <span id="r18 rd" class="r18 r">triggerExecutor</span>, <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r19 rd" class="r19 r">queue</span>, <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r20 rd" class="r20 r">poisonQueue</span>, <span class="t t">ILoggerFactory</span> <span id="r21 rd" class="r21 r">loggerFactory</span>, <a href="../Shared/Queues/QueuesOptions.cs.html#10aa607ae6dd925f" class="t t">QueuesOptions</a> <span id="r22 rd" class="r22 r">queuesOptions</span>)
                : <a href="../Shared/Queues/QueueProcessor.cs.html#46c76f1f339f38c5" class="k">base</a>(<b>new</b> <a href="../Shared/Queues/QueueProcessorOptions.cs.html#a09c6ef1bc1fa068" class="t constructor">QueueProcessorOptions</a>(<span class="r19 r">queue</span>, <span class="r21 r">loggerFactory</span>, <span class="r22 r">queuesOptions</span>, <span class="r20 r">poisonQueue</span>)) {
                <a href="#9221ed9e9e74fe1c" class="i field">_executor</a> = <span class="r18 r">triggerExecutor</span>;
            }
 
            <b>protected override</b> <a href="@1@netstandard/A.html#045a746eb48cbaa9" class="t t">Task</a> <a id="a6585face73f3f9f" href="../R/a6585face73f3f9f.html" target="n" data-glyph="75,2" class="i method">CopyMessageToPoisonQueueAsync</a>(<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a> <span id="r23 rd" class="r23 r">message</span>, <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <span id="r24 rd" class="r24 r">poisonQueue</span>, <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r25 rd" class="r25 r">cancellationToken</span>)
            {
                <span class="c">// determine the poison queue based on the storage account</span>
                <span class="c">// of the triggering blob, or default</span>
                <span class="r24 r">poisonQueue</span> = <a href="#716ca307f6ba0fc0" class="i method">GetPoisonQueue</a>(<span class="r23 r">message</span>) ?? <span class="r24 r">poisonQueue</span>;
 
                <b>return</b> <a href="../Shared/Queues/QueueProcessor.cs.html#0d92dbb32568bea4" class="k">base</a>.<a href="../Shared/Queues/QueueProcessor.cs.html#ae2a4fec0f188f91" class="i method">CopyMessageToPoisonQueueAsync</a>(<span class="r23 r">message</span>, <span class="r24 r">poisonQueue</span>, <span class="r25 r">cancellationToken</span>);
            }
 
            <b>private</b> <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="t t">QueueClient</a> <a id="716ca307f6ba0fc0" href="../R/716ca307f6ba0fc0.html" target="n" data-glyph="76,2" class="i method">GetPoisonQueue</a>(<a href="/Azure.Storage.Queues/A.html#eb02c418d8194406" class="t t">QueueMessage</a> <span id="r26 rd" class="r26 r">message</span>)
            {
                <b>if</b> (<span class="r26 r">message</span> == <b>null</b>)
                {
                    <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r26 r">message</span>));
                }
 
                <a href="BlobTriggerMessage.cs.html#3a8c324a1655791b" class="k">var</a> <span id="r27 rd" class="r27 r">blobTriggerMessage</span> = <span class="t t">JsonConvert</span>.<span class="i method">DeserializeObject</span>&lt;<a href="BlobTriggerMessage.cs.html#3a8c324a1655791b" class="t t">BlobTriggerMessage</a>&gt;(<span class="r26 r">message</span>.<a href="/Azure.Storage.Queues/A.html#ca6ccb0de2843484" class="i property">Body</a>.<a href="../Shared/BinaryDataExtensions.cs.html#933390ff92efcbb6" class="i method">ToValidUTF8String</a>());
 
                <a href="BlobQueueRegistration.cs.html#b51f1357cbf3fd83" class="t t">BlobQueueRegistration</a> <span id="r28 rd" class="r28 r">registration</span> = <b>null</b>;
                <b>if</b> (<a href="#9221ed9e9e74fe1c" class="i field">_executor</a>.<a href="BlobQueueTriggerExecutor.cs.html#79a527a85f01cf3c" class="i method">TryGetRegistration</a>(<span class="r27 r">blobTriggerMessage</span>.<a href="BlobTriggerMessage.cs.html#99f8e76f04390054" class="i property">FunctionId</a>, <b>out</b> <span class="r28 r">registration</span>))
                {
                    <a href="/Azure.Storage.Queues/A.html#9deade59b6175965" class="k">var</a> <span id="r29 rd" class="r29 r">poisonQueue</span> = <span class="r28 r">registration</span>.<a href="BlobQueueRegistration.cs.html#fb9ef7b630dacfc5" class="i property">QueueServiceClient</a>.<a href="/Azure.Storage.Queues/A.html#3691ef0a47344425" class="i method">GetQueueClient</a>(<a href="../Shared/HostQueueNames.cs.html#a7d39a9ce13e3a6e" class="t t">HostQueueNames</a>.<a href="../Shared/HostQueueNames.cs.html#0a40c76569729c79" class="i field">BlobTriggerPoisonQueue</a>);
                    <b>return</b> <span class="r29 r">poisonQueue</span>;
                }
 
                <b>return</b> <b>null</b>;
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
