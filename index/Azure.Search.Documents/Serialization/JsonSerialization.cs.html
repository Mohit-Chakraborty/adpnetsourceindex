<!DOCTYPE html>
<html><head><title>JsonSerialization.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(420);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Azure.Search.Documents/Serialization/JsonSerialization.cs" target="_top">Serialization\JsonSerialization.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Azure.Search.Documents" target="_top">Azure.Search.Documents.csproj</a> (Azure.Search.Documents)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License.</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>.<span class="i n">Json</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Pipeline</span>;
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Core</span>.<span class="i n">Serialization</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">EXPERIMENTAL_SPATIAL</span>
<span class="e">using Azure.Core.GeoJson;
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
<b>using</b> <span class="i n">Azure</span>.<span class="i n">Search</span>.<span class="i n">Documents</span>.<span class="i n">Models</span>;
 
<b>namespace</b> <span class="i n">Azure</span>.<span class="i n">Search</span>.<span class="i n">Documents</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> JSON serialization and conversion helpers.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal static class</b> <a id="514dfe35bc742fe6" href="../R/514dfe35bc742fe6.html" target="n" data-glyph="2,0" class="t t">JsonSerialization</a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> We serialize dates with the roundtrip format.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const string</b> <a id="acdf59252fdd3473" href="../R/acdf59252fdd3473.html" target="n" data-glyph="10,1" class="i field">DateTimeOutputFormat</a> = <span class="s">&quot;o&quot;</span>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> We parse dates using variations of the roundtrip format with</span>
        <span class="c">///</span><span class="c"> different sub-second precision.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const string</b> <a id="f788f1b380e92313" href="../R/f788f1b380e92313.html" target="n" data-glyph="10,1" class="i field">DateTimeInputFormatPrefix</a> = <span class="s">&quot;yyyy&#39;-&#39;MM&#39;-&#39;dd&#39;T&#39;HH&#39;:&#39;mm&#39;:&#39;ss&quot;</span>;
        <b>private static readonly string</b>[] <a id="7e7bbecc854497cc" href="../R/7e7bbecc854497cc.html" target="n" data-glyph="46,1" class="i field">s_dateTimeInputFormats</a> = <b>new</b>[]
        {
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;zzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;K&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fzzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fK&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;ffzzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;ffK&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fffzzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fffK&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;ffffzzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;ffffK&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fffffzzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fffffK&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;ffffffzzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;ffffffK&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fffffffzzz&quot;</span>,
            <a href="#f788f1b380e92313" class="i field">DateTimeInputFormatPrefix</a> + <span class="s">&quot;&#39;.&#39;fffffffK&quot;</span>
        };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Default JsonSerializerOptions to use.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public static</b> <span class="t t">JsonSerializerOptions</span> <a id="ee91d1f5680f4af5" href="../R/ee91d1f5680f4af5.html" target="n" data-glyph="102,1" class="i property">SerializerOptions</a> { <b>get</b>; } =
            <b>new</b> <span class="t constructor">JsonSerializerOptions</span>().<a href="#b5bf9df2718880d1" class="i method">AddSearchConverters</a>();
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Add all of the Search JsonConverters.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Serialization options.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">Serialization options.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <span class="t t">JsonSerializerOptions</span> <a id="b5bf9df2718880d1" href="../R/b5bf9df2718880d1.html" target="n" data-glyph="220,1" class="i method">AddSearchConverters</a>(<b>this</b> <span class="t t">JsonSerializerOptions</span> <span id="r0 rd" class="r0 r">options</span>)
        {
            <span class="r0 r">options</span> ??= <b>new</b> <span class="t constructor">JsonSerializerOptions</span>();
            <span class="r0 r">options</span>.<span class="i property">Converters</span>.<a href="@1@netstandard/A.html#a9319db8c62ae453" class="i method">Add</a>(<a href="SearchDoubleConverter.cs.html#85cb3cdda2bbe7b0" class="t t">SearchDoubleConverter</a>.<a href="SearchDoubleConverter.cs.html#62bf4064e1572360" class="i property">Shared</a>);
            <span class="r0 r">options</span>.<span class="i property">Converters</span>.<a href="@1@netstandard/A.html#a9319db8c62ae453" class="i method">Add</a>(<a href="SearchDateTimeOffsetConverter.cs.html#66cc447e7c2d443b" class="t t">SearchDateTimeOffsetConverter</a>.<a href="SearchDateTimeOffsetConverter.cs.html#569ed07072ed73a7" class="i property">Shared</a>);
            <span class="r0 r">options</span>.<span class="i property">Converters</span>.<a href="@1@netstandard/A.html#a9319db8c62ae453" class="i method">Add</a>(<a href="SearchDateTimeConverter.cs.html#e66298f5d11dd3e8" class="t t">SearchDateTimeConverter</a>.<a href="SearchDateTimeConverter.cs.html#e943b5cdebfbbca6" class="i property">Shared</a>);
            <span class="r0 r">options</span>.<span class="i property">Converters</span>.<a href="@1@netstandard/A.html#a9319db8c62ae453" class="i method">Add</a>(<a href="../SearchDocument/SearchDocumentConverter.cs.html#fc4c4dbaa582ff5c" class="t t">SearchDocumentConverter</a>.<a href="../SearchDocument/SearchDocumentConverter.cs.html#6315702e1a551324" class="i property">Shared</a>);
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">EXPERIMENTAL_SPATIAL</span>
<span class="e">            options.Converters.Add(new GeoJsonConverter());
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
            <b>return</b> <span class="r0 r">options</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Format floating point values.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Float.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">formatProvider</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Format Provider.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">OData string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="ecdde3214a5ca732" href="../R/ecdde3214a5ca732.html" target="n" data-glyph="72,1" class="i method">Float</a>(<b>float</b> <span id="r1 rd" class="r1 r">value</span>, <a href="@1@netstandard/A.html#0dbf315d83aad6ca" class="t t">IFormatProvider</a> <span id="r2 rd" class="r2 r">formatProvider</span>) =&gt;
            <span class="r1 r">value</span> <b>switch</b>
            {
                <b>float</b>.<a href="@1@netstandard/A.html#26ecc9e2e39d4ae6" class="i field">NegativeInfinity</a> =&gt; <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#3eac61262bbb2db6" class="i field">NegativeInfValue</a>,
                <b>float</b>.<a href="@1@netstandard/A.html#0c63f4be2478e15f" class="i field">PositiveInfinity</a> =&gt; <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#ff607d511d91f7b9" class="i field">InfValue</a>,
                <b>float</b> <span id="r3 rd" class="r3 r">x</span> <b>when</b> <b>float</b>.<a href="@1@netstandard/A.html#8d892861579c1fd7" class="i method">IsNaN</a>(<span class="r3 r">x</span>) =&gt; <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#0976536a4fc20d8a" class="i field">NanValue</a>,
                <b>float</b> <span id="r4 rd" class="r4 r">x</span> =&gt; <span class="r4 r">x</span>.<a href="@1@netstandard/A.html#770446762447fac0" class="i method">ToString</a>(<span class="r2 r">formatProvider</span>).<a href="@1@netstandard/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>()
            };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Format floating point values.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Double.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">formatProvider</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Format Provider.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">OData string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="b34b9cfe60503cff" href="../R/b34b9cfe60503cff.html" target="n" data-glyph="72,1" class="i method">Double</a>(<b>double</b> <span id="r5 rd" class="r5 r">value</span>, <a href="@1@netstandard/A.html#0dbf315d83aad6ca" class="t t">IFormatProvider</a> <span id="r6 rd" class="r6 r">formatProvider</span>) =&gt;
            <span class="r5 r">value</span> <b>switch</b>
            {
                <b>double</b>.<a href="@1@netstandard/A.html#d1da7e7a7eca349a" class="i field">NegativeInfinity</a> =&gt; <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#3eac61262bbb2db6" class="i field">NegativeInfValue</a>,
                <b>double</b>.<a href="@1@netstandard/A.html#704210f8dd6afaed" class="i field">PositiveInfinity</a> =&gt; <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#ff607d511d91f7b9" class="i field">InfValue</a>,
                <b>double</b> <span id="r7 rd" class="r7 r">x</span> <b>when</b> <b>double</b>.<a href="@1@netstandard/A.html#b3843db5f359a0fd" class="i method">IsNaN</a>(<span class="r7 r">x</span>) =&gt; <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#0976536a4fc20d8a" class="i field">NanValue</a>,
                <b>double</b> <span id="r8 rd" class="r8 r">x</span> =&gt; <span class="r8 r">x</span>.<a href="@1@netstandard/A.html#102b12e1c4385406" class="i method">ToString</a>(<span class="r6 r">formatProvider</span>).<a href="@1@netstandard/A.html#2d51c212cb09178e" class="i method">ToLowerInvariant</a>()
            };
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Format dates.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r9 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Date</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">formatProvider</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Format Provider.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">OData string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="d773c3ee461fe567" href="../R/d773c3ee461fe567.html" target="n" data-glyph="72,1" class="i method">Date</a>(<a href="@1@netstandard/A.html#df6b1eba7461813b" class="t t">DateTime</a> <span id="r9 rd" class="r9 r">value</span>, <a href="@1@netstandard/A.html#0dbf315d83aad6ca" class="t t">IFormatProvider</a> <span id="r10 rd" class="r10 r">formatProvider</span>) =&gt;
            <a href="#3d009ac1b78dc0a4" class="i method">Date</a>(
                <span class="r9 r">value</span>.<a href="@1@netstandard/A.html#9e2babef8039992d" class="i property">Kind</a> == <a href="@1@netstandard/A.html#0fc5fd70e6154b43" class="t t">DateTimeKind</a>.<a href="@1@netstandard/A.html#a6c4a5aa4cfa0ac8" class="i field">Unspecified</a> ?
                    <b>new</b> <a href="@1@netstandard/A.html#6105bbd3cc0670d0" class="t constructor">DateTimeOffset</a>(<span class="r9 r">value</span>, <a href="@1@netstandard/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@1@netstandard/A.html#225346b4cd3a8300" class="i field">Zero</a>) :
                    <b>new</b> <a href="@1@netstandard/A.html#799efb65ff67135d" class="t constructor">DateTimeOffset</a>(<span class="r9 r">value</span>),
                <span class="r10 r">formatProvider</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Format dates.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">value</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Date</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r12 r">formatProvider</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Format Provider.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">OData string.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static string</b> <a id="3d009ac1b78dc0a4" href="../R/3d009ac1b78dc0a4.html" target="n" data-glyph="72,1" class="i method">Date</a>(<a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r11 rd" class="r11 r">value</span>, <a href="@1@netstandard/A.html#0dbf315d83aad6ca" class="t t">IFormatProvider</a> <span id="r12 rd" class="r12 r">formatProvider</span>) =&gt;
            <span class="r11 r">value</span>.<a href="@1@netstandard/A.html#fba683365f88b71c" class="i method">ToString</a>(<a href="#acdf59252fdd3473" class="i field">DateTimeOutputFormat</a>, <span class="r12 r">formatProvider</span>);
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Get a stream representation of a JsonElement.  This is an</span>
        <span class="c">///</span><span class="c"> inefficient hack to let us rip out nested sub-documents</span>
        <span class="c">///</span><span class="c"> representing different model types and pass them to</span>
        <span class="c">///</span><span class="c"> ObjectSerializer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r13 r">element</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The JsonElement.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">The JsonElement&#39;s content wrapped in a Stream.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="@1@netstandard/A.html#f956b0c07e86df64" class="t t">Stream</a> <a id="b7aa914a371950ca" href="../R/b7aa914a371950ca.html" target="n" data-glyph="220,1" class="i method">ToStream</a>(<b>this</b> <span class="t t">JsonElement</span> <span id="r13 rd" class="r13 r">element</span>) =&gt;
            <b>new</b> <a href="@1@netstandard/A.html#f92fa270fda9a82b" class="t constructor">MemoryStream</a>(
                <a href="@1@netstandard/A.html#3b6090c501893c25" class="t t">Encoding</a>.<a href="@1@netstandard/A.html#a10eb90a3d884500" class="i property">UTF8</a>.<a href="@1@netstandard/A.html#83f2d2c6f22db1a9" class="i method">GetBytes</a>(
                    <span class="r13 r">element</span>.<span class="i method">GetRawText</span>()));
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Convert a JSON value into a .NET object relative to Search&#39;s EDM</span>
        <span class="c">///</span><span class="c"> types.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">element</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The JSON element.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A corresponding .NET value.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static object</b> <a id="e3fb989c93f2cf1d" href="../R/e3fb989c93f2cf1d.html" target="n" data-glyph="220,1" class="i method">GetSearchObject</a>(<b>this</b> <span class="t t">JsonElement</span> <span id="r14 rd" class="r14 r">element</span>)
        {
            <b>switch</b> (<span class="r14 r">element</span>.<span class="i property">ValueKind</span>)
            {
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">String</span>:
                    <b>return</b> <span class="r14 r">element</span>.<span class="i method">GetString</span>() <b>switch</b>
                    {
                        <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#0976536a4fc20d8a" class="i field">NanValue</a> =&gt; <b>double</b>.<a href="@1@netstandard/A.html#dcd7a869fad1e6bb" class="i field">NaN</a>,
                        <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#ff607d511d91f7b9" class="i field">InfValue</a> =&gt; <b>double</b>.<a href="@1@netstandard/A.html#704210f8dd6afaed" class="i field">PositiveInfinity</a>,
                        <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#3eac61262bbb2db6" class="i field">NegativeInfValue</a> =&gt; <b>double</b>.<a href="@1@netstandard/A.html#d1da7e7a7eca349a" class="i field">NegativeInfinity</a>,
                        <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r15 rd" class="r15 r">text</span> =&gt;
                            <a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a>.<a href="@1@netstandard/A.html#36b67f8b5c52d36c" class="i method">TryParseExact</a>(
                                    <span class="r15 r">text</span>,
                                    <a href="#7e7bbecc854497cc" class="i field">s_dateTimeInputFormats</a>,
                                    <a href="@1@netstandard/A.html#e319c6636909012f" class="t t">CultureInfo</a>.<a href="@1@netstandard/A.html#26ef1c020f0dbb7a" class="i property">InvariantCulture</a>,
                                    <a href="@1@netstandard/A.html#0052cfe5031c0372" class="t t">DateTimeStyles</a>.<a href="@1@netstandard/A.html#73c1a740cc218296" class="i field">RoundtripKind</a>,
                                    <b>out</b> <a href="@1@netstandard/A.html#68b4bb83ce8d1c31" class="t t">DateTimeOffset</a> <span id="r16 rd" class="r16 r">date</span>) ?
                                (<b>object</b>)<span class="r16 r">date</span> :
                                (<b>object</b>)<span class="r15 r">text</span>
                    };
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">Number</span>:
                    <b>if</b> (<span class="r14 r">element</span>.<span class="i method">TryGetInt32</span>(<b>out int</b> <span id="r17 rd" class="r17 r">intValue</span>)) { <b>return</b> <span class="r17 r">intValue</span>; }
                    <b>if</b> (<span class="r14 r">element</span>.<span class="i method">TryGetInt64</span>(<b>out long</b> <span id="r18 rd" class="r18 r">longValue</span>)) { <b>return</b> <span class="r18 r">longValue</span>; }
                    <b>return</b> <span class="r14 r">element</span>.<span class="i method">GetDouble</span>();
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">True</span>:
                    <b>return</b> <b>true</b>;
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">False</span>:
                    <b>return</b> <b>false</b>;
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">Undefined</span>:
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">Null</span>:
                    <b>return</b> <b>null</b>;
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">Object</span>:
                    <a href="@1@netstandard/A.html#d3599058f8d79be0" class="k">var</a> <span id="r19 rd" class="r19 r">dictionary</span> = <b>new</b> <a href="@1@netstandard/A.html#bf6849e410b43c4c" class="t constructor">Dictionary</a>&lt;<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a>, <b>object</b>&gt;();
                    <b>foreach</b> (<span class="t t">JsonProperty</span> <span id="r20 rd" class="r20 r">jsonProperty</span> <b>in</b> <span class="r14 r">element</span>.<span class="i method">EnumerateObject</span>())
                    {
                        <span class="r19 r">dictionary</span>.<a href="@1@netstandard/A.html#a7861da7aaa500fe" class="i method">Add</a>(<span class="r20 r">jsonProperty</span>.<span class="i property">Name</span>, <span class="r20 r">jsonProperty</span>.<span class="i property">Value</span>.<a href="#e3fb989c93f2cf1d" class="i method">GetSearchObject</a>());
                    }
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">EXPERIMENTAL_SPATIAL</span>
<span class="e">                    // Check if we&#39;ve got a Point instead of a complex type
                    if (dictionary.TryGetValue(&quot;type&quot;, out object type) &amp;&amp;
                        type is string typeName &amp;&amp;
                        string.Equals(typeName, &quot;Point&quot;, StringComparison.Ordinal) &amp;&amp;
                        dictionary.TryGetValue(&quot;coordinates&quot;, out object coordArray) &amp;&amp;
                        coordArray is double[] coords &amp;&amp;
                        (coords.Length == 2 || coords.Length == 3))
                    {
                        double longitude = coords[0];
                        double latitude = coords[1];
                        double? altitude = coords.Length == 3 ? (double?)coords[2] : null;
                        // TODO: Should we also pull in other PointGeography properties?
                        return new GeoPoint(new GeoPosition(longitude, latitude, altitude));
                    }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
                    <b>return</b> <span class="r19 r">dictionary</span>;
                <b>case</b> <span class="t t">JsonValueKind</span>.<span class="i field">Array</span>:
                    <a href="@1@netstandard/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r21 rd" class="r21 r">list</span> = <b>new</b> <a href="@1@netstandard/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<b>object</b>&gt;();
                    <b>foreach</b> (<span class="t t">JsonElement</span> <span id="r22 rd" class="r22 r">item</span> <b>in</b> <span class="r14 r">element</span>.<span class="i method">EnumerateArray</span>())
                    {
                        <span class="r21 r">list</span>.<a href="@1@netstandard/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r22 r">item</span>.<a href="#e3fb989c93f2cf1d" class="i method">GetSearchObject</a>());
                    }
                    <b>return</b> <span class="r21 r">list</span>.<a href="@1@netstandard/A.html#d4409b7542728cec" class="i method">ToArray</a>();
                <b>default</b>:
                    <b>throw</b> <b>new</b> <a href="@1@netstandard/A.html#3d3c2c03118be4f8" class="t constructor">NotSupportedException</a>(<span class="s">&quot;Not supported value kind &quot;</span> + <span class="r14 r">element</span>.<span class="i property">ValueKind</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Parse JSON into a SearchDocument.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r23 r">reader</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The JSON reader.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">typeToConvert</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The type to convert to.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Serialization options.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">recursionDepth</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Depth of the current read recursion to bail out of circular</span>
        <span class="c">///</span><span class="c"> references.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A deserialized SearchDocument.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static</b> <a href="../P/5b8083eede53810d.html#5b8083eede53810d" class="t t">SearchDocument</a> <a id="728d54fba3b36dac" href="../R/728d54fba3b36dac.html" target="n" data-glyph="72,1" class="i method">ReadSearchDocument</a>(
            <b>ref</b> <span class="t t">Utf8JsonReader</span> <span id="r23 rd" class="r23 r">reader</span>,
            <a href="@1@netstandard/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r24 rd" class="r24 r">typeToConvert</span>,
            <span class="t t">JsonSerializerOptions</span> <span id="r25 rd" class="r25 r">options</span>,
            <b>int</b>? <span id="r26 rd" class="r26 r">recursionDepth</span> = <b>null</b>)
        {
            <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<span class="r24 r">typeToConvert</span> != <b>null</b>);
            <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<span class="r24 r">typeToConvert</span>.<a href="@1@netstandard/A.html#ba0cffea035fe210" class="i method">IsAssignableFrom</a>(<b>typeof</b>(<a href="../P/5b8083eede53810d.html#5b8083eede53810d" class="t t">SearchDocument</a>)));
 
            <span class="r26 r">recursionDepth</span> ??= <span class="r25 r">options</span>?.<span class="i property">MaxDepth</span> ?? <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#ad71ac22b5d9ebc1" class="i field">MaxJsonRecursionDepth</a>;
            <b>if</b> (!<span class="r26 r">recursionDepth</span>.<a href="@1@netstandard/A.html#7bbe60e33e857298" class="i property">HasValue</a> || <span class="r26 r">recursionDepth</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a> &lt;= 0)
            {
                <span class="c">// JsonSerializerOptions uses 0 to mean pick their default of 64</span>
                <span class="r26 r">recursionDepth</span> = <a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#ad71ac22b5d9ebc1" class="i field">MaxJsonRecursionDepth</a>;
            }
            <b>if</b> (<span class="r26 r">recursionDepth</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a> &lt; 0) { <b>throw</b> <b>new</b> <span class="t constructor">JsonException</span>(<span class="s">&quot;Exceeded maximum recursion depth.&quot;</span>); }
 
            <a href="../P/5b8083eede53810d.html#5b8083eede53810d" class="t t">SearchDocument</a> <span id="r27 rd" class="r27 r">doc</span> = <b>new</b> <a href="../SearchDocument/SearchDocument.cs.html#6d0d1528dfb10cf1" class="t constructor">SearchDocument</a>();
            <a href="#45d8fb436a063056" class="i method">Expects</a>(<span class="r23 r">reader</span>, <span class="t t">JsonTokenType</span>.<span class="i field">StartObject</span>);
            <b>while</b> (<span class="r23 r">reader</span>.<span class="i method">Read</span>() &amp;&amp; <span class="r23 r">reader</span>.<span class="i property">TokenType</span> != <span class="t t">JsonTokenType</span>.<span class="i field">EndObject</span>)
            {
                <a href="#45d8fb436a063056" class="i method">Expects</a>(<span class="r23 r">reader</span>, <span class="t t">JsonTokenType</span>.<span class="i field">PropertyName</span>);
                <a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r28 rd" class="r28 r">propertyName</span> = <span class="r23 r">reader</span>.<span class="i method">GetString</span>();
                <span class="r23 r">reader</span>.<span class="i method">Read</span>(); <span class="c">// Advance the past the property name</span>
 
                <span class="c">// Ignore OData properties - we don&#39;t expose those on custom</span>
                <span class="c">// user schemas</span>
                <b>if</b> (!<span class="r28 r">propertyName</span>.<a href="@1@netstandard/A.html#1c787ba07a7b11ab" class="i method">StartsWith</a>(<a href="../Utilities/Constants.cs.html#0071ae1a3a2ef317" class="t t">Constants</a>.<a href="../Utilities/Constants.cs.html#d1e1d8aaa951b6f2" class="i field">ODataKeyPrefix</a>, <a href="@1@netstandard/A.html#702797def97ecb7c" class="t t">StringComparison</a>.<a href="@1@netstandard/A.html#6c3139b940557bf9" class="i field">OrdinalIgnoreCase</a>))
                {
                    <b>object</b> <span id="r29 rd" class="r29 r">value</span> = <a href="#6872575dbb1b0edf" class="i method">ReadSearchDocObject</a>(<b>ref</b> <span class="r23 r">reader</span>, <span class="r26 r">recursionDepth</span>.<a href="@1@netstandard/A.html#7b38d1fa76071c95" class="i property">Value</a> - 1);
                    <span class="r27 r">doc</span><a href="../SearchDocument/SearchDocument.Dictionary.cs.html#1c69d545858d669d">[</a><span class="r28 r">propertyName</span>] = <span class="r29 r">value</span>;
                }
                <b>else</b>
                {
                    <span class="r23 r">reader</span>.<span class="i method">Skip</span>();
                }
            }
            <b>return</b> <span class="r27 r">doc</span>;
 
            <b>object</b> <a id="6872575dbb1b0edf" href="../R/6872575dbb1b0edf.html" target="n" data-glyph="76,2" class="i method">ReadSearchDocObject</a>(<b>ref</b> <span class="t t">Utf8JsonReader</span> <span id="r30 rd" class="r30 r">reader</span>, <b>int</b> <span id="r31 rd" class="r31 r">depth</span>)
            {
                <b>if</b> (<span class="r31 r">depth</span> &lt; 0) { <b>throw</b> <b>new</b> <span class="t constructor">JsonException</span>(<span class="s">&quot;Exceeded maximum recursion depth.&quot;</span>); }
                <b>switch</b> (<span class="r30 r">reader</span>.<span class="i property">TokenType</span>)
                {
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">String</span>:
                        <b>return</b> <span class="r30 r">reader</span>.<span class="i method">GetString</span>();
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">Number</span>:
                        <b>if</b> (<span class="r30 r">reader</span>.<span class="i method">TryGetInt32</span>(<b>out int</b> <span id="r32 rd" class="r32 r">intValue</span>)) { <b>return</b> <span class="r32 r">intValue</span>; }
                        <b>if</b> (<span class="r30 r">reader</span>.<span class="i method">TryGetInt64</span>(<b>out long</b> <span id="r33 rd" class="r33 r">longValue</span>)) { <b>return</b> <span class="r33 r">longValue</span>; }
                        <b>return</b> <span class="r30 r">reader</span>.<span class="i method">GetDouble</span>();
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">True</span>:
                        <b>return</b> <b>true</b>;
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">False</span>:
                        <b>return</b> <b>false</b>;
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">None</span>:
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">Null</span>:
                        <b>return</b> <b>null</b>;
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">StartObject</span>:
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">EXPERIMENTAL_SPATIAL</span>
<span class="e">                        // Clone the reader so we can check if the object is a
                        // GeoJsonPoint without advancing tokens if not
                        Utf8JsonReader clone = reader;
                        try
                        {
                            GeoJsonConverter converter = new GeoJsonConverter();
                            GeoPoint point = converter.Read(ref clone, typeof(GeoPoint), options) as GeoPoint;
                            if (point != null)
                            {
                                reader = clone;
                                return point;
                            }
                        }
                        catch
                        {
                        }
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
                        <span class="c">// Return a complex object</span>
                        <b>return</b> <a href="#728d54fba3b36dac" class="i method">ReadSearchDocument</a>(<b>ref</b> <span class="r30 r">reader</span>, <b>typeof</b>(<a href="../P/5b8083eede53810d.html#5b8083eede53810d" class="t t">SearchDocument</a>), <span class="r25 r">options</span>, <span class="r31 r">depth</span> - 1);
                    <b>case</b> <span class="t t">JsonTokenType</span>.<span class="i field">StartArray</span>:
                        <a href="@1@netstandard/A.html#cf7f4095e4de7646" class="k">var</a> <span id="r34 rd" class="r34 r">list</span> = <b>new</b> <a href="@1@netstandard/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<b>object</b>&gt;();
                        <b>while</b> (<span class="r30 r">reader</span>.<span class="i method">Read</span>() &amp;&amp; <span class="r30 r">reader</span>.<span class="i property">TokenType</span> != <span class="t t">JsonTokenType</span>.<span class="i field">EndArray</span>)
                        {
                            <b>object</b> <span id="r35 rd" class="r35 r">value</span> = <a href="#6872575dbb1b0edf" class="i method">ReadSearchDocObject</a>(<b>ref</b> <span class="r30 r">reader</span>, <span class="r31 r">depth</span> - 1);
                            <span class="r34 r">list</span>.<a href="@1@netstandard/A.html#9cc11588bffd57c1" class="i method">Add</a>(<span class="r35 r">value</span>);
                        }
                        <b>return</b> <span class="r34 r">list</span>.<a href="@1@netstandard/A.html#d4409b7542728cec" class="i method">ToArray</a>();
                    <b>default</b>:
                        <b>throw</b> <b>new</b> <span class="t constructor">JsonException</span>();
                }
            }
 
            <b>static void</b> <a id="45d8fb436a063056" href="../R/45d8fb436a063056.html" target="n" data-glyph="76,2" class="i method">Expects</a>(<b>in</b> <span class="t t">Utf8JsonReader</span> <span id="r36 rd" class="r36 r">reader</span>, <span class="t t">JsonTokenType</span> <span id="r37 rd" class="r37 r">expected</span>)
            {
                <b>if</b> (<span class="r36 r">reader</span>.<span class="i property">TokenType</span> != <span class="r37 r">expected</span>)
                {
                    <b>throw</b> <b>new</b> <span class="t constructor">JsonException</span>(
                        <span class="s">$&quot;</span><span class="s">Expected </span>{<b>nameof</b>(<span class="t t">JsonTokenType</span>)}<span class="s"> </span><span class="s">&quot;</span> +
                        <span class="r37 r">expected</span>.<a href="@1@netstandard/A.html#1365cfeffd45409d" class="i method">ToString</a>() +
                        <span class="s">&quot;, not &quot;</span> +
                        <span class="r36 r">reader</span>.<span class="i property">TokenType</span>.<a href="@1@netstandard/A.html#1365cfeffd45409d" class="i method">ToString</a>());
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Serialize a SearchDocument as JSON.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r38 r">writer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">JSON writer.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r39 r">document</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The document.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Serialization options.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public static void</b> <a id="ffd41033cc85e457" href="../R/ffd41033cc85e457.html" target="n" data-glyph="72,1" class="i method">WriteSearchDocument</a>(
            <span class="t t">Utf8JsonWriter</span> <span id="r38 rd" class="r38 r">writer</span>,
            <a href="../P/5b8083eede53810d.html#5b8083eede53810d" class="t t">SearchDocument</a> <span id="r39 rd" class="r39 r">document</span>,
            <span class="t t">JsonSerializerOptions</span> <span id="r40 rd" class="r40 r">options</span>)
        {
            <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<span class="r38 r">writer</span> != <b>null</b>);
            <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<span class="r39 r">document</span> != <b>null</b>);
            <a href="@1@netstandard/A.html#632c6da37ce825df" class="t t">Debug</a>.<a href="@1@netstandard/A.html#74ae7c85c0e36e34" class="i method">Assert</a>(<span class="r40 r">options</span> != <b>null</b>);
 
            <span class="r38 r">writer</span>.<span class="i method">WriteStartObject</span>();
            <b>foreach</b> (<a href="@1@netstandard/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r41 rd" class="r41 r">key</span> <b>in</b> <span class="r39 r">document</span>.<a href="../SearchDocument/SearchDocument.Dictionary.cs.html#afc906704c4c33ed" class="i property">Keys</a>)
            {
                <span class="r38 r">writer</span>.<span class="i method">WritePropertyName</span>(<span class="r41 r">key</span>);
                <b>object</b> <span id="r42 rd" class="r42 r">value</span> = <span class="r39 r">document</span><a href="../SearchDocument/SearchDocument.Dictionary.cs.html#1c69d545858d669d">[</a><span class="r41 r">key</span>];
 
                <span class="c">// Write the value using JsonSerializer so all of our</span>
                <span class="c">// converters take effect</span>
                <span class="t t">JsonSerializer</span>.<span class="i method">Serialize</span>(
                    <span class="r38 r">writer</span>,
                    <span class="r42 r">value</span>,
                    <span class="r42 r">value</span>?.<a href="@1@netstandard/A.html#4d73eb225aef8a61" class="i method">GetType</a>() ?? <b>typeof</b>(<b>object</b>),
                    <span class="r40 r">options</span>);
            }
            <span class="r38 r">writer</span>.<span class="i method">WriteEndObject</span>();
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> <span class="i">CS1572</span> <span class="c">// Not all parameters will be used depending on feature flags</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deserialize a JSON stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">typeparam</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r43 r t">T</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The target type to deserialize the JSON stream into.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">typeparam</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r44 r">json</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A JSON stream.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r45 r">serializer</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Optional serializer that can be used to customize the serialization</span>
        <span class="c">///</span><span class="c"> of strongly typed models.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r46 r">async</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Whether to execute sync or async.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r47 r">cancellationToken</span><span class="c">&quot;</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Optional </span><span class="c">&lt;</span><span class="c">see</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a><span class="c">&quot;</span><span class="c">/&gt;</span><span class="c"> to propagate notifications</span>
        <span class="c">///</span><span class="c"> that the operation should be canceled.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A deserialized object.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public static async</b> <a href="@1@netstandard/A.html#5ca7b77f3df89fc6" class="t t">Task</a>&lt;<span class="r43 r t">T</span>&gt; <a id="3e305783c9e6dedb" href="../R/3e305783c9e6dedb.html" target="n" data-glyph="220,1" class="i method">DeserializeAsync</a>&lt;<span id="r43 rd t" class="r43 r t">T</span>&gt;(
            <b>this</b> <a href="@1@netstandard/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r44 rd" class="r44 r">json</span>,
            <a href="/Azure.Core/A.html#affd96d710597558" class="t t">ObjectSerializer</a> <span id="r45 rd" class="r45 r">serializer</span>,
            <b>bool</b> <span id="r46 rd" class="r46 r">async</span>,
            <a href="@1@netstandard/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r47 rd" class="r47 r">cancellationToken</span>)
        <span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> <span class="i">CS1572</span>
        {
            <b>if</b> (<span class="r44 r">json</span> <b>is null</b>)
            {
                <b>return</b> <b>default</b>;
            }
            <b>else</b> <b>if</b> (<span class="r45 r">serializer</span> != <b>null</b>)
            {
                <b>return</b> <span class="r46 r">async</span> ?
                    (<span class="r43 r t">T</span>)<b>await</b> <span class="r45 r">serializer</span>.<a href="/Azure.Core/A.html#588ab3df0cfd3fd8" class="i method">DeserializeAsync</a>(<span class="r44 r">json</span>, <b>typeof</b>(<span class="r43 r t">T</span>), <span class="r47 r">cancellationToken</span>).<span class="i method">ConfigureAwait</span>(<b>false</b>) :
                    (<span class="r43 r t">T</span>)<span class="r45 r">serializer</span>.<a href="/Azure.Core/A.html#17d81dc071898d96" class="i method">Deserialize</a>(<span class="r44 r">json</span>, <b>typeof</b>(<span class="r43 r t">T</span>), <span class="r47 r">cancellationToken</span>);
            }
            <b>else</b> <b>if</b> (<span class="r46 r">async</span>)
            {
                <b>return</b> <b>await</b> <span class="t t">JsonSerializer</span>.<span class="i method">DeserializeAsync</span>&lt;<span class="r43 r t">T</span>&gt;(
                    <span class="r44 r">json</span>,
                    <a href="#514dfe35bc742fe6" class="t t">JsonSerialization</a>.<a href="#ee91d1f5680f4af5" class="i property">SerializerOptions</a>,
                    <span class="r47 r">cancellationToken</span>)
                    .<span class="i method">ConfigureAwait</span>(<b>false</b>);
            }
            <b>else</b>
            {
                <span class="c">// Copy the stream into memory and then deserialize</span>
                <b>using</b> <a href="@1@netstandard/A.html#1a4dcb744a23ba6f" class="t t">MemoryStream</a> <span id="r48 rd" class="r48 r">memory</span> = <span class="r44 r">json</span>.<a href="../Utilities/SearchExtensions.cs.html#6f896c75781aeaaf" class="i method">CopyToMemoryStreamAsync</a>(<span class="r46 r">async</span>, <span class="r47 r">cancellationToken</span>).<a href="../Shared/TaskExtensions.cs.html#c5b047e3cbfab399" class="i method">EnsureCompleted</a>();
                <b>return</b> <span class="t t">JsonSerializer</span>.<span class="i method">Deserialize</span>&lt;<span class="r43 r t">T</span>&gt;(
                    <span class="r48 r">memory</span>.<a href="@1@netstandard/A.html#5df5fc757781f05e" class="i method">ToArray</a>(),
                    <a href="#514dfe35bc742fe6" class="t t">JsonSerialization</a>.<a href="#ee91d1f5680f4af5" class="i property">SerializerOptions</a>);
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
