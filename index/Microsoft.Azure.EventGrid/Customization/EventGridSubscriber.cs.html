<!DOCTYPE html>
<html><head><title>EventGridSubscriber.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(241);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.EventGrid/Customization/EventGridSubscriber.cs" target="_top">Customization\EventGridSubscriber.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.EventGrid" target="_top">src\Microsoft.Azure.EventGrid.csproj</a> (Microsoft.Azure.EventGrid)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for</span>
<span class="c">// license information.</span>
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventGrid</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">Serialization</span>;
<b>using</b> <span class="i">Newtonsoft</span>.<span class="i">Json</span>;
<b>using</b> <span class="i">Newtonsoft</span>.<span class="i">Json</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Concurrent</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventGrid</span>
{
    <b>public class</b> <a id="d9102f5142667b1a" href="../R/d9102f5142667b1a.html" target="n" data-glyph="0,0" class="t t">EventGridSubscriber</a> : <a href="IEventGridEventDeserializer.cs.html#229db1568e3efcd6" class="t t">IEventGridEventDeserializer</a>, <a href="ICustomEventTypeMapper.cs.html#7f80085b9f5ad0c2" class="t t">ICustomEventTypeMapper</a>
    {
        <b>static readonly</b> <span class="i">JsonSerializer</span> <a id="89776d557aceff4b" href="../R/89776d557aceff4b.html" target="n" data-glyph="46,1" class="i field">defaultJsonSerializer</a>;
        <b>readonly</b> <a href="@0@mscorlib/A.html#2e5ef5704344a309" class="t t">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>&gt; <a id="2220dead2223efa3" href="../R/2220dead2223efa3.html" target="n" data-glyph="46,1" class="i field">customEventTypeMapping</a>;
 
        <b>static</b> <a id="af5f477dad7f2bf0" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="t method">EventGridSubscriber</a>()
        {
            <a href="#89776d557aceff4b" class="i field">defaultJsonSerializer</a> = <a href="#de50c7cfafca9f86" class="i method">GetJsonSerializerWithPolymorphicSupport</a>();
        }
 
        <b>public</b> <a id="934a5417031ee06b" href="../R/934a5417031ee06b.html" target="n" data-glyph="72,1" class="t constructor">EventGridSubscriber</a>()
        {
            <a href="#2220dead2223efa3" class="i field">customEventTypeMapping</a> = <b>new</b> <a href="@0@mscorlib/A.html#6dabefc533af0715" class="t constructor">ConcurrentDictionary</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>&gt;(<a href="@0@mscorlib/A.html#a1c3d85bbf4ae20e" class="t t">StringComparer</a>.<a href="@0@mscorlib/A.html#59b9c33842417944" class="i property">OrdinalIgnoreCase</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deserializes the provided event data using a default JSON serializer that supports all system event types.</span>
        <span class="c">///</span><span class="c"> A webhook/function that is consuming events can call this function to deserialize EventGrid events.</span>
        <span class="c">///</span><span class="c"> For system events, the Data property of each event in the returned array will be set to the appropriate</span>
        <span class="c">///</span><span class="c"> type (e.g. StorageBlobCreatedEventData). For events on custom topics where the type of the Data property</span>
        <span class="c">///</span><span class="c"> can be of any type, the calling function will have to first add a custom event mapping before calling this function.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">requestContent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The JSON string containing an array of EventGrid events</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A list of EventGrid Events</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <a id="a5ee51f377fadff4" href="../R/a5ee51f377fadff4.html" target="n" data-glyph="72,1" class="i method">DeserializeEventGridEvents</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r0 rd" class="r0 r">requestContent</span>)
        {
            <b>return</b> <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#445c02f4f16e8b45" class="i method">DeserializeEventGridEvents</a>(<span class="r0 r">requestContent</span>, <a href="#89776d557aceff4b" class="i field">defaultJsonSerializer</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deserializes the provided event data using a custom JSON serializer.</span>
        <span class="c">///</span><span class="c"> A webhook/function that is consuming events can call this function to deserialize EventGrid events.</span>
        <span class="c">///</span><span class="c"> For system events, the Data property of each event in the returned array will be set to the appropriate</span>
        <span class="c">///</span><span class="c"> type (e.g. StorageBlobCreatedEventData). For events on custom topics where the type of the Data property</span>
        <span class="c">///</span><span class="c"> can be of any type, the calling function will have to first add a custom event mapping before calling this function.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">requestContent</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The JSON string containing an array of EventGrid events</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">jsonSerializer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">JsonSerializer to use for the deserialization.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A list of EventGrid Events</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <a id="445c02f4f16e8b45" href="../R/445c02f4f16e8b45.html" target="n" data-glyph="72,1" class="i method">DeserializeEventGridEvents</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r1 rd" class="r1 r">requestContent</span>, <span class="i">JsonSerializer</span> <span id="r2 rd" class="r2 r">jsonSerializer</span>)
        {
            <a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <span id="r3 rd" class="r3 r">eventGridEvents</span> = <span class="i">JsonConvert</span>.<span class="i">DeserializeObject</span>&lt;<a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[]&gt;(<span class="r1 r">requestContent</span>, <span class="r2 r">jsonSerializer</span>.<a href="JsonSerializerExtensions.cs.html#e50ffa7c5256d562" class="i method">GetJsonSerializerSettings</a>());
            <b>return</b> <a href="#63dbd69ca4fdd9b2" class="i method">DeserializeEventGridEventData</a>(<span class="r3 r">eventGridEvents</span>, <span class="r2 r">jsonSerializer</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deserializes the provided stream using a default JSON serializer that supports all system event types.</span>
        <span class="c">///</span><span class="c"> A webhook/function that is consuming events can call this function to deserialize EventGrid events.</span>
        <span class="c">///</span><span class="c"> For system events, the Data property of each event in the returned array will be set to the appropriate</span>
        <span class="c">///</span><span class="c"> type (e.g. StorageBlobCreatedEventData). For events on custom topics where the type of the Data property</span>
        <span class="c">///</span><span class="c"> can be of any type, the calling function will have to first add a custom event mapping before calling this function.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">requestStream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Request Stream</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A list of EventGrid Events</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <a id="f36e56e53644af86" href="../R/f36e56e53644af86.html" target="n" data-glyph="72,1" class="i method">DeserializeEventGridEvents</a>(<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r4 rd" class="r4 r">requestStream</span>)
        {
            <b>return</b> <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#5a725dcfdd24d5f2" class="i method">DeserializeEventGridEvents</a>(<span class="r4 r">requestStream</span>, <a href="#89776d557aceff4b" class="i field">defaultJsonSerializer</a>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Deserializes the provided stream using a custom JSON serializer.</span>
        <span class="c">///</span><span class="c"> A webhook/function that is consuming events can call this function to deserialize EventGrid events.</span>
        <span class="c">///</span><span class="c"> For system events, the Data property of each event in the returned array will be set to the appropriate</span>
        <span class="c">///</span><span class="c"> type (e.g. StorageBlobCreatedEventData). For events on custom topics where the type of the Data property</span>
        <span class="c">///</span><span class="c"> can be of any type, the calling function will have to first add a custom event mapping before calling this function.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">requestStream</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Request Stream</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">jsonSerializer</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">JsonSerializer to use for the deserialization.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">A list of EventGrid Events</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <a id="5a725dcfdd24d5f2" href="../R/5a725dcfdd24d5f2.html" target="n" data-glyph="72,1" class="i method">DeserializeEventGridEvents</a>(<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="t t">Stream</a> <span id="r5 rd" class="r5 r">requestStream</span>, <span class="i">JsonSerializer</span> <span id="r6 rd" class="r6 r">jsonSerializer</span>)
        {
            <a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <span id="r7 rd" class="r7 r">eventGridEvents</span> = <b>null</b>;
 
            <b>using</b> (<a href="@0@mscorlib/A.html#b5fe1efcec14de32" class="k">var</a> <span id="r8 rd" class="r8 r">streamReader</span> = <b>new</b> <a href="@0@mscorlib/A.html#72447927169f6b77" class="t constructor">StreamReader</a>(<span class="r5 r">requestStream</span>))
            {
                <b>using</b> (<b>var</b> <span id="r9 rd" class="r9 r">jsonTextReader</span> = <b>new</b> <span class="i">JsonTextReader</span>(<span class="r8 r">streamReader</span>))
                {
                    <span class="r7 r">eventGridEvents</span> = (<a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[])<span class="r6 r">jsonSerializer</span>.<span class="i">Deserialize</span>(<span class="r9 r">jsonTextReader</span>, <b>typeof</b>(<a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[]));
                }
            }
 
            <b>return</b> <a href="#63dbd69ca4fdd9b2" class="i method">DeserializeEventGridEventData</a>(<span class="r7 r">eventGridEvents</span>, <span class="r6 r">jsonSerializer</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Adds or updates a custom event mapping that associates an eventType string with the corresponding type of event data.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">eventType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The event type to register, such as &quot;Contoso.Items.ItemReceived&quot;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r11 r">eventDataType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The type of eventdata corresponding to this eventType, such as typeof(ContosoItemReceivedEventData)</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public void</b> <a id="9db417aa211df37a" href="../R/9db417aa211df37a.html" target="n" data-glyph="72,1" class="i method">AddOrUpdateCustomEventMapping</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r10 rd" class="r10 r">eventType</span>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r11 rd" class="r11 r">eventDataType</span>)
        {
            <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#2abd30301743facb" class="i method">ValidateEventType</a>(<span class="r10 r">eventType</span>);
 
            <b>if</b> (<span class="r11 r">eventDataType</span> == <b>null</b>)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r11 r">eventDataType</span>));
            }
 
            <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#2220dead2223efa3" class="i field">customEventTypeMapping</a>.<a href="@0@mscorlib/A.html#490ee025e9652769" class="i method">AddOrUpdate</a>(
                <span class="r10 r">eventType</span>,
                <span class="r11 r">eventDataType</span>,
                (<span id="r12 rd" class="r12 r">_</span>, <span id="r13 rd" class="r13 r">existingValue</span>) =&gt; <span class="r11 r">eventDataType</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets information about a custom event mapping.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">eventType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The registered event type, such as &quot;Contoso.Items.ItemReceived&quot;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">eventDataType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The type of eventdata corresponding to this eventType, such as typeof(ContosoItemReceivedEventData)</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the specified mapping exists.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="ea3523b7e65e6ec2" href="../R/ea3523b7e65e6ec2.html" target="n" data-glyph="72,1" class="i method">TryGetCustomEventMapping</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r14 rd" class="r14 r">eventType</span>, <b>out</b> <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r15 rd" class="r15 r">eventDataType</span>)
        {
            <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#2abd30301743facb" class="i method">ValidateEventType</a>(<span class="r14 r">eventType</span>);
 
            <b>return</b> <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#2220dead2223efa3" class="i field">customEventTypeMapping</a>.<a href="@0@mscorlib/A.html#4d0f4ac22dbeaf08" class="i method">TryGetValue</a>(<span class="r14 r">eventType</span>, <b>out</b> <span class="r15 r">eventDataType</span>);
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> List all registered custom event mappings.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">An IEnumerable of mappings</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public</b> <a href="@0@mscorlib/A.html#3acf01620172c7f0" class="t t">IEnumerable</a>&lt;<a href="@0@mscorlib/A.html#8585965bb176a426" class="t t">KeyValuePair</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>&gt;&gt; <a id="dee579f390d6fae1" href="../R/dee579f390d6fae1.html" target="n" data-glyph="72,1" class="i method">ListAllCustomEventMappings</a>()
        {
            <b>foreach</b> (<a href="@0@mscorlib/A.html#8585965bb176a426" class="t t">KeyValuePair</a>&lt;<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>, <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a>&gt; <span id="r16 rd" class="r16 r">kvp</span> <b>in</b> <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#2220dead2223efa3" class="i field">customEventTypeMapping</a>)
            {
                <b>yield</b> <b>return</b> <span class="r16 r">kvp</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Removes a custom event mapping.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r17 r">eventType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The registered event type, such as &quot;Contoso.Items.ItemReceived&quot;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">eventDataType</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The type of eventdata corresponding to this eventType, such as typeof(ContosoItemReceivedEventData)</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">True if the specified mapping was removed successfully.</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public bool</b> <a id="163df7136bebbe0d" href="../R/163df7136bebbe0d.html" target="n" data-glyph="72,1" class="i method">TryRemoveCustomEventMapping</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r17 rd" class="r17 r">eventType</span>, <b>out</b> <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r18 rd" class="r18 r">eventDataType</span>)
        {
            <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#2abd30301743facb" class="i method">ValidateEventType</a>(<span class="r17 r">eventType</span>);
            <b>return</b> <a href="#d9102f5142667b1a" class="k">this</a>.<a href="#2220dead2223efa3" class="i field">customEventTypeMapping</a>.<a href="@0@mscorlib/A.html#19ffd03eb6d3bdff" class="i method">TryRemove</a>(<span class="r17 r">eventType</span>, <b>out</b> <span class="r18 r">eventDataType</span>);
        }
 
        <b>void</b> <a id="2abd30301743facb" href="../R/2abd30301743facb.html" target="n" data-glyph="76,1" class="i method">ValidateEventType</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r19 rd" class="r19 r">eventType</span>)
        {
            <b>if</b> (<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r19 r">eventType</span>))
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r19 r">eventType</span>));
            }
        }
 
        <a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <a id="63dbd69ca4fdd9b2" href="../R/63dbd69ca4fdd9b2.html" target="n" data-glyph="76,1" class="i method">DeserializeEventGridEventData</a>(<a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a>[] <span id="r20 rd" class="r20 r">eventGridEvents</span>, <span class="i">JsonSerializer</span> <span id="r21 rd" class="r21 r">jsonSerializer</span>)
        {
            <b>foreach</b> (<a href="../Generated/Models/EventGridEvent.cs.html#3276ab199e0c47ed" class="t t">EventGridEvent</a> <span id="r22 rd" class="r22 r">receivedEvent</span> <b>in</b> <span class="r20 r">eventGridEvents</span>)
            {
                <a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r23 rd" class="r23 r">typeOfEventData</span> = <b>null</b>;
 
                <span class="c">// First, let&#39;s attempt to find the mapping for the event type in the system event type mapping.</span>
                <span class="c">// Note that system event data would always be of type JObject.</span>
                <b>if</b> (<a href="SystemEventTypeMappings.cs.html#7f65a6a999a1612c" class="t t">SystemEventTypeMappings</a>.<a href="SystemEventTypeMappings.cs.html#a5858aa8c0bb0ace" class="i field">SystemEventMappings</a>.<a href="@0@mscorlib/A.html#43db2f978cfd884d" class="i method">TryGetValue</a>(<span class="r22 r">receivedEvent</span>.<a href="../Generated/Models/EventGridEvent.cs.html#236cb4c77110adda" class="i property">EventType</a>, <b>out</b> <span class="r23 r">typeOfEventData</span>))
                {
                    <span class="i">JObject</span> <span id="r24 rd" class="r24 r">dataObject</span> = <span class="r22 r">receivedEvent</span>.<a href="../Generated/Models/EventGridEvent.cs.html#b4d0ab5f0db614d2" class="i property">Data</a> <b>as</b> <span class="i">JObject</span>;
                    <b>if</b> (<span class="r24 r">dataObject</span> != <b>null</b>)
                    {
                        <b>var</b> <span id="r25 rd" class="r25 r">eventData</span> = <span class="r24 r">dataObject</span>.<span class="i">ToObject</span>(<span class="r23 r">typeOfEventData</span>, <span class="r21 r">jsonSerializer</span>);
                        <span class="r22 r">receivedEvent</span>.<a href="../Generated/Models/EventGridEvent.cs.html#b4d0ab5f0db614d2" class="i property">Data</a> = <span class="r25 r">eventData</span>;
                    }
                }
                <span class="c">// If not a system event, let&#39;s attempt to find the mapping for the event type in the custom event mapping.</span>
                <b>else</b> <b>if</b> (<a href="#d9102f5142667b1a" class="k">this</a>.<a href="#ea3523b7e65e6ec2" class="i method">TryGetCustomEventMapping</a>(<span class="r22 r">receivedEvent</span>.<a href="../Generated/Models/EventGridEvent.cs.html#236cb4c77110adda" class="i property">EventType</a>, <b>out</b> <span class="r23 r">typeOfEventData</span>))
                {
                    <span class="i">JToken</span> <span id="r26 rd" class="r26 r">dataToken</span> = <span class="r22 r">receivedEvent</span>.<a href="../Generated/Models/EventGridEvent.cs.html#b4d0ab5f0db614d2" class="i property">Data</a> <b>as</b> <span class="i">JToken</span>;
                    <b>if</b> (<span class="r26 r">dataToken</span> == <b>null</b>)
                    {
                        <span class="c">// Nothing to do (e.g. this will happen if Data is a primitive/string type).</span>
                        <b>continue</b>;
                    }
 
                    <b>switch</b> (<span class="r26 r">dataToken</span>.<span class="i">Type</span>)
                    {
                        <b>case</b> <span class="i">JTokenType</span>.<span class="i">Object</span>:
                            <b>var</b> <span id="r27 rd" class="r27 r">eventData</span> = <span class="r26 r">dataToken</span>.<span class="i">ToObject</span>(<span class="r23 r">typeOfEventData</span>, <span class="r21 r">jsonSerializer</span>);
                            <span class="r22 r">receivedEvent</span>.<a href="../Generated/Models/EventGridEvent.cs.html#b4d0ab5f0db614d2" class="i property">Data</a> = <span class="r27 r">eventData</span>;
                            <b>break</b>;
                        <b>case</b> <span class="i">JTokenType</span>.<span class="i">Array</span>:
                            <b>var</b> <span id="r28 rd" class="r28 r">arrayEventData</span> = <span class="i">JsonConvert</span>.<span class="i">DeserializeObject</span>(
                                <span class="r26 r">dataToken</span>.<span class="i">ToString</span>(),
                                <span class="r23 r">typeOfEventData</span>,
                                <span class="r21 r">jsonSerializer</span>.<a href="JsonSerializerExtensions.cs.html#e50ffa7c5256d562" class="i method">GetJsonSerializerSettings</a>());
                            <span class="r22 r">receivedEvent</span>.<a href="../Generated/Models/EventGridEvent.cs.html#b4d0ab5f0db614d2" class="i property">Data</a> = <span class="r28 r">arrayEventData</span>;
                            <b>break</b>;
                        <b>default</b>:
                            <b>break</b>;
                    }
                }
            }
 
            <b>return</b> <span class="r20 r">eventGridEvents</span>;
        }
 
        <b>static</b> <span class="i">JsonSerializer</span> <a id="de50c7cfafca9f86" href="../R/de50c7cfafca9f86.html" target="n" data-glyph="76,1" class="i method">GetJsonSerializerWithPolymorphicSupport</a>()
        {
            <span class="i">JsonSerializerSettings</span> <span id="r29 rd" class="r29 r">deserializationSettings</span> = <b>new</b> <span class="i">JsonSerializerSettings</span>
            {
                <span class="i">DateFormatHandling</span> = <span class="i">DateFormatHandling</span>.<span class="i">IsoDateFormat</span>,
                <span class="i">DateTimeZoneHandling</span> = <span class="i">DateTimeZoneHandling</span>.<span class="i">Utc</span>,
                <span class="i">NullValueHandling</span> = <span class="i">NullValueHandling</span>.<span class="i">Ignore</span>,
                <span class="i">ReferenceLoopHandling</span> = <span class="i">ReferenceLoopHandling</span>.<span class="i">Serialize</span>,
                <span class="i">Converters</span> = <b>new</b> <a href="@0@mscorlib/A.html#9e5352b2b304ceba" class="t constructor">List</a>&lt;<span class="i">JsonConverter</span>&gt;
                {
                    <b>new</b> <span class="i">Iso8601TimeSpanConverter</span>()
                }
            };
 
            <span class="i">JsonSerializer</span> <span id="r30 rd" class="r30 r">jsonSerializer</span> = <span class="i">JsonSerializer</span>.<span class="i">Create</span>(<span class="r29 r">deserializationSettings</span>);
 
            <span class="c">// Note: If any of the events have polymorphic data, add converters for them here.</span>
            <span class="c">// This enables the polymorphic deserialization for the event data.</span>
            <span class="c">// For example, MediaJobCompletedEventData&#39;s MediaJobOutput type is polymorphic </span>
            <span class="c">// based on the @odata.type property in the data.</span>
 
            <span class="r30 r">jsonSerializer</span>.<span class="i">Converters</span>.<span class="i">Add</span>(<b>new</b> <span class="i">PolymorphicDeserializeJsonConverter</span>&lt;<a href="../Generated/Models/MediaJobOutput.cs.html#aaea4c0662d9ce56" class="t t">MediaJobOutput</a>&gt;(<span class="s">&quot;@odata.type&quot;</span>));
 
            <b>return</b> <span class="r30 r">jsonSerializer</span>;
        }
    }
}
</pre></td></tr></table></div></body></html>
