<!DOCTYPE html>
<html><head><title>EventHubMocks.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(341);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.EventHubs.ServiceFabricProcessor/EventHubMocks.cs" target="_top">EventHubMocks.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.EventHubs.ServiceFabricProcessor" target="_top">..\..\Microsoft.Azure.EventHubs.ServiceFabricProcessor\src\Microsoft.Azure.EventHubs.ServiceFabricProcessor.csproj</a> (Microsoft.Azure.EventHubs.ServiceFabricProcessor)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft. All rights reserved.</span>
<span class="c">// Licensed under the MIT license. See LICENSE file in the project root for full license information.using System;</span>
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">EventHubs</span>.<span class="i n">ServiceFabricProcessor</span>
{
    <b>using</b> <span class="i">System</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Reflection</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Threading</span>;
    <b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
 
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Mocks for the underlying event hub client. Using these instead of the regular wrappers allows unit testing without an event hub.</span>
    <span class="c">///</span><span class="c"> By default, EventProcessorService.EventHubClientFactory is a EventHubWrappers.EventHubClientFactory.</span>
    <span class="c">///</span><span class="c"> To use the mocks, change it to a EventHubMocks.EventHubClientFactoryMock.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>public class</b> <a id="068222643ab19252" href="R/068222643ab19252.html" target="n" data-glyph="0,0" class="t t"><span id="6bf3716c388906ae">EventHubMocks</span></a>
    {
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Mock of an Event Hub partition receiver.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public class</b> <a id="f827dfbccb27b77f" href="R/f827dfbccb27b77f.html" target="n" data-glyph="0,1" class="t t">PartitionReceiverMock</a> : <a href="EventHubWrappers.cs.html#2e0454f5c1ce0b4a" class="t t">EventHubWrappers</a>.<a href="EventHubWrappers.cs.html#b39dbb17ea3e02bb" class="t t">IPartitionReceiver</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public static</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#f827dfbccb27b77f" class="t t">PartitionReceiverMock</a>&gt; <a id="0df8d92dd01baaed" href="R/0df8d92dd01baaed.html" target="n" data-glyph="42,2" class="i field">receivers</a> = <b>new</b> <span class="i">Dictionary</span>&lt;<b>string</b>, <a href="#f827dfbccb27b77f" class="t t">PartitionReceiverMock</a>&gt;();
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected readonly string</b> <a id="6a2096684ca09438" href="R/6a2096684ca09438.html" target="n" data-glyph="45,2" class="i field">partitionId</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected long</b> <a id="9bd9c8b2fc202e85" href="R/9bd9c8b2fc202e85.html" target="n" data-glyph="45,2" class="i field">sequenceNumber</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected volatile</b> <a href="/Microsoft.Azure.EventHubs/A.html#4376c1c4658c32ac" class="t t">IPartitionReceiveHandler</a> <a id="1bfc4a78cbc9c0d1" href="R/1bfc4a78cbc9c0d1.html" target="n" data-glyph="45,2" class="i field">outerHandler</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected int</b> <a id="00e1fe281f600d6d" href="R/00e1fe281f600d6d.html" target="n" data-glyph="45,2" class="i field">handlerBatchSize</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public int</b> <a id="a89a9d65810859c7" href="R/a89a9d65810859c7.html" target="n" data-glyph="102,2" class="i property">HandlerBatchSize</a> { <b>get</b> =&gt; <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#00e1fe281f600d6d" class="i field">handlerBatchSize</a>; }
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected bool</b> <a id="58ff27de749cd3aa" href="R/58ff27de749cd3aa.html" target="n" data-glyph="45,2" class="i field">invokeWhenNoEvents</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected</b> <span class="i">TimeSpan</span> <a id="1c51d66c74ba4eb5" href="R/1c51d66c74ba4eb5.html" target="n" data-glyph="45,2" class="i field">pumpTimeout</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <span class="i">TimeSpan</span> <a id="21ccc6f5a9674a47" href="R/21ccc6f5a9674a47.html" target="n" data-glyph="102,2" class="i property">ReceiveTimeout</a> { <b>get</b> =&gt; <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1c51d66c74ba4eb5" class="i field">pumpTimeout</a>;  }
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Not meaningful in this mock but exposed so that tests can verify.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public</b> <a href="/Microsoft.Azure.EventHubs/A.html#f0c29f0f48ec0eaa" class="t t">ReceiverOptions</a> <a id="0e3bcf2ab51fd44b" href="R/0e3bcf2ab51fd44b.html" target="n" data-glyph="102,2" class="i property">Options</a> { <b>get</b>; <b>private set</b>; }
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected readonly</b> <span class="i">CancellationToken</span> <a id="0d231bd1e28995ca" href="R/0d231bd1e28995ca.html" target="n" data-glyph="45,2" class="i field">token</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Construct the partition receiver mock.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">sequenceNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">token</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">pumpTimeout</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">options</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">tag</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>public</b> <a id="7378c9637d87374c" href="R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">PartitionReceiverMock</a>(<b>string</b> <span id="r0 rd" class="r0 r">partitionId</span>, <b>long</b> <span id="r1 rd" class="r1 r">sequenceNumber</span>, <span class="i">CancellationToken</span> <span id="r2 rd" class="r2 r">token</span>, <span class="i">TimeSpan</span> <span id="r3 rd" class="r3 r">pumpTimeout</span>,
                <a href="/Microsoft.Azure.EventHubs/A.html#f0c29f0f48ec0eaa" class="t t">ReceiverOptions</a> <span id="r4 rd" class="r4 r">options</span>, <b>string</b> <span id="r5 rd" class="r5 r">tag</span>)
            {
                <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#6a2096684ca09438" class="i field">partitionId</a> = <span class="r0 r">partitionId</span>;
                <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#9bd9c8b2fc202e85" class="i field">sequenceNumber</a> = <span class="r1 r">sequenceNumber</span>;
                <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#0d231bd1e28995ca" class="i field">token</a> = <span class="r2 r">token</span>;
                <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1c51d66c74ba4eb5" class="i field">pumpTimeout</a> = <span class="r3 r">pumpTimeout</span>;
                <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#0e3bcf2ab51fd44b" class="i property">Options</a> = <span class="r4 r">options</span>;
 
                <b>if</b> (<span class="r5 r">tag</span> != <b>null</b>)
                {
                    <a href="#f827dfbccb27b77f" class="t t">PartitionReceiverMock</a>.<a href="#0df8d92dd01baaed" class="i field">receivers</a>[<span class="r5 r">tag</span>] = <a href="#f827dfbccb27b77f" class="k">this</a>;
                }
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Not meaningful in this mock but exposed so that tests can verify.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>public int</b> <a id="d97d1ce04181964f" href="R/d97d1ce04181964f.html" target="n" data-glyph="102,2" class="i property">PrefetchCount</a> { <b>get</b>; <b>set</b>; }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Receive mock events.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">maxEventCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">waitTime</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>public virtual</b> <span class="i">Task</span>&lt;<span class="i">IEnumerable</span>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt;&gt; <a id="7908a4d494ca6a85" href="R/7908a4d494ca6a85.html" target="n" data-glyph="72,2" class="i method">ReceiveAsync</a>(<b>int</b> <span id="r6 rd" class="r6 r">maxEventCount</span>, <span class="i">TimeSpan</span> <span id="r7 rd" class="r7 r">waitTime</span>)
            {
                <span class="i">List</span>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r8 rd" class="r8 r">events</span> = <b>null</b>;
                <span class="r8 r">events</span> = <b>new</b> <span class="i">List</span>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt;();
                <b>long</b> <span id="r9 rd" class="r9 r">lastSeq</span> = <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#9bd9c8b2fc202e85" class="i field">sequenceNumber</a> + <span class="r6 r">maxEventCount</span>;
                <b>for</b> (<b>int</b> <span id="r10 rd" class="r10 r">i</span> = 0; <span class="r10 r">i</span> &lt; <span class="r6 r">maxEventCount</span>; <span class="r10 r">i</span>++)
                {
                    <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#9bd9c8b2fc202e85" class="i field">sequenceNumber</a>++;
                    <b>byte</b>[] <span id="r11 rd" class="r11 r">body</span> = <b>new</b> <b>byte</b>[] { 0x4D, 0x4F, 0x43, 0x4B, 0x42, 0x4F, 0x44, 0x59 }; <span class="c">// M O C K B O D Y</span>
                    <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a> <span id="r12 rd" class="r12 r">e</span> = <b>new</b> <span class="t">EventData</span>(<span class="r11 r">body</span>);
                    <span class="i">PropertyInfo</span> <span id="r13 rd" class="r13 r">propertyInfo</span> = <span class="r12 r">e</span>.<span class="i">GetType</span>().<span class="i">GetProperty</span>(<span class="s">&quot;LastSequenceNumber&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>);
                    <span class="r13 r">propertyInfo</span>.<span class="i">SetValue</span>(<span class="r12 r">e</span>, <span class="r9 r">lastSeq</span>);
                    <span class="r12 r">e</span>.<span class="i">SystemProperties</span> = <b>new</b> <a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>.<span class="t">SystemPropertiesCollection</span>(<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#9bd9c8b2fc202e85" class="i field">sequenceNumber</a>, <span class="i">DateTime</span>.<span class="i">UtcNow</span>, (<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#9bd9c8b2fc202e85" class="i field">sequenceNumber</a> * 100).<span class="i">ToString</span>(), <span class="s">&quot;&quot;</span>);
                    <span class="r12 r">e</span>.<a href="/Microsoft.Azure.EventHubs/A.html#dbe01777e489c0a5" class="i property">Properties</a>.<span class="i">Add</span>(<span class="s">&quot;userkey&quot;</span>, <span class="s">&quot;uservalue&quot;</span>);
                    <span class="r8 r">events</span>.<span class="i">Add</span>(<span class="r12 r">e</span>);
                }
                <span class="i">Thread</span>.<span class="i">Sleep</span>(50);
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">$&quot;</span><span class="s">MOCK ReceiveAsync returning </span>{<span class="r6 r">maxEventCount</span>}<span class="s"> events for partition </span>{<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#6a2096684ca09438" class="i field">partitionId</a>}<span class="s"> ending at </span>{<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#9bd9c8b2fc202e85" class="i field">sequenceNumber</a>}<span class="s">&quot;</span>);
                <b>return</b> <span class="i">Task</span>.<span class="i">FromResult</span>&lt;<span class="i">IEnumerable</span>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt;&gt;(<span class="r8 r">events</span>);
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Set a mock receive handler.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r14 r">receiveHandler</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r15 r">invokeWhenNoEvents</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>public virtual void</b> <a id="069e2c845cc33f30" href="R/069e2c845cc33f30.html" target="n" data-glyph="72,2" class="i method">SetReceiveHandler</a>(<a href="/Microsoft.Azure.EventHubs/A.html#4376c1c4658c32ac" class="t t">IPartitionReceiveHandler</a> <span id="r14 rd" class="r14 r">receiveHandler</span>, <b>bool</b> <span id="r15 rd" class="r15 r">invokeWhenNoEvents</span> = <b>false</b>)
            {
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK IPartitionReceiver.SetReceiveHandler&quot;</span>);
                <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1bfc4a78cbc9c0d1" class="i field">outerHandler</a> = <span class="r14 r">receiveHandler</span>;
                <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#58ff27de749cd3aa" class="i field">invokeWhenNoEvents</a> = <span class="r15 r">invokeWhenNoEvents</span>;
                <b>if</b> (<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1bfc4a78cbc9c0d1" class="i field">outerHandler</a> != <b>null</b>)
                {
                    <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#00e1fe281f600d6d" class="i field">handlerBatchSize</a> = <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1bfc4a78cbc9c0d1" class="i field">outerHandler</a>.<a href="/Microsoft.Azure.EventHubs/A.html#a7f7ea993bc3c454" class="i property">MaxBatchSize</a>;
                    <span class="i">Task</span>.<span class="i">Run</span>(() =&gt; <a href="#384126e8321f2328" class="i method">PumpLoop</a>());
                }
                <b>else</b>
                {
                    <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK IPartitionReceiver.SetReceiveHandler with NULL handler&quot;</span>);
                }
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Close the mock receiver.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>public virtual</b> <span class="i">Task</span> <a id="a5a17896dddea0d8" href="R/a5a17896dddea0d8.html" target="n" data-glyph="72,2" class="i method">CloseAsync</a>()
            {
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK IPartitionReceiver.CloseAsync&quot;</span>);
                <b>return</b> <span class="i">Task</span>.<span class="i">CompletedTask</span>;
            }
 
            <b>private async void</b> <a id="384126e8321f2328" href="R/384126e8321f2328.html" target="n" data-glyph="76,2" class="i method">PumpLoop</a>()
            {
                <b>while</b> ((!<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#0d231bd1e28995ca" class="i field">token</a>.<span class="i">IsCancellationRequested</span>) &amp;&amp; (<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1bfc4a78cbc9c0d1" class="i field">outerHandler</a> != <b>null</b>))
                {
                    <span class="c">// TODO random batch sizes</span>
                    <span class="i">IEnumerable</span>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#f56ed6e805f7061b" class="t t">EventData</a>&gt; <span id="r16 rd" class="r16 r">events</span> = <a href="#7908a4d494ca6a85" class="i method">ReceiveAsync</a>(<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#00e1fe281f600d6d" class="i field">handlerBatchSize</a>, <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1c51d66c74ba4eb5" class="i field">pumpTimeout</a>).<span class="i">Result</span>;
                    <a href="/Microsoft.Azure.EventHubs/A.html#4376c1c4658c32ac" class="t t">IPartitionReceiveHandler</a> <span id="r17 rd" class="r17 r">capturedHandler</span> = <a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#1bfc4a78cbc9c0d1" class="i field">outerHandler</a>;
                    <b>if</b> (<span class="r17 r">capturedHandler</span> != <b>null</b>)
                    {
                        <b>if</b> (<span class="r16 r">events</span> != <b>null</b>)
                        {
                            <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK Sending messages to handler&quot;</span>);
                            <b>await</b> <span class="r17 r">capturedHandler</span>.<span class="i">ProcessEventsAsync</span>(<span class="r16 r">events</span>).<span class="i">ConfigureAwait</span>(<b>false</b>);
                        }
                        <b>else</b> <b>if</b> (<a href="#f827dfbccb27b77f" class="k">this</a>.<a href="#58ff27de749cd3aa" class="i field">invokeWhenNoEvents</a>)
                        {
                            <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK Sending empty batch to handler&quot;</span>);
                            <b>await</b> <span class="r17 r">capturedHandler</span>.<span class="i">ProcessEventsAsync</span>(<span class="r16 r">events</span>);
                        }
                        <b>else</b>
                        {
                            <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK Suppressing empty batch&quot;</span>);
                        }
                    }
                    <b>else</b>
                    {
                        <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK Handler has been detached&quot;</span>);
                    }
                }
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK Message generation ending&quot;</span>);
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Mock of EventHubClient class.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public class</b> <a id="93847d1406d80020" href="R/93847d1406d80020.html" target="n" data-glyph="0,1" class="t t">EventHubClientMock</a> : <a href="EventHubWrappers.cs.html#2e0454f5c1ce0b4a" class="t t">EventHubWrappers</a>.<a href="EventHubWrappers.cs.html#8d8b643cdc1ffa6f" class="t t">IEventHubClient</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected readonly int</b> <a id="dfcac45b2c6d5837" href="R/dfcac45b2c6d5837.html" target="n" data-glyph="45,2" class="i field">partitionCount</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected readonly</b> <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="t t">EventHubsConnectionStringBuilder</a> <a id="7c2f416df368c7ef" href="R/7c2f416df368c7ef.html" target="n" data-glyph="45,2" class="i field">csb</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected readonly string</b> <a id="1a4a0820f7a0c7b7" href="R/1a4a0820f7a0c7b7.html" target="n" data-glyph="45,2" class="i field">tag</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected</b> <span class="i">CancellationToken</span> <a id="2f0b6dc0f50d41ce" href="R/2f0b6dc0f50d41ce.html" target="n" data-glyph="45,2" class="i field">token</a> = <b>new</b> <span class="i">CancellationToken</span>();
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Construct the mock.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r18 r">partitionCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r19 r">csb</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r20 r">tag</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>public</b> <a id="2441acec727b155e" href="R/2441acec727b155e.html" target="n" data-glyph="72,2" class="t constructor">EventHubClientMock</a>(<b>int</b> <span id="r18 rd" class="r18 r">partitionCount</span>, <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="t t">EventHubsConnectionStringBuilder</a> <span id="r19 rd" class="r19 r">csb</span>, <b>string</b> <span id="r20 rd" class="r20 r">tag</span>)
            {
                <a href="#93847d1406d80020" class="k">this</a>.<a href="#dfcac45b2c6d5837" class="i field">partitionCount</a> = <span class="r18 r">partitionCount</span>;
                <a href="#93847d1406d80020" class="k">this</a>.<a href="#7c2f416df368c7ef" class="i field">csb</a> = <span class="r19 r">csb</span>;
                <a href="#93847d1406d80020" class="k">this</a>.<a href="#1a4a0820f7a0c7b7" class="i field">tag</a> = <span class="r20 r">tag</span>;
            }
 
            <b>internal void</b> <a id="1ca097d807347ae6" href="R/../../0000000000.html" target="n" data-glyph="74,2" class="i method">SetCancellationToken</a>(<span class="i">CancellationToken</span> <span id="r21 rd" class="r21 r">t</span>)
            {
                <a href="#93847d1406d80020" class="k">this</a>.<a href="#2f0b6dc0f50d41ce" class="i field">token</a> = <span class="r21 r">t</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Get runtime info of the fake event hub.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>public virtual</b> <span class="i">Task</span>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#46003615b8a69ab0" class="t t">EventHubRuntimeInformation</a>&gt; <a id="3f0d727566ebe60a" href="R/3f0d727566ebe60a.html" target="n" data-glyph="72,2" class="i method">GetRuntimeInformationAsync</a>()
            {
                <a href="/Microsoft.Azure.EventHubs/A.html#46003615b8a69ab0" class="t t">EventHubRuntimeInformation</a> <span id="r22 rd" class="r22 r">ehri</span> = <b>new</b> <span class="t">EventHubRuntimeInformation</span>();
                <span class="r22 r">ehri</span>.<a href="/Microsoft.Azure.EventHubs/A.html#df527c1931264461" class="i property">PartitionCount</a> = <a href="#93847d1406d80020" class="k">this</a>.<a href="#dfcac45b2c6d5837" class="i field">partitionCount</a>;
                <span class="r22 r">ehri</span>.<a href="/Microsoft.Azure.EventHubs/A.html#6f7d55289e44ee46" class="i property">PartitionIds</a> = <b>new</b> <b>string</b>[<a href="#93847d1406d80020" class="k">this</a>.<a href="#dfcac45b2c6d5837" class="i field">partitionCount</a>];
                <b>for</b> (<b>int</b> <span id="r23 rd" class="r23 r">i</span> = 0; <span class="r23 r">i</span> &lt; <a href="#93847d1406d80020" class="k">this</a>.<a href="#dfcac45b2c6d5837" class="i field">partitionCount</a>; <span class="r23 r">i</span>++)
                {
                    <span class="r22 r">ehri</span>.<a href="/Microsoft.Azure.EventHubs/A.html#6f7d55289e44ee46" class="i property">PartitionIds</a>[<span class="r23 r">i</span>] = <span class="r23 r">i</span>.<span class="i">ToString</span>();
                }
                <span class="r22 r">ehri</span>.<a href="/Microsoft.Azure.EventHubs/A.html#007ead59066395ef" class="i property">Path</a> = <a href="#93847d1406d80020" class="k">this</a>.<a href="#7c2f416df368c7ef" class="i field">csb</a>.<a href="/Microsoft.Azure.EventHubs/A.html#07eaa0ed4c59a2a0" class="i property">EntityPath</a>;
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">$&quot;</span><span class="s">MOCK GetRuntimeInformationAsync for </span>{<span class="r22 r">ehri</span>.<a href="/Microsoft.Azure.EventHubs/A.html#007ead59066395ef" class="i property">Path</a>}<span class="s">&quot;</span>);
                <b>return</b> <span class="i">Task</span>.<span class="i">FromResult</span>&lt;<a href="/Microsoft.Azure.EventHubs/A.html#46003615b8a69ab0" class="t t">EventHubRuntimeInformation</a>&gt;(<span class="r22 r">ehri</span>);
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Create a mock receiver on the fake event hub.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r24 r">consumerGroupName</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r25 r">partitionId</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r26 r">eventPosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r27 r">epoch</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r28 r">receiverOptions</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>public virtual</b> <a href="EventHubWrappers.cs.html#2e0454f5c1ce0b4a" class="t t">EventHubWrappers</a>.<a href="EventHubWrappers.cs.html#b39dbb17ea3e02bb" class="t t">IPartitionReceiver</a> <a id="fd811f0045d22eba" href="R/fd811f0045d22eba.html" target="n" data-glyph="72,2" class="i method">CreateEpochReceiver</a>(<b>string</b> <span id="r24 rd" class="r24 r">consumerGroupName</span>, <b>string</b> <span id="r25 rd" class="r25 r">partitionId</span>, <a href="/Microsoft.Azure.EventHubs/A.html#5c55f1ce5bfdf68d" class="t t">EventPosition</a> <span id="r26 rd" class="r26 r">eventPosition</span>, <b>long</b> <span id="r27 rd" class="r27 r">epoch</span>, <a href="/Microsoft.Azure.EventHubs/A.html#f0c29f0f48ec0eaa" class="t t">ReceiverOptions</a> <span id="r28 rd" class="r28 r">receiverOptions</span>)
            {
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">$&quot;</span><span class="s">MOCK CreateEpochReceiver(CG </span>{<span class="r24 r">consumerGroupName</span>}<span class="s">, part </span>{<span class="r25 r">partitionId</span>}<span class="s">, epoch </span>{<span class="r27 r">epoch</span>}<span class="s">)</span><span class="s">&quot;</span>);
                <span class="c">// TODO implement epoch semantics</span>
                <b>long</b> <span id="r29 rd" class="r29 r">startSeq</span> = <a href="#09d43de48480f614" class="i method">CalculateStartSeq</a>(<span class="r26 r">eventPosition</span>);
                <b>return</b> <b>new</b> <span class="t">PartitionReceiverMock</span>(<span class="r25 r">partitionId</span>, <span class="r29 r">startSeq</span>, <a href="#93847d1406d80020" class="k">this</a>.<a href="#2f0b6dc0f50d41ce" class="i field">token</a>, <a href="#93847d1406d80020" class="k">this</a>.<a href="#7c2f416df368c7ef" class="i field">csb</a>.<a href="/Microsoft.Azure.EventHubs/A.html#9bdfa559ce29adc5" class="i property">OperationTimeout</a>, <span class="r28 r">receiverOptions</span>, <a href="#93847d1406d80020" class="k">this</a>.<a href="#1a4a0820f7a0c7b7" class="i field">tag</a>);
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r30 r">eventPosition</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>protected long</b> <a id="09d43de48480f614" href="R/09d43de48480f614.html" target="n" data-glyph="75,2" class="i method">CalculateStartSeq</a>(<a href="/Microsoft.Azure.EventHubs/A.html#5c55f1ce5bfdf68d" class="t t">EventPosition</a> <span id="r30 rd" class="r30 r">eventPosition</span>)
            {
                <b>long</b> <span id="r31 rd" class="r31 r">startSeq</span> = 0L;
                <b>if</b> (<span class="r30 r">eventPosition</span>.<a href="/Microsoft.Azure.EventHubs/A.html#cb766c6ae4d91738" class="i property">SequenceNumber</a>.<span class="i">HasValue</span>)
                {
                    <span class="r31 r">startSeq</span> = <span class="r30 r">eventPosition</span>.<a href="/Microsoft.Azure.EventHubs/A.html#cb766c6ae4d91738" class="i property">SequenceNumber</a>.<span class="i">Value</span>;
                }
                <b>else</b>
                {
                    <span class="i">PropertyInfo</span> <span id="r32 rd" class="r32 r">propertyInfo</span> = <span class="r30 r">eventPosition</span>.<span class="i">GetType</span>().<span class="i">GetProperty</span>(<span class="s">&quot;Offset&quot;</span>, <span class="i">BindingFlags</span>.<span class="i">NonPublic</span> | <span class="i">BindingFlags</span>.<span class="i">Instance</span>);
                    <b>string</b> <span id="r33 rd" class="r33 r">offset</span> = (<b>string</b>)<span class="r32 r">propertyInfo</span>.<span class="i">GetValue</span>(<span class="r30 r">eventPosition</span>);
                    <b>if</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r33 r">offset</span>))
                    {
                        <span class="r31 r">startSeq</span> = (<b>long</b>.<span class="i">Parse</span>(<span class="r33 r">offset</span>) / 100L);
                    }
                }
                <b>return</b> <span class="r31 r">startSeq</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Close the mock EventHubClient.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>public virtual</b> <span class="i">Task</span> <a id="31a53a714e0003a6" href="R/31a53a714e0003a6.html" target="n" data-glyph="72,2" class="i method">CloseAsync</a>()
            {
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">&quot;MOCK IEventHubClient.CloseAsync&quot;</span>);
                <b>return</b> <span class="i">Task</span>.<span class="i">CompletedTask</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> An EventHubClient factory which dispenses mocks.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>public class</b> <a id="978a061bb42dd888" href="R/978a061bb42dd888.html" target="n" data-glyph="0,1" class="t t">EventHubClientFactoryMock</a> : <a href="EventHubWrappers.cs.html#2e0454f5c1ce0b4a" class="t t">EventHubWrappers</a>.<a href="EventHubWrappers.cs.html#b5f7fbda947a9219" class="t t">IEventHubClientFactory</a>
        {
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected readonly int</b> <a id="3836a999cf64cbbf" href="R/3836a999cf64cbbf.html" target="n" data-glyph="45,2" class="i field">partitionCount</a>;
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <b>protected readonly string</b> <a id="dbadeee45cce5dc1" href="R/dbadeee45cce5dc1.html" target="n" data-glyph="45,2" class="i field">tag</a>;
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Construct the mock factory.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r34 r">partitionCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">tag</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <b>public</b> <a id="3b82f901d4bf0877" href="R/../../0000000000.html" target="n" data-glyph="72,2" class="t constructor">EventHubClientFactoryMock</a>(<b>int</b> <span id="r34 rd" class="r34 r">partitionCount</span>, <b>string</b> <span id="r35 rd" class="r35 r">tag</span> = <b>null</b>)
            {
                <a href="#978a061bb42dd888" class="k">this</a>.<a href="#3836a999cf64cbbf" class="i field">partitionCount</a> = <span class="r34 r">partitionCount</span>;
                <a href="#978a061bb42dd888" class="k">this</a>.<a href="#dbadeee45cce5dc1" class="i field">tag</a> = <span class="r35 r">tag</span>;
            }
 
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> Dispense a mock instance operating on a fake event hub with name taken from the connection string.</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r36 r">connectionString</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r37 r">receiveTimeout</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
            <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
            <b>public virtual</b> <a href="EventHubWrappers.cs.html#2e0454f5c1ce0b4a" class="t t">EventHubWrappers</a>.<a href="EventHubWrappers.cs.html#8d8b643cdc1ffa6f" class="t t">IEventHubClient</a> <a id="e64c0f0ec9126bcf" href="R/e64c0f0ec9126bcf.html" target="n" data-glyph="72,2" class="i method">Create</a>(<b>string</b> <span id="r36 rd" class="r36 r">connectionString</span>, <span class="i">TimeSpan</span> <span id="r37 rd" class="r37 r">receiveTimeout</span>)
            {
                <a href="EventProcessorEventSource.cs.html#2fed9fafe165eac3" class="t t">EventProcessorEventSource</a>.<a href="EventProcessorEventSource.cs.html#be9569fb60e2506c" class="i field">Current</a>.<a href="EventProcessorEventSource.cs.html#82060e097e4d860d" class="i method">Message</a>(<span class="s">$&quot;</span><span class="s">MOCK Creating IEventHubClient </span>{<span class="r36 r">connectionString</span>}<span class="s"> with </span>{<a href="#978a061bb42dd888" class="k">this</a>.<a href="#3836a999cf64cbbf" class="i field">partitionCount</a>}<span class="s"> partitions</span><span class="s">&quot;</span>);
                <a href="/Microsoft.Azure.EventHubs/A.html#37541b805119d484" class="t t">EventHubsConnectionStringBuilder</a> <span id="r38 rd" class="r38 r">csb</span> = <b>new</b> <span class="t">EventHubsConnectionStringBuilder</span>(<span class="r36 r">connectionString</span>);
                <span class="r38 r">csb</span>.<a href="/Microsoft.Azure.EventHubs/A.html#9bdfa559ce29adc5" class="i property">OperationTimeout</a> = <span class="r37 r">receiveTimeout</span>;
                <b>return</b> <b>new</b> <a href="#2441acec727b155e" class="t constructor">EventHubClientMock</a>(<a href="#978a061bb42dd888" class="k">this</a>.<a href="#3836a999cf64cbbf" class="i field">partitionCount</a>, <span class="r38 r">csb</span>, <a href="#978a061bb42dd888" class="k">this</a>.<a href="#dbadeee45cce5dc1" class="i field">tag</a>);
            }
        }
    }
}
</pre></td></tr></table></div></body></html>
