<!DOCTYPE html>
<html><head><title>ClientAssertionCertificate.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(58);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Rest.ClientRuntime.Azure.Authentication/ClientAssertionCertificate.cs" target="_top">ClientAssertionCertificate.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Rest.ClientRuntime.Azure.Authentication" target="_top">..\..\Az.Authentication\Microsoft.Rest.ClientRuntime.Azure.Authentication.csproj</a> (Microsoft.Rest.ClientRuntime.Azure.Authentication)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">net452</span>
<span class="e">namespace Microsoft.Rest.Azure.Authentication
{
    using Microsoft.IdentityModel.Clients.ActiveDirectory;
    using Microsoft.IdentityModel.Tokens;
    using System.Security.Cryptography;
    using System.Security.Cryptography.X509Certificates;
    using System.Text;
    public class ClientAssertionCertificate : IClientAssertionCertificate
    {
        private X509Certificate2 certificate;
 
        public string ClientId { get; private set; }
        
        public string Thumbprint
        {
            get
            {
                return Base64UrlEncoder.Encode(certificate.GetCertHash());
            }
        }
 
        public ClientAssertionCertificate(string clientId, X509Certificate2 certificate)
        {
            ClientId = clientId;
            this.certificate = certificate;
        }
 
        public ClientAssertionCertificate(string clientId, byte[] rawCertificate, string password)
            : this(clientId, new X509Certificate2(rawCertificate, password)) { }
 
        public ClientAssertionCertificate(string clientId, byte[] rawCertificate) 
            : this(clientId, new X509Certificate2(rawCertificate)) { }
 
        public ClientAssertionCertificate(string clientId, string certificateFilePath) 
            : this(clientId, new X509Certificate2(certificateFilePath)) { }
 
        public ClientAssertionCertificate(string clientId, string certificateFilePath, string certificatePassword)
            : this(clientId, new X509Certificate2(certificateFilePath, certificatePassword)) { }
 
        public byte[] Sign(string message)
        {
            using (var key = certificate.GetRSAPrivateKey())
            {
                if (key == null)
                {
                    throw new CryptographicException(&quot;No valid private RSA key found for X509Certificate2.&quot;);
                }
 
                return key.SignData(Encoding.UTF8.GetBytes(message), HashAlgorithmName.SHA256, RSASignaturePadding.Pkcs1);
            }
        }
    }
}
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span></pre></td></tr></table></div></body></html>
