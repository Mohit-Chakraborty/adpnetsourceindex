<!DOCTYPE html>
<html><head><title>SingleSegmentDownloader.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(342);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Management.DataLake.Store/Customizations/DataTransfer/Download/SingleSegmentDownloader.cs" target="_top">Customizations\DataTransfer\Download\SingleSegmentDownloader.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Management.DataLake.Store" target="_top">Microsoft.Azure.Management.DataLake.Store.csproj</a> (Microsoft.Azure.Management.DataLake.Store)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>;
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">IO</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Text</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Threading</span>.<span class="i n">Tasks</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">DataLake</span>.<span class="i n">Store</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Represents a downloader for a single segment of a larger file.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    <b>internal class</b> <a id="642c31272c5a736d" href="../../../R/642c31272c5a736d.html" target="n" data-glyph="2,0" class="t t">SingleSegmentDownloader</a>
    {
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private
 
        <b>internal const decimal</b> <a id="a8734e990c6d8eb6" href="../../../R/a8734e990c6d8eb6.html" target="n" data-glyph="8,1" class="i field">BufferLength</a> = 32 * 1024 * 1024; <span class="c">// 32MB</span>
        <b>private const int</b> <a id="6d8caef8f78e872e" href="../../../R/6d8caef8f78e872e.html" target="n" data-glyph="10,1" class="i field">MaximumBackoffWaitSeconds</a> = 32;
        <b>internal const int</b> <a id="fcf4c03906c69f6c" href="../../../R/fcf4c03906c69f6c.html" target="n" data-glyph="8,1" class="i field">MaxBufferDownloadAttemptCount</a> = 8;
 
        <b>private readonly</b> <a href="../Common/IFrontEndAdapter.cs.html#d503d7a60084fa22" class="t t">IFrontEndAdapter</a> <a id="a9044157cd5d8803" href="../../../R/a9044157cd5d8803.html" target="n" data-glyph="46,1" class="i field">_frontEnd</a>;
        <b>private readonly</b> <a href="@0@mscorlib/A.html#766adb700a2972f5" class="t t">IProgress</a>&lt;<a href="../Common/SegmentTransferProgress.cs.html#47a2d1611194ef16" class="t t">SegmentTransferProgress</a>&gt; <a id="d07e5913629c395a" href="../../../R/d07e5913629c395a.html" target="n" data-glyph="46,1" class="i field">_progressTracker</a>;
        <b>private readonly</b> <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <a id="3bd60a9fcd86374e" href="../../../R/3bd60a9fcd86374e.html" target="n" data-glyph="46,1" class="i field">_token</a>;
        <b>private</b> <a href="../Common/TransferSegmentMetadata.cs.html#4a50ebae0a9351d2" class="t t">TransferSegmentMetadata</a> <a id="c57cdd6ee0d8ef1d" href="../../../R/c57cdd6ee0d8ef1d.html" target="n" data-glyph="46,1" class="i field">_segmentMetadata</a>;
        <b>private</b> <a href="../Common/TransferMetadata.cs.html#3c08d873a58fc637" class="t t">TransferMetadata</a> <a id="8832c5bcce2076ae" href="../../../R/8832c5bcce2076ae.html" target="n" data-glyph="46,1" class="i field">_metadata</a>;
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new downloader for a single segment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">segmentNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number of the segment.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">downloadMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The metadata for the entire download.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r2 r">frontEnd</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A pointer to the front end.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r3 r">progressTracker</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">(Optional) A tracker to report progress on this segment.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="f13debf79ce9f6cb" href="../../../R/../../0000000000.html" target="n" data-glyph="72,1" class="t constructor">SingleSegmentDownloader</a>(<b>int</b> <span id="r0 rd" class="r0 r">segmentNumber</span>, <a href="../Common/TransferMetadata.cs.html#3c08d873a58fc637" class="t t">TransferMetadata</a> <span id="r1 rd" class="r1 r">downloadMetadata</span>, <a href="../Common/IFrontEndAdapter.cs.html#d503d7a60084fa22" class="t t">IFrontEndAdapter</a> <span id="r2 rd" class="r2 r">frontEnd</span>, <a href="@0@mscorlib/A.html#766adb700a2972f5" class="t t">IProgress</a>&lt;<a href="../Common/SegmentTransferProgress.cs.html#47a2d1611194ef16" class="t t">SegmentTransferProgress</a>&gt; <span id="r3 rd" class="r3 r">progressTracker</span> = <b>null</b>) :
            <a href="#c02311206aba28f1" class="k">this</a>(<span class="r0 r">segmentNumber</span>, <span class="r1 r">downloadMetadata</span>, <span class="r2 r">frontEnd</span>, <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a>.<a href="@0@mscorlib/A.html#ec32c41597007382" class="i property">None</a>, <span class="r3 r">progressTracker</span>)
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new downloader for a single segment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">segmentNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The sequence number of the segment.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">downloadMetadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The metadata for the entire download.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r6 r">frontEnd</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">A pointer to the front end.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">token</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The cancellation token to use</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">progressTracker</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">(Optional) A tracker to report progress on this segment.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>public</b> <a id="c02311206aba28f1" href="../../../R/c02311206aba28f1.html" target="n" data-glyph="72,1" class="t constructor">SingleSegmentDownloader</a>(<b>int</b> <span id="r4 rd" class="r4 r">segmentNumber</span>, <a href="../Common/TransferMetadata.cs.html#3c08d873a58fc637" class="t t">TransferMetadata</a> <span id="r5 rd" class="r5 r">downloadMetadata</span>, <a href="../Common/IFrontEndAdapter.cs.html#d503d7a60084fa22" class="t t">IFrontEndAdapter</a> <span id="r6 rd" class="r6 r">frontEnd</span>, <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r7 rd" class="r7 r">token</span>, <a href="@0@mscorlib/A.html#766adb700a2972f5" class="t t">IProgress</a>&lt;<a href="../Common/SegmentTransferProgress.cs.html#47a2d1611194ef16" class="t t">SegmentTransferProgress</a>&gt; <span id="r8 rd" class="r8 r">progressTracker</span> = <b>null</b>)
        {
            <a href="#8832c5bcce2076ae" class="i field">_metadata</a> = <span class="r5 r">downloadMetadata</span>;
            <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a> = <span class="r5 r">downloadMetadata</span>.<a href="../Common/TransferMetadata.cs.html#982540b694e3af39" class="i property">Segments</a>[<span class="r4 r">segmentNumber</span>];
 
            <a href="#a9044157cd5d8803" class="i field">_frontEnd</a> = <span class="r6 r">frontEnd</span>;
            <a href="#d07e5913629c395a" class="i field">_progressTracker</a> = <span class="r8 r">progressTracker</span>;
            <a href="#3bd60a9fcd86374e" class="i field">_token</a> = <span class="r7 r">token</span>;
            <a href="#642c31272c5a736d" class="k">this</a>.<a href="#8759a4d92b1e7860" class="i property">UseBackOffRetryStrategy</a> = <b>true</b>;
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets a value indicating whether to use a back-off (exponenential) in case of individual block failures.</span>
        <span class="c">///</span><span class="c"> If set to &#39;false&#39; every retry is handled immediately; otherwise an amount of time is waited between retries, as a function of power of 2.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal bool</b> <a id="8759a4d92b1e7860" href="../../../R/8759a4d92b1e7860.html" target="n" data-glyph="104,1" class="i property">UseBackOffRetryStrategy</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Download Operations
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Downloads the portion of the InputFilePath to the given TargetStreamPath, starting at the given StartOffset.</span>
        <span class="c">///</span><span class="c"> The segment is further divided into equally-sized blocks which are downloaded in sequence.</span>
        <span class="c">///</span><span class="c"> Each such block is attempted a certain number of times; if after that it still cannot be downloaded, the entire segment is aborted (in which case no cleanup is performed on the server).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>public void</b> <a id="169868c06ddd32e8" href="../../../R/169868c06ddd32e8.html" target="n" data-glyph="72,1" class="i method">Download</a>()
        {
            <b>if</b> (<a href="#3bd60a9fcd86374e" class="i field">_token</a>.<a href="@0@mscorlib/A.html#f32abbe8e2f1f6c1" class="i property">IsCancellationRequested</a>)
            {
                <a href="#3bd60a9fcd86374e" class="i field">_token</a>.<a href="@0@mscorlib/A.html#d2864d73804288fc" class="i method">ThrowIfCancellationRequested</a>();
            }
 
            <span class="c">// download the data</span>
            <span class="c">//any exceptions are (re)thrown to be handled by the caller; we do not handle retries or other recovery techniques here</span>
            <span class="c">// NOTE: We don&#39;t validate the download contents for each individual segment because all segments are being downloaded,</span>
            <span class="c">// in parallel, into the same stream. We cannot confirm the size of the data downloaded here. Instead we do it once at the end.</span>
            <a href="#fbb8e698b7ea7f6e" class="i method">DownloadSegmentContents</a>();
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Verifies the downloaded stream.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><a href="../Common/TransferFailedException.cs.html#020a0db52cedc36b" class="t t">TransferFailedException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>internal void</b> <a id="8cbad02afde545fe" href="../../../R/8cbad02afde545fe.html" target="n" data-glyph="74,1" class="i method">VerifyDownloadedStream</a>()
        {
            <span class="c">//verify that the remote stream has the length we expected.</span>
            <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r9 rd" class="r9 r">retryCount</span> = 0;
            <b>long</b> <span id="r10 rd" class="r10 r">remoteLength</span> = -1;
            <b>while</b> (<span class="r9 r">retryCount</span> &lt; <a href="#fcf4c03906c69f6c" class="i field">MaxBufferDownloadAttemptCount</a>)
            {
                <a href="#3bd60a9fcd86374e" class="i field">_token</a>.<a href="@0@mscorlib/A.html#d2864d73804288fc" class="i method">ThrowIfCancellationRequested</a>();
                <span class="r9 r">retryCount</span>++;
                <b>try</b>
                {
                    <span class="r10 r">remoteLength</span> = <a href="#a9044157cd5d8803" class="i field">_frontEnd</a>.<a href="../Common/IFrontEndAdapter.cs.html#84a396ab34116429" class="i method">GetStreamLength</a>(<a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#3e61c0eaf4a2746f" class="i property">Path</a>, <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#bff991c0ada527f8" class="i property">IsDownload</a>);
                    <b>break</b>;
                }
                <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r11 rd" class="r11 r">e</span>)
                {
                    <a href="#3bd60a9fcd86374e" class="i field">_token</a>.<a href="@0@mscorlib/A.html#d2864d73804288fc" class="i method">ThrowIfCancellationRequested</a>();
                    <b>if</b> (<span class="r9 r">retryCount</span> &gt;= <a href="#fcf4c03906c69f6c" class="i field">MaxBufferDownloadAttemptCount</a>)
                    {
                        <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#dcfce072ce42955d" class="i method">LogError</a>(<span class="r11 r">e</span>);
                        
                        <b>throw</b> <span class="r11 r">e</span>;
                    }
 
                    <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r12 rd" class="r12 r">waitTime</span> = <a href="#385874b317a9575c" class="i method">WaitForRetry</a>(<span class="r9 r">retryCount</span>, <a href="#642c31272c5a736d" class="k">this</a>.<a href="#8759a4d92b1e7860" class="i property">UseBackOffRetryStrategy</a>, <a href="#3bd60a9fcd86374e" class="i field">_token</a>);
                    <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#d6f22d2fc99e22e6" class="i method">LogInfo</a>(<span class="s">&quot;VerifyDownloadedStream: GetStreamLength at path:{0} failed on try: {1} with exception: {2}. Wait time in ms before retry: {3}&quot;</span>,
                        <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#3e61c0eaf4a2746f" class="i property">Path</a>,
                        <span class="r9 r">retryCount</span>,
                        <span class="r11 r">e</span>,
                        <span class="r12 r">waitTime</span>);
                    
                }
            }
 
            <b>if</b> (<a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#d35d9c4278e3e239" class="i property">Length</a> != <span class="r10 r">remoteLength</span>)
            {
                <a href="../Common/TransferFailedException.cs.html#020a0db52cedc36b" class="k">var</a> <span id="r13 rd" class="r13 r">ex</span> = <b>new</b> <a href="../Common/TransferFailedException.cs.html#0257d7104f85f50a" class="t constructor">TransferFailedException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;Post-download stream verification failed: target stream has a length of {0}, expected {1}&quot;</span>, <span class="r10 r">remoteLength</span>, <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#d35d9c4278e3e239" class="i property">Length</a>));
                <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#dcfce072ce42955d" class="i method">LogError</a>(<span class="r13 r">ex</span>);
 
                <b>throw</b> <span class="r13 r">ex</span>;
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Downloads the segment contents.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private void</b> <a id="fbb8e698b7ea7f6e" href="../../../R/fbb8e698b7ea7f6e.html" target="n" data-glyph="76,1" class="i method">DownloadSegmentContents</a>()
        {
            <span class="c">// set the current offset in the stream we are reading to the offset</span>
            <span class="c">// that this segment starts at.</span>
            <b>long</b> <span id="r14 rd" class="r14 r">curOffset</span> = <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#df08bf689d04aaad" class="i property">Offset</a>;
 
            <span class="c">// set the offset of the local file that we are creating to the beginning of the local stream.</span>
            <span class="c">// this value will be used to ensure that we are always reporting the right progress and that,</span>
            <span class="c">// in the event of faiure, we reset the local stream to the proper location.</span>
            <b>long</b> <span id="r15 rd" class="r15 r">localOffset</span> = 0;
 
            <span class="c">// determine the number of requests made based on length of file divded by 32MB max size requests</span>
            <a href="@0@mscorlib/A.html#1b2858baf311cbf9" class="k">var</a> <span id="r16 rd" class="r16 r">numRequests</span> = <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#d88971c798688a12" class="i method">Ceiling</a>(<a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#d35d9c4278e3e239" class="i property">Length</a> / <a href="#a8734e990c6d8eb6" class="i field">BufferLength</a>);
            <span class="c">// set the length remaining to ensure that only the exact number of bytes is ultimately downloaded</span>
            <span class="c">// for this segment.</span>
            <a href="@0@mscorlib/A.html#e566178cce890c36" class="k">var</a> <span id="r17 rd" class="r17 r">lengthRemaining</span> = <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#d35d9c4278e3e239" class="i property">Length</a>;
 
            <span class="c">// for multi-segment files we append &quot;inprogress&quot; to indicate that the file is not yet ready for use. </span>
            <span class="c">// This also protects the user from unintentionally using the file after a failed download.</span>
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r18 rd" class="r18 r">streamName</span> = <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#9131b8fdd074a557" class="i property">SegmentCount</a> &gt; 1 ? <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#9d5604d4425b216f" class="i method">Format</a>(<span class="s">&quot;{0}.inprogress&quot;</span>, <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#fdcb0ca156a2a7cb" class="i property">TargetStreamPath</a>) : <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#fdcb0ca156a2a7cb" class="i property">TargetStreamPath</a>;
            <b>using</b> (<a href="@0@mscorlib/A.html#e23a38af5d11ddd3" class="k">var</a> <span id="r19 rd" class="r19 r">outputStream</span> = <b>new</b> <a href="@0@mscorlib/A.html#756b978acfa47bc7" class="t constructor">FileStream</a>(<span class="r18 r">streamName</span>, <a href="@0@mscorlib/A.html#c0cb6ba6af625b3a" class="t t">FileMode</a>.<a href="@0@mscorlib/A.html#f4421e1d202f76fa" class="i field">Open</a>, <a href="@0@mscorlib/A.html#5cc5644ae3acd24b" class="t t">FileAccess</a>.<a href="@0@mscorlib/A.html#4715fa16da583c25" class="i field">Write</a>, <a href="@0@mscorlib/A.html#2bfafb4d44a4f126" class="t t">FileShare</a>.<a href="@0@mscorlib/A.html#e51e30298bd05259" class="i field">ReadWrite</a>))
            {
                <span class="r19 r">outputStream</span>.<a href="@0@mscorlib/A.html#329c77a859ac60bd" class="i method">Seek</a>(<span class="r14 r">curOffset</span>, <a href="@0@mscorlib/A.html#2cc1cf6635f00a52" class="t t">SeekOrigin</a>.<a href="@0@mscorlib/A.html#c29481af7c617299" class="i field">Begin</a>);
                <b>for</b> (<b>int</b> <span id="r20 rd" class="r20 r">i</span> = 0; <span class="r20 r">i</span> &lt; <span class="r16 r">numRequests</span>; <span class="r20 r">i</span>++)
                {
                    <a href="#3bd60a9fcd86374e" class="i field">_token</a>.<a href="@0@mscorlib/A.html#d2864d73804288fc" class="i method">ThrowIfCancellationRequested</a>();
                    <b>int</b> <span id="r21 rd" class="r21 r">attemptCount</span> = 0;
                    <b>int</b> <span id="r22 rd" class="r22 r">partialDataAttempts</span> = 0;
                    <b>bool</b> <span id="r23 rd" class="r23 r">downloadCompleted</span> = <b>false</b>;
                    <b>long</b> <span id="r24 rd" class="r24 r">dataReceived</span> = 0;
                    <b>bool</b> <span id="r25 rd" class="r25 r">modifyLengthAndOffset</span> = <b>false</b>;
                    <b>while</b> (!<span class="r23 r">downloadCompleted</span> &amp;&amp; <span class="r21 r">attemptCount</span> &lt; <a href="#fcf4c03906c69f6c" class="i field">MaxBufferDownloadAttemptCount</a>)
                    {
                        <a href="#3bd60a9fcd86374e" class="i field">_token</a>.<a href="@0@mscorlib/A.html#d2864d73804288fc" class="i method">ThrowIfCancellationRequested</a>();
                        <b>try</b>
                        {
                            <b>long</b> <span id="r26 rd" class="r26 r">lengthToDownload</span> = (<b>long</b>)<a href="#a8734e990c6d8eb6" class="i field">BufferLength</a>;
 
                            <span class="c">// in the case where we got less than the expected amount of data,</span>
                            <span class="c">// only download the rest of the data from the previous request</span>
                            <span class="c">// instead of a new full buffer.</span>
                            <b>if</b> (<span class="r25 r">modifyLengthAndOffset</span>)
                            {
                                <span class="r26 r">lengthToDownload</span> -= <span class="r24 r">dataReceived</span>;
                            }
 
                            <span class="c">// test to make sure that the remaining length is larger than the max size, </span>
                            <span class="c">// otherwise just download the remaining length.</span>
                            <b>if</b> (<span class="r17 r">lengthRemaining</span> - <span class="r26 r">lengthToDownload</span> &lt; 0)
                            {
                                <span class="r26 r">lengthToDownload</span> = <span class="r17 r">lengthRemaining</span>;
                            }
 
                            <b>using</b> (<a href="@0@mscorlib/A.html#f956b0c07e86df64" class="k">var</a> <span id="r27 rd" class="r27 r">readStream</span> = <a href="#a9044157cd5d8803" class="i field">_frontEnd</a>.<a href="../Common/IFrontEndAdapter.cs.html#7ea09b5a0ed2c2e5" class="i method">ReadStream</a>(<a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#190138f2a84df06b" class="i property">InputFilePath</a>, <span class="r14 r">curOffset</span>, <span class="r26 r">lengthToDownload</span>, <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#bff991c0ada527f8" class="i property">IsDownload</a>))
                            {
                                <span class="r27 r">readStream</span>.<a href="@0@mscorlib/A.html#471cfae262c3528c" class="i method">CopyTo</a>(<span class="r19 r">outputStream</span>, (<b>int</b>)<span class="r26 r">lengthToDownload</span>);
                            }
 
                            <a href="@0@mscorlib/A.html#e566178cce890c36" class="k">var</a> <span id="r28 rd" class="r28 r">lengthReturned</span> = <span class="r19 r">outputStream</span>.<a href="@0@mscorlib/A.html#f2e565bc5ce4ae5f" class="i property">Position</a> - <span class="r14 r">curOffset</span>;
                            
                            <span class="c">// if we got more data than we asked for something went wrong and we should retry, since we can&#39;t trust the extra data</span>
                            <b>if</b>(<span class="r28 r">lengthReturned</span> &gt; <span class="r26 r">lengthToDownload</span>)
                            {
                                <a href="../Common/TransferFailedException.cs.html#020a0db52cedc36b" class="k">var</a> <span id="r29 rd" class="r29 r">ex</span> = <b>new</b> <a href="../Common/TransferFailedException.cs.html#0257d7104f85f50a" class="t constructor">TransferFailedException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#ad9f5b0b214ae8f3" class="i method">Format</a>(<span class="s">&quot;{4}: Did not download the expected amount of data in the request. Expected: {0}. Actual: {1}. From offset: {2} in remote file: {3}&quot;</span>, <span class="r26 r">lengthToDownload</span>, <span class="r19 r">outputStream</span>.<a href="@0@mscorlib/A.html#f2e565bc5ce4ae5f" class="i property">Position</a> - <span class="r14 r">curOffset</span>, <span class="r14 r">curOffset</span>, <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#190138f2a84df06b" class="i property">InputFilePath</a>, <a href="@0@mscorlib/A.html#df6b1eba7461813b" class="t t">DateTime</a>.<a href="@0@mscorlib/A.html#1cd5dd408a32124f" class="i property">Now</a>.<a href="@0@mscorlib/A.html#11d38858dedad166" class="i method">ToString</a>()));
                                <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#dcfce072ce42955d" class="i method">LogError</a>(<span class="r29 r">ex</span>);
 
                                <b>throw</b> <span class="r29 r">ex</span>;
                            }
 
                            <span class="c">// we need to validate how many bytes have actually been copied to the read stream</span>
                            <b>if</b> (<span class="r28 r">lengthReturned</span> &lt; <span class="r26 r">lengthToDownload</span>)
                            {
                                <span class="r22 r">partialDataAttempts</span>++;
                                <span class="r17 r">lengthRemaining</span> -= <span class="r28 r">lengthReturned</span>;
                                <span class="r14 r">curOffset</span> += <span class="r28 r">lengthReturned</span>;
                                <span class="r15 r">localOffset</span> += <span class="r28 r">lengthReturned</span>;
                                <span class="r25 r">modifyLengthAndOffset</span> = <b>true</b>;
                                <span class="r24 r">dataReceived</span> += <span class="r28 r">lengthReturned</span>;
                                <a href="#e99864d6d3664c8c" class="i method">ReportProgress</a>(<span class="r15 r">localOffset</span>, <b>false</b>);
 
                                <span class="c">// we will wait before the next iteration, since something went wrong and we did not receive enough data.</span>
                                <span class="c">// this could be a throttling issue or an issue with the service itself. Either way, waiting should help</span>
                                <span class="c">// reduce the liklihood of additional failures.</span>
                                <b>if</b>(<span class="r22 r">partialDataAttempts</span> &gt;= <a href="#fcf4c03906c69f6c" class="i field">MaxBufferDownloadAttemptCount</a>)
                                {
                                    <a href="../Common/TransferFailedException.cs.html#020a0db52cedc36b" class="k">var</a> <span id="r30 rd" class="r30 r">ex</span> = <b>new</b> <a href="../Common/TransferFailedException.cs.html#0257d7104f85f50a" class="t constructor">TransferFailedException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#7432dab173fae5fc" class="i method">Format</a>(<span class="s">&quot;Failed to retrieve the requested data after {0} attempts for file {1}. This usually indicates repeated server-side throttling due to exceeding account bandwidth.&quot;</span>, <a href="#fcf4c03906c69f6c" class="i field">MaxBufferDownloadAttemptCount</a>, <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#3e61c0eaf4a2746f" class="i property">Path</a>));
                                    <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#dcfce072ce42955d" class="i method">LogError</a>(<span class="r30 r">ex</span>);
 
                                    <b>throw</b> <span class="r30 r">ex</span>;
                                }
 
                                <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r31 rd" class="r31 r">waitTime</span> = <a href="#385874b317a9575c" class="i method">WaitForRetry</a>(<span class="r22 r">partialDataAttempts</span>, <a href="#642c31272c5a736d" class="k">this</a>.<a href="#8759a4d92b1e7860" class="i property">UseBackOffRetryStrategy</a>, <a href="#3bd60a9fcd86374e" class="i field">_token</a>);
                                <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#d6f22d2fc99e22e6" class="i method">LogInfo</a>(<span class="s">&quot;DownloadSegmentContents: ReadStream at path:{0} returned: {1} bytes. Expected: {2} bytes. Attempt: {3}. Wait time in ms before retry: {4}&quot;</span>,
                                    <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#190138f2a84df06b" class="i property">InputFilePath</a>,
                                    <span class="r28 r">lengthReturned</span>,
                                    <span class="r26 r">lengthToDownload</span>,
                                    <span class="r22 r">partialDataAttempts</span>,
                                    <span class="r31 r">waitTime</span>);
                            }
                            <b>else</b>
                            {
                                <span class="r23 r">downloadCompleted</span> = <b>true</b>;
                                <span class="r17 r">lengthRemaining</span> -= <span class="r26 r">lengthToDownload</span>;
                                <span class="r14 r">curOffset</span> += <span class="r26 r">lengthToDownload</span>;
                                <span class="r15 r">localOffset</span> += <span class="r26 r">lengthToDownload</span>;
                                <a href="#e99864d6d3664c8c" class="i method">ReportProgress</a>(<span class="r15 r">localOffset</span>, <b>false</b>);
                            }
                        }
                        <b>catch</b> (<a href="@0@mscorlib/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r32 rd" class="r32 r">ex</span>)
                        {
                            <span class="c">// update counts and reset for internal attempts</span>
                            <span class="r21 r">attemptCount</span>++;
                            <span class="r22 r">partialDataAttempts</span> = 0;
 
                            <span class="c">//if we tried more than the number of times we were allowed to, give up and throw the exception</span>
                            <b>if</b> (<span class="r21 r">attemptCount</span> &gt;= <a href="#fcf4c03906c69f6c" class="i field">MaxBufferDownloadAttemptCount</a>)
                            {
                                <a href="#e99864d6d3664c8c" class="i method">ReportProgress</a>(<span class="r15 r">localOffset</span>, <b>true</b>);
                                <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#dcfce072ce42955d" class="i method">LogError</a>(<span class="r32 r">ex</span>);
 
                                <b>throw</b> <span class="r32 r">ex</span>;
                            }
                            <b>else</b>
                            {
                                <a href="@0@mscorlib/A.html#225942ed7b7a3252" class="k">var</a> <span id="r33 rd" class="r33 r">waitTime</span> = <a href="#385874b317a9575c" class="i method">WaitForRetry</a>(<span class="r21 r">attemptCount</span>, <a href="#642c31272c5a736d" class="k">this</a>.<a href="#8759a4d92b1e7860" class="i property">UseBackOffRetryStrategy</a>, <a href="#3bd60a9fcd86374e" class="i field">_token</a>);
                                <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#d6f22d2fc99e22e6" class="i method">LogInfo</a>(<span class="s">&quot;DownloadSegmentContents: ReadStream at path:{0} failed on try: {1} with exception: {2}. Wait time in ms before retry: {3}&quot;</span>,
                                    <a href="#8832c5bcce2076ae" class="i field">_metadata</a>.<a href="../Common/TransferMetadata.cs.html#190138f2a84df06b" class="i property">InputFilePath</a>,
                                    <span class="r21 r">attemptCount</span>,
                                    <span class="r32 r">ex</span>,
                                    <span class="r33 r">waitTime</span>);
 
                                <span class="c">// forcibly put the stream back to where it should be based on where we think we are in the download.</span>
                                <span class="r19 r">outputStream</span>.<a href="@0@mscorlib/A.html#329c77a859ac60bd" class="i method">Seek</a>(<span class="r14 r">curOffset</span>, <a href="@0@mscorlib/A.html#2cc1cf6635f00a52" class="t t">SeekOrigin</a>.<a href="@0@mscorlib/A.html#c29481af7c617299" class="i field">Begin</a>);
                            }
                        }
                    }
                }
 
                <span class="c">// full validation of the segment.</span>
                <b>if</b>(<span class="r19 r">outputStream</span>.<a href="@0@mscorlib/A.html#f2e565bc5ce4ae5f" class="i property">Position</a> - <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#df08bf689d04aaad" class="i property">Offset</a> != <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#d35d9c4278e3e239" class="i property">Length</a>)
                {
                    <a href="../Common/TransferFailedException.cs.html#020a0db52cedc36b" class="k">var</a> <span id="r34 rd" class="r34 r">ex</span> = <b>new</b> <a href="../Common/TransferFailedException.cs.html#0257d7104f85f50a" class="t constructor">TransferFailedException</a>(<a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#6e5f254563fed78e" class="i method">Format</a>(<span class="s">&quot;Post-download stream segment verification failed for file {2}: target stream has a length of {0}, expected {1}. This usually indicates repeated server-side throttling due to exceeding account bandwidth.&quot;</span>, <span class="r19 r">outputStream</span>.<a href="@0@mscorlib/A.html#f2e565bc5ce4ae5f" class="i property">Position</a> - <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#df08bf689d04aaad" class="i property">Offset</a>, <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#d35d9c4278e3e239" class="i property">Length</a>, <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#3e61c0eaf4a2746f" class="i property">Path</a>));
                    <a href="../Common/TracingHelper.cs.html#f5e26eb6ec4b2342" class="t t">TracingHelper</a>.<a href="../Common/TracingHelper.cs.html#dcfce072ce42955d" class="i method">LogError</a>(<span class="r34 r">ex</span>);
 
                    <b>throw</b> <span class="r34 r">ex</span>;
                }
            }
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Waits for retry.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r35 r">attemptCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The attempt count.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal static int</b> <a id="385874b317a9575c" href="../../../R/385874b317a9575c.html" target="n" data-glyph="74,1" class="i method">WaitForRetry</a>(<b>int</b> <span id="r35 rd" class="r35 r">attemptCount</span>, <b>bool</b> <span id="r36 rd" class="r36 r">useBackOffRetryStrategy</span>, <a href="@0@mscorlib/A.html#36b17ded8b1a228c" class="t t">CancellationToken</a> <span id="r37 rd" class="r37 r">token</span>)
        {
            <span class="r37 r">token</span>.<a href="@0@mscorlib/A.html#d2864d73804288fc" class="i method">ThrowIfCancellationRequested</a>();
            <b>if</b> (!<span class="r36 r">useBackOffRetryStrategy</span>)
            {
                <span class="c">//no need to wait</span>
                <b>return</b> -1;
            }
 
            <b>int</b> <span id="r38 rd" class="r38 r">intervalMs</span> = <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#f441d55c88d635ad" class="i method">Min</a>(<a href="#6d8caef8f78e872e" class="i field">MaximumBackoffWaitSeconds</a>, (<b>int</b>)<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#95354113fadc3083" class="i method">Pow</a>(2, <span class="r35 r">attemptCount</span>)) * 1000;
 
            <span class="c">// add up to 10% to the sleep to allow for randomness in the retry so that thread contention is unlikely</span>
            <a href="@0@mscorlib/A.html#bb77e610694e64ca" class="k">var</a> <span id="r39 rd" class="r39 r">randomMS</span> = <b>new</b> <a href="@0@mscorlib/A.html#5d22f8880fc9f8d9" class="t constructor">Random</a>();
            <span class="r38 r">intervalMs</span> += <span class="r39 r">randomMS</span>.<a href="@0@mscorlib/A.html#8aeb183c03bdcdcf" class="i method">Next</a>((<b>int</b>)<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#1841a5ce24ed9fb3" class="i method">Ceiling</a>(<span class="r38 r">intervalMs</span> * .1));
            <a href="@0@mscorlib/A.html#3980e012bae82e96" class="t t">Thread</a>.<a href="@0@mscorlib/A.html#82aedb56cecde82c" class="i method">Sleep</a>(<a href="@0@mscorlib/A.html#865ef7b89f41b632" class="t t">TimeSpan</a>.<a href="@0@mscorlib/A.html#668d91d771bce54b" class="i method">FromMilliseconds</a>(<span class="r38 r">intervalMs</span>));
            <b>return</b> <span class="r38 r">intervalMs</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Reports the progress.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r40 r">downloadedByteCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The downloaded byte count.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r41 r">isFailed</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">if set to </span><span class="c">&lt;</span><span class="c">c</span><span class="c">&gt;</span><span class="c">true</span><span class="c">&lt;/</span><span class="c">c</span><span class="c">&gt;</span><span class="c"> [is failed].</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>private void</b> <a id="e99864d6d3664c8c" href="../../../R/e99864d6d3664c8c.html" target="n" data-glyph="76,1" class="i method">ReportProgress</a>(<b>long</b> <span id="r40 rd" class="r40 r">downloadedByteCount</span>, <b>bool</b> <span id="r41 rd" class="r41 r">isFailed</span>)
        {
            <b>if</b> (<a href="#d07e5913629c395a" class="i field">_progressTracker</a> == <b>null</b>)
            {
                <b>return</b>;
            }
 
            <b>try</b>
            {
                <a href="#d07e5913629c395a" class="i field">_progressTracker</a>.<a href="@0@mscorlib/A.html#cd87d052fb216d27" class="i method">Report</a>(<b>new</b> <a href="../Common/SegmentTransferProgress.cs.html#2563cc8b0b736569" class="t constructor">SegmentTransferProgress</a>(<a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#b23a7e7d251e39e8" class="i property">SegmentNumber</a>, <a href="#c57cdd6ee0d8ef1d" class="i field">_segmentMetadata</a>.<a href="../Common/TransferSegmentMetadata.cs.html#d35d9c4278e3e239" class="i property">Length</a>, <span class="r40 r">downloadedByteCount</span>, <span class="r41 r">isFailed</span>));
            }
            <b>catch</b> { }<span class="c">// don&#39;t break the download if the progress tracker threw one our way</span>
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
    }
}
</pre></td></tr></table></div></body></html>
