<!DOCTYPE html>
<html><head><title>TransferSegmentMetadata.cs</title><link rel="stylesheet" href="../../../../styles.css"><script src="../../../../scripts.js"></script></head>
<body class="cB" onload="i(268);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#Microsoft.Azure.Management.DataLake.Store/Customizations/DataTransfer/Common/TransferSegmentMetadata.cs" target="_top">Customizations\DataTransfer\Common\TransferSegmentMetadata.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Microsoft.Azure.Management.DataLake.Store" target="_top">Microsoft.Azure.Management.DataLake.Store.csproj</a> (Microsoft.Azure.Management.DataLake.Store)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i">Newtonsoft</span>.<span class="i">Json</span>;
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Diagnostics</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Runtime</span>.<span class="i n">Serialization</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">DataLake</span>.<span class="i n">Store</span>
{
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
    <span class="c">///</span><span class="c"> Represents metadata for a particular file segment.</span>
    <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
    [<a href="@0@mscorlib/A.html#761078d4519dc54e" class="t constructor">DebuggerDisplay</a>(<span class="s">&quot;Segment {SegmentNumber}, Length = {Length}, Status = {Status}&quot;</span>)]
    <b>public class</b> <a id="4a50ebae0a9351d2" href="../../../R/4a50ebae0a9351d2.html" target="n" data-glyph="0,0" class="t t">TransferSegmentMetadata</a>
    {
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Constructor
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Required by JsonSerializer.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        [<span class="i">JsonConstructor</span>]
        <b>internal</b> <a id="654957fa827baa63" href="../../../R/../../0000000000.html" target="n" data-glyph="74,1" class="t constructor">TransferSegmentMetadata</a>()
        {
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Creates a new UploadSegmentMetadata with the given segment number.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r0 r">segmentNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r1 r">metadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <b>internal</b> <a id="55afc598cadfacc0" href="../../../R/55afc598cadfacc0.html" target="n" data-glyph="74,1" class="t constructor">TransferSegmentMetadata</a>(<b>int</b> <span id="r0 rd" class="r0 r">segmentNumber</span>, <a href="TransferMetadata.cs.html#3c08d873a58fc637" class="t t">TransferMetadata</a> <span id="r1 rd" class="r1 r">metadata</span>)
        {
            <a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#b23a7e7d251e39e8" class="i property">SegmentNumber</a> = <span class="r0 r">segmentNumber</span>;
            <a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#dad6b56604dbe3f7" class="i property">Status</a> = <a href="SegmentTransferStatus.cs.html#f871cd80cd9814cc" class="t t">SegmentTransferStatus</a>.<a href="SegmentTransferStatus.cs.html#e8c6f082f267929a" class="i field">Pending</a>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a> <span id="r2 rd" class="r2 r">ignored</span>;
            <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">var</a> <span id="r3 rd" class="r3 r">targetStreamName</span> = <span class="r1 r">metadata</span>.<a href="TransferMetadata.cs.html#1b91f3ca2f8a399b" class="i method">SplitTargetStreamPathByName</a>(<b>out</b> <span class="r2 r">ignored</span>);
            <a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#3e61c0eaf4a2746f" class="i property">Path</a> = <a href="@0@mscorlib/A.html#8281103e6f23cb5c" class="k">string</a>.<a href="@0@mscorlib/A.html#ad9f5b0b214ae8f3" class="i method">Format</a>(<span class="s">&quot;{0}/{1}.{2}.segment{3}&quot;</span>, <span class="r1 r">metadata</span>.<a href="TransferMetadata.cs.html#cacb71b2d39d682c" class="i property">SegmentStreamDirectory</a>, <span class="r3 r">targetStreamName</span>, <span class="r1 r">metadata</span>.<a href="TransferMetadata.cs.html#94ead8daa60a5847" class="i property">TransferId</a>, <a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#b23a7e7d251e39e8" class="i property">SegmentNumber</a>);
            <a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#df08bf689d04aaad" class="i property">Offset</a> = <a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#b23a7e7d251e39e8" class="i property">SegmentNumber</a> * <span class="r1 r">metadata</span>.<a href="TransferMetadata.cs.html#3409e7af196dbe90" class="i property">SegmentLength</a>; <span class="c">// segment number is zero-based</span>
            <a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#d35d9c4278e3e239" class="i property">Length</a> = <a href="#13f4c0fcbbdb6072" class="i method">CalculateSegmentLength</a>(<a href="#4a50ebae0a9351d2" class="k">this</a>.<a href="#b23a7e7d251e39e8" class="i property">SegmentNumber</a>, <span class="r1 r">metadata</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Segment Length Calculation
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calculates the length of a typical (non-terminal) segment for a file of the given length that is split into the given number of segments.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r4 r">fileLength</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The length of the file, in bytes.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r5 r">segmentCount</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The number of segments to split the file into.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">Number of segments must be a positive integer</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public static long</b> <a id="0a3d612acfd85def" href="../../../R/0a3d612acfd85def.html" target="n" data-glyph="72,1" class="i method">CalculateSegmentLength</a>(<b>long</b> <span id="r4 rd" class="r4 r">fileLength</span>, <b>int</b> <span id="r5 rd" class="r5 r">segmentCount</span>)
        {
            <b>if</b> (<span class="r5 r">segmentCount</span> &lt; 0)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#eb98012a74461437" class="t constructor">ArgumentException</a>(<span class="s">&quot;Number of segments must be a positive integer&quot;</span>);
            }
 
            <b>if</b> (<span class="r5 r">segmentCount</span> == 0)
            {
                <span class="c">// In this case, we are attempting to upload an empty file, </span>
                <span class="c">// in which case the uploader should just return</span>
                <b>return</b> 0;
            }
 
            <b>long</b> <span id="r6 rd" class="r6 r">segmentLength</span> = <span class="r4 r">fileLength</span> / <span class="r5 r">segmentCount</span>;
 
            <span class="c">//if the file cannot be split into even segments, we need to increment the typical segment length by 1 </span>
            <span class="c">//in order to have the last segment in the file be smaller than the other ones.</span>
            <b>if</b> (<span class="r4 r">fileLength</span> % <span class="r5 r">segmentCount</span> != 0)
            {
                <span class="c">//BUT we can only do this IF this wouldn&#39;t cause the last segment to have a negative length</span>
                <b>if</b> (<span class="r4 r">fileLength</span> - (<span class="r5 r">segmentCount</span> - 1) * (<span class="r6 r">segmentLength</span> + 1) &gt; 0)
                {
                    <span class="r6 r">segmentLength</span>++;
                }
            }
 
            <b>return</b> <span class="r6 r">segmentLength</span>;
        }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calculates the length of the segment with given number for a file with given length that is split into the given number of segments.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r7 r">segmentNumber</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The segment number.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r8 r">metadata</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The metadata for the current upload.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <b>internal static long</b> <a id="13f4c0fcbbdb6072" href="../../../R/13f4c0fcbbdb6072.html" target="n" data-glyph="74,1" class="i method">CalculateSegmentLength</a>(<b>int</b> <span id="r7 rd" class="r7 r">segmentNumber</span>, <a href="TransferMetadata.cs.html#3c08d873a58fc637" class="t t">TransferMetadata</a> <span id="r8 rd" class="r8 r">metadata</span>)
        {
            <b>if</b> (<span class="r7 r">segmentNumber</span> &lt; 0 || <span class="r7 r">segmentNumber</span> &gt;= <span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#9131b8fdd074a557" class="i property">SegmentCount</a>)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#27138d3b17d5ff6b" class="t constructor">ArgumentOutOfRangeException</a>(<span class="s">&quot;segmentNumber&quot;</span>, <span class="s">&quot;Segment Number must be at least zero and less than the total number of segments&quot;</span>);
            }
 
            <b>if</b> (<span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#c2f4b2ebd90b6cb3" class="i property">FileLength</a> &lt; 0)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#4b20cd3790b6426a" class="t constructor">ArgumentException</a>(<span class="s">&quot;fileLength&quot;</span>, <span class="s">&quot;Cannot have a negative file length&quot;</span>);
            }
 
            <span class="c">//verify if the last segment would have a positive value</span>
            <b>long</b> <span id="r9 rd" class="r9 r">lastSegmentLength</span> = <span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#c2f4b2ebd90b6cb3" class="i property">FileLength</a> - (<span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#9131b8fdd074a557" class="i property">SegmentCount</a> - 1) * <span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#3409e7af196dbe90" class="i property">SegmentLength</a>;
            <b>if</b> (<span class="r9 r">lastSegmentLength</span> &lt; 0)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#eb98012a74461437" class="t constructor">ArgumentException</a>(<span class="s">&quot;The given values for segmentCount and segmentLength cannot possibly be used to split a file with the given fileLength (the last segment would have a negative length)&quot;</span>);
            }
            <b>else</b> <b>if</b> (<span class="r9 r">lastSegmentLength</span> &gt; <span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#3409e7af196dbe90" class="i property">SegmentLength</a>)
            {
                <span class="c">//verify if the given segmentCount and segmentLength combination would produce an even split</span>
                <b>if</b> (<span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#c2f4b2ebd90b6cb3" class="i property">FileLength</a> - (<span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#9131b8fdd074a557" class="i property">SegmentCount</a> - 1) * (<span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#3409e7af196dbe90" class="i property">SegmentLength</a> + 1) &gt; 0)
                {
                    <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#eb98012a74461437" class="t constructor">ArgumentException</a>(<span class="s">&quot;The given values for segmentCount and segmentLength would not produce an even split of a file with given fileLength&quot;</span>);
                }
            }
 
            <b>if</b> (<span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#c2f4b2ebd90b6cb3" class="i property">FileLength</a> == 0)
            {
                <b>return</b> 0;
            }
 
            <span class="c">//all segments except the last one have the same length;</span>
            <span class="c">//the last one only has the &#39;full&#39; length if by some miracle the file length is a perfect multiple of the Segment Length</span>
            <b>if</b> (<span class="r7 r">segmentNumber</span> &lt; <span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#9131b8fdd074a557" class="i property">SegmentCount</a> - 1)
            {
                <b>return</b> <span class="r8 r">metadata</span>.<a href="TransferMetadata.cs.html#3409e7af196dbe90" class="i property">SegmentLength</a>;
            }
            <b>else</b>
            {
                <b>return</b> <span class="r9 r">lastSegmentLength</span>;
            }
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Segment Count Calculation
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const int</b> <a id="a1a84eb075ea1053" href="../../../R/a1a84eb075ea1053.html" target="n" data-glyph="10,1" class="i field">BaseMultiplier</a> = 50;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The Reducer is the number of times the length of the file should increase in order to inflate the number of segments by a factor of &#39;Multiplier&#39;.</span>
        <span class="c">///</span><span class="c"> See class description for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const int</b> <a id="0c93e77d508d968d" href="../../../R/0c93e77d508d968d.html" target="n" data-glyph="10,1" class="i field">SegmentCountReducer</a> = 10;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The Multiplier is the number of times the segment count is inflated when the length of the file increases by a factor of &#39;Reducer&#39;.</span>
        <span class="c">///</span><span class="c"> See class description for more details.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>private const int</b> <a id="e759e901f04a780b" href="../../../R/e759e901f04a780b.html" target="n" data-glyph="10,1" class="i field">SegmentCountMultiplier</a> = 2;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The minimum number of bytes in a segment. For best performance, should be sync-ed with the upload buffer length.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <b>internal const int</b> <a id="40c65636bcb0d341" href="../../../R/40c65636bcb0d341.html" target="n" data-glyph="8,1" class="i field">MinimumSegmentSize</a> = <a href="../Upload/SingleSegmentUploader.cs.html#62b7b26e3b4d119f" class="t t">SingleSegmentUploader</a>.<a href="../Upload/SingleSegmentUploader.cs.html#6f8c82413ca1bb6e" class="i field">BufferLength</a>;
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Calculates the number of segments a file of the given length should be split into.</span>
        <span class="c">///</span><span class="c"> The method to calculate this is based on some empirical measurements that allows both the number of segments and the length of each segment to grow as the input file size grows.</span>
        <span class="c">///</span><span class="c"> They both grow on a logarithmic pattern as the file length increases.</span>
        <span class="c">///</span><span class="c"> The formula is roughly this:</span>
        <span class="c">///</span><span class="c"> * Multiplier = Min(100, 50 * 2 ^ Log10(FileLengthInGB))</span>
        <span class="c">///</span><span class="c"> * SegmentCount = Max(1, Multiplier * 2 ^ Log10(FileLengthInGB)</span>
        <span class="c">///</span><span class="c"> Essentially we quadruple the number of segments for each tenfold increase in the file length, with certain caps. The formula is designed to support both small files and</span>
        <span class="c">///</span><span class="c"> extremely large files (and not cause very small segment lengths or very large number of segments).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">param</span> <span class="c">name</span><span class="c">=</span><span class="c">&quot;</span><span class="r10 r">fileLength</span><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">The length of the file, in bytes.</span><span class="c">&lt;/</span><span class="c">param</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The number of segments to split the file into. Returns 0 if fileLength is 0.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">returns</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">exception</span> <span class="c">cref</span><span class="c">=</span><span class="c">&quot;</span><span class="i n">System</span>.<a href="@0@mscorlib/A.html#109b3ef6299ef9df" class="t t">ArgumentException</a><span class="c">&quot;</span><span class="c">&gt;</span><span class="c">File Length cannot be negative</span><span class="c">&lt;/</span><span class="c">exception</span><span class="c">&gt;</span>
        <b>public static int</b> <a id="8f2f9bd27552bc57" href="../../../R/8f2f9bd27552bc57.html" target="n" data-glyph="72,1" class="i method">CalculateSegmentCount</a>(<b>long</b> <span id="r10 rd" class="r10 r">fileLength</span>)
        {
            <b>if</b> (<span class="r10 r">fileLength</span> &lt; 0)
            {
                <b>throw</b> <b>new</b> <a href="@0@mscorlib/A.html#eb98012a74461437" class="t constructor">ArgumentException</a>(<span class="s">&quot;File Length cannot be negative&quot;</span>);
            }
 
            <b>if</b> (<span class="r10 r">fileLength</span> == 0)
            {
                <span class="c">//empty file =&gt; no segments</span>
                <b>return</b> 0;
            }
 
            <b>int</b> <span id="r11 rd" class="r11 r">minNumberOfSegments</span> = (<b>int</b>)<a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#c0288bbe62da07cb" class="i method">Max</a>(1, <span class="r10 r">fileLength</span> / <a href="#40c65636bcb0d341" class="i field">MinimumSegmentSize</a>);
 
            <span class="c">//convert the file length into GB</span>
            <b>double</b> <span id="r12 rd" class="r12 r">lengthInGb</span> = <span class="r10 r">fileLength</span> / 1024.0 / 1024 / 1024;
 
            <span class="c">//apply the formula described in the class description and return the result</span>
            <b>double</b> <span id="r13 rd" class="r13 r">baseMultiplier</span> = <a href="#5904cc4489d2d4a3" class="i method">CalculateBaseMultiplier</a>(<span class="r12 r">lengthInGb</span>);
            <b>int</b> <span id="r14 rd" class="r14 r">segmentCount</span> = (<b>int</b>)(<span class="r13 r">baseMultiplier</span> * <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#95354113fadc3083" class="i method">Pow</a>(<a href="#e759e901f04a780b" class="i field">SegmentCountMultiplier</a>, <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#2e3f3add49c5f3d2" class="i method">Log</a>(<span class="r12 r">lengthInGb</span>, <a href="#0c93e77d508d968d" class="i field">SegmentCountReducer</a>)));
            <b>if</b> (<span class="r14 r">segmentCount</span> &gt; <span class="r11 r">minNumberOfSegments</span>)
            {
                <span class="r14 r">segmentCount</span> = <span class="r11 r">minNumberOfSegments</span>;
            }
 
            <b>if</b> (<span class="r14 r">segmentCount</span> &lt; 1)
            {
                <span class="r14 r">segmentCount</span> = 1;
            }
 
            <b>return</b> <span class="r14 r">segmentCount</span>;
        }
 
        <b>private static double</b> <a id="5904cc4489d2d4a3" href="../../../R/5904cc4489d2d4a3.html" target="n" data-glyph="76,1" class="i method">CalculateBaseMultiplier</a>(<b>double</b> <span id="r15 rd" class="r15 r">lengthInGb</span>)
        {
            <b>double</b> <span id="r16 rd" class="r16 r">value</span> = <a href="#a1a84eb075ea1053" class="i field">BaseMultiplier</a> * <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#95354113fadc3083" class="i method">Pow</a>(2, <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#efb60ccdb679e617" class="i method">Log10</a>(<span class="r15 r">lengthInGb</span>));
            <b>return</b> <a href="@0@mscorlib/A.html#a4407e67b9a5afad" class="t t">Math</a>.<a href="@0@mscorlib/A.html#e248b38c0156e9dd" class="i method">Min</a>(100, <span class="r16 r">value</span>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Properties
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets a value indicating the number (sequence) of the segment in the file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The segment number.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">JsonProperty</span>(<span class="i">PropertyName</span> = <span class="s">&quot;Number&quot;</span>)]
        <b>public int</b> <a id="b23a7e7d251e39e8" href="../../../R/b23a7e7d251e39e8.html" target="n" data-glyph="102,1" class="i property">SegmentNumber</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets a value indicating the starting offset of the segment in the file.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The offset.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">JsonProperty</span>(<span class="i">PropertyName</span> = <span class="s">&quot;Offset&quot;</span>)]
        <b>public long</b> <a id="df08bf689d04aaad" href="../../../R/df08bf689d04aaad.html" target="n" data-glyph="102,1" class="i property">Offset</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets a value indicating the size of the segment (in bytes).</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The length.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">JsonProperty</span>(<span class="i">PropertyName</span> = <span class="s">&quot;Length&quot;</span>)]
        <b>public long</b> <a id="d35d9c4278e3e239" href="../../../R/d35d9c4278e3e239.html" target="n" data-glyph="102,1" class="i property">Length</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets a value indicating the current upload status for this segment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The status.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">JsonProperty</span>(<span class="i">PropertyName</span> = <span class="s">&quot;Status&quot;</span>)]
        <b>public</b> <a href="SegmentTransferStatus.cs.html#f871cd80cd9814cc" class="t t">SegmentTransferStatus</a> <a id="dad6b56604dbe3f7" href="../../../R/dad6b56604dbe3f7.html" target="n" data-glyph="102,1" class="i property">Status</a> { <b>get</b>; <b>set</b>; }
 
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> Gets or sets a value indicating the stream path assigned to this segment.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">summary</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;</span><span class="c">value</span><span class="c">&gt;</span>
        <span class="c">///</span><span class="c"> The path.</span>
        <span class="c">///</span><span class="c"> </span><span class="c">&lt;/</span><span class="c">value</span><span class="c">&gt;</span>
        [<span class="i">JsonProperty</span>(<span class="i">PropertyName</span> = <span class="s">&quot;Path&quot;</span>)]
        <b>public string</b> <a id="3e61c0eaf4a2746f" href="../../../R/3e61c0eaf4a2746f.html" target="n" data-glyph="102,1" class="i property">Path</a> { <b>get</b>; <b>set</b>; }
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
 
    }
}
</pre></td></tr></table></div></body></html>
