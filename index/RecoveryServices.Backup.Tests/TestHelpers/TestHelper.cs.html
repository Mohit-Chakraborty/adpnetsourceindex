<!DOCTYPE html>
<html><head><title>TestHelper.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(404);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="/#RecoveryServices.Backup.Tests/TestHelpers/TestHelper.cs" target="_top">TestHelpers\TestHelper.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#RecoveryServices.Backup.Tests" target="_top">tests\Microsoft.Azure.Management.RecoveryServices.Backup.Tests.csproj</a> (RecoveryServices.Backup.Tests)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="c">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<span class="c">// Licensed under the MIT License. See License.txt in the project root for license information.</span>
 
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">RecoveryServices</span>.<span class="i n">Backup</span>.<span class="i n">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">RecoveryServices</span>.<span class="i">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">ResourceManager</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i">ResourceManager</span>.<span class="i">Models</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">Azure</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">Azure</span>.<span class="i">OData</span>;
<b>using</b> <span class="i n">Microsoft</span>.<span class="i">Rest</span>.<span class="i">ClientRuntime</span>.<span class="i">Azure</span>.<span class="i">TestFramework</span>;
<b>using</b> <span class="i">Xunit</span>;
<b>using</b> <span class="i">HttpStatusCode</span> = <span class="i">System</span>.<span class="i">Net</span>.<span class="i">HttpStatusCode</span>;
<b>using</b> <span class="i">Sku</span> = <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">RecoveryServices</span>.<span class="i">Models</span>.<span class="i">Sku</span>;
 
<b>namespace</b> <span class="i n">Microsoft</span>.<span class="i n">Azure</span>.<span class="i n">Management</span>.<span class="i n">RecoveryServices</span>.<span class="i n">Backup</span>.<span class="i n">Tests</span>
{
    <b>public class</b> <a id="1c8e93c17a029101" href="../R/1c8e93c17a029101.html" target="n" data-glyph="0,0" class="t t"><span id="dd773579c9bf6f19">TestHelper</span></a> : <span class="i">IDisposable</span>
    {
        <b>public string</b> <a id="01b9bbcc853d3009" href="../R/01b9bbcc853d3009.html" target="n" data-glyph="42,1" class="i field">ResourceGroup</a> = <span class="s">&quot;SwaggerTestRg&quot;</span>;
        <b>public string</b> <a id="e661209b8f942c4f" href="../R/e661209b8f942c4f.html" target="n" data-glyph="42,1" class="i field">VaultName</a> = <span class="s">&quot;NetSDKTestRsVault&quot;</span>;
        <b>public string</b> <a id="c9a7183b9bf8aa41" href="../R/c9a7183b9bf8aa41.html" target="n" data-glyph="42,1" class="i field">Location</a> = <span class="s">&quot;southeastasia&quot;</span>;
        <b>public string</b> <a id="15798c0d0fff184f" href="../R/15798c0d0fff184f.html" target="n" data-glyph="42,1" class="i field">FabricName</a> = <span class="s">&quot;Azure&quot;</span>;
 
        <b>public</b> <span class="i">RecoveryServicesClient</span> <a id="183a7932218f8920" href="../R/183a7932218f8920.html" target="n" data-glyph="102,1" class="i property">VaultClient</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public</b> <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#643b4ff2562e1ac8" class="t t">RecoveryServicesBackupClient</a> <a id="ed10104e664fd4a9" href="../R/ed10104e664fd4a9.html" target="n" data-glyph="102,1" class="i property">BackupClient</a> { <b>get</b>; <b>private set</b>; }
 
        <b>public void</b> <a id="274864b17c6fab17" href="../R/274864b17c6fab17.html" target="n" data-glyph="72,1" class="i method">Initialize</a>(<span class="i">MockContext</span> <span id="r0 rd" class="r0 r">context</span>)
        {
            <a href="#183a7932218f8920" class="i property">VaultClient</a> = <a href="#1c8e93c17a029101" class="k">this</a>.<a href="ClientManagementUtilities.cs.html#ff1a97a6ea050f36" class="i method">GetVaultClient</a>(<span class="r0 r">context</span>);
            <a href="#ed10104e664fd4a9" class="i property">BackupClient</a> = <a href="#1c8e93c17a029101" class="k">this</a>.<a href="ClientManagementUtilities.cs.html#97b1bf6a8aa248df" class="i method">GetBackupClient</a>(<span class="r0 r">context</span>);
 
            <a href="#ec471c1bf0839c39" class="i method">CreateResourceGroup</a>(<span class="r0 r">context</span>);
 
            <a href="#994a171789c5057c" class="i method">CreateVault</a>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>);
        }
 
        <b>private void</b> <a id="ec471c1bf0839c39" href="../R/ec471c1bf0839c39.html" target="n" data-glyph="76,1" class="i method">CreateResourceGroup</a>(<span class="i">MockContext</span> <span id="r1 rd" class="r1 r">context</span>)
        {
            <span class="i">ResourceManagementClient</span> <span id="r2 rd" class="r2 r">resourcesClient</span> = <a href="#1c8e93c17a029101" class="k">this</a>.<a href="ClientManagementUtilities.cs.html#155451faf575d705" class="i method">GetResourcesClient</a>(<span class="r1 r">context</span>);
 
            <b>try</b>
            {
                <span class="r2 r">resourcesClient</span>.<span class="i">ResourceGroups</span>.<span class="i">CreateOrUpdate</span>(<a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>,
                <b>new</b> <span class="i">ResourceGroup</span>
                {
                    <span class="i">Location</span> = <a href="#c9a7183b9bf8aa41" class="i field">Location</a>
                });
 
            }
            <b>catch</b> (<span class="i">CloudException</span> <span id="r3 rd" class="r3 r">ex</span>)
            {
                <b>if</b> (<span class="r3 r">ex</span>.<span class="i">Response</span>.<span class="i">StatusCode</span> != <span class="i">System</span>.<span class="i">Net</span>.<span class="i">HttpStatusCode</span>.<span class="i">Conflict</span>) <b>throw</b>;
            }
        }
 
        <b>private void</b> <a id="994a171789c5057c" href="../R/994a171789c5057c.html" target="n" data-glyph="76,1" class="i method">CreateVault</a>(<b>string</b> <span id="r4 rd" class="r4 r">vaultName</span>)
        {
            <span class="i">Vault</span> <span id="r5 rd" class="r5 r">vault</span> = <b>new</b> <span class="i">Vault</span>()
            {
                <span class="i">Location</span> = <a href="#c9a7183b9bf8aa41" class="i field">Location</a>,
                <span class="i">Sku</span> = <b>new</b> <span class="i">Sku</span>()
                {
                    <span class="i">Name</span> = <span class="i">SkuName</span>.<span class="i">Standard</span>
                },
                <span class="i">Properties</span> = <b>new</b> <span class="i">VaultProperties</span>()
            };
 
            <b>try</b>
            {
                <a href="#183a7932218f8920" class="i property">VaultClient</a>.<span class="i">Vaults</span>.<span class="i">CreateOrUpdate</span>(<a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <span class="r4 r">vaultName</span>, <span class="r5 r">vault</span>);
            }
            <b>catch</b> (<span class="i">CloudException</span> <span id="r6 rd" class="r6 r">ex</span>)
            {
                <b>if</b> (<span class="r6 r">ex</span>.<span class="i">Response</span>.<span class="i">StatusCode</span> != <span class="i">System</span>.<span class="i">Net</span>.<span class="i">HttpStatusCode</span>.<span class="i">Conflict</span>) <b>throw</b>;
            }
        }
 
        <b>public void</b> <a id="2a78912cbb3e689c" href="../R/2a78912cbb3e689c.html" target="n" data-glyph="72,1" class="i method">DisposeVaults</a>()
        {
            <b>var</b> <span id="r7 rd" class="r7 r">vaults</span> = <a href="#183a7932218f8920" class="i property">VaultClient</a>.<span class="i">Vaults</span>.<span class="i">ListByResourceGroup</span>(<a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>);
            <b>foreach</b> (<b>var</b> <span id="r8 rd" class="r8 r">vault</span> <b>in</b> <span class="r7 r">vaults</span>)
            {
                <a href="#183a7932218f8920" class="i property">VaultClient</a>.<span class="i">Vaults</span>.<span class="i">Delete</span>(<a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <span class="r8 r">vault</span>.<span class="i">Name</span>);
            }
        }
 
        <b>public</b> <span class="i">List</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#45bfd04647c318b0" class="t t">ProtectionPolicyResource</a>&gt; <a id="4113bdf68246b3a3" href="../R/4113bdf68246b3a3.html" target="n" data-glyph="72,1" class="i method">ListAllPoliciesWithRetries</a>()
        {
            <span class="i">List</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#45bfd04647c318b0" class="t t">ProtectionPolicyResource</a>&gt; <span id="r9 rd" class="r9 r">policies</span> = <b>new</b> <span class="i">List</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#45bfd04647c318b0" class="t t">ProtectionPolicyResource</a>&gt;();
 
            <span class="i">RetryActionWithTimeout</span>(
                () =&gt; <span class="r9 r">policies</span> = <span class="i">GetPagedList</span>(() =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#384ea913e33d54d1" class="i property">BackupPolicies</a>.<span class="i">List</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>),
                        <span id="r10 rd" class="r10 r">nextLink</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#384ea913e33d54d1" class="i property">BackupPolicies</a>.<span class="i">ListNext</span>(<span class="r10 r">nextLink</span>)),
                () =&gt; <span class="r9 r">policies</span>.<span class="i">Count</span> &gt; 0,
                <span class="i">TimeSpan</span>.<span class="i">FromMinutes</span>(5),
                <span class="i">ResourceNotSyncedRetryLogic</span>);
 
            <b>return</b> <span class="r9 r">policies</span>;
        }
 
        <b>public</b> <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#45bfd04647c318b0" class="t t">ProtectionPolicyResource</a> <a id="a4a1eafe99867798" href="../R/a4a1eafe99867798.html" target="n" data-glyph="72,1" class="i method">GetPolicyWithRetries</a>(<b>string</b> <span id="r11 rd" class="r11 r">policyName</span>)
        {
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#45bfd04647c318b0" class="t t">ProtectionPolicyResource</a> <span id="r12 rd" class="r12 r">policy</span> = <b>null</b>;
            <span class="i">RetryActionWithTimeout</span>(
                () =&gt; <span class="r12 r">policy</span> = <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#ae5668031b8e7ab4" class="i property">ProtectionPolicies</a>.<span class="i">Get</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <span class="r11 r">policyName</span>),
                () =&gt; <span class="r12 r">policy</span> != <b>null</b>,
                <span class="i">TimeSpan</span>.<span class="i">FromMinutes</span>(5),
                <span class="i">ResourceNotSyncedRetryLogic</span>);
 
            <b>return</b> <span class="r12 r">policy</span>;
        }
 
        <b>public string</b> <a id="27814e258e819d49" href="../R/27814e258e819d49.html" target="n" data-glyph="72,1" class="i method">EnableProtection</a>(<b>string</b> <span id="r13 rd" class="r13 r">containerName</span>, <b>string</b> <span id="r14 rd" class="r14 r">protectedItemName</span>, <b>string</b> <span id="r15 rd" class="r15 r">policyName</span>)
        {
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#45bfd04647c318b0" class="t t">ProtectionPolicyResource</a> <span id="r16 rd" class="r16 r">policy</span> = <a href="#a4a1eafe99867798" class="i method">GetPolicyWithRetries</a>(<span class="r15 r">policyName</span>);
 
            <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#26c540c89d24f063" class="i property">ProtectionContainers</a>.<span class="i">Refresh</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>);
 
            <span class="i">ODataQuery</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#6442e823db68c618" class="t t">BMSPOQueryObject</a>&gt; <span id="r17 rd" class="r17 r">query</span> = <b>new</b> <span class="i">ODataQuery</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#6442e823db68c618" class="t t">BMSPOQueryObject</a>&gt;(<span id="r18 rd" class="r18 r">po</span> =&gt; <span class="r18 r">po</span>.<span class="i">BackupManagementType</span> == <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#9e2aafd6d2cd0dac" class="t t">BackupManagementType</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#f4e79ba928674250" class="i field">AzureIaasVM</a>);
 
            <span class="i">IPage</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#cca136752013f9b1" class="t t">WorkloadProtectableItemResource</a>&gt; <span id="r19 rd" class="r19 r">protectableItems</span> = <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#e5dd1b542a1aee0f" class="i property">BackupProtectableItems</a>.<span class="i">List</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <span class="i">odataQuery</span>: <span class="r17 r">query</span>);
 
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#4443d375fc2241ff" class="k">var</a> <span id="r20 rd" class="r20 r">desiredProtectedItem</span> = (<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#4443d375fc2241ff" class="t t">AzureIaaSComputeVMProtectableItem</a>) <span class="r19 r">protectableItems</span>.<span class="i">First</span>(
                <span id="r21 rd" class="r21 r">protectableItem</span> =&gt; <span class="r13 r">containerName</span>.<span class="i">ToLower</span>().<span class="i">Contains</span>(<span class="r21 r">protectableItem</span>.<span class="i">Name</span>.<span class="i">ToLower</span>())
                ).<span class="i">Properties</span>;
 
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r20 r">desiredProtectedItem</span>);
 
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#b7c8decaf122ce05" class="k">var</a> <span id="r22 rd" class="r22 r">item</span> = <b>new</b> <span class="t">ProtectedItemResource</span>()
            {
                <span class="i">Properties</span> = <b>new</b> <span class="t">AzureIaaSComputeVMProtectedItem</span>()
                {
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#40b74fc1ef5aed1a" class="i property">PolicyId</a> = <span class="r16 r">policy</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#fae018f6832f90b3" class="i property">Id</a>,
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#da156d5935107b9d" class="i property">SourceResourceId</a> = <span class="r20 r">desiredProtectedItem</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d808bc10bd092ff2" class="i property">VirtualMachineId</a>,
                }
            };
            
            <b>var</b> <span id="r23 rd" class="r23 r">response</span> = <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#02dea5471365fbb0" class="i property">ProtectedItems</a>.<span class="i">CreateOrUpdateWithHttpMessagesAsync</span>(
                <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r13 r">containerName</span>, <span class="r14 r">protectedItemName</span>, <span class="r22 r">item</span>).<span class="i">Result</span>;
            <span class="i">ValidateOperationResponse</span>(<span class="r23 r">response</span>);
 
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="k">var</a> <span id="r24 rd" class="r24 r">jobResponse</span> = <span class="i">GetOperationResponse</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#b7c8decaf122ce05" class="t t">ProtectedItemResource</a>, <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="t t">OperationStatusJobExtendedInfo</a>&gt;(
                <span class="r13 r">containerName</span>, <span class="r14 r">protectedItemName</span>, <span class="r23 r">response</span>,
                <span id="r25 rd" class="r25 r">operationId</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#f47fea08932ab1d4" class="i property">ProtectedItemOperationResults</a>.<span class="i">GetWithHttpMessagesAsync</span>(
                    <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r13 r">containerName</span>, <span class="r14 r">protectedItemName</span>, <span class="r25 r">operationId</span>).<span class="i">Result</span>,
                <span id="r26 rd" class="r26 r">operationId</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#a9b31316dc955df2" class="i property">ProtectedItemOperationStatuses</a>.<span class="i">GetWithHttpMessagesAsync</span>(
                    <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r13 r">containerName</span>, <span class="r14 r">protectedItemName</span>, <span class="r26 r">operationId</span>).<span class="i">Result</span>);
 
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r24 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>);
 
            <b>return</b> <span class="r24 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>;
        }
 
        <b>public string</b> <a id="a8f4fa389c9262f8" href="../R/a8f4fa389c9262f8.html" target="n" data-glyph="72,1" class="i method">Backup</a>(<b>string</b> <span id="r27 rd" class="r27 r">containerName</span>, <b>string</b> <span id="r28 rd" class="r28 r">protectedItemName</span>)
        {
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#2ae67bec06fd9dc6" class="t t">BackupRequestResource</a> <span id="r29 rd" class="r29 r">request</span> = <b>new</b> <span class="t">BackupRequestResource</span>()
            {
                <span class="i">Properties</span> = <b>new</b> <span class="t">IaasVMBackupRequest</span>()
                {
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#46f9dc1f4c3985f8" class="i property">RecoveryPointExpiryTimeInUTC</a> = <span class="i">DateTime</span>.<span class="i">UtcNow</span>.<span class="i">AddDays</span>(2),
                },
            };
 
            <b>var</b> <span id="r30 rd" class="r30 r">response</span> = <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#7c757d733eace3d2" class="i property">Backups</a>.<span class="i">TriggerWithHttpMessagesAsync</span>(
                <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r27 r">containerName</span>, <span class="r28 r">protectedItemName</span>, <span class="r29 r">request</span>).<span class="i">Result</span>;
            <span class="i">ValidateOperationResponse</span>(<span class="r30 r">response</span>);
 
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="k">var</a> <span id="r31 rd" class="r31 r">jobResponse</span> = <span class="i">GetOperationResponse</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#b7c8decaf122ce05" class="t t">ProtectedItemResource</a>, <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="t t">OperationStatusJobExtendedInfo</a>&gt;(
                <span class="r27 r">containerName</span>, <span class="r28 r">protectedItemName</span>, <span class="r30 r">response</span>,
                <span id="r32 rd" class="r32 r">operationId</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#f47fea08932ab1d4" class="i property">ProtectedItemOperationResults</a>.<span class="i">GetWithHttpMessagesAsync</span>(
                    <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r27 r">containerName</span>, <span class="r28 r">protectedItemName</span>, <span class="r32 r">operationId</span>).<span class="i">Result</span>,
                <span id="r33 rd" class="r33 r">operationId</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#a9b31316dc955df2" class="i property">ProtectedItemOperationStatuses</a>.<span class="i">GetWithHttpMessagesAsync</span>(
                    <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r27 r">containerName</span>, <span class="r28 r">protectedItemName</span>, <span class="r33 r">operationId</span>).<span class="i">Result</span>);
 
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r31 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>);
 
            <b>return</b> <span class="r31 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>;
        }
 
        <b>public</b> <span class="i">IPage</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#47090d975733d19c" class="t t">JobResource</a>&gt; <a id="c048ec2a64ff95c1" href="../R/c048ec2a64ff95c1.html" target="n" data-glyph="72,1" class="i method">ListBackupJobs</a>()
        {
           <b>return</b> <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#b9712ca9232e6e51" class="i property">BackupJobs</a>.<span class="i">List</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>);
        }
 
        <b>public void</b> <a id="7020abe66fb41232" href="../R/7020abe66fb41232.html" target="n" data-glyph="72,1" class="i method">WaitForJobCompletion</a>(<b>string</b> <span id="r34 rd" class="r34 r">jobId</span>)
        {
            <b>string</b> <span id="r35 rd" class="r35 r">jobStatus</span> = <b>string</b>.<span class="i">Empty</span>;
 
            <span class="i">RetryActionWithTimeout</span>(
                () =&gt; <span class="r35 r">jobStatus</span> = <a href="#f4db40c697993005" class="i method">GetJobStatus</a>(<span class="r34 r">jobId</span>),
                () =&gt; !<a href="#289d55329cdc7a10" class="i method">IsJobInProgress</a>(<span class="r35 r">jobStatus</span>),
                <span class="i">TimeSpan</span>.<span class="i">FromHours</span>(3),
                <span id="r36 rd" class="r36 r">statusCode</span> =&gt;
                {
                    <span class="i">TestUtilities</span>.<span class="i">Wait</span>(5000);
                    <b>return</b> <b>true</b>;
                });
        }
 
        <b>public string</b> <a id="f4db40c697993005" href="../R/f4db40c697993005.html" target="n" data-glyph="72,1" class="i method">GetJobStatus</a>(<b>string</b> <span id="r37 rd" class="r37 r">jobId</span>)
        {
            <b>var</b> <span id="r38 rd" class="r38 r">result</span> = <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#09a9d142ad02148c" class="i property">JobDetails</a>.<span class="i">GetWithHttpMessagesAsync</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <span class="r37 r">jobId</span>).<span class="i">Result</span>;
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r38 r">result</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<span class="i">System</span>.<span class="i">Net</span>.<span class="i">HttpStatusCode</span>.<span class="i">OK</span>, <span class="r38 r">result</span>.<span class="i">Response</span>.<span class="i">StatusCode</span>);
            <b>return</b> ((<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#0670bfd642a16254" class="t t">AzureIaaSVMJob</a>)<span class="r38 r">result</span>.<span class="i">Body</span>.<span class="i">Properties</span>).<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#0e7043d6f8f0cf28" class="i property">Status</a>;
        }
 
        <b>public bool</b> <a id="289d55329cdc7a10" href="../R/289d55329cdc7a10.html" target="n" data-glyph="72,1" class="i method">IsJobInProgress</a>(<b>string</b> <span id="r39 rd" class="r39 r">jobStatus</span>)
        {
            <b>return</b> <span class="r39 r">jobStatus</span>.<span class="i">CompareTo</span>(<span class="s">&quot;InProgress&quot;</span>) == 0 || <span class="r39 r">jobStatus</span>.<span class="i">CompareTo</span>(<span class="s">&quot;Cancelling&quot;</span>) == 0;
        }
 
        <b>public void</b> <a id="b2d15a67f7a20576" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">RetryActionWithTimeout</a>(<span class="i">Action</span> <span id="r40 rd" class="r40 r">action</span>, <span class="i">Func</span>&lt;<b>bool</b>&gt; <span id="r41 rd" class="r41 r">validator</span>, <span class="i">TimeSpan</span> <span id="r42 rd" class="r42 r">timeout</span>, <span class="i">Func</span>&lt;<span class="i">HttpStatusCode</span>, <b>bool</b>&gt; <span id="r43 rd" class="r43 r">shouldRetry</span>)
        {
            <span class="i">DateTime</span> <span id="r44 rd" class="r44 r">timedOut</span> = <span class="i">DateTime</span>.<span class="i">Now</span> + <span class="r42 r">timeout</span>;
 
            <b>do</b>
            {
                <b>try</b>
                {
                    <span class="r40 r">action</span>();
                }
                <b>catch</b> (<span class="i">CloudException</span> <span id="r45 rd" class="r45 r">exception</span>)
                {
                    <b>if</b> (!<span class="r43 r">shouldRetry</span>(<span class="r45 r">exception</span>.<span class="i">Response</span>.<span class="i">StatusCode</span>))
                    {
                        <b>throw</b>;
                    }
                }
            }
            <b>while</b> (<span class="i">DateTime</span>.<span class="i">Now</span> &lt; <span class="r44 r">timedOut</span> &amp;&amp; !<span class="r41 r">validator</span>());
        }
 
        <b>private void</b> <a id="4fec7502735da83e" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ValidateOperationResponse</a>(<span class="i">HttpOperationResponse</span> <span id="r46 rd" class="r46 r">response</span>)
        {
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r46 r">response</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<span class="i">System</span>.<span class="i">Net</span>.<span class="i">HttpStatusCode</span>.<span class="i">Accepted</span>, <span class="r46 r">response</span>.<span class="i">Response</span>.<span class="i">StatusCode</span>);
            <span class="i">Assert</span>.<span class="i">True</span>(<span class="r46 r">response</span>.<span class="i">Response</span>.<span class="i">Headers</span>.<span class="i">Contains</span>(<span class="s">&quot;Location&quot;</span>));
            <span class="i">Assert</span>.<span class="i">True</span>(<span class="r46 r">response</span>.<span class="i">Response</span>.<span class="i">Headers</span>.<span class="i">Contains</span>(<span class="s">&quot;Azure-AsyncOperation&quot;</span>));
            <span class="i">Assert</span>.<span class="i">True</span>(<span class="r46 r">response</span>.<span class="i">Response</span>.<span class="i">Headers</span>.<span class="i">Contains</span>(<span class="s">&quot;Retry-After&quot;</span>));
        }
 
        <b>public</b> <span class="i">List</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#b7c8decaf122ce05" class="t t">ProtectedItemResource</a>&gt; <a id="6c311b6941ffcbc3" href="../R/6c311b6941ffcbc3.html" target="n" data-glyph="72,1" class="i method">ListProtectedItems</a>()
        {
            <b>return</b> <span class="i">GetPagedList</span>(
                () =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#719f78d338f58f30" class="i property">BackupProtectedItems</a>.<span class="i">List</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>),
                <span id="r47 rd" class="r47 r">nextLink</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#719f78d338f58f30" class="i property">BackupProtectedItems</a>.<span class="i">ListNext</span>(<span class="r47 r">nextLink</span>));
        }
 
        <b>public</b> <span class="i">List</span>&lt;<span class="r48 r t">T</span>&gt; <a id="a11ba1259c9b0663" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">GetPagedList</a>&lt;<span id="r48 rd t" class="r48 r t">T</span>&gt;(<span class="i">Func</span>&lt;<span class="i">IPage</span>&lt;<span class="r48 r t">T</span>&gt;&gt; <span id="r49 rd" class="r49 r">listResources</span>, <span class="i">Func</span>&lt;<b>string</b>, <span class="i">IPage</span>&lt;<span class="r48 r t">T</span>&gt;&gt; <span id="r50 rd" class="r50 r">listNext</span>)
            <b>where</b> <span class="r48 r t">T</span> : <span class="i n">Models</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#2aeb6223b59649b2" class="t t">Resource</a>
        {
            <b>var</b> <span id="r51 rd" class="r51 r">resources</span> = <b>new</b> <span class="i">List</span>&lt;<span class="r48 r t">T</span>&gt;();
            <b>string</b> <span id="r52 rd" class="r52 r">nextLink</span> = <b>null</b>;
 
            <b>var</b> <span id="r53 rd" class="r53 r">pagedResources</span> = <span class="r49 r">listResources</span>();
 
            <b>foreach</b> (<b>var</b> <span id="r54 rd" class="r54 r">pagedResource</span> <b>in</b> <span class="r53 r">pagedResources</span>)
            {
                <span class="r51 r">resources</span>.<span class="i">Add</span>(<span class="r54 r">pagedResource</span>);
            }
 
            <b>while</b> (!<b>string</b>.<span class="i">IsNullOrEmpty</span>(<span class="r52 r">nextLink</span>))
            {
                <span class="r52 r">nextLink</span> = <span class="r53 r">pagedResources</span>.<span class="i">NextPageLink</span>;
 
                <b>foreach</b> (<b>var</b> <span id="r55 rd" class="r55 r">pagedResource</span> <b>in</b> <span class="r50 r">listNext</span>(<span class="r52 r">nextLink</span>))
                {
                    <span class="r51 r">resources</span>.<span class="i">Add</span>(<span class="r55 r">pagedResource</span>);
                }
            }
 
            <b>return</b> <span class="r51 r">resources</span>;
        }
 
        <b>public</b> <span class="i">List</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#96865eca99296f2c" class="t t">RecoveryPointResource</a>&gt; <a id="095dab0071e1fe71" href="../R/095dab0071e1fe71.html" target="n" data-glyph="72,1" class="i method">ListRecoveryPoints</a>(<b>string</b> <span id="r56 rd" class="r56 r">containerName</span>, <b>string</b> <span id="r57 rd" class="r57 r">protectedItemName</span>)
        {
            <b>return</b> <span class="i">GetPagedList</span>(
                () =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#dc25b67c68a9741d" class="i property">RecoveryPoints</a>.<span class="i">List</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r56 r">containerName</span>, <span class="r57 r">protectedItemName</span>),
                <span id="r58 rd" class="r58 r">nextLink</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#dc25b67c68a9741d" class="i property">RecoveryPoints</a>.<span class="i">ListNext</span>(<span class="r58 r">nextLink</span>));
        }
 
        <b>public string</b> <a id="8cbc4212dd702c49" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Restore</a>(<b>string</b> <span id="r59 rd" class="r59 r">containerName</span>, <b>string</b> <span id="r60 rd" class="r60 r">protectedItemName</span>, <b>string</b> <span id="r61 rd" class="r61 r">recoveryPointName</span>, <b>string</b> <span id="r62 rd" class="r62 r">sourceResourceId</span>, <b>string</b> <span id="r63 rd" class="r63 r">storageAccountId</span>)
        {
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#0d9b9dc14391ae27" class="t t">RestoreRequestResource</a> <span id="r64 rd" class="r64 r">request</span> = <b>new</b> <span class="t">RestoreRequestResource</span>()
            {
                <span class="i">Properties</span> = <b>new</b> <span class="t">IaasVMRestoreRequest</span>()
                {
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#dc17a962a761cc5a" class="i property">CreateNewCloudService</a> = <b>false</b>,
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#f1d098271dba81d3" class="i property">RecoveryPointId</a> = <span class="r61 r">recoveryPointName</span>,
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#354384a5193cdd46" class="i property">RecoveryType</a> = <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#3fc794b2a66b7ab4" class="t t">RecoveryType</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#8d164a6392aef186" class="i field">RestoreDisks</a>,
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#3e66afbb885033cc" class="i property">Region</a> = <a href="#c9a7183b9bf8aa41" class="i field">Location</a>,
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#504dfa2505c61e29" class="i property">SourceResourceId</a> = <span class="r62 r">sourceResourceId</span>,
                    <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#0041441207b7d7ee" class="i property">StorageAccountId</a> = <span class="r63 r">storageAccountId</span>,
                }
            };
            <b>var</b> <span id="r65 rd" class="r65 r">response</span> = <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#dc93d81cee1f72e6" class="i property">Restores</a>.<span class="i">TriggerWithHttpMessagesAsync</span>(
                <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r59 r">containerName</span>, <span class="r60 r">protectedItemName</span>, <span class="r61 r">recoveryPointName</span>, <span class="r64 r">request</span>).<span class="i">Result</span>;
            <span class="i">ValidateOperationResponse</span>(<span class="r65 r">response</span>);
 
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="k">var</a> <span id="r66 rd" class="r66 r">jobResponse</span> = <span class="i">GetOperationResponse</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#b7c8decaf122ce05" class="t t">ProtectedItemResource</a>, <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="t t">OperationStatusJobExtendedInfo</a>&gt;(
                <span class="r59 r">containerName</span>, <span class="r60 r">protectedItemName</span>, <span class="r65 r">response</span>,
                <span id="r67 rd" class="r67 r">operationId</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#f47fea08932ab1d4" class="i property">ProtectedItemOperationResults</a>.<span class="i">GetWithHttpMessagesAsync</span>(
                    <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r59 r">containerName</span>, <span class="r60 r">protectedItemName</span>, <span class="r67 r">operationId</span>).<span class="i">Result</span>,
                <span id="r68 rd" class="r68 r">operationId</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#a9b31316dc955df2" class="i property">ProtectedItemOperationStatuses</a>.<span class="i">GetWithHttpMessagesAsync</span>(
                    <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r59 r">containerName</span>, <span class="r60 r">protectedItemName</span>, <span class="r68 r">operationId</span>).<span class="i">Result</span>);
 
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r66 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>);
 
            <b>return</b> <span class="r66 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>;
        }
 
        <b>public string</b> <a id="2a95723f0f7f44ed" href="../R/2a95723f0f7f44ed.html" target="n" data-glyph="72,1" class="i method">DisableProtection</a>(<b>string</b> <span id="r69 rd" class="r69 r">containerName</span>, <b>string</b> <span id="r70 rd" class="r70 r">itemName</span>)
        {
            <b>var</b> <span id="r71 rd" class="r71 r">response</span> = <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#02dea5471365fbb0" class="i property">ProtectedItems</a>.<span class="i">DeleteWithHttpMessagesAsync</span>(
                <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <a href="#15798c0d0fff184f" class="i field">FabricName</a>, <span class="r69 r">containerName</span>, <span class="r70 r">itemName</span>).<span class="i">Result</span>;
            <span class="i">ValidateOperationResponse</span>(<span class="r71 r">response</span>);
 
            <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="k">var</a> <span id="r72 rd" class="r72 r">jobResponse</span> = <span class="i">GetOperationStatus</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#788271c0ee419e28" class="t t">OperationStatusJobExtendedInfo</a>&gt;(
                <span class="r69 r">containerName</span>, <span class="r70 r">itemName</span>, <span class="r71 r">response</span>,
                <span id="r73 rd" class="r73 r">operationId</span> =&gt; <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#8d6337d369b05843" class="i property">BackupOperationStatuses</a>.<span class="i">GetWithHttpMessagesAsync</span>(
                    <a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>, <span class="r73 r">operationId</span>).<span class="i">Result</span>);
 
            <span class="i">Assert</span>.<span class="i">NotNull</span>(<span class="r72 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>);
 
            <b>return</b> <span class="r72 r">jobResponse</span>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#d10fdf2ee4c90cb7" class="i property">JobId</a>;
        }
 
        <b>public</b> <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#06ef8094a6b1f0c0" class="t t">TokenInformation</a> <a id="1d25fdb5bfdcd7c1" href="../R/1d25fdb5bfdcd7c1.html" target="n" data-glyph="72,1" class="i method">GetBackupSecurityPin</a>()
        {
            <b>return</b> <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#73117ce3cbc12388" class="i property">SecurityPINs</a>.<span class="i">Get</span>(<a href="#e661209b8f942c4f" class="i field">VaultName</a>, <a href="#01b9bbcc853d3009" class="i field">ResourceGroup</a>);
        }
 
        <span class="k preprocess">#</span><span class="k preprocess">region</span> Private Method
 
        <b>private</b> <span class="r74 r t">T</span> <a id="7f366deb448afafe" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetOperationStatus</a>&lt;<span id="r74 rd t" class="r74 r t">T</span>&gt;(<b>string</b> <span id="r75 rd" class="r75 r">containerName</span>, <b>string</b> <span id="r76 rd" class="r76 r">itemName</span>, <span class="i">AzureOperationResponse</span> <span id="r77 rd" class="r77 r">response</span>,
            <span class="i">Func</span>&lt;<b>string</b>, <span class="i">AzureOperationResponse</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#27cb45102af6e8f4" class="t t">OperationStatus</a>&gt;&gt; <span id="r78 rd" class="r78 r">getOpStatus</span>)
            <b>where</b> <span class="r74 r t">T</span> : <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#a7bd99ac6a319e3a" class="t t">OperationStatusExtendedInfo</a>
        {
            <b>var</b> <span id="r79 rd" class="r79 r">operationId</span> = <span class="r77 r">response</span>.<span class="i">Response</span>.<span class="i">Headers</span>.<span class="i">GetAzureAsyncOperationId</span>();
 
            <b>var</b> <span id="r80 rd" class="r80 r">opStatusResponse</span> = <span class="r78 r">getOpStatus</span>(<span class="r79 r">operationId</span>);
 
            <b>while</b> (<span class="r80 r">opStatusResponse</span>.<span class="i">Body</span>.<span class="i">Status</span> == <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#087bb40e96287e31" class="t t">OperationStatusValues</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#8c3e13c8c97d99a6" class="i field">InProgress</a>)
            {
                <span class="i">TestUtilities</span>.<span class="i">Wait</span>(5000);
 
                <span class="r80 r">opStatusResponse</span> = <span class="r78 r">getOpStatus</span>(<span class="r79 r">operationId</span>);
            }
 
            <span class="r80 r">opStatusResponse</span> = <span class="r78 r">getOpStatus</span>(<span class="r79 r">operationId</span>);
            <span class="i">Assert</span>.<span class="i">Equal</span>(<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#087bb40e96287e31" class="t t">OperationStatusValues</a>.<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#5bf7d5c57d80d1a2" class="i field">Succeeded</a>, <span class="r80 r">opStatusResponse</span>.<span class="i">Body</span>.<span class="i">Status</span>);
 
            <b>return</b> (<span class="r74 r t">T</span>)(<span class="r80 r">opStatusResponse</span>.<span class="i">Body</span>.<span class="i">Properties</span>);
        }
 
        <b>private</b> <span class="r81 r t">S</span> <a id="44e659a31a59e122" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetOperationResponse</a>&lt;<span id="r82 rd t" class="r82 r t">T</span>, <span id="r81 rd t" class="r81 r t">S</span>&gt;(<b>string</b> <span id="r83 rd" class="r83 r">containerName</span>, <b>string</b> <span id="r84 rd" class="r84 r">protectedItemName</span>, <span class="i">HttpOperationResponse</span> <span id="r85 rd" class="r85 r">response</span>,
            <span class="i">Func</span>&lt;<b>string</b>, <span class="i">AzureOperationResponse</span>&lt;<span class="r82 r t">T</span>&gt;&gt; <span id="r86 rd" class="r86 r">getOpResult</span>,
            <span class="i">Func</span>&lt;<b>string</b>, <span class="i">AzureOperationResponse</span>&lt;<a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#27cb45102af6e8f4" class="t t">OperationStatus</a>&gt;&gt; <span id="r87 rd" class="r87 r">getOpStatus</span>)
            <b>where</b> <span class="r82 r t">T</span> : <b>class
            where</b> <span class="r81 r t">S</span> : <a href="/Microsoft.Azure.Management.RecoveryServices.Backup/A.html#a7bd99ac6a319e3a" class="t t">OperationStatusExtendedInfo</a>
        {
            <b>var</b> <span id="r88 rd" class="r88 r">operationId</span> = <span class="r85 r">response</span>.<span class="i">Response</span>.<span class="i">Headers</span>.<span class="i">Location</span>.<span class="i">Segments</span>.<span class="i">Last</span>();
 
            <b>var</b> <span id="r89 rd" class="r89 r">opResponse</span> = <span class="r86 r">getOpResult</span>(<span class="r88 r">operationId</span>);
 
            <b>while</b> (<span class="r89 r">opResponse</span>.<span class="i">Response</span>.<span class="i">StatusCode</span> == <span class="i">System</span>.<span class="i">Net</span>.<span class="i">HttpStatusCode</span>.<span class="i">Accepted</span>)
            {
                <span class="i">TestUtilities</span>.<span class="i">Wait</span>(5000);
 
                <span class="r89 r">opResponse</span> = <span class="r86 r">getOpResult</span>(<span class="r89 r">opResponse</span>.<span class="i">Response</span>.<span class="i">Headers</span>.<span class="i">Location</span>.<span class="i">Segments</span>.<span class="i">Last</span>());
            }
 
            <b>var</b> <span id="r90 rd" class="r90 r">opStatusResponse</span> = <span class="r87 r">getOpStatus</span>(<span class="r88 r">operationId</span>);
 
            <b>return</b> (<span class="r81 r t">S</span>)(<span class="r90 r">opStatusResponse</span>.<span class="i">Body</span>.<span class="i">Properties</span>);
        }
 
        <b>private bool</b> <a id="62eb0c5e50dc9530" href="../R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">ResourceNotSyncedRetryLogic</a>(<span class="i">HttpStatusCode</span> <span id="r91 rd" class="r91 r">statusCode</span>)
        {
            <b>bool</b> <span id="r92 rd" class="r92 r">shouldRetry</span> = <span class="r91 r">statusCode</span> == (<span class="i">HttpStatusCode</span>)429 || <span class="r91 r">statusCode</span> == <span class="i">HttpStatusCode</span>.<span class="i">NotFound</span>;
            <b>if</b> (<span class="r92 r">shouldRetry</span>)
            {
                <span class="i">TestUtilities</span>.<span class="i">Wait</span>(<span class="i">TimeSpan</span>.<span class="i">FromSeconds</span>(30));
            }
            <b>return</b> <span class="r92 r">shouldRetry</span>;
        }
 
 
        <span class="k preprocess">#</span><span class="k preprocess">endregion</span>
        <b>public void</b> <a id="67b996f1df77c5a0" href="../R/../../0000000000.html" target="n" data-glyph="72,1" class="i method">Dispose</a>()
        {
            <a href="#2a78912cbb3e689c" class="i method">DisposeVaults</a>();
            <a href="#ed10104e664fd4a9" class="i property">BackupClient</a>.<span class="i">Dispose</span>();
            <a href="#183a7932218f8920" class="i property">VaultClient</a>.<span class="i">Dispose</span>();
        }
    }
}
</pre></td></tr></table></div></body></html>
